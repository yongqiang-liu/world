var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Model=function(t){function e(n){var i=t.call(this)||this;return i.type=0,i.id=0,i._status=0,i.playerName="",i.info="",i.title="",i.level=0,i.sex=0,i.race=0,i.job=0,i.mode=e.MODE_NORMAL,i.shopName="",i.vipLevel=0,i.superQqLevel=0,i.icon1=0,i.icon2=0,i.icon3=0,i.countryId=-1,i.countryName="",i.countryRank=0,i.level2=0,i.enchantValue=0,i.shoptype=0,i.iconpet1=0,i.controlList=[],i.dir=2,i.intValue1=0,i.lastMove=null,i.lastMoveBeginIndex=0,i.leaderID=-1,i.members=null,i.type=n,i.anchorOffsetX=-MapSetup.GRID_HALF_WIDTH,i.anchorOffsetY=-MapSetup.GRID_HEIGHT,i}return __extends(e,t),e.prototype.isHasPhoto=function(){return this.isStatusBit(ModelConst.STATUS_IS_PHOTO)},e.prototype.isHasCard=function(){return this.isStatusBit(ModelConst.STATUS_IS_CARD)},e.prototype.isHasCity=function(){return this.isStatusBit(ModelConst.STATUS_IS_CITY)},e.prototype.isRobot=function(){return this.isStatusBit(ModelConst.STATUS_IS_ROBOT)},e.prototype.getModelString=function(){var t=new StringBuffer;switch(this.isPlayerTeam()&&(this.isLeader()?t.append("("+GameText.STR_LEADER+")"):this.isMember()&&t.append("("+GameText.STR_MEMBER+")")),this.getMode()){case e.MODE_SHOP:Define.PLAYER_SHOP_TYPE_ENCHANT==this.getShoptype()?t.append(GameText2.STR_ENCHANT):Define.PLAYER_SHOP_TYPE_NORMAL==this.getShoptype()&&t.append(GameText.getText(GameText.TI_PUT_SHOP));break;case e.MODE_BATTLE_LOCAL:case e.MODE_BATTLE_REMOTE:t.append(GameText.STR_BATTLE);break;case e.MODE_BATTLE_PK:t.append(GameText.getText(GameText.TI_PK));break;case e.MODE_BATTLE_OB:t.append(GameText.getText(GameText.TI_VIEW_BATTLE))}return Tool.isNullText(t.toString())&&t.append(GameText.STR_FREE),t.toString()},e.isLongTrouses=function(t){return t>=52},e.prototype.isCanMove=function(){return this.isShopMode()?(AlertPanel.alertCommon(GameText.STR_SHOP_CANNOT_MOVE),!1):!(this.isMember()||GameWorld.isEscortStatus())},e.prototype.getMerList=function(){return this.merList},e.prototype.getMercenaryById=function(t){if(null==this.merList)return null;for(var e=0;e<this.merList.length;e++){var n=this.merList[e];if(null!=n&&5==n.type&&n.groupId==t)return n}return null},e.prototype.addMercenary=function(t){if(null==t)return!1;if(5!=t.type)return!1;null==this.merList&&(this.merList=new Array(e.MAX_MERCENARY_MEMBER));for(var n=0,i=0;i<=this.merList.length;i++)if(null==this.merList[i]){n=i;break}if(0==this.addMember(t))return!1;var o=this.merList[n];null!=o&&this.removeMercenary(o),this.merList[n]=t;var a=xworld.gameMap;return a&&a.playerLayer&&a.playerLayer.addChild(t),this.refreshPlayerAllSprite(),!0},e.prototype.removeMercenary=function(t){if(null==t)return!1;if(5!=t.type)return!1;if(null==this.merList)return!1;for(var e=0;e<this.merList.length;e++){var n=this.merList[e];if(null!=n&&n.type==t.type&&n.groupId==t.groupId){var i=xworld.gameMap;return t&&i.playerLayer.contains(t)&&i.playerLayer.removeChild(t),this.removeMember(n.groupId,5),this.merList.splice(e,1),!0}}return this.refreshPlayerAllSprite(),!1},e.prototype.clearMercenary=function(){if(!(null==this.merList||this.merList.length<0)){if(this.merList=null,null!=this.members&&this.members.length>0)for(var t=this.members.length-1;t>=0;t--){var e=this.members[t];(null==e||5==e.getType())&&this.members.splice(t,1)}(null==this.members||this.members.length<=0)&&(this.members=null,this.setLeaderID(-1),this.cleanLastMove())}},e.prototype.setPet=function(t){var n=xworld.gameMap;(this.pet&&n.playerLayer.contains(this.pet)&&n.playerLayer.removeChild(this.pet),this.pet=t,this.setTabStatus(!1,e.PET_INNER_SHOW),this.sprite&&(this.sprite.innerSprite=null),null!=this.pet)&&(this.pet.follower=this,t.icon1,e.OFFSET_PET_STYLE,e.LEN_PET_STYLE,PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updatePetHeadIcon(),n&&n.playerLayer&&n.playerLayer.addChild(this.pet))},e.prototype.getPet=function(){return this.pet},e.prototype.getDir=function(){return this.dir},e.prototype.setDir=function(t){switch(t){case 0:case 1:case 2:case 3:case 8:this.dir=t;break;case 4:case 5:this.dir=1;break;case 6:case 7:this.dir=0}},e.prototype.setIcon1=function(t){this.icon1=t},e.prototype.getIcon1=function(){return this.icon1},e.prototype.setIcon2=function(t){this.icon2=t},e.prototype.getIcon2=function(){return this.icon2},e.prototype.setIcon3=function(t){this.icon3=t},e.prototype.getIcon3=function(){return this.icon3},e.prototype.isFollower=function(){return null!=this.follower},e.prototype.checkFollowMove=function(){if(null==this.follower)return!1;var t=this.follower.x-this.x,e=this.follower.y-this.y,n=Math.abs(t),i=Math.abs(e);if(n+i<=2*MapSetup.GRID_WIDTH)return!1;var o=xworld.getSpeed(this),a=0,r=0;n>MapSetup.GRID_WIDTH&&(t>0?a+=o:a-=o),i>MapSetup.GRID_WIDTH&&(e>0?r+=o:r-=o),0==a&&0==r&&(i>n?e>0?r+=o:r-=o:t>0?a+=o:a-=o);var s=Control.createPixelMove(this.follower.getId(),a,r,this.getType());return this.controlList.push(s),!0},e.prototype.logicPlayer=function(t){this.logic(t),this.pet&&this.pet.logic(t);var e=this.merList;if(e)for(var n=0,i=e.length;i>n;n++)e[n]&&e[n].logic(t)},e.prototype.logic=function(t){(this.getId()!=xself.getId()||1!=Main.instance.hasPopupUI&&1!=PanelManager.isOpeningFullScene&&1!=guide.ballGuiding)&&this.executeControlList(this.controlList)},e.prototype.executeControlList=function(t){if(0==t.length&&0==this.checkFollowMove())return void(this.isTabStatus(e.MOVE_END_CHECK)&&(this.setAnimationByDir(!1),this.setTabStatus(!1,e.MOVE_END_CHECK)));window.TICKER_RARE=2;var n=t[0];if(n.execute(),n.isStatus(Control.FLAG_FINISH)){this.getId()==xself.getId()&&n.isTypeMoveTo&&AutoGamer.checkAutoGameEnable()&&AutoGamer.autoFindMission();var i=t.indexOf(n);t.splice(i,1)}window.TICKER_RARE=6},e.prototype.moveByDir=function(t,e){switch(t){case 2:this.moveByPixel(0,e);break;case 3:this.moveByPixel(0,-e);break;case 1:this.moveByPixel(-e,0);break;case 0:this.moveByPixel(e,0);break;case 4:this.moveByPixel(-e,-e);break;case 5:this.moveByPixel(-e,e);break;case 6:this.moveByPixel(e,-e);break;case 7:this.moveByPixel(e,e)}},e.prototype.moveByPixel=function(t,e){this.x+=t,this.y+=e,this.refreshMoveData(t,e)},e.prototype.refreshMoveData=function(t,e){(3==this.type||5==this.type)&&(this.refreshFollowTeamPixelMove(),this.isInTeam()&&this.saveLastMove(t,e))},e.prototype.getClientUid=function(t){var e=Define.getAreaID(this.id,!0);return 1==t&&(e="(ID:"+e+")"),e},e.prototype.setId=function(t){this.id=t},e.prototype.getId=function(){return this.id},e.prototype.setType=function(t){this.type=t},e.prototype.getType=function(){return this.type},e.prototype.getGx=function(){return Math.floor(this.x/MapSetup.GRID_WIDTH)},e.prototype.getGy=function(){return Math.floor(this.y/MapSetup.GRID_HEIGHT)},e.prototype.getName=function(){return this.playerName},e.prototype.setName=function(t){this.playerName=t},e.prototype.getLevel=function(){return this.level},e.prototype.setLevel=function(t){this.level=t},e.prototype.getSex=function(){return this.sex},e.prototype.setSex=function(t){this.sex=t},e.prototype.getJob=function(){return this.job},e.prototype.setJob=function(t){this.job=t},e.prototype.getRace=function(){return this.race},e.prototype.setRace=function(t){this.race=t},e.prototype.getInfo=function(){return this.info},e.prototype.setInfo=function(t){this.info=t},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(t){this.title=t},e.prototype.setMode=function(t){var n=this.mode;this.mode=t,n!=e.MODE_SHOP&&t!=e.MODE_SHOP||n==t||this.dispatchEvent(new WorldEvent(WorldEvent.MODE_SHOP_CHANGE)),this.checkSell()},e.prototype.getMode=function(){return this.mode},e.prototype.getSetting=function(){return this.setting},e.prototype.setSetting=function(t){this.setting=t},e.prototype.getLevel2=function(){return this.level2},e.prototype.setLevel2=function(t){this.level2=t},e.prototype.getRemark=function(){return this.remark},e.prototype.setRemark=function(t){this.remark=t},e.prototype.getEnchantValue=function(){return this.enchantValue},e.prototype.setEnchantValue=function(t){this.enchantValue=t},e.prototype.getCountryId=function(){return this.countryId},e.prototype.setCountryId=function(t){this.countryId=t},e.prototype.getCountryName=function(){return this.countryName},e.prototype.setCountryName=function(t){this.countryName=t},e.prototype.getCountryRank=function(){return this.countryRank},e.prototype.getCountryRankStr=function(){var t=Define.getRankString(this.countryRank);return this.isStatusBit(ModelConst.STATUS_IS_SOLDIER)?t+="("+GameText.STR_MODEL_SOLDIER+")":this.isStatusBit(ModelConst.STATUS_IS_HELP)&&(t+="("+GameText.STR_MODEL_HELP+")"),t},e.prototype.setCountryRank=function(t){this.countryRank=t},e.prototype.clearCountry=function(){this.countryId=-1,this.countryName="",this.countryRank=-1},Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t},enumerable:!0,configurable:!0}),e.prototype.getStatus=function(){return this.status},e.prototype.setStatus=function(t){this.status=t},e.prototype.isStatusBit=function(t){return 0!=(this.status&t)},e.prototype.setStatusBit=function(t){this.status|=t},e.prototype.clearStatusBit=function(t){this.status&=~t},e.prototype.isSettingBit=function(t){return 0!=(this.setting&t)},e.prototype.setSettingBit=function(t){this.setting|=t},e.prototype.clearSettingBit=function(t){this.setting&=~t},e.prototype.getVipLevel=function(){return this.vipLevel},e.prototype.setVipLevel=function(t){this.vipLevel=t},e.prototype.getShoptype=function(){return this.shoptype},e.prototype.setShoptype=function(t){this.shoptype=t},e.prototype.getIconpet1=function(){return this.iconpet1},e.prototype.setIconpet1=function(t){this.iconpet1=t},e.prototype.isShopMode=function(){return this.mode==e.MODE_SHOP},e.prototype.setShopMode=function(t){this.setMode(t?e.MODE_SHOP:e.MODE_NORMAL)},e.prototype.clearData=function(){if(this.pet&&this.pet.parent&&this.pet.parent.removeChild(this.pet),this.merList)for(var t=this.merList.length,e=void 0,n=0;t>n;n++)(e=this.merList[n])&&e.parent&&e.parent.removeChild(e);this.pet=null,this.merList=null},e.prototype.isBattleMode=function(){return this.mode>=e.MODE_BATTLE_LOCAL},e.prototype.isBattleRemote=function(){return this.mode==e.MODE_BATTLE_REMOTE||this.mode==e.MODE_BATTLE_PK},e.prototype.initFollowPos=function(){if(this.pet&&(this.pet.x=this.x,this.pet.y=this.y),this.members)for(var t=0;t<this.members.length;t++){var e=this.members[t];null!=e&&(e.x=this.x,e.y=this.y,e.cleanLastMove(),null!=e.pet&&(e.pet.x=e.x,e.pet.y=e.y))}this.cleanLastMove()},e.prototype.refreshPetPixelMove=function(){if(3==this.type&&null!=this.pet){var t=this,n=this.pet;if(0!=t.isTabStatus(e.LAST_MOVE_FILL)){var i=t.getLastMove();if(null!=i){var o=Control.createPixelMove(t.getId(),i[0],i[1],n.getType());n.addControl(o)}}}},e.prototype.refreshFollowTeamPixelMove=function(){if(3==this.type&&0!=this.isLeader()&&!(null==this.members||this.members.length<=0))for(var t=this,n=null,i=null,o=null,a=0,r=this.members.length;r>a;a++)null!=(n=this.members[a])&&0!=this.isTabStatus(e.LAST_MOVE_FILL)&&(null!=(o=t.getLastMove())&&(3==n.type?i=Control.createPixelMove(n.getId(),o[0],o[1],n.type):5==n.type&&(i=Control.createPixelMoveWithGroup(this.id,o[0],o[1],n.type,n.groupId)),n.addControl(i),t=n))},e.prototype.getLastMove=function(){return this.isTabStatus(e.LAST_MOVE_FILL)?null==this.lastMove?null:this.lastMove[this.lastMoveBeginIndex]:null},e.prototype.saveLastMove=function(t,n){null==this.lastMove&&(this.lastMove=[[0,0],[0,0],[0,0],[0,0],[0,0]]),this.lastMove[this.lastMoveBeginIndex][0]=t,this.lastMove[this.lastMoveBeginIndex][1]=n,this.lastMoveBeginIndex=(this.lastMoveBeginIndex+1)%this.lastMove.length,0==this.lastMoveBeginIndex&&this.setTabStatus(!0,e.LAST_MOVE_FILL)},e.prototype.cleanLastMove=function(){if(this.setTabStatus(!1,e.LAST_MOVE_FILL),this.lastMoveBeginIndex=0,null!=this.lastMove)for(var t=0;t<this.lastMove.length;t++)this.lastMove[t][0]=this.lastMove[t][1]=0},e.prototype.setPosition=function(t,e){this.x=t*MapSetup.GRID_WIDTH,this.y=e*MapSetup.GRID_HEIGHT,(this.pet||this.members)&&this.initFollowPos()},e.prototype.setPos=function(t,e){this.x=t,this.y=e},e.prototype.isTourist=function(){return this.isStatusBit(ModelConst.STATUS_IS_TOURIST)},e.prototype.setAnimationByDir=function(t){if(null!=this.sprite){if(t)this.sprite.setCurAnimationAsId(GameSprite.ANIMATION_MOVE);else this.sprite.setCurAnimationAsId(GameSprite.ANIMATION_STAND)||this.sprite.setCurAnimationAsId(GameSprite.ANIMATION_BATTLE_STAND);this.setSpriteRotateByDir()}},e.prototype.setSpriteRotateByDir=function(){if(null!=this.sprite){var t=this.sprite.getRotate();switch(this.dir){case 1:t=!1;break;case 0:t=!0}t!=this.sprite.getRotate()&&this.sprite.setRotate(t)}},e.prototype.addControl=function(t){this.controlList.push(t)},e.prototype.removeAllControl=function(){this.controlList=[]},e.prototype.getControlList=function(){return this.controlList},e.prototype.isFree=function(){return 0==this.controlList.length},e.prototype.getPlayerSprite=function(){return this.sprite},e.prototype.setPlayerSprite=function(t){this.sprite=t},e.prototype.refreshPlayerAllSprite=function(){if(null!=this.pet&&this.pet.refreshWorldSprite(),this.refreshWorldSprite(),null!=this.merList)for(var t=0,e=this.merList.length;e>t;t++)null!=this.merList[t]&&this.merList[t].refreshWorldSprite()},e.prototype.refreshWorldSprite=function(){if(this.sprite&&this.sprite.parent){this.sprite.parent.removeChild(this.sprite);var t=this.sprite.cloakSprite;t&&t.parent&&t.parent.removeChild(t)}this.sprite=this.createSprite(!1),this.setSpriteRotateByDir(),this.addChild(this.sprite),this.checkSell(),xself&&this.id==xself.getId()&&PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateHeadIcon()},e.setHandAndFeet=function(t){return(t|=(1&e.LEN_HAND_STYLE)<<e.OFFSET_HAND_STYLE)|(1&e.LEN_FEET_STYLE)<<e.OFFSET_FEET_STYLE},e.prototype.createSprite=function(t){switch(this.type){case 2:case 1:return SpriteHelper.createSpritex(this.icon1,t);case 4:case 7:case 9:return SpriteHelper.createPetSpriteByIcon(this.icon1,t);case 5:case 3:case 6:case 8:return this.createPlayerSprite(t);default:return null}},e.prototype.createPlayerSprite=function(t){if(this.isLeader()&&null!=this.members&&0==t&&3==this.type&&this.isTwoPeopleHouse()){for(var e=this.getSex(),n=null,i=0;i<this.members.length;i++){var o=this.members[i];if(null!=o&&3==o.type&&e!=o.getSex()){n=o;break}}if(null!=n)return SpriteHelper.createHouseTwoPeopleSprite(this,n)}return 0!=this.iconpet1?SpriteHelper.createPetSpriteByIcon(this.iconpet1,t):SpriteHelper.createSpriteByIcon(this.icon1,this.icon2,this.icon3,t)},e.fromBytes=function(t,e){e.setId(t.getInt()),e.setName(t.getString()),e.setInfo(t.getString()),e.setTitle(t.getString()),e.setLevel(t.getByte()),e.setLevel2(t.getByte()),e.setIcon1(t.getInt()),e.setIcon2(t.getInt()),e.setIcon3(t.getInt()),e.setSetting(t.getInt()),e.status=t.getInt(),e.setMode(t.getByte()),e.isShopMode()&&(e.shopName=t.getString(),e.setShoptype(t.getByte()));var n=t.getInt();e.setCountryId(n),n>=0&&(e.setCountryName(t.getString()),e.setCountryRank(t.getByte())),e.setPosition(t.getByte(),t.getByte()),e.vipLevel=t.getByte()},e.prototype.addValue=function(t,e){switch(t){case ModelConst.LEVEL:e>0&&(this.level=Tool.sumValue(this.level,e,0,120));break;case ModelConst.LEVEL2:e>0&&(this.level2=Tool.sumValue(this.level2,e,0,120));break;case ModelConst.ENCHANTVALUE:this.enchantValue+=e;break;case ModelConst.COUNTRY_RANK_SET:this.countryRank=e;break;case ModelConst.COUNTRY_ID_SET:this.countryId=e;break;case ModelConst.STATUS_SET:this.status=e}t==ModelConst.LEVEL&&PanelManager.mainMenu&&PanelManager.mainMenu.stage&&(this.id==GameWorld.getPlayerID()?PanelManager.mainMenu.updateRoleLevel():this.id==GameWorld.getMyPetID()&&PanelManager.mainMenu.updatePetLevel())},e.prototype.get=function(t){switch(t){case ModelConst.ID:return this.id;case ModelConst.SEX:return this.sex;case ModelConst.RACE:return this.race;case ModelConst.JOB:return this.job;case ModelConst.LEVEL:return this.level;case ModelConst.LEVEL2:return this.level2;case ModelConst.SETTING:return this.setting;case ModelConst.STATUS:return this.status;case ModelConst.COUNTRY_ID:return this.countryId;case ModelConst.COUNTRY_RANK:return this.countryRank;case ModelConst.PX:return this.x;case ModelConst.PY:return this.y}return 0},e.prototype.getIntValue1=function(){return this.intValue1},e.prototype.setIntValue1=function(t){this.intValue1=t},e.prototype.setBattleIntValue=function(t){for(var e=27;30>=e;e++){var n=1<<e;Tool.isBit(n,t)?this.intValue1|=n:this.intValue1&=~n}},e.prototype.setTabStatus=function(t,e){t?this.intValue1|=e:this.intValue1&=~e},e.prototype.isTabStatus=function(t){return 0!=(this.intValue1&t)},e.prototype.getLeaderID=function(){return this.leaderID},e.prototype.setLeaderID=function(t){this.leaderID=t},e.prototype.getMembers=function(){return this.members},e.prototype.isLeader=function(){return this.leaderID==this.id},e.prototype.isInTeam=function(){return this.leaderID>0},e.prototype.isMember=function(){return this.isInTeam()&&0==this.isLeader()},e.prototype.isPlayerTeam=function(){return 0!=this.isInTeam()&&!(this.isLeader()&&!this.isHasPlayerMember())},e.prototype.isHasPlayerMember=function(){if(null==this.members)return!1;for(var t=0;t<this.members.length;t++){var e=this.members[t];if(null!=e&&3==e.type)return!0}return!1},e.isSameTeam=function(t,e){return null!=t&&null!=e&&(!(t.getLeaderID()<=0||e.getLeaderID()<=0)&&t.getLeaderID()==e.getLeaderID())},e.prototype.getMemberById=function(t){if(null==this.members||this.members.length<=0)return!1;for(var e=0;e<this.members.length;e++){var n=this.members[e];if(3==n.getType()&&n.id==t)return!0}return!1},e.prototype.isTwoPeopleHouse=function(){var t=this.icon3>>e.OFFSET_TRANSPORT_ADD&e.LEN_TRANSPORT_ADD,n=this.icon3>>e.OFFSET_TRANSPORT_ADD_2&e.LEN_TRANSPORT_ADD_2;return 0==t&&0==n&&(this.icon3>>e.OFFSET_TRANSPORT_STYLE&e.LEN_TRANSPORT_STYLE)==GameSprite.HOUSE_TWO_PEOPLE},e.prototype.clearMemberHideStatus=function(){if(0!=this.isLeader()&&null!=this.members)for(var t=0,n=this.members.length;n>t;t++){var i=this.members[t];null!=i&&i.setTabStatus(!1,e.HIDE_SPIRTE)}},e.prototype.isPlayerLeader=function(){return this.isLeader()&&this.isHasPlayerMember()},e.prototype.clearMember=function(){if(this.setTabStatus(!1,e.HIDE_SPIRTE),null!=this.members&&this.members.length>0)for(var t=this.members.length-1;t>=0;t--){var n=this.members[t];null!=n?(5!=n.getType()||null==this.getMercenaryById(n.groupId))&&this.members.splice(t,1):this.members.splice(t,1)}(null==this.members||this.members.length<=0)&&(this.members=null,this.setLeaderID(-1),this.cleanLastMove())},e.prototype.removeMember=function(t,e){if(1==this.isMember())return!1;if(null!=this.members)for(var n=0;n<this.members.length;n++){var i=this.members[n];if(null!=i&&i.type==e){var o=0;if(3==i.type?o=i.id:5==i.type&&(o=i.groupId),o==t){this.members.splice(n,1),i.clearMember(),this.initFollowPos(),1==this.isTwoPeopleHouse()&&3==i.type&&this.refreshWorldSprite();break}}}return(null==this.members||this.members.length<=0)&&this.clearMember(),!0},e.prototype.addMember=function(t){if(null==t)return!1;if(3==t.type&&t.clearMercenary(),1==t.isInTeam())return!1;if(3==t.type&&t.getId()==this.getId())return!1;if(1==this.isMember())return!1;var e=!1;if(null!=this.members)for(var n=0;n<this.members.length;n++){var i=this.members[n];if(null!=i&&i.type==t.type&&(3==t.type&&i.getId()==t.getId()||5==t.type&&i.groupId==t.groupId)){e=!0;break}}1==e&&(3==t.type?this.removeMember(t.getId(),3):5==t.type&&this.removeMember(t.groupId,5)),null==this.members&&(this.members=[]),this.leaderID=this.id,t.leaderID=this.id;var o=null,a=this.members.length;return null!=(o=a>0?this.members[a-1]:this)&&(o.cleanLastMove(),t.setPos(o.x,o.y)),t.removeControlByType(Control.TYPE_MOVE_TO),this.members.push(t),this.isTwoPeopleHouse()&&this.getSex()!=t.getSex()&&3==t.type&&(null==this.sprite||this.sprite.getnameID()!=GameSprite.HOUSE_TWO_PEOPLE_SPRITE)&&this.refreshWorldSprite(),!0},e.prototype.removeControlByType=function(t){Control.removeControlByType(this.controlList,t)},e.checkEnoughMoney=function(t,e,n,i,o){var a=xself;if(null!=a){var r=new StringBuffer,s=!1,l=!0,_=!0,h=!0,u=a.get(ModelConst.MONEY1),c=a.get(ModelConst.MONEY2),T=a.get(ModelConst.MONEY3);if(0>(u-=t)){var p=GameText.STR_MODEL_MONEY_NOT_ENOUGHT;p=Tool.manageString(p,GameText.STR_MONEY1,!1),p=Tool.manageString(p,t+"");var d=Tool.manageString(GameText.STR_MODEL_MONEY_HAVE,a.get(ModelConst.MONEY1)+"",!1);r.append(p+d),!1,l=!1}var E="";if(0>(c-=e)){u+=c,s=!0;p=GameText.STR_MODEL_MONEY_NOT_ENOUGHT;if(p=Tool.manageString(p,GameText.STR_MONEY2,!1),p=Tool.manageString(p,PowerString.makeColorString(-c+GameText.STR_MONEY1,ColorUtils.COLOR_RED)),E=p+=GameText.STR_MODEL_MONEY2_REPLACE,c=0,0>u){p=GameText.STR_MODEL_MONEY_NOT_ENOUGHT;p=Tool.manageString(p,GameText.STR_MONEY2,!1),p=Tool.manageString(p,e+"",!1),p+=Tool.manageString(GameText.STR_MODEL_MONEY_HAVE,a.get(ModelConst.MONEY2)+""),r.append(p),!1,_=!1}}if(0>(T-=n)){p=GameText.STR_MODEL_MONEY_NOT_ENOUGHT;p=Tool.manageString(p,GameText.STR_MONEY3,!1),p=Tool.manageString(p,n+"",!1),p+=Tool.manageString(GameText.STR_MODEL_MONEY_HAVE,a.get(ModelConst.MONEY3)+""),r.append(p),!1,h=!1}if(0==l||0==_){return void AlertPanel.alert(GameText.STR_MODEL_MONEY_NOT_ENOUGHT_TI,r.toString()+GameText.STR_MODEL_BILL_ASK,(function(){UILayer.instance.popupLayer.removeChildren(),PayInfo.getPayList()}),this)}return 0==PlayerDataManager.isIngoreMoney1Alert()&&1==_&&1==s?void AlertPanel.alertWithCheckBox(GameText.STR_MODEL_MONEY2_NOT_ENOUGHT,E,"以后不再提示",(function(){null!=i&&null!=o&&i.call(o)}),null,(function(t){if(t){var e=PlayerDataManager.playerData;e.isIngoreMoney2=!0,PlayerDataManager.savePlayerData(e)}}),this):0==h?void AlertPanel.alertMaterialLess(r.toString(),ItemGet.Type_money3):void(null!=i&&null!=o&&i.call(o))}},e.prototype.checkSell=function(){this.mode==e.MODE_SHOP?this.showSellBox():this.removeSellBox()},e.prototype.showSellBox=function(){this.sellBox||(this.sellBox=new eui.Image,this.sellBox.addEventListener(egret.Event.COMPLETE,this.sellBoxOnLoad,this),this.sellBox.source="sell_box_hd"),this.sprite&&this.sprite.getRotate()?this.sellBox.scaleX=-1:this.sellBox.scaleX=1,this.addChild(this.sellBox)},e.prototype.sellBoxOnLoad=function(t){this.sellBox.removeEventListener(egret.Event.COMPLETE,this.sellBoxOnLoad,this),this.sellBox.anchorOffsetX=.5*this.sellBox.width,this.sellBox.anchorOffsetY=.5*this.sellBox.height},e.prototype.removeSellBox=function(){this.sellBox&&this.sellBox.parent&&this.sellBox.parent.removeChild(this.sellBox)},e.MODE_NORMAL=0,e.MODE_SHOP=1,e.MODE_BATTLE_LOCAL=50,e.MODE_BATTLE_REMOTE=51,e.MODE_BATTLE_PK=52,e.MODE_BATTLE_OB=53,e.START_HAIR=0,e.START_FACE=1e3,e.START_HAND=2e3,e.START_FEET=3e3,e.START_SHOULDER=4e3,e.START_BACK=5e3,e.START_CLOTHES=6e3,e.START_TROUSERS=7e3,e.START_WEAPON=8e3,e.START_HELMET=1e4,e.START_PET=12e3,e.START_TRANSPORT=14e3,e.START_FLASH=15e3,e.START_MINI_SPRITE=16e3,e.MAX_STORE_NUM=60,e.MAX_PLAYER_HP=9999999,e.MAX_PLAYER_MP=9999999,e.MAX_MOSTER_HP=5e6,e.MAX_BASE_ATTRIBUTE=32767,e.MAX_OTHER_ATTRIBUTE=1e6,e.MAX_DEF=1e6,e.MAX_PROBABILITY=100,e.MIN_HIT_RATE=30,e.MIN_HIT_MAGIC=20,e.MIN_FORCE_HITRATE=30,e.MAX_FORCE_RATE=70,e.MIN_HIT_TIME=1,e.MAX_HIT_TIME=99,e.MAX_ATK=99999999,e.MAX_KEEPOUT_ATK_TIME=1e4,e.MAX_OTHER_PROBABILITY=1e3,e.MIN_DEF_FIELD=-999999,e.MIN_HEAL_RECOVERY=-999999,e.MIN_MANA_RECOVERY=-999999,e.BIT_1=1,e.BIT_2=3,e.BIT_3=7,e.BIT_4=15,e.BIT_5=31,e.BIT_6=63,e.BIT_7=127,e.BIT_8=255,e.BIT_9=511,e.OFFSET_SEX=0,e.OFFSET_RACE=1,e.OFFSET_JOB=3,e.OFFSET_HAIR_STYLE=7,e.OFFSET_HAIR_COLOR=11,e.OFFSET_FACE_STYLE=13,e.OFFSET_HAND_STYLE=17,e.OFFSET_HAND_COLOR=19,e.OFFSET_FEET_STYLE=21,e.OFFSET_FEET_COLOR=23,e.OFFSET_HELMET_STYLE=25,e.OFFSET_HELMET_COLOR=30,e.OFFSET_SHOULDER_STYLE=0,e.OFFSET_SHOULDER_COLOR=4,e.OFFSET_LWEAPON_STYLE=6,e.OFFSET_LWEAPON_COLOR=14,e.OFFSET_RWEAPON_STYLE=16,e.OFFSET_RWEAPON_COLOR=24,e.OFFSET_VIP=26,e.OFFSET_WEAPON_FLASH=28,e.OFFSET_SHOULDER_ADD=31,e.OFFSET_BACK_STYLE=0,e.OFFSET_BACK_COLOR=4,e.OFFSET_CLOTHES_STYLE=6,e.OFFSET_CLOTHES_COLOR=12,e.OFFSET_TROUSERS_STYLE=14,e.OFFSET_TROUSERS_COLOR=20,e.OFFSET_TRANSPORT_STYLE=22,e.OFFSET_TRANSPORT_COLOR=26,e.OFFSET_BACK_ADD=28,e.OFFSET_TRANSPORT_ADD=29,e.OFFSET_FASH_ADD=30,e.OFFSET_TRANSPORT_ADD_2=31,e.OFFSET_PET_STYLE=0,e.OFFSET_PET_COLOR=6,e.OFFSET_LVUP_STYLE=8,e.LEN_PET_STYLE=e.BIT_6,e.LEN_PET_COLOR=e.BIT_2,e.LEN_LVUP_STYLE=e.BIT_4,e.LEN_SEX=e.BIT_1,e.LEN_RACE=e.BIT_2,e.LEN_JOB=e.BIT_4,e.LEN_HAIR_STYLE=e.BIT_4,e.LEN_HAIR_COLOR=e.BIT_2,e.LEN_FACE_STYLE=e.BIT_4,e.LEN_HAND_STYLE=e.BIT_2,e.LEN_HAND_COLOR=e.BIT_2,e.LEN_FEET_STYLE=e.BIT_2,e.LEN_FEET_COLOR=e.BIT_2,e.LEN_HELMET_STYLE=e.BIT_5,e.LEN_HELMET_COLOR=e.BIT_2,e.LEN_SHOULDER_STYLE=e.BIT_4,e.LEN_SHOULDER_COLOR=e.BIT_2,e.LEN_LWEAPON_STYLE=e.BIT_8,e.LEN_LWEAPON_COLOR=e.BIT_2,e.LEN_RWEAPON_STYLE=e.BIT_8,e.LEN_RWEAPON_COLOR=e.BIT_2,e.LEN_VIP=e.BIT_2,e.LEN_WEAPON_FLASH=e.BIT_3,e.LEN_SHOULDER_ADD=e.BIT_1,e.LEN_BACK_STYLE=e.BIT_4,e.LEN_BACK_COLOR=e.BIT_2,e.LEN_CLOTHES_STYLE=e.BIT_6,e.LEN_CLOTHES_COLOR=e.BIT_2,e.LEN_TROUSERS_STYLE=e.BIT_6,e.LEN_TROUSERS_COLOR=e.BIT_2,e.LEN_TRANSPORT_STYLE=e.BIT_4,e.LEN_TRANSPORT_COLOR=e.BIT_2,e.LEN_BACK_ADD=e.BIT_1,e.LEN_TRANSPORT_ADD=e.BIT_1,e.LEN_FASH_ADD=e.BIT_1,e.LEN_TRANSPORT_ADD_2=e.BIT_1,e.LONG_TROUSERS_IN_TRANSPORT=(7400-e.START_TROUSERS)/8+1,e.MAX_MERCENARY_MEMBER=2,e.MOVE_END_CHECK=1,e.LAST_MOVE_FILL=2,e.NPC_MISSION_LOAD=4,e.MOVE_NPC_WELCOME=8,e.MERCENARY_INFO=16,e.PET_INFO=32,e.DEL_STATUS=64,e.MONSTER_BOOK_INFO=128,e.PET_INNER_SHOW=256,e.OFFLINE_DOING=512,e.NPC_MISSION_DISPLAY=1024,e.NPC_MISSION_HIDE=2048,e.NPC_COUNTRY_BLOAD=4096,e.MAIL_NEW_NOTICE=8192,e.ATTR_NEW_NOTICE=16384,e.CHAT_NEW_NOTICE=32768,e.SPRITE_LOADING_NPC=65536,e.SELL_PLAYER_INFO_LOAD=1<<17,e.SELL_PLAYER_STORE_LOAD=1<<18,e.HIDE_SPIRTE=1<<19,e.HIDE_PHOTO_COMMAND=1<<20,e.SELL_PLAYER_STORE_VIP_LOAD=1<<21,e.BUFFER_DIE_1HP_CHECK=1<<27,e.BUFFER_DIE_FULLHP_CHECK=1<<28,e.BUFFER_DIE_DELAY_CHECK=1<<29,e.TAG_IS_KEEP_OUT=1<<30,e.COUNTRY_APPLY=1<<31,e}(egret.DisplayObjectContainer);__reflect(Model.prototype,"Model");var ComponentBase=function(t){function e(){var e=t.call(this)||this;return e.isNotClear=!1,e.clear_time=0,e._init=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.onAddToStage=function(t){this._init=!0,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.isNotClear||(this.clear_time=Define.default_clear_time)},e.prototype.onRemoveFromStage=function(t){this._init=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.isNotClear||(this.clear_time=Define.default_clear_time)},Object.defineProperty(e.prototype,"init",{get:function(){return this._init},set:function(t){this._init=t},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(ComponentBase.prototype,"ComponentBase"),eui.Component.prototype.$parseSkinName=function(){var t,e=this.skinName;if(e)if(e.prototype)t=new e;else if("string"==typeof e){var n,i=e.trim();if("<"==i.charAt(0))n=EXML.parse(i);else if(!(n=egret.getDefinitionByName(e)))return void(this.skinName=nato.findSkinByName(e));n&&(t=new n)}else t=e;this.setSkin(t)};var Player=function(t){function e(){var e=t.call(this,3)||this;return e.position=0,e.hpDisplay=0,e.mpDisplay=0,e.argo=0,e.exp2=0,e.expMax2=0,e.exp=0,e.expMax=0,e.hp=0,e.mp=0,e.cp=0,e.sp=0,e.str=0,e.con=0,e.agi=0,e.ilt=0,e.wis=0,e.money1=0,e.money2=0,e.money3=0,e.numBag=0,e.numStroe=0,e.countryHonor=0,e.cityId=0,e.killCount=0,e.Pkwincount=0,e.Pklosecount=0,e.masterFlag=0,e.totalOnline=0,e.integral=0,e.arenaPoint=0,e.arenaStutas=0,e.skyarenaPoint=0,e.partnerId=0,e.hpMax=0,e.mpMax=0,e.speed=0,e.atkMin=0,e.atkMax=0,e.atk_time=0,e.atk_str=0,e.atk_agi=0,e.atk_magic=0,e.def_str=0,e.def_agi=0,e.def_magic=0,e.dodge=0,e.hitrate=0,e.hitMagic=0,e.critical=0,e.forceHit=0,e.wil=0,e.tough=0,e.block=0,e.brkArmor=0,e.magic_penetration=0,e.insight=0,e.def_field=0,e.back=0,e.magic_back=0,e.life_absorption=0,e.mana_absorption=0,e.heal_recovery=0,e.mana_recovery=0,e.recovery=0,e.keepout_atk_time=0,e.weapon_damage_percent=0,e.titlePower1=0,e.titlePowerValue1=0,e.titlePower2=0,e.titlePowerValue2=0,e.power=0,e.powerValue=0,e.powerExpireTime=0,e.autoSkillID_Initiative=-1,e.skillList=[],e.formationList=[],e.formationSkill=null,e.powerX=0,e.countrypowerValue=0,e.fightPowerList=[],e.bStatus=0,e.autoMoveControlList=[],e}return __extends(e,t),e.prototype.isPower=function(){return!(255==this.power||this.power<=0)},Object.defineProperty(e.prototype,"isNovice",{get:function(){return this.get(ModelConst.LEVEL)<e.NOVICE_LEVEL},enumerable:!0,configurable:!0}),e.prototype.isNeverLearntSkill=function(){var t=this.skillList;return 2==t.length&&1==t[0].level&&1==t[1].level},e.prototype.setBag=function(t){this.bag=t},e.prototype.getMasterFlag=function(){return this.masterFlag==Define.MASTER_FLAG_MASTER?GameText.STR_LIST_DESC_RELATION_MASTER:this.masterFlag==Define.MASTER_FLAG_PRENTICE?GameText.STR_LIST_DESC_RELATION_PRENTICE:GameText.STR_LIST_NULL},e.prototype.isMaster=function(){return this.masterFlag==Define.MASTER_FLAG_MASTER},e.prototype.create=function(t){this.sprite=new GameSprite(this.icon1),this.sprite.create(t),this.addChild(this.sprite)},e.prototype.checkBattleMsgByName=function(t){null==t||t.trim().length<=0||(this.dialogAIFrame=new MessageFrame(t),this.dialogAIFrame.setDrawCount(30),this.dialogAIFrame.show(),this.dialogAIFrame.setScale(nato.mapRatio),this.dialogAIFrame.x=this.battleSprite.x-this.dialogAIFrame.width/2*xhdRatio,this.dialogAIFrame.y=this.battleSprite.y-(this.battleSprite.getHeight()+this.dialogAIFrame.height)*xhdRatio,BattleView.instance.addChild(this.dialogAIFrame))},e.prototype.removeBattleMsg=function(){this.dialogAIFrame&&this.dialogAIFrame.parent&&this.dialogAIFrame.parent.removeChild(this.dialogAIFrame),this.dialogAIFrame=null},e.prototype.setWaitStatus=function(t){this.isWaitStatus=t},e.prototype.drawWaitStatus=function(){if(0!=this.isWaitStatus){var t=e.getOKImage();e.okImageCurrentlyUsed.push(t);var n=BattleView.instance,i=this.position,o=n.getPosition(i,BattleView.COORD_X),a=n.getPosition(i,BattleView.COORD_Y);t.x=o,t.y=a,t.scaleX=xhd?2:1,t.scaleY=xhd?2:1,n.addChild(t)}},e.recycleOKImage=function(){for(;e.okImageCurrentlyUsed.length>0;){var t=e.okImageCurrentlyUsed.pop();t&&t.parent&&t.parent.removeChild(t),e.okImagePool.push(t)}},e.getOKImage=function(){var t;return e.okImagePool.length>0?((t=e.okImagePool.pop()).texture=nato.findTextureForSheet(ImageSet.IMG_SET_BATTLE_OK),t):((t=new egret.Bitmap).texture=nato.findTextureForSheet(ImageSet.IMG_SET_BATTLE_OK),t)},e.prototype.isDead=function(){return this.hp<=0},e.prototype.isDeadDelay=function(){return this.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_DIE_DELAY))&&!this.isTabStatus(Model.BUFFER_DIE_DELAY_CHECK)},e.prototype.isDeadNoWithDelay=function(){return this.isDead()&&!this.isDeadDelay()},e.prototype.resetBattleBuffer=function(){this.bStatus=0,this.battleBufferList=null,this.argo=0,this.hpMax=0,this.mpMax=0,this.speed=0,this.atk_str=0,this.atk_agi=0,this.atk_magic=0,this.atk_time=0,this.def_str=0,this.def_agi=0,this.def_magic=0,this.dodge=0,this.hitrate=0,this.hitMagic=0,this.critical=0,this.forceHit=0,this.wil=0,this.tough=0,this.block=0,this.brkArmor=0,this.insight=0,this.def_field=0,this.back=0,this.magic_back=0,this.life_absorption=0,this.mana_absorption=0,this.magic_penetration=0,this.heal_recovery=0,this.mana_recovery=0,this.recovery=0,this.keepout_atk_time=0,this.setTabStatus(!1,Model.BUFFER_DIE_1HP_CHECK),this.setTabStatus(!1,Model.BUFFER_DIE_FULLHP_CHECK),this.setTabStatus(!1,Model.BUFFER_DIE_DELAY_CHECK)},e.prototype.clearBufferList=function(t){if(null!=this.battleBufferList){for(var e=this.battleBufferList.length-1;e>=0;e--){var n=this.battleBufferList[e];if(null!=n&&(0!=t||!n.isCannotReliveStatus())){n.destroy(this);var i=this.battleBufferList.indexOf(n);this.battleBufferList.splice(i,1),this.clearBattleStatus(Define.getBufferBitValue(n.getStatus()))}}this.battleBufferList.length<=0&&(this.battleBufferList=null)}},e.prototype.doKeepAtkTime=function(t){if(this.addValue(ModelConst.KEEPOUT_ATK_TIME,-1),null!=this.battleBufferList)for(var e=this.battleBufferList.length-1;e>=0;e--){var n=this.battleBufferList[e];if(null!=n&&n.useKeeAtkTime())return}},e.prototype.addBuffer=function(t){if(null!=t)if(null==this.battleBufferList&&(this.battleBufferList=[]),t.isClearStatusBitBuffer())this.battleBufferList.unshift(t);else{var e=this.setBattleStatus(Define.getBufferBitValue(t.getStatus()));0==e?t.clearStatus():this.checkBufferSize(t),this.battleBufferList.push(t),e&&this.setBattleStatus(Define.getBufferBitValue(t.getStatus()))}},e.prototype.checkBufferSize=function(t){if(t.getStatus()!=Define.BUFFER_NONE){for(var e=0,n=Define.BUFFER_NONE,i=this.battleBufferList.length-1;i>=0;i--){if(null!=(a=this.battleBufferList[i])&&a.getStatus()!=Define.BUFFER_NONE)if(t.isDieStatus()&&a.isDieStatus()){this.clearBattleStatus(Define.getBufferBitValue(a.getStatus())),a.destroy(this);var o=this.battleBufferList.indexOf(a);this.battleBufferList.splice(o,1)}else if(Define.getBufferType(a.getStatus())==Define.getBufferType(t.getStatus())&&++e>=PlayerBuffer.MAX_SIZE){n=a.getStatus(),a.destroy(this);o=this.battleBufferList.indexOf(a);this.battleBufferList.splice(o,1);break}}if(n!=Define.BUFFER_NONE){for(i=0;i<this.battleBufferList.length;i++){var a;if(null!=(a=this.battleBufferList[i])&&a.getStatus()==n)return}this.clearBattleStatus(Define.getBufferBitValue(n))}}},e.prototype.removeBufferByStatus=function(t){if(null!=this.battleBufferList)for(var e=this.battleBufferList.length-1;e>=0;e--){var n=this.battleBufferList[e];if(null!=n)if(n.isSameStatusType(t)){n.destroy(this);var i=this.battleBufferList.indexOf(n);this.battleBufferList.splice(i,1),this.clearBattleStatus(Define.getBufferBitValue(n.getStatus()))}}},e.prototype.runBufferList=function(t){if(null==this.battleBufferList)return null;for(var e=[],n=[],i=0;i<this.battleBufferList.length;i++){if(null!=(l=this.battleBufferList[i]))if(t){if(l.run(this,e),null==this.battleBufferList)return e;if(l.isClearStatusBitBuffer())for(var o=i+1;o<this.battleBufferList.length;o++){var a=this.battleBufferList[o];null!=a&&a.isSameStatusType(l.getAddValue())&&(a.finish(),n.push(a))}}else l.getLastTime()<=0&&n.push(l)}var r=n.length;if(0>=r)return e;for(i=0;r>i;i++){(l=n[i]).destroy(this);var s=this.battleBufferList.indexOf(l);this.battleBufferList.splice(s,1),this.clearBattleStatus(Define.getBufferBitValue(l.getStatus()))}for(i=0;i<this.battleBufferList.length;i++){var l;null!=(l=this.battleBufferList[i])&&this.setBattleStatus(Define.getBufferBitValue(l.getStatus()))}return e},e.prototype.getAttakAnimePos=function(){var t=this.getEquipWeaponType();return t==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW||t==Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW||t==Define.ITEM_TYPE_WEAPON_TWOHAND_BOW||t==Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF||t==Define.ITEM_TYPE_WEAPON_BALL||t==Define.ITEM_TYPE_WEAPON_ONEHAND_GUN||t==Define.ITEM_TYPE_WEAPON_TWOHAND_GUN?Define.SKILL_POS_STAND:BattleConst.SKILL_POS_FRONT},e.prototype.getAttackRangeAnime=function(){var t=this.getEquipWeaponType();return t==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW||t==Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW?GameSprite.SPR_INDEX_EFF_START+GameSprite.EFF_RANGE:0},e.setItemSetDataKey=function(t,e){return(4095&t)<<4|15&e},e.getItemSetID=function(t){return t>>4&4095},e.getItemSetNum=function(t){return 15&t},e.prototype.fromItemSetData=function(t){var e=t.getByte();this.itemSetData=[];for(var n=0;e>n;n++)this.itemSetData[n]=t.getShort()},e.prototype.getFreeSkillIndex=function(t){if(null==this.skillList)return-1;if(0>=t)return-1;this.getSkillByID(t);return Define.SUCCESS},e.prototype.learnSkill=function(t){if(null==t)return-1;if(null==this.skillList)return-1;if(this.getFreeSkillIndex(t.id)<0)return-3;if(0==this.skillList.length)return this.skillList.push(t),Define.SUCCESS;for(var e=0;e<this.skillList.length;e++){var n=this.skillList[e];if(null!=n&&n.id==t.id)return this.skillList[e]=t,Define.SUCCESS}return this.skillList.push(t),Define.SUCCESS},e.prototype.fromSkillData=function(t){if(null!=t){for(var e=t.getByte(),n=0;e>n;n++){var i=t.getByte();if(1==i){var o=Skill.fromBytes(t);o.addLevel=t.getByte(),this.learnSkill(o)}else if(2==i){var a=Skill.fromBytes(t);a.addLevel=t.getByte(),this.learnSkill(a)}else if(3==i){var r=t.getInt();this.removeSkill(this.getSkillByID(r))}}var s=t.getByte();this.autoSkillID=new Array(s);for(n=0;s>n;n++)this.autoSkillID[n]=t.getShort();this.autoSkillID_Initiative=t.getShort()}},e.prototype.fromAutoEquipSkillData=function(t){if(null!=t){var e=t.getByte();this.autoSkillID=new Array(e);for(var n=0;e>n;n++)this.autoSkillID[n]=t.getShort();this.autoSkillID_Initiative=t.getShort()}},e.prototype.removeSkill=function(t){if(null!=t&&!(null==this.skillList||this.skillList.length<=0))for(var e=0;e<this.skillList.length;e++){var n=this.skillList[e];if(null!=n&&n.id==t.id&&n.level==t.level)return this.isAutoSkill(n.id)>=0&&this.setAutoSkillInvalid(n.id),void this.skillList.splice(e,1)}},e.prototype.removeSkillSure=function(t){if(null!=t&&!(null==this.skillList||this.skillList.length<=0))for(var e=0;e<this.skillList.length;e++){var n=this.skillList[e];if(null!=n&&n.id==t.id)return this.isAutoSkill(n.id)>=0&&this.setAutoSkillInvalid(n.id),void this.skillList.splice(e,1)}},e.prototype.getSkillByID=function(t){if(null==this.skillList)return null;for(var e=0;e<this.skillList.length;e++){var n=this.skillList[e];if(null!=n&&n.id==t)return n}return null},e.prototype.getSkillIndexByID=function(t){if(null==this.skillList)return-1;for(var e=0;e<this.skillList.length;e++){var n=this.skillList[e];if(null!=n&&n.id==t)return e}return-1},e.prototype.getSkillLevelByID=function(t){var e=this.getSkillByID(t);return null==e?0:e.level-e.addLevel},e.getSkillListByType=function(t,e){if(null==t||t.length<=0)return null;for(var n=[],i=0;i<t.length;i++){var o=t[i];null!=o&&o.type==e&&n.push(o)}return n},e.prototype.setAutoSkillActive=function(t){if(null==this.autoSkillID)return-2;for(var e=0;e<this.autoSkillID.length;e++){if(0==this.autoSkillID[e])return this.autoSkillID[e]=t,e}return-1},e.prototype.setAutoSkillInvalid=function(t){if(null==this.autoSkillID)return-2;for(var e=-1,n=!1,i=0;i<this.autoSkillID.length;i++){this.autoSkillID[i]==t&&(n=!0,e=i,this.autoSkillID[i]=0),1==n&&(i<this.autoSkillID.length-1?this.autoSkillID[i]=this.autoSkillID[i+1]:this.autoSkillID[i]=0)}return e},e.prototype.isAutoSkill=function(t){for(var e=0;e<this.autoSkillID.length;e++){if(this.autoSkillID[e]==t)return e}return-1},e.prototype.getAutoSkillCount=function(){for(var t=0,e=0;e<this.autoSkillID.length;e++)this.autoSkillID[e]>0&&t++;return t},e.prototype.resumeHPMP=function(){this.hp=this.get(ModelConst.HPMAX),this.mp=this.get(ModelConst.MPMAX)},e.prototype.checkHPMP=function(){var t=this.get(ModelConst.HPMAX);this.hp>t&&(this.hp=t);var e=this.get(ModelConst.MPMAX);this.mp>e&&(this.mp=e)},e.prototype.get=function(e){var n=0;switch(e){case ModelConst.INTEGRAL:return this.integral;case ModelConst.EXP:return this.exp;case ModelConst.EXP2:return this.exp2;case ModelConst.EXPMAX:return this.expMax;case ModelConst.EXPMAX2:return this.expMax2;case ModelConst.HP:return this.hp;case ModelConst.HP_DISPLAY:return this.hpDisplay;case ModelConst.MP:return Math.floor(this.mp);case ModelConst.MP_DISPLAY:return this.mpDisplay;case ModelConst.CP:return this.cp;case ModelConst.SP:return this.sp;case ModelConst.STR:return n=this.str,n=this.getBaseValue(n,Define.POWER_STR,Define.POWER_STR_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE),Math.floor(n);case ModelConst.CON:return n=this.con,n=this.getBaseValue(n,Define.POWER_CON,Define.POWER_CON_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE),Math.floor(n);case ModelConst.AGI:return n=this.agi,n=this.getBaseValue(n,Define.POWER_AGI,Define.POWER_AGI_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE),Math.floor(n);case ModelConst.ILT:return n=this.ilt,n=this.getBaseValue(n,Define.POWER_ILT,Define.POWER_ILT_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE),Math.floor(n);case ModelConst.WIS:return n=this.wis,n=this.getBaseValue(n,Define.POWER_WIS,Define.POWER_WIS_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE),Math.floor(n);case ModelConst.MONEY1:return this.money1;case ModelConst.MONEY2:return this.money2;case ModelConst.MONEY3:return this.money3;case ModelConst.NUM_STROE:return this.numStroe;case ModelConst.COUNTRY_HONOR:return this.countryHonor;case ModelConst.CITY_ID:return this.cityId;case ModelConst.KILL_COUNT:return this.killCount;case ModelConst.PK_WIN_COUNT:return this.Pkwincount;case ModelConst.PK_LOSE_COUNT:return this.Pklosecount;case ModelConst.TOTAL_ONLINE:return this.totalOnline;case ModelConst.PARTNER_ID:return this.partnerId;case ModelConst.HPMAX:var i=this.get(ModelConst.LEVEL)+this.get(ModelConst.LEVEL2);return n=Math.floor(65*this.get(ModelConst.CON)/10)+3*this.get(ModelConst.STR)+100+40*(i-1),n=this.getPowerValue(n,this.hpMax,Define.POWER_HPMAX,Define.POWER_HPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_HP),Math.floor(n);case ModelConst.MPMAX:var o=this.get(ModelConst.LEVEL)+this.get(ModelConst.LEVEL2);return n=Math.floor(75*this.get(ModelConst.ILT)/10)+Math.floor(35*this.get(ModelConst.WIS)/10)+50+10*(o-1),n=this.getPowerValue(n,this.mpMax,Define.POWER_MPMAX,Define.POWER_MPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_MP),Math.floor(n);case ModelConst.SPEED:return n=3*this.get(ModelConst.AGI)+Math.floor(15*this.get(ModelConst.WIS)/10),n=this.getPowerValue(n,this.speed,Define.POWER_SPEED,Define.POWER_SPEED_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.ATK_TYPE:return null==this.bag?Define.ATKTYPE_STR:this.bag.getAttribute(8);case ModelConst.LEFT_WEAPON_TYPE:return null==this.bag?-1:this.bag.getAttributeByPos(9,PlayerBag.WEAPON_LEFT_POS);case ModelConst.RIGHT_WEAPON_TYPE:return null==this.bag?-1:this.bag.getAttributeByPos(9,PlayerBag.WEAPON_RIGHT_POS);case ModelConst.LEFT_ATK_MIN:return this.bag&&(0>(n=this.bag.getAttributeByPos(5,PlayerBag.WEAPON_LEFT_POS))&&(n=0),n=this.addWeaponSkillDamageOrDur(n,PlayerBag.WEAPON_LEFT_POS)),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.RIGHT_ATK_MIN:return this.bag&&(0>(n=this.bag.getAttributeByPos(5,PlayerBag.WEAPON_RIGHT_POS))&&(n=0),n=this.addWeaponSkillDamageOrDur(n,PlayerBag.WEAPON_RIGHT_POS)),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.ATK_MIN:var a=this.get(ModelConst.LEFT_ATK_MIN),r=this.get(ModelConst.RIGHT_ATK_MIN);return r>(n=a)&&(n=r),Math.floor(n);case ModelConst.LEFT_ATK_MAX:return this.bag&&(0>(n=this.bag.getAttributeByPos(6,PlayerBag.WEAPON_LEFT_POS))&&(n=0),n=this.addWeaponSkillDamageOrDur(n,PlayerBag.WEAPON_LEFT_POS)),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.RIGHT_ATK_MAX:return this.bag&&(0>(n=this.bag.getAttributeByPos(6,PlayerBag.WEAPON_RIGHT_POS))&&(n=0),n=this.addWeaponSkillDamageOrDur(n,PlayerBag.WEAPON_RIGHT_POS)),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.ATK_MAX:var s=this.get(ModelConst.LEFT_ATK_MAX),l=this.get(ModelConst.RIGHT_ATK_MAX);return l>(n=s)&&(n=l),Math.floor(n);case ModelConst.LEFT_ATK_TIME:return this.bag&&0>(n=this.bag.getAttributeByPos(7,PlayerBag.WEAPON_LEFT_POS))?0:Tool.sumValue(n+1,0,ModelConst.MIN_HIT_TIME,ModelConst.MAX_HIT_TIME);case ModelConst.RIGHT_ATK_TIME:return this.bag&&0>(n=this.bag.getAttributeByPos(7,PlayerBag.WEAPON_RIGHT_POS))?0:Tool.sumValue(n+1,0,ModelConst.MIN_HIT_TIME,ModelConst.MAX_HIT_TIME);case ModelConst.ATK_TIME:var _=this.getEquipWeaponType();return _==Define.BACK_ERROR_NULL_HAND?(n=1,n+=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HAND_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_HAND_ATK_TIME,!0)):n=this.get(ModelConst.LEFT_ATK_TIME)+this.get(ModelConst.RIGHT_ATK_TIME),n=this.addWeaponSkillAtkTime(n,_),Tool.sumValue(n,this.atk_time,ModelConst.MIN_HIT_TIME,ModelConst.MAX_HIT_TIME);case ModelConst.ATK_STR:return n=3*this.get(ModelConst.AGI)+5*this.get(ModelConst.STR),n=this.getPowerValue(n,this.atk_str,Define.POWER_ATK_STR,Define.POWER_ATK_STR_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE,!0),Math.floor(n);case ModelConst.ATK_AGI:return n=5*this.get(ModelConst.STR)+5*this.get(ModelConst.AGI),n=this.getPowerValue(n,this.atk_agi,Define.POWER_ATK_AGI,Define.POWER_ATK_AGI_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE,!0),Math.floor(n);case ModelConst.ATK_MAGIC:var h=(3*this.get(ModelConst.ILT)+2*this.get(ModelConst.WIS))*(this.get(ModelConst.HIT_MAGIC)+900);return n=(h=GZIP.toInteger(h))/1e3>>0,n=this.getPowerValue(n,this.atk_magic,Define.POWER_ATK_MAGIC,Define.POWER_ATK_MAGIC_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.DEF_STR:return n=8*this.get(ModelConst.CON),this.bag&&(n+=this.bag.getAttribute(1)),n=this.getPowerValue(n,this.def_str,Define.POWER_DEF_STR,Define.POWER_DEF_STR_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_DEF),Math.floor(n);case ModelConst.DEF_AGI:return n=8*this.get(ModelConst.CON),this.bag&&(n+=this.bag.getAttribute(2)),n=this.getPowerValue(n,this.def_agi,Define.POWER_DEF_AGI,Define.POWER_DEF_AGI_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_DEF),Math.floor(n);case ModelConst.DEF_MAGIC:return n=2*(2*this.get(ModelConst.WIS)+this.get(ModelConst.ILT)),this.bag&&(n+=this.bag.getAttribute(3)),n=this.getPowerValue(n,this.def_magic,Define.POWER_DEF_MAGIC,Define.POWER_DEF_MAGIC_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_DEF),Math.floor(n);case ModelConst.DODGE:return n=10*(this.get(ModelConst.AGI)+this.get(ModelConst.WIS))/25,n=this.getPowerValue(n,this.dodge,Define.POWER_DODGE,Define.POWER_DODGE_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.HIT_RATE:if(this.bag){0>(n=this.bag.getAttributeByPos(4,PlayerBag.WEAPON_LEFT_POS))&&(n=0);var u=this.bag.getAttributeByPos(4,PlayerBag.WEAPON_RIGHT_POS);u>0&&(n>0?n>u&&(n=u):n=u),n+=this.get(ModelConst.AGI)/5}return n=this.getPowerValue(n,this.hitrate,Define.POWER_HITRATE,Define.POWER_HITRATE_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.HIT_MAGIC:return n=100,n=this.getPowerValue(n,this.hitMagic,Define.POWER_MAGIC_HITRATE,Define.POWER_MAGIC_HITRATE_PERCENT,Define.SKILL_TYPE_PASSIVE,ModelConst.MIN_HIT_MAGIC,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.CRITICAL:return n=0,n=this.getPowerValue(n,this.critical,Define.POWER_CRITICAL,Define.POWER_CRITICAL_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.FORCE_HIT:return n=Model.MIN_FORCE_HITRATE,n=this.getPowerValue(n,this.forceHit,Define.POWER_HIT_FORCE,Define.POWER_HIT_FORCE_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.EXP_UP:return this.exp_up;case ModelConst.WIL:return n=(3*this.get(ModelConst.WIS)+this.get(ModelConst.ILT))/10,n=this.getPowerValue(n,this.wil,Define.POWER_WIL,Define.POWER_WIL_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.TOUGH:return n=(2*this.get(ModelConst.CON)+this.get(ModelConst.STR))/10,n=this.getPowerValue(n,this.tough,Define.POWER_TOUGH,Define.POWER_TOUGH_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.BLOCK:return n=this.get(ModelConst.AGI)/5,n=this.getPowerValue(n,this.block,Define.POWER_BLOCK,Define.POWER_BLOCK_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.BRK_ARMOR:return n=this.get(ModelConst.AGI)+3*this.get(ModelConst.STR),n=this.getPowerValue(n,this.brkArmor,Define.POWER_PENETRATION,Define.POWER_PENETRATION_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.MAGIC_PENETRATION:return n=this.get(ModelConst.WIS)+2*this.get(ModelConst.ILT),n=this.getPowerValue(n,this.magic_penetration,Define.POWER_MAGIC_PENETRATION,Define.POWER_MAGIC_PENETRATION_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.INSIGHT:return n=(2*this.get(ModelConst.WIS)+this.get(ModelConst.ILT))/10,n=this.getPowerValue(n,this.insight,Define.POWER_INSIGHT,Define.POWER_INSIGHT_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.DEF_FIELD:return n=2*this.get(ModelConst.ILT)+3*this.get(ModelConst.WIS),n=this.getPowerValue(n,this.def_field,Define.POWER_DEF_FIELD,Define.POWER_DEF_FIELD_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.BACK:return n=0,n=this.getPowerValue(n,this.back,Define.POWER_BACK,Define.POWER_BACK_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.MAGIC_BACK:return n=0,n=this.getPowerValue(n,this.magic_back,Define.POWER_MAGIC_BACK,Define.POWER_MAGIC_BACK_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.LIFE_ABSORPTION:return n=0,n=this.getPowerValue(n,this.life_absorption,Define.POWER_LIFE_ABSORPTION,Define.POWER_LIFE_ABSORPTION_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_PROBABILITY),Math.floor(n);case ModelConst.MANA_ABSORPTION:return n=0,n=this.getPowerValue(n,this.mana_absorption,Define.POWER_MANA_ABSORPTION,Define.POWER_MANA_ABSORPTION_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_PROBABILITY),Math.floor(n);case ModelConst.HEAL_RECOVERY:return n=0,n=this.getPowerValue(n,this.heal_recovery,Define.POWER_HEAL_RECOVERY,Define.POWER_HEAL_RECOVERY_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.MANA_RECOVERY:return n=0,n=this.getPowerValue(n,this.mana_recovery,Define.POWER_MANA_RECOVERY,Define.POWER_MANA_RECOVERY_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_BACK:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_BACK,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_MAGIC_BACK:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_MAGIC_BACK,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_BLOCK:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_BLOCK,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_INSIGHT:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_INSIGHT,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_WIL:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_WIL,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.IGNORE_TOUCH:return n=0,n=this.getPowerValue(n,0,Define.POWER_IGNORE_TOUCH,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE),Math.floor(n);case ModelConst.KEEPOUT_ATK_TIME:return n=0,n=this.getPowerValue(n,this.keepout_atk_time,Define.POWER_KEEPOUT_ATK_TIME,0,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_KEEPOUT_ATK_TIME),Math.floor(n);case ModelConst.RECOVERY:return this.recovery;case ModelConst.ARGO:return this.argo;case ModelConst.BACK_MAX:return 70;default:return t.prototype.get.call(this,e)}},e.prototype.getOld=function(e){var n=0;switch(e){case ModelConst.HPMAX:var i=this.get(ModelConst.LEVEL);return n=65*this.get(ModelConst.CON)/10+3*this.get(ModelConst.STR)+100+40*(i-1),this.getPowerValue(n,this.hpMax,Define.POWER_HPMAX,Define.POWER_HPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_HP);case ModelConst.MPMAX:var o=this.get(ModelConst.LEVEL);return n=75*this.get(ModelConst.ILT)/10+35*this.get(ModelConst.WIS)/10+50+10*(o-1),this.getPowerValue(n,this.mpMax,Define.POWER_MPMAX,Define.POWER_MPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_MP);default:return t.prototype.get.call(this,e)}},e.prototype.getVipLevel=function(){return this.vipLevel},e.prototype.getAttackTypeBySkill=function(t){return t&&t!=Skill.DUMMY_SKILL?t.skillAtkType:this.get(ModelConst.ATK_TYPE)},e.prototype.getBagEquipPowerValue=function(t,n){if(void 0===n&&(n=!1),null==this.bag)return 0;var i=this.bag.getEquipPowerValue(t);if(this.itemSetData)for(var o=void 0,a=void 0,r=void 0,s=void 0,l=void 0,_=0;_<this.itemSetData.length;)o=this.itemSetData[_++],a=this.itemSetData[_++],r=this.itemSetData[_++],a==t&&(s=e.getItemSetID(o),l=e.getItemSetNum(o),this.bag.getEquipItemSetNum(s)<l||(i+=r));return n&&(i+=this.getPowerValueByBuffer(t)),i},e.prototype.isHasCountrypower=function(){return this.countrypowerValue>0},e.prototype.clearFightPower=function(){this.fightPowerList=[]},e.prototype.addFightPower=function(t,e){var n=[t,e];this.fightPowerList.push(n)},e.prototype.getPowerValueByBuffer=function(t){var e=0;this.power==t&&(e+=this.powerValue),this.titlePower1==t&&(e+=this.titlePowerValue1),this.titlePower2==t&&(e+=this.titlePowerValue2);for(var n=0;n<this.fightPowerList.length;n++){var i=this.fightPowerList[n];i[0]==t&&(e+=i[1])}return e+this.getCountryBuffer(t)},e.prototype.getCountryBuffer=function(t){return t==Define.POWER_STR_PERCENT||t==Define.POWER_CON_PERCENT||t==Define.POWER_AGI_PERCENT||t==Define.POWER_ILT_PERCENT||t==Define.POWER_WIS_PERCENT?this.countrypowerValue:0},e.prototype.getExportPower=function(t){var e=0;return e+=this.getPowerValueByBuffer(t),this.formationSkill&&(e+=this.formationSkill.getPowerValue(t)),null!=this.playerTurnMonster&&(e+=this.playerTurnMonster.getPowerValue(t)),e},e.prototype.getPowerPercent=function(t){var e=0;return e+=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,t),e+=this.getPowerValueByBuffer(t),e+=this.getBagEquipPowerValue(t),this.formationSkill&&(e+=this.formationSkill.getPowerValue(t)),null!=this.playerTurnMonster&&(e+=this.playerTurnMonster.getPowerValue(t)),e},e.prototype.getBaseValue=function(t,e,n,i,o,a){var r=t;r+=this.getSkillPowerValue(i,e);var s=this.getSkillPowerValue(i,n);return s+=this.getBagEquipPowerValue(n),r+=this.getPowerValueByBuffer(e),s+=this.getPowerValueByBuffer(n),this.formationSkill&&(r+=this.formationSkill.getPowerValue(e),s+=this.formationSkill.getPowerValue(n)),null!=this.playerTurnMonster&&(r+=this.playerTurnMonster.getPowerValue(e),s+=this.playerTurnMonster.getPowerValue(n)),r+=Math.floor(r*s/100),r+=this.getBagEquipPowerValue(e),Tool.sumValue(r,0,o,a)},e.prototype.getPowerValue=function(t,e,n,i,o,a,r,s){void 0===s&&(s=!1);var l=t;l+=this.getSkillPowerValue(o,n);var _=this.getSkillPowerValue(o,i);return l+=this.getPowerValueByBuffer(n),_+=this.getPowerValueByBuffer(i),this.bag&&(l+=this.getBagEquipPowerValue(n),_+=this.getBagEquipPowerValue(i)),this.formationSkill&&(l+=this.formationSkill.getPowerValue(n),_+=this.formationSkill.getPowerValue(i)),null!=this.playerTurnMonster&&(l+=this.playerTurnMonster.getPowerValue(n),_+=this.playerTurnMonster.getPowerValue(i)),s&&this.getEquipWeaponType()==Define.BACK_ERROR_NULL_HAND&&(this.bag&&(_+=this.getBagEquipPowerValue(Define.POWER_HAND_PERCENT)),_+=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HAND_PERCENT)),l+=l*_/100>>0,Tool.sumValue(l,e,a,r)},e.prototype.addWeaponSkillDamageOrDur=function(t,e){if(0==t)return 0;var n=null;if(this.bag&&(n=this.bag.getItem(e)),null==n)return t;var i=0;switch(n.type){case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:case Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_SWORD_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_SWORD_PERCENT);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:case Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BLADE_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_BLADE_PERCENT);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HEAVY_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_HEAVY_PERCENT);break;case Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_STAFF_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_STAFF_PERCENT);break;case Define.ITEM_TYPE_WEAPON_BALL:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BALL_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_BALL_PERCENT);break;case Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_LANCE_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_LANCE_PERCENT);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_BOW:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BOW_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_BOW_PERCENT);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HAND_ITEM_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_HAND_ITEM_PERCENT);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:case Define.ITEM_TYPE_WEAPON_TWOHAND_GUN:i=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_GUN_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_GUN_PERCENT);break;default:i=0}return i+=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_ALL_PERCENT),i+=this.getBagEquipPowerValue(Define.POWER_ALL_PERCENT),0==(i+=this.weapon_damage_percent)?t:t+Math.floor(t*i/100)},e.prototype.addWeaponSkillAtkTime=function(t,e){var n=0;switch(e){case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:case Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_SWORD_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_SWORD_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:case Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BLADE_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_BLADE_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HEAVY_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_HEAVY_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_STAFF_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_STAFF_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_BALL:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BALL_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_BALL_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_LANCE_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_LANCE_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_BOW:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_BOW_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_BOW_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_HAND_ITEM_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_HAND_ITEM_ATK_TIME,!0);break;case Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:case Define.ITEM_TYPE_WEAPON_TWOHAND_GUN:n=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_GUN_ATK_TIME),n+=this.getBagEquipPowerValue(Define.POWER_GUN_ATK_TIME,!0);break;default:n=0}return n+=this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_ALL_ATK_TIME),t+(n+=this.getBagEquipPowerValue(Define.POWER_ALL_ATK_TIME,!0))},e.prototype.isEquipItemByIdInEquip=function(t){return null!=this.bag&&this.bag.isEquipItemByIdInEquip(t)},e.prototype.getEquipWeaponType=function(){if(null==this.bag)return Define.BACK_ERROR_NULL_HAND;for(var t=[PlayerBag.WEAPON_LEFT_POS,PlayerBag.WEAPON_RIGHT_POS],e=0;e<t.length;e++){var n=this.bag.getItem(t[e]);if(null!=n&&!(n.durability<=0)&&n.type!=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND)return n.type}return Define.BACK_ERROR_NULL_HAND},e.prototype.getSkillPowerValue=function(t,e){if(0>=e)return 0;var n=0;if(null==this.skillList||0==this.skillList.length)return n;for(var i=null,o=0;o<this.skillList.length;o++)null!=(i=this.skillList[o])&&i.type==t&&(n+=i.getPowerValue(e));return n},e.fromBytes=function(t,e){e.setId(t.getInt()),e.setName(t.getString()),e.setInfo(t.getString()),e.setTitle(t.getString()),e.setSex(t.getByte()),e.setRace(t.getByte()),e.setJob(t.getByte()),e.setLevel(t.getByte()),e.setLevel2(t.getByte()),e.exp2=t.getInt(),e.expMax2=t.getInt(),e.setIcon1(t.getInt()),e.setIcon2(t.getInt()),e.setIcon3(t.getInt()),e.setSetting(t.getInt()),e.status=t.getInt(),e.setMode(t.getByte());var n=t.getInt();e.setCountryId(n),n>=0&&(e.setCountryName(t.getString()),e.setCountryRank(t.getByte())),e.exp=t.getInt(),e.expMax=t.getInt(),e.hp=t.getInt(),e.mp=t.getInt(),e.cp=t.getShort(),e.sp=t.getInt(),e.str=t.getShort(),e.con=t.getShort(),e.agi=t.getShort(),e.ilt=t.getShort(),e.wis=t.getShort(),e.money1=t.getInt(),e.money2=t.getInt(),e.money3=t.getInt(),e.numBag=t.getByte(),e.numStroe=t.getByte(),e.countryHonor=t.getInt(),e.cityId=t.getInt(),e.killCount=t.getInt(),e.Pkwincount=t.getInt(),e.Pklosecount=t.getInt(),e.masterFlag=t.getByte(),e.partnerId=t.getInt(),e.partnerId>=0&&(e.partnerName=t.getString()),e.helpCountry=t.getString(),e.lovePlayer=t.getString(),e.integral=t.getInt(),e.arenaPoint=t.getInt(),e.skyarenaPoint=t.getInt(),e.vipLevel,e.vipLevel=t.getByte(),e.superQqLevel=t.getByte();var i=t.getByte();e.autoSkillID=new Array(i);for(var o=0;i>o;o++)e.autoSkillID[o]=t.getShort();e.autoSkillID_Initiative=t.getShort(),e.fromItemSetData(t),e.power=t.getUnsignedByte(),e.powerValue=t.getShort(),e.titlePower1=t.getUnsignedByte(),e.titlePowerValue1=t.getShort(),e.titlePower2=t.getUnsignedByte(),e.titlePowerValue2=t.getShort(),e.countrypowerValue=t.getByte(),e.setEnchantValue(t.getInt())},e.prototype.logic=function(e){return this.autoMoveControlList.length>0?(0==Main.instance.hasPopupUI&&0==PanelManager.isOpeningFullScene&&0==guide.ballGuiding&&this.executeControlList(this.autoMoveControlList),void AutoGamer.switchAutoGaming(!0)):void t.prototype.logic.call(this,e)},e.prototype.clearAutoMoveList=function(){null!=this.autoMoveControlList&&(this.autoMoveControlList.length=0)},e.prototype.addMission=function(t){return null!=t&&(1==t.isEscort()||(null==this.missionList&&(this.missionList=new Array),null==this.getMissionById(t.getId())&&(this.missionList.length<e.MAX_MISSION_SIZE&&(this.missionList.push(t),Mission.setNewRadar(t),PanelManager.updateWorldTaskTarget(),t.getId()==guide.MISSION_THAT_OPEN_AUTO_FIGHT&&GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_BATTLE_AUTO),t.getId()==guide.MISSION_THAT_TRIGGERS_SELECT_AUTO_SKILL&&GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_SEL_AUTO_SKILL),t.getId()==guide.MISSION_THAT_TRIGGERS_BATTLE_SKILL_GUIDE&&GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_OPEN_BATTLE_SKILL),!0))))},e.prototype.deleteMission=function(t){return null!=t&&this.deleteMissionById(t.getId())},e.prototype.deleteMissionById=function(t){if(null==this.missionList)return!1;for(var e=0;e<this.missionList.length;e++){var n=this.missionList[e];if(null!=n&&n.getId()==t)return n.cleanKillMission(),Mission.clearNewRadar(n),this.missionList.splice(e,1),PanelManager.updateWorldTaskTarget(),!0}return!1},e.prototype.submitMission=function(t){null!=t&&(0==t.isDirectSubmit()&&this.getMissionById(t.getId()),this.deleteMission(t))},e.prototype.updateAllKillMission=function(t,e,n){if(null!=t&&null!=e&&t.length==e.length)for(var i=null,o=-1,a=0;a<t.length;a++){o=t[a];for(var r=0;r<this.missionList.length;r++)null!=(i=this.missionList[r])&&i.updateKillMission(o,e[a],n)}},e.prototype.getMissionHaveItemDesc=function(t,e){if(null!=e)for(var n=null,i=0;i<this.missionList.length;i++)null!=(n=this.missionList[i])&&n.updateHaveItemDesc(t,e)},e.prototype.isHaveCollectItemMission=function(){for(var t=null,e=0;e<this.missionList.length;e++)if((t=this.missionList[e])&&t.isCollectItemType)return!0;return!1},e.prototype.getMissionById=function(t){if(null==this.missionList)return null;for(var e=null,n=0;n<this.missionList.length;n++)if(null!=(e=this.missionList[n])&&e.getId()==t)return e;return null},e.prototype.setMoneyByType=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=!0);var o,a,r=0;switch(t){case ModelConst.MONEY1:this.money1!=e&&(r=e-this.money1,o=PowerString.makeColorString(GameText.STR_MONEY1+r,ColorUtils.COLOR_YELLOW)+"\n"),this.money1=e;break;case ModelConst.MONEY2:this.money2!=e&&(r=e-this.money2,o=PowerString.makeColorString(GameText.STR_MONEY2+r,ColorUtils.COLOR_MONEY2)+"\n",r>0&&(a="获得 "+PowerString.makeColorString(GameText.STR_MONEY2+"x"+r,ColorUtils.COLOR_MONEY2))),this.money2=e;break;case ModelConst.MONEY3:this.money3!=e&&(r=e-this.money3,o=PowerString.makeColorString(GameText.STR_MONEY3+r,ColorUtils.COLOR_MONEY3)+"\n",r>0&&(a="获得"+PowerString.makeColorString(GameText.STR_MONEY3+"x"+r,ColorUtils.COLOR_MONEY3))),this.money3=e}return i&&!Tool.isNullText(a)?WorldMessage.addTips(a):n&&!Tool.isNullText(o)&&n.append(o),o},e.prototype.setPlayerMoneyValue=function(t,e,n,i,o){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=!0),void 0===o&&(o=null);var a="",r="",s=0;t>=0&&this.money1!=t&&(s=t-this.money1,a+=PowerString.makeColorString(GameText.STR_MONEY1+s,ColorUtils.COLOR_YELLOW)+"\n",this.money1=t),e>=0&&this.money2!=e&&(s=e-this.money2,a+=PowerString.makeColorString(GameText.STR_MONEY2+s,ColorUtils.COLOR_MONEY2)+"\n",s>0&&(r+="获得 "+PowerString.makeColorString(GameText.STR_MONEY2+"x"+s,ColorUtils.COLOR_MONEY2)+"\n"),this.money2=e),n>=0&&this.money3!=n&&(s=n-this.money3,a+=PowerString.makeColorString(GameText.STR_MONEY3+s,ColorUtils.COLOR_MONEY3)+"\n",s>0&&(r+="获得"+PowerString.makeColorString(GameText.STR_MONEY3+"x"+s,ColorUtils.COLOR_MONEY3)+"\n"),this.money3=n),i&&!Tool.isNullText(r)?WorldMessage.addTips(r):o&&!Tool.isNullText(a)&&o.append(a)},e.prototype.setPlayerMoney=function(t,e,n,i){if(0>t||0>e||0>n)return!1;null==i&&(i=new StringBuffer);var o=t-this.get(ModelConst.MONEY1),a=e-this.get(ModelConst.MONEY2),r=n-this.get(ModelConst.MONEY3);return 0>o?(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_DEDUCT+PowerString.makeColorString(GameText.STR_MONEY1+-o,ColorUtils.COLOR_YELLOW))):o>0&&(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_ADD+PowerString.makeColorString(GameText.STR_MONEY1+o,ColorUtils.COLOR_YELLOW))),0>a?(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_DEDUCT+PowerString.makeColorString(GameText.STR_MONEY2+-a,ColorUtils.COLOR_MONEY2))):a>0&&(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_ADD+PowerString.makeColorString(GameText.STR_MONEY2+a,ColorUtils.COLOR_MONEY2))),0>r?(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_DEDUCT+PowerString.makeColorString(GameText.STR_MONEY3+-r,ColorUtils.COLOR_MONEY3))):r>0&&(Tool.isNullText(i.toString())||i.append("\n"),i.append(GameText.STR_ADD+PowerString.makeColorString(GameText.STR_MONEY3+r,ColorUtils.COLOR_MONEY3))),this.money1=t,this.money2=e,this.money3=n,!0},e.prototype.addValueString=function(t,e){switch(t){case ModelConst.HELP_COUNTRY:this.helpCountry=e;break;case ModelConst.LOVE_PLAYER:this.lovePlayer=e;break;case ModelConst.PARTNER_NAME:this.partnerName=e}},e.prototype.addStringValue=function(t,e){switch(t){case ModelConst.HELP_COUNTRY:this.helpCountry=e;break;case ModelConst.LOVE_PLAYER:this.lovePlayer=e;break;case ModelConst.PARTNER_NAME:this.partnerName=e}},e.prototype.addValue=function(e,n){var i=0,o=0;switch(this.readAddValue=n,e){case ModelConst.PARTNER_ID:this.partnerId=n;break;case ModelConst.MASTER_FLAG:this.masterFlag=n;break;case ModelConst.EXP:this.exp=Tool.sumValue(this.exp,n,0,this.expMax);break;case ModelConst.EXP2:this.exp2=Tool.sumValue(this.exp2,n,0,this.expMax2);break;case ModelConst.SET_EXP:this.exp=n;break;case ModelConst.SET_EXP2:this.exp2=n;break;case ModelConst.EXPMAX:this.expMax=Tool.sumValue(this.expMax,n,0,Tool.MAX_VALUE_int);break;case ModelConst.SET_EXPMAX:this.expMax=n;break;case ModelConst.SET_EXPMAX2:this.expMax2=n;break;case ModelConst.HP:this.hp=Tool.sumValue(this.hp,n,0,this.get(ModelConst.HPMAX));break;case ModelConst.HP_DISPLAY:this.hpDisplay=Tool.sumValue(this.hpDisplay,n,0,this.get(ModelConst.HPMAX));break;case ModelConst.MP:this.mp=Tool.sumValue(this.mp,n,0,this.get(ModelConst.MPMAX));break;case ModelConst.MP_DISPLAY:this.mpDisplay=Tool.sumValue(this.mpDisplay,n,0,this.get(ModelConst.MPMAX));break;case ModelConst.SP:this.sp=Tool.sumValue(this.sp,n,0,Tool.MAX_VALUE_int);break;case ModelConst.CP:this.cp=Tool.sumValue(this.cp,n,0,Tool.MAX_VALUE_short);break;case ModelConst.STR:this.str=Tool.sumValue(this.str,n,0,ModelConst.MAX_BASE_ATTRIBUTE),i=this.get(ModelConst.HPMAX),this.hp>i&&(this.hp=i);break;case ModelConst.CON:this.con=Tool.sumValue(this.con,n,0,ModelConst.MAX_BASE_ATTRIBUTE),i=this.get(ModelConst.HPMAX),this.hp>i&&(this.hp=i);break;case ModelConst.AGI:this.agi=Tool.sumValue(this.agi,n,0,ModelConst.MAX_BASE_ATTRIBUTE);break;case ModelConst.ILT:this.ilt=Tool.sumValue(this.ilt,n,0,ModelConst.MAX_BASE_ATTRIBUTE),i=this.get(ModelConst.MPMAX),this.mp>i&&(this.mp=i);break;case ModelConst.WIS:this.wis=Tool.sumValue(this.wis,n,0,ModelConst.MAX_BASE_ATTRIBUTE),i=this.get(ModelConst.MPMAX),this.mp>i&&(this.mp=i);break;case ModelConst.MONEY1:this.money1=Tool.sumValue(this.money1,n,0,Tool.MAX_VALUE_int);break;case ModelConst.MONEY2:this.money2=Tool.sumValue(this.money2,n,0,Tool.MAX_VALUE_int);break;case ModelConst.MONEY3:this.money3>0&&n>0&&this.money3+n<0?this.money3=Tool.MAX_VALUE_int:(this.money3+=n,this.money3<0&&(this.money3=0));break;case ModelConst.NUM_STROE:this.numStroe=Tool.sumValue(this.numStroe,n,0,ModelConst.MAX_STORE_NUM);break;case ModelConst.COUNTRY_HONOR:this.countryHonor=Tool.sumValue(this.countryHonor,n,0,Tool.MAX_VALUE_int);break;case ModelConst.KILL_COUNT:this.killCount=Tool.sumValue(this.killCount,n,0,Tool.MAX_VALUE_int);break;case ModelConst.PK_WIN_COUNT:this.Pkwincount=Tool.sumValue(this.Pkwincount,n,0,Tool.MAX_VALUE_int);break;case ModelConst.PK_LOSE_COUNT:this.Pklosecount=Tool.sumValue(this.Pklosecount,n,0,Tool.MAX_VALUE_int);break;case ModelConst.SPEED:o=this.speed,this.speed=Tool.sumValue(this.speed,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.speed-o;break;case ModelConst.ATK_STR:o=this.atk_str,this.atk_str=Tool.sumValue(this.atk_str,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.atk_str-o;break;case ModelConst.ATK_TIME:o=this.atk_time,this.atk_time=Tool.sumValue(this.atk_time,n,0,ModelConst.MAX_HIT_TIME),this.readAddValue=this.atk_time-o;break;case ModelConst.ATK_AGI:o=this.atk_agi,this.atk_agi=Tool.sumValue(this.atk_agi,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.atk_agi-o;break;case ModelConst.ATK_MAGIC:o=this.atk_magic,this.atk_magic=Tool.sumValue(this.atk_magic,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.atk_magic-o;break;case ModelConst.DEF_STR:o=this.def_str,this.def_str=Tool.sumValue(this.def_str,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.def_str-o;break;case ModelConst.DEF_AGI:o=this.def_agi,this.def_agi=Tool.sumValue(this.def_agi,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.def_agi-o;break;case ModelConst.DEF_MAGIC:o=this.def_magic,this.def_magic=Tool.sumValue(this.def_magic,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.def_magic-o;break;case ModelConst.ARGO:this.argo=Tool.sumValue(this.argo,n,-1e5,1e5);break;case ModelConst.CRITICAL:o=this.critical,this.critical=Tool.sumValue(this.critical,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.critical-o;break;case ModelConst.HIT_MAGIC:o=this.hitMagic,this.hitMagic=Tool.sumValue(this.hitMagic,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.hitMagic-o;break;case ModelConst.HIT_RATE:o=this.hitrate,this.hitrate=Tool.sumValue(this.hitrate,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.hitrate-o;break;case ModelConst.FORCE_HIT:o=this.forceHit,this.forceHit=Tool.sumValue(this.forceHit,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.forceHit-o;break;case ModelConst.DODGE:o=this.dodge,this.dodge=Tool.sumValue(this.dodge,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.dodge-o;break;case ModelConst.WIL:o=this.wil,this.wil=Tool.sumValue(this.wil,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.wil-o;break;case ModelConst.TOUGH:o=this.tough,this.tough=Tool.sumValue(this.tough,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.tough-o;break;case ModelConst.BRK_ARMOR:o=this.brkArmor,this.brkArmor=Tool.sumValue(this.brkArmor,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.brkArmor-o;break;case ModelConst.MAGIC_PENETRATION:o=this.magic_penetration,this.magic_penetration=Tool.sumValue(this.magic_penetration,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.magic_penetration-o;break;case ModelConst.BLOCK:o=this.block,this.block=Tool.sumValue(this.block,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.block-o;break;case ModelConst.DEF_FIELD:o=this.def_field,this.def_field=Tool.sumValue(this.def_field,n,ModelConst.MIN_DEF_FIELD,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.def_field-o;break;case ModelConst.INSIGHT:o=this.insight,this.insight=Tool.sumValue(this.insight,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.insight-o;break;case ModelConst.BACK:o=this.back,this.back=Tool.sumValue(this.back,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.back-o;break;case ModelConst.MAGIC_BACK:o=this.magic_back,this.magic_back=Tool.sumValue(this.magic_back,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.magic_back-o;break;case ModelConst.LIFE_ABSORPTION:o=this.life_absorption,this.life_absorption=Tool.sumValue(this.life_absorption,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.life_absorption-o;break;case ModelConst.MANA_ABSORPTION:o=this.mana_absorption,this.mana_absorption=Tool.sumValue(this.mana_absorption,n,0,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.mana_absorption-o;break;case ModelConst.HEAL_RECOVERY:o=this.heal_recovery,this.heal_recovery=Tool.sumValue(this.heal_recovery,n,ModelConst.MIN_HEAL_RECOVERY,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.heal_recovery-o;break;case ModelConst.MANA_RECOVERY:o=this.mana_recovery,this.mana_recovery=Tool.sumValue(this.mana_recovery,n,ModelConst.MIN_MANA_RECOVERY,ModelConst.MAX_OTHER_ATTRIBUTE),this.readAddValue=this.mana_recovery-o;break;case ModelConst.KEEPOUT_ATK_TIME:o=this.keepout_atk_time,this.keepout_atk_time=Tool.sumValue(this.keepout_atk_time,n,0,ModelConst.MAX_KEEPOUT_ATK_TIME),this.readAddValue=this.keepout_atk_time-o;break;case ModelConst.WEAPON_DAMAGE_PERCENT:o=this.weapon_damage_percent,this.weapon_damage_percent=Tool.sumValue(this.weapon_damage_percent,n,-1e4,1e4),this.readAddValue=this.weapon_damage_percent-o;break;default:t.prototype.addValue.call(this,e,n)}PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateRoleProgress()},e.prototype.updateAndRefreshIcon=function(){this.clearMemberHideStatus(),this.updateIcon(),this.refreshWorldSprite()},e.prototype.clearMemberHideStatus=function(){if(0!=this.isLeader()&&null!=this.members)for(var t=0;t<this.members.length;t++){var e=this.members[t];null!=e&&e.setTabStatus(!1,Model.HIDE_SPIRTE)}},e.prototype.setBattleStatus=function(t){return this.bStatus|=t,!0},e.prototype.clearBattleStatus=function(t){this.bStatus&=~t},e.prototype.isBattleStatus=function(t){return 0!=(this.bStatus&t)},e.prototype.updateIcon=function(){if(null!=this.bag){var t,e,n,i;if(this.icon1&=~(Model.LEN_HAND_STYLE<<Model.OFFSET_HAND_STYLE),this.icon1&=~(Model.LEN_HAND_COLOR<<Model.OFFSET_HAND_COLOR),this.icon1&=~(Model.LEN_FEET_STYLE<<Model.OFFSET_FEET_STYLE),this.icon1&=~(Model.LEN_FEET_COLOR<<Model.OFFSET_FEET_COLOR),this.icon1=Model.setHandAndFeet(this.icon1),this.icon1&=~(Model.LEN_HELMET_STYLE<<Model.OFFSET_HELMET_STYLE),this.icon1&=~(Model.LEN_HELMET_COLOR<<Model.OFFSET_HELMET_COLOR),null!=(t=this.bag.getItem(PlayerBag.ARMOR_HEAD_POS))&&t.icon>0&&((e=t.icon-Model.START_HELMET)>0&&(n=1+(e-1)/4,i=(e-1)%4,this.icon1|=(n&Model.LEN_HELMET_STYLE)<<Model.OFFSET_HELMET_STYLE,this.icon1|=(i&Model.LEN_HELMET_COLOR)<<Model.OFFSET_HELMET_COLOR)),this.icon2&=~(Model.LEN_SHOULDER_STYLE<<Model.OFFSET_SHOULDER_STYLE),this.icon2&=~(Model.LEN_SHOULDER_COLOR<<Model.OFFSET_SHOULDER_COLOR),this.icon2&=~(Model.LEN_SHOULDER_ADD<<Model.OFFSET_SHOULDER_ADD),null!=(t=this.bag.getItem(PlayerBag.ARMOR_SHOULDER_POS))&&t.icon>0&&(e=t.icon-Model.START_SHOULDER)>0){n=1+(e-1)/8,i=(e-1)%8,this.icon2|=(n&Model.LEN_SHOULDER_STYLE)<<Model.OFFSET_SHOULDER_STYLE,this.icon2|=(i&Model.LEN_SHOULDER_COLOR)<<Model.OFFSET_SHOULDER_COLOR;var o=n>>Tool.getBitNum(Model.LEN_SHOULDER_STYLE);this.icon2|=(o&Model.LEN_SHOULDER_ADD)<<Model.OFFSET_SHOULDER_ADD}this.icon2&=~(Model.LEN_WEAPON_FLASH<<Model.OFFSET_WEAPON_FLASH);var a=0;if(this.icon2&=~(Model.LEN_LWEAPON_STYLE<<Model.OFFSET_LWEAPON_STYLE),this.icon2&=~(Model.LEN_LWEAPON_COLOR<<Model.OFFSET_LWEAPON_COLOR),null!=(t=this.bag.getItem(PlayerBag.WEAPON_LEFT_POS))&&t.icon>0&&((e=t.icon-Model.START_WEAPON)>0&&(n=1+(e-1)/4,i=(e-1)%4,this.icon2|=(n&Model.LEN_LWEAPON_STYLE)<<Model.OFFSET_LWEAPON_STYLE,this.icon2|=(i&Model.LEN_LWEAPON_COLOR)<<Model.OFFSET_LWEAPON_COLOR,a=t.getWeaponFlashType())),this.icon2&=~(Model.LEN_RWEAPON_STYLE<<Model.OFFSET_RWEAPON_STYLE),this.icon2&=~(Model.LEN_RWEAPON_COLOR<<Model.OFFSET_RWEAPON_COLOR),null!=(t=this.bag.getItem(PlayerBag.WEAPON_RIGHT_POS))&&t.icon>0&&(e=t.icon-Model.START_WEAPON)>0){n=1+(e-1)/4,i=(e-1)%4,this.icon2|=(n&Model.LEN_RWEAPON_STYLE)<<Model.OFFSET_RWEAPON_STYLE,this.icon2|=(i&Model.LEN_RWEAPON_COLOR)<<Model.OFFSET_RWEAPON_COLOR;var r=t.getWeaponFlashType();r>0&&r>a&&(a=r)}if(a>0&&(this.icon2|=(a&Model.LEN_WEAPON_FLASH)<<Model.OFFSET_WEAPON_FLASH),this.icon3&=~(Model.LEN_BACK_STYLE<<Model.OFFSET_BACK_STYLE),this.icon3&=~(Model.LEN_BACK_COLOR<<Model.OFFSET_BACK_COLOR),this.icon3&=~(Model.LEN_BACK_ADD<<Model.OFFSET_BACK_ADD),null!=(t=this.bag.getItem(PlayerBag.ARMOR_BACK_POS))&&t.icon>0&&(e=t.icon-Model.START_BACK)>0){n=1+(e-1)/4,i=(e-1)%4,this.icon3|=(n&Model.LEN_BACK_STYLE)<<Model.OFFSET_BACK_STYLE,this.icon3|=(i&Model.LEN_BACK_COLOR)<<Model.OFFSET_BACK_COLOR;var s=n>>Tool.getBitNum(Model.LEN_BACK_STYLE);this.icon3|=(s&Model.LEN_BACK_ADD)<<Model.OFFSET_BACK_ADD}if(this.icon3&=~(Model.LEN_CLOTHES_STYLE<<Model.OFFSET_CLOTHES_STYLE),this.icon3&=~(Model.LEN_CLOTHES_COLOR<<Model.OFFSET_CLOTHES_COLOR),null!=(t=this.bag.getItem(PlayerBag.ARMOR_CLOTHES_POS))&&t.icon>0&&((e=t.icon-Model.START_CLOTHES)>0&&(n=1+(e-1)/8,i=(e-1)%8,this.icon3|=(n&Model.LEN_CLOTHES_STYLE)<<Model.OFFSET_CLOTHES_STYLE,this.icon3|=(i&Model.LEN_CLOTHES_COLOR)<<Model.OFFSET_CLOTHES_COLOR)),this.icon3&=~(Model.LEN_TROUSERS_STYLE<<Model.OFFSET_TROUSERS_STYLE),this.icon3&=~(Model.LEN_TROUSERS_COLOR<<Model.OFFSET_TROUSERS_COLOR),null!=(t=this.bag.getItem(PlayerBag.ARMOR_TROUSERS_POS))&&t.icon>0&&((e=t.icon-Model.START_TROUSERS)>0&&(n=1+(e-1)/8,i=(e-1)%8,this.icon3|=(n&Model.LEN_TROUSERS_STYLE)<<Model.OFFSET_TROUSERS_STYLE,this.icon3|=(i&Model.LEN_TROUSERS_COLOR)<<Model.OFFSET_TROUSERS_COLOR)),this.icon3&=~(Model.LEN_TRANSPORT_STYLE<<Model.OFFSET_TRANSPORT_STYLE),this.icon3&=~(Model.LEN_TRANSPORT_COLOR<<Model.OFFSET_TRANSPORT_COLOR),this.icon3&=~(Model.LEN_TRANSPORT_ADD<<Model.OFFSET_TRANSPORT_ADD),this.icon3&=~(Model.LEN_TRANSPORT_ADD_2<<Model.OFFSET_TRANSPORT_ADD_2),null!=(t=this.bag.getItem(PlayerBag.ARMOR_TRANSPORT_POS))&&t.icon>0){var l=!1;if(1==t.isTimeItem()&&1==t.isExpired()&&(l=!0),0==l&&(e=t.icon-Model.START_TRANSPORT)>0){n=Math.floor(1+(e-1)/4),i=(e-1)%4,this.icon3|=(n&Model.LEN_TRANSPORT_STYLE)<<Model.OFFSET_TRANSPORT_STYLE,this.icon3|=(i&Model.LEN_TRANSPORT_COLOR)<<Model.OFFSET_TRANSPORT_COLOR;var _=n>>Tool.getBitNum(Model.LEN_TRANSPORT_STYLE);this.icon3|=(_&Model.LEN_TRANSPORT_ADD)<<Model.OFFSET_TRANSPORT_ADD;var h=n>>Tool.getBitNum(Model.LEN_TRANSPORT_STYLE)+Model.LEN_TRANSPORT_ADD;this.icon3|=(h&Model.LEN_TRANSPORT_ADD_2)<<Model.OFFSET_TRANSPORT_ADD_2}}this.updateIconByFashion()}},e.setIconValue=function(t,e,n,i,o,a){var r=e>>n&i;return r>0&&(t&=~(i<<n),t|=(r&i)<<n,o>=0&&(t&=~(a<<o),t|=((r=e>>o&a)&a)<<o)),t},e.prototype.updateIconByFashion=function(){if(null!=this.bag){var t=this.bag.getItem(PlayerBag.ARMOR_FASHION_POS);if(null!=t&&(1!=t.isTimeItem()||1!=t.isExpired())){var n=t.fashIcon1,i=t.fashIcon2,o=t.fashIcon3;if(0!=n&&(this.icon1=e.setIconValue(this.icon1,n,Model.OFFSET_HAIR_STYLE,Model.LEN_HAIR_STYLE,Model.OFFSET_HAIR_COLOR,Model.LEN_HAIR_COLOR),this.icon1=e.setIconValue(this.icon1,n,Model.OFFSET_FACE_STYLE,Model.LEN_FACE_STYLE,-1,-1),this.icon1=e.setIconValue(this.icon1,n,Model.OFFSET_HAND_STYLE,Model.LEN_HAND_STYLE,Model.OFFSET_HAND_COLOR,Model.LEN_HAND_COLOR),this.icon1=e.setIconValue(this.icon1,n,Model.OFFSET_FEET_STYLE,Model.LEN_FEET_STYLE,Model.OFFSET_FEET_COLOR,Model.LEN_FEET_COLOR),this.icon1=e.setIconValue(this.icon1,n,Model.OFFSET_HELMET_STYLE,Model.LEN_HELMET_STYLE,Model.OFFSET_HELMET_COLOR,Model.LEN_HELMET_COLOR)),0!=i){var a=i>>Model.OFFSET_SHOULDER_STYLE&Model.LEN_SHOULDER_STYLE,r=i>>Model.OFFSET_SHOULDER_ADD&Model.LEN_SHOULDER_ADD;(a>0||r>0)&&(this.icon2&=~(Model.LEN_SHOULDER_STYLE<<Model.OFFSET_SHOULDER_STYLE),this.icon2&=~(Model.LEN_SHOULDER_COLOR<<Model.OFFSET_SHOULDER_COLOR),this.icon2&=~(Model.LEN_SHOULDER_ADD<<Model.OFFSET_SHOULDER_ADD)),this.icon2=e.setIconValue(this.icon2,i,Model.OFFSET_SHOULDER_STYLE,Model.LEN_SHOULDER_STYLE,Model.OFFSET_SHOULDER_COLOR,Model.LEN_SHOULDER_COLOR),this.icon2=e.setIconValue(this.icon2,i,Model.OFFSET_SHOULDER_ADD,Model.LEN_SHOULDER_ADD,-1,-1);var s=i>>Model.OFFSET_LWEAPON_STYLE&Model.LEN_LWEAPON_STYLE,l=i>>Model.OFFSET_RWEAPON_STYLE&Model.LEN_RWEAPON_STYLE;(s>0||l>0)&&(this.icon2&=~(Model.LEN_LWEAPON_STYLE<<Model.OFFSET_LWEAPON_STYLE),this.icon2&=~(Model.LEN_LWEAPON_COLOR<<Model.OFFSET_LWEAPON_COLOR),this.icon2&=~(Model.LEN_RWEAPON_STYLE<<Model.OFFSET_RWEAPON_STYLE),this.icon2&=~(Model.LEN_RWEAPON_COLOR<<Model.OFFSET_RWEAPON_COLOR)),this.icon2=e.setIconValue(this.icon2,i,Model.OFFSET_LWEAPON_STYLE,Model.LEN_LWEAPON_STYLE,Model.OFFSET_LWEAPON_COLOR,Model.LEN_LWEAPON_COLOR),this.icon2=e.setIconValue(this.icon2,i,Model.OFFSET_RWEAPON_STYLE,Model.LEN_RWEAPON_STYLE,Model.OFFSET_RWEAPON_COLOR,Model.LEN_RWEAPON_COLOR),this.icon2=e.setIconValue(this.icon2,i,Model.OFFSET_WEAPON_FLASH,Model.LEN_WEAPON_FLASH,-1,-1)}if(0!=o){var _=o>>Model.OFFSET_BACK_STYLE&Model.LEN_BACK_STYLE,h=o>>Model.OFFSET_BACK_ADD&Model.LEN_BACK_ADD;(_>0||h>0)&&(this.icon3&=~(Model.LEN_BACK_STYLE<<Model.OFFSET_BACK_STYLE),this.icon3&=~(Model.LEN_BACK_COLOR<<Model.OFFSET_BACK_COLOR),this.icon3&=~(Model.LEN_BACK_ADD<<Model.OFFSET_BACK_ADD)),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_BACK_STYLE,Model.LEN_BACK_STYLE,Model.OFFSET_BACK_COLOR,Model.LEN_BACK_COLOR),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_BACK_ADD,Model.LEN_BACK_ADD,-1,-1),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_CLOTHES_STYLE,Model.LEN_CLOTHES_STYLE,Model.OFFSET_CLOTHES_COLOR,Model.LEN_CLOTHES_COLOR),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_TROUSERS_STYLE,Model.LEN_TROUSERS_STYLE,Model.OFFSET_TROUSERS_COLOR,Model.LEN_TROUSERS_COLOR),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_TRANSPORT_STYLE,Model.LEN_TRANSPORT_STYLE,Model.OFFSET_TRANSPORT_COLOR,Model.LEN_TRANSPORT_COLOR),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_TRANSPORT_ADD,Model.LEN_TRANSPORT_ADD,-1,-1),this.icon3=e.setIconValue(this.icon3,o,Model.OFFSET_TRANSPORT_ADD_2,Model.LEN_TRANSPORT_ADD_2,-1,-1)}this.icon3&=~(Model.LEN_FASH_ADD<<Model.OFFSET_FASH_ADD),(0!=n||0!=i||0!=o)&&(this.icon3|=(1&Model.LEN_FASH_ADD)<<Model.OFFSET_FASH_ADD)}}},e.prototype.updateHair=function(t){if(null!=t){var n=t.icon;if(!(0>=n)){this.icon1&=~(e.LEN_HAIR_STYLE<<e.OFFSET_HAIR_STYLE),this.icon1&=~(e.LEN_HAIR_COLOR<<e.OFFSET_HAIR_COLOR);var i=n-Model.START_HAIR;if(i>0){var o=1+Math.floor(i-1)/8,a=(i-1)%8;this.icon1|=(o&e.LEN_HAIR_STYLE)<<e.OFFSET_HAIR_STYLE,this.icon1|=(a&e.LEN_HAIR_COLOR)<<e.OFFSET_HAIR_COLOR}}}},e.prototype.updateFace=function(t){if(null!=t){var n=t.icon;if(!(0>=n)){this.icon1&=~(e.LEN_FACE_STYLE<<e.OFFSET_FACE_STYLE);var i=n-Model.START_FACE;if(i>0){var o=1+Math.floor(i-1)/8;this.icon1|=(o&e.LEN_FACE_STYLE)<<e.OFFSET_FACE_STYLE}}}},e.prototype.isAutoMove=function(){return this.autoMoveControlList.length>0},e.prototype.fromBytesByAutoMove=function(t){if(null==t)return!1;this.setPosition(this.getGx(),this.getGy()),this.autoMoveControlList.length=0,this.controlList.length=0;for(var e=null,n=t.getByte(),i=0;n>i;i++){var o=t.getByte(),a=t.getByte(),r=t.getShort(),s=t.getByte(),l=t.getByte();e=Control.createMoveTo(this.id,o,a),this.autoMoveControlList.push(e),e=Control.createJumpMap(r,s,l),this.autoMoveControlList.push(e)}o=t.getByte(),a=t.getByte();return(e=Control.createMoveTo(this.id,o,a)).setAutoMoveEndStep(),this.autoMoveControlList.push(e),!0},e.prototype.getPKWin=function(){return this.Pkwincount+this.Pklosecount<=0?"0%":Math.ceil(100*this.Pkwincount/(this.Pkwincount+this.Pklosecount))+"%"},e.prototype.clonePlayer=function(){var t=new e;return t.level=this.level,t.hp=this.hp,t.mp=this.mp,t.hpMax=this.hpMax,t.mpMax=this.mpMax,t.cp=this.cp,t.str=this.str,t.con=this.con,t.agi=this.agi,t.ilt=this.ilt,t.wis=this.wis,t.itemSetData=this.itemSetData,t.titlePower1=this.titlePower1,t.titlePowerValue1=this.titlePowerValue1,t.titlePower2=this.titlePower2,t.titlePowerValue2=this.titlePowerValue2,t.power=this.power,t.powerValue=this.powerValue,t.powerExpireTime=this.powerExpireTime,t.fightPowerList=this.fightPowerList,t.skillList=this.skillList,t.bag=this.bag,t.level2=this.level2,t.countrypowerValue=this.countrypowerValue,t.keepout_atk_time=this.keepout_atk_time,t.formationList=this.formationList,t.formationSkill=this.formationSkill,t.iconpet1=this.iconpet1,t},e.prototype.isHaveCanNotReliveBuffer=function(){if(null==this.battleBufferList)return!1;for(var t=this.battleBufferList.length-1;t>=0;t--){var e=this.battleBufferList[t];if(null!=e&&e.isCannotReliveStatus())return!0}return!1},e.getCompareSprite=function(t,n,i){if(void 0===i&&(i=!1),null==t||null==n)return null;if(n.isPetType()){var o=new MyPet(t);return o.setIcon1(n.icon),o.createSprite(!1)}var a=new e;a.setIcon1(t.getIcon1()),a.setIcon2(t.getIcon2()),a.setIcon3(t.getIcon3());var r=t.bag;if(null!=r)if(a.setBag(r.getClone(a)),Define.isFaceItem(n.id))a.updateFace(n);else if(Define.isHairItem(n.id))a.updateHair(n);else{var s=n.clone();if(n.setVarItemDataTo(s),i)for(var l=0;l<PlayerBag.SPIRIT_POS;l++){var _=a.bag.getItem(l);a.bag.unequipItem(_)}a.bag.setItemWithSlot(s,PlayerBag.BAG_START),a.bag.equipItem(s.slotPos)}return a.updateIcon(),a.createSprite(!1)},e.prototype.addWatcher=function(){this.createWatch("speed"),this.createWatch("atk_str"),this.createWatch("atk_agi"),this.createWatch("atk_magic"),this.createWatch("def_str"),this.createWatch("def_agi"),this.createWatch("def_magic"),this.createWatch("hpMax"),this.createWatch("mpMax"),this.createWatch("dodge"),this.createWatch("hitrate"),this.createWatch("hitMagic"),this.createWatch("critical"),this.createWatch("wil"),this.createWatch("tough"),this.createWatch("block"),this.createWatch("brkArmor"),this.createWatch("insight"),this.createWatch("def_field"),this.createWatch("back"),this.createWatch("magic_back"),this.createWatch("life_absorption"),this.createWatch("mana_absorption"),this.createWatch("magic_penetration"),this.createWatch("forceHit"),this.createWatch("keepout_atk_time"),this.createWatch("str"),this.createWatch("con"),this.createWatch("agi"),this.createWatch("ilt"),this.createWatch("wis"),this.createWatch("level"),this.checkPower()},e.prototype.unwatch=function(){if(this.watcherArr)for(var t=0,e=this.watcherArr.length;e>t;t++)this.watcherArr[t].unwatch()},e.prototype.createWatch=function(t){this.watcherArr||(this.watcherArr=[]);var e=eui.Watcher.watch(this,[t],this.checkPower,this);return this.watcherArr.push(e),e},e.prototype.checkPower=function(){if(!(xworld.inBattle||xworld.readyToBattle||GameWorld.isCountryWarStatus()||GameWorld.isEscortStatus()||GameWorld.isCountryBossStatus()||GameWorld.isTeamBossStatus())){clearTimeout(this.timeoutSetPowerx),this.timeoutSetPowerx=setTimeout((function(t){var e=t.powerX;if(t.powerX=t.getPower(!0,!1,t),0==t.powerX){if(++t.checkCount<3)return void t.checkPower()}else if(0!=e&&e!=t.powerX){t.checkCount=0;var n=e-t.powerX;0>n?WorldMessage.addTips(Tool.manageString(GameText.STR_POWER_UP,-1*n+""),18*xhdRatio):WorldMessage.addTips(Tool.manageString(GameText.STR_POWER_DOWN,n+""),18*xhdRatio)}}),.3,this)}},e.prototype.getPower=function(t,e,n){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===n&&(n=null),null==n&&(n=this);var i=.96*n.get(ModelConst.SPEED);if(i+=.8*n.get(ModelConst.ATK_STR),i+=.5*n.get(ModelConst.ATK_AGI),i+=.5*n.get(ModelConst.ATK_MAGIC),i+=.8*n.get(ModelConst.DEF_STR),i+=.8*n.get(ModelConst.DEF_AGI),i+=.6*n.get(ModelConst.DEF_MAGIC),i+=.09*n.get(ModelConst.HPMAX),i+=.084*n.get(ModelConst.MPMAX),i+=5*n.get(ModelConst.DODGE),i+=.9*n.get(ModelConst.HIT_RATE),i+=4.5*n.get(ModelConst.HIT_MAGIC),i+=5*n.get(ModelConst.CRITICAL),i+=13.3*n.get(ModelConst.WIL),i+=15*n.get(ModelConst.TOUGH),i+=3.75*n.get(ModelConst.BLOCK),i+=1.3*n.get(ModelConst.BRK_ARMOR),i+=15*n.get(ModelConst.INSIGHT),i+=1.3*n.get(ModelConst.DEF_FIELD),i+=7.5*n.get(ModelConst.BACK),i+=7.5*n.get(ModelConst.MAGIC_BACK),i+=2*n.get(ModelConst.LIFE_ABSORPTION),i+=2*n.get(ModelConst.MANA_ABSORPTION),i+=1.3*n.get(ModelConst.MAGIC_PENETRATION),i+=.5*n.get(ModelConst.FORCE_HIT),i+=n.get(ModelConst.ATK_MAX)*n.get(ModelConst.ATK_TIME)*.5,i+=200*n.get(ModelConst.KEEPOUT_ATK_TIME),i+=8*n.get(ModelConst.IGNORE_WIL),i+=12*n.get(ModelConst.IGNORE_TOUCH),i+=7.5*n.get(ModelConst.IGNORE_BLOCK),i+=12*n.get(ModelConst.IGNORE_BACK),i+=6*n.get(ModelConst.IGNORE_INSIGHT),i+=12*n.get(ModelConst.IGNORE_MAGIC_BACK),i+=n.get(ModelConst.STR),i+=n.get(ModelConst.CON),i+=n.get(ModelConst.AGI),i+=n.get(ModelConst.ILT),i+=n.get(ModelConst.WIS),t){var o=n.getPet();o&&(i+=o.getPower())}return e&&(i/=1e4),Math.ceil(i)},e.NOVICE_LEVEL=15,e.MAX_AUTO_SKILL_COUNT=4,e.okImageCurrentlyUsed=[],e.okImagePool=[],e.MAX_MISSION_SIZE=10,e.BSTATUS_ESCAPE=1,e}(Model);__reflect(Player.prototype,"Player");var GameText2=function(){function t(){}return t.STR_TYPE_REGISTER_REALNAME="请输入名字(真实姓名)",t.STR_TYPE_REGISTER_IDCARD="请输入身份证号(18位)",t.STR_TYPE_REGISTER_IDCARD_ERROR="请输入正确的身份证号(18位)",t.STR_FRIEND_REMARDS="好友备注",t.STR_FRIEND_REMARDS_INFO="请输入对该玩家的备注，不超过14个字符或7个中文字",t.STR_CHANGE_FRIEND_REMARDS="修改备注",t.STR_CHANGE_REMARDS_SUCCESS="修改备注成功",t.STR_REMARDS="备注",t.STR_CHANGE_REMARDS_INFO="清空备注内容时，表示不对该玩家添加备注。",t.STR_YOU_SPEAK_TO="你对%U说",t.STR_BAND_IDCARD="绑定身份证",t.STR_BAND_IDCARD_INFO="强烈建议为您的游戏账号绑定身份证。当您的游戏账号丢失、被盗时，身份证号可作为寻回账号的参考凭证。请务必输入自身正确的身份证号码，身份证一旦与账号绑定，不可解绑。",t.STR_BAND_IDCARD_SCUUESS="绑定成功！您绑定的身份证：%U。",t.STR_BAND_IDCARD_ASK="真实名称：/c00FF00%U/p\n身份证号：/c00FF00%U/p\n请仔细确认，一旦绑定身份证号，无法解绑。",t.STR_OPENCRAFTMAN_INFO="%U\n\n你可以通过支付/cFF0000%U黄金/p，随机开启一位熔炉大师，提升炼制品质。",t.STR_OPENCRAFTMAN_ASK="继续操作需要支付/cFF0000%U黄金/p,是否确认？",t.STR_OPENCRAFTMAN="随机开启大师",t.STR_OPRATOR_FURNACE_ASK="你当前默认使用/cFF0000%U/p进行炼制，是否继续？\n%U",t.STR_FURNACE_INCREATENUM_ASK="你的次数已经用完，需要增加次数方可继续炼制，增加/c00FF00%U/p次需要/cFF0000%U/p,是否要增加？",t.STR_FURNACE_LEVEL="%U档",t.STR_FURNACE_OPERATE="开始炼制",t.STR_FURNACE_SEE_LEVEL_ITEM_LIST="档次物品列表",t.STR_COUNTRY_CREATE_WAR="国家强攻指令",t.STR_COUNTRY_CREATE_WAR_ID="请输入对方国家id",t.STR_COUNTRY_CREATE_WAR_MONEY1="请输入",t.STR_COUNTRY_CREATE_WAR_CHIOCE="请选择宣战方式",t.STR_COUNTRY_CREATE_WAR_ASK="需要消耗：/cFFFF00军力值%U/p\n 需要消耗：/cFFFF00国库黄金%U/p\n 需要消耗：/cFFFF00指令书%U/p\n您确定向/cFFFF00【%U】/p国家发动强制攻击吗？",t.STR_BACK_LOGIN="返回登录",t.STR_UNION="盟国",t.STR_UNION_SIM="盟",t.STR_UC_LOGIN_SUCCESS="UC账号登录成功！",t.STR_UC_CHECK_SUCCESS="验证通过",t.STR_UC_LOGIN_ERROR="错误原因",t.STR_OPEN_SKILLSHOP_ALERT_INFO="你可以通过学习技能，提高角色的战斗力！",t.STR_REFISTER_INFO="请务必正确填写信息，以便您能顺利注册成为谷得游戏的用户！",t.STR_LOGIN_INFO="请输入您的谷得游戏账号、密码。",t.STR_GOOD_LOGIN_NAME="谷得账号",t.STR_TRADE_PLAT="交易平台",t.STR_TYPE_USER_NAME="请输入谷得游戏账号(4～12位字母或数字)",t.STR_MENU_USER_MANAGE="账号管理",t.STR_GAME_HELP="游戏帮助",t.STR_GAME_PLAT_CENTER="平台中心",t.STR_UC_PLAT_CENTER="九游社区",t.STR_INVITE_INFO="如果你收到其他人的邀请，输入邀请码可获得一定的奖励哦。\n(注意：错误的邀请码会导致注册失败,若无邀请码请不要输入或输入0。)",t.STR_CHANGE_SEX_INFO="你确定要改变性别？",t.STR_INVITE="邀请码",t.STR_DUIHUAN="激活码兑换",t.STR_FEED_BACK="用户反馈",t.STR_CHECK_NETWORKING_FALSE_INFO="请检查网络连接",t.STR_USE_ITEM_ASK="你确定要使用%U吗？",t.STR_SINA_WEIBA="微吧入口",t.STR_LOGIN_LOTTERYDRAW_COUNT="抽奖次数：%U",t.STR_LOGIN_LOTTERYDRAW_REWARD="恭喜您，您抽中：",t.STR_LOGIN_LOTTERYDRAW_DESC="抽奖",t.STR_LOGIN_LOTTERYDRAW="登录抽奖",t.STR_CHAT_UP="搭讪",t.STR_CHAT_UP2="表达好感",t.STR_CHAT_NEW=" (新消息)",t.STR_ONLINE_REWARD_TIME="未到时间领取",t.STR_ONLINE_REWARD="在线奖励",t.STR_ONLINE_REWARD_GET="领奖",t.STR_ONLINE_REWARD_SEE_ITEM="查看物品",t.STR_SECOND="%U秒",t.STR_QQ_DIAMOND_OPENSHOP_ALERT="蓝钻贵族购物八折优惠",t.STR_AUTO_SELL_ASK_INFO="是否出售以下道具：%U\n出售总价：%U铜币",t.STR_AUTO_SELL_ALERT_INFO="成功出售以下道具：%U\n获得：%U铜币",t.STR_AUTO_SELL_ALL_PRICES="总价：%U铜币",t.STR_AUTO_SELL_MENU="智能出售",t.STR_AUTO_GET_PET="确定领取",t.STR_AUTO_EVOLVE="确定进化",t.STR_AUTO_MESSAGE="物品信息",t.STR_AUTO_SELL="确定出售(全部)",t.STR_AUTO_KEEP="保留此物品(不出售)",t.STR_ONLINE_REWARD_GET_ITEM_INFO="你获得：",t.STR_AUTO_EVOLVE_SUCCESS="恭喜您！宠物进化成功!",t.STR_CHANGE_ACTIVITY="充值活动",t.STR_CHANGE_ACTIVITY_INFO="累计充值%U元",t.STR_CANNOT_GET="未可领",t.STR_CAN_GET="可领",t.STR_HAS_GET="已领",t.STR_HAS_MONEY="元",t.STR_HAS_SURE="立即充值",t.STR_PET_EVOLVE_ASK="继续操作需要支付/cFF0000%U铜币/p,是否确认？",t.STR_SWITCH_ACCOUNT="切换账号",t.STR_ENCHANT="附魔",t.STR_ENCHANT_VALUE="附魔值",t.STR_ENCHANT_EQUIP="吸收装备",t.STR_ENCHANT_INPUT="放入吸收",t.STR_ENCHANT_KEY_INPUT="吸收",t.STR_ENCHANT_CANCEL="取下吸收",t.STR_ENCHANT_NO_ITEM="请先将需要吸收的装备放入吸收栏！",t.STR_ENCHANT_ASK_INFO="/cFF0000注意装备吸收后无法复原！/p\n即将获得:附魔值 /cc45712%U/p\n吸收装备列表如下:%U",t.STR_ENCHANT_ALL="全部吸收",t.STR_ENCHANT_SUCCESS="吸收成功！ 获得附魔值 /cc45712%U/p",t.STR_ENCHANT_SUCCESS_INFO="装备附魔成功！",t.STR_ENCHANT_ATTACH="附魔属性",t.STR_ENCHANT_ENSURE="确认附魔该装备吗？",t.STR_ENCHANT_CHANGE_ASK="该物品已有%U\n新%U\n是否替换为新附魔属性？",t.STR_ENCHANT_NUM_OVER="吸收装备栏物品不能多于30个！",t.STR_ENCHANT_SHOP="附魔道具商店",t.STR_ENCHANT_SHOP_INFO="/cFFFF00附魔点：%U【合成不会消耗附魔点】/p",t.STR_ENCHANT_SELL="附魔摆摊",t.STR_COMMON_SELL="普通摆摊",t.STR_ENCHANT_SELL_EQUIP="附魔装备",t.STR_CHANGE_SELL_ASK="切换摆摊类型后，当前上架物品将撤下，是否继续？",t.STR_CHANGE_SELL_FAIL="摆摊中无法切换摆摊类型！需先结束当前摆摊。",t.STR_ENCHANT_SELL_UP_FAIL="上架失败！身上附魔值不够。",t.STR_ENCHANT_START_FAIL="摆摊失败！身上附魔值不够。",t.STR_ENCHANT_START_SUCCESS="附魔摆摊成功！别人可以通过你的摊位进行附魔操作。",t.STR_ENCHANT_SHOP_CHOICE="选择装备",t.STR_ENCHANT_SHOP_USE_ENCNANT="消耗附魔值: %U",t.STR_ENCHANT_SHOP_BUY_INFO="售价：%U\n二次点击确认购买！该操作不会消耗您的附魔值",t.STR_ENCHANT_SHOP_BUY_NEED="消耗 %U。",t.STR_ENCHANT_SHOP_ONE_NEED="每个物品消耗附魔值： %U",t.STR_FORMATION="阵型",t.STR_FORMATION_OPTION="阵型设置",t.STR_FORGET_FORMATION="遗忘",t.STR_FORGET_TEAM_NEED="该阵型需要人数:%U人",t.STR_LEARN_FORMATION_SUCCESS="学习阵型成功！",t.STR_FORGET_FORMATION_ASK="确认是否要遗忘 /cFF0000%U/p ？",t.STR_FORGET_FORMATION_SUCCESS="遗忘阵型成功！",t.STR_OPTION_EXECUTED="已生效",t.STR_GM_EMAIL_THEME="主题",t.STR_GM_EMAIL_CONTEXT_NOT_NULL="问题内容不能为空！",t.STR_GM_EMAIL_ASK="咨询",t.STR_GM_EMAIL_APPEAR="申诉",t.STR_GM_EMAIL_RECHARGE_QUESTION="充值问题",t.STR_GM_EMAIL_SUGGEST="建议反馈",t.STR_EQUIP_INDENTIFY_LOW_RESIDUE="剩余普通卷轴/cFFFF00%U个/p\n剩余高级卷轴/cFFFF00%U个/p\n",t.STR_VITALITY_NOT_REACH="未达到",t.STR_VITALITY_HAS_REACH="可领取",t.STR_VITALITY_HAS_GET="已领取",t.STR_VITALITY_CAN_NOT_GET="不可领",t.STR_VITALITY_CAN_NOT_GET_INFO="你已领取过同类型的奖励，不能重复领取。",t.STR_VITALITY_INFO="1.同一个活跃宝箱每天只能领取一次。\n2.活跃度隔天清零，请及时领取奖品。\n3.%U活跃度额外增加100。",t.STR_VITALITY_GET_REWARD="领取奖励",t.STR_VITALITY_GET_REWARD_SUCCESS="领取奖励成功！",t.STR_VITALITY_VIP_ADD_VALUE="%U+100",t.STR_VITALITY_GET_ONLINE_REWARD="是否打开在线奖励框？",t.STR_VITALITY_SUBMIT_DAILY_QUEST="是否寻路接取日常任务？",t.STR_VITALITY_STRONG_EQUIPMENT="您可以在强化界面选择任何一种方式强化装备，包括：鉴定、镶嵌、升星。是否打开强化界面？",t.STR_VITALITY_RESOLVE_EQUIPMENT="您可以在道具界面选择物品进行分解。是否打开分解界面？",t.STR_VITALITY_ASK_FIND_PATH_SKILL="是否寻路至技能训练师处？",t.STR_VITALITY_DUEL_PLAYER="是否与其他玩家决斗？",t.STR_VITALITY_BUY_GOODS="是否打开商城界面？",t.STR_VITALITY_ENTER_ARENA="进入竞技场并完成一次战斗。是否寻路至竞技场入口处？",t.STR_VITALITY_ENTER_MOBPLACE="进入怪物攻城副本并消灭一波怪物。是否寻路至怪物攻城入口处？",t.STR_VITALITY_JION_ESCORT="是否寻路至押镖入口处？",t.STR_VITALITY_RECHARGE_MONEY="是否打开充值界面？",t.STR_VITALITY_REFINE_EQUIPMENT="在熔炉商人处进行一次炼制。是否寻路至熔炉商人？",t.STR_VITALITY_ANSWER_DAILY_QU="是否寻路至成就商人？",t.STR_VITALITY_JION_DAILY_LUCKY="是否打开登录抽奖界面？",t.STR_VITALITY_JION_CITY_LUCKY="是否寻路至飞行驿站？",t.STR_VITALITY_ASK_NOT_FIND_PATH="是否打开相应的界面？",t.STR_VITALITY_DAILY_LOGIN="打开在线奖励框。",t.STR_VITALITY_DAILY_NOT_HAVE_CITY="您还未创建自己的城市~",t.STR_VITALITY_NOT_OPEN="活跃度功能未开放！",t.STR_VITALITY_ALLVALUE="活跃度：%U",t.STR_VITALITY_LEVEL_NOTENOUGH="等级未达到分解装备的条件。",t.STR_WOOADD_BUTTON="WO+中心",t.STR_WOOADD_FLOW="您目前的流量账户余额：",t.STR_WOOADD_FLOW_STATE="广东联通携手世界OL回馈广大游戏玩家流量大礼包，每天点击礼包获赠流量奖励后可前往广东联通WO+账户中心查看或领取流量。",t.STR_WOOADD_ISMARK_TRUE="已经签到",t.STR_WOOADD_ISMARK_FALSE="可签到",t.STR_WOOADD_REWARD_FLOW="流量奖励",t.STR_MILESTONE_NOT_OPEN_TITLE=" /cFF0000%U级/p开启第%U章",t.STR_MILESTONE_HAS_OPEN_CANGET="/c00FF00已开启，请领取奖励/p",t.STR_MILESTONE_PART_INFO_TIME="/c00FF00%U内开启将得到额外奖励哦~/p\n",t.STR_MILESTONE_PART_INFO="%U\n相关任务：%U\n任务奖励：%U",t.STR_MILESTONE_CHAPTER="第%U章",t.STR_MILESTONE_PART="第%U节",t.STR_MILESTONE_MISSION_NOTOPEN="未开启",t.STR_MILESTONE_MISSION_FINISH="已完成",t.STR_MILESTONE_EXP="经验",t.STR_COUNTRY_ONLINE_INFORM_OPEN="打开国家管理上线通知",t.STR_COUNTRY_ONLINE_INFORM_CLOSE="关闭国家管理上线通知",t.STR_COLORBOX_INFO="%U\n登录天数%U\n登录天数不同获得的奖励也不同，累积/cFFFF00%U天/p更能获得%U哦！",t.STR_COLORBOX_DAY_INFO="第%U天",t.STR_COLORBOX_OPEN="开启宝箱",t.STR_COLORBOX_OPEN_ASK1="当前天数不符合领奖要求。",t.STR_COLORBOX_OPEN_ASK2="您确定要开启累计%U天的奖励：%U吗？\n ",t.STR_COLORBOX_OPEN_ASK3="%U累计登录/cFF0000 %U 天/p即可获得“%U”哦！",t.STR_PLAYER_TURNMONSTER_INFO="变身卡属性：\n%U\n技能：%U剩余时间:%U",t.STR_PLAYER_TURNMONSTER_CANCEL="取消变身卡效果",t.STR_PLAYER_TURNMONSTER_ASK="是否确认使用 %U ？",t.STR_PLAYER_TURNMONSTER_ASK_TIME="是否确认使用 %U ,增加变身效果时间？",t.STR_PLAYER_TURNMONSTER_ASK_CHA="是否确认使用 %U ,改变变身效果？",t.STR_FIGHT_VALUE="战力值:",t.STR_RANKING="排名:",t.STR_COOLING="冷却:",t.STR_CHALLENGE="挑战",t.STR_SUPER_CHALLENGE="超前挑战",t.STR_RESIDUE_CHALLENGE="剩余次数:",t.STR_RESIDUE_REFRESH_TITLE="刷新列表",t.STR_RESIDUE_REFRESH="刷新列表需要消耗%U金叶，是否刷新？",t.STR_RESIDUE_COOLING_TITLE="冷却时间",t.STR_RESIDUE_COOLING_CLEAR="清除冷却时间",t.STR_RESIDUE_COOLING="清除冷却时间需要消耗%U金叶，是否确认？",t.STR_RESIDUE_COOLING_CHALLENGE="冷却中,无法进行挑战操作!",t.STR_RESIDUE_SURPLUS_TITLE="增加剩余次数",t.STR_RESIDUE_SURPLUS="是否消耗%U黄金增加1次挑战次数？\n(注：每天最多能增加%U次挑战次数)",t.STR_RESIDUE_SURPLUS_ADD="增加挑战次数",t.STR_NEW_ARENA_ADD_COUNT_SUCCESS="增加次数成功!",t.STR_NEW_ARENA_REFRESH_SUCCESS="刷新成功!",t.STR_NEW_ARENA_CLEAR_SUCCESS="清除冷却时间成功!",t.STR_NEW_ARENA_ADJUST_SUCCESS="调整数据成功!",t.STR_NEW_ARENA_EXIT_ASK="是否确定要退出王者争霸竞技场？",t.STR_NEW_ARENA_MY_MSG="我的信息",t.STR_NEW_ARENA_ADJUST="调整",t.STR_NEW_ARENA_RANK="排行榜",t.STR_NEW_ARENA_REFRESH="刷新",t.STR_NEW_ARENA_EXIT="退出竞技场",t.STR_NEW_ARENA_ACTIVE_SUCCESS="报名成功！",t.STR_NEW_ARENA_LEAD_CHALLENGE_ASK="超前挑战需要消耗%U金叶，是否继续？",t.STR_NEW_ARENA_RANK_TITLE="王者争霸竞技场排行榜",t.STR_NEW_ARENA_RANK_SELECT="排名筛选",t.STR_NEW_ARENA_MY_RANK="我的排名",t.STR_NEW_ARENA_GET_REWARD="领取奖励",t.STR_NEW_ARENA_REWARD_TITLE="积分奖励",t.STR_NEW_ARENA_REWARD_SCORE="积分",t.STR_NEW_ARENA_RANK_ACTOR_NAME="名称",t.STR_NEW_ARENA_REWARD_POPUP="恭喜获得：黄金%U,金叶%U,铜币%U",t.STR_IDENTIFICATION_CARD="身份证",t.STR_CHINA_PASSPORT="中国护照",t.STR_FOREIGN_PASSPORT="外国护照",t.STR_MTP="台胞证",t.STR_HONGKONG_IDENTIFICATION_CARD="港澳身份证",t.STR_SOLDER_CERTIFICATE="军官士兵证",t.STR_STUDENT_CARD="学生证",t.STR_CARD_SELECT="选择证件类型",t.STR_IDENTIFY_AUTHENTICATION="身份验证",t.STR_IDENTIFY_AUTHENTICATION_CHANGE="修改身份验证",t.STR_IDENTIFY_AUTHENTICATION_NEW="上传新的身份验证",t.STR_IDENTIFY_AUTHENTICATION_CHECK="查询身份验证",t.STR_IDENTIFY_CHANGE_PROCESS="\n注意：修改流程是先填写当前已通过审核的信息并将照片上传，成功后再进行修改。",t.STR_INPUT_IDENTIFICATION_CARD_TIP="提示：请输入身份证号码和证件有效期,身份证号码位数为18位.",t.STR_INPUT_CHINA_PASSPORT_TIP="提示：请输入中国护照号码和证件有效期.",t.STR_INPUT_FOREIGN_PASSPORT_TIP="提示：请输入外国护照号码和证件有效期.",t.STR_INPUT_MTP_TIP="提示：请输入台胞证号码和证件有效期.",t.STR_INPUT_HK_IDENTIFICATION_TIP="提示：请输入港澳身份证号码和证件有效期.",t.STR_INPUT_SOLDER_CERTIFICATE_TIP="提示：请输入军官士兵证号码和证件有效期.",t.STR_INPUT_STUDENT_CARD_TIP="提示：请输入学生证号码和证件有效期.",t.STR_IDENTIFY_TYPE_VERIFY_PASS="证件类型:%U\n身份验证审核已通过！",t.STR_IDENTIFY_TYPE_VERIFYING="证件类型:%U\n身份验证审核中，请稍等！",t.STR_IDENTIFY_TYPE_CHANGET_VERIFYING="证件类型:%U\n身份验证修改审核中，请稍等！",t.STR_IDENTIFY_TYPE_PHOTO_NOT_UPLOAD="证件类型:%U\n身份验证照片没上传！",t.STR_IDENTIFY_INPUT_ID="请输入证件ID",t.STR_IDENTIFY_INPUT_ENDDATE="请输入证件有效期",t.STR_IDENTIFY_INPUT_ENDDATE_INFO="注：证件有效期格式如yyyy-mm-dd",t.STR_IDENTIFY_CHANGE_TIP="请重新填写相关信息，并拍张您需要修改的证件照片上传。",t.STR_IDENTIFY_SUBMIT_SUCCESS="身份验证提交成功，等待审核中...",t.STR_IDENTIFY_CHANGE_SUBMIT_SUCCESS="请继续上传新的证件资料（如不上传新的证件资料，则保留原验证成功证件信息。）",t.STR_MO9_PAY_TITLE="MO9快捷支付",t.STR_MO9_PAY_ASK="想充值了吗？何不试试MO9支付，土豪给你垫钱哟！",t.STR_CONTINUE_PAY="继续充值",t.STR_PLAYER_COMMON_ATT="\n普通属性：\n%U",t.STR_STR_NEW_ARENA_GET_REWARD="已获得以下奖励：\n%U",t.STR_EQ_UPGRADE_SHOP="进阶商店",t.STR_EQ_UPGRADE="进阶",t.STR_EQ_UPGRADE_EQUIP="进阶装备",t.STR_EQ_UPGRADE_ITEM_COMBIN_ALL="进阶后装备强化：",t.STR_EQ_UPGRADE_ITEM_COMBIN_ALL_INFO="首次进阶必得进阶属性，后续进阶50%几率获得新进阶属性",t.STR_EQ_UPGRADE_ITEM_COMBIN_SURE="确认进阶",t.STR_EQ_UPGRADE_ITEM_COMBIN_ERROR="您没有足够的物品进行进阶！",t.STR_COMBIN_EQUIP_ASK="即将进阶 %U ！\n%U\n是否确认进阶？",t.STR_EQ_UPGRADE_GET_INFO="进阶获得：",t.STR_EQ_UPGRADE_ITEM="您当前鉴定的装备：",t.STR_EQ_UPGRADE_GET_ATTRIBUTE="进阶属性：",t.STR_EQ_UPGRADE_GET_ITEM_INFO="请选择进阶材料，进阶后不可恢复！\n%U（再次点击确认选择）",t.STR_EQ_IDENTIFY_COMMON="传统鉴定",t.STR_EQ_IDENTIFY_UPGRADE="进阶鉴定",t.STR_EQ_IDENTIFY_CANNOT_UPGRADE="对不起，您的装备没有进阶，无法使用进阶鉴定。",t.STR_EQ_INDENTIFY_UPGRADE_RESIDUE="剩余进阶鉴定卷轴/cFFFF00%U个/p\n",t.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER="进阶效果%U:%U",t.STR_EQ_INDENTIFY_UPGRADE_INFO="\n/cff0000进阶装备保留宝石、升星和附魔属性。/p",t.STR_BAG_HAVE_NULL_CAN_UPGRADE="背包中没有可鉴定的进阶装备!",t.STR_BAG_HAVE_NULL_CAN_UPGRADESTAR="背包中没有可进阶升星的进阶装备!",t.STR_ITEM_UPGRADE_STAR="进阶升星",t.STR_ITEM_STAR="升星",t.STR_ITEM_UPGRADE_STAR_SUCCEE="装备/c00ff00进阶升星成功/p！\n",t.STR_ITEM_UPGRADE_STAR_FAIL="装备/cff0000进阶升星失败/p！\n",t.STR_ITEM_UPGRADESTAR_NUM="进阶升星：%U --\x3e %U \n",t.STR_ITEM_STAR_POWERVALUE4="进阶效果1: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE5="进阶效果2: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE6="进阶效果3: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE7="进阶效果4: %U -> %U \n",t.STR_ITEM_UPGRADESTAR_COUNT="剩余进阶升星卷轴: /cFFFF00%U/p 个 \n",t.STR_SEAL="封印",t.STR_PET_SEAL_INFO="%U\n封印有几率获得与宠物品质相对应的技能书:\n%U",t.STR_PET_SEAL_ASK="是否封印%U？\n需要消耗%U\n成功率%U%\n/cff0000(注：封印宠物不论成功或失败，宠物都会消失不可恢复)/p",t.STR_PET_SEAL_FAIL="封印失败!",t.STR_PET_SEAL_SUCCESS="封印成功!",t.STR_PET_SEAL_RS_INFO="封印获得%U",t.STR_QUESTION="问题",t.STR_ANSWER="答案",t.STR_QQ_SAFE_LOCK_ANSWER_QUESTION="设置安全问题",t.STR_QQ_SAFE_LOCK_RESET_QUESTION="重置安全问题",t.STR_QQ_SAFE_LOCK_FIND="找回安全锁",t.STR_QQ_SAFE_LOCK_QUESTION_SET="安全锁问题设置",t.STR_QQ_SAFE_LOCK_QUESTION_ANSWER="安全锁问题回答",t.STR_QQ_SAFE_LOCK_QUESTION_INFO="安全锁一旦设置不能取消，只能通过安全问题重置；如果忘记安全问题答案，请联系致电客服申请重置。",t.STR_QUESTION_ANSWER="问题回答",t.STR_QQ_SAFE_LOCK_ANSWER_NULL="答案不能为空！",t.STR_QQ_SAFE_LOCK_ANSWER_INFO="请记住您设置的安全锁问题，往后找回或更改安全锁需要输入问题及答案进行验证\n",t.STR_BATTLEGROUND_ENEMY_DEFEND_ARMY="敌方防守部队",t.STR_BATTLEGROUND_DEFEND_ARMY="我方防守部队",t.STR_BATTLEGROUND_ATTACK_ARMY="我方进攻部队",t.STR_BATTLEGROUND_ENEMY_ATTACK_ARMY="敌方进攻部队",t.STR_BATTLEGROUND_APPLY_ATTACK_ARMY="加入攻击部队",t.STR_BATTLEGROUND_APPLY_DEFEND_ARMY="加入防守部队",t.STR_BATTLEGROUND_TOWER_INFO="\t       塔楼被己方势力占领后，防守方只能在中间2分钟无敌时间进行驻扎和换人，成功防守10分钟可获得50势力积分。攻打塔楼的队伍数量无限制，可排队轮流攻打防守的队伍，但必须把全部防守队伍打败才能攻占塔楼。\n",t.STR_BATTLEGROUND_DEFEND_CANNOMOVE="塔楼攻防中不能行走！",t.STR_BATTLEGROUND_INFO="\t                     \t战场开始时间：%U \n\t                     \t战场结束时间：%U \n",t.STR_BATTLEGROUND_INFO_ESCAPE_TIME="\t                 \t逃跑惩罚剩余时间：%U \n",t.STR_BATTLEGROUND_INFO_MAP_CD_TIME="\t             \t进入战场地图冷却剩余时间：%U \n",t.STR_BATTLEGROUND_INFO_MAP_READY="战场开始前5分钟，已报名的玩家可以提前进入准备地图。\n",t.STR_BATTLEGROUND_APPLY="战场报名",t.STR_BATTLEGROUND_ENTER="进入战场准备地图",t.STR_BATTLEGROUND_ENTER_MAP="战场总地图",t.STR_BATTLEGROUND_QUITE_FIGHT="退出塔楼攻防战",t.STR_BATTLEGROUND_STATUS_FIGHT="塔楼当前处于 /cFF0000争夺/p 状态 \n",t.STR_BATTLEGROUND_STATUS_INVINCIBLE="塔楼当前处于 /c00FF00无敌/p 状态 \n",t.STR_BATTLEGROUND_CITYGATE="城门当前的耐久度为： %U / %U \n",t.STR_BATTLEGROUND_SIEGE="，成功地对敌人城门造成了严重的破坏，请继续努力，把城门摧毁。",t.STR_BATTLEGROUND_DEFENDERS="，成功地维修了己方的城门，请继续努力，把城门维修得坚不可摧。",t.STR_BATTLEGROUND_ROB_ATTACK="这名玩家正在进行/c00FF00 攻城 /p任务，你确定要攻击他吗？该劫镖任务无需提交押金，如果你成功击败他，将阻止他破坏你所属势力的城门，同时获得战场功勋。如果失败了，你将会返回准备地图。",t.STR_BATTLEGROUND_ROB_DEFENDERS="这名玩家正在进行/c00FF00 守城 /p任务，你确定要攻击他吗？该劫镖任务无需提交押金，如果你成功击败他，将阻止他维修他所属势力的城门，同时获得战场功勋。如果失败了，你将会返回准备地图。",t.STR_BATTLEGROUND_FORCES_BELONGS="\t       所属势力：",t.STR_BATTLEGROUND_FORCES_SNOWFIELDS="雪原",t.STR_BATTLEGROUND_FORCES_VOLCANO="烈焰峰",t.STR_BATTLEGROUND_FORCES_SWAMP="沼泽",t.STR_BATTLEGROUND_GLORY_INTEGRAL="战场功勋",t.STR_BATTLEGROUND_GLORY_INTEGRAL_SHOP="战场功勋商店",t.STR_INTEGRAL_BATTLE_INFO="战场功勋%U",t.STR_BATTLEGROUND_LIST_NOTHING="暂无队伍可以查看",t.STR_BATTLE="战场",t.STR_BATTLE_SIM="战",t.STR_BATTLE_BATTLEGROUND_OUT="战场战斗时间到",t.STR_BATTLE_BATTLEGROUND_RANK0="新兵",t.STR_BATTLE_BATTLEGROUND_RANK1="三等兵",t.STR_BATTLE_BATTLEGROUND_RANK2="二等兵",t.STR_BATTLE_BATTLEGROUND_RANK3="一等兵",t.STR_BATTLE_BATTLEGROUND_RANK4="上等兵",t.STR_BATTLE_BATTLEGROUND_RANK5="下士",t.STR_BATTLE_BATTLEGROUND_RANK6="中士",t.STR_BATTLE_BATTLEGROUND_RANK7="上士",t.STR_BATTLE_BATTLEGROUND_RANK8="军士长",t.STR_BATTLE_BATTLEGROUND_RANK9="少尉",t.STR_BATTLE_BATTLEGROUND_RANK10="中尉",t.STR_BATTLE_BATTLEGROUND_RANK11="上尉",t.STR_BATTLE_BATTLEGROUND_RANK12="少校",t.STR_BATTLE_BATTLEGROUND_RANK13="中校",t.STR_BATTLE_BATTLEGROUND_RANK14="上校",t.STR_BATTLE_BATTLEGROUND_RANK15="少将",t.STR_BATTLE_BATTLEGROUND_RANK16="将军",t.STR_BATTLE_BATTLEGROUND_RANK17="大将军",t.STR_BATTLE_BATTLEGROUND_RANK18="元帅",t.STR_BATTLE_BATTLEGROUND_RANK19="大元帅",t.STR_MOBILE_TRAFFIC_CARD_PHOTO_TITLE="请输入手机号码:",t.STR_GUESSGAME_EXIT_ASK="是否确定完成%U？",t.STR_GUESSGAME_LEVEL_INFO="本局:%U",t.STR_NEXT="下一关",t.STR_SURE="决定",t.STR_FINISHED="完成",t.STR_GUESSGAME_ENTRY_NEED_INFO="游戏名称:%U \n 等级需求:%U \n 可玩次数:%U\n 奖励:/c00FF00%U/p\n需要/cFFFF00%U/p，是否继续？",t.STR_GUESSGAME_NEXT_INFO="总关数:%U 胜利条件：过%U关",t.STR_GUESSGAME_CAN_NOT_NEXT="你还没选择足够的图标!",t.STR_COST_REWARD_WIN_INFO="通关：%U",t.STR_COST_REWARD_GET="恭喜获得：\n%U",t.STR_COST_REWARD_GET_INFO="编号%U的奖励在活动期间不能同时领取，只可领取其中一个，确定领取奖励？",t.STR_COST_REWARD_INFO="活动时间：%U 到 %U \n 活动期间您在指定商店累计消费总金额：\n%U",t.STR_COST_REWARD_NEED="需求",t.STR_NO_SUPPER="该版本不支持该功能！",t.CONSUMER_ACCUMULATED="消费累积",t.EGAMEFREE_MORE_GAME="更多游戏",t.QQ_LOGIN="qq登陆",t.WX_LOGIN="微信登陆",t.CAPTAIN="队长",t.MEMBER="队员",t.MEMBER_LV="%U级",t.STR_FIGHT="出战",t.STR_REST="休息",t.STR_SERVER="跨服",t.STR_SERVER_SIM="跨",t}();__reflect(GameText2.prototype,"GameText2");var WindowPanelBase=function(t){function e(){var e=t.call(this)||this;return e.effectType=PopUpManager.EffectType.NONE,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.closePanel,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.closePanel=function(){PopUpManager.removePopUp(this,this.effectType)},e}(ComponentBase);__reflect(WindowPanelBase.prototype,"WindowPanelBase",["IWindowPanel"]);var ImageSetup=function(t,e){this.imageID=t,this.palID=e};__reflect(ImageSetup.prototype,"ImageSetup");var MapSetup=function(){function t(){this.hasForeground=!1,this.preloadImagesIndex=[]}return t.prototype.load=function(e){this.name=e.readUTF();var n=e.readUnsignedByte(),i=e.readUnsignedByte(),o=n*t.GRID_WIDTH,a=i*t.GRID_HEIGHT;this.mapColumns=n,this.mapRows=i,this.mapWidth=o,this.mapHeight=a;for(var r=new Array(i),s=new Array(i*n),l=new Array(i*n),_=0;i>_;_++)r[_]=new Array(n);this.searchStep=r,this.nextSearchPosX=s,this.nextSearchPosY=l;var h=e.readUnsignedByte(),u=new Array(h);for(_=0;h>_;_++){var c=e.readShort(),T=e.readUnsignedByte();u[_]=new ImageSetup(c,T)}this.mapImages=u,this.loadTileSet(e),h=e.readUnsignedByte();var p=new Array(h);for(_=0;_<p.length;_++)p[_]=e.readInt();this.crossData=p,this.hasForeground=0!=e.readByte(),0!=this.hasForeground&&(this.playerLayer=new PlayerLayerSetup,this.playerLayer.load(e,this))},t.prototype.clearSearchTable=function(){for(var t=0;t<this.mapColumns;t++)for(var e=0;e<this.mapRows;e++)this.searchStep[e][t]=-1},t.prototype.isRotateRowColumn=function(e){return e==t.TRANS_MIRROR_ROT90||e==t.TRANS_MIRROR_ROT270||e==t.TRANS_ROT90||e==t.TRANS_ROT270},t.prototype.loadTileSet=function(t){var e=(t.readUnsignedByte(),t.readUnsignedByte());t.position+=4*e},t.TRANS_NONE=0,t.TRANS_MIRROR_ROT180=1,t.TRANS_MIRROR=2,t.TRANS_MIRROR_ROT270=4,t.TRANS_MIRROR_ROT90=7,t.TRANS_ROT180=3,t.TRANS_ROT90=5,t.TRANS_ROT270=6,t.GRID_WIDTH=24,t.GRID_HALF_WIDTH=t.GRID_WIDTH>>1,t.GRID_HALF_HALF_WIDTH=t.GRID_HALF_WIDTH>>1,t.GRID_HEIGHT=24,t.GRID_HALF_HEIGHT=t.GRID_HEIGHT>>1,t.NPC_WIDTH=t.GRID_WIDTH+t.GRID_HALF_WIDTH,t.NPC_HEIGHT=50,t.TILES_NONE=255,t}();__reflect(MapSetup.prototype,"MapSetup");var ActorConst,MapManager=function(){function t(){this.mmap={}}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.load=function(t){var e=new egret.ByteArray(t);if(!(null==e||e.length<=0))for(var n=e.readShort(),i=new Array(n),o=0;n>o;o++){var a=e.readShort(),r=e.readShort(),s=new egret.ByteArray;e.readBytes(s,s.position,r),i[a]=s}},t.prototype.insert=function(t,e){this.mmap[t]=e},t.prototype.find=function(t){var e=this.mmap[t];return null!=e?e:null},t._instance=new t,t}();__reflect(MapManager.prototype,"MapManager"),function(t){t.START_HAIR=0,t.START_FACE=1e3,t.START_HAND=2e3,t.START_FEET=3e3,t.START_SHOULDER=4e3,t.START_BACK=5e3,t.START_CLOTHES=6e3,t.START_TROUSERS=7e3,t.START_WEAPON=8e3,t.START_HELMET=1e4,t.START_PET=12e3,t.START_TRANSPORT=14e3,t.START_FLASH=15e3,t.START_MINI_SPRITE=16e3,t.BIT_1=1,t.BIT_2=3,t.BIT_3=7,t.BIT_4=15,t.BIT_5=31,t.BIT_6=63,t.BIT_7=127,t.BIT_8=255,t.BIT_9=511,t.OFFSET_SEX=0,t.OFFSET_RACE=1,t.OFFSET_JOB=3,t.OFFSET_HAIR_STYLE=7,t.OFFSET_HAIR_COLOR=11,t.OFFSET_FACE_STYLE=13,t.OFFSET_HAND_STYLE=17,t.OFFSET_HAND_COLOR=19,t.OFFSET_FEET_STYLE=21,t.OFFSET_FEET_COLOR=23,t.OFFSET_HELMET_STYLE=25,t.OFFSET_HELMET_COLOR=30,t.OFFSET_SHOULDER_STYLE=0,t.OFFSET_SHOULDER_COLOR=4,t.OFFSET_LWEAPON_STYLE=6,t.OFFSET_LWEAPON_COLOR=14,t.OFFSET_RWEAPON_STYLE=16,t.OFFSET_RWEAPON_COLOR=24,t.OFFSET_VIP=26,t.OFFSET_WEAPON_FLASH=28,t.OFFSET_SHOULDER_ADD=31,t.OFFSET_BACK_STYLE=0,t.OFFSET_BACK_COLOR=4,t.OFFSET_CLOTHES_STYLE=6,t.OFFSET_CLOTHES_COLOR=12,t.OFFSET_TROUSERS_STYLE=14,t.OFFSET_TROUSERS_COLOR=20,t.OFFSET_TRANSPORT_STYLE=22,t.OFFSET_TRANSPORT_COLOR=26,t.OFFSET_BACK_ADD=28,t.OFFSET_TRANSPORT_ADD=29,t.OFFSET_FASH_ADD=30,t.OFFSET_TRANSPORT_ADD_2=31,t.LEN_SEX=t.BIT_1,t.LEN_RACE=t.BIT_2,t.LEN_JOB=t.BIT_4,t.LEN_HAIR_STYLE=t.BIT_4,t.LEN_HAIR_COLOR=t.BIT_2,t.LEN_FACE_STYLE=t.BIT_4,t.LEN_HAND_STYLE=t.BIT_2,t.LEN_HAND_COLOR=t.BIT_2,t.LEN_FEET_STYLE=t.BIT_2,t.LEN_FEET_COLOR=t.BIT_2,t.LEN_HELMET_STYLE=t.BIT_5,t.LEN_HELMET_COLOR=t.BIT_2,t.LEN_SHOULDER_STYLE=t.BIT_4,t.LEN_SHOULDER_COLOR=t.BIT_2,t.LEN_LWEAPON_STYLE=t.BIT_8,t.LEN_LWEAPON_COLOR=t.BIT_2,t.LEN_RWEAPON_STYLE=t.BIT_8,t.LEN_RWEAPON_COLOR=t.BIT_2,t.LEN_VIP=t.BIT_2,t.LEN_WEAPON_FLASH=t.BIT_3,t.LEN_SHOULDER_ADD=t.BIT_1,t.LEN_BACK_STYLE=t.BIT_4,t.LEN_BACK_COLOR=t.BIT_2,t.LEN_CLOTHES_STYLE=t.BIT_6,t.LEN_CLOTHES_COLOR=t.BIT_2,t.LEN_TROUSERS_STYLE=t.BIT_6,t.LEN_TROUSERS_COLOR=t.BIT_2,t.LEN_TRANSPORT_STYLE=t.BIT_4,t.LEN_TRANSPORT_COLOR=t.BIT_2,t.LEN_BACK_ADD=t.BIT_1,t.LEN_TRANSPORT_ADD=t.BIT_1,t.LEN_FASH_ADD=t.BIT_1,t.LEN_TRANSPORT_ADD_2=t.BIT_1,t.OFFSET_PET_STYLE=0,t.OFFSET_PET_COLOR=6,t.OFFSET_LVUP_STYLE=8,t.LEN_PET_STYLE=t.BIT_6,t.LEN_PET_COLOR=t.BIT_2,t.LEN_LVUP_STYLE=t.BIT_4}(ActorConst||(ActorConst={}));var Animate=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.sx=0,e.sy=0,e.originalX=0,e.originalY=0,e.loopTime=-1,e.frameIndex=0,e.curFrameDurationCounter=0,e.curFrameDuration=0,e.leftTime=0,e}return __extends(e,t),e.prototype.setLoopTime=function(t){this.loopTime=t,this.init()},e.prototype.getLoopTime=function(){return this.loopTime},e.prototype.init=function(){this.frameIndex=0,this.curFrameDurationCounter=0,this.sx=0,this.sy=0,this.originalX=this.x,this.originalY=this.y,this.onInit()},e.prototype.onInit=function(){},e.prototype.getCurFrame=function(){return this.frameIndex},e.prototype.getWidth=function(){return this.sprite.get(0).$bitmapWidth},e.prototype.getHeight=function(){return this.sprite.get(0).$bitmapHeight},e}(egret.DisplayObjectContainer);__reflect(Animate.prototype,"Animate");var Animation=function(t){function e(e,n){var i=t.call(this)||this;return i.setup=e,i.sprite=n,i.name="animation",i}return __extends(e,t),e.prototype.getAnimationID=function(){return this.setup.animationID},e.prototype.getCheckID=function(){return this.setup.checkID},e.prototype.onInit=function(){this.frameIndex=0;var t=(this.sprite,this.setup.frames);if(null!=t){var e=t[0];this.leftTime=e.duration,this.leftTime=e.duration}},e.prototype.action=function(t){},e.prototype.ontick=function(t){var e=this.loopTime;if(0==e)return!1;if(this.leftTime-=t,this.leftTime>0)return!1;var n=this.sprite,i=this.setup.frames;if(null==i)return!1;var o,a=this.frameIndex;return o=i[a],this.sx+=o.xSpeed*t,this.sy+=o.ySpeed*t,++a>=i.length&&(-1==e?a=0:e>0?(a=0,0>=--e&&(a=i.length-1,null!=n&&n.isMotionTurnOff()&&n.setMotionAlive(!1))):a=i.length-1),o=i[a],this.leftTime=o.duration,this.loopTime=e,this.frameIndex=a,this.render(),!0},e.prototype.render=function(){var t=this.sprite,e=t.frames,n=this.frameIndex,i=this.setup.frameIds[n],o=e[i];if(null!=o){this.x=this.originalX+this.sx,this.y=this.originalY+this.sy;var a=(this.numChildren,t.get(i));if(null!=a){t.body.texture=a,t.body.anchorOffsetX=a.xratio,t.body.anchorOffsetY=a.yratio;for(var r=t.cloakSprite,s=(t.innerSprite,0),l=0,_=0;_<o.setup.array.length;_++){var h=o.setup.array[_],u=t.setup.fragmentIds.indexOf(h.fragmentFileId),c=t.fragmentFiles[u];if(null!=c&&Math.floor(c.getNameID()/1e3)==GameSprite.PNG_CLOTHES){s=this.sx+h.centerX,l=this.sy+h.centerY;break}}null!=r&&(r.x=s,r.y=l)}}},e}(Animate);__reflect(Animation.prototype,"Animation");var Random=function(){function t(e){this.seed=new bigInt(e).xor(t.RANDOM_SEED_MASTER).and(t.RANDOM_SEED_MASK)}return t.prototype.next=function(e){this.seed=this.seed.multiply(t.RANDOM_SEED_MASTER).add(t.ADDEND).and(t.RANDOM_SEED_MASK);var n=this.seed.shiftRight(48-e).value;return t.unsignedInt2int(n)},t.prototype.nextInt=function(){return this.next(32)},t.unsignedInt2int=function(t){var e=4294967295&t;return e>Tool.MAX_VALUE_int?-(1+(4294967295^e)):e},t.RANDOM_SEED_MASTER=new bigInt(25214903917),t.ADDEND=11,t.RANDOM_SEED_MASK=bigInt.one.shiftLeft(48).subtract(1),t}();__reflect(Random.prototype,"Random");var Define=function(){function t(){}return t.checkID=function(t){return!0},t.getAreaID=function(e,n){var i=e/t.ID_PER_AREA>>0,o=e%t.ID_PER_AREA,a=t.startChar+i,r=-1;return a>t.endChar&&(r=t.startChar+a%t.endChar-1,a=t.startChar),1==n?-1!=r?""+t.getCharByCodeNumber(a)+t.getCharByCodeNumber(r)+o:""+t.getCharByCodeNumber(a)+o:""+o},t.getCharByCodeNumber=function(e){if(e<t.startChar||e>t.endChar)return"";var n=e-t.startChar;return"abcdefghijklmnopqrstuvwxyz".charAt(n)},t.getCodeNumberByChar=function(e){if(!e||1!=e.length)return-1;var n="abcdefghijklmnopqrstuvwxyz".indexOf(e);return n>=0?t.startChar+n:-1},t.getIdByAreaID=function(e,n){if(null==e||""==e.trim())return 0;if(e.length<=0)return 0;var i=t.getCodeNumberByChar(e.charAt(0)),o=-1;e.length>=2&&(o=t.getCodeNumberByChar(e.charAt(1)));var a=0;return i>=t.startChar&&i<=t.endChar?o>=t.startChar&&o<=t.endChar?(a=t.endChar-t.startChar+1+(o-t.startChar),e=e.substring(2)):(a=i-t.startChar,e=e.substring(1)):a=n/t.ID_PER_AREA>>0,a*t.ID_PER_AREA+Tool.parseInt(e,0)},t.getAnimeStartType=function(t){return Number(7&t)},t.getAnimeTraceType=function(t){return Number(t>>3&7)},t.processBattlePower=function(e,n,i,o,a,r,s,l,_,h){if(null!=e&&null!=n&&!(0>=a)){if(s==t.BUFFER_RESIST_DIE_1HP&&n.isTabStatus(Model.BUFFER_DIE_1HP_CHECK)&&(s=0),s==t.BUFFER_RESIST_DIE_FULLHP&&n.isTabStatus(Model.BUFFER_DIE_FULLHP_CHECK)&&(s=0),s==t.BUFFER_RESIST_DIE_DELAY&&n.isTabStatus(Model.BUFFER_DIE_DELAY_CHECK)&&(s=0),s!=t.BUFFER_NONE){if(s!=t.BUFFER_TYPE_BUFF&&s!=t.BUFFER_TYPE_DEBUFF&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_INVINCIBLE)))return void WorldMessage.addSystemChat(t.getBufferString(s)+"无效,("+PowerString.makeColorString(n.getName(),65280)+")无敌状态!");if(t.getBufferType(s)==t.BUFFER_TYPE_DEBUFF){if(n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_DEBUFF)))return void WorldMessage.addSystemChat(t.getBufferString(s)+"无效,("+PowerString.makeColorString(n.getName(),65280)+")全减益免疫!");if(s==t.BUFFER_STUN&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_STUN)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫定身!");if(s==t.BUFFER_SILENCE&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_SILENCE)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫封魔!");if(s==t.BUFFER_CHAO&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_CHAO)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫混乱!");if(s==t.BUFFER_BLOCK_TALK&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_TALK)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫禁言!");if(s==t.BUFFER_BLOCK_SKILL&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_SKILL)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫封技!");if(s==t.BUFFER_WEAK&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_RESIST_WEAK)))return void WorldMessage.addSystemChat("("+PowerString.makeColorString(n.getName(),65280)+")免疫衰弱!");if(1==e.isWilSuccess(n,i,o))return void WorldMessage.addSystemChat(t.getBufferString(s)+"无效,("+PowerString.makeColorString(n.getName(),65280)+")状态抵抗!")}}var u=0,c=-1,T=0;switch(a){case t.POWER_SWORD_ATK_TIME:case t.POWER_BLADE_ATK_TIME:case t.POWER_HEAVY_ATK_TIME:case t.POWER_LANCE_ATK_TIME:case t.POWER_STAFF_ATK_TIME:case t.POWER_HAND_ATK_TIME:case t.POWER_BOW_ATK_TIME:case t.POWER_HAND_ITEM_ATK_TIME:case t.POWER_ALL_ATK_TIME:case t.POWER_BALL_ATK_TIME:case t.POWER_GUN_ATK_TIME:var p=n.getEquipWeaponType();if(a==t.POWER_SWORD_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_SWORD&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_SWORD)return;if(a==t.POWER_BLADE_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_BLADE&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_BLADE)return;if(a==t.POWER_HEAVY_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY)return;if(a==t.POWER_LANCE_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_LANCE)return;if(a==t.POWER_STAFF_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_STAFF)return;if(a==t.POWER_BALL_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_BALL)return;if(a==t.POWER_GUN_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_GUN&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_GUN)return;if(a==t.POWER_HAND_ATK_TIME&&p!=t.BACK_ERROR_NULL_HAND)return;if(a==t.POWER_BOW_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_BOW)return;if(a==t.POWER_HAND_ITEM_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_HAND)return;c=ModelConst.ATK_TIME,u=r,n.addValue(c,u);break;case t.POWER_SWORD_PERCENT:case t.POWER_BLADE_PERCENT:case t.POWER_HEAVY_PERCENT:case t.POWER_LANCE_PERCENT:case t.POWER_STAFF_PERCENT:case t.POWER_HAND_PERCENT:case t.POWER_BOW_PERCENT:case t.POWER_HAND_ITEM_PERCENT:case t.POWER_BALL_PERCENT:case t.POWER_GUN_PERCENT:case t.POWER_ALL_PERCENT:if(p=n.getEquipWeaponType(),a==t.POWER_SWORD_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_SWORD&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_SWORD)return;if(a==t.POWER_BLADE_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_BLADE&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_BLADE)return;if(a==t.POWER_HEAVY_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY)return;if(a==t.POWER_LANCE_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_LANCE)return;if(a==t.POWER_STAFF_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_STAFF)return;if(a==t.POWER_BALL_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_BALL)return;if(a==t.POWER_GUN_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_GUN&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_GUN)return;if(a==t.POWER_HAND_ATK_TIME&&p!=t.BACK_ERROR_NULL_HAND)return;if(a==t.POWER_BOW_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW&&p!=t.ITEM_TYPE_WEAPON_TWOHAND_BOW)return;if(a==t.POWER_HAND_ITEM_ATK_TIME&&p!=t.ITEM_TYPE_WEAPON_ONEHAND_HAND)return;c=ModelConst.WEAPON_DAMAGE_PERCENT,u=r,n.addValue(c,u);break;case t.POWER_SPEED:c=ModelConst.SPEED,u=r,n.addValue(c,u);break;case t.POWER_SPEED_PERCENT:c=ModelConst.SPEED,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_ATK_STR:c=ModelConst.ATK_STR,u=r,n.addValue(c,u);break;case t.POWER_ATK_STR_PERCENT:c=ModelConst.ATK_STR,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_ATK_AGI:c=ModelConst.ATK_AGI,u=r,n.addValue(c,u);break;case t.POWER_ATK_AGI_PERCENT:c=ModelConst.ATK_AGI,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_ATK_MAGIC:c=ModelConst.ATK_MAGIC,u=r,n.addValue(c,u);break;case t.POWER_ATK_MAGIC_PERCENT:c=ModelConst.ATK_MAGIC,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_DEF_STR:c=ModelConst.DEF_STR,u=r,n.addValue(c,u);break;case t.POWER_DEF_STR_PERCENT:c=ModelConst.DEF_STR,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_DEF_AGI:c=ModelConst.DEF_AGI,u=r,n.addValue(c,u);break;case t.POWER_DEF_AGI_PERCENT:c=ModelConst.DEF_AGI,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_DEF_MAGIC:c=ModelConst.DEF_MAGIC,u=r,n.addValue(c,u);break;case t.POWER_DEF_MAGIC_PERCENT:c=ModelConst.DEF_MAGIC,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_CRITICAL:c=ModelConst.CRITICAL,u=r,n.addValue(c,u);break;case t.POWER_CRITICAL_PERCENT:c=ModelConst.CRITICAL,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_MAGIC_HITRATE:c=ModelConst.HIT_MAGIC,u=r,n.addValue(c,u);break;case t.POWER_MAGIC_HITRATE_PERCENT:c=ModelConst.HIT_MAGIC,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_HITRATE:c=ModelConst.HIT_RATE,u=r,n.addValue(c,u);break;case t.POWER_HITRATE_PERCENT:c=ModelConst.HIT_RATE,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_HIT_FORCE:c=ModelConst.FORCE_HIT,u=r,n.addValue(c,u);break;case t.POWER_HIT_FORCE_PERCENT:c=ModelConst.FORCE_HIT,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_DODGE:c=ModelConst.DODGE,u=r,n.addValue(c,u);break;case t.POWER_DODGE_PERCENT:c=ModelConst.DODGE,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_WIL:c=ModelConst.WIL,u=r,n.addValue(c,u);break;case t.POWER_WIL_PERCENT:c=ModelConst.WIL,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_TOUGH:c=ModelConst.TOUGH,u=r,n.addValue(c,u);break;case t.POWER_TOUGH_PERCENT:c=ModelConst.TOUGH,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_PENETRATION:c=ModelConst.BRK_ARMOR,u=r,n.addValue(c,u);break;case t.POWER_PENETRATION_PERCENT:c=ModelConst.BRK_ARMOR,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_MAGIC_PENETRATION:c=ModelConst.MAGIC_PENETRATION,u=r,n.addValue(c,u);break;case t.POWER_MAGIC_PENETRATION_PERCENT:c=ModelConst.MAGIC_PENETRATION,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_BLOCK:c=ModelConst.BLOCK,u=r,n.addValue(c,u);break;case t.POWER_BLOCK_PERCENT:c=ModelConst.BLOCK,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_DEF_FIELD:c=ModelConst.DEF_FIELD,u=r,n.addValue(c,u);break;case t.POWER_DEF_FIELD_PERCENT:c=ModelConst.DEF_FIELD,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_INSIGHT:c=ModelConst.INSIGHT,u=r,n.addValue(c,u);break;case t.POWER_INSIGHT_PERCENT:c=ModelConst.INSIGHT,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_BACK:c=ModelConst.BACK,u=r,n.addValue(c,u);break;case t.POWER_BACK_PERCENT:c=ModelConst.BACK,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_MAGIC_BACK:c=ModelConst.MAGIC_BACK,u=r,n.addValue(c,u);break;case t.POWER_MAGIC_BACK_PERCENT:c=ModelConst.MAGIC_BACK,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_LIFE_ABSORPTION:c=ModelConst.LIFE_ABSORPTION,u=r,n.addValue(c,u);break;case t.POWER_LIFE_ABSORPTION_PERCENT:c=ModelConst.LIFE_ABSORPTION,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_MANA_ABSORPTION:c=ModelConst.MANA_ABSORPTION,u=r,n.addValue(c,u);break;case t.POWER_MANA_ABSORPTION_PERCENT:c=ModelConst.MANA_ABSORPTION,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_HEAL_RECOVERY:c=ModelConst.HEAL_RECOVERY,u=r,n.addValue(c,u);break;case t.POWER_HEAL_RECOVERY_PERCENT:c=ModelConst.HEAL_RECOVERY,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_MANA_RECOVERY:c=ModelConst.MANA_RECOVERY,u=r,n.addValue(c,u);break;case t.POWER_MANA_RECOVERY_PERCENT:c=ModelConst.MANA_RECOVERY,u=r*n.get(c)/100>>0,n.addValue(c,u);break;case t.POWER_HP:if(c=ModelConst.HP,u=r,null!=o&&o.area!=t.SKILL_AREA_MY_SELF&&t.processBattleKeepOutPower(n,u,h))break;if(u>0&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_BURN))&&(u=u/2>>0),0==t.processBattleHpMpPower(n,c,u,_,h))return void t.addBufferBySpecial(l,c,u,s,n,e,_);e.checkDie1Hp(n,null);break;case t.POWER_HP_PERCENT:if(c=ModelConst.HP,u=r*n.get(ModelConst.HPMAX)/100>>0,null!=o&&o.area!=t.SKILL_AREA_MY_SELF&&t.processBattleKeepOutPower(n,u,h))break;if(0>u){var d=Battle.calTouch(n);null!=i&&n!=i&&(d-=i.get(ModelConst.IGNORE_TOUCH)),d>Battle.MAX_RATE_TOUCH&&(d=Battle.MAX_RATE_TOUCH),d>0&&((u-=u*d/1e3>>0)>0&&(u=0))}if(u>0&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_BURN))&&(u=u/2>>0),0==t.processBattleHpMpPower(n,c,u,_,h))return void t.addBufferBySpecial(l,c,u,s,n,e,_);e.checkDie1Hp(n,null);break;case t.POWER_RECOVER:if(0==t.processBattleReborn(n,u,u,_,h))return;break;case t.POWER_RECOVER_PERCENT:var E=r*n.get(ModelConst.HPMAX)/100>>0,g=r*n.get(ModelConst.MPMAX)/100>>0;if(0==t.processBattleReborn(n,E,g,_,h))return;break;case t.POWER_MP:if(c=ModelConst.MP,(u=r)>0&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_POISON))&&(u=u/2>>0),0==t.processBattleHpMpPower(n,c,u,_,h))return void t.addBufferBySpecial(l,c,u,s,n,e,_);break;case t.POWER_MP_PERCENT:if(c=ModelConst.MP,(u=r*n.get(ModelConst.MPMAX)/100>>0)>0&&n.isBattleStatus(t.getBufferBitValue(t.BUFFER_POISON))&&(u=u/2>>0),0==t.processBattleHpMpPower(n,c,u,_,h))return void t.addBufferBySpecial(l,c,u,s,n,e,_);break;case t.POWER_REMOVE_STATUS:c=ModelConst.BUFFER_REMOVE_STATUS,u=r,n.removeBufferByStatus(r);break;case t.POWER_KEEPOUT_ATK_TIME:c=ModelConst.KEEPOUT_ATK_TIME,u=r,T=n.keepout_atk_time,0>u&&0>=T+u&&n.isTabStatus(Model.TAG_IS_KEEP_OUT)&&u++,n.addValue(c,u)}if(l>0&&c>=0){if(0==u&&s==t.BUFFER_NONE)return;l--;var S=n.readAddValue;a==t.POWER_KEEPOUT_ATK_TIME&&0>u&&n.isTabStatus(Model.TAG_IS_KEEP_OUT)&&(T--,S=n.keepout_atk_time-T);var m=new PlayerBuffer(e,c,u,s,l,_,S);n.addBuffer(m)}}},t.addBufferBySpecial=function(e,n,i,o,a,r,s){if(o==t.BUFFER_DIE_CANNOT_RELIVE&&e>0&&n>=0){if(0==i&&o==t.BUFFER_NONE)return;e--;var l=a.readAddValue,_=new PlayerBuffer(r,n,i,o,e,s,l);a.addBuffer(_)}},t.processBattleReborn=function(e,n,i,o,a){if(0==e.isDead())return!1;if(e.isBattleStatus(t.getBufferBitValue(t.BUFFER_DIE_CANNOT_RELIVE)))return!1;e.clearBufferList(!0),e.addValue(ModelConst.HP,n);var r=BattleConst.EFFECT_HIT|BattleConst.EFFECT_REBORN,s=Control.createBattleTargetEffectOther(e.position,n,r,o);return null!=a&&a.push(s),0!=i&&e.addValue(ModelConst.MP,i),!0},t.processBattleKeepOutPower=function(t,e,n){if(null==t)return!1;if(e>=0)return!1;if(t.keepout_atk_time<=0)return!1;var i=BattleConst.EFFECT_HIT;0==t.isTabStatus(Model.TAG_IS_KEEP_OUT)&&(i|=BattleConst.EFFECT_KEEPOUT),t.setTabStatus(!0,Model.TAG_IS_KEEP_OUT);var o=Control.createBattleTargetEffect(!1,t.position,0,i,0);return null!=n&&n.push(o),!0},t.processBattleHpMpPower=function(e,n,i,o,a){return t.processBattleHpMpPowerBySelf(e,n,i,o,a,!1)},t.processBattleHpMpPowerBySelf=function(t,e,n,i,o,a){if(null==t)return!1;if(t.isDead())return!1;t.addValue(e,n);var r=BattleConst.EFFECT_HIT;e==ModelConst.HP?t.isDeadNoWithDelay()&&(r|=BattleConst.EFFECT_DIE):r|=BattleConst.EFFECT_MP_CHANGE;var s=Control.createBattleTargetEffect(a,t.position,n,r,i);return null!=o&&o.push(s),!0},t.processWorldPower=function(e,n,i){if(null==e)return!1;if(0>=n)return!1;switch(n){case t.POWER_HP:return t.addValuePlayer(e,ModelConst.HP,i,!1,-1),!0;case t.POWER_HP_PERCENT:return t.addValuePlayer(e,ModelConst.HP,i,!0,ModelConst.HPMAX),!0;case t.POWER_MP:return t.addValuePlayer(e,ModelConst.MP,i,!1,-1),!0;case t.POWER_MP_PERCENT:return t.addValuePlayer(e,ModelConst.MP,i,!0,ModelConst.MPMAX),!0}return!1},t.addValuePlayer=function(t,e,n,i,o){if(null!=t){var a=function(t){return i?n*t.get(o)/100>>0:n},r=a(t);t.addValue(e,r);var s=t.getPet();if(s){var l=a(s);s.addValue(e,l)}var _=t.getMerList();if(_)for(var h=0;h<_.length;h++){var u=_[h];if(null!=u){var c=a(u);u.addValue(e,c),null!=(s=u.getPet())&&(c=a(s),s.addValue(e,c))}}}},t.getPowerDesc=function(e,n,i,o,a){void 0===i&&(i=0),void 0===o&&(o=!0),void 0===a&&(a=null);var r="",s="",l="";i>0?l="(+"+i+")":0>i&&(l="("+-i+")"),0==o&&(l=PowerString.makeColorString(l,ColorUtils.COLOR_GRAY));var _=n+i,h=n+l,u=-n+l;switch(e){case t.POWER_STR:return _>=0?"力量+"+h:"力量"+h;case t.POWER_STR_PERCENT:return _>=0?"力量+"+h+"%":"力量"+h+"%";case t.POWER_CON:return _>=0?"体质+"+h:"体质"+h;case t.POWER_CON_PERCENT:return _>=0?"体质+"+h+"%":"体质"+h+"%";case t.POWER_AGI:return _>=0?"敏捷+"+h:"敏捷"+h;case t.POWER_AGI_PERCENT:return _>=0?"敏捷+"+h+"%":"敏捷"+h+"%";case t.POWER_ILT:return _>=0?"智力+"+h:"智力"+h;case t.POWER_ILT_PERCENT:return _>=0?"智力+"+h+"%":"智力"+h+"%";case t.POWER_WIS:return _>=0?"感知+"+h:"感知"+h;case t.POWER_WIS_PERCENT:return _>=0?"感知+"+h+"%":"感知"+h+"%";case t.POWER_HPMAX:return _>=0?"生命上限+"+h:"生命上限"+h;case t.POWER_HPMAX_PERCENT:return _>=0?"生命上限+"+h+"%":"生命上限"+h+"%";case t.POWER_MPMAX:return _>=0?"法力上限+"+h:"法力上限"+h;case t.POWER_MPMAX_PERCENT:return _>=0?"法力上限+"+h+"%":"法力上限"+h+"%";case t.POWER_SWORD_PERCENT:return _>=0?"剑类武器伤害、耐久+"+h+"%":"剑类武器伤害、耐久"+h+"%";case t.POWER_BLADE_PERCENT:return _>=0?"刀类伤害、耐久+"+h+"%":"刀类伤害、耐久"+h+"%";case t.POWER_HEAVY_PERCENT:return _>=0?"重型武器伤害、耐久+"+h+"%":"重型武器伤害、耐久"+h+"%";case t.POWER_LANCE_PERCENT:return _>=0?"长柄武器伤害、耐久+"+h+"%":"长柄武器伤害、耐久"+h+"%";case t.POWER_STAFF_PERCENT:return _>=0?"法杖武器伤害、耐久+"+h+"%":"法杖武器伤害、耐久"+h+"%";case t.POWER_BALL_PERCENT:return _>=0?"法器武器伤害、耐久+"+h+"%":"法器武器伤害、耐久"+h+"%";case t.POWER_HAND_PERCENT:return _>=0?"空手伤害+"+h+"%":"空手伤害"+h+"%";case t.POWER_BOW_PERCENT:return _>=0?"远程武器伤害、耐久+"+h+"%":"远程武器伤害、耐久"+h+"%";case t.POWER_HAND_ITEM_PERCENT:return _>=0?"手持物伤害、耐久+"+h+"%":"手持物伤害、耐久"+h+"%";case t.POWER_ALL_PERCENT:return _>=0?"武器伤害、耐久+"+h+"%":"武器伤害、耐久"+h+"%";case t.POWER_EQUIP_ARMOR_DUR_PERCENT:return _>=0?"装备防具耐久+"+h+"%":"装备防具耐久"+h+"%";case t.POWER_SPEED_PERCENT:return _>=0?"出手速度+"+h+"%":"出手速度"+h+"%";case t.POWER_HITRATE_PERCENT:return _>=0?"命中率+"+h+"%":"命中率"+h+"%";case t.POWER_DODGE_PERCENT:return _>=0?"躲闪 +"+h+"%":"躲闪 "+h+"%";case t.POWER_MAGIC_HITRATE_PERCENT:return _>=0?"魔法命中+"+h+"%":"魔法命中"+h+"%";case t.POWER_CRITICAL_PERCENT:return _>=0?"致命率+"+h+"%":"致命率"+h+"%";case t.POWER_ATK_STR_PERCENT:return _>=0?"劈砍攻击力+"+h+"%":"劈砍攻击力"+h+"%";case t.POWER_ATK_AGI_PERCENT:return _>=0?"穿刺攻击力+"+h+"%":"穿刺攻击力"+h+"%";case t.POWER_ATK_MAGIC_PERCENT:return _>=0?"魔法攻击力+"+h+"%":"魔法攻击力"+h+"%";case t.POWER_DEF_STR_PERCENT:return _>=0?"劈砍防御力+"+h+"%":"劈砍防御力"+h+"%";case t.POWER_DEF_AGI_PERCENT:return _>=0?"穿刺防御力+"+h+"%":"穿刺防御力"+h+"%";case t.POWER_DEF_MAGIC_PERCENT:return _>=0?"魔法防御力+"+h+"%":"魔法防御力"+h+"%";case t.POWER_WIL_PERCENT:return _>=0?"基础状态抵抗+"+h+"%":"基础状态抵抗"+h+"%";case t.POWER_TOUGH_PERCENT:return _>=0?"伤害减免+"+h+"%":"伤害减免"+h+"%";case t.POWER_BLOCK_PERCENT:return _>=0?"格挡+"+h+"%":"格挡"+h+"%";case t.POWER_INSIGHT_PERCENT:return _>=0?"洞察+"+h+"%":"洞察"+h+"%";case t.POWER_PENETRATION_PERCENT:return _>=0?"破甲+"+h+"%":"破甲"+h+"%";case t.POWER_DEF_FIELD_PERCENT:return _>=0?"法力护盾+"+h+"%":"法力护盾"+h+"%";case t.POWER_BACK_PERCENT:return _>=0?"反击+"+h+"%":"反击"+h+"%";case t.POWER_MAGIC_BACK_PERCENT:return _>=0?"魔法反馈+"+h+"%":"魔法反馈"+h+"%";case t.POWER_LIFE_ABSORPTION_PERCENT:return _>=0?"生命吸收+"+h+"%":"生命吸收"+h+"%";case t.POWER_MANA_ABSORPTION_PERCENT:return _>=0?"法力吸收+"+h+"%":"法力吸收"+h+"%";case t.POWER_MAGIC_PENETRATION_PERCENT:return _>=0?"魔法穿透+"+h+"%":"魔法穿透"+h+"%";case t.POWER_HIT_FORCE_PERCENT:return _>=0?"强制命中率+"+h+"%":"强制命中率"+h+"%";case t.POWER_HEAL_RECOVERY_PERCENT:return _>=0?"每回合自动恢复生命+"+h+"%":"每回合自动造成生命"+u+"%的伤害";case t.POWER_MANA_RECOVERY_PERCENT:return _>=0?"每回合自动恢复法力+"+h+"%":"每回合自动造成法力"+u+"%的伤害";case t.POWER_HP:return _>=0?"生命+"+h:"生命"+h;case t.POWER_HP_PERCENT:return _>=0?"回复最大生命值+"+h+"%":"造成最大生命值"+u+"%的伤害";case t.POWER_MP:return _>=0?"法力+"+h:"法力"+n;case t.POWER_MP_PERCENT:return _>=0?"回复最大法力值+"+h+"%":"扣除最大法力值"+u+"%";case t.POWER_SPEED:return _>=0?"出手速度+"+h:"出手速度"+h;case t.POWER_HITRATE:return _>=0?"命中+"+h:"命中"+h;case t.POWER_DODGE:return _>=0?"躲闪 +"+h:"躲闪 "+h;case t.POWER_MAGIC_HITRATE:return _>=0?"魔法命中+"+h:"魔法命中"+h;case t.POWER_CRITICAL:return _>=0?"致命点+"+h:"致命点"+h;case t.POWER_ATK_STR:return _>=0?"劈砍攻击力+"+h:"劈砍攻击力"+h;case t.POWER_ATK_AGI:return _>=0?"穿刺攻击力+"+h:"穿刺攻击力"+h;case t.POWER_ATK_MAGIC:return _>=0?"魔法攻击力+"+h:"魔法攻击力"+h;case t.POWER_DEF_STR:return _>=0?"劈砍防御力+"+h:"劈砍防御力"+h;case t.POWER_DEF_AGI:return _>=0?"穿刺防御力+"+h:"穿刺防御力"+h;case t.POWER_DEF_MAGIC:return _>=0?"魔法防御力+"+h:"魔法防御力"+h;case t.POWER_WIL:return _>=0?"状态抵抗值+"+h:"状态抵抗值"+h;case t.POWER_TOUGH:return _>=0?"伤害减免+"+h:"伤害减免"+h;case t.POWER_BLOCK:return _>=0?"格挡+"+h:"格挡"+h;case t.POWER_INSIGHT:return _>=0?"洞察+"+h:"洞察"+h;case t.POWER_PENETRATION:return _>=0?"破甲+"+h:"破甲"+h;case t.POWER_DEF_FIELD:return _>=0?"法力护盾+"+h:"法力护盾"+h;case t.POWER_BACK:return _>=0?"反击+"+h:"反击"+h;case t.POWER_MAGIC_BACK:return _>=0?"魔法反馈+"+h:"魔法反馈"+h;case t.POWER_LIFE_ABSORPTION:return _>=0?"基础生命吸收+"+h:"基础生命吸收"+h;case t.POWER_MANA_ABSORPTION:return _>=0?"基础法力吸收+"+h:"基础法力吸收"+h;case t.POWER_MAGIC_PENETRATION:return _>=0?"魔法穿透+"+h:"魔法穿透"+h;case t.POWER_HIT_FORCE:return n+i>=0?"基础强制命中率+"+h:"基础强制命中率"+h;case t.POWER_HEAL_RECOVERY:return _>=0?"每回合自动恢复生命+"+h:"每回合自动扣除生命"+h;case t.POWER_MANA_RECOVERY:return _>=0?"每回合自动恢复法力+"+h:"每回合自动扣除法力"+h;case t.POWER_REMOVE_STATUS:return"清除目标"+t.getBufferString(_)+"状态";case t.POWER_RECOVER:return"战斗中复活并回复生命和法力"+h+"点";case t.POWER_SKILL_DAMAGE:return _>=0?"技能附带伤害+"+h:"技能附带伤害"+h;case t.POWER_SKILL_HITRATE:if(r+="技能附带",null!=a&&a instanceof Skill){var c=a;r+=c.skillAtkType==t.ATKTYPE_MAGIC||c.skillAtkType==t.ATKTYPE_CURSE?"魔法":"物理"}return(r+="命中"+(_>=0?"+"+h:""+h)).toString();case t.POWER_SELF_CRITICAL:return _>=0?"附带致命点+"+h:"附带致命点"+h;case t.POWER_SKILL_HIT_FORCE:return _>=0?"附加强制命中率+"+h+"%":"附加强制命中率"+h+"%";case t.POWER_SKILL_MAGIC_PENETRATION:return _>=0?"无视目标+"+h+"点法术防御":"无视目标"+h+"点法术防御";case t.POWER_SKILL_BRK_ARMOR:return _>=0?"无视目标+"+h+"点物理防御":"技能附带破甲"+h+"点物理防御";case t.POWER_SKILL_REMOVE_STATUS:return"清除自身"+t.getBufferString(_)+"状态";case t.POWER_PET_DAMAGE:return _>=0?"宠物伤害+"+h+"%":"宠物伤害"+h+"%";case t.POWER_PET_HPMAX_PERCENT:return _>=0?"宠物生命上限+"+h+"%":"宠物生命上限"+h+"%";case t.POWER_PET_MPMAX_PERCENT:return _>=0?"宠物法力上限+"+h+"%":"宠物法力上限"+h+"%";case t.POWER_PET_STR_PERCENT:return _>=0?"宠物力量+"+h+"%":"宠物力量"+h+"%";case t.POWER_PET_CON_PERCENT:return _>=0?"宠物体质+"+h+"%":"宠物体质"+h+"%";case t.POWER_PET_AGI_PERCENT:return _>=0?"宠物敏捷+"+h+"%":"宠物敏捷"+h+"%";case t.POWER_PET_ILT_PERCENT:return _>=0?"宠物智力+"+h+"%":"宠物智力"+h+"%";case t.POWER_PET_WIS_PERCENT:return _>=0?"宠物感知+"+h+"%":"宠物感知"+h+"%";case t.POWER_RECOVER_PERCENT:return"复活并回复体力及法力"+h+"%";case t.POWER_HPMP_RECOVER:return"战斗后，自动恢复生命和法力"+h+"%";case t.POWER_OPEN_STORE:return"开通"+h+"格仓库";case t.POWER_TO_WORLDMAP:return _>=0?"传送到世界地图+"+h:"传送到世界地图"+h;case t.POWER_CHEST_LV1:return"直接开启";case t.POWER_CHEST_LV2:return"需要万能钥匙";case t.POWER_CHEST_LV3:return"需要神秘钥匙";case t.POWER_REQ_SLOT:return"";case t.POWER_TO_GXGY:return _>=0?"ToXY+"+h:"ToXY "+h;case t.POWER_EXPIRE_TIME:return"";case t.POWER_RESET_MISSION:return _>=0?"重置任务+"+h:"重置任务"+h;case t.POWER_CHEST_KEY_LEVEL:case t.POWER_PET_EGG:case t.POWER_TRANSPORT:return"";case t.POWER_POWER_TITLE:return _>=0?"称号+"+h:"称号"+h;case t.POWER_GUARD_STR_ATTACK:return h+"%几率替目标抵挡劈砍攻击";case t.POWER_GUARD_AGI_ATTACK:return h+"%几率替目标抵挡穿刺攻击";case t.POWER_GUARD_MAGIC_ATTACK:return h+"%几率替目标抵挡魔法攻击";case t.POWER_GUARD_CURSE_ATTACK:return h+"%几率替目标抵挡诅咒攻击";case t.POWER_GUARD_ALL_ATTACK:return h+"%几率替目标抵挡所有攻击";case t.POWER_GRARD_MASTER_STR_ATTACK:return"主人受到劈砍攻击时,"+h+"%几率为其承受伤害";case t.POWER_GRARD_MASTER_AGI_ATTACK:return"主人受到穿刺攻击时,"+h+"%几率为其承受伤害";case t.POWER_GRARD_MASTER_MAGIC_ATTACK:return"主人受到魔法攻击时,"+h+"%几率为其承受伤害";case t.POWER_GRARD_MASTER_CURSE_ATTACK:return"主人受到诅咒攻击时,"+h+"%几率为其承受攻击效果";case t.POWER_GRARD_MASTER_ALL_ATTACK:return"主人受到攻击时,"+h+"%几率为其承受伤害";case t.POWER_PET_GRARD_STR_ATTACK:return"受到劈砍攻击时,所携带宠物"+h+"%几率为其承受伤害";case t.POWER_PET_GRARD_AGI_ATTACK:return"受到穿刺攻击时,所携带宠物"+h+"%几率为其承受伤害";case t.POWER_PET_GRARD_MAGIC_ATTACK:return"受到魔法攻击时,所携带宠物"+h+"%几率为其承受伤害";case t.POWER_PET_GRARD_CURSE_ATTACK:return"受到诅咒攻击时,所携带宠物"+h+"%几率为其承受攻击效果";case t.POWER_PET_GRARD_ALL_ATTACK:return"受到攻击时,所携带宠物"+h+"%几率为其承受伤害";case t.POWER_PET_ADD_EXP:return"使用后，目前所携带宠物经验+"+h;case t.POWER_ADD_EXP:return"使用后，角色经验+"+h;case t.POWER_EXP_BY_TIME:return"战斗经验"+Math.floor(_/10)+"."+_%10+"倍";case t.POWER_EXP_MISSION_BY_TIME:return"任务经验"+Math.floor(_/10)+"."+_%10+"倍";case t.POWER_IDENTIFY:return"未鉴定属性";case t.POWER_SWORD_ATK_TIME:return _>=0?"用剑时攻击次数+"+h:"用剑时攻击次数"+h;case t.POWER_BLADE_ATK_TIME:return _>=0?"用刀时攻击次数+"+h:"用刀时攻击次数"+h;case t.POWER_HEAVY_ATK_TIME:return _>=0?"用重型时攻击次数+"+h:"用重型时攻击次数"+h;case t.POWER_LANCE_ATK_TIME:return _>=0?"用长柄时攻击次数+"+h:"用长柄时攻击次数"+h;case t.POWER_STAFF_ATK_TIME:return _>=0?"用法杖时攻击次数+"+h:"用法杖时攻击次数"+h;case t.POWER_BALL_ATK_TIME:return _>=0?"用法器时攻击次数+"+h:"用法器时攻击次数"+h;case t.POWER_HAND_ATK_TIME:return _>=0?"空手时攻击次数+"+h:"空手时攻击次数"+h;case t.POWER_BOW_ATK_TIME:return _>=0?"用远程武器时攻击次数+"+h:"用远程武器时攻击次数"+h;case t.POWER_HAND_ITEM_ATK_TIME:return _>=0?"用手持物时攻击次数+"+h:"用手持物时攻击次数"+h;case t.POWER_ALL_ATK_TIME:return _>=0?"攻击次数+"+h:"攻击次数"+h;case t.POWER_COMPOSITE:return"合成属性";case t.POWER_SKILL_HP:return _>=0?"恢复自身生命+"+h:"恢复自身生命"+h;case t.POWER_SKILL_HP_PERCENT:return _>=0?"恢复自身生命+"+h+"%":"恢复自身生命"+h+"%";case t.POWER_SKILL_MP:return _>=0?"恢复自身法力+"+h:"恢复自身法力"+h;case t.POWER_SKILL_MP_PERCENT:return _>=0?"恢复自身法力+"+h+"%":"恢复自身法力"+h+"%";case t.POWER_SKILL_LIFE_ABSORPTION:return s=Tool.getPointValue(_,1),_>=0?"附带生命吸收+"+s+"%":"附带生命吸收"+s+"%";case t.POWER_SKILL_MANA_ABSORPTION:return s=Tool.getPointValue(_,1),_>=0?"附带法力吸收+"+s+"%":"附带法力吸收"+s+"%";case t.POWER_SKILL_TARGET_BACK:return _>=0?"目标反击值-"+h:"目标反击值+"+u;case t.POWER_SKILL_TARGET_MAGIC_BACK:return _>=0?"目标魔法反馈值-"+h:"目标魔法反馈值+"+u;case t.POWER_SKILL_TARGET_BLOCK:return _>=0?"目标格挡值-"+h:"目标格挡值+"+u;case t.POWER_SKILL_TARGET_INSIGHT:return _>=0?"目标洞察值-"+h:"目标洞察值+"+u;case t.POWER_SKILL_TARGET_WIL:return s=Tool.getPointValue(Math.abs(_),1),_>=0?"目标状态抵抗率-"+s:"目标状态抵抗率+"+s;case t.POWER_SKILL_TARGET_TOUCH:return _>=0?"目标伤害减免值-"+h:"目标伤害减免值+"+u;case t.POWER_IGNORE_BACK:return _>=0?"无视反击+"+h:"无视反击"+h;case t.POWER_IGNORE_MAGIC_BACK:return _>=0?"无视魔法反馈+"+h:"无视魔法反馈"+h;case t.POWER_IGNORE_BLOCK:return _>=0?"无视格挡+"+h:"无视格挡"+h;case t.POWER_IGNORE_INSIGHT:return _>=0?"无视洞察+"+h:"无视洞察"+h;case t.POWER_IGNORE_WIL:return _>=0?"无视状态抵抗+"+h:"无视状态抵抗"+h;case t.POWER_IGNORE_TOUCH:return _>=0?"无视伤害减免+"+h:"无视伤害减免"+h;case t.POWER_KEEPOUT_ATK_TIME:return _>=0?"免伤护盾+"+h:"免伤护盾"+h;case t.POWER_CHEST_LV4:return"需要黄金钥匙";case t.POWER_COLOR_BOX:return"登陆礼盒";case t.POWER_GUN_ATK_TIME:return _>=0?"用火枪时攻击次数+"+h:"用火枪时攻击次数"+h;case t.POWER_GUN_PERCENT:return _>=0?"火枪类武器伤害、耐久+"+h+"%":"火枪类武器伤害、耐久"+h+"%";case t.POWER_SKILL_SCROLL:case t.POWER_SKILL_SCROLL_PET:case t.POWER_NEW_GET_PET:case t.POWER_NEW_GET_ITEM:case t.POWER_ENCHANT_ITEM:case t.POWER_FORMATION_BOOK:case t.POWER_TURN_MONSTER_CARD:case t.POWER_SKILL_BOOK_PET:return""}return"未知power_"+e+"_"+_},t.getPercentSign=function(e){switch(e){case t.POWER_STR_PERCENT:case t.POWER_CON_PERCENT:case t.POWER_AGI_PERCENT:case t.POWER_ILT_PERCENT:case t.POWER_WIS_PERCENT:case t.POWER_HPMAX_PERCENT:case t.POWER_MPMAX_PERCENT:case t.POWER_SWORD_PERCENT:case t.POWER_BLADE_PERCENT:case t.POWER_HEAVY_PERCENT:case t.POWER_LANCE_PERCENT:case t.POWER_STAFF_PERCENT:case t.POWER_BALL_PERCENT:case t.POWER_HAND_PERCENT:case t.POWER_BOW_PERCENT:case t.POWER_HAND_ITEM_PERCENT:case t.POWER_ALL_PERCENT:case t.POWER_EQUIP_ARMOR_DUR_PERCENT:case t.POWER_SPEED_PERCENT:case t.POWER_HITRATE_PERCENT:case t.POWER_DODGE_PERCENT:case t.POWER_MAGIC_HITRATE_PERCENT:case t.POWER_CRITICAL_PERCENT:case t.POWER_ATK_STR_PERCENT:case t.POWER_ATK_AGI_PERCENT:case t.POWER_ATK_MAGIC_PERCENT:case t.POWER_DEF_STR_PERCENT:case t.POWER_DEF_AGI_PERCENT:case t.POWER_DEF_MAGIC_PERCENT:case t.POWER_WIL_PERCENT:case t.POWER_TOUGH_PERCENT:case t.POWER_BLOCK_PERCENT:case t.POWER_INSIGHT_PERCENT:case t.POWER_PENETRATION_PERCENT:case t.POWER_DEF_FIELD_PERCENT:case t.POWER_BACK_PERCENT:case t.POWER_MAGIC_BACK_PERCENT:case t.POWER_LIFE_ABSORPTION_PERCENT:case t.POWER_MANA_ABSORPTION_PERCENT:case t.POWER_MAGIC_PENETRATION_PERCENT:case t.POWER_HIT_FORCE_PERCENT:case t.POWER_HEAL_RECOVERY_PERCENT:case t.POWER_MANA_RECOVERY_PERCENT:case t.POWER_HP_PERCENT:case t.POWER_MP_PERCENT:case t.POWER_PET_HPMAX_PERCENT:case t.POWER_PET_MPMAX_PERCENT:case t.POWER_PET_STR_PERCENT:case t.POWER_PET_CON_PERCENT:case t.POWER_PET_AGI_PERCENT:case t.POWER_PET_ILT_PERCENT:case t.POWER_PET_WIS_PERCENT:case t.POWER_RECOVER_PERCENT:case t.POWER_HPMP_RECOVER:case t.POWER_GUARD_STR_ATTACK:case t.POWER_GUARD_AGI_ATTACK:case t.POWER_GUARD_MAGIC_ATTACK:case t.POWER_GUARD_CURSE_ATTACK:case t.POWER_GUARD_ALL_ATTACK:case t.POWER_GRARD_MASTER_STR_ATTACK:case t.POWER_GRARD_MASTER_AGI_ATTACK:case t.POWER_GRARD_MASTER_MAGIC_ATTACK:case t.POWER_GRARD_MASTER_CURSE_ATTACK:case t.POWER_GRARD_MASTER_ALL_ATTACK:case t.POWER_PET_GRARD_STR_ATTACK:case t.POWER_PET_GRARD_AGI_ATTACK:case t.POWER_PET_GRARD_MAGIC_ATTACK:case t.POWER_PET_GRARD_CURSE_ATTACK:case t.POWER_PET_GRARD_ALL_ATTACK:case t.POWER_SKILL_HP_PERCENT:case t.POWER_SKILL_MP_PERCENT:case t.POWER_SKILL_LIFE_ABSORPTION:case t.POWER_SKILL_MANA_ABSORPTION:return"%"}return""},t.getSkillTypeString=function(e){return 0>e||e>=t.skillTypeText.length?"skillType_"+e:t.skillTypeText[e]},t.getSkillWeaponString=function(e){return 0>e||e>=t.skillWeaponText.length?"weapon_"+e:t.skillWeaponText[e]},t.getSearchTypeByArea=function(e){return e>=t.SKILL_AREA_ENEMY_SINGLE&&e<=t.SKILL_AREA_ENEMY_ALL||e==t.SKILL_AREA_ENEMY_HP_LEAST||e==t.SKILL_AREA_ENEMY_HP_MOST?t.SKILL_AREA_SEARCH_ENEMY:e>=t.SKILL_AREA_ME_SIGHLE&&e<=t.SKILL_AREA_ME_ALL||e==t.SKILL_AREA_ME_HP_LEAST||e==t.SKILL_AREA_ME_HP_MOST||e==t.SKILL_AREA_ME_ALL_NO_SELF?t.SKILL_AREA_SEARCH_FRIEND:e==t.SKILL_AREA_MY_SELF?t.SKILL_AREA_SEARCH_MY_SELF:e==t.SKILL_AREA_MY_OWNER?t.SKILL_AREA_SEARCH_MY_OWNER:t.SKILL_AREA_SEARCH_ALL},t.getSkillAreaPlayerNum=function(e){switch(e){case t.SKILL_AREA_PLAYER_AND_PET:case t.SKILL_AREA_FRONT_BACK_TWO:case t.SKILL_AREA_UP_DOWN_TWO:case t.SKILL_AREA_ENEMY_FONT_BACK_TWO:case t.SKILL_AREA_ENEMY_UP_DOWN_TWO:case t.SKILL_AREA_ME_FONT_BACK_TWO:case t.SKILL_AREA_ME_UP_DOWN_TWO:return t.SKILL_AREA_CURSOR_2;case t.SKILL_AREA_UP_DOWN_THREE:case t.SKILL_AREA_ENEMY_UP_DOWN_THREE:case t.SKILL_AREA_ME_UP_DOWN_THREE:return t.SKILL_AREA_CURSOR_3;case t.SKILL_AREA_UP_DOWN_FOUR:case t.SKILL_AREA_ENEMY_UP_DOWN_FOUR:case t.SKILL_AREA_ME_UP_DOWN_FOUR:case t.SKILL_AREA_SQUARE:case t.SKILL_AREA_ENEMY_SQUARE:case t.SKILL_AREA_ME_SQUARE:case t.SKILL_AREA_TEN:case t.SKILL_AREA_ENEMY_TEN:case t.SKILL_AREA_ME_TEN:return t.SKILL_AREA_CURSOR_4;case t.SKILL_AREA_UP_DOWN_FIVE:case t.SKILL_AREA_ENEMY_UP_DOWN_FIVE:case t.SKILL_AREA_ME_UP_DOWN_FIVE:return t.SKILL_AREA_CURSOR_5;case t.SKILL_AREA_AROUND_SIX:case t.SKILL_AREA_ENEMY_AROUND_SIX:case t.SKILL_AREA_ME_AROUND_SIX:return t.SKILL_AREA_CURSOR_6;case t.SKILL_AREA_ALL:case t.SKILL_AREA_ENEMY_ALL:case t.SKILL_AREA_ME_ALL:case t.SKILL_AREA_ME_ALL_NO_SELF:case t.SKILL_AREA_ALL_NO_SELF:return t.SKILL_AREA_CURSOR_ALL}return t.SKILL_AREA_CURSOR_1},t.getSkillAreaString=function(e){return 0>e||e>=t.skillAreaText.length?"skillArea_"+e:t.skillAreaText[e]},t.getSkillAreaColor=function(e){switch(e){case t.SKILL_AREA_ENEMY_SINGLE:case t.SKILL_AREA_ENEMY_FONT_BACK_TWO:case t.SKILL_AREA_ENEMY_UP_DOWN_TWO:case t.SKILL_AREA_ENEMY_UP_DOWN_THREE:case t.SKILL_AREA_ENEMY_UP_DOWN_FOUR:case t.SKILL_AREA_ENEMY_UP_DOWN_FIVE:case t.SKILL_AREA_ENEMY_TEN:case t.SKILL_AREA_ENEMY_SQUARE:case t.SKILL_AREA_ENEMY_AROUND_SIX:case t.SKILL_AREA_ENEMY_ALL:case t.SKILL_AREA_ENEMY_HP_LEAST:case t.SKILL_AREA_ENEMY_HP_MOST:return 2658248}return 65280},t.getSkillPositionString=function(e){return 0>e||e>=t.skillPositionText.length?"skillPos_"+e:t.skillPositionText[e]},t.getGradeString=function(e,n){return void 0===n&&(n=!1),0>e||e>=t.gradeText.length?"无限制":n&&e==t.GRADE_1?"优秀":t.gradeText[e]},t.getGradeColor=function(t){return ColorUtils.getGradeColor(t)},t.getMonsterAIConditionString=function(e){return 0>e||e>=t.monsterAIConditionText.length?"condition_"+e:t.monsterAIConditionText[e]},t.getMonsterAIString=function(e){return 0>e||e>=t.monsterAIText.length?"AI_"+e:t.monsterAIText[e]},t.getMonsterTypeString=function(e){return 0>e||e>=t.monsterTypeText.length?"monsterType_"+e:t.monsterTypeText[e]},t.getMonsterGroupTypeString=function(e){return 0>e||e>=t.monsterGroupTypeText.length?"groupType_"+e:t.monsterGroupTypeText[e]},t.getItemTypeString=function(e){return 0>e||e>=t.itemTypeText.length?"itemtype_"+e:t.itemTypeText[e]},t.isOneHandWeapon=function(e,n){return!t.isNullHand(e,n)&&((!t.isTwoHand(e,n)||e==t.ITEM_TYPE_WEAPON_ONEHAND_HAND||n==t.ITEM_TYPE_WEAPON_ONEHAND_HAND)&&!(!t.isNoHeavyTypeWeapon(e)&&!t.isNoHeavyTypeWeapon(n)))},t.isNoHeavyTypeWeapon=function(e){return e>0&&(e==t.ITEM_TYPE_WEAPON_ONEHAND_SWORD||e==t.ITEM_TYPE_WEAPON_ONEHAND_BLADE||e==t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY||e==t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW||e==t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY||e==t.ITEM_TYPE_WEAPON_ONEHAND_GUN)},t.isHeavyTypeWeapon=function(e){return e>0&&(e==t.ITEM_TYPE_WEAPON_TWOHAND_SWORD||e==t.ITEM_TYPE_WEAPON_TWOHAND_BLADE||e==t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY||e==t.ITEM_TYPE_WEAPON_TWOHAND_STAFF||e==t.ITEM_TYPE_WEAPON_TWOHAND_LANCE||e==t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW||e==t.ITEM_TYPE_WEAPON_TWOHAND_BOW||e==t.ITEM_TYPE_WEAPON_BALL||e==t.ITEM_TYPE_WEAPON_TWOHAND_GUN)},t.isNullHand=function(t,e){return 0>t&&0>e},t.isTwoHand=function(t,e){return t>0&&e>0},t.isValidSword=function(e,n){return t.isValidOneSword(e,n)||t.isValidTwoSword(e,n)},t.isValidBlade=function(e,n){return t.isValidOneBlade(e,n)||t.isValidTwoBlade(e,n)},t.isValidHeavy=function(e,n){return t.isValidOneHeavy(e,n)||t.isValidTwoHeavy(e,n)},t.isValidCrossrow=function(e,n){return t.isValidOneCrossrow(e,n)||t.isValidTwoCrossrow(e,n)},t.isValidGun=function(e,n){return t.isValidOneGun(e,n)||t.isValidTwoGun(e,n)},t.isValidLance=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_LANCE==e||t.ITEM_TYPE_WEAPON_TWOHAND_LANCE==n},t.isValidOneSword=function(e,n){return t.ITEM_TYPE_WEAPON_ONEHAND_SWORD==e||t.ITEM_TYPE_WEAPON_ONEHAND_SWORD==n},t.isValidTwoSword=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_SWORD==e||t.ITEM_TYPE_WEAPON_TWOHAND_SWORD==n},t.isValidOneBlade=function(e,n){return t.ITEM_TYPE_WEAPON_ONEHAND_BLADE==e||t.ITEM_TYPE_WEAPON_ONEHAND_BLADE==n},t.isValidTwoBlade=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_BLADE==e||t.ITEM_TYPE_WEAPON_TWOHAND_BLADE==n},t.isValidOneHeavy=function(e,n){return t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY==e||t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY==n},t.isValidTwoHeavy=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY==e||t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY==n},t.isValidOneCrossrow=function(e,n){return t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW==e||t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW==n},t.isValidTwoCrossrow=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW==e||t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW==n},t.isValidBow=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_BOW==e||t.ITEM_TYPE_WEAPON_TWOHAND_BOW==n},t.isValidStaff=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_STAFF==e||t.ITEM_TYPE_WEAPON_TWOHAND_STAFF==n},t.isValidBall=function(e,n){return t.ITEM_TYPE_WEAPON_BALL==e||t.ITEM_TYPE_WEAPON_BALL==n},t.isValidOneGun=function(e,n){return t.ITEM_TYPE_WEAPON_ONEHAND_GUN==e||t.ITEM_TYPE_WEAPON_ONEHAND_GUN==n},t.isValidTwoGun=function(e,n){return t.ITEM_TYPE_WEAPON_TWOHAND_GUN==e||t.ITEM_TYPE_WEAPON_TWOHAND_GUN==n},t.getSexString=function(e){return 0>e||e>=t.sexTEXT.length?"sex_"+e:t.sexTEXT[e]},t.getRaceString=function(e){return 0>e||e>=t.raceText.length?"race_"+e:t.raceText[e]},t.getJobString=function(e){return 0>e||e>=t.jobText.length?"job_"+e:t.jobText[e]},t.getJobInfoString=function(e){return t.jobInfoText[e]},t.getJobByRace=function(e,n){if(0>e||e>=t.raceJobList.length)return t.JOB_WARRIOR;var i=t.raceJobList[e];return null==i||0>n||n>=i.length?t.JOB_WARRIOR:t.raceJobList[e][n]},t.isPetJob=function(e){return e==t.JOB_PET_WIL||e==t.JOB_PET_STR||e==t.JOB_PET_AGI},t.isMagicJob=function(e){return e==t.JOB_XIUZHEN||e==t.JOB_WIZARD||e==t.JOB_NEW},t.getRankString=function(e){return 0>e||e>=t.rankText.length?"":t.rankText[e]},t.getBuildingText=function(e){return 0>e||e>=t.buildingText.length?"building_"+e:0==e?"等级":t.buildingText[e]},t.getBuildingText2=function(e){return 0>e||e>=t.buildingText.length?"building_"+e:0==e?"国家":t.buildingText[e]},t.getSearchMemText=function(e){return 0>e||e>=t.searchMemText.length?"searchMem_"+e:t.searchMemText[e]},t.getAtkTypeString=function(e){return 0>e||e>=t.AtkTypeText.length?"atkType_"+e:t.AtkTypeText[e]},t.isPhysicalAtkType=function(e){return e<=t.ATKTYPE_RANGE_AGI},t.getBufferBitValue=function(e){return e==t.BUFFER_NONE?0:1<<e},t.getBufferString=function(e){return 0>e||e>=t.bufferText.length?"buffer_"+e:t.bufferText[e]},t.getBufferType=function(e,n){if(void 0===n&&(n=!1),1==n){if(e>=t.getBufferBitValue(t.BUFFER_POISON)&&e<=t.getBufferBitValue(t.BUFFER_WEAK))return t.BUFFER_TYPE_DEBUFF;if(e==t.getBufferBitValue(t.BUFFER_DIE_CANNOT_RELIVE))return t.BUFFER_TYPE_DEBUFF}else{if(e>=t.BUFFER_POISON&&e<=t.BUFFER_WEAK)return t.BUFFER_TYPE_DEBUFF;if(e==t.BUFFER_DIE_CANNOT_RELIVE)return t.BUFFER_TYPE_DEBUFF}return t.BUFFER_TYPE_BUFF},t.getBufferInfoString=function(e){return 0>e||e>=t.bufferInfoText.length?"buffer_"+e:t.bufferInfoText[e]},t.isHairItem=function(e){return e>=t.ITEM_ID_HAIR_START&&e<=t.ITEM_ID_HAIR_END},t.isFaceItem=function(e){return e>=t.ITEM_ID_FACE_START&&e<=t.ITEM_ID_FACE_END},t.isChangeJobItem=function(e){return e>=t.ITEM_ID_JOB_START&&e<=t.ITEM_ID_JOB_END},t.isCountrySkillShop=function(e){return e>=t.SKILL_SHOP_COUNTRY_START_PLAYER&&e<=t.SKILL_SHOP_COUNTRY_END_PLAYER||e>=t.SKILL_SHOP_COUNTRY_START_PET&&e<=t.SKILL_SHOP_COUNTRY_END_PET},t.getTypeBySkillShopID=function(e){return e>=t.SKILL_SHOP_START_PLAYER&&e<t.SKILL_SHOP_END_PLAYER?t.SKILL_TYPE_PLAYER:e>=t.SKILL_SHOP_START_PET&&e<t.SKILL_SHOP_END_PET?t.SKILL_TYPE_PET:t.SKILL_TYPE_OTHER},t.getTypeBySkillID=function(e){return e<t.SKILL_END_PLAYER?t.SKILL_ID_TYPE_PLAYER:e<t.SKILL_END_PET_NORMAL_TALENT?t.SKILL_ID_PET_NORMAL_TALENT:e<t.SKILL_END_PET_LEARN_TALENT?t.SKILL_ID_PET_LEARN_TALENT:t.SKILL_ID_OTHER},t.isPetTalentSkill=function(e){var n=t.getTypeBySkillID(e);return n==t.SKILL_ID_PET_NORMAL_TALENT||n==t.SKILL_ID_PET_LEARN_TALENT},t.isEscortMap=function(e){return e==t.MAP_ID_ESCORT},t.isCountryWarMap=function(e){return e==t.MAP_ID_COUNTRY_WAR},t.isCommonMap=function(e){return e>=t.MAP_ID_START_COMMON&&e<=t.MAP_ID_END_COMMON},t.isCityMap=function(e){return e>=t.MAP_ID_START_CITY_EAST&&e<=t.MAP_ID_END_CITY_EAST||e>=t.MAP_ID_START_CITY_WEST&&e<=t.MAP_ID_END_CITY_WEST},t.isAllocateCityMap=function(e){return e>=t.MAP_ID_START_CITY_ALLOCATE&&e<=t.MAP_ID_END_CITY_ALLOCATE},t.isCountryMap=function(e){return e>=t.MAP_ID_START_COUNTRY_EAST&&e<=t.MAP_ID_END_COUNTRY_EAST||e>=t.MAP_ID_START_COUNTRY_WEST&&e<=t.MAP_ID_END_COUNTRY_WEST},t.isAllocateCountryMap=function(e){return e>=t.MAP_ID_START_COUNTRY_ALLOCATE&&e<=t.MAP_ID_END_COUNTRY_ALLOCATE},t.isMirrorMap=function(e){return e>=t.MAP_ID_START_MIRROR&&e<=t.MAP_ID_END_MIRROR},t.isAllocateMirrorMap=function(e){return e>=t.MAP_ID_START_MIRROR_ALLOCATE&&e<=t.MAP_ID_END_MIRROR_ALLOCATE},t.getMercenaryFightString=function(e){return 0>e||e>=t.mercenaryFight.length?"mercenaryFight_"+e:t.mercenaryFight[e]},t.isComposeShop=function(e){return e>=t.SHOP_COMPOSE_START&&e<t.SHOP_COMPOSE_END},t.isActivityComposeShop=function(e){return e>=t.SHOP_ACTIVITY_COMPOSE_START&&e<t.SHOP_ACTIVITY_COMPOSE_END},t.isIntegralShop=function(e){return e>=t.SHOP_INTEGRAL_START&&e<t.SHOP_INTEGRAL_END},t.isArenaShop=function(e){return e>=t.SHOP_SPORT_START&&e<t.SHOP_SPORT_END},t.isSkyArenaShop=function(e){return e>=t.SHOP_SKY_START&&e<t.SHOP_SKY_END},t.isVipShop=function(e){return e>=t.SHOP_VIP_COUNTRY_START&&e<=t.SHOP_VIP_COUNTRY_END||e>=t.SHOP_VIP_START&&e<=t.SHOP_VIP_END},t.isSuperQQShop=function(e){return e>=t.SHOP_SUPER_QQ_COUNTRY_START&&e<=t.SHOP_SUPER_QQ_COUNTRY_END||e>=t.SHOP_SUPER_QQ_START&&e<=t.SHOP_SUPER_QQ_END},t.isPetShop=function(e){return e>=t.SHOP_PET_START&&e<t.SHOP_PET_END},t.isFurnaceShop=function(e){return e>=t.FURNACE_START&&e<t.FURNACE_END},t.isSoldierShop=function(e){return e>=t.SHOP_SOLDIER_START&&e<=t.SHOP_SOLDIER_END},t.isCountrySoldierShop=function(e){return e>=t.SHOP_SOLDIER_COUNTRY_START&&e<=t.SHOP_SOLDIER_END},t.isCountryShop=function(e){return e>=t.SHOP_COUNTRY_START&&e<=t.SHOP_COUNTRY_END},t.isEnchantShop=function(e){return e>=t.SHOP_ENCHANT_START&&e<t.SHOP_ENCHANT_COUNTRY_START},t.isEnchantCountryShop=function(e){return e>=t.SHOP_ENCHANT_COUNTRY_START&&e<=t.SHOP_ENCHANT_END},t.isAdvancedShop=function(e){return e>=t.SHOP_ADVANCED_START&&e<t.SHOP_ADVANCED_END},t.getGoodsTypeText=function(e){return 0>e||e>=t.goodsTypeText.length?null:t.goodsTypeText[e]},t.getGoodsType=function(e){return 0>e||e>=t.goodsType.length?-1:t.goodsType[e]},t.getGoodsIcon=function(e){return 0>e||e>=t.goodsIcon.length?t.goodsIcon[t.goodsIcon.length-1]:t.goodsIcon[e]},t.getPurchaseTypeText=function(e){return 0>e||e>=t.purchaseTypeText.length?null:t.purchaseTypeText[e]},t.getPurchaseType=function(e){return 0>e||e>=t.purchaseType.length?-1:t.purchaseType[e]},t.getPurchaseIcon=function(e){return 0>e||e>=t.purchaseIcon.length?t.purchaseIcon[0]:t.purchaseIcon[e]},t.goodsTypeToPurchaseType=function(e){switch(e){case t.ITEM_TYPE_GEM:return t.PURCHASE_ITEM_TYPE_GEM;case t.ITEM_TYPE_BUILD_MATERIAL:return t.PURCHASE_ITEM_TYPE_MATERIAL;case t.ITEM_TYPE_TASK:return t.PURCHASE_ITEM_TYPE_TASKITEM;default:return t.PURCHASE_ITEM_TYPE_OTHER}},t.getGoodsLevelText=function(e){return 0>e||e>=t.goodsLevelText.length?t.goodsLevelText[0]:t.goodsLevelText[e]},t.getNearStr=function(e){return 0>e||e>=t.NEARSTR.length?"near_"+e:t.NEARSTR[e]},t.getAdminStr=function(e){return e>t.ADMIN_MAX?"":0>e||e>=t.ADMINSTR.length?"admin_"+e:t.ADMINSTR[e]},t.getCountryBookText=function(e){return 0>e||e>=t.countryBooks.length?"countryBook_"+e:t.countryBooks[e]},t.isNeedLockVerify=function(e){return e!=t.PLAYER_EVENT_TEAM_INVITE&&e!=t.PLAYER_EVENT_TEAM_APPLY&&e!=t.PLAYER_EVENT_PKASK},t.isNetBattleID=function(e){return e>=t.BATTLE_NET_START&&e<=t.BATTLE_NET_END},t.getResourseText=function(e,n){switch(e){case t.ITEM_ID_WOOD:return n+"木材";case t.ITEM_ID_STONE:return n+"石材";case t.ITEM_ID_IRON:return n+"铁矿";default:return"数据错误"}},t.isGuessGameShop=function(e){return e>=t.SHOP_MINIGAME_START&&e<=t.SHOP_MINIGAME_END},t.SPRITE_USE_ITEM=1215,t.ID_PER_AREA=5e7,t.startChar=97,t.endChar=122,t.SUCCESS=1,t.ERROR=-1,t.BACK_ERROR_DUR=-400,t.BACK_ERROR_NULL_HAND=-401,t.BACK_ERROR_JUMP_SHOP=-100,t.BACK_ERROR_HIGH_KEY3=-48,t.BACK_ERROR_HIGH_KEY4=-47,t.BACK_ERROR_IDENTIFY_KEY=-49,t.LANG_ZHCN=0,t.LANG_ZHHK=1,t.LANG_EN=2,t.LANG_JPN=3,t.LANG_IND=4,t.LANG_DEFAULT=t.LANG_ZHCN,t.ACTOR_LEAVE_TYPE_BACKTOLIST=1,t.ACTOR_LEAVE_TYPE_BACKTOLOGINLIST=2,t.ACTOR_LEAVE_TYPE_BACKTOLOGIN=3,t.ACTOR_LEAVE_TYPE_KICKTOLIST=4,t.ACTOR_LEAVE_TYPE_KICKTOLOGIN=5,t.ACTOR_LEAVE_TYPE_SELFKICK=6,t.ACTOR_LEAVE_TYPE_SESSIONCLOSE=7,t.SETTING_INVITE_REJECT=1,t.SETTING_JOIN_ACCEPT=2,t.SETTING_JOIN_REJECT=4,t.SETTING_CHAT_WORLD_OFF=8,t.SETTING_CHAT_MAP_OFF=16,t.SETTING_CHAT_COUNTRY_OFF=32,t.SETTING_CHAT_TEAM_OFF=64,t.SETTING_CHAT_PRIVATE_OFF=128,t.SETTING_SHOW_TRANSPORT_OFF=256,t.SETTING_SHOW_PET_OFF=512,t.SETTING_PET_PLAN_OFF=1024,t.SETTING_SHOW_CHAT_ALL=2048,t.SETTING_SHOW_CHAT_MORE=4096,t.SETTING_SHOW_CHAT_OFF=8192,t.SETTING_MASTER_REJECT=16384,t.SETTING_SPRITE_GUIDE=32768,t.SETTING_CHAT_UNION_OFF=65536,t.SETTING_MINI_MAP_ALL=1<<18,t.SETTING_MINI_MAP_OFF=1<<19,t.SETTING_SHOW_NAME_ALL=1<<20,t.SETTING_SHOW_NAME_OFF=1<<21,t.SETTING_SHOW_PLAYER_ALL=1<<22,t.SETTING_SHOW_PLAYER_FAR=1<<23,t.SETTING_SHOW_PLAYER_OFF=1<<24,t.SETTING_MAP_IMG_MINI=1<<25,t.SETTING_MAP_IMG_OFF=1<<26,t.SETTING_SPRITE_MINI=1<<27,t.SETTING_PLAYER_MINI=1<<28,t.SETTING_MAP_PLAYER_LOAD_50=1<<29,t.SETTING_MAP_PLAYER_LOAD_20=1<<30,t.SETTING_GLOBAL_START=18,t.SETTING_GLOBAL_END=30,t.CHAT_TYPE_WORLD=1,t.CHAT_TYPE_MAP=2,t.CHAT_TYPE_COUNTRY=3,t.CHAT_TYPE_TEAM=4,t.CHAT_TYPE_PRIVATE=5,t.CHAT_TYPE_SYSTEM=6,t.CHAT_TYPE_UNION=7,t.CHAT_TYPE_SERVER=8,t.CHAT_TYPE_ALL=10,t.CHAT_TYPE_NOTHING=11,t.DATA_PLAYER_DETAIL=2,t.DATA_PLAYER_MISSION_BYTE=4,t.DATA_PLAYER_MISSION=8,t.DATA_PLAYER_ITEM=16,t.DATA_PLAYER_SKILL=32,t.DATA_PLAYER_LIST_BASE=64,t.DATA_PLAYER_LIST_EXTRA=128,t.DATA_MAP_NORMAL=256,t.DATA_MAP_MINI=512,t.DATA_NPC_BASE=1024,t.DATA_MONSTER_GROUP=2048,t.DATA_MONSTER_MODEL=4096,t.DATA_MAP_IMAGE=8192,t.DATA_GUILD_MAP=16384,t.DATA_CITY=32768,t.DATA_NOTICE=65536,t.DATA_SPRITE=1<<17,t.DATA_SPRITE_MINI=1<<18,t.DATA_CLIENT_NEW=1<<19,t.DATA_FORMATION=1<<20,t.DATA_MASTER_INFO=1<<21,t.DATA_TURN_MONSTER=1<<22,t.DATA_END=32,t.PLAYER_DATA_FLAG=t.DATA_PLAYER_DETAIL|t.DATA_PLAYER_MISSION_BYTE|t.DATA_PLAYER_MISSION|t.DATA_PLAYER_ITEM|t.DATA_PLAYER_SKILL|t.DATA_FORMATION|t.DATA_TURN_MONSTER,t.NEW_SCENE_DATA_FLAG=t.DATA_NPC_BASE|t.DATA_MONSTER_GROUP|t.DATA_MONSTER_MODEL|t.DATA_MAP_IMAGE,t.LOGIN_DATA_FLAG=t.PLAYER_DATA_FLAG|t.DATA_NOTICE,t.SIMPLE_FLASH_DATA_FLAG=t.DATA_PLAYER_LIST_BASE,t.REFRESH_DATA_FLAG=t.PLAYER_DATA_FLAG|t.SIMPLE_FLASH_DATA_FLAG,t.JUMP_MAP_DATA_FLAG=t.SIMPLE_FLASH_DATA_FLAG,t.ANIME_TYPE_PHYSIC=0,t.ANIME_TYPE_MAGIC=1,t.ANIME_TYPE_USE_ITEM=2,t.ANIME_TYPE_BACKUP=3,t.ANIME_NORMAL=0,t.ANIME_ALL=1,t.ANIME_POINT=2,t.ANIME_FRONT=3,t.POWER_ADD_MOENY1=301,t.POWER_ADD_MOENY2=302,t.POWER_ADD_MOENY3=303,t.POWER_ADD_ITEM=304,t.POWER_NONE=0,t.POWER_STR=1,t.POWER_STR_PERCENT=2,t.POWER_CON=3,t.POWER_CON_PERCENT=4,t.POWER_AGI=5,t.POWER_AGI_PERCENT=6,t.POWER_ILT=7,t.POWER_ILT_PERCENT=8,t.POWER_WIS=9,t.POWER_WIS_PERCENT=10,t.POWER_HPMAX=11,t.POWER_HPMAX_PERCENT=12,t.POWER_MPMAX=13,t.POWER_MPMAX_PERCENT=14,t.POWER_SPEED_PERCENT=23,t.POWER_HITRATE_PERCENT=24,t.POWER_DODGE_PERCENT=25,t.POWER_MAGIC_HITRATE_PERCENT=26,t.POWER_CRITICAL_PERCENT=27,t.POWER_ATK_STR_PERCENT=28,t.POWER_ATK_AGI_PERCENT=29,t.POWER_ATK_MAGIC_PERCENT=30,t.POWER_DEF_STR_PERCENT=31,t.POWER_DEF_AGI_PERCENT=32,t.POWER_DEF_MAGIC_PERCENT=33,t.POWER_WIL_PERCENT=34,t.POWER_TOUGH_PERCENT=35,t.POWER_REFLECTION_PERCENT=36,t.POWER_BLOCK_PERCENT=37,t.POWER_INSIGHT_PERCENT=38,t.POWER_PENETRATION_PERCENT=39,t.POWER_DEF_FIELD_PERCENT=40,t.POWER_BACK_PERCENT=41,t.POWER_MAGIC_BACK_PERCENT=42,t.POWER_LIFE_ABSORPTION_PERCENT=43,t.POWER_MANA_ABSORPTION_PERCENT=44,t.POWER_MAGIC_PENETRATION_PERCENT=45,t.POWER_HIT_FORCE_PERCENT=46,t.POWER_HEAL_RECOVERY_PERCENT=47,t.POWER_MANA_RECOVERY_PERCENT=48,t.POWER_HP=49,t.POWER_HP_PERCENT=50,t.POWER_MP=51,t.POWER_MP_PERCENT=52,t.POWER_SPEED=53,t.POWER_HITRATE=54,t.POWER_DODGE=55,t.POWER_MAGIC_HITRATE=56,t.POWER_CRITICAL=57,t.POWER_ATK_STR=58,t.POWER_ATK_AGI=59,t.POWER_ATK_MAGIC=60,t.POWER_DEF_STR=61,t.POWER_DEF_AGI=62,t.POWER_DEF_MAGIC=63,t.POWER_WIL=64,t.POWER_TOUGH=65,t.POWER_REFLECTION=66,t.POWER_BLOCK=67,t.POWER_INSIGHT=68,t.POWER_PENETRATION=69,t.POWER_DEF_FIELD=70,t.POWER_BACK=71,t.POWER_MAGIC_BACK=72,t.POWER_LIFE_ABSORPTION=73,t.POWER_MANA_ABSORPTION=74,t.POWER_MAGIC_PENETRATION=75,t.POWER_HIT_FORCE=76,t.POWER_HEAL_RECOVERY=77,t.POWER_MANA_RECOVERY=78,t.POWER_REMOVE_STATUS=79,t.POWER_RECOVER=80,t.POWER_SKILL_DAMAGE=81,t.POWER_SKILL_HITRATE=82,t.POWER_SELF_CRITICAL=84,t.POWER_SKILL_HIT_FORCE=85,t.POWER_SKILL_MAGIC_PENETRATION=86,t.POWER_SKILL_BRK_ARMOR=87,t.POWER_SKILL_REMOVE_STATUS=88,t.POWER_PET_DAMAGE=89,t.POWER_PET_HPMAX_PERCENT=90,t.POWER_PET_MPMAX_PERCENT=91,t.POWER_PET_STR_PERCENT=92,t.POWER_PET_CON_PERCENT=93,t.POWER_PET_AGI_PERCENT=94,t.POWER_PET_ILT_PERCENT=95,t.POWER_PET_WIS_PERCENT=96,t.POWER_RECOVER_PERCENT=97,t.POWER_HPMP_RECOVER=98,t.POWER_OPEN_STORE=99,t.POWER_CHEST_LV1=100,t.POWER_CHEST_LV2=101,t.POWER_CHEST_LV3=102,t.POWER_REQ_SLOT=103,t.POWER_TO_WORLDMAP=104,t.POWER_TO_GXGY=105,t.POWER_EXPIRE_TIME=106,t.POWER_RESET_MISSION=107,t.POWER_CHEST_KEY_LEVEL=108,t.POWER_PET_EGG=109,t.POWER_COSTUME=110,t.POWER_TRANSPORT=111,t.POWER_POWER_TITLE=112,t.POWER_GUARD_STR_ATTACK=113,t.POWER_GUARD_AGI_ATTACK=114,t.POWER_GUARD_MAGIC_ATTACK=115,t.POWER_GUARD_CURSE_ATTACK=116,t.POWER_GUARD_ALL_ATTACK=117,t.POWER_PET_ADD_EXP=118,t.POWER_ADD_EXP=119,t.POWER_EXP_BY_TIME=120,t.POWER_IDENTIFY=121,t.POWER_SWORD_ATK_TIME=122,t.POWER_BLADE_ATK_TIME=123,t.POWER_HEAVY_ATK_TIME=124,t.POWER_LANCE_ATK_TIME=125,t.POWER_STAFF_ATK_TIME=126,t.POWER_HAND_ATK_TIME=127,t.POWER_BOW_ATK_TIME=128,t.POWER_HAND_ITEM_ATK_TIME=129,t.POWER_ALL_ATK_TIME=130,t.POWER_COMPOSITE=131,t.POWER_SWORD_PERCENT=133,t.POWER_BLADE_PERCENT=134,t.POWER_HEAVY_PERCENT=135,t.POWER_LANCE_PERCENT=136,t.POWER_STAFF_PERCENT=137,t.POWER_HAND_PERCENT=138,t.POWER_BOW_PERCENT=139,t.POWER_HAND_ITEM_PERCENT=140,t.POWER_ALL_PERCENT=141,t.POWER_EQUIP_ARMOR_DUR_PERCENT=142,t.POWER_SKILL_HP=145,t.POWER_SKILL_HP_PERCENT=146,t.POWER_SKILL_MP=147,t.POWER_SKILL_MP_PERCENT=148,t.POWER_SKILL_LIFE_ABSORPTION=149,t.POWER_SKILL_MANA_ABSORPTION=150,t.POWER_SKILL_TARGET_BACK=151,t.POWER_SKILL_TARGET_MAGIC_BACK=152,t.POWER_SKILL_TARGET_BLOCK=153,t.POWER_SKILL_TARGET_INSIGHT=154,t.POWER_SKILL_TARGET_WIL=155,t.POWER_SKILL_TARGET_TOUCH=156,t.POWER_GRARD_MASTER_STR_ATTACK=157,t.POWER_GRARD_MASTER_AGI_ATTACK=158,t.POWER_GRARD_MASTER_MAGIC_ATTACK=159,t.POWER_GRARD_MASTER_CURSE_ATTACK=160,t.POWER_GRARD_MASTER_ALL_ATTACK=161,t.POWER_PET_GRARD_STR_ATTACK=162,t.POWER_PET_GRARD_AGI_ATTACK=163,t.POWER_PET_GRARD_MAGIC_ATTACK=164,t.POWER_PET_GRARD_CURSE_ATTACK=165,t.POWER_PET_GRARD_ALL_ATTACK=166,t.POWER_EXP_MISSION_BY_TIME=167,t.POWER_IGNORE_BACK=168,t.POWER_IGNORE_MAGIC_BACK=169,t.POWER_IGNORE_BLOCK=170,t.POWER_IGNORE_INSIGHT=171,t.POWER_IGNORE_WIL=172,t.POWER_IGNORE_TOUCH=173,t.POWER_BALL_ATK_TIME=174,t.POWER_BALL_PERCENT=175,t.POWER_SKILL_SCROLL=176,t.POWER_SKILL_SCROLL_PET=177,t.POWER_KEEPOUT_ATK_TIME=178,t.POWER_NEW_GET_PET=179,t.POWER_NEW_GET_ITEM=180,t.POWER_ENCHANT_ITEM=181,t.POWER_FORMATION_BOOK=182,t.POWER_CHEST_LV4=183,t.POWER_COLOR_BOX=184,t.POWER_TURN_MONSTER_CARD=185,t.POWER_SKILL_BOOK_PET=186,t.POWER_GUN_ATK_TIME=190,t.POWER_GUN_PERCENT=191,t.SKILL_TYPE_PASSIVE=1,t.SKILL_TYPE_ROUND=2,t.SKILL_TYPE_ACTIVE=3,t.SKILL_TYPE_FORMATION=4,t.skillTypeText=["","被动","自动","主动","阵型"],t.SKILL_WEAPON_NONE=0,t.SKILL_WEAPON_MELEE_1=1,t.SKILL_WEAPON_MELEE_2=2,t.SKILL_WEAPON_MELEE_3=3,t.SKILL_WEAPON_RANGE=4,t.SKILL_WEAPON_ONE_HAND=5,t.SKILL_WEAPON_ONE_SWORD=6,t.SKILL_WEAPON_TWO_SWORD=7,t.SKILL_WEAPON_HEAVY_SWORD=8,t.SKILL_WEAPON_ONE_BLADE=9,t.SKILL_WEAPON_TWO_BLADE=10,t.SKILL_WEAPON_HEAVY_BLADE=11,t.SKILL_WEAPON_ONE_HEAVY=12,t.SKILL_WEAPON_LANCE=13,t.SKILL_WEAPON_ONE_CROSSBOW=14,t.SKILL_WEAPON_TOW_CROSSBOW=15,t.SKILL_WEAPON_HEAVY_CROSSBOW=16,t.SKILL_WEAPON_BOW=17,t.SKILL_WEAPON_HAND=18,t.SKILL_WEAPON_CANE=19,t.SKILL_WEAPON_SWORD=20,t.SKILL_WEAPON_ONE_HAND_BLADE=21,t.SKILL_WEAPON_BALL=22,t.SKILL_WEAPON_GUN=23,t.SKILL_WEAPON_TWO_GUN=24,t.SKILL_WEAPON_HEAVY_GUN=25,t.skillWeaponText=["无限制","空手、剑类、刀类、重型武器、长柄武器","轻剑、轻刀","重剑、重刀、重型武器、长柄武器","轻弩、重弩、弓","单手持武器或空手","单手剑限制","单手剑双持限制","重剑限制","刀类武器限制","单手刀双持限制","重刀限制","重型武器","长柄武器","轻弩、重弩","轻弩双持限制","重弩限制","弓","空手","法杖","剑类武器限制","单手刀限制","法器限制","枪类武器限制","轻枪限制","重枪限制"],t.SKILL_AREA_SEARCH_ALL=0,t.SKILL_AREA_SEARCH_ENEMY=1,t.SKILL_AREA_SEARCH_FRIEND=2,t.SKILL_AREA_SEARCH_MY_SELF=3,t.SKILL_AREA_SEARCH_MY_OWNER=4,t.SKILL_AREA_CURSOR_1=1,t.SKILL_AREA_CURSOR_2=2,t.SKILL_AREA_CURSOR_3=3,t.SKILL_AREA_CURSOR_4=4,t.SKILL_AREA_CURSOR_5=5,t.SKILL_AREA_CURSOR_6=6,t.SKILL_AREA_CURSOR_ALL=-1,t.SKILL_AREA_SINGLE=0,t.SKILL_AREA_FRONT_BACK_TWO=1,t.SKILL_AREA_UP_DOWN_TWO=2,t.SKILL_AREA_UP_DOWN_THREE=3,t.SKILL_AREA_UP_DOWN_FOUR=4,t.SKILL_AREA_UP_DOWN_FIVE=5,t.SKILL_AREA_TEN=6,t.SKILL_AREA_SQUARE=7,t.SKILL_AREA_AROUND_SIX=8,t.SKILL_AREA_ALL=9,t.SKILL_AREA_ENEMY_SINGLE=10,t.SKILL_AREA_ENEMY_FONT_BACK_TWO=11,t.SKILL_AREA_ENEMY_UP_DOWN_TWO=12,t.SKILL_AREA_ENEMY_UP_DOWN_THREE=13,t.SKILL_AREA_ENEMY_UP_DOWN_FOUR=14,t.SKILL_AREA_ENEMY_UP_DOWN_FIVE=15,t.SKILL_AREA_ENEMY_TEN=16,t.SKILL_AREA_ENEMY_SQUARE=17,t.SKILL_AREA_ENEMY_AROUND_SIX=18,t.SKILL_AREA_ENEMY_ALL=19,t.SKILL_AREA_ME_SIGHLE=20,t.SKILL_AREA_ME_FONT_BACK_TWO=21,t.SKILL_AREA_ME_UP_DOWN_TWO=22,t.SKILL_AREA_ME_UP_DOWN_THREE=23,t.SKILL_AREA_ME_UP_DOWN_FOUR=24,t.SKILL_AREA_ME_UP_DOWN_FIVE=25,t.SKILL_AREA_ME_TEN=26,t.SKILL_AREA_ME_SQUARE=27,t.SKILL_AREA_ME_AROUND_SIX=28,t.SKILL_AREA_ME_ALL=29,t.SKILL_AREA_MY_SELF=30,t.SKILL_AREA_ENEMY_HP_LEAST=31,t.SKILL_AREA_ENEMY_HP_MOST=32,t.SKILL_AREA_ME_HP_LEAST=33,t.SKILL_AREA_ME_HP_MOST=34,t.SKILL_AREA_MY_OWNER=35,t.SKILL_AREA_ME_ALL_NO_SELF=36,t.SKILL_AREA_ALL_NO_SELF=37,t.SKILL_AREA_PLAYER_AND_PET=38,t.skillAreaText=["单体","前后两人","上下两人","上下三人","上下四人","上下五人","十字","正方","六人长方","全体","敌单体","敌前后两人","敌上下两人","敌上下三人","敌上下四人","敌上下五人","敌十字","敌正方","敌六人长方","敌全体","我单体","我前后两人","我上下两人","我上下三人","我上下四人","我上下五人","我十字","我正方","我六人长方","我全体","自身","敌当前生命最少者","敌当前生命最大者","我当前生命最少者","我当前生命最大者","自身主人","我全体(不包括自身)","全体(不包括自身)","宠物和主人"],t.SKILL_POS_STAND=0,t.SKILL_POS_FRONT=1,t.SKILL_POS_CENTER=2,t.skillPositionText=["原地","目标身前","中央"],t.GRADE_0=0,t.GRADE_1=1,t.GRADE_2=2,t.GRADE_3=3,t.GRADE_4=4,t.gradeText=["普通","精致","稀有","史诗","传说"],t.gradeGoods=[-1,t.GRADE_0,t.GRADE_1,t.GRADE_2,t.GRADE_3,t.GRADE_4],t.CONDITION_NONE=0,t.CONDITION_HP_BELOW=1,t.CONDITION_HP_HIGH=2,t.CONDITION_HELP_RATE=3,t.CONDITION_ROUND=4,t.CONDITION_PLAYER_COUNT=5,t.CONDITION_MONSTER_COUNT=6,t.monsterAIConditionText=["无条件","HP小于百分之%U","HP大于百分之%U","百分之%U执行","战场已进行大于%U回合","玩家生存数量大于%U","怪物生存数量大于%U"],t.AI_HATE_MIN=1,t.AI_HATE_MAX=2,t.AI_HP_MIN_ENEMY=3,t.AI_HP_MAX_ENEMY=4,t.AI_SPEED_MIN_ENEMY=5,t.AI_SPEED_MAX_ENEMY=6,t.AI_HP_MIN_FRIEND=7,t.AI_HP_MAX_FRIEND=8,t.AI_SPEED_MIN_FRIEND=9,t.AI_SPEED_MAX_FRIEND=10,t.AI_RAND_ENEMY=11,t.AI_RAND_FRIEND=12,t.AI_SELF=13,t.AI_RAND_FRIEND_DEAD=14,t.AI_RAND_ALL_ALIVE=15,t.AI_ESCAPE=16,t.monsterAIText=["","最少仇恨的敌人","最大仇恨的敌人","HP最低的敌人","HP最高的敌人","速度最低的敌人","速度最高的敌人","HP最低的队友","HP最高的队友","速度最低的队友","速度最高的队友","随机敌人","随机队友","自已","随机已死亡的队友","随机自已以外的活人","逃跑"],t.MONSTER_NORMAL=0,t.MONSTER_ELITE=1,t.MONSTER_BOSS=2,t.MONSTER_HIGHER_BOSS=3,t.MONSTER_HIGHEST_BOSS=4,t.monsterTypeText=["普通","精英","BOSS","高级BOSS","远古BOSS"],t.BATTLE_NORMAL=0,t.BATTLE_BOSS=1,t.BATTLE_NPC=2,t.BATTLE_VIP=3,t.monsterGroupTypeText=["常规战斗","BOSS战斗","携带NPC的常规战斗","携带VIP的常规战斗"],t.ITEM_TYPE_ARMOR_HEAD=0,t.ITEM_TYPE_ARMOR_CLOTHES=1,t.ITEM_TYPE_ARMOR_TROUSERS=2,t.ITEM_TYPE_ARMOR_SHOULDER=3,t.ITEM_TYPE_ARMOR_WAIST=4,t.ITEM_TYPE_ARMOR_BACK=5,t.ITEM_TYPE_ARMOR_SHOES=6,t.ITEM_TYPE_ARMOR_HAND=7,t.ITEM_TYPE_ARMOR_NECKLACE=8,t.ITEM_TYPE_ARMOR_RING=9,t.ITEM_TYPE_ARMOR_AMULET=10,t.ITEM_TYPE_ARMOR_TRANSPORT=11,t.ITEM_TYPE_ARMOR_FASHION=12,t.ITEM_TYPE_WEAPON_ONEHAND_SWORD=13,t.ITEM_TYPE_WEAPON_TWOHAND_SWORD=14,t.ITEM_TYPE_WEAPON_ONEHAND_BLADE=15,t.ITEM_TYPE_WEAPON_TWOHAND_BLADE=16,t.ITEM_TYPE_WEAPON_ONEHAND_HEAVY=17,t.ITEM_TYPE_WEAPON_TWOHAND_HEAVY=18,t.ITEM_TYPE_WEAPON_TWOHAND_STAFF=19,t.ITEM_TYPE_WEAPON_TWOHAND_LANCE=20,t.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW=21,t.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW=22,t.ITEM_TYPE_WEAPON_TWOHAND_BOW=23,t.ITEM_TYPE_WEAPON_ONEHAND_HAND=24,t.ITEM_TYPE_TASK=25,t.ITEM_TYPE_BATTLE_USE=26,t.ITEM_TYPE_ANYTIME_USE=27,t.ITEM_TYPE_NOT_BATTLE_USE=28,t.ITEM_TYPE_BUILD_MATERIAL=29,t.ITEM_TYPE_GEM=30,t.ITEM_TYPE_SKILL_BOOK=31,t.ITEM_TYPE_PET=32,t.ITEM_TYPE_SPECEAIL=33,t.ITEM_TYPE_WEAPON_BALL=34,t.ITEM_TYPE_WEAPON_ONEHAND_GUN=35,t.ITEM_TYPE_WEAPON_TWOHAND_GUN=36,t.ITEM_TYPE_OTHER=37,t.ITEM_TYPE_ONE_SWORD=100,t.ITEM_TYPE_ONE_BLADE=101,t.ITEM_TYPE_NULL=-1,t.BALL_WEAPON_ID_AREA=t.ITEM_TYPE_WEAPON_ONEHAND_HAND+1,t.BALL_WEAPON_ID_ONEHAND_GUN=t.ITEM_TYPE_WEAPON_ONEHAND_HAND+2,t.BALL_WEAPON_ID_TWOHAND_GUN=t.ITEM_TYPE_WEAPON_ONEHAND_HAND+3,t.itemTypeText=["头","衣","裤","肩","腰带","背","鞋","护手","链","戒","护符","坐骑","时装","单手剑","双手剑","单手刀","双手刀","轻型武器","重型武器","杖","长柄武器","轻弩","重弩","弓箭","副手","任务物品","战斗道具","世界道具","普通道具","建筑材料","宝石","技能书","宠物","特殊","法器","轻枪","重枪","待定义"],t.SEX_MALE=0,t.SEX_FEMALE=1,t.SEX_MAX=2,t.sexTEXT=["男","女"],t.RACE_EAST=0,t.RACE_WEST=1,t.RACE_MAX=2,t.raceText=["东方","西方"],t.JOB_RANGER=1,t.JOB_XIUZHEN=2,t.JOB_WARRIOR=3,t.JOB_WIZARD=4,t.JOB_NEW=5,t.JOB_BACKUP2=6,t.JOB_PET_WIL=7,t.JOB_PET_STR=8,t.JOB_PET_AGI=9,t.JOB_BACKUP3=10,t.jobText=["","侠客","修真","战士","法师","贤者","武圣","睿智","勇猛","迅捷","枪王"],t.jobInfoText=[[],[{text:"    侠客注重内功和剑术修炼。他们敏捷而具有极强的瞬间破杀能力，就算是最强大的敌人，在侠客面前亦往往无法全身而退。剑客着重于提升"},{text:"敏捷",style:{textColor:16753920}},{text:"属性，它能让侠客拥有更高的暴击值和穿刺伤害。"}],[{text:"    修真者注重精神修炼，擅长咒术与各种五行之术。他们可以运用各种自然之力，帮助队友恢复和提升队友能力，是战斗中不可缺少的战友。修真者着重于提升"},{text:"体力",style:{textColor:16753920}},{text:"和"},{text:"感知",style:{textColor:16753920}},{text:"属性，体质能让修真者拥有更高的生命值，而感知则会让他们拥有更强的魔法抵抗力。"}],[{text:"    战士是近身格斗和施法者的融合。战士以强大的力量击退敌人，更可使用具有守护力量的光环协助队友驱除一切负面魔法。战士着重于提升"},{text:"力量",style:{textColor:16753920}},{text:"属性，它能让战士拥有更强的伤害能力和更高的生命值。"}],[{text:"    法师们具有强大的精神力，可以使用大范围魔法进行攻击，极具杀伤力的攻击能快速粉碎对手，置对手于死地。法师着重于提升"},{text:"智力",style:{textColor:16753920}},{text:"属性，它能让法师拥有更高的魔法伤害和魔力值，同时让法师有更强的魔法抵抗力。"}]],t.raceJobList=[[t.JOB_RANGER,t.JOB_XIUZHEN],[t.JOB_WARRIOR,t.JOB_WIZARD]],t.RANK_NONE=0,t.RANK_KING=1,t.RANK_PRIME=2,t.RANK_MARSHAL=3,t.RANK_KNIGHT=4,t.RANK_LORD=5,t.RANK_NOBLE=6,t.RANK_NATIONAL=7,t.RANK_SOLDIER=8,t.RANK_SUCCOR=9,t.RANK_COMTE=10,t.RANK_VICOMTE=11,t.RANK_NO_RANK=100,t.rankText=["无限制","国王","宰相","元帅","将军","领主","贵族","国民","士兵","援军","伯爵","子爵"],t.BUILDING_NONE=0,t.BUILDING_PALACE=1,t.BUILDING_CAMP=2,t.BUILDING_HOUSE=3,t.BUILDING_FACTORY_WOOD=4,t.BUILDING_FACTORY_STONE=5,t.BUILDING_FACTORY_IRON=6,t.BUILDING_SKILLSHOP_EAST_KNIGHT=7,t.BUILDING_SKILLSHOP_EAST_MASTER=8,t.BUILDING_SKILLSHOP_WEST_KNIGHT=9,t.BUILDING_SKILLSHOP_WEST_MASTER=10,t.BUILDING_SHOP_ITEM=11,t.BUILDING_SHOP_WEAPON=12,t.BUILDING_SHOP_ARMOR=13,t.buildingText=["国力排名","皇宫","军营","民居","木材厂","石材厂","铁矿厂","侠客技能所","修真技能所","战士技能所","法师技能所","道具商店","武器商店","防具商店"],t.SEARCH_MEM_ALL=0,t.SEARCH_MEM_ONLINE=1,t.SEARCH_MEM_UN_ONLINE=2,t.SEARCH_MEM_APPLY=3,t.searchMemText=["所有","在线","离线","申请"],t.ATKTYPE_STR=0,t.ATKTYPE_RANGE_STR=1,t.ATKTYPE_AGI=2,t.ATKTYPE_RANGE_AGI=3,t.ATKTYPE_MAGIC=4,t.ATKTYPE_CURSE=5,t.ATKTYPE_BLESS=6,t.AtkTypeText=["近身劈砍","远程劈砍","近身穿刺","远程穿刺","魔法攻击","诅咒攻击","祝福"],t.BUFFER_NONE=0,t.BUFFER_POISON=1,t.BUFFER_BURN=2,t.BUFFER_BLOOD=3,t.BUFFER_ATTR_DOWN=4,t.BUFFER_BLOCK_TALK=5,t.BUFFER_BLOCK_SKILL=6,t.BUFFER_SILENCE=7,t.BUFFER_STUN=8,t.BUFFER_CHAO=9,t.BUFFER_WEAK=10,t.BUFFER_ATTR_UP=11,t.BUFFER_ADD_MP=12,t.BUFFER_ADD_HP=13,t.BUFFER_HIDE=14,t.BUFFER_RESIST_MAGIC=15,t.BUFFER_RESIST_PHYSIC=16,t.BUFFER_RESIST_SILENCE=17,t.BUFFER_RESIST_STUN=18,t.BUFFER_RESIST_CHAO=19,t.BUFFER_RESIST_DEBUFF=20,t.BUFFER_INVINCIBLE=21,t.BUFFER_RESIST_TALK=22,t.BUFFER_RESIST_SKILL=23,t.BUFFER_RESIST_WEAK=24,t.BUFFER_TYPE_BUFF=25,t.BUFFER_TYPE_DEBUFF=26,t.BUFFER_RESIST_DIE_1HP=27,t.BUFFER_RESIST_DIE_FULLHP=28,t.BUFFER_RESIST_DIE_DELAY=29,t.BUFFER_DIE_CANNOT_RELIVE=30,t.bufferText=["无","中毒","火烧","流血","属性减少","禁言","封技","封魔","定身","混乱","衰弱","属性增加","持续回魔","持续回血","幻影","魔攻无效","物攻无效","免疫封魔","免疫定身","免疫混乱","全减益免疫","无敌","免疫禁言","免疫封技","免疫衰弱","增益","减益","不死意志","死者苏生","死亡傀儡","驱逐"],t.bufferInfoText=["无","中毒","火烧","流血","属性减少","禁言","封技","封魔","定身","混乱","衰弱","属性增加","持续回魔","持续回血","物理群体技能和祝福群体技能对其无效","魔攻无效","物攻无效","封魔效果对其无效","定身效果对其无效","混乱效果对其无效","全减益免疫","无敌","禁言效果对其无效","封技效果对其无效","衰弱效果对其无效","增益","减益","死亡后，会复活并恢复1点生命。一场战斗只能生效一次","死亡后，会复活并恢复所有生命，一场战斗只能生效一次","生命值为0时，不会马上死亡。直到回合结束时，才会触发死亡效果。","复活、不死意志、死者苏生效果对该宠物无效。"],t.ITEM_ID_PET=24,t.ITEM_ID_WOOD=1e3,t.ITEM_ID_STONE=1001,t.ITEM_ID_IRON=1002,t.ITEM_ID_IDENTIFY_SCROLL=4e4,t.ITEM_ID_IDENTIFY_SCROLL_BIND=40001,t.ITEM_ID_COMMAND_BOOK=40002,t.ITEM_ID_PET_RESET=40004,t.ITEM_ID_PET_AGE=40005,t.ITEM_ID_REPAIR=40008,t.ITEM_ID_PET_RESET2=40015,t.ITEM_ID_CHANGE_NAME=40016,t.ITEM_ID_SPEAK=40017,t.ITEM_ID_PET_ADD_SKILL=40020,t.ITEM_ID_STAR_SCROLL=40021,t.ITEM_ID_CHANGE_SEX=42e3,t.ITEM_ID_CP_POINT_ADD=42001,t.ITEM_ID_SP_POINT_ADD=42002,t.ITEM_ID_PROSPERITY_DEGREE_POINT_ADD=42003,t.ITEM_ID_SKILL_PLAYER=42004,t.ITEM_ID_SKILL_PET=42005,t.ITEM_ID_SKILL_PLAYER_BIND=42006,t.ITEM_ID_SKILL_PET_2=42007,t.ITEM_ID_SKILL_PLAYER_2=42016,t.ITEM_ID_SKILL_PLAYER_3=42017,t.ITEM_ID_SKILL_PLAYER_4=42018,t.ITEM_ID_SKILL_PLAYER_5=42019,t.ITEM_ID_SKILL_PLAYER_2_BIND=42020,t.ITEM_ID_SKILL_PLAYER_3_BIND=42021,t.ITEM_ID_SKILL_PLAYER_4_BIND=42022,t.ITEM_ID_SKILL_PLAYER_5_BIND=42023,t.ITEM_ID_HIGH_IDENTIFY_SCROLL=40022,t.ITEM_ID_HIGH_IDENTIFY_SCROLL_BIND=40023,t.ITEM_ID_UPGRADE_IDENTIFY_SCROLL=40024,t.ITEM_ID_UPGRAND_IDENTIFY_SCROLL_BIND=40025,t.ITEM_ID_UPGRADE_INTENSIFY_SCROLL=40026,t.ITEM_ID_UPGRAND_INTENSIFY_SCROLL_BIND=40027,t.ITEM_ID_CRYSTAL1=1041,t.ITEM_ID_CRYSTAL2=1042,t.ITEM_ID_CRYSTAL3=1043,t.ITEM_ID_CRYSTAL4=1044,t.ITEM_ID_CRYSTAL5=1045,t.ITEM_ID_MAGICCRYSTAL1=1107,t.ITEM_ID_MAGICCRYSTAL2=1108,t.ITEM_ID_MAGICCRYSTAL3=1109,t.ITEM_ID_MAGICCRYSTAL4=1110,t.ITEM_ID_MAGICCRYSTAL5=1111,t.ITEM_ID_HAIR_START=40100,t.ITEM_ID_HAIR_END=40199,t.ITEM_ID_FACE_START=40200,t.ITEM_ID_FACE_END=40249,t.ITEM_ID_RANGER=41100,t.ITEM_ID_XIUZHEN=41101,t.ITEM_ID_WARRIOR=41102,t.ITEM_ID_WIZARD=41103,t.ITEM_ID_NEW=41104,t.ITEM_ID_JOB_START=t.ITEM_ID_RANGER,t.ITEM_ID_JOB_END=41110,t.SKILL_TYPE_PLAYER=0,t.SKILL_TYPE_PET=1,t.SKILL_TYPE_OTHER=2,t.SKILL_SHOP_START_PLAYER=1,t.SKILL_SHOP_END_PLAYER=2e3,t.SKILL_SHOP_START_PET=2e3,t.SKILL_SHOP_END_PET=4e3,t.SKILL_SHOP_END_OTHER=1e4,t.SKILL_SHOP_COUNTRY_START_PLAYER=1500,t.SKILL_SHOP_COUNTRY_END_PLAYER=1999,t.SKILL_SHOP_COUNTRY_START_PET=3500,t.SKILL_SHOP_COUNTRY_END_PET=3999,t.SKILL_ID_TYPE_PLAYER=0,t.SKILL_ID_PET_NORMAL_TALENT=1,t.SKILL_ID_PET_LEARN_TALENT=2,t.SKILL_ID_OTHER=3,t.SKILL_END_PLAYER=5e3,t.SKILL_END_PET_NORMAL_TALENT=6e3,t.SKILL_END_PET_LEARN_TALENT=7e3,t.SKILL_END_OTHER=1e4,t.MAP_ID_ESCORT=999,t.MAP_ID_COUNTRY_WAR=998,t.MAP_ID_START_COMMON=1,t.MAP_ID_END_COMMON=999,t.MAP_ID_START_CITY_EAST=1e3,t.MAP_ID_END_CITY_EAST=2999,t.MAP_ID_START_CITY_WEST=3e3,t.MAP_ID_END_CITY_WEST=4999,t.MAP_ID_START_COUNTRY_EAST=5e3,t.MAP_ID_END_COUNTRY_EAST=5499,t.MAP_ID_START_COUNTRY_WEST=5500,t.MAP_ID_END_COUNTRY_WEST=5999,t.MAP_ID_START_MIRROR=6e3,t.MAP_ID_END_MIRROR=6099,t.MAP_ID_START_CITY_ALLOCATE=1e4,t.MAP_ID_END_CITY_ALLOCATE=19999,t.MAP_ID_START_COUNTRY_ALLOCATE=2e4,t.MAP_ID_END_COUNTRY_ALLOCATE=29999,t.MAP_ID_START_MIRROR_ALLOCATE=3e4,t.MAP_ID_END_MIRROR_ALLOCATE=31999,t.MERCENARY_FIGHT_TYPE_STR=0,t.MERCENARY_FIGHT_TYPE_BLESS=1,t.MERCENARY_FIGHT_TYPE_DEF=2,t.MERCENARY_FIGHT_TYPE_CURSE=3,t.mercenaryFight=["猛攻","治疗","守护","诅咒"],t.SHOP_PET_USEITEM_ID=3,t.SHOP_MARKETPLACE=4,t.SHOP_REPAIR_ID=10001,t.SHOP_COUNTRY_MENU=10002,t.SHOP_COUNTRY_MISSION=10003,t.SHOP_REBORN_MAP=10004,t.SHOP_ESCORT_LIST=10005,t.OFFLINE_MISSION_LIST=10006,t.SHOP_REWARD_CODE=10007,t.SHOP_STORE=10008,t.SHOP_COUNTRY_STORE=10009,t.SHOP_COUNTRY_SYSTEM_STORE=10010,t.SHOP_COUNTRY_WAR=10011,t.SHOP_WAR_DECLARE=10012,t.SHOP_WAR_INFO=10013,t.SHOP_CAMP=10014,t.SHOP_UNIN=10015,t.SHOP_WAR_RESULT=10016,t.SHOP_MARRY=10017,t.SHOP_DIVORCE=10018,t.SHOP_TEAMBOSS=10019,t.SHOP_SPORT_START=10020,t.SHOP_SPORT_END=10030,t.SHOP_INTEGRAL_START=10040,t.SHOP_INTEGRAL_END=10050,t.SHOP_SKY_START=10901,t.SHOP_SKY_END=10910,t.SHOP_COMPOSE_START=10050,t.SHOP_COMPOSE_COUNTRY_START=10500,t.SHOP_COMPOSE_END=10900,t.SHOP_ACTIVITY_COMPOSE_START=10200,t.SHOP_ACTIVITY_COMPOSE_END=10400,t.SHOP_PLAYER_SELL=10031,t.SHOP_PLAYER_BUY=10032,t.SHOP_ARENA_SINGLE=10033,t.SHOP_ARENA_TEAM=10034,t.SHOP_QUESTION=10035,t.SHOP_QUESTION_VIP=10036,t.SHOP_QUESTION_SUPER_QQ=10038,t.SHOP_STORE_VIP=10037,t.SHOP_COUNTRY_VIPGETMONEY=10039,t.SHOP_BACKUP_START=10039,t.SHOP_BACKUP_END=10040,t.SHOP_PET_START=10911,t.SHOP_PET_COUNTRY_START=10950,t.SHOP_PET_END=11e3,t.FURNACE_START=11001,t.FURNACE_COUNTRY_START=11020,t.FURNACE_END=11040,t.SHOP_SOLDIER_START=20001,t.SHOP_SOLDIER_COUNTRY_START=21e3,t.SHOP_SOLDIER_END=21999,t.SHOP_COUNTRY_START=22e3,t.SHOP_COUNTRY_END=23999,t.SHOP_VIP_COUNTRY_START=23e3,t.SHOP_VIP_COUNTRY_END=23020,t.SHOP_VIP_START=2e3,t.SHOP_VIP_END=2020,t.SHOP_SUPER_QQ_COUNTRY_START=23021,t.SHOP_SUPER_QQ_COUNTRY_END=23040,t.SHOP_SUPER_QQ_START=2021,t.SHOP_SUPER_QQ_END=2040,t.SHOP_ENCHANT_START=23100,t.SHOP_ENCHANT_COUNTRY_START=23200,t.SHOP_ENCHANT_END=23299,t.SHOP_ADVANCED_START=23400,t.SHOP_ADVANCED_END=23499,t.SEARCH_ITEM_TYPE_SWORD=1,t.SEARCH_ITEM_TYPE_BLADE=2,t.SEARCH_ITEM_TYPE_STICK=3,t.SEARCH_ITEM_TYPE_BOW=4,t.SEARCH_ITEM_TYPE_HAMMER=5,t.SEARCH_ITEM_TYPE_SPECIAL=6,t.SEARCH_ITEM_TYPE_ARMOR=7,t.SEARCH_ITEM_TYPE_JEWELRY=8,t.SEARCH_ITEM_TYPE_PET=9,t.SEARCH_ITEM_TYPE_GEM=10,t.SEARCH_ITEM_TYPE_MATERIAL=11,t.SEARCH_ITEM_TYPE_OTHER=12,t.SEARCH_ITEM_TYPE_BALL=13,t.goodsTypeText=["全部","剑","刀","杖","弓","重型武器","特殊武器","法器","护甲","饰品","宠物","宝石","材料","其它"],t.goodsType=[0,t.SEARCH_ITEM_TYPE_SWORD,t.SEARCH_ITEM_TYPE_BLADE,t.SEARCH_ITEM_TYPE_STICK,t.SEARCH_ITEM_TYPE_BOW,t.SEARCH_ITEM_TYPE_HAMMER,t.SEARCH_ITEM_TYPE_SPECIAL,t.SEARCH_ITEM_TYPE_BALL,t.SEARCH_ITEM_TYPE_ARMOR,t.SEARCH_ITEM_TYPE_JEWELRY,t.SEARCH_ITEM_TYPE_PET,t.SEARCH_ITEM_TYPE_GEM,t.SEARCH_ITEM_TYPE_MATERIAL,t.SEARCH_ITEM_TYPE_OTHER],t.goodsIcon=[6,4,14,5,0,12,40,11,20,25,32,30,35],t.PURCHASE_ITEM_TYPE_GEM=1,t.PURCHASE_ITEM_TYPE_MATERIAL=2,t.PURCHASE_ITEM_TYPE_TASKITEM=3,t.PURCHASE_ITEM_TYPE_OTHER=4,t.purchaseTypeText=["--","宝石","材料","任务物品","其它"],t.purchaseType=[-1,t.PURCHASE_ITEM_TYPE_GEM,t.PURCHASE_ITEM_TYPE_MATERIAL,t.PURCHASE_ITEM_TYPE_TASKITEM,t.PURCHASE_ITEM_TYPE_OTHER],t.purchaseIcon=[34,30,32,35],t.SEARCH_LEVEL_ALL=0,t.SEARCH_LEVEL_1_10=1,t.SEARCH_LEVEL_10_20=2,t.SEARCH_LEVEL_20_30=3,t.SEARCH_LEVEL_30_40=4,t.SEARCH_LEVEL_40_50=5,t.SEARCH_LEVEL_50_60=6,t.SEARCH_LEVEL_60_70=7,t.SEARCH_LEVEL_70_80=8,t.SEARCH_LEVEL_80_90=9,t.goodsLevelText=["无限制","1-10级","11-20级","21-30级","31-40级","41-50级","51-60级","61-70级","71-80级","81-90级"],t.SEARCH_SORT_OBJ_PRICE=1,t.SEARCH_SORT_OBJ_CREATETIME=2,t.SEARCH_SORT_TYPE_ASC=1,t.SEARCH_SORT_TYPE_DESC=-1,t.RELATION_FRIEND=0,t.RELATION_BLACK=1,t.RELATION_BLACK_FRIEND=2,t.RELATION_MASTER=3,t.RELATION_PRENTICE=4,t.BAG_CHECKUP_RESULT_NEW=1,t.BAG_CHECKUP_RESULT_UPDATE=2,t.BAG_CHECKUP_RESULT_ASK=3,t.NEAR_ALL=0,t.NEAR_SHOP=1,t.NEAR_ENCHANT_SHOP=2,t.NEAR_TEAM=3,t.NEAR_FIGHT=4,t.NEAR_PHOTO=5,t.NEAR_NULL=6,t.NEAR_MY_TEAM=7,t.NEARSTR=["筛选","摆摊","附魔","组队","战斗","照片","空闲"],t.ADMIN_1=1,t.ADMIN_2=2,t.ADMIN_3=3,t.ADMIN_4=4,t.ADMIN_MAX=10,t.ADMINSTR=["","游戏管理员","邮件管理员","交易所管理员","国家管理员"],t.COUNTRY_COMMAND_NONE=0,t.COUNTRY_COMMAND_CHANGE_NAME=1,t.COUNTRY_COMMAND_ADD_PROSPERITY=2,t.COUNTRY_COMMAND_TRANSFER_RESOURCE=3,t.COUNTRY_COMMAND_ADD_PEOPLE=4,t.COUNTRY_COMMAND_ADD_LAND=5,t.COUNTRY_COMMAND_ADD_ARMY=6,t.COUNTRY_COMMAND_ADD_ARMY_USELAND=7,t.COUNTRY_COMMAND_REFRESH_TASK=8,t.COUNTRY_COMMAND_KING_COMMAND=9,t.COUNTRY_COMMAND_CREATE_WAR=10,t.countryBooks=["","国家改名","提升繁荣度","资源转换","增加民众数","增加空余土地","增加军力值","增加军力(消耗土地)","重置当天国家任务","繁荣增幅","强制攻击"],t.PLAYER_EVENT_CHOOSE_YES=1,t.PLAYER_EVENT_CHOOSE_NO=2,t.PLAYER_EVENT_TEAM_INVITE=1,t.PLAYER_EVENT_TEAM_APPLY=2,t.PLAYER_EVENT_PKASK=3,t.PLAYER_EVENT_JOINCOUNTRYASK=4,t.PLAYER_EVENT_ESCORT=5,t.PLAYER_EVENT_MASTER=6,t.PLAYER_EVENT_JOINCOUNTRYHANDLE=7,t.PLAYER_EVENT_MERRY=8,t.PLAYER_WEDDING_CARD=9,t.PLAYER_EVENT_MAIL=100,t.PLAYER_EVENT_TOURIST_MODIFY=101,t.PLAYER_EVENT_ACTIVITY_LIST=102,t.BATTLE_NET_START=1e4,t.BATTLE_NET_END=15e3,t.MAIL_TITLE_CONSUME_ERROR=1,t.MAIL_TITLE_CONSUME=2,t.MAIL_TITLE_PASSNAME=3,t.MAIL_TITLE_PASSWORD=4,t.MAIL_TITLE_ITEM=5,t.MAIL_TITLE_ACTOR=6,t.MAIL_TITLE_REPORT=7,t.MAIL_TITLE_BUG=8,t.MAIL_TITLE_NETWORD=9,t.MAIL_TITLE_ADVICE=10,t.MAIL_TITLE_OTHER=0,t.DONATE_TYPE_MONEY3=1,t.DONATE_TYPE_MONEY1=2,t.DONATE_TYPE_WOOD=3,t.DONATE_TYPE_STONE=4,t.DONATE_TYPE_IRON=5,t.DONATE_LABEL=[[["1万铜","无"],["10万铜","无"],["100万铜","无"]],[["10黄金","10贡献度"],["50黄金","50贡献度"],["100黄金","100贡献度"]],[["5木材","1贡献度"],["50木材","10贡献度"],["500木材","100贡献度"]],[["5石材","1贡献度"],["50石材","10贡献度"],["500石材","100贡献度"]],[["5铁矿","1贡献度"],["50铁矿","10贡献度"],["500铁矿","100贡献度"]]],t.DONATE_DATA=[[[t.DONATE_TYPE_MONEY3,1e4,0],[t.DONATE_TYPE_MONEY3,1e5,0],[t.DONATE_TYPE_MONEY3,1e6,0]],[[t.DONATE_TYPE_MONEY1,10,10],[t.DONATE_TYPE_MONEY1,50,50],[t.DONATE_TYPE_MONEY1,100,100]],[[t.DONATE_TYPE_WOOD,5,1],[t.DONATE_TYPE_WOOD,50,10],[t.DONATE_TYPE_WOOD,500,100]],[[t.DONATE_TYPE_STONE,5,1],[t.DONATE_TYPE_STONE,50,10],[t.DONATE_TYPE_STONE,500,100]],[[t.DONATE_TYPE_IRON,5,1],[t.DONATE_TYPE_IRON,50,10],[t.DONATE_TYPE_IRON,500,100]]],t.DONATE_MONEY3=[["1万铜","无"],["10万铜","无"],["100万铜","无"]],t.DONATE_MONEY3_VALUE=[[t.DONATE_TYPE_MONEY3,1e4],[t.DONATE_TYPE_MONEY3,1e5],[t.DONATE_TYPE_MONEY3,1e6]],t.DONATE_MONEY1=[["10黄金","10贡献度"],["50黄金","50贡献度"],["100黄金","100贡献度"],["500黄金","500贡献度"],["1000黄金","1000贡献度"]],t.DONATE_MONEY1_VALUE=[[t.DONATE_TYPE_MONEY1,10],[t.DONATE_TYPE_MONEY1,50],[t.DONATE_TYPE_MONEY1,100],[t.DONATE_TYPE_MONEY1,500],[t.DONATE_TYPE_MONEY1,1e3]],t.DONATE_WOODArray=[["5木材","1贡献度"],["50木材","10贡献度"],["500木材","100贡献度"]],t.DONATE_WOOD_VALUE=[[t.DONATE_TYPE_WOOD,5],[t.DONATE_TYPE_WOOD,50],[t.DONATE_TYPE_WOOD,500]],t.DONATE_STONE=[["5石材","1贡献度"],["50石材","10贡献度"],["500石材","100贡献度"]],t.DONATE_STONE_VALUE=[[t.DONATE_TYPE_STONE,5],[t.DONATE_TYPE_STONE,50],[t.DONATE_TYPE_STONE,500]],t.DONATE_IRON=[["5铁矿","1贡献度"],["50铁矿","10贡献度"],["500铁矿","100贡献度"]],t.DONATE_IRON_VALUE=[[t.DONATE_TYPE_IRON,5],[t.DONATE_TYPE_IRON,50],[t.DONATE_TYPE_IRON,500]],t.MASTER_FLAG_NONE=0,t.MASTER_FLAG_MASTER=1,t.MASTER_FLAG_PRENTICE=2,t.BIND_SETTING_SMS=1,t.BIND_SETTING_12114=2,t.bindType=t.BIND_SETTING_SMS,t.BIND_SETTING_FUNCTION_RESET=1,t.BIND_SETTING_FUNCTION_FIND=2,t.BIND_SETTING_FUNCTION_CLEAN=3,t.BIND_SETTING_FUNCTION_BIND=4,t.CLIENT_TYPE_NULL=0,t.CLIENT_TYPE_JAR=1,t.CLIENT_TYPE_ANDROID=2,t.CLIENT_TYPE_IOS=3,t.CLIENT_TYPE_JAR_NEW=4,t.CLIENT_TYPE_ANDROID_NEW=5,t.CLIENT_TYPE_IOS_NEW=6,t.IS_OPEN_TYPE_BONUS_ONLINE=1,t.IS_OPEN_TYPE_LOTTERY_DRAW_NEW=2,t.IS_OPEN_TYPE_BOSS_REWARD=3,t.IS_OPEN_TYPE_CHARGE_ACTIVITY=4,t.IS_OPEN_TYPE_ENCHANT=5,t.IS_OPEN_TYPE_FORMATION=6,t.IS_OPEN_TYPE_WO=7,t.IS_OPEN_TYPE_MO9_POP=8,t.IS_OPEN_TYPE_PLAYER_IDENTIFY=9,t.IS_OPEN_TYPE_UPGRADE=10,t.IS_OPEN_TYPE_BATTLE=11,t.IS_OPEN_TYPE_COST_REWARD=12,t.IS_OPEN_TYPE_LEVEL_REWARD=16,t.IS_OPEN_TYPE_MICRO_REWARD=17,t.IS_OPEN_TYPE_SEVENDAY_REWARD=18,t.IS_OPEN_TYPE_EXCHANGE_MONEY=20,t.IS_OPEN_TYPE_OFFLINE_EXP=21,t.IS_OPEN_TYPE_OPEN_ACTIVITIES=22,t.IS_OPEN_TYPE_OPEN_VIP=23,t.IS_OPEN_TYPE_DAYACTITY=24,t.IS_OPEN_TYPE_SERVERFOUNDATION=25,t.IS_OPEN_TYPE_SHARE=26,t.IS_OPEN_TYPE_FIRST_CHARGE=27,t.IS_OPEN_TYPE_FOLLOW=28,t.IS_OPEN_TYPE_ONEKEY_DAILY=30,t.IS_OPEN_TYPE_SPRING=31,t.GUIDE_TYPE_CP=1,t.GUIDE_TYPE_MAIL=2,t.GUIDE_TYPE_COUNTRY=3,t.GUIDE_TYPE_MAP=4,t.GUIDE_TYPE_PET_EVOLVE=5,t.GUIDE_TYPE_LEARN_SKILL=6,t.GUIDE_TYPE_LOTTERY_DRAW=7,t.GUIDE_TYPE_ITEM_USE=8,t.GUIDE_TYPE_EQUIP=9,t.GUIDE_TYPE_LEVEL15_ASS=10,t.GUIDE_TYPE_SHOP=11,t.GUIDE_TYPE_MOSAIC=12,t.GUIDE_TYPE_NEW_LEARN_SKILL=13,t.GUIDE_TYPE_PET_LEARN_SKILL=14,t.GUIDE_TYPE_IDENTIFY=15,t.GUIDE_TYPE_SYNTHIS=16,t.PLAYER_SHOP_TYPE_NORMAL=0,t.PLAYER_SHOP_TYPE_ENCHANT=1,t.SHOP_MINIGAME_START=23600,t.SHOP_MINIGAME_END=23699,t.GAME_TYPE_GUESS=0,t.GAME_TYPE_PLUMBER=1,t.OK="ok",t.NO="no",t.MAX_OTHER_PRICE_MAX=8,t.MAX_SELL_NAME=20,t.MAX_ACTOR_PRICE_MAX=6,t.MAX_NAME_LENGTH=12,t.MAX_USERNAME_LENGTH=20,t.MAX_COUNTRY_NAME_LEN=12,t.MAX_BIND_PHONE=12,t.MAX_CHAT_LEN=120,t.MAX_MAIL_CONTENT_LEN=100,t.MAX_CITY_NAME_LEN=20,t.MAX_CITY_SIGN_LEN=100,t.MAX_PET_NAME_LEN=12,t.MAX_COUNTRY_AFFICHE_LEN=100,t.MAX_MASTER_MANIFESTO=100,t.MAX_FRIEND_REMARDS=14,t.default_clear_time=3e5,t.CHANNEL_9G=2e3,t.CHANNEL_1758=2300,t.CHANNEL_SINA=2900,t.CHANNEL_QQBROWSER=3100,t.CHANNEL_UCALI=3200,t.CHANNEL_WANBA=7500,t.CHANNEL_YIJIE=10600,t.CHANNEL_JIUYAO=10700,t.CHANNEL_MANBA=10800,t.CHANNEL_XIAOMI=10900,t.CHANNEL_QUANQUAN=11e3,t}();__reflect(Define.prototype,"Define");var GameText=function(){function t(){}return t.getText=function(e){return null==t.GAME_TEXT?"T_"+e:0>e||e>=t.GAME_TEXT.length?"TX_"+e:t.GAME_TEXT[e]},t.getTips=function(){return t.TIP_TEXT},t.setTip=function(e){t.TIP_TEXT=e},t.getMoneyText=function(e){switch(e){case ModelConst.MONEY1:return t.STR_MONEY1;case ModelConst.MONEY2:return t.STR_MONEY2;case ModelConst.MONEY3:return t.STR_MONEY3}return t.STR_MONEY},t.getMoneyResource=function(t){var e="";return t==ModelConst.MONEY1?e="gold_square":t==ModelConst.MONEY2?e="gold_leaf":t==ModelConst.MONEY3&&(e="gold_coin"),e+(xhd?"_hd":"_sd")},t.getMoneyResourceByItemMoneyType=function(t){var e="";return t==ItemData.ITEM_MONEY_TYPE_1?e="gold_square":t==ItemData.ITEM_MONEY_TYPE_2?e="gold_leaf":t==ItemData.ITEM_MONEY_TYPE_3&&(e="gold_coin"),e+(xhd?"_hd":"_sd")},t.TI_EQUIP=0,t.TI_GEM=1,t.TI_DROP=2,t.TI_COMPARE_EQUIP=3,t.TI_BACK=4,t.TI_UN_EQUIP=5,t.TI_PLAYER_INFO=6,t.TI_TEST=7,t.TI_USE=8,t.TI_BACK_COMPARE=9,t.TI_SEE_INFO=10,t.TI_AUTO_RELEASE=11,t.TI_UN_RELEASE=12,t.TI_UN_SKILL=13,t.TI_ERROR=14,t.TI_WARM_SHOW=15,t.TI_JOIN_TEAM=16,t.TI_LEAVE_TEAM=17,t.TI_INVITE_TEAM=18,t.TI_DISMISS_TEAM=19,t.TI_KICK_TEAMER=20,t.TI_CHANGE_LEADER=21,t.TI_PK=22,t.TI_OK=23,t.TI_NETWORK_ERROR=24,t.TI_LOADING=25,t.TI_MAP_CREATEING=26,t.TI_ACCEPT_MISSION=27,t.TI_SUBMIT_MISSION=28,t.TI_DELECT_MISSION=29,t.TI_NOT_ACCEPT_MISSION=30,t.TI_LEARN=31,t.TI_MISSION_REWARD=32,t.TI_BAG_FULL=33,t.TI_CHAT=34,t.TI_PRIVATE_CHAT=35,t.TI_SELL_ONE=36,t.TI_SELL_TEN=37,t.TI_SELL_ALL=38,t.TI_MISSION=39,t.TI_NEAR_PLAYER=40,t.TI_BATTLE_NO_SKILL=41,t.TI_SEND_MAIL=42,t.TI_MAIL_BOX=43,t.TI_MAIL_TYPE_SYSTEM=44,t.TI_MAIL_TYPE_MONEY=45,t.TI_MAIL_TYPE_TASK=46,t.TI_MAIL_TYPE_SERVICE=47,t.TI_MAIL_TYPE_PLAYER=48,t.TI_MAIL_TYPE_BACK=49,t.TI_MAIL_TYPE_RECEIPT=50,t.TI_MAIL_PICK_ITEM=51,t.TI_DELETE=52,t.TI_MAIL_TYPE_SEND=53,t.TI_MAIL_REGAIN=54,t.TI_SEND_MAIL_BOX=55,t.TI_SEND_GM_MAIL=56,t.TI_WARN=57,t.TI_MAIL_REPLY=58,t.TI_SHOP_BUY_NINETY_NINE=59,t.TI_SHOP_BUY_THIRTY=60,t.TI_SHOP_BUY_ONE=61,t.TI_SHOP_BUY=62,t.TI_SHOP_SELL=63,t.TI_ITEM_X=64,t.TI_TASK_PATH=65,t.TI_MISSION_REFUSE=66,t.TI_GET_MISSION=67,t.TI_MAIL_PLAYER=68,t.TI_MAIL_WRITE=69,t.TI_OTHER=70,t.TI_PET_LIST=71,t.TI_PET_EQUIP=72,t.TI_PET_UP_EQUIP=73,t.TI_PET_DROP=74,t.TI_PET_ITEM=75,t.TI_MAIL_REFUSE=76,t.TI_PET_INFO=77,t.TI_CITY_INFO=78,t.TI_DETAIL=79,t.TI_BUY_MERCENARY=80,t.TI_NO_BUY_MER=81,t.TI_EQUIP_REFRESH=82,t.TI_SHOP_START=83,t.TI_SHOP_END=84,t.TI_IN_SHOP=85,t.TI_MAIL=86,t.TI_RELATION=87,t.TI_MERCENARY=88,t.TI_ATTACK=89,t.TI_SKILL=90,t.TI_ITEM=91,t.TI_AUTO=92,t.TI_STATUS=93,t.TI_ESCAPE=94,t.TI_UP_SHOP=95,t.TI_DOWN_SHOP=96,t.TI_ADUST_PRICE=97,t.TI_PLAYER_SHOP_RECORD=98,t.TI_SHOP_TAB_SELL=99,t.TI_PLAYER_SHOP=100,t.TI_PLAYER_SHOP_OWNER=101,t.TI_CHATMSG_WORLD=102,t.TI_CHATMSG_MAP=103,t.TI_CHATMSG_COUNTRY=104,t.TI_CHATMSG_TEAM=105,t.TI_CHATMSG_PLAYER=106,t.TI_CHATMSG_SYSTEM=107,t.TI_CHANNEL_WORLD=108,t.TI_CHANNEL_MAP=109,t.TI_CHANNEL_COUNTRY=110,t.TI_CHANNEL_TEAM=111,t.TI_CHANNEL_PLAYER=112,t.TI_HANG_SELL=113,t.TI_SUPPLY=114,t.TI_PURCHASE=115,t.TI_STORAGE=116,t.TI_PUT_SHOP=117,t.TI_CANCEL_HANG_SELL=118,t.TI_BUY_LIST=119,t.TI_PURCHASE_LIST=120,t.TI_PUBLISH_ORDER=121,t.TI_BACK_SELECT=122,t.TI_GET_ORDER=123,t.TI_CANCEL_ORDER=124,t.TI_SEE_ORDER=125,t.TI_FRIEND=126,t.TI_ADD_BLACK=127,t.TI_IDENTIFY=128,t.TI_FRIEND_LIST=129,t.TI_BLACK_LIST=130,t.TI_NO_TALK=131,t.TI_BIND=132,t.TI_CHANGE_NAME=133,t.TI_INVITE_COUNTRY=134,t.TI_SEE_CITY=135,t.TI_COUNTRY_INFO=136,t.TI_SEE_PLAYER_SHOP=137,t.TI_DEL_RELATION=138,t.TI_ATTR_SET=139,t.TI_UP_LEVEL=140,t.TI_UP_LEARN=141,t.TI_BUILD=142,t.TI_GENERAL=143,t.TI_VICE_GENERAL=144,t.TI_TEMP_TALK=145,t.TI_INTO_ACTIVITY_MAP=146,t.TI_QUIT=147,t.TI_PET_HAND=148,t.TI_PET_AUTO=149,t.TI_MASTER=150,t.TI_TO_SAY=151,t.TI_CONTINUE_IDNITIFY=152,t.TI_CHANGE_ATTRIBUTE=153,t.TI_REMOVE_ARMY=154,t.TI_INSERT_ARMY=155,t.TI_DELETE_ARMY=156,t.TI_ENTER=157,t.TI_AUTO_FIGHT=158,t.TI_INTEGRAL=159,t.TI_INTEGRAL_EQUIP=160,t.TI_SOFELOCK_SET=161,t.TI_SOFELOCK_ALTER=162,t.TI_SOFELOCK_REMOVE=163,t.TI_SOFELOCK_RESET=164,t.TI_MAIL_REPORT=165,t.TI_SEARCH_NAME=166,t.TI_ORDER=167,t.TI_BAG=168,t.TI_MISSION_REFLASH=169,t.TI_SUBMIT=170,t.TI_MISSION_SUBMIT=171,t.TI_ACCEPT=172,t.TI_MISSION_RESET=173,t.TI_ON_LINE=174,t.TI_UNKNOWN_STATUS=175,t.TI_BEFORE=176,t.TI_LEVEL=177,t.TI_PREVIOUS_PAGE=178,t.TI_NEXT_PAGE=179,t.TI_SEE_DETAILS=180,t.TI_VIEW_BATTLE=181,t.TI_SEE_ACHIEVE=182,t.TI_MAKE_FRIEND=183,t.TI_TEAM_INVITE=184,t.TI_SEE_ITEM=185,t.TI_SEE_MISSION=186,t.TI_SEE_COUNTRY=187,t.TI_BIND_PHONE=188,t.TI_BIND_EMAIL=189,t.TI_SEE_PHOTO=190,t.TI_VIP_ACTIVATE=191,t.TI_CHAT_SAME_CHANNEL=192,t.TI_SYSTEM_CHAT_SET=193,t.TI_DELETE_FRIEND=194,t.TI_RELATION_FLY=195,t.TI_DEL_MASTER=196,t.TI_LEAVE_COUNTRY=197,t.TI_ADJUST_JOB=198,t.TI_BECOME_KING=199,t.TI_ARMY_DELETE=200,t.TI_BUY_PLAYER=201,t.TI_SHOPPLAYER_INFO=202,t.TI_SHOPPLAYER_BAG=203,t.TI_SEE_PET=204,t.TI_SEE_STORE=205,t.TI_CANTACT_SELLER=206,t.TI_APPRENTICE=207,t.TI_CARD_VIEW=208,t.TI_SHOW=209,t.TI_HIDE=210,t.TI_DAY=211,t.TI_ACTIVATE=212,t.TI_CONSUME=213,t.TI_YOU=214,t.TI_CHALLENGE=215,t.TI_VIEW_EMAIL=216,t.TI_COMMENTS=217,t.TI_EQUIP_BIND=218,t.TI_UN_BIND=219,t.GAME_TEXT=["装备","宝石镶嵌","丢弃","装备比较","返回","解除装备","人物","测试","使用","返回比较","查看","设为有效","取消有效","放弃技能","错误","温馨提示","申请入队","离开队伍","组队邀请","解散","踢人","提升队长","决斗","确定","掉线了，确认返回主界面！","正在读取中...","正在加载地图...","接受任务","完成任务","放弃任务","不可接","升级/学习","任务奖励","背包已满","聊天","私聊","卖1个","卖10个","卖全部","任务","周围","没有主动技能","发送邮件","收件箱","系统邮件","充值邮件","任务奖励邮件","客服/系统邮件","玩家邮件","回执/退回邮件","回执邮件","提取附件","删除","已发交易邮件","收回邮件","发件箱","联系客服","警告","回复","买99个","买30个","买1个","购买","卖出"," x ","任务寻路","拒绝","领取奖励","联系玩家","写信","其它","宠物列表","出战","休息","放生","道具","拒收邮件","宠物","个人城市","详细","雇佣","解雇","整理","开始摆摊","结束摆摊","进入摊位","邮件","社交","佣兵","攻击","技能","物品","自动","状态","逃跑","上架","下架","修改单价","销售记录","出售","摊位","摊主","世界","区域","国家","队伍","私聊","系统","世界聊天","区域聊天","国家聊天","队伍聊天","私聊","挂售","供应","收购","仓库","摆摊","取消挂售","购买列表","收购列表","发布订单","重选","提取订单","取消订单","浏览订单","好友","加为黑名单","鉴定","好友列表","黑名单列表","屏蔽","绑定","改名","邀请入国","参观城市","国家","查看摆摊","取消屏蔽","属性分配","升级","学习","建造","主将","副将","临时","进入活动地图","离开","控制宠物","宠物自动","师徒","发言","继续鉴定","替换属性","移出","插入","踢出","进入","自动战斗","分解","分解装备","设置安全锁","修改安全锁","解除安全锁","重置安全锁","举报","关键字","订单","背包","马上刷新","提交","提交任务","接受","重置任务","在线","--","前","%U级","上一页","下一页","查看资料","观战","查看成就","加为好友","邀请组队","查看物品","查看任务","查看国家","绑定手机","绑定邮箱","查看照片","VIP续期","同频道聊天","频道设置","删除好友","传送","解除师徒","踢出国家","任免职位","转让国王","踢出军队","购买角色","查看属性","查看背包","查看宠物","查看仓库","联系卖家","拜师","查看名片","显示","隐藏","%U天","激活","消耗","你","挑战","查看邮件","评论","装备绑定","解除绑定"],t.ITEM_SHOP_TAB=[[t.getText(t.TI_SHOP_BUY),t.getText(t.TI_SHOP_TAB_SELL)],[t.getText(t.TI_PLAYER_SHOP),t.getText(t.TI_PLAYER_SHOP_OWNER)],[t.getText(t.TI_PLAYER_SHOP),t.getText(t.TI_PLAYER_SHOP_OWNER)],[t.getText(t.TI_PLAYER_SHOP),t.getText(t.TI_PLAYER_SHOP_OWNER)]],t.RELATION_TEXT=[t.getText(t.TI_FRIEND),t.getText(t.TI_NO_TALK),t.getText(t.TI_MASTER),t.getText(t.TI_TEMP_TALK)],t.CHAT_CHANNEL=[t.getText(t.TI_CHATMSG_WORLD),t.getText(t.TI_CHATMSG_MAP),t.getText(t.TI_CHATMSG_COUNTRY),t.getText(t.TI_CHATMSG_TEAM),t.getText(t.TI_CHATMSG_PLAYER),t.getText(t.TI_CHATMSG_SYSTEM)],t.SELECT_CHANNEL=[t.getText(t.TI_CHANNEL_WORLD),t.getText(t.TI_CHANNEL_MAP),t.getText(t.TI_CHANNEL_COUNTRY),t.getText(t.TI_CHANNEL_TEAM),t.getText(t.TI_CHANNEL_PLAYER),GameText2.STR_UNION,GameText2.STR_SERVER],t.SELECT_CHANNEL2=[8,16,32,64,128,65536],t.MAIL_MENU=[t.getText(t.TI_SEND_MAIL_BOX),t.getText(t.TI_MAIL_BOX),t.getText(t.TI_BACK)],t.MAIL_BOX_MENU=[t.getText(t.TI_MAIL_TYPE_SEND),t.getText(t.TI_MAIL_TYPE_SYSTEM),t.getText(t.TI_MAIL_TYPE_MONEY),t.getText(t.TI_MAIL_TYPE_TASK),t.getText(t.TI_MAIL_TYPE_SERVICE),t.getText(t.TI_MAIL_TYPE_PLAYER),t.getText(t.TI_MAIL_TYPE_BACK),t.getText(t.TI_MAIL_TYPE_RECEIPT),t.getText(t.TI_BACK)],t.PLAYER_LIST_POP_MENU=[t.getText(t.TI_BACK),t.getText(t.TI_JOIN_TEAM),t.getText(t.TI_INVITE_TEAM),t.getText(t.TI_LEAVE_TEAM),t.getText(t.TI_KICK_TEAMER),t.getText(t.TI_DISMISS_TEAM),t.getText(t.TI_CHANGE_LEADER),t.getText(t.TI_PK),t.getText(t.TI_PRIVATE_CHAT),t.getText(t.TI_CITY_INFO),t.getText(t.TI_IN_SHOP),t.getText(t.TI_FRIEND),t.getText(t.TI_ADD_BLACK)],t.TIP_TEXT="欢迎进入游戏",t.STR_ANY_KEY="点击继续",t.STR_SPRITE_GUIDE_1="    我是您的精灵小助手，在之后的游戏过程中，我将帮助您更好的进行游戏！",t.STR_SPRITE_GUIDE_2="    这里记录了每日可完成的事项，就包括了您刚才在个人城市中接取的日常任务！",t.STR_SPRITE_GUIDE_3="    随着您冒险的继续，每日可完成的事项也会增加，记得常进来看看哦！",t.STR_SPRITE_GUIDE_4="    这里是游戏的攻略，包括各职业的介绍和加点，技能介绍等都可以找到！",t.STR_SPRITE_GUIDE_5="    设置主动技能后，在自动战斗中，就会释放技能了！",t.STR_SPRITE_GUIDE_6="    是不是有道具不懂拿？看这里看各道具的获取途径吧!",t.STR_SPRITE_GUIDE_7="    打不赢怪物?游戏前期提供了雇佣兵,人多力量大，快去试一下吧！",t.STR_SPRITE_GUIDE_8="     怪物太强，可以先去做其他任务，等实力提升了再来挑战吧！",t.STR_ARENA_WAIT_MEMBER="等待队长操作",t.STR_ARENA_WAIT_FIGHT="正在等待战斗，请耐心等候",t.STR_ARENA_SELECT_FIGHT="请选择竞技场进入",t.STR_OPEN_MAIL_LIST_ERROR="打开邮件列表失败",t.STR_MAIL_BOX_NO_MAIL="收件箱暂时无邮件",t.STR_ATTACH_MAIL_SUCCESS="提取附件成功",t.STR_ATTACH_MAIL_FAIL="提取附件失败",t.STR_SHOPITEM_NO_SELETE_ITEM="没有选中物品",t.STR_SHOPITEM_BUY_SUCCESS="成功购买",t.STR_SHOPITEM_SELL_SUCCESS="成功卖出",t.STR_MAIL_NO_NAME="收件人不能为空!",t.STR_MAIL_SEND_GM_SUCCESS="客服邮件发送成功!",t.STR_MEMBER_MAIL_TASK="更多的奖励已发到您的任务邮箱，请及时领取！",t.STR_NO_WORLD_ITEM_USE="背包中没有可使用的道具！",t.STR_BAG_NO_PET="背包中没有宠物",t.STR_MERCENARY_BUY_SUCCESS="雇佣成功",t.STR_NO_DATA_LIST="列表中没有数据",t.STR_MERCENARY_NO_BUY_SUCCESS="佣兵解雇成功",t.STR_IN_SHOP_NO_USE="摆摊中的物品不能使用!",t.STR_IN_SHOP_NO_JUMP="摆摊中不能跳图",t.STR_IN_SHOP_NO_UNEQUIP="摊位物品不能卸载",t.STR_IN_SHOP_NO_DEL="摊位物品不能丢弃",t.STR_NO_WORLD_ITEM_ATTACH="背包中没有可镶嵌的宝石！",t.STR_WORLD_ITEM_ATTACH_WARN="该装备上次镶嵌失败，如果继续镶嵌，原镶嵌属性将清空，重新计算！",t.STR_ERROR_CHAR="不能输入非法字符",t.STR_INFO_COUNTRY_APPLY="申请入国发送成功，请等待国王确认！",t.STR_MAIL_LIST_NOTHING="信箱中没有邮件！",t.STR_GOODS_SELL_NO_SELECT="没有选中挂售物品！",t.STR_GOODS_CANCEL_SELL_NO_SELECT="没有选中取消挂售物品！",t.STR_GOODS_SELL_FULL="挂售物品已满！",t.STR_GOODS_SUPPLY_NO_SELECT="没有选中供应物品！",t.STR_GOODS_SELL_SUCCESS="挂售成功！",t.STR_GOODS_CANCEL_SELL_SUCCESS="取消挂售成功！",t.STR_TODO="功能尚在开发中！",t.STR_EQUIP_DEL_EQUIP="已装备物品不能丢弃,请先卸下装备！",t.STR_PET_DEL_EQUIP="出战宠物不能放生！",t.STR_MYPLAYER_NO_PET="您还未拥有属于自已的宠物！",t.STR_MYPLAYER_NO_MERCENARY="您还未拥有属于自已的佣兵！",t.STR_NEAR_NO_PLAYER="附近没有其他玩家！",t.STR_MYPLAYER_NO_PET_MER="你还未拥有自已的宠物或佣兵！",t.STR_START_SHOP_NO_ITEM="请先选择上架物品后再开始摆摊！",t.STR_FIRST_PAGE="已到首页！",t.STR_LAST_PAGE="已到尾页！",t.STR_NO_MAIL="邮件不存在！",t.STR_BINDING_NO_SHOP="绑定物品不能上架！",t.STR_CHANGE_NAME_NO_SHOP="上架的宠物不能改名！",t.STR_NO_ONLINE_SEE_PLAYER="请等玩家上线之后才能查看！",t.STR_NO_DATA_ACTIVITY_LIST="暂时没有活动列表！",t.STR_NO_DATA_INFO_DATA="暂时没有攻略！",t.STR_ESCORT_NO_SHOP="押镖中物品不能上架！",t.STR_COUNTRY_PRICE_ADUST="该国家管理员已经调整了税率导致价钱波动,请您重新过目!",t.STR_COUNTRY_PRICE_ADUST_INFO="国家消费价格：原价+原价×国家税率×折扣=总价\n例：国家税率80%，贵族购买原价100的道具，则 100（原价）+100（原价）×80%（税率）×50%（折扣）=140（总价）其中40作为税收纳入国库\n各阶级折扣：\n非本国民 100%\n普通国民 75%\n本国贵族 50%\n本国领主 20%\n本国子爵 15%\n本国伯爵 10%\n将军以上阶级消费只需支付原价",t.STR_NOT_SELECT_ITEM="您还没有选择物品操作!",t.STR_PLAYER_MANAGE_SUCCESS="您的申请已提交，请耐心等待系统的短信通知。",t.STR_PLAYER_EMAIL_SUCCESS="您的申请已提交，请登录邮箱查看信息。",t.STR_PLAYER_BIND_EMAIL="您的申请已提交，请在30分钟内登录邮箱进行下一步操作。",t.STR_FIRST_ENTER_CITY="请先进入城市!",t.STR_PLAYER_CARD_TODO="你发现这里了？这是个很有趣的名片系统，但很可惜，功能还未开放呢。请期待稍后的更新。",t.STR_MONEY="世界币",t.STR_MONEY1="黄金",t.STR_MONEY2="金叶",t.STR_MONEY3="铜币",t.STR_GAME_HELP="客服联系方式：可通过游戏内－系统－联系客服。与客服进行邮件沟通。客服会在每日工作时间段内，通过客服邮件回答你的问题。\n邮箱:kefu@good321.net\n客服电话：020-85623474",t.STR_SEE_PET_TIP="（点击选项可查看详细）",t.STR_SEE_PET_KEY_TIP="（按5键可查看详细）",t.STR_WAR_OPE_ARMY="只有将军或将军以上阶层才能操作军队",t.STR_WAR_OPE_COMMAND="只有国王跟元帅才能使用计谋",t.STR_WAR_MY_ARMY_NO_PLAYER="你还没有开始组队呢，军队中只有你一人！",t.STR_INTEGRAL_NO_ITEM="请先将需要分解的装备放入分解栏！",t.STR_TEAMBOSS_SELECT_OTHER="该怪物军队已经全部消灭，请选择攻打其它怪物军团！",t.STR_TEAMBOSS_FAIL="战斗失败。你即将被清退出团队副本，请大虾重新再来！",t.STR_MODIFY_NAME_SUCESS="修改角色信息成功!",t.STR_SAFELOCK_EXPLAIN="安全锁对账号下的所有角色有效。\n账号每次登录后均需输入安全码才可对角色执行与财产相关的重要操作。\n例如：输入安全码之前，无法丢弃装备或使用黄金进行交易买卖。\n",t.STR_SEE_ACHIEVE_EXPLAIN="对比成就：与该玩家对比，你还有以下成就没有达成。",t.STR_VIP_ACTIVATE_INFO="成为%U可激活%U精灵和享受各种专受特权。%U特权对账号下/c00ff00所有角色/p生效。",t.STR_VIP_PAST_DUE_INFO="您的%U特权已过期,续期%U权限，可继续享受%U尊贵特权！%U特权对账号下/c00ff00所有角色/p生效。",t.STR_VIP_TIME_INFO="您的%U特权还剩下: %U,选择续期可延长%U使用日期。",t.STR_VIP_PAY_ASK="继续操作您需要支付%U, 是否确认？",t.STR_VIP_RENEWAL_SUCCEE="成功续期：您已成功续期VIP权限，可继续享受VIP尊贵特权！VIP特权对账号下/c00ff00所有角色/p生效。",t.STR_VIP_ACTIVATE_SUCCEE="成功激活：您已成功激活VIP，获得VIP专享尊贵特权！",t.STR_OPEN_QUESTION_NOT_VIP="您还不是%U，无法参与%U答题。是否需要开通%U尊贵特权？",t.STR_VIP_RENEWAL_ASK="您的%U特权已过期，续期后可继续享受%U尊贵特权！是否进行%U续期？",t.STR_VIP_QUESTION_FINISH="您已经答完今天的所有题目，请明天再来。",t.STR_VIP_QUESTION_TITLE="请选择正确答案：\n",t.STR_VIP_QUESTION_MY_COUNT="你今天还有%U次答题机会",t.STR_VIP_QUESTION_RIGHT="回答正确！\n得到 %U\n",t.STR_VIP_QUESTION_ERROR="回答错误！\n",t.STR_VIP_QUESTION_PASS_ALL="恭喜您答对今天所有问题，额外奖励将通过邮件下发，请注意查收！",t.STR_VIP_ACTIVITYDATA_NOTVIP="您不是%U,无法执行此操作,是否需要开通%U尊贵特权？",t.STR_VIP_QUESTION_ANSWER_RIGHT="你已答中/c00ff00%U/p题",t.STR_VIP_ACTIVATE="VIP激活",t.STR_VIP_RENEWAL="VIP续期",t.STR_VIP_PRIVILEGE="VIP特权",t.STR_VIP_SELL_EQUIP="出售装备",t.STR_VIP_SELL_EQUIP_INFO="已装备物品不能出售,请先卸下装备！",t.STR_VIP_SELL_EQUIP_ASK="您确定要出售%U吗?",t.STR_VIP_SELL_FAIL="出售失败",t.STR_NO_VIP_INFO="本账号所有角色均拥有VIP特权:\n1.拥有/c00ff00VIP精灵/p，专享守护精灵属性加成。\n2.拥有/c00ff00VIP尊贵身份标识/p显示。\n3.拥有/c00ff00VIP商店/p购买权限。\n4.拥有/c00ff00VIP道具和装备/p使用特权。\n5.拥有/c00ff00VIP专享成就/p。\n6.进行/c00ff00VIP答题/p，每天获取丰富奖励。\n7.拥有/c00ff00VIP私人仓库/p。\n8.每天登录，均可获赠/c00ff00VIP专享礼物/p。\n9.使用熔炉商店时，拥有更多的熔炼次数。\n10.每日活跃度+100。",t.STR_OPEN_VIP="开通%U后，",t.STR_DO_OPEN_VIP="开通VIP",t.STR_VIP="VIP",t.STR_VIP_TIME="您的%U期限还剩下:%U",t.STR_GET_STORAGE="取出",t.STR_PUT_STORAGE="放入仓库",t.STR_VIP_STORAGE="VIP仓库",t.STR_VIP_STORAGE_SEE="查看%U仓库",t.STR_OPEN_VIP_STORAGE_FAIL="打开%U仓库失败!",t.STR_VIP_SHOP_NOT_VIP="您还不是%U，无法购买%U商品。是否需要开通%U尊贵特权？",t.STR_VIP_SHOP_RENEWAL="您的%U特权已过期，续期后可继续享受%U尊贵特权！是否进行%U续期？",t.STR_REFRESH_BAG="整理背包",t.STR_REFRESH_STORAGE="整理仓库",t.STR_VIP_CAN_BUY="%U才可购买\n",t.STR_VIP_STOREAGE_CNNONT_OPEN="您还不是%U，无法打开%U仓库。是否需要开通%U尊贵特权？",t.STR_VIP_ITEM_INFO="只对VIP有效",t.STR_OPEN_AT_ONCE="立即开通",t.STR_QQ_DIAMOND="蓝钻",t.STR_DO_OPEN_DIAMOND="开通蓝钻",t.STR_QQ_DIAMOND_ACTIVATE="蓝钻激活",t.STR_QQ_DIAMOND_RENEWAL="蓝钻续期",t.STR_QQ_DIAMOND_PRIVILEGE="蓝钻特权",t.STR_QQ_DIAMOND_STORAGE="蓝钻仓库",t.STR_QQ_DIAMOND_INFO="本账号所有角色均拥有蓝钻特权:\n1.拥有/c00ff00蓝钻精灵/p，专享守护精灵属性加成。\n2.拥有/c00ff00蓝钻尊贵身份标识/p显示。\n3.拥有/c00ff00蓝钻商店/p购买权限。\n4.拥有/c00ff00蓝钻道具和装备/p使用特权。\n5.拥有/c00ff00蓝钻专享成就/p。\n6.拥有/c00ff00蓝钻私人仓库/p。\n7.每天登录，均可获赠/c00ff00蓝钻专享礼物/p。\n8.蓝钻国家成员每月可领取一次系统礼物。\n9.使用熔炉商店时，拥有更多的熔炼次数。\n10.每日活跃度+100。",t.STR_QQ_DIAMOND_IS_NOT="开通蓝钻可享受蓝钻尊贵特权！蓝钻特权对账号下所有角色生效。",t.STR_SUPER_QQ="超Q",t.STR_SUPER_QQ_INFO="本账号所有角色均拥有超Q特权:\n1.拥有/c00ff00超Q尊贵身份标识/p显示。\n2.拥有/c00ff00超Q商店/p购买权限。\n3.每天登录，均可获赠/c00ff00超Q专享礼物/p。\n4.专享/c00ff00超Q答题/p。",t.STR_SUPER_QQ_SHOP_MSG="/cFF0000该价格已享受超Q会员9折优惠。/p\n",t.STR_SUPER_QQ_SHOP_MSG2="/cFF0000超Q会员可享受9折优惠。/p\n",t.STR_SUCCEE="操作成功！",t.STR_MAKE_FRIEND_SUCCEE="成功加为好友",t.STR_NO_TALK_SUCCEE="成功屏蔽玩家",t.STR_DEL_FRIEND_SUCCEE="删除好友成功！",t.STR_TI_DEL_RELATION_SUCCEE="取消屏蔽成功！",t.STR_FRIEND_INPUT_ID="请输入ID！",t.STR_FRIEND_INPUT_NAME="请输入名字！",t.STR_DEL_PARTNER="不能删除伴侣，请先解除婚姻关系！",t.STR_REQUEST_ADD_MASTER="成功向对方发送拜师请求,请耐心等候!",t.STR_DEL_MASTER_ASK_CON="您确定和%U解除师徒关系吗？",t.STR_DEL_MASTER_SUCCEE="解除师徒成功",t.STR_DO_SEE_PLAYER_NOT_ONLINE="对方不在线不能查看信息!",t.STR_INIVITE_TEAM_OTHER_PLAYER="对方已经有队伍了!",t.STR_INIVITE_TEAM_IS_MEMBER="你不是队长不能邀请别人入队!",t.STR_INIVITE_TEAM="你已经向%U发出组队邀请",t.STR_JOINTEAM_IS_PLAYER_TEAM="你已经在队伍中!",t.STR_JOINTEAM="你已经向%U发出申请入队",t.STR_DEL_Team_IS_MEMBER="你不是队长不能解散队伍!",t.STR_DEL_TEAM_SUCCEE="成功解散队伍!",t.STR_LEAVE_TEAM_NOT_ON_TEAM="你不在队伍中无需离开!",t.STR_LEAVE_TEAM_SUCCEE="成功离开队伍!",t.STR_KICK_TEAM_IS_MEMBER="你不是队长不能踢人!",t.STR_KICK_TEAM_MEMBER_SUCCEE="成功踢除队员",t.STR_CHANGE_LEADER_IS_MEMBER="你不是队长不能提升别人做队长!",t.STR_PLAYER_LIST_INFO_MAP="地图:%U\n",t.STR_PLAYER_LIST_TEMP_DEL="临时删除剩余%U ",t.STR_PLAYER_LIST_STATUS_FROST="冻结资产中 ",t.STR_PLAYER_LIST_STATUS_SELL="出售中  ",t.STR_PLAYER_LIST_STATUS_ENGAGE="雇佣中 ",t.STR_PLAYER_LIST_STATUS_CLOSE="封号中 ",t.STR_PLAYER_LIST_STATUS_MOUTH="禁言中 ",t.STR_PLAYER_LIST_OFFLINE_DOING="执行离线任务%U",t.STR_PLAYER_LIST_OFFLINE_TIME=",剩余%U ",t.STR_PLAYER_LIST_STATUS_COMMENTS="禁止评论(相册)中 ",t.STR_PLAYER_LIST_STATUS="状态:%U",t.STR_LIST_DESC_NOT_ONLINE="离线",t.STR_LIST_DESC_PARTNER="伴侣",t.STR_LIST_DESC_RELATION_MASTER="师父",t.STR_LIST_DESC_RELATION_PRENTICE="徒弟",t.STR_LIST_ALL="全部",t.STR_LIST_NULL="无",t.STR_ACTIVITY_JUMP_MAP_NOT_VIP="非VIP玩家无法进入!",t.STR_ACTOR_SELL="出售角色",t.STR_ACTOR_HAND_SELL="挂售角色",t.STR_ACTOR_SELL_PRICE_LIMITS="请输入价格(黄金%U):",t.STR_ACTOR_SELL_ASK_UP="您确定要出售该角色吗？出售价格:%U",t.STR_ACTOR_SELL_CANCEL="角色下架",t.STR_ACTOR_SELL_ASK_DOWN="您确定要将该出售中的角色下架吗？",t.STR_ACTOR_SELL_BUY="购买角色",t.STR_ACTOR_SELL_BUY_ASK="您确定要购买该角色吗? 该角色价格: %U",t.STR_ACTOR_SELL_FIND_DF="不限",t.STR_ACTOR_SELL_FIND_LEVEL_ASC="等级低到高",t.STR_ACTOR_SELL_FIND_LEVEL_DESC="等级高到低",t.STR_ACTOR_SELL_FIND_MONEY_ASC="价格低到高",t.STR_ACTOR_SELL_FIND_MONEY_DESC="价格高到低",t.STR_ACTOR_SELL_CANCEL_SUCCESS="角色下架成功",t.STR_ACTOR_HAND_SELL_SUCCESS="挂售角色成功",t.STR_ACTOR_DESC_NO_VIP="VIP等级不足，至少VIP1才能购买角色，是否跳转充值？",t.STR_HAVE_NO_TIME="0分钟",t.STR_MERCENARY_BUY="雇佣佣兵",t.STR_MERCENARY_BUY_ASK="雇佣%U佣兵需要花费\n%U是否确定？",t.STR_LEADER="队长",t.STR_MEMBER="队员",t.STR_BATTLE="战斗",t.STR_FREE="空闲",t.STR_SHOP_CANNOT_MOVE="摆摊中不能行走",t.STR_MODEL_SOLDIER="兵",t.STR_MODEL_HELP="援",t.STR_MODEL_MONEY_NOT_ENOUGHT="%U不够，需求%U",t.STR_MODEL_MONEY_HAVE="/cFF0000(现有%U)/p\n",t.STR_MODEL_MONEY2_REPLACE="代替\n是否继续？",t.STR_MODEL_MONEY_NOT_ENOUGHT_TI="金钱不够",t.STR_MODEL_BILL_ASK="是否跳到充值？",t.STR_MODEL_MONEY2_NOT_ENOUGHT="金叶不够",t.STR_MODEL_MONEY3_NOT_ENOUGHT="铜币不够",t.STR_DEDUCT="扣除",t.STR_ADD="增加",t.STR_MASTER_TITLE="拜师收徒",t.STR_MASTER_ACCEPT="我要收徒",t.STR_MASTER_ACCEPT_INFO="你可以收取40级以下玩家为徒弟，最多可同时收5个徒弟：\n1、输入收徒宣言后可在师徒列表中挂名收徒，系统将为你保留48小时。其他玩家可以通过师徒列表向你拜师。\n2、收徒宣言不可主动取消。\n3、只要徒弟入门满3天或者满40级自动出师，你将得到徒弟充值额的5%金叶奖励。\n4、师徒之间传送无需使用传送石。\n5、可参加专为师徒设计的师徒副本等相关内容活动。",t.STR_MASTER_ACCEPTDISCIPLE="1、与师父同时在线，你可以获得1.1倍的经验。\n2、师徒之间互相传送无需使用传送石。\n3、可参加专为师徒设计的师徒副本等相关内容活动。\n4、成为师父的入门弟子后，只要你进行充值，师父就可以得到充值额5%的金叶奖励。（必须入师满3天或者达到40级出师。）",t.STR_MASTER_ACCEPT_PLAYER="挂名收徒",t.STR_MASTER_ACCEPT_MANIFESTO="请输入收徒宣言:",t.STR_MASTER_ACCEPTDISCIPLE_TI="我要拜师",t.STR_MASTER_SUCCEE="挂名成功",t.STR_MASTER_FIND_JOB="职业筛选",t.STR_MASTER_FIND_STATUS="状态筛选",t.STR_MONSTER_ICON="图标:",t.STR_MONSTER_MONSTERTYPE="怪物类型:",t.STR_MONSTER_HP_MAX="生命上限:",t.STR_MONSTER_MP_MAX="法力上限:",t.STR_MONSTER_SPEED="出手速度:",t.STR_MONSTER_ATK_TYPE="攻击类型:",t.STR_MONSTER_ATK_MIN="最小伤害:",t.STR_MONSTER_ATK_MAX="最大伤害:",t.STR_MONSTER_ATK_DODGE="闪躲:",t.STR_MONSTER_ATK_STR="劈砍攻击力:",t.STR_MONSTER_ATK_AGI="穿刺攻击力:",t.STR_MONSTER_ATK_MAGIC="魔法攻击力:",t.STR_MONSTER_DEF_STR="劈砍防御力:",t.STR_MONSTER_DEF_AGI="穿刺防御力:",t.STR_MONSTER_DEF_MAGIC="魔法防御力:",t.STR_MONSTER_HITRATE="物理命中:",t.STR_MONSTER_HITMAGIC="魔法命中:",t.STR_MONSTER_CRITICAL="致命率:",t.STR_MONSTER_WIL="意志:",t.STR_MONSTER_TOUGH="强韧:",t.STR_MONSTER_BLOCK="格挡:",t.STR_MONSTER_BRKARMOR="破甲:",t.STR_MONSTER_INSIGHT="洞察:",t.STR_MONSTER_DEF_FIELD="防御力场:",t.STR_MONSTER_BACK="物理反馈:",t.STR_MONSTER_MAGIC_BACK="魔法反馈:",t.STR_MONSTER_LIFE_ABSR="生命吸收:",t.STR_MONSTER_MANA_ABSP="法力吸收:",t.STR_MONSTER_MAGIC_PENT="法术穿透:",t.STR_MONSTER_BORN_STATUS="天生免疫技能:",t.STR_MONSTER_ESCAPECOND="逃跑情况:",t.STR_MONSTER_ESCAPE_RATE="逃跑成功率:",t.STR_MONSTER_REWARD_MONEY="掉落%U",t.STR_MONSTER_REWARD_EXP="掉落经验:",t.STR_MYPET_CHANGE_NAME_COST="宠物改名需要花费%U",t.STR_MYPET_CHANGE_NAME="宠物改名",t.STR_MYPET_CHANGE_NAME_ASK="是否继续？",t.STR_NPC_OLD="旧版",t.STR_NPC_MISSION_NOT_READY="任务<%U>未达到接受条件。",t.STR_NPC_LEFT_SOFT="按左软键%U",t.STR_NPC_MISSION_ASK="继续",t.STR_NPC_MISSION_SURE="确认",t.STR_NPC_MISSION_ESCORT="交押金执行任务",t.STR_NPC_RANDOM_MISSION_END1="你可以在这里接取和提交挑战任务。挑战任务在整点自动重置完成次数。",t.STR_NPC_RANDOM_MISSION_END2="你已完成所有的挑战任务，请等待整点刷新后,重新领取。",t.STR_NPC_MISSION_CONTINUE="继续挑战",t.STR_NPC_MISSION_ACCEPT="你已接受任务<%U>",t.STR_NPC_MISSION_DEST="目标：",t.STR_NPC_MISSION_AUTO_ASK="是否使用任务导航自动寻路?",t.STR_NPC_MISSION_FINISH="你已完成任务<%U>",t.STR_PLAYER_CHANGE_JOB_TITLE="请输入ok确认:",t.STR_PLAYER_CHANGE_JOB_WARN=" 敬告：\n1.转职后角色将会自动洗点，自动洗点不会消耗任何金钱。\n2.转职后将会删除所有角色技能，所有技能的sp点会全部返还，但学习技能已消耗的金钱包括黄金、金叶、铜币均不返还。\n3.角色背包、仓库及所有装备物品不会发生变更。",t.STR_PLAYER_CHANGE_JOB_ASK="您即将转职为:%U\n敬告：\n1.转职后角色将会自动洗点，自动洗点不会消耗任何金钱。\n2.转职后将会删除所有角色技能，所有技能的sp点会全部返还，但学习技能已消耗的金钱包括黄金、金叶、铜币均不返还。\n3.角色背包、仓库及所有装备物品不会发生变更。",t.STR_PLAYER_CHANGE_JOB_ERROR="输入不正确。",t.STR_PLAYER_CHANGE_SUCCEE="你的新职业:/cff0000%U/p\n角色已自动洗点并删除技能。\n请注意/c00ff00重新分配属性点和学习新技能/p！",t.STR_COUNTRY_BECOME_KING="正确输入后，将转让国王。",t.STR_COUNTRY_ADDARMY_USELAND="正确输入后，消耗50%土地数，增加等额军力值。超上限则浪费。",t.STR_LOTTERY_DRAW_FREE_TITLE="试试手气",t.STR_LOTTERY_DRAW_TODAY_REWARD="查看奖励",t.STR_LOTTERY_DRAW_TODAY_HISREWARD="昨日奖励",t.STR_LOTTERY_DRAW_MONEY2_TITLE="试试手气(使用金叶)",t.STR_LOTTERY_DRAW_MONEY3_TITLE="试试手气(使用铜币)",t.STR_LOTTERY_DRAW_FREE_FIR_INFO="你可以免费试手气\n%U%U(系统将自动保留中奖号码，试多几次手气，中奖几率更大)\n当日号码最大的玩家和幸运号玩家可各得一份当日大奖，奖金平分。\n\n现有： /cFFFF00黄金%U/p  /c9acaff金叶%U/p  /cc45712铜币%U/p",t.STR_LOTTERY_DRAW_FREE_NEED="你可以免费再试试手气",t.STR_LOTTERY_DRAW_MONEY_NEED="继续试手气需求:%U",t.STR_LOTTERY_DRAW_MONEY_INFO="我的号码：/c00ff00%U/p\n%U %U %U\n(系统将自动保留中奖号码，试多几次手气，中奖几率更大)\n当日号码最大的玩家和幸运号玩家可各得一份当日大奖，奖金平分。\n\n现有： /cFFFF00黄金%U/p  /c9acaff金叶%U/p  /cc45712铜币%U/p",t.STR_LOTTERY_DRAW_RESULT_INFO="原来的号码:%U \n 新号码: %U\n  今天你已经试了%U次手气",t.STR_LOTTERY_DRAW_REWARD_PIC="\n获得神秘礼品：%U",t.STR_LOTTERY_DRAW_REWARD_INFO="%U\n奖品：\n%U\n中奖人:%U",t.STR_LOTTERY_DRAW_REWARD_HISINFO="中奖号:%U\n奖品：\n",t.STR_OR="或",t.STR_LOTTERY_DRAW_COUNT_OVER="你今天的试手气次数用完了。",t.STR_LOTTERY_DRAW_NOT_OPEN="未到达试手气时间",t.STR_LOTTERY_DRAW_PREMIUMSNUM="再试手气/c00ff00%U/p次可获得神秘奖品",t.STR_LOTTERY_DRAW_BTN_REWARD="奖品",t.STR_PLAYER_CARD_STYLE1="风格1",t.STR_PLAYER_CARD_STYLE2="风格2",t.STR_PLAYER_CARD_STYLE3="风格3",t.STR_ACTIVITYE_DATA_POLL="投票",t.STR_BATTLE_ATKTYPE_MAGIC_INVALID="(%U)幻影，无效果",t.STR_BATTLE_BUFFER_INVINCIBLE="(%U)无敌，不受伤害",t.STR_BATTLE_BUFFER_RESIST_MAGIC="(%U)魔攻无效!",t.STR_BATTLE_BUFFER_RESIST_PHYSIC="(%U)物攻无效!",t.STR_BATTLE_ANI_ENGINE_AREAN_BEGIN="竞技比赛开始，请专注战斗。",t.STR_BATTLE_ANI_ENGINE_BATTLE_SEE="你进入了观看战斗",t.STR_BATTLE_SEE="观战中...",t.STR_KEY_SURE="(按5键/中心键操作)",t.STR_WAITING="等待中...",t.STR_WAIT_NEXT_BATTLE="等待下一场战斗...",t.STR_BATTLE_ROUND="回合%U",t.STR_BATTLE_LEFT_WIN="左方胜利",t.STR_BATTLE_RIGHT_WIN="右方胜利",t.STR_BATTLE_ROUND_OVER="超过最大回合数",t.STR_BATTLE_WAR_TIME_OUT="国战战斗时间到",t.STR_BATTLE_ARENA_OUT="竞技战斗时间到",t.STR_SEE_STATUS="查看状态",t.STR_EXIT_SEE_BATTLE="退出观战",t.STR_BATTLE_ATTACK_KEY_SURE="按5键/中心键",t.STR_BATTLE_ATTACK_HERE="点击这里",t.STR_BATTLE_ATTACK_TARGET="攻击目标",t.STR_BATTLE_ATTACK_CHOICE="选择攻击",t.STR_BATTLE_ATTACK_AUTO="选择自动战斗",t.STR_BATTLE_SKILL_CHOICE="选择技能",t.STR_BATTLE_AUTO_CANCEL="取消自动",t.STR_BATTLE_SKIP="跳过动画",t.STR_BATTLE_PANEL_ORDER_ATTACK="普通攻击",t.STR_BATTLE_PANEL_ORDER_SKILL="技能-%U",t.STR_BATTLE_PANEL_ORDER_ITEM="物品-%U",t.STR_PLAYER_INFO="人物信息",t.STR_BATTLE_ITEM_USE_NULL="无可用物品",t.STR_BATTLE_ITEM_USE_NULL_INFO="没有可以在战斗中使用的物品!!",t.STR_BATTLE_ITEM_PET_CANNOT_USE="宠物不能使用物品！",t.STR_BATTLE_PET_ESCAPE="宠物不能主动逃跑！",t.STR_PLAYER_HP="生命:",t.STR_PLAYER_MP="法力:",t.STR_STATUS="状态",t.STR_BORN_STATUS="天生状态",t.STR_LOAD="加载中...",t.STR_MONSTERAI_ID="怪物ID:%U",t.STR_CONDITION="条件:",t.STR_DIALOGUE="对话:",t.STR_MONSTERAI_SKILL_INFO="技能%U:等级为%U 的技能%U",t.STR_CHOICE_EQUIP_ITEM="选择装备物品",t.STR_KEY_ADD_SP="按/c0000ff方向键/p操作加点",t.STR_TOUCH_ADD_SP="点击/c0000ff“+”/p / /c0000ff“-”/p操作加点",t.STR_KEY_ADD_SP_SURE_ONEKEY="点击一键操作加点",t.STR_KEY_ADD_SP_SURE="按/c0000ff5键/中心键/p确认加点",t.STR_KEY_ADD_SP_SURE_LEFT="按/c0000ff左键/中心键/p确认加点",t.STR_TOUCH_ADD_SP_SURE="点击/c0000ff这里/p确认加点",t.STR_TOUCH_AUTO_PATH_SURE="点击/c0000ff这里/p取消/开启寻路",t.STR_OPEN_CITY="恭喜您拥有哦自己的城市",t.STR_TASK_SHOW="这里可查询当前可接受的任务",t.STR_CLOSE_TASK="现在还没有任务，让我们马上去接新任务吧",t.STR_AUTO_ADD_POINT_TITLE="自动加点",t.STR_ADD_POINT="本次加点:",t.STR_SET_AUTO_SKILL="设置自动技能",t.STR_ENTER_CITY="可直接进入城市",t.STR_TEL_PHONE_TYPE_ERROR="手机号码输入格式有误",t.STR_TEL_PHONE_NUM_ERROR="手机号码位数不符",t.STR_TEL_PHONE_ERROR="手机号码输入不正确",t.STR_HUNDRED_MILLION="%U亿",t.STR_TEN_THOUSAND="%U万",t.STR_THOUSAND="%U千",t.STR_DAY="%U天",t.STR_HOUR="%U小时",t.STR_MINUTE="%U分钟",t.STR_NOT_EFFECT="没有效果",t.STR_PERSONAL_GROWTH="个人成长",t.STR_MISSION_ACHIEVE="任务成就",t.STR_HONOUR="荣耀",t.STR_MULTIPLE="综合",t.STR_REACH="达成:",t.STR_ACHIEVE_NAME="成就名:%U",t.STR_ACHIEVE_INFO="成就描述:%U",t.STR_ACHIEVE_REWARD="\n奖励:\n",t.STR_GET_ACHIEVE="获得成就称号:%U",t.STR_EXP="经验:%U",t.STR_ACHIEVE_GET_REWARD="该成就已经领取过奖励!",t.STR_ACHIEVE_NO_TITLE="您还没有其它可供切换的称号!",t.STR_ACHIEVE_DEL_TITLE="取消称号",t.STR_ACHIEVE_DEL_TITLE_ASK="你确定要取消称号吗？",t.STR_ACHIEVE_USE_TITLE_ASK="你确定要使用称号%U吗？",t.STR_ACHIEVE_USE_TITLE_TITLE="使用称号",t.STR_ACHIEVE_LIST_TITLE="成就信息",t.STR_ACHIEVE_REACH="已达成",t.STR_ACHIEVE_CHOICE_TITLE="选择称号",t.STR_ACHIEVE_NO_RANK="200以外",t.STR_OVER="结束",t.STR_STAGE_BATTLE="竞技场已经结束！",t.STR_ARENA_BATTLE_FAIL_INFO="你在竞技场中战斗失败\n本次竞技所获得的竞技场积分为/cff0000%U分/p\n你还有/c00FF00%U次/p挑战机会",t.STR_ARENA_BATTLE_WIN_INFO="恭喜你在竞技场中获得胜利！\n你可以继续选择对手，或被其他玩家挑战，\n请随时作好战斗准备!",t.STR_SEE_BATTLE_CONTIUNE="继续观战",t.STR_SEE_BATTLE_WAITING="您已经加入挑战擂主的队列，正在等待战斗。\n你可以选择继续观战或者执行其它操作。\n你前面还有%U(%U?%U:%U)正在等待挑战！",t.STR_ARENA_IS_OWN="你已成为竞技场擂主，随时有挑战者企图夺取你的擂主位置，请作好战斗准备！",t.STR_ARENA_IS_MEMBER_MOVE="只有队长才能进行操作！",t.STR_ARENA_GET_POINT_INFO="本场竞技场获得积分为/cFFFF00%U分/p\n你还有/cFFFF00%U次/p挑战机会",t.STR_ARENA_EXIT_TITLE="离开竞技场",t.STR_ARENA_EXIT_ASK="你确定要离开竞技场吗？",t.STR_ARENA_ENTER_FAIL="进入竞技场初始化失败！",t.STR_CHALLENGE_LIST="切换挑战",t.STR_VIEW_BATTLE_LIST="切换观战",t.STR_ARENA_ALERT_MESSAGE="欢迎来到竞技场，你可以在竞技场中/cFFFF00挑战对手/p，赢取竞技场积分换取丰富奖品！",t.STR_ARENA_RANDOM_CHALLENGE="快速挑战",t.STR_ARENA_RANDOM_VIEW_BATTLE="随机观战",t.STR_ARENA_OVER_NOTICE="今日竞技场开放时间已经结束；所有玩家可在明天同一时间继续参与竞技。\n竞技场获得的竞技积分可到商店兑换奖励。\n本次竞技场获得积分为/cFFFF00%U分！/p",t.STR_NOT_OPEN="该功能暂不支持",t.STR_PHOTO_COMMAND_SAY_DEL_ASK="您确定要删除该评论吗？",t.STR_PHOTO_COMMAND_INFO="你可以选择/cff0000删除/p或/cff0000%U/p该评论：\n玩家名字：%U",t.STR_PHOTO_COMMAND_SAY_HIDE="该评论内容已被隐藏。",t.STR_CANNOT_OPEN="暂无角色挂售",t.STR_PLAYER_CARD_SEE_OR_CREATE="/cff0000查看已有名片/p不会改变名片已有内容，你可以查看上次保留的名片效果。\n/cff0000重新生成名片/p则会重新生成名片内容，每次重新生成，名片的内容都可能改变。",t.STR_PLAYER_CARD_CREATE="重新生成名片",t.STR_PLAYER_CARD_SEE="查看已有名片",t.STR_PLAYER_CARD_TITLE="点击这里可以截图保存",t.STR_ALL_DROP="全部放弃",t.STR_ONE_DROP="放弃一级",t.STR_PLAYER_DROP_SKILL_ONE_ASK="您确定要放弃技能%U/cff0000一级/p吗?%U",t.STR_SEARCH_ALBUMS_ID="搜索ID",t.STR_SEARCH_ALBUMS_RECOMMEND="查看推荐",t.STR_SEARCH_ALBUMS_WOMAN="只看美女",t.STR_SEARCH_ALBUMS_MAN="只看帅哥",t.STR_SEARCH_ALBUMS_ALL="查看全部",t.STR_SEARCH_ALBUMS_NULL="没有符合条件的数据",t.STR_MIX_SERVER_ACTIVITY_SUCCEE="报名成功！",t.STR_MIX_SERVER_ACTIVITY_FAIL="取消报名成功！",t.STR_MIX_SERVER_ACTOR_ASK="是否确认参加个人跨服活动?",t.STR_MIX_SERVER_COUNTRY_ASK="是否确认参加国家跨服活动?",t.STR_MIX_SERVER_ACTOR_CAN_ASK="是否确认取消个人跨服活动报名?",t.STR_MIX_SERVER_COUNTRY_CAN_ASK="是否确认取消国家跨服活动报名?",t.STR_PET_ADD_SKILL_ASK="确认替换",t.STR_PET_ADD_SKILL_USE="继续使用潜能石",t.STR_PET_ADD_SKILL_NUM="剩余宠物潜能石%U个\n",t.STR_DO_SUCCESS="操作成功!",t.STR_PET_ADD_SKILL_INFO_ASK="\n/cff0000确认要替换技能吗？/p",t.STR_PET_ADD_SKILL_INFO="\n(继续使用宠物潜能石不会替换原有技能。)",t.STR_PET_RESET2="重生石",t.STR_PET_RESET="洗髓石",t.STR_PET_ADD_SKILL="潜能石",t.STR_PET_NO_ITEM_ASK="您身上没有该道具，可以进入商店购买，是否进入?",t.STR_PET_RESET_ITEM_USE="继续使用洗髓石",t.STR_PET_RESET_ITEM_GROW="成长率: %U",t.STR_PET_RESET_ITME_COMPRE="领悟率: %U",t.STR_PET_RESET_NUM="剩余宠物洗髓石%U个",t.STR_PET_ENTER_DETAIL_USE="请进入宠物详细界面使用!",t.STR_PET_RESET_AGE_INFO="宠物寿命已恢复！",t.STR_ACTOR_LOGIN_REWARD_SUMDAY="已连续登录/c00FF00%U/p天",t.STR_ACTOR_LOGIN_REWARD_INFO="达到%U级,连续登录%U天,\n可获得%U",t.STR_ACTOR_LOGIN_REWARD_HAS_GET="已领取",t.STR_ACTOR_LOGIN_REWARD_GET_ASK="\n是否现在领取？\n（通过任务菜单可随时领取奖励）",t.STR_BAG_REPAIT_ITEM_SUCCESS="身上装备全部修理成功!",t.STR_BAG_REPAIT_ITEM_COST="共花费%U铜币",t.STR_ITEM_MAXBUY_INFO="限购：%U个",t.STR_ITEM_ALLCOUNT_INFO="库存：%U个",t.STR_ACTOR_MODIFY_NAME_INFO="请输入用户名(4~12位字母或数字)",t.STR_ACTOR_MODIFY_PASSWORD_INFO="请输入密码(4~12位字母或数字)",t.STR_SHARE_TO_MICROBLOG="分享到微博(带图)",t.STR_ITEM_STAR="传统升星",t.STR_ITEM_STAR_NUM="升星：%U --\x3e %U \n",t.STR_ITEM_STAR_DEF_STR="劈砍护甲: %U -> %U \n",t.STR_ITEM_STAR_DEF_AGI="穿刺护甲: %U -> %U \n",t.STR_ITEM_STAR_DEF_MAG="魔法护甲: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE1="效果1: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE2="效果2: %U -> %U \n",t.STR_ITEM_STAR_POWERVALUE3="效果3: %U -> %U \n",t.STR_ITEM_STAR_BINDPOWER1="绑定效果1: %U -> %U \n",t.STR_ITEM_STAR_BINDPOWER2="绑定效果2: %U -> %U \n",t.STR_ITEM_STAR_ATK="攻击: %U -> %U \n",t.STR_ITEM_STAR_COUNT="剩余装备升星卷轴: /cFFFF00%U/p 个 \n",t.STR_ITEM_STAR_USE_INFO="成功率 /cFFFF00%U%/p,升星失败不影响现有属性。",t.STR_ITEM_STAR_NULL="没有升星卷轴",t.STR_ITEM_STAR_BIND_ACTIVATE=" (绑定激活)\n",t.STR_ITEM_STAR_BIND_ADD=" (绑定升星)\n",t.STR_ITEM_STAR_CHANGE="性质变化如下:\n",t.STR_ITEM_STAR_BIND="绑定后",t.STR_ITEM_ENTER_SHOP_ASK="%U\n是否进入商店购买?",t.STR_ITEM_STAR_FAIL="装备/cff0000升星失败/p！",t.STR_ITEM_STAR_SUCCEE="装备/c00ff00升星成功/p！",t.STR_REPLACE_INLAY_GEM="宝石替换",t.STR_REPLACE_INLAY_GEM_ASK="是否确认替换为新宝石?",t.STR_ATTACH_GEM_COUNT="镶嵌宝石:%U\n",t.STR_ATTACH_GEM_VALUE="宝石属性:%U\n",t.STR_REPLACE_INLAY_GEN_NEED="请选择新宝石进行替换，替换需要消耗/cffff00%U颗/p宝石。\n",t.STR_NO_REPLACE_INLAY_GEM="背包中没有可替换的宝石！",t.STR_ATTACH_CAN_REPLACE_INFO="\n\n/cffff00当装备宝石基础属性超过/p/c00ff0020/p/cffff00时，可用其他宝石替换。/p",t.STR_COMBINDESC_INFO="\n/cff0000强化装备保留宝石、升星和附魔属性。/p",t.STR_REPLACE_INLAY_GEM_SUCCEE="宝石替换成功!\n%U",t.STR_USE_LEARN_SKILL_ITEM_ADD="%U的/cffff00%U/p等级提升至/cffff00%U/p级,需要消耗%Usp,是否继续?\n",t.STR_USE_LEARN_SKILL_ITEM_NEW="%U将习得新的技能/cffff00%U/p,需要消耗%Usp,是否继续?\n",t.STR_CONNECT_START_FAIL="初始化失败，请检查网络！",t.STR_CONNECT_START_WAIT="正在初始化，请稍候重试！",t.STR_CONNECT_FAIL_TRY="连接失败，请稍候重试！",t.STR_ENTER_USERNAME="请输入账号",t.STR_ENTER_PASSWORD="请输入密码",t.STR_ENTER_PASSWORD_AGAIN="请输入新密码",t.STR_ENTER_NEW_PASSWORD_NULL="新密码不能为空",t.STR_RESET_PASSWORD="重置密码",t.STR_ENTER_EMAIL="请输入邮箱地址",t.STR_ENTER_EMAIL_OR_PHONE="请输入绑定手机号码或邮箱地址",t.STR_RESET_PSD_INFO="系统将验证账号信息和绑定手机号或绑定邮箱地址，验证成功后会以短信或邮件方式将新密码发送到手机或邮箱中",t.STR_RESET_PSD_INFO2="系统将核对账号和邮箱地址，正确输入后系统将通过邮件方式发送新密码到邮箱。",t.STR_SURE_BIND_EMAIL_PHONE="请先确认账号已绑定手机或邮箱",t.STR_FIND_PASSWORD="寻回账号",t.STR_FIND_PSD_EMAIL_PHONE="系统将会把账号以短信或邮件方式发送到账号的绑定手机或绑定邮箱中",t.STR_FIND_PSD_SEND_TO_EMAIL="系统通过邮箱方式将账号信息发送到您的绑定邮箱中。",t.STR_BIND_CANCEL="取消绑定",t.STR_BIND_INFO="系统将验证账号和密码信息。验证成功后会发送解绑信息到已绑定手机或邮箱上，请根据短信或邮件提示内容进行操作",t.STR_BIND_INFO2="系统将核对账号和密码信息。验证成功后会发送解绑信息到您的邮箱，请根据邮件提示内容进行操作",t.STR_SEARCH="查询",t.STR_CLOSE_SEARCH="关闭",t.STR_GET_MONEY3="\n获得%U铜币",t.STR_SKILL_INITIATIVE_SUCCESS="你已将/cffff00%U/p设置为自动战斗技能，在战斗中使用自动战斗时会自动使用该技能。",t.STR_SKILL_INITIATIVE_FAIL="已取消自动战斗技能设置。",t.STR_SKILL_INITIATIVE_SET="设置自动战斗",t.STR_SKILL_INITIATIVE_CANCEL="关闭自动战斗",t.STR_SPRITE_GUIDE="精灵助手",t.STR_KEY_SPRITE_GUIDE="助手",t.STR_REPAIR_EQUIP_ASK="修理所有装备需要一个/cff0000野外修理卷/p，确定修理?",t.STR_REPAIR_EQUIP_INFO="你可以进入城市，找到/cff0000城市守卫/p进行修理装备",t.STR_SPRITE_GUIDE_OTHER="看看有没别的事情",t.STR_SPRITE_GUIDE_STRATEGY="你有什么建议给我吗？",t.STR_SPRITE_GUIDE_EMAIL="联系客服",t.STR_SERVICE_EMAIL="客服邮件",t.STR_SPRITE_GUIDE_INFO="使用精灵助手",t.STR_PET_GRADE="品质:",t.STR_PET_NAME="名称:",t.STR_PET_DESCRIBE="宠物描述:",t.STR_PET_JOB="类型:",t.STR_PET_STR="力量:",t.STR_PET_CON="体质:",t.STR_PET_AGI="敏捷:",t.STR_PET_ILT="智力:",t.STR_PET_WIS="感知:",t.STR_PET_grow="宠物成长:",t.STR_PET_compre="宠物领悟:",t.STR_PET_SKILL_NAME="天赋技能:",t.STR_PAY_DESCEIBE_MOUNT_DETAIL="坐骑详细",t.STR_PAY_DESCRIBE_PET_DETAIL="宠物详细",t.STR_PAY_DESCRIBE_FASHION_DETAIL="时装详细",t.STR_PAY_DESCRIBE_DRAW_AWARD="领奖",t.STR_PAY_DESCRIBE_IN_RECHARGE="进行充值",t.STR_PAY_DESCRIBE_LEVEL="领取奖励需要达到%U级",t.STR_PAY_DESCRIBE_WAIT_DRAW_AWARD="待领奖",t.STR_PAY_DESCRIBE_FOREVER_MOUNT="坐骑",t.STR_PAY_DESCRIBE_SUPERSTRONG_PET="宠物",t.STR_PAY_DESCRIBE_NEWEST_FASHION="时装",t.STR_PAY_DESCRIBE_MONEY=" 元",t.STR_CITY_DO_GET_MONEY_FAIL="城市金库已经没有金钱可以提现！",t.STR_CITY_CHANGE_NAME_TITLE="修改城市名称",t.STR_CITY_NAME="城市名",t.STR_CITY_SIGN_CHANGE_TITLE="修改城市签名",t.STR_CITY_CASTELLAN_SIGN_CHANGE="修改城主签名",t.STR_CITY_SIGN_CON="签名内容",t.STR_CONDITION_KILL_MONSTER="消灭",t.STR_CONDITION_GET="获得",t.STR_CONDITION_MISSION_DONE="完成任务<%U>",t.STR_CONDITION_HONOR="需求贡献值%U",t.STR_CONDITION_NEED="需求:%U",t.STR_CONDITION_NEED_CITY_DEGREE="需求城市繁荣度%U",t.STR_CONDITION_NEED_CITY_ARMY="需求城市军力值%U",t.STR_CONDITION_LEVEL="达到%U级",t.STR_CONDITION_EQUIP_ITEM="身上装备%U",t.STR_CONDITION_MISSION_DOING="接受任务%U",t.STR_CONDITION_SCHOOL="种族%U",t.STR_CONDITION_JOB="职业%U",t.STR_CONDITION_COUNTRY_RANK="官阶为%U",t.STR_CONDITION_COUNTRY_RANK2="官阶达到%U",t.STR_CONDITION_IN_MAP="到地图%U",t.STR_CONDITION_MONTH_DAY="%U月%U日",t.STR_CONDITION_AFTER_DATE="到%U为止",t.STR_CONDITION_HOUR_MINUTE="%U时%U分",t.STR_CONDITION_SEX="男性",t.STR_CONDITION_IN_GUILD="加入帮派",t.STR_CONDITION_HAVE_BUFF="带有Buf%U",t.STR_CONDITION_PLAYER_HP="生命值达到%U",t.STR_CONDITION_PLAYER_MP="法力值达到%U",t.STR_CONDITION_PLAYER_CON="体质达到%U",t.STR_CONDITION_PLAYER_STR="力量达到%U",t.STR_CONDITION_PLAYER_ITL="智力达到%U",t.STR_CONDITION_PLAYER_AGI="敏捷达到%U",t.STR_CONDITION_CITY_SCALE="城市规模达到%U",t.STR_CONDITION_CITY_LEVEL="城市等级达到%U",t.STR_CONDITION_CITY_BRANCH="完成城市任务%U",t.STR_CONDITION_CITY_ISMASTER="城主",t.STR_CONDITION_MISSION="任务：",t.STR_FONT="字",t.STR_COUNTRY_NOT_BUILD="(未建)",t.STR_COUNTRY_ASK="您确定要%U吗？",t.STR_COUNTRY_BUILD_NEED="建造需求:",t.STR_COUNTRY_BUILD_LEVEL_NEED="升至%U级需求:",t.STR_COUNTRY_MONEY1="国库黄金",t.STR_COUNTRY_MONEY3="国库铜币",t.STR_COUNTRY_WOOD="木材",t.STR_COUNTRY_STONE="石材",t.STR_COUNTRY_IRON="铁矿",t.STR_COUNTRY_LAND="空余土地",t.STR_COUNTRY_LEVEL="国家等级",t.STR_COUNTRY_PROSPERITY="国家繁荣度",t.STR_COUNTRY_NOW_HAVE="(现有%U)",t.STR_COUNTRY_NOW_LEVEL="(当前%U级)",t.STR_COUNTRY_IS_MEMBER="您已经是该国家的成员!",t.STR_COUNTRY_RIGHTLESSDO="您不是国王没有权利操作!",t.STR_COUNTRY_ACTIVE="国家激活",t.STR_COUNTRY_ACTIVE_INFO="只有激活国家后，国家才能招募更多的同伴，并且让你的国家出现在国家列表之中。\n激活需求:%U",t.STR_COUNTRY_AFFICHE_RIGHTLESSDO="只有国王、宰相、元帅才能修改公告!",t.STR_COUNTRY_AFFICHE_MODIFY="修改国家公告",t.STR_COUNTRY_AFFICHE_CON="公告内容",t.STR_COUNTRY_BUILD_RIGHTLESSDO="您没有权限建造或升级建筑",t.STR_COUNTRY_DEL_BUILD_RLESSDO="您没有权限拆除建筑",t.STR_COUNTRY_CANNOT_DEL_BUILD="该建筑不能拆除!",t.STR_COUNTRY_DEL_BUILD="拆除建筑",t.STR_COUNTRY_DEL_BUILD_ASK="您确定要拆除%U吗？",t.STR_COUNTRY_BOOK_USE="使用指令书",t.STR_COUNTRY_BOOK_USE_ASK="使用该功能需要消耗1个指令书。是否确认？",t.STR_COUNTRY_ADD_PROSPERITY="增加繁荣度",t.STR_COUNTRY_ADD_PROSPERITY_INFO="目前国家为(%U)级,需要%U繁荣度来提升等级。使用该项特殊指令,可以获得增加%U繁荣度。该指令获取量随国家等级提升而减少。请注意：国家提升等级时会清零繁荣度。所以获取超等级需要上限的繁荣度会被浪费。使用该功能需要消耗1个指令书。是否确认？",t.STR_COUNTRY_ADD_PEOPLE="增加民众数",t.STR_COUNTRY_ADD_PEOPLE_INOF="目前民居为%U级，民众数上限为%U。目前使用该项指令可获取%U民众数。该指令获取量随国家等级提升而增加效果。请注意：民众总数不会超过上限。超上限的民众数会被浪费。使用该功能需要消耗1个指令书。是否确认？",t.STR_COUNTRY_ADD_LAND="增加空余土地",t.STR_COUNTRY_ADD_LAND_INFO="目前国家为%U级，目前使用该项指令可获取%U空余土地。该指令获取量随国家等级提升而增加效果。使用该功能需要消耗1个指令书。是否确认？",t.STR_COUNTRY_ADD_ARMY="增加军力值",t.STR_COUNTRY_ADD_ARMY_ASK="使用指令书，增加当前军力值上限的5%。是否确认？",t.STR_COUNTRY_ADD_ARMY_USELAND="增加军力（消耗土地）",t.STR_COUNTRY_ARMY_USELAND_INFO="消耗50%土地数，增加等额军力值。超上限则浪费。",t.STR_COUNTRY_USE_BOOK_SUCCESS="使用指令书成功!",t.STR_COUNTRY_ENTER_ONE_NEED_PAY="进入该国家需要交纳费用\n",t.STR_COUNTRY_ENTER_TEAM_NEED_PAY="队伍进入国家，队长需要为/c00ff00所有队员/p交纳入境费用\n",t.STR_COUNTRY_ENTER_PAY="入境费用",t.STR_COUNTRY_ENTER_ASK="%U是否确定？\n/cFFFF00(援军进入盟国不需要缴纳入境费)/p",t.STR_COUNTRY_ENTER_TWICE_SURE="该国家入境税已经改为<%U>请您再次确认!",t.STR_COUNTRY_LEAVE="离开国家",t.STR_COUNTRY_LEAVE_ASK="您确定要离开国家%U吗?\n",t.STR_COUNTRY_LEAVE_SUCCESS="您成功离开了国家<%U>",t.STR_COUNTRY_MEMBER_MISMATCH="没有符合条件的成员!",t.STR_COUNTRY_APPLY_DEAL_LESSDO="只有将军或将军以上阶级才能处理申请功能",t.STR_COUNTRY_APPLY_DEAL="申请处理",t.STR_COUNTRY_APPLY_AGREE="同意",t.STR_COUNTRY_APPLY_DEAL_INFO="您已经成功%U玩家%U的申请！",t.STR_COUNTRY_APPLY_DEAL_ALL="申请全部处理",t.STR_COUNTRY_APPLY_DEAL_ALL_INFO="您已经成功%U全部玩家的申请！",t.STR_COUNTRY_DEL_MENBER="踢除成员",t.STR_COUNTRY_DEL_MENBER_ASK="您确定要踢除成员%U吗?\n",t.STR_COUNTRY_DEL_MENBER_SUCCESS="您已经成功把玩家%U踢出国家！",t.STR_COUNTRY_STORAGE_SUPER_LIMIT="输入的数量大于物品的数量!",t.STR_COUNTRY_CONTRIBUTION="(贡献度%U)",t.STR_COUNTRY_STORAGE_GET="兑换物品",t.STR_COUNTRY_STORAGE_GET_ASK="该物品需要的贡献度为/cffff00%U/p\n你当前拥有的贡献度为/c00ff00%U/p\n是否继续兑换？",t.STR_COUNTRY_STORAGE_GET_FAIL="你的贡献度不够,需要%U贡献度!",t.STR_COUNTRY_ADJUST_JOB_EMPTY="没有可任免的职位!",t.STR_COUNTRY_RECALL="罢免",t.STR_COUNTRY_RECALL_ASK="您确定罢免%U吗?",t.STR_COUNTRY_ADJUST_JOB_ASK="您确定将%U任职为%U吗?",t.STR_COUNTRY_BECOME_KILL="国王让位",t.STR_COUNTRY_BECOME_KILL_ASK="你确定要让位给%U吗？",t.STR_COUNTRY_MISSION_RIGHTLESSDO="您没有权限发布任务",t.STR_COUNTRY_DO_MISSION_SUCCESS="操作任务成功",t.STR_COUNTRY_ASSIGN_RIGHTLESSDO="您没有权限指派成员",t.STR_COUNTRY_ASSIGN_SUCCESS="指派成员任务成功!",t.STR_COUNTRY_MISSION_NOT_TO_YOU="该任务没有指派给您!",t.STR_COUNTRY_INSUFFICIENT_COND="条件不足!",t.STR_COUNTRY_DONATE_LACK="捐赠的数量不够，还差%U",t.STR_COUNTRY_DONATE_ERROR="捐赠数据出错",t.STR_COUNTRY_DONATE_SUCCESS="恭喜您捐献成功!当前贡献度为%U",t.STR_COUNTRY_RESOUTSE_SUCCESS="恭喜您兑换资源成功!",t.STR_COUNTRY_WAR_TYEP_XXX="未决定支付",t.STR_COUNTRY_WAR_TYEP_MONEY="同意支付",t.STR_COUNTRY_WAR_TYEP_BUILD="拒绝支付",t.STR_COUNTRY_UNION_STATUS_NORMAL="正常",t.STR_COUNTRY_UNION_STATUS_PROTECT="保护",t.STR_COUNTRY_UNION_STATUS_WAR="国战",t.STR_COUNTRY_UNION_STATUS_TEST="演习",t.STR_COUNTRY_UNION_APPLY_NOW="正在申请",t.STR_COUNTRY_UNION_OWNER="盟主",t.STR_COUNTRY_UNION="盟国",t.STR_COUNTRY_UNION_APPLY_SUCCESS="申请援军成功，请耐心等候对方处理结果！",t.STR_COUNTRY_UNION_CHANGE_SUCCESS="成功转让势力！",t.STR_COUNTRY_UNION_DEL_MEN_ASK="你确定要把【%U】踢出势力吗？",t.STR_COUNTRY_DEL_MEN_SUCCESS="踢出势力成功！",t.STR_COUNTRY_DEAL_UNION_APPLY="成功%U申请！",t.STR_COUNTRY_ADD_UNION_ASK="需求国家/cFFFF005级或以上/p\n消耗/cFFFF00指令书%U/p\n消耗/cFFFF00%U/p\n消耗/cFFFF00%U/p\n你确定要申请加入势力吗？",t.STR_COUNTRY_ADD_UNION_WAIT="申请加入势力成功，请耐心等候对方处理申请！",t.STR_COUNTRY_QUIT_UNION_ASK="你确定要退出势力同盟吗？",t.STR_COUNTRY_QUIT_UNION_SUCCESS="成功退出势力",t.STR_COUNTRY_CREATE_UNION_SUCCESS="创建势力成功！",t.STR_COUNTRY_FIGHT_NOW="正在开战中",t.STR_COUNTRY_RESIDUE="剩余%U",t.STR_COUNTRY_DEAL_ALL_APPLY="全部成功%U申请！",t.STR_COUNTRY_SOLDIER_DEL="踢出军队",t.STR_COUNTRY_SOLDIER_DEL_ASK="您确定把玩家%U踢出军队吗？",t.STR_COUNTRY_SOLDIER_DEL_SUCCESS="成功把玩家踢出军队！",t.STR_COUNTRY_SOLDIER_APPLY_WAIT="申请成为士兵成功，请耐心等待处理结果！",t.STR_COUNTRY_BUILD_UPDATE="%U升级成功！",t.STR_COUNTRY_WAR_DECLARE="国家宣战",t.STR_COUNTRY_WAR_DECLARE_INFO="需要消耗/cFFFF00军力值%U/p\n 需要消耗/cFFFF00指令书%U/p\n您确定向/cFFFF00【%U】/p国家%U吗？",t.STR_COUNTRY_WAR_TEST="国战演习",t.STR_COUNTRY_WAR_REAL="正式宣战",t.STR_COUNTRY_WAR_LOW="国战资金不能小于0",t.STR_COUNTRY_WAR_TEST_SUCCESS="演习宣战成功",t.STR_COUNTRY_WAR_REAL_SUCCESS="正式宣战成功",t.STR_COUNTRY_WAR_TEST_DEC_INFO="%U(%U级)邀请你的国家进行国战练习。\n国战练习仅为国家演练使用，不会损耗任何国家资源和建筑。",t.STR_COUNTRY_WAR_DEC_INFO="%U(%U级)对你宣战：\n国战资金：/cFFFF00%U/p  /cc45712%U/p\n你可以选择支付与敌国相同的国战资金，国战胜利方将可以赢取所有国战资金。\n如果你拒绝支付，在国战胜利后仍可赢取对方的国战资金，战争资金由国库扣除。\n但如果国战失败，你的国家将受到以下惩罚：\n1. 任意建筑被降低一个等级\n2. 受到对手警告，持续48小时\n3. 现有军力值减少50%，繁荣度下降当前等级上限的30%\n4. 失去国库15%的资金和材料",t.STR_COUNTRY_WAR_AGREE_INVITE="同意邀请",t.STR_COUNTRY_WAR_AGREE_PAY="同意支付资金",t.STR_COUNTRY_WAR_REFUSE_INVITE="拒绝邀请",t.STR_COUNTRY_WAR_REFUSE_PAY="拒绝支付资金",t.STR_COUNTRY_AGREE_PAY_SUCCESS="成功同意支付国战资金",t.STR_COUNTRY_REFUSE_PAY_SUCCESS="成功拒绝支付国战资金",t.STR_COUNTRY_WAR_PUNISH="执行惩罚",t.STR_COUNTRY_WAR_PUNISH_INFO="你可以对 【%U】国 执行以下所有惩罚：\n1.降低对方建筑一个等级\n2.发送警告信息给对方所有国民，信息持续保留48小时\n3.减少敌军军力值50%，降低对方繁荣度上限的30%繁荣值\n4.掠夺对方国库15%的资金和材料\n请在国战结束后2小时内选择惩罚，否则视为放弃。\n(有效剩余时间%U)",t.STR_COUNTRY_WAR_PUNISH_SUCCESS="执行惩罚成功！",t.STR_COUNTRY_WAR_STATUS_NORMAL="并无参与任何国战",t.STR_COUNTRY_WAR_STATUS_PROTECT="在国家战争中被击败，处于系统保护状态中，暂时不会受到攻击。",t.STR_COUNTRY_WAR_STATUS_WAR="国战模式：正式\n",t.STR_COUNTRY_WAR_STATUS_TEST="国战模式：演习\n",t.STR_COUNTRY_WAR_ATTACK="%U(攻)\nvs\n%U(守)\n",t.STR_COUNTRY_WAR_TIME="时间：%U\n",t.STR_COUNTRY_WAR_INFO_APPEND="对赌金：/cFFFF00%U/p  /cc45712%U/p\n防守方应答：%U",t.STR_COUNTRY_WAR_STATUS_APPLY="该国家处于申请中状态",t.STR_COUNTRY_WAR_INFO_APPEND2="国战资金：/cFFFF00%U/p  /cc45712%U/p\n防守方应答：%U",t.STR_COUNTRY_BUILD="建筑",t.STR_COUNTRY_PALACE="皇宫",t.STR_COUNTRY_UP_WALL="上城墙",t.STR_COUNTRY_DOWN_WALL="下城墙",t.STR_COUNTRY_UP_TOWER="上箭塔",t.STR_COUNTRY_MIDDLE_TOWER="中箭塔",t.STR_COUNTRY_DOWN_TOWER="下箭塔",t.STR_COUNTRY_ATTACK="(攻)",t.STR_COUNTRY_DEFEND="(守)",t.STR_COUNTRY_WAR_NOTICE="/c00FF00距离战斗时间不到10秒，请各位玩家做好准备！/p",t.STR_COUNTRY_WAR_ROUND_REPORT="第%U回合战报",t.STR_COUNTRY_WAR_ROUND_NUM="回合数:%U",t.STR_COUNTRY_WAR_REACH_TIME_WAIT="时间到请等待",t.STR_COUNTRY_WAR_VIEW_WAR="观看模式中",t.STR_COUNTRY_WAR_ROUND_NULL="未知",t.STR_COUNTRY_WAR_ROUND_READY="准备",t.STR_COUNTRY_WAR_ROUND_FIGHT="战斗",t.STR_COUNTRY_WAR_GARRISON="驻守",t.STR_COUNTRY_WAR_ADD_ARMY_INFO="你已成功加入%U的军队，请耐心等候所有军队准备完成，国战即将开始！",t.STR_COUNTRY_WAR_QUIT_ASK="您确定要离开国战战场吗？",t.STR_COUNTRY_WAR_TEST_QUIT_ASK="您确定要离开观看模式吗？",t.STR_COUNTRY_WAR_QUIT="离开战场",t.STR_COUNTRY_WAR_REMOVE_ARMY="移出军队",t.STR_COUNTRY_WAR_REMOVE_ARMY_ASK="您确定要移出军队【/c00FF00%U/p】吗？",t.STR_COUNTRY_REMOVE_ARMY_SUCCESS="成功移出军队",t.STR_COUNTRY_WAR_DEL_ARMY="踢出军队",t.STR_COUNTRY_WAR_DEL_ARMY_ASK="您确定要踢出军队【/c00FF00%U/p】吗？",t.STR_COUNTRY_WAR_DEL_ARMY_SUCCESS="成功踢出军队",t.STR_COUNTRY_INSERT_ARMY_SUCCESS="成功插入军队",t.STR_COUNTRY_USE_COMMAND_SUCCESS="使用计谋%U成功",t.STR_COUNTRY_REPORT_LIST_ROUND="第%U回合：",t.STR_COUNTRY_ROUND_READY_TO_FIGHT="进入战斗阶段，可以打开军权->视察战况->观战列表参看他人的战斗情况！",t.STR_COUNTRY_ROUND_TO_FIGHT_INFO="攻方   :   守方\n",t.STR_COUNTRY_SOLDIER_ATTACK="兵力值",t.STR_COUNTRY_FIRST_ENTER_INFO="胜利条件（达到以下条件之一）：\n1. 10回合内攻陷对方皇宫\n2. 10回合内让对方兵力值减少为0\n",t.STR_COUNTRY_FIRST_ENTER_INFO2="3. 10回合内我方皇宫不被攻陷\n\n",t.STR_COUNTRY_FIRST_ENTER_INFO3="你现在的身份是预备军，请先选择可进入的据点。只有正式加入军队后，才能参与国战。将军或将军以上官阶，可通过军权调度军队。",t.STR_COUNTRY_WAR_ASSAULT="进攻",t.STR_COUNTRY_WAR_OPEN_TOUCH_BUILD="目前您还没办法%U",t.STR_COUNTRY_WAR_END="国战已经结束！",t.STR_ESCORT_STATE_FAVOURER_NORMAL="对方正在行动,请稍候...",t.STR_ESCORT_STATE_FAVOURER_BATTLE="对方战斗中,请稍候...",t.STR_ESCORT_STATE_FAVOURER_OFFLINE="对方离线中,请稍候...",t.STR_ESCORT_WAIT="等待",t.STR_ESCORT_TIME="计时",t.STR_ESCORT_TIME_OUT="超时",t.STR_ESCORT_MOVE_IS_MEMBER="队员不能操作移动指令!",t.STR_ESCORT_ROB_MOVE="当前还未轮到您的回合,需要等待对方移动之后才能行动!",t.STR_ESCORT_MOVE_COOL="移动CD冷却时间中,请耐心等候!",t.STR_ESCORT_MOVE_TIME_OUT="移动时间超时,游戏会自动帮你移动!",t.STR_ESCORT_STATUS_MOVE="你已经下达移动指令了,请等待服务器刷新!",t.STR_ESCORT_NOW_GRIRD="当前格子无需操作!",t.STR_ESCORT_NEAR_GRIRD="不能移动跨格的位置,请选择附近一个格子!",t.STR_ESCORT_ROB_SUCCESS="抢劫成功",t.STR_ESCORT_MISSION_SUCCESS="任务成功",t.STR_ESCORT_MISSION_SUCCESS_INFO=",请留意任务邮箱的奖励邮件!\n",t.STR_ESCORT_TURN_FAVOURER="本次类型任务还剩%U次!",t.STR_ESCORT_MISSION_FAIL="任务失败!",t.STR_ESCORT_STATE_FINISH_SYSTEM="执行者已在任务中阵亡!",t.STR_ESCORT_STATE_FINISH_CANCEL="执行者放弃任务!",t.STR_ESCORT_MISSION_END="任务结束",t.STR_ESCORT_MISSION_QUIT="退出任务",t.STR_ESCORT_MISSION_QUIT_ASK="您确定要退出任务吗，押金不会退还。",t.STR_ESCORT_MISSION_QUIT_SUCCESS="成功退出任务，押金不退还。",t.STR_ESCORT_SIMPLE_DESC="【%U人】%U",t.STR_ESCORT_ATTACK_MISSION="攻击任务",t.STR_ESCORT_ATTACK_MISSION_INFO="你确定要攻击这玩家吗？他正在进行副本任务。如果你成功击败他们，你将获得他们任务奖励中的一部分。\n如果确定，需要提交压金：%U如果攻击失败，将扣除所有押金。如果攻击成功，押金将随奖励一同发送至你邮箱。",t.STR_ESCORT_TURN_FAVOURER_INFO="押镖视察功能暂时不开放!",t.STR_ESCORT_PLAYER_LIST_NULL="任务队伍暂时还没有数据!",t.STR_ESCORT_MISSION_TEAM="任务队伍",t.STR_INFODATA_RANK_LIST_CLOSE="排行榜暂时关闭!",t.STR_INFODATA_RANK_LIST_SUB_NULL="该排行榜没有子类型可以选择！",t.STR_INFODATA_RANK_MY_RANK="我的排行：",t.STR_INFODATA_NO_RANK="榜外",t.STR_ITEM_REQ_LEVEL="等级不够:还差%U级\n",t.STR_ITEM_REQ_STR="力量不够:还差%U点\n",t.STR_ITEM_REQ_CON="体质不够:还差%U点\n",t.STR_ITEM_REQ_AGI="敏捷不够:还差%U点\n",t.STR_ITEM_REQ_ILT="智力不够:还差%U点\n",t.STR_ITEM_REQ_WIS="感知不够:还差%U点\n",t.STR_ITEM_POWER="效果%U:%U",t.STR_ITEM_POWER_GREEN="效果%U:\n/c66ff00%U/p",t.STR_ITEM_BIND_POWER="绑定效果%U:%U",t.STR_ITEM_BIND_POWER_GREEN="绑定效果%U:\n/c66ff00%U/p",t.STR_ITEM_COMPOSE_SKILL="合成技能",t.STR_ITEM_COM_REQ_LV="等级:%U",t.STR_ITEM_COM_DURA="耐久:%U",t.STR_ITEM_COM_ATK_TIME="攻击次数:%U",t.STR_ITEM_COM_ATK_MIN="攻击伤害：%U",t.STR_ITEM_COM_DEF_STR="劈砍护甲:%U",t.STR_ITEM_COM_DEF_AGI="穿刺护甲:%U",t.STR_ITEM_COM_DEF_MAG="魔法护甲:%U",t.STR_ITEM_COM_HIT_RATE="武器命中率:%U",t.STR_ITEM_COM_LAST_ROUND="持续回合:%U",t.STR_ITEM_COM_AREA="范围:%U",t.STR_ITEM_COM_ATTACK_POWER="镶嵌效果:%U",t.STR_ITEM_GET_ATTACK_INFO1="您当前镶嵌的装备：%U",t.STR_ITEM_GET_ATTACK_INFO2="\n请选择您要镶嵌的宝石%U",t.STR_ITEM_ATTACK_RATE="成功率：",t.STR_ITEM_ATTACK_NEXT_RATE="下次镶嵌成功率",t.STR_ITEM_ATTACK_ASK="您确定要进行镶嵌吗？\n当前宝石属性:\n%U",t.STR_ITEM_ATTACK_FAIL="镶嵌破损",t.STR_ITEM_ATTACK="(镶嵌%U)",t.STR_ITEM_SET_EFFECT="套装效果:",t.STR_ITEM_SET_NUM="%U件：%U",t.STR_ITEM_DEDICATED="专用",t.STR_ITEM_NO_BIND="不绑定",t.STR_ITEM_AUTO_BIND="自动绑定",t.STR_ITEM_HAS_BIND="已绑定",t.STR_ITEM_CAN_IDENTIFY="可鉴定",t.STR_ITEM_LEVEL="等级%U",t.STR_ITEM_COM_ATK="攻击:%U",t.STR_ITEM_HIT_RATE="命中:%U",t.STR_ITEM_ATK_TIME="攻击次数:%U次",t.STR_ITEM_NEED_BIND="(需绑定)",t.STR_ITEM_GET_DEF_STR="劈砍%U",t.STR_ITEM_GET_DEF_AGI="穿刺%U",t.STR_ITEM_GET_DEF_MAG="魔法%U",t.STR_ITEM_GET_DEF_ARMOR="护甲:%U",t.STR_ITEM_GET_REQ_STR="%U力量",t.STR_ITEM_GET_REQ_CON="%U体质",t.STR_ITEM_GET_REQ_AGI="%U敏捷",t.STR_ITEM_GET_REQ_ILT="%U智力",t.STR_ITEM_GET_REQ_WIS="%U感知",t.STR_ITEM_GET_LAST_ROUND="持续%U回合",t.STR_ITEM_GET_AGING="时效:",t.STR_ITEM_GET_VIP_AGING="VIP期限:",t.STR_ITEM_GET_INACTIVE="未激活",t.STR_ITEM_GET_PAST_DUE="已过期",t.STR_ITEM_ONE_KEY_RECOVERY="一键恢复",t.STR_ITEM_ONE_KEY_RECOVERY_INFO="自动使用背包回复药,回复生命。",t.STR_MAIL_PAY="付费：%U\n",t.STR_MAIL_PRESENT="赠送：%U\n",t.STR_MAIL_GROSS="总计：%U\n",t.STR_MAIL_TITLE_TYPE_SEND="发给[%U]的",t.STR_MAIL_TITLE_TYPE_BACK="[%U]退回",t.STR_MAIL_TITLE_TYPE_OTHER="[%U]发给",t.STR_MAIL_READ_MAIL="交易邮件",t.STR_MAIL_UNKNOWN_MAIL="未知邮件!",t.STR_MAIL_HAS_DEL="已删除",t.STR_MAIL_NEW="新",t.STR_MAIL_HAS_READ="已读",t.STR_MAIL_AFFIX="附件: %U\n",t.STR_MAIL_SEND_ASK="/cFF0000但没有填写收取费用/p，是否继续发送？",t.STR_MAIL_SEND="发送",t.STR_MAIL_SEND_SUCCESS="发送邮件成功!",t.STR_MAIL_SEND_SUCCESS_INFO="\n1)交易成功后，请在/cffff00回执/退回邮件/p里查收\n2)如果对方卡邮，长时间没回复，您可以在/cffff00已发交易邮件/p主动收回邮件",t.STR_MAIL_INFORM_ASK="举报后邮件将提交到GM审查是否为问题邮件,是否确认举报？",t.STR_MAIL_INFORM_SUCCESS="谢谢您的举报!",t.STR_MAIL_PICK_ASK="收取该邮件需要付费\n%U是否继续？",t.STR_MAIL_DEL_SUCCESS="删除邮件成功！",t.STR_MAIL_BACK_SUCCESS="返回邮件成功！",t.STR_MAIL_PICK_READ_NUM="读取第%U封邮件...",t.STR_MAIL_PICK_GET_NUM="提取第%U封邮件...",t.STR_MAIL_PICK_ERROR="提取邮件异常",t.STR_MAIL_PICK_NULL="当前页没有可提取的邮件",t.STR_MAIL_PICK_MONEY_INFO="共提取金钱%U\n",t.STR_MAIL_PICK_SUCCESS_INFO="成功提取当前页邮件\n%U",t.STR_MAIL_CHOICE_PEOPLE="<请选择玩家>",t.STR_MAIL_INPUT_CON="<请输入内容>",t.STR_MISSION_UNFINISH="未完成",t.STR_MISSION_FINISH="完成",t.STR_SEUL="大侠",t.STR_HEROINE="女侠",t.STR_CHILDE="公子",t.STR_GIRL="姑娘",t.STR_BORTHER="哥哥",t.STR_SISTER="姐姐",t.STR_KID="小子",t.STR_SLAVE_GIRL="丫头",t.STR_PRINCE="王子",t.STR_PRINCESS="公主",t.STR_MISSION_REWARD_EXP="/cffcc00经验 /p%U",t.STR_MISSION_REWARD_HONOR="/cffcc00贡献 /p%U",t.STR_MISSION_REWARD_CITY_PROS="/cffcc00城市繁荣度 /p%U",t.STR_MISSION_REWARD_CITY_ARMY="/cffcc00城市军力值 /p%U",t.STR_MISSION_REWARD_COUNTRY_ARMY="/cffcc00国家军力值 /p%U",t.STR_MISSION_REWARD_COUNTRY_LAND="/cffcc00国家土地 /p%U",t.STR_MISSION_REWARD_COUNTRY_PROS="/cffcc00国家繁荣度 /p%U",t.STR_MISSION_REWARD_COUNTRY_PEOP="/cffcc00国家民众数 /p%U",t.STR_MISSION_REWARD_COUNTRY_WOOD="/cffcc00国家木材 /p%U",t.STR_MISSION_REWARD_COUNTRY_STONE="/cffcc00国家石材 /p%U",t.STR_MISSION_REWARD_COUNTRY_IRON="/cffcc00国家铁矿 /p%U",t.STR_MISSION_REWARD="奖励",t.STR_MISSION_CAN_SELECT_ITEM="可选物品",t.STR_MISSION_ESCORT="任务押金",t.STR_MISSION_BULLETIN="简报:%U",t.STR_MISSION_DEL_ASK="您确定要放弃任务</cff0000%U/p>吗？",t.STR_MISSION_OFFSET_LINE_DESC="任务时间：%U",t.STR_MISSION_OFFSET_LINE_NULL="没有可接的离线任务！",t.STR_MISSION_OFFSET_LINE="离线任务",t.STR_MISSION_OFFSET_LINE_ASK="接离线任务将会玩家离线，是否继续？",t.STR_NO_TOP_LIMIT="无上限",t.STR_ALL_PEOPLE="所有人",t.STR_ASSIGNED_MEMBER="指派成员:%U",t.STR_IN_PROCESSING_REVIEW="审核中",t.STR_PHOTO_GET_INFO="创建:%U大小:%U",t.STR_NETWORK_BUSY_WAIT="网络繁忙，请稍候重试!",t.STR_PLEASE_WIAT="请稍候...",t.STR_PHOTO_UPLOAD_SUCCESS="照片上传成功！",t.STR_PHOTO_CAMERA_UNSUPPORT="您的手机不支持拍照！",t.STR_PHOTO_ENTER_CAMERA_FAIL="摄像头初始化失败！",t.STR_INPUT="输入",t.STR_COMMENT_CON="评论内容",t.STR_COMMENT_DEL="删除评论",t.STR_COMMENT_DEL_ASK="您确定要删除该评论吗？",t.STR_HIDDEN_LOVE="暗恋",t.STR_HIDDEN_LOVE_TEL_OTHER_ASK="是否告诉对方？",t.STR_YES="是",t.STR_NO="否",t.STR_BACKGROUND="背景%U",t.STR_SIGNATURE_CARD="名片签名",t.STR_KILL="击杀",t.STR_COLLECT="搜集",t.STR_REFRESH_RANDOM_MISSION="刷新挑战任务",t.STR_REFRESH_RANDOM_MISSION_ASK="重置任务可以马上获得新的挑战任务，但需要支付/cFF0000%U/p, 是否确认?",t.STR_DEL_RANDOM_MISSION_ASK="放弃挑战任务需要等待15分钟才可重新接收\n(使用金叶可以马上刷新)\n",t.STR_ALLODS_GOLD_SUCCESS="提交任务成功！",t.STR_GET_RANDOM_MISSION_INFO="还剩下%U你才可重新接取挑战任务\n或者你可以支付/cFF0000%U/p马上刷新任务。",t.STR_SHOP_ITEM_PRICE="价格:%U",t.STR_SHOP_ITEM_COMBIN_MATERIAL="需求材料：",t.STR_SHOP_ITEM_COMBIN_NOW_HAVA="(现有%U)",t.STR_SHOP_ITEM_COMBIN_ALL="合成后装备强化：",t.STR_SHOP_ITEM_SELL_ASK="确定要卖出%U吗？",t.STR_SHOP_ITEM_SHOP_INFO="摆摊已经开始，别人可以从您的摊位购买到您上架的商品！",t.STR_SHOP_ITEM_SHOP_NULL="没有摆摊物品了",t.STR_SHOP_ITEM_GOODS_SELL_BUY="交易所购买",t.STR_SHOP_ITEM_GOODS_SELL_BUY_ASK="购买该物品需要花费\n%U是否购买？",t.STR_SHOP_ITEM_GOODS_PROVIDE_INFO="售出:%U价格: %U",t.STR_SHOP_ITEM_GOOD_PROVIDE_INFO2="商品价格可能有10%的波动,成交价格可能略高或略低上述价格.",t.STR_SHOP_ITEM_GOOD_PROVIDE_INFO3="商品价格波动超过10%,请重新确认成交价格.",t.STR_SHOP_ITEM_AUTO_PROVIDE_INFO="自动供应物品%U个,获得%U",t.STR_CONGRATULATIONS="恭喜您",t.STR_SHOP_ITEM_GOOD_BUY_SUCCESS="交易所物品购买成功!",t.STR_SHOP_ITEM_GOOD_PUBLISH_ORDER="发布订单成功!",t.STR_SKILL_GETD_DESC_COST="花费:%U",t.STR_SKILL_GETD_DESC_NEED_SP="消耗技能点:%U点\n",t.STR_SKILL_GETD_DESC_JOB=" 职业%U",t.STR_SKILL_GETD_DESC_LEVEL=" 等级%U",t.STR_SKILL_GETD_DESC_NEED="需求:%U",t.STR_SKILL_GETD_DESC_USE_MP="%U法力",t.STR_SKILL_GETD_DESC_USE_HP="%U生命",t.STR_SKILL_GETD_DESC_EXPEND="技能消耗:%U",t.STR_SKILL_GETD_DESC_WEAPON="武器限制:%U",t.STR_SKILL_LACK_MP="MP不足",t.STR_SKILL_LACK_HP="HP不足",t.STR_SKILL_WEAPON_DESTROY="武器损坏",t.STR_SKILL_WEAPON_DISCREPANCIES="武器不符",t.STR_SKILL_DROP_ASK="您确定要放弃技能%U吗?%U",t.STR_SKILL_INFO="技能信息",t.STR_TEAMBOSS_ENTER="进入副本",t.STR_TEAMBOSS_ENTER_FAIL="进入团队副本初始化失败！",t.STR_TEAMBOSS_SELECT="请选择攻打怪物军团",t.STR_TEAMBOSS_GET_INTEGRAL_INFO="本场团队副本荣誉积分：/c00FF00%U/p\n怪物军团剩余总数：/c00FF00%U/p\n个人总荣誉积分：/c00FF00%U/p\n荣誉积分将在副本结束后结算。\n副本时间结束前杀死所有怪物可获得2倍积分！",t.STR_GET_FIRST_INFO="请选择进攻怪物军团！\n击败副本内的怪物可获得荣誉积分，荣誉积分可兑换各种道具装备。\n在副本时间结束之前杀死所有怪物，即可获得2倍荣誉积分！",t.STR_TEAMBOSS_OVER_NOTICE1="尽管你在这场战役中有着出彩的表现，但这并不足以影响战局，战斗失败了，怪物大军攻陷了我们的城池。\n本场战役获得/c00FF00荣誉积分%U/p",t.STR_TEAMBOSS_OVER_NOTICE2="由于你在这场战役中的出彩表现，你们的军队击退了怪物大军！战斗胜利了，所有参战的玩家均获得2倍积分！\n本场战役获得/c00FF00荣誉积分%U/p",t.STR_TEAMBOSS_CONTINUE_ASK_INFO="你与怪物军团战斗获得了胜利！战斗胜利获得的积分将在团队副本结束后进行结算！\n此处的怪物等级为%U级\n还剩下%U组怪物",t.STR_FIGHTON="继续战斗",t.STR_DO_FIGHT_INFO="此处的怪物等级为%U级\n还剩下%U组怪物",t.STR_ENTER_FIGHT="进入战斗",t.STR_TEAMBOSS_QUIT="离开副本",t.STR_TEAMBOSS_QUIT_ASK="你确定要离开团队副本吗？",t.STR_TEAMBOSS_QUIT_END="团队副本已经结束！",t.STR_WARBUILD_INFO_DUR="%U  耐久度:%U",t.STR_WARBUILD_TO_OUR_EFF="对我方效果:%U",t.STR_WARBUILD_TO_OTHER_EFF="对敌方效果:%U",t.STR_WARBUILD_INFO="描述:%U",t.STR_WARBUILD_INFO_NEED="升级需求:\n%U铁矿:%U\n木材:%U\n石材:%U\n指令书:%U\n军力值:%U\n繁荣度:%U\n军营等级:%U\n土地:%U\n",t.STR_WARBUILD_DESTROY="已摧毁",t.STR_WARBUILD_GET_INFO="(%U级)\n耐久度：%U\n军队：%U\n士兵：%U\n",t.STR_ENEMY="敌方",t.STR_OUT_SIDE="我方",t.STR_WARBUILD_GET_POWER_DESC="在%U的%U下，你的%U",t.STR_RECOVER="恢复",t.STR_REDUCE="减少",t.STR_ALL_BUILD="所有建筑",t.STR_WAR_COMMAND_DUR="耐久度%U点",t.STR_WAR_COMMAND_LEVEL_INFO="%U(%U级)",t.STR_WAR_COMMAND_GET_INFO_ROUND="有效回合数:%U",t.STR_WAR_COMMAND_INFO_REQ_CAMP="军营%U级",t.STR_WAR_COMMAND_INFO_REQ_BOOK="指令书%U  ",t.STR_WAR_COMMAND_INFO_REQ_ARMY="军力值%U  ",t.STR_WAR_COMMAND_INFO_REQ_ARMY_RT="军力值%U(军力值上限%U%)",t.STR_WARBUILD_TO_OUR_ARMY_EFF="对我军效果:%U",t.STR_WARBUILD_TO_OTHER_ARMY_EFF="对敌军效果:%U",t.STR_WAR_COMMAND_CAN_REQ_CAMP="军营等级还差/cFF0000%U级/p\n",t.STR_WAR_COMMAND_CAN_REQ_BOOK="指令书还差/cFF0000%U本/p\n",t.STR_WAR_COMMAND_CAN_REQ_ARMY="军力值还差/cFF0000%U点/p\n",t.STR_CIMPOSITE="综合",t.STR_CIMPOSITE_SIM="综",t.STR_WORLD="世界",t.STR_WORLD_SIM="世",t.STR_AREA="区域",t.STR_AREA_SIM="区",t.STR_COUNTRY="国家",t.STR_COUNTRY_SIM="国",t.STR_TEAM="队伍",t.STR_TEAM_SIM="队",t.STR_CHAT_PRIVATE="私聊",t.STR_CHAT_PRIVATE_SIM="私",t.STR_SYSTEM="系统",t.STR_SYSTEM_SIM="系",t.STR_SECRET="密",t.STR_LOADING="加载数据...",t.STR_RUN_ERROR="运行错误",t.STR_GAME_MAP_NULL="gameMap为空！",t.STR_IN_CREATE_SCREEN="创建场景中...",t.STR_IN_AUTO_RUN="自动寻路中...",t.STR_GOOD="©2011 谷得游戏",t.STR_ARENA_INIT_FAIL="竞技场初始化失败！",t.STR_TEAMBOSS_INIT_FAIL="团队副本初始化失败！",t.STR_WAR_INIT_FAIL="War初始化失败",t.STR_BATTLE_INIT_FAIL="battle初始化失败",t.STR_KEY="按键版",t.STR_FONT_HEIGHT="字体高：%U",t.STR_CMD_MENU="菜单",t.STR_CMD_CANCEL="取消",t.STR_CMD_FACE="插入表情",t.STR_CMD_ADD_ITEM="插入背包物品",t.STR_CMD_ADD_MISSSION="插入任务",t.STR_CMD_ADD_COUNTRY="插入国家",t.STR_CMD_UPLOAD="上传",t.STR_CMD_TYPE_INTEGRAL_BUY="积分兑换",t.STR_CMD_TYPE_INTEGRAL_BUY_INPUT="请输入购买的物品数量：",t.STR_CMD_TYPE_ADD_FRIEND="添加好友",t.STR_CMD_TYPE_ADD_FRIEND_INPUT="输入好友的名称或ID:",t.STR_NAME="名字",t.STR_ID_NULL="没有此ID",t.STR_TYPE_WIN_ACTION_DO="执行惩罚",t.STR_TYPE_WIN_ACTION_DO_LEVEL="选择降低建筑一个等级",t.STR_TYPE_WIN_ACTION_DO_ERROR="选择警告对方一句话",t.STR_TYPE_CREATE_UNION="创建势力",t.STR_TYPE_CREATE_UNION_NAME="创建势力的名称:",t.STR_TYPE_WIN_ACTION_WARN="国战惩罚-警告",t.STR_TYPE_WIN_ACTION_WARN_TO="向对方发出警告:",t.STR_TYPE_WAR_DECLARE="国战资金",t.STR_TYPE_WAR_DECLARE_INFO1="注意：请输入国战资金，对方必须支付与你对等的国战资金。（如对方拒绝支付，战败后另有惩罚）",t.STR_TYPE_WAR_DECLARE_INFO2="国战资金由系统暂时扣除，在国战结束后，由战胜国获得全部国战资金。",t.STR_TYPE_CHANGE_PASSWORD="修改密码",t.STR_TYPE_LOCK_USER="冻结账号",t.STR_TYPE_LOCK_USER_PHONE="请输入绑定手机号码",t.STR_TYPE_LOCK_USER_INFO1="系统将验证账号和绑定号码。验证成功后会发送信息到绑定手机上，请根据短信提示内容进行操作。",t.STR_TYPE_LOCK_USER_INFO2="请先确认账号已绑定手机。",t.STR_TYPE_BIND_PHONE="绑定手机号码",t.STR_TYPE_BIND_PHONE_INPUT="请输入手机号码",t.STR_TYPE_BIND_EMAIL="绑定邮箱",t.STR_TYPE_BIND_EMAIL_INPUT="请输入邮箱地址",t.STR_TYPE_MODIFY_NAME="修改角色信息",t.STR_TYPE_MODIFY_NAME_INFO="请输入角色名(2~12个字符,中文不超过6个)",t.STR_NAME_NOT_FIT="角色名输入不符合规则",t.STR_TYPE_MODIFY_ACCCOUNT="修改账号信息",t.STR_TOURIST_NAME_NOT_FIT="游客账号输入不符合规则",t.STR_TYPE_BILL="充值%U",t.STR_TYPE_BILL_NAME="输入卡号:",t.STR_TYPE_BILL_PWD="输入卡密:",t.STR_TYPE_MAIL_ATTACH_ITEM="附件物品数量",t.STR_TYPE_MAIL_ATTACH_ITEM_NUM="输入物品数量:",t.STR_TYPE_COUNTRY_STORE_PUT="放入国家仓库",t.STR_TYPE_COUNTRY_STORE_CONVERT="输入兑换贡献值:",t.STR_TYPE_ACTOR_SELL_SEARCH="搜索出售角色",t.STR_TYPE_ACTOR_SELL_SEARCH_NAME="输入角色名称或ID:",t.STR_TYPE_PHOTO_ALBUMS_SEARCH="搜索相册",t.STR_TYPE_PHOTO_ALBUMS_SEARCH_N="请输入相册主人:",t.STR_TYPE_PET_CHANGE_NAME="宠物改名",t.STR_TYPE_PET_NEW_NAME="请输入宠物的新名字",t.STR_TYPE_GOODS_PURCHASE="收购表单",t.STR_TYPE_GOODS_PURCHASE_PRICE="请输入物品单价:",t.STR_TYPE_GOODS_PURCHASE_NUM="请输入收购数量:",t.STR_TYPE_GOODS_PROVIDE="交易所",t.STR_TYPE_GOODS_PROVIDE_SEAR_NAME="请输入供应物品的数量(系统会自动匹配最高价钱出售)",t.STR_TYPE_GOODS_PROVIDE_SEAR_KEY="请输入搜索物品的关键字",t.STR_TYPE_GOODS_HAND_SELL="挂售表单(输入总价)",t.STR_TYPE_GOODS_HAND_SELL_PRICE="(输入总价,不超过%U):",t.STR_TYPE_GOODS_HAND_SELL_NUM="请输入物品数量(最多%U个):",t.STR_TYPE_GOODS_HAND_SELL_INFO="注意：挂售价格为道具总价，非单价，请谨慎输入！",t.STR_TYPE_PLAYER_SHOP_NAME="摆摊",t.STR_TYPE_PLAYER_SHOP_NAME_ENTER="请输入摆摊名称",t.STR_TYPE_PLAYER_SHOP_NAME_NULL="摆摊名称不能为空！",t.STR_TYPE_PLAYER_SHOP_SELL="摆摊售出表单",t.STR_TYPE_PLAYER_SHOP_SELL_PRICE="请输入物品单价(黄金最大%U，铜币最大%U):",t.STR_TYPE_PLAYER_SHOP_SELL_NUM="请输入物品数量(最多%U个):",t.STR_TYPE_PLAYER_SHOP_BUY="摊位物品买入表单",t.STR_TYPE_PLAYER_SHOP_BUY_NAME="请输入购买物品[%U]的数量(最多%U个):",t.STR_TYPE_PLAYER_SHOP_PRICE="修改单价",t.STR_TYPE_PLAYER_SHOP_CURR_ENCHAT="当前附魔值:",t.STR_TYPE_PLAYER_SHOP_NEED_ENCHAT="所需附魔值:",t.STR_TYPE_CHAT_BEGIN="发起聊天%U",t.STR_TYPE_CHAT_CHANNEL_CHOICE="请选择发送频道:",t.STR_TYPE_CHAT_PRIVATE_CHOICE="请选择私聊对象:",t.STR_TYPE_COUNTRY_TAXRATE="修改税率",t.STR_TYPE_COUNTRY_TAXRATE_NUM="国家税率(0-100)",t.STR_TYPE_PLAYER_NAME="创建角色",t.STR_TYPE_COUNTRY_NAME="请输入国家名",t.STR_TYPE_LOGIN="登录",t.STR_TYPE_LOGIN_NAME="用户名",t.STR_TYPE_LOGIN_PWD="密码",t.STR_TYPE_MAIL_GM_SEND="联系客服",t.STR_TYPE_MAIL_GM_SEND_QUESTION="问题标签:",t.STR_TYPE_MAIL_GM_SEND_SUGGEST="建议",t.STR_TYPE_MAIL_NAME="收件人",t.STR_TYPE_MAIL_NAME_ENTER="请输入收件人:",t.STR_TYPE_MAIL_CONTENT="邮件内容",t.STR_TYPE_MAIL_CONTENT_ENTER="请输入内容:",t.STR_TYPE_MAIL_MONEY="赠送金钱",t.STR_TYPE_MAIL_MONEY_ENTER="请输入%U",t.STR_TYPE_MAIL_REQMONEY="付费金钱",t.STR_TYPE_PHOTO_PREVIEW="拍照预览(%U)",t.STR_NULL="空",t.STR_TYPE_REGISTER="注册",t.STR_TYPE_REGISTER_NAME="请输入用户名(4～12位字母或数字)",t.STR_TYPE_REGISTER_PWD="请输入密码(4～12位字母或数字)",t.STR_NULL_ENTER="输入内容不能为空",t.STR_TYPE_COUNTRY_ENTER_RATE="修改入境税",t.STR_TYPE_COUNTRY_ENTER_RATE_CON="%U(最多%U):",t.STR_TYPE_SAFELOCK_SET="设置安全锁",t.STR_TYPE_SAFELOCK_SET_PWD="请设置安全锁密码(4~6位数字)",t.STR_TYPE_SAFELOCK_SET_INFO="设置安全码必须先绑定手机或者邮箱\n",t.STR_TYPE_SAFELOCK_MODIFY="修改安全锁",t.STR_TYPE_SAFELOCK_MODIFY_OLD_PWD="请输入旧的安全锁密码",t.STR_TYPE_SAFELOCK_MODIFY_NEW_PWD="请设置新的安全锁密码(4~6位数字)",t.STR_TYPE_SAFELOCK_REMOVE="解除安全锁",t.STR_TYPE_SAFELOCK_REMOVE_PWD="请输入安全锁密码",t.STR_TYPE_SAFELOCK_REMOVE_INFO="解除安全锁后，所有角色进行任何操作均不会受到安全码限制。",t.STR_TYPE_SAFELOCK_VERIFY="安全锁",t.STR_TYPE_SAFELOCK_VERIFY_INFO="账号已设置安全锁，必须输入安全码才能继续操作。\n注：账号解除手机或者邮箱绑定后，安全锁会自动解除。",t.STR_PLAYER_INFO_HEAD="属性界面",t.STR_MISSION_LIST="任务列表",t.STR_SEE_DETAIL="查看详细",t.STR_PRESS_KEY_OPEN="按/c0000ff%U/p键打开%U",t.STR_TOUCH_OPEN="点击这里打开%U",t.STR_CHOICE="选择",t.STR_GUIDE_ADD_POINT_SURE="请先操作/c00ff00加点/p!",t.STR_GUIDE_SURE="请先按指引操作!",t.STR_GUIDE_CONTINUE_TOUCH="\n/cffff00(触屏继续)/p",t.STR_GUIDE_NPC_TOUCH="试下碰一下旁边的/c00ff00npc/p,他头上的 /i03020 表示有任务需要你来完成。",t.STR_WEL_WORLD_OL="欢迎来到世界OL",t.STR_WEL_WORLD_OL_UC="欢迎来到英雄国度OL",t.STR_CONGR_EQUIP_SUCCESS="恭喜你装备成功",t.STR_CONGR_ADD_SP_SUCCESS="恭喜你/c00ff00加点/p成功",t.STR_BATTLE_GROUP_NULL="找不到本地怪物组%U",t.STR_CANNOT_EQUIP_THIS="无法装备该物品!!!",t.STR_EQUIP_THIS_BEFORE="\n(请先装备1把单手武器，再装备副手)",t.STR_DEL_PET="放生宠物",t.STR_DEL_EQUIP="丢弃装备",t.STR_DEL_PET_ASK="您确定要放生%U吗?",t.STR_DEL_EQUIP_ASK="您确定要丢弃%U吗?",t.STR_UNEQUIP_BAG_NULL_ENG="无法卸下该装备，请检查背包空间是否足够!",t.STR_UNEQUIP_INDENTIFY="解除装备后才可进行鉴定!",t.STR_EQUIP_INDENTIFY_RESIDUE="剩余卷轴/cFFFF00%U个/p\n",t.STR_INDENTIFY_RESULT_NEW_ASK="%U/cFF0000确认要替换属性吗？/p(继续鉴定不会替换原有属性)",t.STR_INDENTIFY_RESULT_RESULT="鉴定结果",t.STR_CANNOT_USE_IN_WORD="不能在世界中使用！",t.STR_PET_NOT_SET_FIGHT="你还没有选择出战的宠物!",t.STR_ITEM_SHOW="道具提示",t.STR_PET_ITEM_RESET_ASK="您的宠物等级为%U级,该道具会使您的/cff0000宠物变为1级/p,并改变您的宠物的成长以及领悟等级，您确定要使用该道具吗？",t.STR_PET_EGG="宠物蛋",t.STR_BOX_NULL="真倒霉，箱子里什么都没有！",t.STR_OPEN_BOX_GET="开启宝箱获得",t.STR_ITEM_USE_SAVE=",节省%U",t.STR_REPAIR_EQUIP="修理装备",t.STR_REPAIR_EQUIP_SURE="修理所有身上装备需要%U,确认要修理吗？",t.STR_REPAIR_EQUIP_SURE_SUCCESS="身上装备全部修理成功!",t.STR_REPAIR_EQUIP_SUCCESS="身上所有装备修理成功%U",t.STR_USE_SUCCESS="使用成功",t.STR_USE_ITEM_COUNTRY_BOOK="您的国家指令书 +1。\n个人贡献度 +100",t.STR_USE_ITEM_TITLE_INFO="获取新称号/c00FF00%U/p",t.STR_ATTACH_ITEM_TITLE1="恭喜，您成功镶嵌了",t.STR_ATTACH_ITEM_TITLE2="第%U颗",t.STR_ATTACH_ITEM_TITLE3="宝石！",t.STR_ATTACH_ITEM_FAIL_INFO="镶嵌失败,镶嵌属性保留，下次镶嵌将重新开始！",t.STR_ITEM_BIND_ASK="是否绑定物品 %U ？",t.STR_ITEM_BIND_SUCCESS="%U已成功绑定！",t.STR_ITEM_BIND_SUCCESS_GET="\n获得绑定属性：\n",t.STR_CREATE_COUNTRY="创建国家",t.STR_GET_CODE="领取码",t.STR_SHOP_BACKUP_START="您目前的版本不支持该功能，请在标题画面选择/c00ff00'版本更新'/p更新版本！",t.STR_SKILL_TYPE_PET_NULL="请装备上宠物再进宠物技能商店!",t.STR_SKILL_SHOP_ID_ERROR="技能商店ID不匹配",t.STR_SKILL_SHOP_SKILL_NULL="技能所没有技能可以学习",t.STR_SPECIALCODE_SUCCESS="操作成功，请到邮箱领取奖励！",t.STR_SHOP_REFRESH_BAG="摆摊中不能整理背包",t.STR_STALL_UPITEM_FULL="摆摊上架物品已满!",t.STR_STALL_PLACE="%U的摊位",t.STR_STALL_NOT_IN="你不是处于摆摊状态",t.STR_STALL_SELL_NULL="你的摆摊物品还没有售出过!",t.STR_STALL_BUY="成功买进摆摊物品%U",t.STR_CONNECT_SERVICE_LOAD="连接服务器...",t.STR_LAND_LOAD="正在登录...",t.STR_AREA_LOAD="加载区列表...",t.STR_TOURIST_MODIFY_REC="游客(推荐)",t.STR_SEND_SUCCESS="传送成功",t.STR_QUIT_GAME="离开游戏",t.STR_QUIT_GAME_ASK="您确定要退出游戏吗?",t.STR_TOURIST="游客",t.STR_TOURIST_REGISTER="游客注册",t.STR_TOURIST_REGISTER_ASK="游客账号不能操作该功能,需要先注册才能执行,是否注册?",t.STR_TOURIST_CHAGENAME_INFO="%U您好,请/c00ff00修改角色信息并注册账号/p，将可获得丰厚奖品哦。注意：如果您的角色到达15级，请必须修改账号信息，否则将无法获得经验。",t.STR_TOURIST_CHAGENAME_ACCOUNT="你好,账号%U,请修改你的账户信息!",t.STR_PLAYER_NULL_TITLE="请先登录到游戏中!",t.STR_CHAGENAME_ACCOUNT_SUCCESS="修改账号信息成功!",t.STR_GAMEWORLD_BIND_PHONE="您绑定的手机号码是",t.STR_GAMEWORLD_BIND_EMAIL="您绑定的邮箱是",t.STR_GAMEWORLD_BIND_PHONE_INFO="%U请谨记!",t.STR_CANCEL_BIND="解除绑定",t.STR_CHANGE_PWD_SUCCESS="密码修改成功！",t.STR_QUICK_ADDHP_FULL="生命值满,不需要使用恢复物品",t.STR_QUICK_ADDHP_NO_ITEM="没有回血的物品",t.STR_QUICK_ADDHP_USE="使用%U",t.STR_ERROR_JUMP_SHOP_ASK="%U是否进入商店购买?",t.STR_HAVE_NOT_BUFFER="身上没有BUFF效果！",t.STR_ADD_FRIEND_SUCCESS="添加好友成功",t.STR_INPUT_ERROR="输入出错,规格不符",t.STR_RESOLVE_NUM_OVER="分解物品不能多于30个！",t.STR_RESOLVE_OINFO="/cFF0000注意装备分解后无法复原！/p\n需要收费：/cc45712%U/p分解装备列表如下:%U",t.STR_RESOLVE_ALL="全部分解",t.STR_RESOLVE_ITEM_ERROR="分解栏物品数据出错！",t.STR_RESOLVE_ITEM_NOT_EQUIP="分解栏中不能有非装备的物品！",t.STR_RESOLVE_SUCCESS="分解成功，已放入背包。\n获得以下材料：\n%U",t.STR_COMBIN_SHOP_DATA_ERROR="合成商店数据有误！",t.STR_COMBIN_SURE="确定合成",t.STR_COMBIN_MULTI="批量合成",t.STR_COMBIN_MULTI_WAIT="批量合成第%U个",t.STR_COMBIN_MULTI_INPUT="请输入合成数量(最多%U)",t.STR_COMBIN_GET="\n合成可获得：%U",t.STR_COMBIN_SELECT_ITEM_INFO="请选择合成材料，合成后不可恢复！\n%U（再次点击确认选择）",t.STR_COMBIN_EQUIP="合成装备",t.STR_COMBIN_EQUIP_ASK="即将合成 %U ！\n%U\n是否确认合成？",t.STR_COMBIN_NEW_ITEM="获得新物品%U",t.STR_COMBIN_FOURTH_GET="合成获得：\n %U",t.STR_COMBIN_CONTINUE="继续合成",t.STR_COMBIN_REPLACE_INFO="（继续合成可生成新的随机属性和技能）",t.STR_COMBIN_REPLACE_ASK="（使用替换属性可获得新属性，否则保留原属性）",t.STR_COMBIN_REPLACE_ALL="替换属性与技能",t.STR_COMBIN_REPLACE_POWER="仅替换属性",t.STR_COMBIN_REPLACE_SKILL="仅替换技能",t.STR_INTEGRAL_BUY_NUM_NULL="物品数量不能小于1！",t.STR_INTEGRAL_INFO="荣誉积分%U",t.STR_INTEGRAL_ARENA_INFO="竞技积分%U",t.STR_INTEGRAL_SKYARENA_INFO="天空挑战积分%U",t.STR_INTEGRAL_BUY_ASK="需要消耗%U\n你确定要兑换物品%U x %U 吗？",t.STR_INTEGRAL_BUY_SUCCESS="积分兑换物品成功！",t.STR_PARTNERFLY_SUCCESS="成功传动到伴侣身边！",t.STR_PARTNER_APPLY="申请结婚",t.STR_PARTNER_APPLY_INFO="/c00FF00申请结婚/p\n1.与结婚对象组成2人队伍后，可申请结婚。\n2.结婚的双方需等级大于35级，并且均为未婚状态。\n3.结婚双方需提交：%U",t.STR_PARTNER_APPLY_NEED_TEAM="需与结婚对象组成2人队伍才可申请结婚！",t.STR_PARTNER="结婚",t.STR_PARTNER_ASK="你是否愿意与/c00FF00%U/p结为伴侣？\n1.伴侣同时在线时，获得经验/cFFFF001.1/p倍（包括任务所获得经验）。\n2.伴侣间/cFFFF00传送/p无需使用传送石。\n3.结婚双方需提交：/cFFFF00%U/p。",t.STR_PARTNER_APPLY_SUCCESS_WAIT="申请结婚成功，请耐心等待对方回应！",t.STR_UNPARTNER="你还没有结婚！",t.STR_PARTNER_DEL="离婚",t.STR_PARTNER_DEL_ASK="你是否决定与/c00FF00%U/p解除伴侣关系？\n解除伴侣后将失去以下效果：\n1.伴侣同时在线时，获得经验/cFFFF001.1/p倍（包括任务所获得经验）。\n2.伴侣间/cFFFF00传送/p无需使用传送石。",t.STR_PARTNER_DEL_SUCCESS="离婚成功！",t.STR_OPEN_CONNECT_SOCKET_ERROR="Socket连接中，http为什么还打开??",t.STR_OPEN_CONNECT_WAIT_LOAD="连接中,请耐心等候...",t.STR_OPEN_CONNECT_TIME_OUT="连接超时%U",t.STR_RECEIVE_DATA="接收数据",t.STR_TITLE="标题",t.STR_ESCORT_MISSION="押镖任务",t.STR_JOINCOUNTRYHANDLE="申请入国",t.STR_CREATE_FAIL="创建失败,数组越界",t.STR_EVERT_DAY="日常",t.STR_ACTIVITY_LIST="活动列表",t.STR_CONG_GET_NEW_PET="恭喜你获得了新宠物",t.STR_PET_EXP_ADD="宠物经验 +",t.STR_PET_GROW_LV="宠物成长等级",t.STR_CU="铜",t.STR_BAG_FULL="背包已满",t.STR_BAG_WILL_FULL="背包将满",t.STR_HP_UNDER_QUARTER="HP低于25%",t.STR_GET_BUFFER_INFO="获得BUFF%U\n",t.STR_ERROR_CODE_INFO="%U,错误码%U",t.STR_ADD_TEAM_INFO="%U已经加入%U的队伍",t.STR_LEAVE_TEAM_INFO="%U已经离开%U的队伍",t.STR_GAME_NOTICE="游戏公告",t.STR_SHOW_MAP_SET_GUIDE="跳图加载资源过大，建议在/cffff00'系统'/p->/cffff00'游戏设置'/p->/cffff00'画面设置'/p里将/cffff00<地图资源>/p设置为/cffff00简单/关闭/p，既省流量又流畅！",t.STR_TEAM_MISSION_TO_MEM="【完成任务/c00ff00%U/p】%U",t.STR_TEAM_ACCEPT_MISSION_TO_MEM="【接取任务/c00ff00%U/p】%U",t.STR_UPDATE_LV_EXP="/cFFFF00经验 +%U/p\n",t.STR_UPDATE_LV_EXP2="/cFFFF00传奇经验 +%U/p\n",t.STR_CONG_UPDATE_LV="/c00FF00恭喜你升了%U级/p",t.STR_CONG_UPDATE_LV2="/c00FF00恭喜你升了传奇等级%U级/p",t.STR_SP_POINT="技能点",t.STR_CP_POINT="属性点",t.STR_MISSION_REWARD_HONOR2="贡献度%U\n",t.STR_MISSION_REWARD_CITY_PRO="城市繁荣度%U\n",t.STR_MISSION_REWARD_CITY_ARMY2="城市军力%U\n",t.STR_MISSION_REWARD_COUNTRY_LAND2="国家土地%U\n",t.STR_MISSION_COUNTRY_PROSPERITY="国家繁荣度%U\n",t.STR_MISSION_COUNTRY_PEOPLE="国家民众数%U\n",t.STR_MISSION_COUNTRY_WOOD="国家木材%U\n",t.STR_MISSION_COUNTRY_STONE="国家石材%U\n",t.STR_MISSION_COUNTRY_IRON="国家铁矿%U\n",t.STR_MISSION_COUNTRY_ARMY="国家军力%U\n",t.STR_MERCENARY_TIME_OUT="您的佣兵<%U>雇佣时间已过！",t.STR_PLAYER_SHOP_SELL_NULL="摆摊期间没有卖出物品！",t.STR_PLAYER_SHOP_OVER="摆摊结束",t.STR_PLAYER_SHOP_REPLACE="摊位物品被购买!",t.STR_PLAYER_SHOP_COST="[%U] %U共花费%U买走你的%U\n",t.STR_PLAYER_SHOP_ALL="总计:%U",t.STR_GOOD_PROVIDE_SUCCESS_INFO="成功供应物品%U个,获得%U",t.STR_GOOD_PURCHASE_GET_INFO="成功提取收购到的物品%U个",t.STR_COUNTRY_NOTIFY_ADD="你成功加入国家%U！",t.STR_COUNTRY_NOTIFY_QUIT="你已经被踢出国家！",t.STR_ACHIEVE_GAIN_REWARD_NUM="你一共领取了%U个成就奖励!\n",t.STR_ACHIEVE_GAIN_REWARD_SP="获得成就点数/cFFFF00%U/p\n",t.STR_ACHIEVE_GAIN_REWARD_TITLE="获得成就称号:/c00FF00%U/p\n",t.STR_ACHIEVE_GAIN_REWARD_BAG_FULL="你的背包已满,部分奖励无法领取,请重新整理背包再领取!",t.STR_ACHIEVE_GAIN_REWARD="成就奖励",t.STR_COUNTRY_WAR_ENTER_FAIL="进入国战初始化失败！",t.STR_REMEMBER_SAFE_LOCK_PWD="请谨记安全锁密码：%U",t.STR_SAFE_LOCK_REMOVE_SUCCESS="解除安全锁成功！",t.STR_VIEW_MAP_NEED_PORTAL_STONE="/cFFFF00(需要传送石头)/p",t.STR_GIVE_UP_PATHFINDING="放弃寻路",t.STR_GIVE_UP_PATHFINDING_ASK="是否放弃自动寻路？",t.STR_NETWORK_INSTABILITY="网络不稳定, 重发[%U]",t.STR_HTTP_TRY_OPEN_WAIT="尝试连接2,请耐心等候...",t.STR_ON="开",t.STR_OFF="关",t.STR_CUTOFF_PROXY_WAIT="切换代理(%U),请耐心等候...",t.STR_RANK_CHOICE_RANKTYPE="其他排行",t.STR_RANK_CHOICE_RANKSUBTYPE="查看选项",t.STR_RANK_CHOICE_RANKMY="我的排行",t.STR_PHOTO_TAB_POPULARITY="人气",t.STR_PHOTO_TAB_CURRENT="当前",t.STR_PHOTO_TAB_NEWEST="最新",t.STR_ACTOR_BUY_CHOICE_JOB="职业筛选",t.STR_ACTOR_BUY_CHOICE_SEX="性别筛选",t.STR_ACTOR_BUY_CHOICE_TYPE="条件筛选",t.STR_ACTOR_BUY_CHOICE_NAME="名字搜索",t.STR_SEE_ACHIEVE_ALL="所有成就",t.STR_SEE_ACHIEVE_COMP="成就对比",t.STR_EXPLAIN="说明",t.STR_WORLD_CHAT_ROOM="聊天室",t.STR_INTEGRAL="积分",t.STR_QUIT_ARENA="退出竞技场",t.STR_QUIT_TEAMBOSS="退出副本",t.STR_UNIONLIB_UNION_LIB_VIEW="查看势力",t.STR_UNIONLIB_UNION_LIB_ADD_APPLY="申请加入势力",t.STR_SHOP_ITEM_USE_MONEY_BUY_ASK="购买/cFFFF00%U/p个,需消耗/cff0000%U/p ,是否确定？",t.STR_ARMYCAMP_APPLY_WAR="申请参战",t.STR_ARMYSOLDIER_FIGHT_SOLDIER="国战成员列表",t.STR_ARMYSOLDIER_TYPE_MY_APPLY="士兵申请列表",t.STR_ARMYSOLDIER_TYPE_HELP_APPLY="援军申请列表",t.STR_ARMYSOLDIER_FIGHT_SOLDIER2="国战成员",t.STR_ARMYSOLDIER_TYPE_MY_APPLY2="士兵申请",t.STR_ARMYSOLDIER_TYPE_HELP_APPLY2="援军申请",t.STR_MENU_SELECT="筛选",t.STR_MENU_ALL_YES="全部同意",t.STR_MENU_ALL_NO="全部拒绝",t.STR_WAR_BUILD="%U建筑",t.STR_WAR_ARMY_MENU="我的军队",t.STR_WAR_QUIT_MENU="退出战场",t.STR_WAR_ADD_ARMY="加入军队",t.STR_WAR_ARMY_SELECT="筛选军队",t.STR_PHOTO_ALBUMS_ENTER="进入相册",t.STR_PHOTO_ALBUMS_PLAYER="玩家菜单",t.STR_CHOICE_BACKGROUND="选择背景",t.STR_PLAYERCARD_STYLE="选择风格",t.STR_PLAYERCARD_SIGN="修改签名",t.STR_PLAYERCARD_MAKE="生成名片",t.STR_ASSIGNED="指派",t.STR_ASSIGNED_MEMBERS="指派该成员",t.STR_ASSIGNED_MEMBERS_DEL="取消该成员",t.STR_ASSIGNED_MEMBERS_FINISH="完成指派",t.STR_COUNTRY_ISSIGN_MEM_CHOOSE="筛选成员",t.STR_COUNTRY_ISSIGN_MEM_CHOOSE_R="筛选官阶",t.STR_COUNTRY_MISSION_PUBLISH="发布选中任务",t.STR_ENTER_COUNTRY="进入国家",t.STR_COUNTRY_DONATE_MENU="捐献物资",t.STR_REMOVE="拆除",t.STR_AGREE_APPLY="同意申请",t.STR_DISAGREE_APPLY="拒绝申请",t.STR_PUBLISH_MISSION="发布任务",t.STR_ASSIGNED_MISSION="指派任务",t.STR_TOMORROW_MISSION="明日任务",t.STR_TODAY_MISSION="今日任务",t.STR_OPEN_RECRUIT="开放招募",t.STR_CLOSE_RECRUIT="关闭招募",t.STR_ADJUST_TAX_RATE="调整税率",t.STR_TAX_RATE="国家税率(0-100)",t.STR_ADJUST_ENTER_TAX_RATE="调整入境税",t.STR_GET_ACHIEVE_PAY_ASK="您目前还不可以领取充值成就，是否要进行充值？",t.STR_MY_COUNTRY="我的国家",t.STR_COUNTRY_WAR="国家战争",t.STR_AFFICHE_MODIFY="修改公告",t.STR_QUIT_COUNTRY="退出国家",t.STR_WAR_DECLARE="宣战",t.STR_RETURN_MIAN_VIEW="返回主界面",t.STR_DEL_ROLE="删除角色",t.STR_RECOVE_ROLE="恢复角色",t.STR_RECOVE_DEL="恢复删除",t.STR_ATTRIBUTE="属性",t.STR_ACHIEVE="成就",t.STR_MONSTER_LIST_VIEW="怪物图鉴",t.STR_PHOTO="照片",t.STR_PLAYERCARD="名片",t.STR_POPULARITY_ALBUMS_LIST="人气相册",t.STR_ENTRY_PHOTO="进入拍照",t.STR_MAIL_BOX="邮箱",t.STR_CITY="城市",t.STR_GAME_ACTIVITY_LIST="游戏活动",t.STR_GAME_INFODATA_LIST="游戏攻略",t.STR_ROLE_LIST="角色列表",t.STR_GAME_SET="游戏设置",t.STR_SYSTEM_MOVE="脱离卡死",t.STR_RANK="排行榜",t.STR_NEW_MESSAGE="新消息",t.STR_BAG="背包",t.STR_MANOR="领地",t.STR_NOTICE="公告",t.STR_MAP="地图",t.STR_GET_ALL_REWARD="领取全部奖励",t.STR_PLAYER_HANG_SOLD="角色挂售",t.STR_ENRY_ATTACK="进入攻击",t.STR_CHARCTER="人物",t.STR_EQUIP="装备",t.STR_EMAIL="邮件",t.STR_PET="宠物",t.STR_REVIEW="视察",t.STR_CHAT_INPUT="聊天输入",t.STR_QUIT_ESCORT="退出押镖",t.STR_BUY_OPERATE="购买操作",t.STR_HANG_SOLD_OPERATE="挂售操作",t.STR_SUPPLY_LIST="供应列表",t.STR_MY_SUPPLY="我要供应",t.STR_ORDER_RELEASING="发布订单",t.STR_MY_ORDER="我的订单",t.STR_LEAVE="离开",t.STR_SEE="查看",t.STR_JOIN="加入",t.STR_DEL_PHOTO="删除照片",t.STR_TOP="顶",t.STR_TREAD="踩",t.STR_COMMENT="评论",t.STR_MORE_COMMENT="更多评论",t.STR_DEL_PHOTO_SAY_COMMENT_INFO="%U的评论",t.STR_MORE_OPERATE="更多操作",t.STR_LEARN_SKILL_LV="学习%U级",t.STR_LEARN_SKILL_LV_SUCCESS="恭喜您成功学习%U级",t.STR_LEARN_BEGIN="开始学习",t.STR_REST="休息",t.STR_PET_SET_FIGHT="出战",t.STR_DETAIL="详细",t.STR_PROP="道具",t.STR_EMPLOY="雇佣",t.STR_KICK_OUT="解雇",t.STR_FREE_PET="放生",t.STR_CHANGE_NAME="改名",t.STR_BUY="购买",t.STR_STALL_END="结束摆摊",t.STR_SALES_RECORD="销售记录",t.STR_DISMISS="解散",t.STR_KICK="踢人",t.STR_ASCENSION_CAPTAIN="提升队长",t.STR_LEAVE_TEAM="离开队伍",t.STR_PARTICULARS="详情",t.STR_TYPE="类型",t.STR_GRADE="品质",t.STR_LEVEL="等级",t.STR_SEEK="搜索",t.STR_CANCEL_HANG_SELL="取消挂售",t.STR_HANG_SELL="挂售",t.STR_GOOD_SUPPLY_NOW_HAVE_NUM="(现有%U个)",t.STR_SUPPLY="供应",t.STR_EXTRACTION_ORDER="提取订单",t.STR_CANCEL_ORDER="取消订单",t.STR_EXCHANGE_TREASURY="兑现金库",t.STR_ENTRY_CITY="进入个人城市",t.STR_SKYARENA_INIT_FAIL="天空竞技场初始化失败！",t.STR_SKYARENA_NOW_LAYER_INFO="第%U层守护者",t.STR_SKYARENA_EXIT_TITLE="离开天空竞技场",t.STR_SKYARENA_EXIT_ASK="你确定要离开天空竞技场吗？",t.STR_SKYARENA_END="天空竞技场已经结束！",t.STR_SKYARENA_BATTLE_FAIL_INFO="挑战失败。挑战守护者失败不会有任何损失，你可以选择继续挑战。",t.STR_SKYARENA_BATTLE_WIN_INFO="恭喜你成功打败了守护者，现在你进入了天空竞技场的/cFFFF00第%U层/p，/cFFFF00%U/p挡在了你的面前，只有击倒他才能够继续前进！",t.STR_SKYARENA_BATTLE_WIN_ALL_INFO="恭喜你成功打败了天空竞技场的所有挑战者！今天的天空竞技场已经结束请明天再来。",t.STR_SCHEDULE="进度",t.STR_ENEMY_STATUS="敌情",t.STR_CHALLENGE="挑战",t.STR_SKYARENA_FIRST_ENTER_INFO="欢迎你来到天空竞技场，你正在竞技场中的/cFFFF00第 %U 层/p，只有打败本层的守护者，你才能获得挑战下一层的资格继续前进。\n\n天空竞技场中每获得每一场胜利可获得/cFFFF001点挑战积分/p，使用挑战积分可换取丰富奖励。",t.STR_ATT_BUFF_GUIDE_ADD_SP_KEY="请先点击/c00ff00“+”/p进行/c00ff00加点/p",t.STR_ATT_BUFF_GUIDE_ADD_SP="请先点击/c00ff00“+”/p进行/c00ff00加点/p",t.STR_CHANGE_ATT_DESC_INFO="属性变化如下：\n",t.STR_CHANGE_ATT_DESC_HPMAX="生命上限",t.STR_CHANGE_ATT_DESC_MPMAX="法力上限",t.STR_SPEED="速度",t.STR_CHANGE_ATT_DESC_ATK_STR="劈砍攻击力",t.STR_CHANGE_ATT_DESC_ATK_AGI="穿刺攻击力",t.STR_CHANGE_ATT_DESC_ATK_MAGIC="魔法攻击力",t.STR_CHANGE_ATT_DESC_DEF_STR="劈砍防御力",t.STR_CHANGE_ATT_DESC_DEF_AGI="穿刺防御力",t.STR_CHANGE_ATT_DESC_DEF_MAGIC="魔法防御力",t.STR_CHANGE_ATT_DESC_DODGE="闪避",t.STR_CHANGE_ATT_DESC_WIL="状态抵抗",t.STR_CHANGE_ATT_TOUGH="伤害减免",t.STR_CHANGE_INSIGHT="洞察",t.STR_NEED_MONEY_ARRAY="/cFFFF00（需要扣除%U，上限扣%U)/p",t.STR_CHANGE_ATT_ASK="您确定要这样分配吗?\n",t.STR_ATTRIBUTE_INFO="属性描述",t.STR_ATTR_INTEGRAL="荣誉积分",t.STR_ATTR_ARENA="竞技积分",t.STR_SKY_ATTR_ARENA="天空挑战积分",t.STR_PLAYER_LEVEL2="传奇经验",t.STR_COMMON="普通",t.STR_ATTR_POSITION="地位",t.STR_STORE_NUM="仓库格数",t.STR_KILL_COUNT="杀怪数",t.STR_PK_WIN_COUNT="PK胜利数",t.STR_PK_WIN_RATE="PK胜率",t.STR_MASTER_AND_APPRENTICE="师徒",t.STR_ATTR_TITLE="称号",t.STR_ATTR_REINFORCEMENTS="援军",t.STR_PASSIVE_SKILL="被动技能",t.STR_ACTIVE_SKILL="主动技能",t.STR_ROUND_SKILL_TITLE="自动技能",t.STR_ROUND_SKILL="自动释放",t.STR_SKILL_ORDER="(顺序%U)",t.STR_ATTR_SPEED="出手速度",t.STR_ATTR_LEVEL2="传奇等级",t.STR_ATTR_BORNSTATUS="天生状态",t.STR_ATTR_EQUIP_ATK="武器伤害",t.STR_ATTR_ATK="攻击力",t.STR_ATTR_ATK_TIME="攻击次数",t.STR_ATTR_HIT_RATE="物理命中",t.STR_ATTR_HIT_MAGIC="魔法命中",t.STR_ATTR_CRITICAL="致命点",t.STR_ATTR_WIL="状态抵抗",t.STR_ATTR_TOUGH="伤害减免",t.STR_ATTR_BLOCK="格挡",t.STR_ATTR_BRK="破甲",t.STR_ATTR_INSIGHT="洞察",t.STR_ATTR_DEF_FIELD="法力护盾",t.STR_ATTR_BACK="反击",t.STR_ATTR_MAGIC_BACK="魔法反馈",t.STR_ATTR_GET_HP="生命吸收",t.STR_ATTR_GET_MP="法力吸收",t.STR_ATTR_MAGIC_PEN="魔法穿透",t.STR_ATTR_FORCE_HIT="强制命中率",t.STR_ATTR_AUTO_HP="自动恢复生命",t.STR_ATTR_AUTO_MP="自动恢复法力",t.STR_ATTR_STR="力量",t.STR_ATTR_CON="体质",t.STR_ATTR_AGI="敏捷",t.STR_ATTR_ILT="智力",t.STR_ATTR_WIS="感知",t.STR_NO_DESC="尚无描述！",t.STR_NEW_TITLE_INFO="使用新的称号，可让角色获得称号附带的所有属性。",t.STR_IDENTIFY_RESULT="鉴定结果",t.STR_FUNCTION_NOT_OPEN="该功能暂未开放！",t.STR_ALL_INFO_DUR_BROCKEN="请尽快到附近的装备店修理装备!\n以下装备损坏：",t.STR_PK_OTHER_WAIT_INFO="已经向对方发出决斗申请，请耐心等候！",t.STR_AROUND="周围",t.STR_SERVER_NULL="服务器为空！",t.STR_SERVER_STATE_STOP="服务器维护中！",t.STR_VERIIFICATION_CODE="验证码",t.STR_VERSION_CHECK="版本校验...",t.STR_LOAD_ROLE="加载角色...",t.STR_BAG_HAVE_NULL_CAN_IDENTIFY="背包中没有可以被鉴定的物品!",t.STR_REMOVE_EQUIP="解除装备",t.STR_GEM="宝石",t.STR_EQUIP_BIND="装备绑定",t.STR_EQUIP_COMPARE="装备比较",t.STR_EQUIP_IDENTIFY="装备鉴定",t.STR_USE="使用",t.STR_DROP="丢弃",t.STR_PUT_COUNTRY_STORE="放入国库",t.STR_EXCHANGE="兑换",t.STR_DEL="删除",t.STR_DOWN_SHOP="下架",t.STR_UP_SHOP="上架",t.STR_ITME_CHANGE_PRICE="调整单价",t.STR_ITEM_INTEGRAL_CANCEL="取下分解",t.STR_ITEM_INTEGRAL_SURE="放入分解",t.STR_PUBLISH_COUNTRY_MISSION_ASK="您选择的任务与操作前的有所不同，是否发布任务？",t.STR_GAME_SETTING="游戏设定",t.STR_GAME_SETTING_ASK="您确定要这样设置吗?\n",t.STR_PHOTO_COMMENT_INFO="%U的评论",t.STR_ALL="所有",t.STR_PET_EXPLAIN="宠物说明",t.STR_PET_SET_FIGHT_NEED_INFO="需要%U才可让宠物出战。\n",t.STR_PET_EXPLAIN_INFO="%U宠物当前成长经验为 %U 点。\n宠物当前成长等级为%U 级。\n成长等级提升会自动增强宠物属性。\n成长影响宠物的成长经验值，每次升级可随机获得1~3点经验值；领悟影响宠物领悟天赋技能的几率，天赋技能无法通过技能所获得。",t.STR_PLAYER_EMAIL="玩家邮件",t.STR_MISSION_REWARD_TITLE="任务奖励",t.STR_PAY_EMAIL="充值邮件",t.STR_SERVICE_SYSTEM_EMAIL="客服/系统邮件",t.STR_HAVE_SEND_EMAIL="已发邮件",t.STR_BACK_RECEIPT_EMAIL="退回/回执邮件",t.STR_WORLD_USE_ITEM_INFO="/cFF0000已使用(剩%U)/p",t.STR_PLAYERLIST_ENTER_GAME_NULL="该位置没有角色可以登入!",t.STR_STATUS_TEMP_DEL="该角色处于临时删除状态，需要先恢复删除!",t.STR_OFFLINE_MISSION_NOW="离线任务执行中",t.STR_OFFLINE_MISSION_DEL_ASK="离线任务还在继续，继续登录将会取消离线任务，是否继续？",t.STR_PLAYERLIST_DEL_NULL="该位置没有角色可以操作!",t.STR_BUIND_INFO="建筑信息",t.STR_COUNTRY_BOOK_COOL_WAIT="指令书冷却中,请耐心等待!",t.STR_ACTOR_BUY_PLAYER_SUCCESS="已成功购买角色，/c00ff00返回角色列表后可使用新角色。/p",t.STR_CROSS_POSITION="(跨职)",t.STR_CHALLENGE_MISSION="挑战任务",t.STR_CHALLENGE_MISSION_FINISH="%U(完成)",t.STR_CHALLENGE_MISSION_COOL="挑战任务(冷却中)",t.STR_CHALLENGE_MISSION_CAN_ACCEPT="挑战任务(可接)",t.STR_FINISH_ALL="全部完成",t.STR_MAIN_LINE_MISSION="主线任务",t.STR_TYPE_GOOD_PURCHASE_MENU="交易所 - 收购物品列表",t.STR_TYPE_GOOD_LIST_BUY="交易所-购买列表",t.STR_UNIT_PRICE="单价",t.STR_TYPE_GOOD_LIST_SUPPLY="交易所-供应列表",t.STR_KIND="种类",t.STR_NAME_MATCH="名称匹配",t.STR_NO_ITEM="无物品",t.STR_SEE_ORDER="查看订单",t.STR_SEX_MALE="无名侠客",t.STR_SEX_FEMALE="无名法师",t.STR_PAY_FUNCTION_ERROR="充值功能出错!",t.STR_EQUIP_BAG_BIG_PANEL_NULL="背包操作容器不存在!",t.STR_BAG_OPERATE_MAIL_TITLE="邮件附件选择",t.STR_INSERT="插入",t.STR_OPERATE_GOOD_SUPPLY_TITLE="我要供应物品",t.STR_INSERT_ITEM="插入物品",t.STR_STORAGE_BAG_BIG_PANEL_NULL="仓库背包容器不存在!",t.STR_STORAGE_TITLE_TITLE_NULL="仓库标题不存在!",t.STR_OPEN_STORAGE_FAIL="打开仓库失败!",t.STR_STORAGE_PLAYER="个人仓库",t.STR_STORAGE_COUNTRY="国家仓库",t.STR_STORAGE_COUNTRY_SYSTEM="国家福利",t.STR_GAME_AREALIST_NULL="没有服务器列表可以进入!",t.STR_SEE_ACHIEVE_TITLE="%U的成就",t.STR_ACHIEVE_ALL="所有成就",t.STR_ACHIEVE_COMPARE="成就对比",t.STR_ACHIEVE_POINT_INFO="%U点",t.STR_ACHIEVE_DATA_NULL="无法获取称号管理数据!",t.STR_ESCORT_ROB_LIST_NULL="没有队伍正在执行任务!",t.STR_ESCORT_TEAM="押镖队伍",t.STR_ARMY_TEAM="军队队伍",t.STR_RANK_SOLDIER="士兵",t.STR_STATUS_SELL="挂售中",t.STR_STATUS_NUSELL="未出售",t.STR_COUNTRY_BOOK_NUM="指令书X%U",t.STR_SET_FIGHT_NOW="出战中",t.STR_SET_REST_NOW="休息中",t.STR_JOB="职业",t.STR_DEL_FRIEND="删除好友",t.STR_CANCEL_SCREEN="取消屏蔽",t.STR_TEAM_NULL="你还没有开始组队!",t.STR_NEAR_PLAYER="周围玩家",t.STR_CREATE_GAMEUI_FAIL="创建游戏设定UI失败!",t.STR_PAY_MENU="充值",t.STR_REFRESH_MENU="刷新",t.STR_REQUEST_LIST_MENU="请求列表",t.STR_BIND_PHONE_MENU="绑定手机",t.STR_SEARCH_ALBUMS_CURRENT="本日人气",t.STR_SEARCH_ALBUMS_NEW="最新上传",t.STR_SEARCH_ALBUMS_RANK="人气排行",t.STR_MY_COMMENT="我的评论",t.STR_NOT_HAVE_COMMENT="暂时还没有该玩家相册的评论！",t.STR_PHOTO_COMMAND_SAY_CON="%U楼、%U：%U",t.STR_MY_PHOTO_ALBUM="我的相册",t.STR_PLAYER_PHOTO="%U的照片",t.STR_MONSTER_BOOK_ALL_OPEN="怪物图鉴(已完成)",t.STR_MONSTER_BOOK="怪物图鉴",t.STR_MONSTER_BOOK_DESC="%U\n技能描述:%U",t.STR_SEX="性别",t.STR_SORT="排序",t.STR_DATE="日期",t.STR_HELP_DATA_LIST="攻略指南",t.STR_BACK_TO_PRE_PAGE="返回上一页",t.STR_PET_LIST="宠物列表",t.STR_MERCENARY_LIST="佣兵列表",t.STR_MERCENARY_LIST_SHOP="佣兵商店",t.STR_MERCENARY_SHOP_DATA_NULL="佣兵商店暂时没有可以雇佣的佣兵!",t.STR_PET_MERCENARY_LIST="宠物和佣兵列表",t.STR_STRENGTH="实力",t.STR_SHOP_COMBIN="合成商店",t.STR_COMBIN="合成",t.STR_SHOP_INTEGRAL="积分商店",t.STR_SHOP_ARENA="竞技商店",t.STR_SHOP_SKYARENA="天空商店",t.STR_ITEM_ARENA="物品商店",t.STR_SHOPITEM_GOOD_SELL="交易所-售出操作",t.STR_EQUIP_INTEGRAL="装备分解",t.STR_BAG_NULL="背包为空",t.STR_MAIL_SYSTEM="邮件系统",t.STR_WRITE="写信",t.STR_EMAIL_TITLE="邮件标题",t.STR_ADD_PROP="<添加道具>",t.STR_COUNTRY_OBJ_NULL="国家对象不存在!",t.STR_COUNTRY_ASSIGN_MEMBER_ERROR="服务器指派成员数据出异常!",t.STR_COUNTRY_ASSIGN_MEMBER_CHOICE="已选%U",t.STR_COUNTRY_MISSION_POINT="任务点:%U",t.STR_SEQUENCE="%U次",t.STR_MAIL_TYPE_SEND="取回邮件",t.STR_MAIL_TYPE_BACK="退还邮件",t.STR_MAIL_TYPE_RECEIPT="回执邮件",t.STR_RECEIVE_EMAIL="收邮件",t.STR_PRESS_5KEY="按5键",t.STR_PRESS_HERE="按这里",t.STR_DONATION="捐赠物资",t.STR_OPREATE="操作",t.STR_COUNTRY_MEMBER_NUM="%U人",t.STR_COOL="冷却中",t.STR_CARRAY_OUT="执行",t.STR_COUNTRY_COMMAND_REMAINDER="剩余%U",t.STR_COUNTRY_REMAINDER_COOL="%U冷却",t.STR_EXECUTEABLE="可执行",t.STR_COUNTRY_DATE_COOL="%U天冷却",t.STR_WAR_ARMY_TAB_READY_FAIL="预备军加入出战军后才可战斗！",t.STR_MANAGER_ARMY="管理军队",t.STR_SEE_ARMY="查看军队",t.STR_WAR_EMBATTLE="视察战况",t.STR_WAR_ARMY_LIST="战场军队",t.STR_WAP_SCHEME="军事谋略",t.STR_WAR_SOLDIER_ARRAY="战场排行",t.STR_WAR_VIEW_COUNTRY_INFO="国家信息",t.STR_GET_WAR_COMMAND_ERROR="获取战场计谋列表出错",t.STR_COMMAND="指令%U",t.STR_POSITION="位置",t.STR_DURABLE="耐久",t.STR_ARMY_PRIVATES="军队/士兵",t.STR_WARSTATUS_TAB_REPORT="回合战况",t.STR_AGAINST_ARMY="出战军",t.STR_CREATE_UNION_INFO="您的国家并不属于任何势力。您可以创建自己的势力，或者通过“其它势力”选择一个适合自己的势力加入。（加入势力需要国家等级达到5级或以上）\n\n创建势力需国家国库支付：（国家等级8级或以上）\n%U指令书%U",t.STR_UNIONLIB_MYUNION_LIB_VIEW="%U(敌)",t.STR_UNION_APPLY_HELP_APPLY="申请援军",t.STR_UNION_KICK_OUT_MENBER="踢出势力",t.STR_UNION_CHANGE="转让盟主",t.STR_UNION_LEAVE="退出势力",t.STR_UNION_COUNTRY_ASSAULT="%U (攻)",t.STR_UNION_COUNTRY_GARRISON="%U (守)",t.STR_SEE_COUNTRY="查看国家",t.STR_MULTIPLEDATA_ERROR="页缓存错误,key:string =%U还没有初始化!",t.STR_WORLD_SHOP="商城",t.STR_ENTER_WORLD_SHOP="进入商城",t.STR_BBS="社区论坛",t.STR_GAMEUPGRADE_JUMPMAP_ASK="传送到该地图需要消耗传送石/cFF0000%U/p个，是否确认?\n/c00ff00(注：VIP不消耗传送石。)/p",t.STR_GAMEUPGRADE_LOCK_EXP="解锁等级%U级",t.STR_CLICK_TRANSFER="点击传送",t.STR_IS_FINISH="已完成",t.STR_NOT_FINISH="未完成",t.STR_BORNSTATUS_INFO_HAVE="宠物拥有以下天生状态：\n",t.STR_BORNSTATUS_INFO_NO="该宠物并不拥有天生状态。",t.STR_KING_COMMAND_COUNT_INFO="请输入指令书数量(数字)",t.STR_KING_COMMAND_COUNT_INFO_ER="请输入 10-100 之间的指令书数量。",t.STR_KING_COMMAND_COUNT_EXPLAIN="国家通过任务获得的繁荣度，会根据您输入的指令书数量获得提升，最多可提升200%。增幅效果维持24小时。",t.STR_KING_COMMAND_USE_SUCCESS="您已成功使用“繁荣增幅”指令。您的国家通过任务可获得的繁荣度将提高/c00FF00%U%/p。效果维持24小时。",t.STR_COUNTRYBOSS_QUIT="离开国家攻城",t.STR_COUNTRYBOSS_QUIT_ASK="你确定要离开国家攻城吗？",t.STR_COUNTRYBOSS_QUIT_END="国家攻城已经结束,您的上一场战斗未能获得贡献度，请尽快离开副本！",t.STR_COUNTRYBOSS_SELECT_OTHER="你的军队已经成功攻陷该城池！\n请前往另一个据点继续战斗，你的盟军需要支援！",t.STR_COUNTRYBOSS_FAIL="战斗失败！你被迫撤离敌方据点！请大虾重新再来！",t.STR_COUNTRYBOSS_BATTLE_LOG="敌人军队：%U\n获得国家贡献度%U点\n%U",t.STR_COUNTRYBOSS_FIRST_INFO="请选择敌军据点进行进攻。战斗胜利可获得国家贡献度。攻陷敌人城池可获得国家资源！",t.STR_COUNTRYBOSS_BOSS_ASK="你击败了敌人的军队，\n%U据点还剩余/cFFFFFF%U/p 组敌人军队。",t.STR_COUNTRYBOSS_GET_SCORE="获得%U点国家贡献度。\n",t.STR_COUNTRYBOSS_BOSS_OVER_ASK="你的军队已经成功攻陷敌人城池！\n%U请前往下一个据点继续战斗，你的盟军需要支援！",t.STR_COUNTRYBOSS_GET_RESOURCE="掠夺敌人资源：\n%U\n",t.STR_COUNTRYBOSS_ASK_INFO="该据点资源:\n%U\n还剩下剩余%U军队驻守",t.STR_COUNTRYBOSS_FIGHT="攻占据点",t.STR_COUNTRYBOSS_FIGHT_CONTINUE="继续攻占",t.STR_COUNTRYBOSS_POWER_INFO="/c00FF00国家祝福 (+5%所有基础属性)/p\n",t.STR_COUNTRYBOSS_BATTLE_INFO="战报",t.STR_COUNTRYBOSS_BATTLE_RESOURCE="战场资源",t.STR_COUNTRYBOSS_RESOURCE_INFO="战场资源:\n铁矿 %U/%U\n石头 %U/%U\n木材 %U/%U\n黄金 %U/%U\n铜币  %U/%U",t.STR_TYPE_MAIL_SEND="发件人",t.STR_COUNTRY_BOSS_ACTIVITY_INFO="国家已经激活国家攻城，所有国民请在系统开启活动后，准时参战。",t.STR_ATTR_KEEPOUT_ATK_TIME="免伤护盾",t.STR_SHOP_PETCOMPOSITE="宠物合成商店",t.STR_PETCOMPOSITE_IMMEDIATELY="立即合成",t.STR_PETCOMPOSITE_SELECT_DATA="选择材料",t.STR_PETCOMPOSITE_NEED_INFO="合成不同品质的%U需要以下材料：",t.STR_RAMDOM="随机",t.STR_SET_SELECT="设置选择",t.STR_CANCEL_SELECT="取消选择",t.STR_ENSURE_COMPOSITE="确认合成",t.STR_ENSURE_COMPOSITE_INFO="确认使用以下：\n%U\n\n合成后作为材料的宠物将会消失，不可返还。\n%U",t.STR_COMPOSITE_INFO="选择合成材料 %U",t.STR_OPERATE="操作",t.STR_AD_LOAD_FAIL="广告初始化失败",t.STR_IMG_CHECK_LOGIN="验证码验证",t.STR_IMG_CHECK_LOGIN_INFO="请输入上图所示验证码:",t.STR_RAIDERS="攻略",t.STR_PET_RAIDERS_GRASP="可领悟技能",t.STR_PLAYER_RAIDERS_APPLY="职业攻略申请",t.STR_PLAYER_RAIDERS_APPLY_ENTR="请输入你角色修炼的方向，例如：暴力出手流（不超过七个中文字）。",t.STR_PLAYER_RAIDERS_APPLY_INFO="无论你是门派正统还是剑走偏锋，只要你足够强力并且愿意自荐，你就有机会成为“推荐之星”，成为万人楷模。\n注：GM推荐后，其他玩家均可查看你的加点和技能学习情况。仅限战斗属性历史排行榜前50的玩家自我推荐。",t.STR_RAIDERS_COMMENT="点评",t.STR_TOURST_SUBMIT_MISSION_INFO="游客账号无法获得经验，是否注册为正式账号？",t.STR_PLAYER_RAIDERS_RECOMMEND="官方推荐",t.STR_GM_COMMENT="GM评论",t.STR_ATTR_HP="生命上限",t.STR_ATTR_MP="法力上限",t.STR_STEP="级",t.STR_UNLIMITED="无限制",t.STR_CREATE_COUNTRY_DESC="你目前还没有加入任何国家，你可以/cFFFF00创建/p自己的国家，或者通过/cFFFF00国家列表/p选择一个适合自己的国家加入。（10级后可加入其它国家，创建自己的国家需要角色达到15级以上。）",t.STR_PET_NAME_NOTNULL="宠物名字不能为空",t.STR_PET_NAME_TOOLONG="您输入名字太长",t.STR_PET_LEVEL_LOW="您的宠物等级太低",t.STR_ACHIEVE_GET="领取",t.STR_ACHIEVE_POINT="成就点数:",t.STR_NO_ACHIEVE="该玩家还没有获得成就！",t.STR_NET_ERROR="网络异常，请重新登录！",t.STR_POWER="战力:",t.STR_POWER_UP="/cffffff战力提升/p /c00ff00%U↑/p",t.STR_POWER_DOWN="/cffffff战力下降/p /cff0000%U↓/p",t.SETTING_TAB_EXPLAIN_1="/cffff00宠物战斗指令/p\n开启: 手动下达宠物指令\n关闭: 宠物自动攻击",t.SETTING_TAB_EXPLAIN_2="/cffff00人名显示/p\n简单: 玩家名字默认显示\n详细: 玩家名字高亮显示/cff0000(影响流畅)/p\n关: 不显示玩家名字/c00ff00(流畅)/p\n/cffff00小地图/p\n简单: 不显示怪物\n关: 不显示小地图/c00ff00(流畅)/p\n/cffff00玩家显示/p\n简单: 只显示自己周围的玩家\n详细: 显示全部玩家/cff0000(影响流畅)/p\n 关: 不显示其它玩家/c00ff00(流畅)/p\n/cffff00地图资源/p\n默认: 豪华的地图表现\n简单: 简单的地图元素/c00ff00(省流量,流畅)/p\n 关: 不显示地图元素/c00ff00(省流量,流畅)/p\n/cffff00动画资源/p\n默认: 丰富的NPC,怪物动画\n简单: 节省版的动画/c00ff00(省流量,流畅)/p\n/cffff00角色形象/p\n默认: 丰富换装的形象\n简单: 小比例,简单动作的形象/c00ff00(省内存,流畅)/p\n/cffff00玩家数量/p\n全部: 地图玩家全加载\n50或20人: 加载地图不超过50或20个玩家(/c00ff00省流量/p,/cff0000但影响交互/p)\n人多并需要交互时,可以设置<全部>,其它时候推荐设置<50/20>人",t.COUNTRY_BUILDING_LEVEL_UP="已达到当前版本最高等级",t.LEVEL_REWARD_SUB_TITLE="等级 LV:",t.LEVEL_REWARD_CAN_GET="可领取",t.LEVEL_REWARD_NO_GET="未达成",t.EXCHANGE_MONEY_CONST="剩余炼金次数：",t.EXCHANGE_MONEY_BEGIN="开始炼金",t.EXCHANGE_MONEY_SUCCESS="炼金成功，获得铜币/c00ff00%U/p",t.EXCHANGE_MONEY_NO_COUNT="次数已用完",t.EXCHANGE_MONEY_DESC="每天 /cffcc000点/p 刷新次数，/cffcc00vip/p 可提升炼金次数上限",t.EXCHANGE_MONEY_COST_FREE="免费",t.SHARE_SHARE="立即分享",t.SHARE_RPOMPT="请输入分享内容",t.SHARE_SHARE_NULL="分享内容不能为空",t.SHARE_SHARE_SUCCESS="分享成功，获得",t.SHARE_DESC_1758="分享有礼",t.SAVE_TO_DESKTOP="保存桌面成功，获得",t.FOLLOW_GET_REWARD="成功领取",t.ACTOR_BUY_INPUT_PROMPT="请输入价格",t}();__reflect(GameText.prototype,"GameText");var SceneBase=function(t){function e(e){var n=t.call(this)||this;return n._resUrls=e,n}return __extends(e,t),e.prototype.show=function(){!this._resUrls||this._resUrls.length<=0?this.showHelper():(PanelManager.openWaitForServer(),nato.loadGroup(this._resUrls,this.showHelper,this))},e.prototype.close=function(t){void 0===t&&(t=!1),PanelManager.closeScene(t)},e.prototype.showHelper=function(){PanelManager.openScene(this),PanelManager.closeWaitForServer()},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initComponent(),this.initListeners()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeListeners()},e.prototype.onClose=function(){this.close()},e.prototype.initComponent=function(){},e.prototype.initListeners=function(){this._clickHelper=new ClickHelper(this),this._clickHelper.regClickFunc("btnClose",this.onClose,this)},e.prototype.removeListeners=function(){},e}(ComponentBase);__reflect(SceneBase.prototype,"SceneBase");var ItemData=function(){function t(){this.quantity=0,this.durability=0,this.attachDone=0,this.attachPower=0,this.attachValue=0,this.slotPos=-1,this.status=0,this.expireTime=-1,this.isMoney=!1,this.moneyType=0,this.power1=0,this.powerValue1=0,this.powerValue1add=0,this.power2=0,this.powerValue2=0,this.leafCount=0,this.powerValue2add=0,this.power3=0,this.powerValue3=0,this.powerValue3add=0,this.bindPower1=0,this.bindPowerValue1=0,this.bindPowerValue1add=0,this.bindPower2=0,this.bindPowerValue2=0,this.bindPowerValue2add=0,this.isUpgradeItem=!1,this.power4=0,this.powerValue4=0,this.powerValue4add=0,this.power5=0,this.powerValue5=0,this.powerValue5add=0,this.power6=0,this.powerValue6=0,this.powerValue6add=0,this.power7=0,this.powerValue7=0,this.powerValue7add=0,this.id=0,this.name="",this.icon=0,this.bagIcon=0,this.info="",this.type=0,this.grade=0,this.reqLv=0,this.reqStr=0,this.reqCon=0,this.reqAgi=0,this.reqIlt=0,this.reqWis=0,this.atkType=0,this.atk_time=0,this.atkMin=0,this.atkMax=0,this.def_str=0,this.def_agi=0,this.def_mag=0,this.hitrate=0,this.round=0,this.area=0,this.ownTime=0,this.durMax=0,this.price=0,this.autoBinding=0,this.stackNum=0,this.attachCount=0,this.itemSet=0,this.itemSetPower=0,this.itemSetPowerValue=0,this.skillDesc="",this.vipLevelReq=0,this.ascensionStar=0,this.star=0,this.upgradeAscensionStar=0,this.upgradeStar=0,this.ascensionStarRate=0,this.fashIcon1=0,this.fashIcon2=0,this.fashIcon3=0,this.enchantPower1=0,this.enchantPowerValue1=0,this.enchantPower2=0,this.enchantPowerValue2=0}return t.prototype.getItemSetID=function(){return 255&this.itemSet},t.prototype.getItemHitRate=function(){return 255&this.hitrate},t.fromMailBytes=function(e){var n=new t;return n.id=65535&e.getShort(),n.quantity=e.getByte(),n.name=e.getString(),n.bagIcon=e.getUnsignedByte(),n.grade=e.getByte(),n.type=e.getByte(),n.slotPos=e.getShort(),n.isUpgradeItem=e.getBoolean(),n},t.fromBytesEdit=function(e,n){t.fromBytesAtts1(e,n),t.fromBytesAtts2(e,n)},t.fromBytes=function(e){var n=new t;return t.fromBytesAtts1(n,e),t.fromBytesAtts2(n,e),n},t.fromBytesAtts1=function(t,e){if(null!=t&&(t.quantity=e.getShort(),t.durability=e.getShort(),t.attachDone=e.getByte(),t.attachPower=e.getUnsignedByte(),t.attachValue=e.getShort(),t.slotPos=e.getShort(),t.status=e.getByte(),t.isTimeItem()))if(t.slotPos==PlayerBag.SPIRIT_POS){var n=e.getInt();t.setExpireTime(n)}else t.setExpireTime(65535&e.getShort())},t.prototype.setExpireTime=function(t){this.expireTime=Tool.getTime()+1*t*Tool.MILLIS_IN_MINUTE},t.fromBytesForMicroReward=function(e){var n=new t;return n.type=e.getByte(),n.quantity=e.getByte(),n.name=e.getString(),n.bagIcon=e.getByte(),n.grade=e.getByte(),n.info=e.getString(),n.type==Define.ITEM_TYPE_ARMOR_TRANSPORT?n.icon=e.getShort():n.type==Define.ITEM_TYPE_ARMOR_FASHION&&(n.fashIcon1=e.getInt(),n.fashIcon2=e.getInt(),n.fashIcon3=e.getInt()),n},t.fromBytesForSevenDayReward=function(e){var n=new t;return n.type=e.getByte(),n.quantity=e.getByte(),n.name=e.getString(),n.bagIcon=e.getByte(),n.grade=e.getByte(),n.info=e.getString(),n.type==Define.ITEM_TYPE_ARMOR_TRANSPORT||n.type==Define.ITEM_TYPE_PET?n.icon=e.getShort():n.type==Define.ITEM_TYPE_ARMOR_FASHION&&(n.fashIcon1=e.getInt(),n.fashIcon2=e.getInt(),n.fashIcon3=e.getInt()),n},t.fromBytesAtts2=function(e,n){if(null!=e){e.type=n.getByte();var i=e.getItemClass();if(3==i)return e.id=Define.ITEM_ID_PET,e.name=n.getString(),e.bagIcon=n.getUnsignedByte(),e.info=n.getString(),e.grade=n.getByte(),e.autoBinding=n.getByte(),e.icon=n.getShort(),e.reqLv=n.getByte(),void(e.vipLevelReq=n.getByte());switch(e.id=65535&n.getShort(),e.name=n.getString(),e.bagIcon=n.getUnsignedByte(),e.info=n.getString(),e.grade=n.getByte(),e.autoBinding=n.getByte(),e.stackNum=n.getByte(),i){case 1:e.icon=n.getShort(),e.ownTime=65535&n.getShort(),e.durMax=n.getUnsignedByte(),e.price=n.getInt(),e.attachCount=n.getByte(),e.itemSet=n.getByte(),e.reqLv=n.getByte(),e.reqStr=n.getShort(),e.reqCon=n.getShort(),e.reqAgi=n.getShort(),e.reqIlt=n.getShort(),e.reqWis=n.getShort(),t.fromItemAscensionStarInfo(e,n),e.hitrate=n.getByte(),e.vipLevelReq=n.getByte(),e.enchantPower1=n.getShort(),e.enchantPowerValue1=n.getShort(),e.enchantPower2=n.getShort(),e.enchantPowerValue2=n.getShort(),e.isUpgradeItem=n.getBoolean(),e.isUpgradeItem&&(e.power4=n.getShort(),e.powerValue4=n.getShort(),e.power5=n.getShort(),e.powerValue5=n.getShort(),e.power6=n.getShort(),e.powerValue6=n.getShort(),e.power7=n.getShort(),e.powerValue7=n.getShort()),e.upgradeAscensionStar=n.getByte(),e.upgradeStar=n.getByte();break;case 2:e.icon=n.getShort(),e.ownTime=65535&n.getShort(),e.durMax=n.getUnsignedByte(),e.price=n.getInt(),e.attachCount=n.getByte(),e.itemSet=n.getByte(),e.reqLv=n.getByte(),e.reqStr=n.getShort(),e.reqCon=n.getShort(),e.reqAgi=n.getShort(),e.reqIlt=n.getShort(),e.reqWis=n.getShort(),t.fromItemAscensionStarInfo(e,n),e.type==Define.ITEM_TYPE_ARMOR_FASHION&&(e.fashIcon1=n.getInt(),e.fashIcon2=n.getInt(),e.fashIcon3=n.getInt()),e.vipLevelReq=n.getByte(),e.enchantPower1=n.getShort(),e.enchantPowerValue1=n.getShort(),e.enchantPower2=n.getShort(),e.enchantPowerValue2=n.getShort(),e.isUpgradeItem=n.getBoolean(),e.isUpgradeItem&&(e.power4=n.getShort(),e.powerValue4=n.getShort(),e.power5=n.getShort(),e.powerValue5=n.getShort(),e.power6=n.getShort(),e.powerValue6=n.getShort(),e.power7=n.getShort(),e.powerValue7=n.getShort()),e.upgradeAscensionStar=n.getByte(),e.upgradeStar=n.getByte();break;case 4:e.reqLv=n.getByte(),e.ownTime=65535&n.getShort(),e.durMax=n.getUnsignedByte(),e.price=n.getInt(),e.round=n.getByte(),e.area=n.getByte(),e.power1=n.getUnsignedByte(),e.powerValue1=n.getShort(),e.power2=n.getUnsignedByte(),e.powerValue2=n.getShort(),e.leafCount=n.getShort(),e.vipLevelReq=n.getByte(),Define.POWER_ENCHANT_ITEM==e.power1&&(e.power3=n.getUnsignedByte(),e.powerValue3=n.getShort());break;case 6:e.price=n.getInt(),e.power1=n.getUnsignedByte(),e.powerValue1=n.getShort();break;case 5:case 7:e.price=n.getInt()}}},t.fromItemAscensionStarInfo=function(t,e){var n=t.getItemClass();t.def_str=e.getShort(),t.def_agi=e.getShort(),t.def_mag=e.getShort(),t.power1=e.getUnsignedByte(),t.powerValue1=e.getShort(),t.power2=e.getUnsignedByte(),t.powerValue2=e.getShort(),t.power3=e.getUnsignedByte(),t.powerValue3=e.getShort(),t.skillDesc=e.getString(),t.bindPower1=e.getUnsignedByte(),t.bindPowerValue1=e.getShort(),t.bindPower2=e.getUnsignedByte(),t.bindPowerValue2=e.getShort(),1==n&&(t.atkType=e.getByte(),t.atk_time=e.getByte(),t.atkMin=e.getShort(),t.atkMax=e.getShort()),t.ascensionStar=e.getByte(),t.star=e.getByte()},t.fromItemAscensionUpgradeStarInfo=function(t,e){t.power4=e.getShort(),t.powerValue4=e.getShort(),t.power5=e.getShort(),t.powerValue5=e.getShort(),t.power6=e.getShort(),t.powerValue6=e.getShort(),t.power7=e.getShort(),t.powerValue7=e.getShort(),t.upgradeAscensionStar=e.getByte(),t.upgradeStar=e.getByte()},t.fromIdentify1PowerBytes=function(t,e){t.powerValue1=e.getShort(),t.powerValue1add=e.getShort(),t.powerValue2=e.getShort(),t.powerValue2add=e.getShort(),t.powerValue3=e.getShort(),t.powerValue3add=e.getShort(),t.bindPowerValue1=e.getShort(),t.bindPowerValue1add=e.getShort(),t.bindPowerValue2=e.getShort(),t.bindPowerValue2add=e.getShort()},t.fromIdentifyUpgradePowerBytes=function(t,e){t.power4=e.getShort(),t.powerValue4=e.getShort(),t.power5=e.getShort(),t.powerValue5=e.getShort(),t.power6=e.getShort(),t.powerValue6=e.getShort(),t.power7=e.getShort(),t.powerValue7=e.getShort()},t.newFromIdentifyUpgradePowerBytes=function(t,e){t.power4=e.getShort(),t.powerValue4=e.getShort(),t.powerValue4add=e.getShort(),t.power5=e.getShort(),t.powerValue5=e.getShort(),t.powerValue5add=e.getShort(),t.power6=e.getShort(),t.powerValue6=e.getShort(),t.powerValue6add=e.getShort(),t.power7=e.getShort(),t.powerValue7=e.getShort(),t.powerValue7add=e.getShort()},t.oldFromIdentifyUpgradePowerBytes=function(t,e){t.power4=e.getShort(),t.powerValue4=e.getShort(),t.power5=e.getShort(),t.powerValue5=e.getShort(),t.power6=e.getShort(),t.powerValue6=e.getShort(),t.power7=e.getShort(),t.powerValue7=e.getShort(),t.powerValue4add=e.getShort(),t.powerValue5add=e.getShort(),t.powerValue6add=e.getShort(),t.powerValue7add=e.getShort()},t.fromIdentify2PowerBytes1=function(t,e,n){t.power1=e.getUnsignedByte(),t.powerValue1=e.getShort(),n&&(t.powerValue1add=e.getShort()),t.power2=e.getUnsignedByte(),t.powerValue2=e.getShort(),n&&(t.powerValue2add=e.getShort()),t.bindPower1=e.getUnsignedByte(),t.bindPowerValue1=e.getShort(),n&&(t.bindPowerValue1add=e.getShort()),t.bindPower2=e.getUnsignedByte(),t.bindPowerValue2=e.getShort(),n&&(t.bindPowerValue2add=e.getShort())},t.fromIdentify2PowerBytes2=function(t,e){t.powerValue1=e.getShort(),t.powerValue1add=e.getShort(),t.powerValue2=e.getShort(),t.powerValue2add=e.getShort(),t.powerValue3=e.getShort(),t.powerValue3add=e.getShort(),t.bindPowerValue1=e.getShort(),t.bindPowerValue1add=e.getShort(),t.bindPowerValue2=e.getShort(),t.bindPowerValue2add=e.getShort()},t.newFromIdentify2PowerBytes2=function(t,e){t.powerValue4=e.getShort(),t.powerValue4add=e.getShort(),t.powerValue5=e.getShort(),t.powerValue5add=e.getShort(),t.powerValue6=e.getShort(),t.powerValue6add=e.getShort(),t.powerValue7=e.getShort(),t.powerValue7add=e.getShort()},t.fromIdentify3PowerBytes1=function(t,e,n){t.power1=e.getUnsignedByte(),t.powerValue1=e.getShort(),n&&(t.powerValue1add=e.getShort()),t.power2=e.getUnsignedByte(),t.powerValue2=e.getShort(),n&&(t.powerValue2add=e.getShort()),t.bindPower1=e.getUnsignedByte(),t.bindPowerValue1=e.getShort(),n&&(t.bindPowerValue1add=e.getShort()),t.bindPower2=e.getUnsignedByte(),t.bindPowerValue2=e.getShort(),n&&(t.bindPowerValue2add=e.getShort())},t.fromIdentify3PowerBytes2=function(t,e){t.powerValue1=e.getShort(),t.powerValue1add=e.getShort(),t.powerValue2=e.getShort(),t.powerValue2add=e.getShort(),t.powerValue3=e.getShort(),t.powerValue3add=e.getShort(),t.bindPowerValue1=e.getShort(),t.bindPowerValue1add=e.getShort(),t.bindPowerValue2=e.getShort(),t.bindPowerValue2add=e.getShort()},t.prototype.isNeedWaitForSkill=function(){if(1==this.isHasSkill())return!0;var t=PlayerBag.getEquipPosByType(this.type);if(null!=t&&t.length>0){var e=xself;if(null!=e&&null!=e.bag)for(var n=0;n<t.length;n++){var i=e.bag.getItem(t[n]);if(null!=i&&i.isHasSkill())return!0}}return!1},t.prototype.isHasSkill=function(){return 0==Tool.isNullText(this.skillDesc)},t.prototype.getItemClass=function(){return this.type==Define.ITEM_TYPE_PET?3:this.type==Define.ITEM_TYPE_GEM?6:this.type==Define.ITEM_TYPE_TASK||this.type==Define.ITEM_TYPE_BUILD_MATERIAL||this.type==Define.ITEM_TYPE_SPECEAIL?5:this.type>=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD&&this.type<=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND||this.type>=Define.ITEM_TYPE_WEAPON_BALL&&this.type<=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN?1:this.type>=Define.ITEM_TYPE_BATTLE_USE&&this.type<=Define.ITEM_TYPE_NOT_BATTLE_USE||this.type==Define.ITEM_TYPE_SKILL_BOOK?4:2},t.prototype.getPrice=function(){return this.price},t.prototype.getDurMax=function(t){if(null==t)return this.durMax;var e=this.durMax;if(0==this.isEquited())return e;if(this.slotPos==PlayerBag.WEAPON_LEFT_POS||this.slotPos==PlayerBag.WEAPON_RIGHT_POS)e=t.addWeaponSkillDamageOrDur(e,this.slotPos);else{var n=t.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_EQUIP_ARMOR_DUR_PERCENT);(n+=t.getBagEquipPowerValue(Define.POWER_EQUIP_ARMOR_DUR_PERCENT))>0&&(e+=Math.floor(e*n/100))}return e},t.prototype.isCanRepair=function(){if(0==this.isCanEquip())return!1;if(this.type==Define.ITEM_TYPE_PET)return!1;var t=this.getDurMax(xself);return t>0&&this.durability<t},t.prototype.getRepairCost=function(){var t=this.getDurMax(xself)-this.durability;0>t&&(t=0);var e=Math.floor(this.reqLv/10)+1,n=t*(this.grade+1)*e;return n*(1+[0,0,.5,.8,1,1,1.4,1.4,1.4][Math.floor((this.reqLv-1)/10)])>>0},t.prototype.setItemDataTo=function(t){t.durability=this.durMax,t.attachDone=this.attachDone,t.attachPower=this.attachPower,t.attachValue=this.attachValue,t.id=this.id,t.name=this.name,t.icon=this.icon,t.bagIcon=this.bagIcon,t.info=this.info,t.type=this.type,t.grade=this.grade,t.reqLv=this.reqLv,t.reqStr=this.reqStr,t.reqCon=this.reqCon,t.reqAgi=this.reqAgi,t.reqIlt=this.reqIlt,t.reqWis=this.reqWis,t.atkType=this.atkType,t.atk_time=this.atk_time,t.atkMin=this.atkMin,t.atkMax=this.atkMax,t.def_str=this.def_str,t.def_agi=this.def_agi,t.def_mag=this.def_mag,t.hitrate=this.hitrate,t.round=this.round,t.area=this.area,this.setItemPowerDataTo(t),t.skillDesc=this.skillDesc,t.ownTime=this.ownTime,t.durMax=this.durMax,t.price=this.price,t.autoBinding=this.autoBinding,t.stackNum=this.stackNum,t.attachCount=this.attachCount,t.itemSet=this.itemSet,t.itemSetPower=this.itemSetPower,t.itemSetPowerValue=this.itemSetPowerValue,t.fashIcon1=this.fashIcon1,t.fashIcon2=this.fashIcon2,t.fashIcon3=this.fashIcon3,t.vipLevelReq=this.vipLevelReq,t.ascensionStar=this.ascensionStar,t.upgradeAscensionStar=this.upgradeAscensionStar,t.upgradeStar=this.upgradeStar,t.star=this.star,t.enchantPower1=this.enchantPower1,t.enchantPowerValue1=this.enchantPowerValue1,t.enchantPower2=this.enchantPower2,t.enchantPowerValue2=this.enchantPowerValue2,t.status=this.status},t.prototype.setItemPowerDataTo=function(t){t.power1=this.power1,t.powerValue1=this.powerValue1,t.powerValue1add=this.powerValue1add,t.power2=this.power2,t.powerValue2=this.powerValue2,t.powerValue2add=this.powerValue2add,t.power3=this.power3,t.powerValue3=this.powerValue3,t.powerValue3add=this.powerValue3add,t.bindPower1=this.bindPower1,t.bindPowerValue1=this.bindPowerValue1,t.bindPowerValue1add=this.bindPowerValue1add,t.bindPower2=this.bindPower2,t.bindPowerValue2=this.bindPowerValue2,t.bindPowerValue2add=this.bindPowerValue2add,t.isUpgradeItem=this.isUpgradeItem,t.power4=this.power4,t.powerValue4=this.powerValue4,t.powerValue4add=this.powerValue4add,t.power5=this.power5,t.powerValue5=this.powerValue5,t.powerValue5add=this.powerValue5add,t.power6=this.power6,t.powerValue6=this.powerValue6,t.powerValue6add=this.powerValue6add,t.power7=this.power7,t.powerValue7=this.powerValue7,t.powerValue7add=this.powerValue7add},t.prototype.setVarItemDataTo=function(t){null!=t&&(t.quantity=this.quantity,t.durability=this.durability,t.attachDone=this.attachDone,t.attachPower=this.attachPower,t.attachValue=this.attachValue,t.slotPos=this.slotPos,t.status=this.status,t.expireTime=this.expireTime)},t.prototype.get=function(t){if(9==t)return this.durability>0?this.type:Define.BACK_ERROR_DUR;if(this.durability<=0)return 0;if(this.isTimeItem()&&this.isTimeItemTimeOut())return 0;if(this.isVipItem()&&this.isVipItemTimeOut())return 0;switch(t){case 5:return this.atkMin;case 6:return this.atkMax;case 7:return this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?-1:this.atk_time;case 8:return this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?-1:this.atkType;case 1:return this.def_str;case 2:return this.def_agi;case 3:return this.def_mag;case 4:return this.getItemHitRate();case 10:return this.getItemSetID()}return 0},t.prototype.getPowerDesc=function(){var t="";return this.power1>0&&(""!=t&&(t+="\n"),t+=Define.getPowerDesc(this.power1,this.powerValue1)),this.power2>0&&(""!=t&&(t+="\n"),t+=Define.getPowerDesc(this.power2,this.powerValue2)),this.power3>0&&(""!=t&&(t+="\n"),t+=Define.getPowerDesc(this.power3,this.powerValue3)),t},t.prototype.getEquipPower1AndPower2=function(){var e=0;return e+=t.getpowerValueAdd(this.powerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power1)),(e+=t.getpowerValueAdd(this.powerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power2)))+t.getpowerValueAdd(this.powerValue3,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power3))},t.prototype.getEquipPower=function(){if(this.durability<=0)return 0;if(this.isTimeItem()&&this.isTimeItemTimeOut())return 0;if(this.isVipItem()&&this.isVipItemTimeOut())return 0;var e=0;return e+=this.getEquipPower1AndPower2(),this.isBinded()&&(e+=t.getpowerValueAdd(this.bindPowerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower1)),e+=t.getpowerValueAdd(this.bindPowerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower2))),e+=this.attachValue,e+=this.enchantPowerValue1,e+=this.enchantPowerValue2,this.isBinded()&&t.isUpgradeItemOpen&&(e+=t.getpowerValueAdd(this.powerValue4,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power4)),e+=t.getpowerValueAdd(this.powerValue5,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power5)),e+=t.getpowerValueAdd(this.powerValue6,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power6)),e+=t.getpowerValueAdd(this.powerValue7,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power7))),e},t.prototype.getPowerValue=function(e){if(this.durability<=0)return 0;if(this.isTimeItem()&&this.isTimeItemTimeOut())return 0;if(this.isVipItem()&&this.isVipItemTimeOut())return 0;var n=0;return n+=this.getPower1AndPower2(e),this.isBinded()&&(this.bindPower1==e&&(n+=t.getpowerValueAdd(this.bindPowerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower1))),this.bindPower2==e&&(n+=t.getpowerValueAdd(this.bindPowerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower2)))),this.attachPower==e&&(n+=this.attachValue),this.enchantPower1==e&&(n+=this.enchantPowerValue1),this.enchantPower2==e&&(n+=this.enchantPowerValue2),this.isBinded()&&t.isUpgradeItemOpen&&(this.power4==e&&(n+=t.getpowerValueAdd(this.powerValue4,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power4))),this.power5==e&&(n+=t.getpowerValueAdd(this.powerValue5,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power5))),this.power6==e&&(n+=t.getpowerValueAdd(this.powerValue6,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power6))),this.power7==e&&(n+=t.getpowerValueAdd(this.powerValue7,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power7)))),n},t.prototype.getPower1AndPower2=function(e){var n=0;return this.power1==e&&(n+=t.getpowerValueAdd(this.powerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power1))),this.power2==e&&(n+=t.getpowerValueAdd(this.powerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power2))),this.power3==e&&(n+=t.getpowerValueAdd(this.powerValue3,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power3))),n},t.prototype.getPowerDescByID=function(t,e){return t==Define.POWER_COMPOSITE?"":Define.getPowerDesc(t,e)},t.prototype.getWeaponFlashType=function(){return this.attachDone>=19?4:this.attachDone>=15?3:this.attachDone>=10?2:this.attachDone>=7?1:0},t.prototype.isBinded=function(){return!!this.isAutoBinding()||(2&this.status)>0},t.prototype.isAutoBinding=function(){return 0!=this.autoBinding},t.prototype.setBinded=function(){this.status|=2},t.prototype.isShopLocked=function(){return(4&this.status)>0},t.prototype.setShopLocked=function(t){this.setStatusBit(t,4)},t.prototype.isSelling=function(){return(256&this.status)>0},t.prototype.setSelling=function(t){this.setStatusBit(t,256)},t.prototype.isMailSelect=function(){return(2048&this.status)>0},t.prototype.setMailSelect=function(t){this.setStatusBit(t,2048)},t.prototype.isIntegral=function(){return(4096&this.status)>0},t.prototype.setIntegral=function(t){this.setStatusBit(t,4096)},t.prototype.isEnchant=function(){return(8192&this.status)>0},t.prototype.setEnchant=function(t){this.setStatusBit(t,8192)},t.prototype.setStatusBit=function(t,e){t?this.status|=e:this.status&=~e},t.prototype.isStatusBit=function(t){return 0!=(this.status&t)},t.prototype.isNotOperate=function(){return this.isShopLocked()||this.isSelling()},t.prototype.isCanEquip=function(){return this.type>=Define.ITEM_TYPE_ARMOR_HEAD&&this.type<=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND||this.type==Define.ITEM_TYPE_PET||this.type>=Define.ITEM_TYPE_WEAPON_BALL&&this.type<=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN},t.prototype.isEquipClass=function(){return 2==this.getItemClass()||1==this.getItemClass()},t.prototype.isWeapon=function(){return 1==this.getItemClass()},t.prototype.isArmor=function(){return this.type==Define.ITEM_TYPE_ARMOR_HEAD||this.type==Define.ITEM_TYPE_ARMOR_CLOTHES||this.type==Define.ITEM_TYPE_ARMOR_TROUSERS||this.type==Define.ITEM_TYPE_ARMOR_WAIST||this.type==Define.ITEM_TYPE_ARMOR_SHOULDER||this.type==Define.ITEM_TYPE_ARMOR_SHOES||this.type==Define.ITEM_TYPE_ARMOR_HAND},t.prototype.isEquited=function(){return this.slotPos>=PlayerBag.EQUIP_POS_START&&this.slotPos<PlayerBag.EQUIP_POS_END},t.prototype.isCanAttach=function(){return this.attachCount>0},t.prototype.isStackable=function(){return 1!=this.isTimeItem()&&(!this.isShopLocked()&&this.stackNum>1)},t.prototype.isPetType=function(){return this.type==Define.ITEM_TYPE_PET},t.prototype.isPetEquip=function(){return this.slotPos==PlayerBag.PET_POS},t.prototype.isVIPSlot=function(){return this.slotPos==PlayerBag.SPIRIT_POS},t.prototype.isVipItem=function(){return this.vipLevelReq>0},t.prototype.isPetEgg=function(){return this.power1==Define.POWER_PET_EGG},t.prototype.isOpenStoreItem=function(){return this.power1==Define.POWER_OPEN_STORE},t.prototype.isCountryBook=function(){return this.id==Define.ITEM_ID_COMMAND_BOOK},t.prototype.isChangeNameItem=function(){return this.id==Define.ITEM_ID_CHANGE_NAME},t.prototype.isRepairItem=function(){return this.id==Define.ITEM_ID_REPAIR},t.prototype.isPetCanUseItem=function(){return this.isPetAgeItem()||this.isPetResetItem()||this.isPetExpItem()||this.isPetAddSkill()||this.isPetSkillBook()||this.isSkillPetItem()||this.isPetSealSkillBook()},t.prototype.isPetCanUseItem2=function(){return this.isPetAgeItem()||this.isPetExpItem()||this.isPetSkillBook()||this.isSkillPetItem()||this.isPetSealSkillBook()},t.prototype.isSkillBook=function(){return this.type==Define.ITEM_TYPE_SKILL_BOOK},t.prototype.isPetSkillBook=function(){return this.type==Define.ITEM_TYPE_SKILL_BOOK&&this.power1==Define.POWER_SKILL_SCROLL_PET},t.prototype.isPetSealSkillBook=function(){return this.power1==Define.POWER_SKILL_BOOK_PET},t.prototype.isPetAddSkill=function(){return this.id==Define.ITEM_ID_PET_ADD_SKILL},t.prototype.isPetReset1=function(){return this.id==Define.ITEM_ID_PET_RESET},t.prototype.isPetReset2=function(){return this.id==Define.ITEM_ID_PET_RESET2},t.prototype.isPetAgeItem=function(){return this.id==Define.ITEM_ID_PET_AGE},t.prototype.isPetResetItem=function(){return this.id==Define.ITEM_ID_PET_RESET||this.id==Define.ITEM_ID_PET_RESET2},t.prototype.isIdentifyScrollItem=function(){return this.id==Define.ITEM_ID_IDENTIFY_SCROLL||this.id==Define.ITEM_ID_IDENTIFY_SCROLL_BIND},t.prototype.isHighIdentifyScrollItem=function(){return this.id==Define.ITEM_ID_HIGH_IDENTIFY_SCROLL||this.id==Define.ITEM_ID_HIGH_IDENTIFY_SCROLL_BIND},t.prototype.isUpgradeIdentifyScrollItem=function(){return this.id==Define.ITEM_ID_UPGRADE_IDENTIFY_SCROLL||this.id==Define.ITEM_ID_UPGRAND_IDENTIFY_SCROLL_BIND},t.prototype.isUpgradeIntensifyScroll=function(){return this.id==Define.ITEM_ID_UPGRADE_INTENSIFY_SCROLL||this.id==Define.ITEM_ID_UPGRAND_INTENSIFY_SCROLL_BIND},t.prototype.isStarScroll=function(){return this.id==Define.ITEM_ID_STAR_SCROLL},t.prototype.isPetExpItem=function(){return this.power1==Define.POWER_PET_ADD_EXP},t.prototype.isTitleItem=function(){return this.power1==Define.POWER_POWER_TITLE},t.prototype.isPlayerExpItem=function(){return this.power1==Define.POWER_ADD_EXP},t.prototype.isCrystal=function(){return this.id==Define.ITEM_ID_CRYSTAL1||this.id==Define.ITEM_ID_CRYSTAL2||this.id==Define.ITEM_ID_CRYSTAL3||this.id==Define.ITEM_ID_CRYSTAL4||this.id==Define.ITEM_ID_CRYSTAL5},t.prototype.isMaigcCrystal=function(){return this.id==Define.ITEM_ID_MAGICCRYSTAL1||this.id==Define.ITEM_ID_MAGICCRYSTAL2||this.id==Define.ITEM_ID_MAGICCRYSTAL3||this.id==Define.ITEM_ID_MAGICCRYSTAL4||this.id==Define.ITEM_ID_MAGICCRYSTAL5},t.prototype.isMateria=function(){return this.type==Define.ITEM_TYPE_BUILD_MATERIAL},t.prototype.isCountryMateria=function(){return!!(this.isCountryWood()||this.isCountryStone()||this.isCountryIron())},t.prototype.isCountryWood=function(){return this.id==Define.ITEM_ID_WOOD||-1!=this.name.indexOf("碎木")},t.prototype.isCountryStone=function(){return this.id==Define.ITEM_ID_STONE||-1!=this.name.indexOf("碎石")},t.prototype.isCountryIron=function(){return this.id==Define.ITEM_ID_IRON||-1!=this.name.indexOf("碎矿")},t.prototype.isMagicArmor=function(){return 2==this.getItemClass()&&(0!=this.reqIlt||0!=this.reqWis)},t.prototype.isLightWeapon=function(){return this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD||this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE||this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY||this.type==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW||this.type==Define.ITEM_TYPE_WEAPON_BALL||this.type==Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF},t.prototype.isGem=function(){return this.type==Define.ITEM_TYPE_GEM},t.prototype.isChestItem=function(){return this.power1==Define.POWER_CHEST_LV1||this.power1==Define.POWER_CHEST_LV2||this.power1==Define.POWER_CHEST_LV3||this.power1==Define.POWER_CHEST_LV4||this.power1==Define.POWER_COLOR_BOX},t.prototype.isColorBox=function(){return this.power1==Define.POWER_COLOR_BOX},t.prototype.isIdentifyItem=function(){return(16&this.status)>0},t.prototype.isDestroy=function(){return this.durability<=0},t.prototype.isWillDestroy=function(){return this.durability<10},t.prototype.isTimeItem=function(){return(1&this.status)>0},t.prototype.isTimeItemTimeOut=function(){return(8&this.status)>0},t.prototype.isVipItemTimeOut=function(){return(64&this.status)>0},t.prototype.checkTimeItem=function(){this.isExpired()?this.status|=8:this.status&=-9},t.prototype.isExpired=function(){return!this.isVipItem()&&(!(this.expireTime<=0)&&!(this.expireTime-Tool.getTime()>0))},t.prototype.isChangeSexItem=function(){return this.id==Define.ITEM_ID_CHANGE_SEX},t.prototype.isCpPointAddItem=function(){return this.id==Define.ITEM_ID_CP_POINT_ADD},t.prototype.isSkillPlayerItem=function(){return this.id==Define.ITEM_ID_SKILL_PLAYER||Define.ITEM_ID_SKILL_PLAYER_BIND==this.id||this.id==Define.ITEM_ID_SKILL_PLAYER_2||Define.ITEM_ID_SKILL_PLAYER_2_BIND==this.id||this.id==Define.ITEM_ID_SKILL_PLAYER_3||Define.ITEM_ID_SKILL_PLAYER_3_BIND==this.id||this.id==Define.ITEM_ID_SKILL_PLAYER_4||Define.ITEM_ID_SKILL_PLAYER_4_BIND==this.id||this.id==Define.ITEM_ID_SKILL_PLAYER_5||Define.ITEM_ID_SKILL_PLAYER_5_BIND==this.id},t.prototype.isSkillPetItem=function(){return this.id==Define.ITEM_ID_SKILL_PET||Define.ITEM_ID_SKILL_PET_2==this.id},t.prototype.isSpPointAddItem=function(){return this.id==Define.ITEM_ID_SP_POINT_ADD},t.prototype.isProsperityDegreePointAddItem=function(){return this.id==Define.ITEM_ID_PROSPERITY_DEGREE_POINT_ADD},t.prototype.isCanUse=function(t){switch(t){case 1:if(this.type==Define.ITEM_TYPE_ANYTIME_USE||this.type==Define.ITEM_TYPE_NOT_BATTLE_USE||this.type==Define.ITEM_TYPE_SKILL_BOOK)return!0;break;case 2:if(this.type==Define.ITEM_TYPE_ANYTIME_USE||this.type==Define.ITEM_TYPE_BATTLE_USE)return!0;break;case 3:return!0}return!1},t.prototype.isRebornItem=function(){return this.power1==Define.POWER_RECOVER||this.power1==Define.POWER_RECOVER_PERCENT||(this.power2==Define.POWER_RECOVER||this.power2==Define.POWER_RECOVER_PERCENT)},t.prototype.getInfo=function(){return null==this.info||""==this.info||"0"==this.info?"":this.info},t.prototype.setInfo=function(t){this.info=t},t.isValidEquipRequire=function(t,e){var n=!0;if(null==t||null==e)return Define.NO;var i="",o=t.get(ModelConst.LEVEL);return o<e.reqLv&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_LEVEL,e.reqLv-o+""),n=!1),4==e.getItemClass()||((o=t.get(ModelConst.STR))<e.reqStr&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_STR,e.reqStr-o+""),n=!1),(o=t.get(ModelConst.CON))<e.reqCon&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_CON,e.reqCon-o+""),n=!1),(o=t.get(ModelConst.AGI))<e.reqAgi&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_AGI,e.reqAgi-o+""),n=!1),(o=t.get(ModelConst.ILT))<e.reqIlt&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_ILT,e.reqIlt-o+""),n=!1),(o=t.get(ModelConst.WIS))<e.reqWis&&(i+=Tool.manageStringU(GameText.STR_ITEM_REQ_WIS,e.reqWis-o+""),n=!1)),n?Define.OK:i=Tool.convertLastLinefeed(i)},t.isFitJob=function(t,e){return null!=t&&null!=e&&(0!=e.reqIlt||0!=e.reqWis?!!Define.isMagicJob(t.getJob()):0==e.reqAgi&&0==e.reqStr||!Define.isMagicJob(t.getJob()))},t.prototype.getAttachRateDesc=function(){return this.attachDone<3||this.isAttackBroken()?"100%":"50%"},t.prototype.getSkillDesc=function(){return Tool.isNullText(this.skillDesc)?GameText.STR_NOT_EFFECT:this.skillDesc},t.prototype.getItemSetDesc=function(t){var e=new StringBuffer,n=this.getItemSetID();if(0>=n)return"";var i=GameWorld.getSuit(n);if(null==i||i.length<=0)return"";var o=0;this.isEquited()&&null!=t&&null!=t.bag&&(o=t.bag.getEquipItemSetNum(n)),e.append(PowerString.makeColorString(GameText.STR_ITEM_SET_EFFECT,ColorUtils.COLOR_YELLOW));for(var a=0;a<i.length;){var r=i[a++],s=i[a++],l=i[a++],_=i[a++]>0,h=!1,u=ColorUtils.COLOR_GRAY;null!=t&&0==_&&o>=r&&(h=!0);var c=ColorUtils.COLOR_GRAY;null!=t&&_&&(t.getId()==xself.getId()?Tool.isVip(t)&&o>=r&&(h=!0):t.getVipLevel()>0&&o>=r&&(h=!0)),h&&(c=ColorUtils.COLOR_WHITE,u=ColorUtils.COLOR_GREEN);var T="";_&&(T=" ("+GameText.STR_VIP_ITEM_INFO+")"),e.append("\n"),e.append(PowerString.makeColorString(Tool.manageStringList(GameText.STR_ITEM_SET_NUM,[r+"",Define.getPowerDesc(s,l)]),u)),e.append(PowerString.makeColorString(T,c))}return e.toString()},t.prototype.getVipDesc=function(t){var e=Tool.manageStringU(GameText.getText(GameText.TI_LEVEL),this.vipLevelReq+"");1==this.vipLevelReq&&(e=GameText.STR_ITEM_DEDICATED);var n=null!=t&&t.getVipLevel()<this.vipLevelReq;return e=GameText.STR_VIP+e,n?PowerString.makeColorString(e,ColorUtils.COLOR_RED):e},t.getRewardItemListDesc=function(t){if(null==t)return"";for(var e=new StringBuffer,n=0;n<t.length;n++){var i=t[n];null!=i&&e.append(i.getRewardDesc()+"\n")}return e.toString()},t.prototype.getIconString=function(){return PowerString.makeRewardIconString(this.bagIcon,this.grade)},t.prototype.getRewardDesc=function(){return this.getNameInfo()},t.prototype.clearData=function(){this.quantity=0,this.durability=0,this.attachDone=0,this.attachPower=0,this.attachValue=0,this.slotPos=-1,this.status=0,this.expireTime=-1,this.power1=0,this.powerValue1=0,this.powerValue1add=0,this.power2=0,this.powerValue2=0,this.powerValue2add=0,this.power3=0,this.powerValue3=0,this.powerValue3add=0,this.bindPower1=0,this.bindPowerValue1=0,this.bindPowerValue1add=0,this.bindPower2=0,this.bindPowerValue2=0,this.bindPowerValue2add=0,this.isUpgradeItem=!1,this.power4=0,this.powerValue4=0,this.powerValue4add=0,this.power5=0,this.powerValue5=0,this.powerValue5add=0,this.power6=0,this.powerValue6=0,this.powerValue6add=0,this.power7=0,this.powerValue7=0,this.powerValue7add=0,this.id=0,this.name="",this.icon=0,this.bagIcon=0,this.info="",this.type=0,this.grade=0,this.reqLv=0,this.reqStr=0,this.reqCon=0,this.reqAgi=0,this.reqIlt=0,this.reqWis=0,this.atkType=0,this.atk_time=0,this.atkMin=0,this.atkMax=0,this.def_str=0,this.def_agi=0,this.def_mag=0,this.hitrate=0,this.round=0,this.area=0,this.ownTime=0,this.durMax=0,this.price=0,this.autoBinding=0,this.stackNum=0,this.attachCount=0,this.itemSet=0,this.itemSetPower=0,this.itemSetPowerValue=0,this.skillDesc="",this.vipLevelReq=0,this.ascensionStar=0,this.star=0,this.upgradeAscensionStar=0,this.upgradeStar=0,this.fashIcon1=0,this.fashIcon2=0,this.fashIcon3=0,this.enchantPower1=0,this.enchantPowerValue1=0,this.enchantPower2=0,this.enchantPowerValue2=0},t.isNotOKPower=function(t){return t==Define.POWER_IDENTIFY||t==Define.POWER_COMPOSITE},t.getpowerValueAdd=function(t,e,n,i,o){if(0==i||0==o)return t;if(0>=e)return t;if(0>=n)return t;var a=t;0>a&&(a*=-1);var r=Math.floor((a*e*n+50)/100),s=GZIP.toShort(r);return s+t>Tool.MAX_VALUE_short?s=Tool.MAX_VALUE_short:s+=t,s},t.prototype.usePower=function(t){return this.power2==Define.POWER_EXPIRE_TIME&&this.powerValue2>0?(this.power1==Define.POWER_EXP_BY_TIME||this.power1==Define.POWER_EXP_MISSION_BY_TIME||(t.power=this.power1,t.powerValue=this.powerValue1),void(PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateWorldIconPoint())):(Define.processWorldPower(t,this.power1,this.powerValue1),void Define.processWorldPower(t,this.power2,this.powerValue2))},t.isReplaceInlayGem=function(t){switch(t){case Define.POWER_STR:case Define.POWER_CON:case Define.POWER_AGI:case Define.POWER_ILT:case Define.POWER_WIS:break;default:return!1}return!0},t.prototype.isAscension=function(t){switch(t){case Define.POWER_RECOVER:case Define.POWER_SKILL_DAMAGE:case Define.POWER_SKILL_HITRATE:case Define.POWER_SELF_CRITICAL:case Define.POWER_SKILL_HIT_FORCE:case Define.POWER_SKILL_MAGIC_PENETRATION:case Define.POWER_SKILL_BRK_ARMOR:case Define.POWER_SKILL_REMOVE_STATUS:case Define.POWER_PET_DAMAGE:case Define.POWER_PET_HPMAX_PERCENT:case Define.POWER_PET_MPMAX_PERCENT:case Define.POWER_PET_STR_PERCENT:case Define.POWER_PET_CON_PERCENT:case Define.POWER_PET_AGI_PERCENT:case Define.POWER_PET_ILT_PERCENT:case Define.POWER_PET_WIS_PERCENT:case Define.POWER_RECOVER_PERCENT:case Define.POWER_OPEN_STORE:case Define.POWER_CHEST_LV1:case Define.POWER_CHEST_LV2:case Define.POWER_CHEST_LV3:case Define.POWER_COLOR_BOX:case Define.POWER_REQ_SLOT:case Define.POWER_TO_WORLDMAP:case Define.POWER_TO_GXGY:case Define.POWER_EXPIRE_TIME:case Define.POWER_RESET_MISSION:case Define.POWER_CHEST_KEY_LEVEL:case Define.POWER_PET_EGG:case Define.POWER_COSTUME:case Define.POWER_TRANSPORT:case Define.POWER_POWER_TITLE:case Define.POWER_GUARD_STR_ATTACK:case Define.POWER_GUARD_AGI_ATTACK:case Define.POWER_GUARD_MAGIC_ATTACK:case Define.POWER_GUARD_CURSE_ATTACK:case Define.POWER_GUARD_ALL_ATTACK:case Define.POWER_PET_ADD_EXP:case Define.POWER_ADD_EXP:case Define.POWER_IDENTIFY:case Define.POWER_COMPOSITE:case Define.POWER_SKILL_HP:case Define.POWER_SKILL_HP_PERCENT:case Define.POWER_SKILL_MP:case Define.POWER_SKILL_MP_PERCENT:case Define.POWER_SKILL_LIFE_ABSORPTION:case Define.POWER_SKILL_MANA_ABSORPTION:case Define.POWER_SKILL_TARGET_BACK:case Define.POWER_SKILL_TARGET_MAGIC_BACK:case Define.POWER_SKILL_TARGET_BLOCK:case Define.POWER_SKILL_TARGET_INSIGHT:case Define.POWER_SKILL_TARGET_WIL:case Define.POWER_SKILL_TARGET_TOUCH:case Define.POWER_GRARD_MASTER_STR_ATTACK:case Define.POWER_GRARD_MASTER_AGI_ATTACK:case Define.POWER_GRARD_MASTER_MAGIC_ATTACK:case Define.POWER_GRARD_MASTER_CURSE_ATTACK:case Define.POWER_GRARD_MASTER_ALL_ATTACK:case Define.POWER_PET_GRARD_STR_ATTACK:case Define.POWER_PET_GRARD_AGI_ATTACK:case Define.POWER_PET_GRARD_MAGIC_ATTACK:case Define.POWER_PET_GRARD_CURSE_ATTACK:case Define.POWER_PET_GRARD_ALL_ATTACK:case Define.POWER_SKILL_SCROLL:case Define.POWER_SKILL_SCROLL_PET:case Define.POWER_NEW_GET_PET:case Define.POWER_NEW_GET_ITEM:case Define.POWER_ENCHANT_ITEM:case Define.POWER_FORMATION_BOOK:case Define.POWER_CHEST_LV4:case Define.POWER_TURN_MONSTER_CARD:case Define.POWER_SKILL_BOOK_PET:break;default:return!0}return!1},t.prototype.isAttackBroken=function(){return(32&this.status)>0},t.prototype.setAttackBroken=function(t){this.status&=-33,t&&(this.status|=32)},t.prototype.getAttackPowerDesc=function(t){return 0!=this.attachPower&&0!=this.attachValue?Define.getPowerDesc(this.attachPower,this.attachValue)+(1==this.isAttackBroken()?"("+GameText.STR_ITEM_ATTACK_FAIL+")":1==t?Tool.manageStringU(GameText.STR_ITEM_ATTACK,this.attachDone+"/"+this.attachCount):Tool.manageStringU(GameText.STR_ITEM_ATTACK,this.attachDone+"")):""},t.prototype.getEnchantInfo=function(){var t="";return 0!=this.enchantPower1&&0!=this.enchantPowerValue1&&(t+=GameText2.STR_ENCHANT_ATTACH+": "+Define.getPowerDesc(this.enchantPower1,this.enchantPowerValue1)),0!=this.enchantPower2&&0!=this.enchantPowerValue2&&(0==(0!=this.enchantPower1&&0!=this.enchantPowerValue1)&&(t+=GameText2.STR_ENCHANT_ATTACH+": "),t+=" "+Define.getPowerDesc(this.enchantPower2,this.enchantPowerValue2)),t},t.prototype.itemUpgradeDesc=function(e){null==e&&(e=new Array);var n=4177151,i="";this.slotPos!=PlayerBag.SPIRIT_POS&&(i=0==this.isBinded()?"(进阶鉴定&需绑定)":"(进阶鉴定&绑定)");var o="";if(null!=this.power4&&null!=this.powerValue4&&0!=this.power4&&0!=this.powerValue4){var a=n;(!this.isBinded()||t.isNotOKPower(this.power4))&&(a=7039851);var r=t.getpowerValueAdd(this.powerValue4,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power4));o=this.getPowerDescByID(this.power4,r);t.isNotOKPower(this.power4)||(o+=i),e.push({text:o,color:a})}if(null!=this.power5&&null!=this.powerValue5&&0!=this.power5&&0!=this.powerValue5){a=n;(!this.isBinded()||t.isNotOKPower(this.power5))&&(a=7039851);var s=t.getpowerValueAdd(this.powerValue5,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power5));o=this.getPowerDescByID(this.power5,s);t.isNotOKPower(this.power5)||(o+=i),e.push({text:o,color:a})}if(null!=this.power6&&null!=this.powerValue6&&0!=this.power6&&0!=this.powerValue6){a=n;(!this.isBinded()||t.isNotOKPower(this.power6))&&(a=7039851);var l=t.getpowerValueAdd(this.powerValue6,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power6));o=this.getPowerDescByID(this.power6,l);t.isNotOKPower(this.power6)||(o+=i),e.push({text:o,color:a})}if(null!=this.power7&&null!=this.powerValue7&&0!=this.power7&&0!=this.powerValue7){a=n;(!this.isBinded()||t.isNotOKPower(this.power7))&&(a=7039851);var _=t.getpowerValueAdd(this.powerValue7,this.upgradeAscensionStar,this.upgradeStar,this.isBinded(),this.isAscension(this.power7));o=this.getPowerDescByID(this.power7,_);t.isNotOKPower(this.power7)||(o+=i),e.push({text:o,color:a})}},t.prototype.getNameInfo=function(){if(this.isMoney)switch(this.moneyType){case t.ITEM_MONEY_TYPE_1:return GameText.STR_MONEY1;case t.ITEM_MONEY_TYPE_2:return GameText.STR_MONEY2;case t.ITEM_MONEY_TYPE_3:return GameText.STR_MONEY3}var e=this.name;this.slotPos==PlayerBag.SPIRIT_POS&&(e="世界OL VIP");var n=Define.getGradeColor(this.grade),i="/c"+ColorUtils.changeColorNumberToString(n)+e+"/p";return this.isUpgradeItem&&(i+="/c"+ColorUtils.changeColorNumberToString(ColorUtils.COLOR_YELLOW)+"("+GameText2.STR_EQ_UPGRADE+")/p"),i},t.prototype.getTimeStr=function(){var t=this.expireTime-Tool.currentTime;if(0>=t)return"";var e=Math.floor(t/Tool.MILLIS_IN_MINUTE);return t%Tool.MILLIS_IN_MINUTE>0&&e++,Tool.getTimeStrByMin(e,!0)},t.prototype.getDesc=function(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var o=new StringBuffer;if(this.isMoney)return o.append(this.getNameInfo()+" x "+this.quantity),o.toString();if(n&&(o.append(this.getNameInfo()),o.append("\n")),this.slotPos==PlayerBag.SPIRIT_POS){var a=0;return e&&(a=e.getVipLevel()),o.append("当前VIP等级：/cffcc00VIP"+a+"/p"),o.toString()}if(this.ascensionStar>0&&(this.isBinded()?o.append(Tool.getStarInfo(this.star,this.ascensionStar)+" "+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+"\n"):this.star<=0?this.upgradeStar>0?o.append(PowerString.makeColorString(Tool.getStarInfo(0,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ACTIVATE,ColorUtils.COLOR_GRAY)):o.append(PowerString.makeColorString(Tool.getStarInfo(0,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ADD,ColorUtils.COLOR_GRAY)):o.append(PowerString.makeColorString(Tool.getStarInfo(this.star,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ACTIVATE,ColorUtils.COLOR_GRAY))),this.slotPos!=PlayerBag.SPIRIT_POS){var r=GameText.STR_ITEM_NO_BIND;this.isAutoBinding()?r=GameText.STR_ITEM_AUTO_BIND:this.isBinded()&&(r=GameText.STR_ITEM_HAS_BIND),o.append(r),this.isIdentifyItem()&&o.append(" "+GameText.STR_ITEM_CAN_IDENTIFY),o.append("  "+Define.getItemTypeString(this.type)),this.isCanEquip()&&o.append("  "+PowerString.makeColorString(Define.getGradeString(this.grade),ColorUtils.getGradeColor(this.grade))),o.append("\n")}if(1==this.isPetType())return o.append(Tool.manageStringU(GameText.STR_ITEM_LEVEL,this.reqLv+"")),0!=this.vipLevelReq&&o.append(this.getVipDesc(e)),o.toString();var s=new Array;if(1==this.getItemClass()&&(0!=this.atkMin&&0!=this.atkMax&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_COM_ATK,this.atkMin+"~"+this.atkMax),color:-1}),0!=this.getItemHitRate()&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_HIT_RATE,this.getItemHitRate()+""),color:-1}),0!=this.atk_time&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_ATK_TIME,this.atk_time+1+""),color:-1}),this.type!=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&s.push({text:Define.getAtkTypeString(this.atkType),color:-1})),0!=this.power1&&0!=this.powerValue1){var l=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power1)&&(l=ColorUtils.COLOR_GRAY);var _=t.getpowerValueAdd(this.powerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power1)),h=this.isIdentifyItem()&&this.power1!=Define.POWER_IDENTIFY?"(鉴定)":"",u=this.getPowerDescByID(this.power1,_);Tool.isNullText(u)||s.push({text:u+h,color:l})}if(0!=this.power2&&0!=this.powerValue2){l=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power2)&&(l=ColorUtils.COLOR_GRAY);var c=t.getpowerValueAdd(this.powerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power2));h=this.isIdentifyItem()&&this.power2!=Define.POWER_IDENTIFY?"(鉴定)":"",u=this.getPowerDescByID(this.power2,c);Tool.isNullText(u)||s.push({text:u+h,color:l})}if(0!=this.power3&&0!=this.powerValue3){l=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power3)&&(l=ColorUtils.COLOR_GRAY);var T=t.getpowerValueAdd(this.powerValue3,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power3));h=this.isIdentifyItem()&&this.power3!=Define.POWER_IDENTIFY?"(鉴定)":"",u=this.getPowerDescByID(this.power3,T);Tool.isNullText(u)||s.push({text:u+h,color:l})}var p=ColorUtils.COLOR_GREEN,d="";if(this.slotPos!=PlayerBag.SPIRIT_POS&&(0==this.isBinded()?(p=ColorUtils.COLOR_GRAY,d=this.isIdentifyItem()?"(鉴定&需绑定)":"(需绑定)"):d=this.isIdentifyItem()?"(鉴定&绑定)":"(绑定)"),0!=this.bindPower1&&0!=this.bindPowerValue1){var E=t.getpowerValueAdd(this.bindPowerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower1)),g=this.getPowerDescByID(this.bindPower1,E);l=p;t.isNotOKPower(this.bindPower1)?l=ColorUtils.COLOR_GRAY:g+=d,0==Tool.isNullText(g)&&s.push({text:g,color:l})}if(0!=this.bindPower2&&0!=this.bindPowerValue2){var S=t.getpowerValueAdd(this.bindPowerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower2));g=this.getPowerDescByID(this.bindPower2,S),l=p;t.isNotOKPower(this.bindPower2)?l=ColorUtils.COLOR_GRAY:g+=d,0==Tool.isNullText(g)&&s.push({text:g,color:l})}s.push({text:this.getAttackPowerDesc(!1),color:ColorUtils.COLOR_GREEN}),s.push({text:this.getEnchantInfo(),color:ColorUtils.COLOR_GREEN}),this.isUpgradeItem&&this.itemUpgradeDesc(s),0==Tool.isNullText(this.skillDesc)&&s.push({text:this.skillDesc,color:ColorUtils.COLOR_YELLOW});var m="";if(0!=this.def_str&&(m.length>0&&(m+="  "),m+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_STR,this.def_str+"")),0!=this.def_agi&&(m.length>0&&(m+="  "),m+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_AGI,this.def_agi+"")),0!=this.def_mag&&(m.length>0&&(m+="  "),m+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_MAG,this.def_mag+"")),0==Tool.isNullText(m)&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_GET_DEF_ARMOR,m),color:-1}),4==this.getItemClass()&&(this.area>=0&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_COM_AREA,Define.getSkillAreaString(this.area))+"  ",color:-1}),this.round>1&&s.push({text:Tool.manageStringU(GameText.STR_ITEM_GET_LAST_ROUND,this.round+""),color:-1}),this.leafCount>0&&s.push({text:"内含"+this.leafCount+"金叶",color:ColorUtils.COLOR_MONEY3})),this.slotPos!=PlayerBag.SPIRIT_POS){var f=this.getDurMax(e);if(0!=f){var I=Tool.manageString(GameText.STR_ITEM_COM_DURA,this.durability+"/"+f);this.durability<=0?s.push({text:I,color:ColorUtils.COLOR_RED}):s.push({text:I,color:-1})}}for(var A=0;A<s.length;A++){var y=s[A];I=y.text,l=y.color;Tool.isNullText(I)||(null!=l&&-1!=l?o.append(PowerString.makeColorString(I,l)+"\n"):o.append(I+"\n"))}var R=!0;if(m="",0!=this.reqLv){R=null!=e&&e.get(ModelConst.LEVEL)<this.reqLv;var P=Tool.manageStringU(GameText.getText(GameText.TI_LEVEL),this.reqLv+"");m+=R?PowerString.makeColorString(P,ColorUtils.COLOR_RED):P}if(0!=this.vipLevelReq&&this.slotPos!=PlayerBag.SPIRIT_POS&&(m+=this.getVipDesc(e)),0!=this.reqStr){R=null!=e&&e.get(ModelConst.STR)<this.reqStr;var C=Tool.manageStringU(GameText.STR_ITEM_GET_REQ_STR,"  "+this.reqStr);m+=R?PowerString.makeColorString(C,ColorUtils.COLOR_RED):C}if(0!=this.reqCon){R=null!=e&&e.get(ModelConst.CON)<this.reqCon;var M=Tool.manageStringU(GameText.STR_ITEM_GET_REQ_CON,"  "+this.reqCon);m+=R?PowerString.makeColorString(M,ColorUtils.COLOR_RED):M}if(0!=this.reqAgi){R=null!=e&&e.get(ModelConst.AGI)<this.reqAgi;var L=Tool.manageStringU(GameText.STR_ITEM_GET_REQ_AGI,"  "+this.reqAgi);m+=R?PowerString.makeColorString(L,ColorUtils.COLOR_RED):L}if(0!=this.reqIlt){R=null!=e&&e.get(ModelConst.ILT)<this.reqIlt;var v=Tool.manageStringU(GameText.STR_ITEM_GET_REQ_ILT,"  "+this.reqIlt);m+=R?PowerString.makeColorString(v,ColorUtils.COLOR_RED):v}if(0!=this.reqWis){R=null!=e&&e.get(ModelConst.WIS)<this.reqWis;var O=Tool.manageStringU(GameText.STR_ITEM_GET_REQ_WIS,"  "+this.reqWis);m+=R?PowerString.makeColorString(O,ColorUtils.COLOR_RED):O}if(0==Tool.isNullText(m)&&(m=Tool.manageString(GameText.STR_CONDITION_NEED,m),o.append(m+"\n")),this.isTimeItem()&&this.slotPos!=PlayerBag.SPIRIT_POS){l=ColorUtils.COLOR_GREEN;var N=GameText.STR_ITEM_GET_AGING;1==this.isExpired()?(N+=GameText.STR_ITEM_GET_PAST_DUE,l=ColorUtils.COLOR_RED):N+=this.getTimeStr(),o.append(PowerString.makeColorString(N,l)+"\n")}var D=this.getInfo();Tool.isNullText(D)||o.append("\n"+D);var B=this.getItemSetDesc(e);Tool.isNullText(B)||(o.append("\n"),o.append(B));var b=o.toString();return Tool.convertLastLinefeed(b)},t.prototype.getIdentifyInfo=function(){var t=new StringBuffer,e="",n=0,i="\n\n";return this.power1>0&&(e=Define.getPowerDesc(this.power1,this.powerValue1,this.powerValue1add),0==Tool.isNullText(e)&&(n=this.power1==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,e=PowerString.makeColorString(e,n),t.append(e),t.append(i))),this.power2>0&&(e=Define.getPowerDesc(this.power2,this.powerValue2,this.powerValue2add),n=this.power2==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,e=PowerString.makeColorString(e,n),t.append(e),t.append(i)),this.bindPower1>0&&(e=Define.getPowerDesc(this.bindPower1,this.bindPowerValue1,this.bindPowerValue1add),n=this.bindPower1==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,e=PowerString.makeColorString(e,n),t.append(e),t.append(i)),this.bindPower2>0&&(e=Define.getPowerDesc(this.bindPower2,this.bindPowerValue2,this.bindPowerValue2add),n=this.bindPower2==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,e=PowerString.makeColorString(e,n),e=PowerString.makeColorString(e,n),t.append(e),t.append(i)),this.power3>0&&this.power3!=Define.POWER_COMPOSITE&&(e=Define.getPowerDesc(this.power3,this.powerValue3,this.powerValue3add),n=this.power3==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,e=PowerString.makeColorString(e,n),t.append(e),t.append(i)),Tool.convertLastLinefeed(t.toString())},t.getIdentifyCompareInfo=function(e,n,i){void 0===i&&(i="\n\n");var o="",a=e.isBinded(),r=n.isBinded(),s=new StringBuffer;o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power1,e.powerValue1,e.powerValue1add,a,n.power1,n.powerValue1,n.powerValue1add,r):t.getIdentifyString(e.power1,e.powerValue1,n.power1,n.powerValue1),0==Tool.isNullText(o)&&(e.power1==Define.POWER_TRANSPORT&&n.power1==Define.POWER_TRANSPORT||e.power1==Define.POWER_COMPOSITE&&n.power1==Define.POWER_COMPOSITE||(s.append(o),s.append(i))),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power2,e.powerValue2,e.powerValue2add,a,n.power2,n.powerValue2,n.powerValue2add,r):t.getIdentifyString(e.power2,e.powerValue2,n.power2,n.powerValue2),0==Tool.isNullText(o)&&(e.power2!=Define.POWER_COMPOSITE||n.power2!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i)),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power3,e.powerValue3,e.powerValue3add,a,n.power3,n.powerValue3,n.powerValue3add,r):t.getIdentifyString(e.power3,e.powerValue3,n.power3,n.powerValue3),0==Tool.isNullText(o)&&(e.power3!=Define.POWER_COMPOSITE||n.power3!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i)),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.bindPower1,e.bindPowerValue1,e.bindPowerValue1add,a,n.bindPower1,n.bindPowerValue1,n.bindPowerValue1add,r):t.getIdentifyString(e.bindPower1,e.bindPowerValue1,n.bindPower1,n.bindPowerValue1),0==Tool.isNullText(o)&&(e.bindPower1!=Define.POWER_COMPOSITE||n.bindPower1!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i)),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.bindPower2,e.bindPowerValue2,e.bindPowerValue2add,a,n.bindPower2,n.bindPowerValue2,n.bindPowerValue2add,r):t.getIdentifyString(e.bindPower2,e.bindPowerValue2,n.bindPower2,n.bindPowerValue2),0==Tool.isNullText(o)&&(e.bindPower2!=Define.POWER_COMPOSITE||n.bindPower2!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i));var l=s.toString();return Tool.convertLastLinefeed(l)},t.prototype.getUpgradeIdentifyInfo=function(t){void 0===t&&(t="\n\n");var e=new StringBuffer,n="",i=0;return this.power4>0&&this.power4!=Define.POWER_COMPOSITE&&(n=Define.getPowerDesc(this.power4,this.powerValue4,this.powerValue4add),i=this.power4==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,n=PowerString.makeColorString(n,i),e.append(n),e.append(t)),this.power5>0&&this.power5!=Define.POWER_COMPOSITE&&(n=Define.getPowerDesc(this.power5,this.powerValue5,this.powerValue5add),i=this.power5==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,n=PowerString.makeColorString(n,i),e.append(n),e.append(t)),this.power6>0&&this.power6!=Define.POWER_COMPOSITE&&(n=Define.getPowerDesc(this.power6,this.powerValue6,this.powerValue6add),i=this.power6==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,n=PowerString.makeColorString(n,i),e.append(n),e.append(t)),this.power7>0&&this.power7!=Define.POWER_COMPOSITE&&(n=Define.getPowerDesc(this.power7,this.powerValue7,this.powerValue7add),i=this.power7==Define.POWER_IDENTIFY?ColorUtils.COLOR_GRAY:ColorUtils.COLOR_GREEN,n=PowerString.makeColorString(n,i),e.append(n),e.append(t)),Tool.convertLastLinefeed(e.toString())},t.getUpgradeIdentifyCompareInfo=function(e,n,i){void 0===i&&(i="\n\n");var o="",a=e.isBinded(),r=n.isBinded(),s=new StringBuffer;o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power4,e.powerValue4,e.powerValue4add,a,n.power4,n.powerValue4,n.powerValue4add,r):t.getIdentifyString(e.power4,e.powerValue4,n.power4,n.powerValue4),0==Tool.isNullText(o)&&(e.power4==Define.POWER_TRANSPORT&&n.power4==Define.POWER_TRANSPORT||e.power4==Define.POWER_COMPOSITE&&n.power4==Define.POWER_COMPOSITE||(s.append(o),s.append(i))),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power5,e.powerValue5,e.powerValue5add,a,n.power5,n.powerValue5,n.powerValue5add,r):t.getIdentifyString(e.power5,e.powerValue5,n.power5,n.powerValue5),0==Tool.isNullText(o)&&(e.power5!=Define.POWER_COMPOSITE||n.power5!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i)),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power6,e.powerValue6,e.powerValue6add,a,n.power6,n.powerValue6,n.powerValue6add,r):t.getIdentifyString(e.power6,e.powerValue6,n.power6,n.powerValue6),0==Tool.isNullText(o)&&(e.power6!=Define.POWER_COMPOSITE||n.power6!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i)),o=e.ascensionStar>0&&n.ascensionStar>0?t.getIdentifyStringFull(e.power7,e.powerValue7,e.powerValue7add,a,n.power7,n.powerValue7,n.powerValue7add,r):t.getIdentifyString(e.power7,e.powerValue7,n.power7,n.powerValue7),0==Tool.isNullText(o)&&(e.power7!=Define.POWER_COMPOSITE||n.power7!=Define.POWER_COMPOSITE)&&(s.append(o),s.append(i));var l=s.toString();return Tool.convertLastLinefeed(l)},t.getIdentifyString=function(t,e,n,i){if(0>=t&&0>=n)return"";var o=Define.getPowerDesc(t,e);(0>=t||Tool.isNullText(o))&&(o=GameText.STR_NOT_EFFECT);var a=Define.getPowerDesc(n,i);if((0>=n||Tool.isNullText(a))&&(a=GameText.STR_NOT_EFFECT),o!=a){var r=ColorUtils.COLOR_GREEN;t==Define.POWER_IDENTIFY?r=ColorUtils.COLOR_GRAY:t==n&&(r=-1);var s=ColorUtils.COLOR_GREEN;n==Define.POWER_IDENTIFY?s=ColorUtils.COLOR_GRAY:n==t&&e>i&&(s=ColorUtils.COLOR_RED),r>=0&&(o=PowerString.makeColorString(o,r)),s>=0&&(a=PowerString.makeColorString(a,s))}return o+"->"+a},t.getIdentifyStringFull=function(t,e,n,i,o,a,r,s){if(0>=t&&0>=o)return"";var l=Define.getPowerDesc(t,e,n,i);(0>=t||Tool.isNullText(l))&&(l=GameText.STR_NOT_EFFECT);var _=Define.getPowerDesc(o,a,r,s);if((0>=o||Tool.isNullText(_))&&(_=GameText.STR_NOT_EFFECT),l!=_){var h=ColorUtils.COLOR_GREEN;t==Define.POWER_IDENTIFY?h=ColorUtils.COLOR_GRAY:t==o&&(h=-1);var u=ColorUtils.COLOR_GREEN;o==Define.POWER_IDENTIFY?u=ColorUtils.COLOR_GRAY:o==t&&e>a&&(u=ColorUtils.COLOR_RED),h>=0&&(l=PowerString.makeColorString(l,h)),u>=0&&(_=PowerString.makeColorString(_,u))}return l+"->"+_},t.prototype.getUpStarInfo=function(){if(this.ascensionStar<=0)return"";var e=new StringBuffer;this.isBinded()?e.append(Tool.getStarInfo(this.star,this.ascensionStar)+" "+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+"\n"):this.star<=0?this.upgradeStar>0?e.append(PowerString.makeColorString(Tool.getStarInfo(0,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ACTIVATE,ColorUtils.COLOR_GRAY)):e.append(PowerString.makeColorString(Tool.getStarInfo(0,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ADD,ColorUtils.COLOR_GRAY)):e.append(PowerString.makeColorString(Tool.getStarInfo(this.star,this.ascensionStar)+" ",ColorUtils.COLOR_GRAY)+Tool.getUpgradeStarInfo(this.upgradeStar,this.upgradeAscensionStar)+PowerString.makeColorString(GameText.STR_ITEM_STAR_BIND_ACTIVATE,ColorUtils.COLOR_GRAY));var n=new Array;if(1==this.getItemClass()&&(0!=this.atkMin&&0!=this.atkMax&&n.push({text:Tool.manageStringU(GameText.STR_ITEM_COM_ATK,this.atkMin+"~"+this.atkMax),color:-1}),0!=this.getItemHitRate()&&n.push({text:Tool.manageStringU(GameText.STR_ITEM_HIT_RATE,this.getItemHitRate()+""),color:-1}),0!=this.atk_time&&n.push({text:Tool.manageStringU(GameText.STR_ITEM_ATK_TIME,this.atk_time+1+""),color:-1}),this.type!=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&n.push({text:Define.getAtkTypeString(this.atkType),color:-1})),0!=this.power1&&0!=this.powerValue1){var i=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power1)&&(i=ColorUtils.COLOR_GRAY);var o=t.getpowerValueAdd(this.powerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power1));n.push({text:this.getPowerDescByID(this.power1,o),color:i})}if(0!=this.power2&&0!=this.powerValue2){i=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power2)&&(i=ColorUtils.COLOR_GRAY);var a=t.getpowerValueAdd(this.powerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power2));n.push({text:this.getPowerDescByID(this.power2,a),color:i})}if(0!=this.power3&&0!=this.powerValue3){i=ColorUtils.COLOR_GREEN;t.isNotOKPower(this.power3)&&(i=ColorUtils.COLOR_GRAY);var r=t.getpowerValueAdd(this.powerValue3,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power3));n.push({text:this.getPowerDescByID(this.power3,r),color:i})}var s=ColorUtils.COLOR_GREEN,l="";if(0==this.isBinded()?(s=ColorUtils.COLOR_GRAY,l=GameText.STR_ITEM_NEED_BIND):l="("+GameText.getText(GameText.TI_BIND)+")",0!=this.bindPower1&&0!=this.bindPowerValue1){var _=t.getpowerValueAdd(this.bindPowerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower1)),h=this.getPowerDescByID(this.bindPower1,_);i=s;t.isNotOKPower(this.bindPower1)?i=ColorUtils.COLOR_GRAY:h+=l,0==Tool.isNullText(h)&&n.push({text:h,color:i})}if(0!=this.bindPower2&&0!=this.bindPowerValue2){var u=t.getpowerValueAdd(this.bindPowerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower2));h=this.getPowerDescByID(this.bindPower2,u),i=s;t.isNotOKPower(this.bindPower2)?i=ColorUtils.COLOR_GRAY:h+=l,0==Tool.isNullText(h)&&n.push({text:h,color:i})}var c="";0!=this.def_str&&(c.length>0&&(c+="  "),c+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_STR,this.def_str+"")),0!=this.def_agi&&(c.length>0&&(c+="  "),c+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_AGI,this.def_agi+"")),0!=this.def_mag&&(c.length>0&&(c+="  "),c+=Tool.manageStringU(GameText.STR_ITEM_GET_DEF_MAG,this.def_mag+"")),0==Tool.isNullText(c)&&n.push({text:Tool.manageStringU(GameText.STR_ITEM_GET_DEF_ARMOR,c),color:-1});for(var T=0;T<n.length;T++){var p=n[T],d=p.text;i=p.color;Tool.isNullText(d)||(null!=i&&-1!=i?e.append(PowerString.makeColorString(d,i)+"\n"):e.append(d+"\n"))}return e.toString()},t.getEquipCompareDesc=function(e,n,i,o){if(void 0===o&&(o=""),null==n||null==e)return null;if(i==t.COMPARE_ALL&&(0==n.isCanEquip()||0==e.isCanEquip()))return null;var a=" -> ",r="\n",s=n.isBinded(),l=e.isBinded(),_=new StringBuffer;if(i==t.COMPARE_IDENTIFY_G){var h="";h=n.upgradeAscensionStar>0&&e.upgradeAscensionStar>0?t.getIdentifyStringFull(n.power4,n.powerValue4,n.powerValue4add,s,e.power4,e.powerValue4,e.powerValue4add,l):t.getIdentifyString(n.power4,n.powerValue4,e.power4,e.powerValue4),0==Tool.isNullText(h)&&(n.power4!=Define.POWER_COMPOSITE||e.power4!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["1",h])),_.append("\n")),h=n.upgradeAscensionStar>0&&e.upgradeAscensionStar>0?t.getIdentifyStringFull(n.power5,n.powerValue5,n.powerValue5add,s,e.power5,e.powerValue5,e.powerValue5add,l):t.getIdentifyString(n.power5,n.powerValue5,e.power5,e.powerValue5),0==Tool.isNullText(h)&&(n.power5!=Define.POWER_COMPOSITE||e.power5!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["2",h])),_.append("\n")),h=n.upgradeAscensionStar>0&&e.upgradeAscensionStar>0?t.getIdentifyStringFull(n.power6,n.powerValue6,n.powerValue6add,s,e.power6,e.powerValue6,e.powerValue6add,l):t.getIdentifyString(n.power6,n.powerValue6,e.power6,e.powerValue6),0==Tool.isNullText(h)&&(n.power6!=Define.POWER_COMPOSITE||e.power6!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["3",h])),_.append("\n")),h=n.upgradeAscensionStar>0&&e.upgradeAscensionStar>0?t.getIdentifyStringFull(n.power7,n.powerValue7,n.powerValue7add,s,e.power7,e.powerValue7,e.powerValue7add,l):t.getIdentifyString(n.power7,n.powerValue7,e.power7,e.powerValue7),0==Tool.isNullText(h)&&(n.power7!=Define.POWER_COMPOSITE||e.power7!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["4",h])),_.append("\n"));var u=_.toString();return Tool.convertLastLinefeed(u)}if(i==t.COMPARE_IDENTIFY||i==t.COMPARE_COMBIN){h="";i==t.COMPARE_COMBIN&&_.append(Tool.manageStringList(GameText.STR_ITEM_STAR_NUM,[Tool.getStarInfo(n.star,n.ascensionStar),Tool.getStarInfo(e.star,e.ascensionStar)])),h=n.ascensionStar>0&&e.ascensionStar>0?t.getIdentifyStringFull(n.power1,n.powerValue1,n.powerValue1add,s,e.power1,e.powerValue1,e.powerValue1add,l):t.getIdentifyString(n.power1,n.powerValue1,e.power1,e.powerValue1),0==Tool.isNullText(h)&&(n.power1!=Define.POWER_COMPOSITE||e.power1!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["1",h])),_.append("\n")),h=n.ascensionStar>0&&e.ascensionStar>0?t.getIdentifyStringFull(n.power2,n.powerValue2,n.powerValue2add,s,e.power2,e.powerValue2,e.powerValue2add,l):t.getIdentifyString(n.power2,n.powerValue2,e.power2,e.powerValue2),0==Tool.isNullText(h)&&(n.power2!=Define.POWER_COMPOSITE||e.power2!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["2",h])),_.append("\n")),h=n.ascensionStar>0&&e.ascensionStar>0?t.getIdentifyStringFull(n.power3,n.powerValue3,n.powerValue3add,s,e.power3,e.powerValue3,e.powerValue3add,l):t.getIdentifyString(n.power3,n.powerValue3,e.power3,e.powerValue3),0==Tool.isNullText(h)&&(n.power3!=Define.POWER_COMPOSITE||e.power3!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["3",h])),_.append("\n")),h=n.ascensionStar>0&&e.ascensionStar>0?t.getIdentifyStringFull(n.bindPower1,n.bindPowerValue1,n.bindPowerValue1add,s,e.bindPower1,e.bindPowerValue1,e.bindPowerValue1add,l):t.getIdentifyString(n.bindPower1,n.bindPowerValue1,e.bindPower1,e.bindPowerValue1),0==Tool.isNullText(h)&&(n.bindPower1!=Define.POWER_COMPOSITE||e.bindPower1!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText.STR_ITEM_BIND_POWER,["1",h])),_.append("\n")),h=n.ascensionStar>0&&e.ascensionStar>0?t.getIdentifyStringFull(n.bindPower2,n.bindPowerValue2,n.bindPowerValue2add,s,e.bindPower2,e.bindPowerValue2,e.bindPowerValue2add,l):t.getIdentifyString(n.bindPower2,n.bindPowerValue2,e.bindPower2,e.bindPowerValue2),0==Tool.isNullText(h)&&(n.bindPower2!=Define.POWER_COMPOSITE||e.bindPower2!=Define.POWER_COMPOSITE)&&(_.append(Tool.manageStringList(GameText.STR_ITEM_BIND_POWER,["2",h])),_.append("\n")),i==t.COMPARE_COMBIN&&(0==Tool.isNullText(n.skillDesc)||0==Tool.isNullText(e.skillDesc))&&(_.append(GameText.STR_ITEM_COMPOSE_SKILL+":"+(Tool.isNullText(n.skillDesc)?GameText.STR_NOT_EFFECT:PowerString.makeColorString(n.skillDesc,ColorUtils.COLOR_YELLOW))+"->"+(Tool.isNullText(e.skillDesc)?GameText.STR_NOT_EFFECT:PowerString.makeColorString(e.skillDesc,ColorUtils.COLOR_YELLOW))),_.append("\n"));u=_.toString();return Tool.convertLastLinefeed(u)}_.append(o+n.getNameInfo()+a+o+e.getNameInfo()+r),i==t.COMPARE_ALL&&_.append(Tool.manageStringList(GameText.STR_ITEM_STAR_NUM,[Tool.getStarInfo(n.star,n.ascensionStar)+" "+Tool.getUpgradeStarInfo(n.upgradeStar,n.upgradeAscensionStar),Tool.getStarInfo(e.star,e.ascensionStar)+" "+Tool.getUpgradeStarInfo(e.upgradeStar,e.upgradeAscensionStar)])),_.append(Tool.manageString(GameText.STR_ITEM_COM_REQ_LV,Tool.compareColorText1(n.reqLv,e.reqLv)+r)),n.durability!=e.durability&&e.durability>0&&_.append(Tool.manageString(GameText.STR_ITEM_COM_DURA,Tool.compareColorText1(n.durability,e.durability)+r)),1==n.getItemClass()&&1==e.getItemClass()?(_.append(Tool.manageString(GameText.STR_ITEM_COM_ATK_TIME,Tool.compareColorText1(n.atk_time+1,e.atk_time+1)+r)),_.append(Tool.manageString(GameText.STR_ITEM_COM_ATK_MIN,Tool.compareColorText2(n.atkMin,n.atkMax,e.atkMin,e.atkMax,"~")+r))):(_.append(Tool.manageString(GameText.STR_ITEM_COM_DEF_STR,Tool.compareColorText1(n.def_str,e.def_str)+r)),_.append(Tool.manageString(GameText.STR_ITEM_COM_DEF_AGI,Tool.compareColorText1(n.def_agi,e.def_agi)+r)),_.append(Tool.manageString(GameText.STR_ITEM_COM_DEF_MAG,Tool.compareColorText1(n.def_mag,e.def_mag)+r))),n.getItemHitRate()>0&&e.getItemHitRate()>0&&_.append(Tool.manageString(GameText.STR_ITEM_COM_HIT_RATE,Tool.compareColorText1(n.getItemHitRate(),e.getItemHitRate())+r)),n.round>0&&e.round>0&&_.append(Tool.manageString(GameText.STR_ITEM_COM_LAST_ROUND,Tool.compareColorText1(n.round,e.round)+r)),n.area>0&&e.area>0&&_.append(Tool.manageString(GameText.STR_ITEM_COM_AREA,Define.getSkillAreaString(n.area)+a+Define.getSkillAreaString(e.area)+r)),(n.attachPower>0||e.attachPower>0)&&_.append(Tool.manageString(GameText.STR_ITEM_COM_ATTACK_POWER,Tool.comparePower(n.attachPower,n.attachValue,e.attachPower,e.attachValue)+r));var c=t.getpowerValueAdd(n.powerValue1,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power1)),T=t.getpowerValueAdd(e.powerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power1));(n.power1!=e.power1||c!=T)&&_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["1",Tool.comparePower(n.power1,c,e.power1,T)+r]));var p=t.getpowerValueAdd(n.powerValue2,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power2)),d=t.getpowerValueAdd(e.powerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power2));(n.power2!=e.power2||p!=d)&&_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["2",Tool.comparePower(n.power2,p,e.power2,d)+r]));var E=t.getpowerValueAdd(n.powerValue3,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power3)),g=t.getpowerValueAdd(e.powerValue3,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power3));(n.power3!=e.power3||E!=g)&&_.append(Tool.manageStringList(GameText.STR_ITEM_POWER,["3",Tool.comparePower(n.power3,E,e.power3,g)+r]));var S=t.getpowerValueAdd(n.bindPowerValue1,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.bindPower1)),m=t.getpowerValueAdd(e.bindPowerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower1));(n.bindPower1!=e.bindPower1||S!=m)&&_.append(Tool.manageStringList(GameText.STR_ITEM_BIND_POWER,["1",Tool.comparePower(n.bindPower1,S,e.bindPower1,m)+r]));var f=t.getpowerValueAdd(n.bindPowerValue2,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.bindPower2)),I=t.getpowerValueAdd(e.bindPowerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower2));(n.bindPower2!=e.bindPower2||f!=I)&&_.append(Tool.manageStringList(GameText.STR_ITEM_BIND_POWER,["2",Tool.comparePower(n.bindPower2,f,e.bindPower2,I)+r]));var A=t.getpowerValueAdd(n.powerValue4,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power4)),y=t.getpowerValueAdd(e.powerValue4,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power4));(n.power4!=e.power4||A!=y)&&_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["1",Tool.comparePower(n.power4,A,e.power4,y)+r]));var R=t.getpowerValueAdd(n.powerValue5,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power5)),P=t.getpowerValueAdd(e.powerValue5,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power5));(n.power5!=e.power5||R!=P)&&_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["2",Tool.comparePower(n.power5,R,e.power5,P)+r]));var C=t.getpowerValueAdd(n.powerValue6,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power6)),M=t.getpowerValueAdd(e.powerValue6,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power6));(n.power6!=e.power6||C!=M)&&_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["3",Tool.comparePower(n.power6,C,e.power6,M)+r]));var L=t.getpowerValueAdd(n.powerValue7,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power7)),v=t.getpowerValueAdd(e.powerValue7,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power7));(n.power7!=e.power7||L!=v)&&_.append(Tool.manageStringList(GameText2.STR_EQ_INDENTIFY_UPGRADE_ITEM_POWER,["4",Tool.comparePower(n.power7,L,e.power7,v)+r])),(n.isHasSkill()||e.isHasSkill())&&_.append(GameText.STR_ITEM_COMPOSE_SKILL+PowerString.makeColorString(n.getSkillDesc(),n.isHasSkill()?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_GOLD_YELLOW)+" -> "+PowerString.makeColorString(e.getSkillDesc(),e.isHasSkill()?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_GOLD_YELLOW)+r);u=_.toString();return Tool.convertLastLinefeed(u)},t.prototype.doViewItem=function(){var e=this,n=function(){var t=Tool.convertDescToTextFlow(e.getDesc(xself));AlertPanel.alertTipsTextFlow(e.name,t,"left")};if(0==this.isStatusBit(1024)){var i=MsgHandler.createItemInfoMsg(this.id);nato.Network.sendCmd(i,(function(e){MsgHandler.isMessageHaveError(e)||(t.fromBytesAtts2(this,e),this.durability=this.durMax,MsgHandler.processGetSuitInfoMsg(e),this.setStatusBit(!0,1024),n())}),this)}else n()},t.prototype.setCombinAttribute=function(t,e){this.power1=t.getUnsignedByte(),this.powerValue1=t.getShort(),e&&(this.powerValue1add=t.getShort()),this.power2=t.getUnsignedByte(),this.powerValue2=t.getShort(),this.ascensionStar>0&&(this.powerValue2add=t.getShort()),this.power3=t.getUnsignedByte(),this.powerValue3=t.getShort(),e&&(this.powerValue3add=t.getShort()),this.bindPower1=t.getUnsignedByte(),this.bindPowerValue1=t.getShort(),e&&(this.bindPowerValue1add=t.getShort()),this.bindPower2=t.getUnsignedByte(),this.bindPowerValue2=t.getShort(),e&&(this.bindPowerValue2add=t.getShort())},t.prototype.setCombinAttribute2=function(t,e){this.powerValue1=t.getShort(),e&&(this.powerValue1add=t.getShort()),this.powerValue2=t.getShort(),e&&(this.powerValue2add=t.getShort()),this.powerValue3=t.getShort(),e&&(this.powerValue3add=t.getShort()),this.bindPowerValue1=t.getShort(),e&&(this.bindPowerValue1add=t.getShort()),this.bindPowerValue2=t.getShort(),e&&(this.bindPowerValue2add=t.getShort())},t.prototype.isHasPower=function(){var t=!1;return 0!=this.power1&&0!=this.powerValue1&&(t=!0),0!=this.power2&&0!=this.powerValue2&&(t=!0),0!=this.power3&&0!=this.powerValue3&&(t=!0),0!=this.bindPower1&&0!=this.bindPowerValue1&&(t=!0),0!=this.bindPower2&&0!=this.bindPowerValue2&&(t=!0),t},t.prototype.getAllPowerDesc=function(){var e=new StringBuffer,n="",i=t.getpowerValueAdd(this.powerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power1));n=Define.getPowerDesc(this.power1,i),0!=this.power1&&0!=i&&0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(n,ColorUtils.COLOR_GREEN)),e.append("\n"));var o=t.getpowerValueAdd(this.powerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power2));n=Define.getPowerDesc(this.power2,o),0!=this.power2&&0!=o&&0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(n,ColorUtils.COLOR_GREEN)),e.append("\n"));var a=t.getpowerValueAdd(this.powerValue3,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.power3));n=Define.getPowerDesc(this.power3,a),0!=this.power3&&0!=a&&0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(n,ColorUtils.COLOR_GREEN)),e.append("\n"));var r=t.getpowerValueAdd(this.bindPowerValue1,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower1));n=Define.getPowerDesc(this.bindPower1,r),0!=this.bindPower1&&0!=r&&0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(n,ColorUtils.COLOR_GREEN)),e.append("\n"));var s=t.getpowerValueAdd(this.bindPowerValue2,this.ascensionStar,this.star,this.isBinded(),this.isAscension(this.bindPower2));return n=Define.getPowerDesc(this.bindPower2,s),0!=this.bindPower2&&0!=s&&0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(n,ColorUtils.COLOR_GREEN)),e.append("\n")),0==Tool.isNullText(this.skillDesc)&&(e.append(PowerString.makeColorString(this.skillDesc,ColorUtils.COLOR_YELLOW)),e.append("\n")),e.toString()},t.prototype.clone=function(){var e=new t;return this.setItemDataTo(e),e},t.prototype.toString=function(){var t=new StringBuffer;return t.append("id:"+this.id+", "),t.append("name:"+this.name+", "),t.append("icon:"+this.icon+", "),t.append("bagIcon:"+this.bagIcon+", "),t.append("info:"+this.info+", "),t.append("type:"+this.type+", "),t.append("grade:"+this.grade+", "),t.append("reqLv:"+this.reqLv+", "),t.append("reqStr:"+this.reqStr+", "),t.append("reqCon:"+this.reqCon+", "),t.append("reqAgi:"+this.reqAgi+", "),t.append("reqInt:"+this.reqIlt+", "),t.append("reqWis:"+this.reqWis+", "),t.append("atkType:"+this.atkType+", "),t.append("atk_time:"+this.atk_time+", "),t.append("atkMin:"+this.atkMin+", "),t.append("atkMax:"+this.atkMax+", "),t.append("def_str:"+this.def_str+", "),t.append("def_agi:"+this.def_agi+", "),t.append("def_mag:"+this.def_mag+", "),t.append("hitrate:"+this.getItemHitRate()+", "),t.append("round:"+this.round+", "),t.append("area:"+this.area+", "),t.append("power1:"+this.power1+", "),t.append("powerValue1:"+this.powerValue1+", "),t.append("power2:"+this.power2+", "),t.append("powerValue2:"+this.powerValue2+", "),t.append("power3:"+this.power3+", "),t.append("powerValue3:"+this.powerValue3+", "),t.append("bindPower1:"+this.bindPower1+", "),t.append("bindPowerValue1:"+this.bindPowerValue1+", "),t.append("bindPower2:"+this.bindPower2+", "),t.append("bindPowerValue2:"+this.bindPowerValue2+", "),t.append("ownTime:"+this.ownTime+", "),t.append("durMax:"+this.durMax+", "),t.append("price :"+this.price+", "),t.append("autoBinding:"+this.autoBinding+", "),t.append("attachCount:"+this.attachCount+", "),t.append("itemSet:"+this.getItemSetID()+", "),t.append("itemSetPower:"+this.itemSetPower+", "),t.append("itemSetPowerValue:"+this.itemSetPowerValue+", "),t.toString()},t.getOneKeyWorldShop=function(){var e=new t;return e.name=GameText.STR_WORLD_SHOP,e.id=t.ITEM_ID_WORLD_SHOP,e.bagIcon=28,e.grade=Define.GRADE_4,e.setInfo(GameText.STR_ENTER_WORLD_SHOP),e},t.getBagGuideItem=function(t,e){var n=e.reqLv,i=e.grade,o=e.reqStr,a=e.reqCon,r=e.reqAgi,s=e.reqIlt,l=e.reqWis;if(o>xself.get(ModelConst.STR))return null;if(a>xself.get(ModelConst.CON))return null;if(r>xself.get(ModelConst.AGI))return null;if(s>xself.get(ModelConst.ILT))return null;if(l>xself.get(ModelConst.WIS))return null;var _=t.reqLv,h=t.grade;return _>n||_==n&&h>=i?null:e},t.ITEM_ID_QUICK_FILL_HP=-1e4,t.ITEM_ID_SPRITE_GUIDE=-10001,t.ITEM_ID_WORLD_SHOP=-10002,t.ITEM_ID_PET_PARTNER=32006,t.ITEM_MONEY_TYPE_1=3,t.ITEM_MONEY_TYPE_2=4,t.ITEM_MONEY_TYPE_3=5,t.isUpgradeItemOpen=!1,t.COMPARE_ALL=0,t.COMPARE_IDENTIFY=1,t.COMPARE_COMBIN=2,t.COMPARE_IDENTIFY_G=3,t}();__reflect(ItemData.prototype,"ItemData");var NoneSdk=function(){function t(){this._uid="",this._loginType="",this._isShare=!1}return Object.defineProperty(t.prototype,"payUrl",{get:function(){return this._payUrl},set:function(t){this._payUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},set:function(t){this._uid=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serveid",{get:function(){return Sdk.serverid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"channel",{get:function(){return Sdk.channel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"param",{get:function(){return Sdk.param},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Sdk.chanName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preload",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appid",{get:function(){return Sdk.param.appid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appkey",{get:function(){return Sdk.param.appkey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entry",{get:function(){return Sdk.entry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openid",{get:function(){return this._openid},set:function(t){this._openid=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._loginType},set:function(t){this._loginType=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){return t&&t.call(e),!0},t.prototype.openLogin=function(){Sdk.openLogin()},t.prototype.returnLogin=function(){Sdk.openLogin()},t.prototype.logout=function(t){Sdk.logout(t)},Object.defineProperty(t.prototype,"isShare",{get:function(){return this._isShare},set:function(t){this._isShare=t},enumerable:!0,configurable:!0}),t.prototype.queryString=function(t){var e=window.location.href;if(null!=(e=decodeURIComponent(e))){var n=e.replace(/\?/g,"&"),i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=n.substr(1).match(i);return null!=o?o[2]:null}},t.prototype.queryURI=function(){var t=window.location.href;if(null!=(t=decodeURIComponent(t))){var e=t.indexOf("index.html");return t.substring(0,e)}},t.prototype.loginWithType=function(t){},t.prototype.reportRegister=function(){},t.prototype.reportLogin=function(){},t.prototype.order=function(t,e){Sdk.order(t,e)},t.prototype.pay=function(t,e,n,i,o,a){},t.prototype.pcPayClick=function(t){},t.prototype.openUrl=function(t,e,n){},t.prototype.share=function(t,e,n,i,o,a,r,s,l){},t.prototype.closeNode=function(){return!1},t.prototype.sendToDesktop=function(t,e){},t.prototype.openTopicCircle=function(){},t.prototype.getSDKSatus=function(){return!1},t.prototype.follow=function(){},t.prototype.statistic=function(t){},t.prototype.createRoleStatistic=function(t){},t}();__reflect(NoneSdk.prototype,"NoneSdk",["ISdk"]);var Field=function(){};__reflect(Field.prototype,"Field");var QueryString=function(){function t(){this.array=[]}return t.prototype.parse=function(){var e=window.location.href,n=e.indexOf("?");if(0>n)return!1;for(var i,o=e.substr(n+1),a=/([^=&]+)(=([^&]*))?/g;i=a.exec(o);){var r=decodeURIComponent(i[1].replace(/\+/g," ")),s=i[3]?t.decode(i[3]):"";this.add(r,s)}return!0},t.decode=function(t){return(t=(t=(t=t.replace(/\+/g," ")).replace(/%([EF][0-9A-F])%([89AB][0-9A-F])%([89AB][0-9A-F])/gi,(function(t,e,n,i){var o=parseInt(e,16)-224,a=parseInt(n,16)-128;if(0==o&&32>a)return t;var r=(o<<12)+(a<<6)+(parseInt(i,16)-128);return r>65535?t:String.fromCharCode(r)}))).replace(/%([CD][0-9A-F])%([89AB][0-9A-F])/gi,(function(t,e,n){var i=parseInt(e,16)-192;if(2>i)return t;var o=parseInt(n,16)-128;return String.fromCharCode((i<<6)+o)}))).replace(/%([0-7][0-9A-F])/gi,(function(t,e){return String.fromCharCode(parseInt(e,16))}))},t.prototype.add=function(e,n){t.ignoreKeys.indexOf(e)>=0||this.array.push({name:e,value:n})},t.prototype.find=function(t){for(var e=0;e<this.array.length;e++)if(this.array[e].name==t)return this.array[e].value;return null},t.prototype.toarray=function(){return this.array},t.prototype.sort=function(){this.array.sort(t.sortByAscii)},t.sortByAscii=function(t,e){return t.name>e.name?1:t.name<e.name?-1:0},t.ignoreKeys=["xameid","xhannel"],t}();__reflect(QueryString.prototype,"QueryString");var Mission=function(){function t(t){this.setting=0,this.id=0,this.level=0,this.mapId=-1,this.npcId=-1,this.exp=0,this.money2=0,this.money3=0,this.honor=0,this.cityProsperity=0,this.cityArmy=0,this.countryArmy=0,this.countryLand=0,this.countryProsperity=0,this.promoteProsperity=0,this.countryPeople=0,this.countryWood=0,this.countryStone=0,this.countryIron=0,this.rewardItems=null,this.selectItems=null,this.acceptCondition=null,this.submitCondition=null,this.escortCost=null,this.radarMapID=0,this.radarGx=0,this.radarGy=0,this.acceptJumpMapID=0,this.acceptJumpMapGx=0,this.acceptJumpMapGy=0,this.submitJumpMapID=0,this.submitJumpMapGx=0,this.submitJumpMapGy=0,this.acceptBattleID=0,this.submitBattleID=0,this.submitNextMissionID=0,this.id=t}return t.prototype.isRandomMission=function(){return(2097152&this.setting)>0},t.prototype.couldNotDel=function(){return(16&this.setting)>0},t.prototype.isDirectSubmit=function(){return(1&this.setting)>0},t.prototype.isDailyMission=function(){return(2&this.setting)>0},t.prototype.isUnLimitSubmit=function(){return(8&this.setting)>0},t.prototype.isEscort=function(){return(64&this.setting)>0},t.prototype.isEscortTeam=function(){return(128&this.setting)>0},t.prototype.isCityOrCountry=function(){return(32&this.setting)>0},t.prototype.isCountryAssignTask=function(){return 0!=(2048&this.setting)},t.prototype.isShowGuide=function(){return 0!=(256&this.setting)},t.prototype.isOneKeyMission=function(){return 0!=(4096&this.setting)},t.prototype.isOneKeyShow=function(){return 0!=(1048576&this.setting)},t.prototype.setOneKeySHow=function(){this.setting|=1048576},t.prototype.isGuideMission=function(){return!this.isEscort()&&0!=(8192&this.setting)},t.prototype.isGuideBag=function(){return!this.isEscort()&&0!=(16384&this.setting)},t.prototype.isGuideUsePet=function(){if(null==this.rewardItems||0==this.rewardItems.length)return!1;for(var t=0,e=this.rewardItems.length;e>t;t++)if(this.rewardItems[0].id==ItemData.ITEM_ID_PET_PARTNER)return!0;return!1},t.prototype.isHaveSpecailReward=function(){return 0!=(512&this.setting)},t.prototype.isHaveSpecailReward2=function(){return 0!=(32768&this.setting)},t.prototype.isHaveSpecailExecute=function(){return 0!=(1024&this.setting)},t.prototype.isVisibleAndSubmit=function(t,e){if(null==t)return!1;if(1==this.isCityOrCountry()){if(this.npcId!=t.missionGroupID)return!1}else{if(Define.isAllocateCityMap(e))return!1;if(Define.isAllocateCountryMap(e))return!1;var n=e;if(Define.isAllocateMirrorMap(e)&&(n=xworld.orgMapID),Define.isCommonMap(n)&&this.mapId!=n)return!1;if(Define.isCommonMap(n)&&this.npcId!=t.getId())return!1;if(this.npcId!=t.getId())return!1;if(this.mapId!=n)return!1}return!0},t.setNewRadar=function(e){null==e||e.radarMapID<=0||(t.newRadarMapID=e.radarMapID,t.newRadarGx=e.radarGx,t.newRadarGy=e.radarGy)},t.clearNewRadar=function(e){null!=e&&e.radarMapID==t.newRadarMapID&&e.radarGx==t.newRadarGx&&e.radarGy==t.newRadarGy&&(t.newRadarMapID=0,t.newRadarGx=0,t.newRadarGy=0)},t.prototype.getNameInfo=function(){return this.name+this.getPlayerMissionName()},t.prototype.getPlayerMissionName=function(){return this.isComplete()?"["+GameText.STR_MISSION_FINISH+"]":"["+GameText.STR_MISSION_UNFINISH+"]"},t.prototype.createFromBytes=function(t){var e=t.readShort();this.id=e,this.name=t.readUTF(),this.level=t.readByte(),this.simpleDesc=t.readUTF(),this.desc=t.readUTF(),this.setting=65535&t.readShort(),this.mapId=t.readShort(),this.npcId=t.readByte(),this.radarMapID=t.readShort(),this.radarMapID>0&&(this.radarGx=t.readByte(),this.radarGy=t.readByte()),this.dialogNotStartNotReady=t.readUTF(),this.dialogStartNotFinish=t.readUTF(),this.dialogStartFinish=t.readUTF(),this.exp=t.readInt(),this.money2=t.readShort(),this.money3=t.readShort(),1==this.isHaveSpecailReward()&&(this.honor=t.readShort(),this.countryLand=t.readShort(),this.countryProsperity=t.readShort(),this.countryPeople=t.readShort(),this.countryWood=t.readShort(),this.countryStone=t.readShort(),this.countryIron=t.readShort(),this.cityArmy=t.readShort(),this.cityProsperity=t.readShort(),this.promoteProsperity=t.readShort()),1==this.isHaveSpecailReward2()&&(this.countryArmy=t.readShort()),1==this.isHaveSpecailExecute()&&(this.acceptJumpMapID=t.readShort(),this.acceptJumpMapID>0&&(this.acceptJumpMapGx=t.readByte(),this.acceptJumpMapGy=t.readByte()),this.submitJumpMapID=t.readShort(),this.submitJumpMapID>0&&(this.submitJumpMapGx=t.readByte(),this.submitJumpMapGy=t.readByte()),this.acceptBattleID=t.readShort(),this.submitBattleID=t.readShort(),this.submitNextMissionID=t.readShort()),1==this.isEscort()&&(this.escortCost=new Array(3),this.escortCost[0]=t.readInt(),this.escortCost[1]=t.readInt(),this.escortCost[2]=t.readInt(),t.readByte(),t.readByte());var n=t.readByte();if(n>0){this.rewardItems=new Array(n);for(var i=0;n>i;i++){var o=xitem.getItemFromMissionBytes(t);this.rewardItems[i]=o}}if((n=t.readByte())>0){this.selectItems=new Array(n);for(i=0;n>i;i++){o=xitem.getItemFromMissionBytes(t);this.selectItems[i]=o}}if((n=t.readByte())>0){this.acceptCondition=new Array(n);for(i=0;n>i;i++)this.acceptCondition[i]=Condition.fromBytes(t)}if((n=t.readByte())>0){this.submitCondition=new Array(n);for(i=0;n>i;i++)this.submitCondition[i]=Condition.fromBytes(t)}this.init()},t.fromBytes=function(e){var n=new t(-1);return n.createFromBytes(e),n},t.prototype.init=function(){this.simpleDesc=Tool.convertDesc(this.simpleDesc),this.desc=Tool.convertDesc(this.desc),this.dialogNotStartNotReady=Tool.convertDesc(this.dialogNotStartNotReady),this.dialogStartNotFinish=Tool.convertDesc(this.dialogStartNotFinish),this.dialogStartFinish=Tool.convertDesc(this.dialogStartFinish)},t.prototype.getMissionStatus=function(t,e){void 0===e&&(e=null);var n=MissionConst.CAN_SUBMIT;if(null!=t.getMissionById(this.id))n=this.isComplete()?MissionConst.CAN_SUBMIT:MissionConst.NOT_CAN_SUBMIT;else{var i=!1;if(null==e||e.length<=0)i=!0;else for(var o=0;o<e.length;o++){var a=e[o];if(null!=a&&a==t.getId()){i=!0;break}}n=this.isCanAccept()&&1==i?MissionConst.CAN_ACCEPT:MissionConst.NOT_CAN_ACCEPT}return n},t.prototype.isHasSelectItem=function(){if(null!=this.selectItems&&this.selectItems.length>0)for(var t=0;t<this.selectItems.length;t++)if(null!=this.selectItems[t])return!0;return!1},t.prototype.isCanAccept=function(){var t=xself;if(null==t)return!1;if(this.level>t.getLevel())return!1;if(null==this.acceptCondition)return!0;for(var e=0;e<this.acceptCondition.length;e++)if(0==this.acceptCondition[e].isConditionOfSatisfy(t))return!1;return!0},t.prototype.isComplete=function(){if(null==this.submitCondition)return!0;for(var t=0;t<this.submitCondition.length;t++){if(0==this.submitCondition[t].isConditionOfSatisfy(xself))return!1}return!0},t.prototype.isShowNotAcceptMission=function(t){if(null==t)return!1;if(null!=this.acceptCondition&&this.acceptCondition.length>1){var e=this.acceptCondition[0];if(0!=e.getType()&&e.isConditionOfSatisfy(t))return!0}return!1},t.prototype.isShowTargetType=function(){if(this.submitCondition&&this.submitCondition.length>0)for(var t=0;t<this.submitCondition.length;t++){if(this.submitCondition[t].isShowTargetType())return!0}return!1},Object.defineProperty(t.prototype,"isCollectItemType",{get:function(){if(this.submitCondition&&this.submitCondition.length>0)for(var t=0;t<this.submitCondition.length;t++){if(this.submitCondition[t].isCollectItemType)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.getTargetData=function(){var t=[];if(this.submitCondition&&this.submitCondition.length>0)for(var e=0;e<this.submitCondition.length;e++){var n=this.submitCondition[e];if(n.isShowTargetType()){var i=n.getTargetData();null!=i&&t.push(i)}}return t},t.prototype.getId=function(){return this.id},t.prototype.cleanKillMission=function(){if(!(null==this.submitCondition||this.submitCondition.length<=0))for(var t=0;t<this.submitCondition.length;t++)null!=this.submitCondition[t]&&this.submitCondition[t].cleanKillMonster()},t.prototype.updateKillMission=function(e,n,i){if(null!=this.submitCondition){for(var o=new StringBuffer,a=0;a<this.submitCondition.length;a++)null!=this.submitCondition[a]&&this.submitCondition[a].updateKilledMonsterNum(e,n,o);0==Tool.isNullText(o.toString())&&(null!=i&&i.append(o.toString()),t.curUpdateMission=this)}},t.prototype.updateHaveItemDesc=function(e,n){if(null!=this.submitCondition){for(var i=new StringBuffer,o=0;o<this.submitCondition.length;o++)null!=this.submitCondition[o]&&this.submitCondition[o].updateHaveItemNum(e,i);0==Tool.isNullText(i.toString())&&(n.append(i.toString()),t.curUpdateMission=this)}},t.checkPlayerMissionStatus=function(e,n,i){if(0>=n)return!0;if(null==e)return!0;if(0!=(1&i)&&t.isMissionFinish(e,n))return!0;var o=e.getMissionById(n);if(null!=o){if(1==o.isComplete()){if(0!=(4&i))return!0}else if(0!=(2&i))return!0}else if(0!=(8&i)&&0==t.isMissionFinish(e,n))return!0;return!1},t.isMissionFinish=function(t,e){if(null==t)return!1;var n=t.missionStatus;if(0>e||null==n)return!1;var i=Math.floor(e/8),o=Math.floor(e%8);return i>=0&&i<n.length&&0!=(n[i]&1<<o)},t.finishMission=function(e,n){t.setMissionStatus(e,n,!0)},t.setMissionStatus=function(t,e,n){if(null!=t){var i=t.missionStatus;if(!(0>e||null==i)){var o=Math.floor(e/8),a=Math.floor(e%8);0>o||o>=i.length||(n?i[o]|=1<<a:i[o]&=~(1<<a))}}},t.isHaveSubmitMission=function(t,e){var n=t.missionList;if(null==n||n.length<0)return!1;for(var i=xworld.getCurMapID(),o=null,a=0;a<n.length;a++)if(null!=(o=n[a])&&0!=o.isVisibleAndSubmit(e,i)&&o.isComplete())return!0;return!1},t.prototype.getMissionRewardString=function(t,e){var n=new StringBuffer,i="";if(this.exp>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_EXP,this.exp+"  ")),e>0&&(i+="/cffcc00"+GameText.STR_MONEY1+" /p"+e+"  "),this.money2>0&&(i+="/cffcc00"+GameText.STR_MONEY2+" /p"+(this.isEscort()?"("+GameText.STR_COUNTRY_WAR_ROUND_NULL+")":this.money2+"")+"  "),this.money3>0&&(i+="/cffcc00"+GameText.STR_MONEY3+" /p"+this.money3+"  "),this.honor>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_HONOR,this.honor+"  ")),this.cityProsperity>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_CITY_PROS,this.cityProsperity+"  ")),this.cityArmy>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_CITY_ARMY,this.cityArmy+"  ")),this.countryArmy>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_ARMY,this.countryArmy+"  ")),this.countryLand>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_LAND,this.countryLand+"  ")),this.countryProsperity>0){var o="";this.promoteProsperity>0&&(o=PowerString.makeColorString("+"+this.promoteProsperity,ColorUtils.COLOR_GREEN)),i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_PROS,this.countryProsperity+o+"  ")}return this.countryPeople>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_PEOP,this.countryPeople+"  ")),this.countryWood>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_WOOD,this.countryWood+"  ")),this.countryStone>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_STONE,this.countryStone+"  ")),this.countryIron>0&&(i+=Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_IRON,this.countryIron+"  ")),0==Tool.isNullText(i)&&n.append(PowerString.makeColorString(GameText.STR_MISSION_REWARD+"：",16776960)+i),n.toString()},t.prototype.getEscortDesc=function(){var t=new StringBuffer;return t.append(this.desc),t.append("\n"),t.append("\n"),1==this.isEscort()&&null!=this.escortCost&&this.escortCost.length>=3&&this.isEscortNeedCost()&&(t.append(PowerString.makeColorString(GameText.STR_MISSION_ESCORT+"：",16776960)),t.append("\n"),this.escortCost[0]>0&&t.append(this.escortCost[0]+GameText.getMoneyText(ModelConst.MONEY1)),this.escortCost[1]>0&&t.append(this.escortCost[1]+GameText.getMoneyText(ModelConst.MONEY2)),this.escortCost[2]>0&&t.append(this.escortCost[2]+GameText.getMoneyText(ModelConst.MONEY3)),t.append("\n")),t.append(this.getMissionRewardString(!0,0)),t.toString()},t.prototype.isEscortNeedCost=function(){return null!=this.escortCost&&this.escortCost.length>0&&(this.escortCost[0]>0||this.escortCost[1]>0||this.escortCost[2]>0)},t.prototype.getSubmitDetails=function(){var t=new StringBuffer;Tool.isNullText(this.dialogStartFinish)||t.append(this.dialogStartFinish+"\n");var e=this.getConditionDesc(this.submitCondition);return 0==Tool.isNullText(e)&&(Tool.isNullText(t.toString())||t.append("\n"),t.append(PowerString.makeColorString(GameText.STR_MISSION_FINISH+"：",16776960)+e),t.append("\n")),t.append(this.getMissionRewardString(!1,0)),t.toString()},t.prototype.getDetails=function(t){var e=new StringBuffer;e.append(this.desc),e.append("\n"),1==t&&0==Tool.isNullText(this.simpleDesc)&&(e.append("("+PowerString.makeColorString(this.simpleDesc,ColorUtils.COLOR_YELLOW)+")"),e.append("\n")),e.append("\n");var n=this.getConditionDesc(this.submitCondition);return 0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(GameText.STR_NPC_MISSION_DEST,16776960)+n),e.append("\n")),e.append(this.getMissionRewardString(!0,0)),e.toString()},t.prototype.getDoingDesc=function(t){var e=new StringBuffer,n=this.getConditionDesc(this.submitCondition);return 0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(GameText.STR_NPC_MISSION_DEST,16776960)+n),e.append("\n")),1==t?e.append(this.simpleDesc+"\n"):e.append(this.dialogStartNotFinish+"\n"),e.toString()},t.prototype.getConditionDesc=function(t){if(null==t)return null;for(var e=new StringBuffer,n=null,i=0;i<t.length;i++)if(null!=(n=t[i])){var o=n.getConditionDesc();Tool.isNullText(o)||(i>0&&e.append("\n"),e.append(o))}return e.toString()},t.prototype.doAcceptEndCheck=function(e){return this.isShowGuide(),this.id==guide.MISSION_THAT_TRIGGERS_SELECT_AUTO_SKILL&&1==GameWorld.useGuide&&(GameWorld.guideNPCID=this.npcId),this.acceptBattleID>0?void xworld.toBattle(this.acceptBattleID,!0):this.acceptJumpMapID>0?void xworld.doJumpMap(this.acceptJumpMapID,this.acceptJumpMapGx,this.acceptJumpMapGy):1==this.isGuideMission()?void NPC.doMissionInfoView(xself,this,e,NPCConst.SUB_MISSION_ONE_ACCEPT):1==this.isOneKeyMission()?void t.doMissionAutoPathMsg(this):OneKeyDailyMission.isDoingOnekeyMission?void((this.isCityBulltinMission()&&0==this.isComplete()||this.id==OneKeyDailyMission.yuangusenling_data[2])&&NPC.doMissionInfoView(xself,this,e,NPCConst.SUB_MISSION_VIEW)):void 0},t.prototype.doSubmitEndCheck=function(t){if(1!=this.isGuideUsePet())if("碰我进行传送"!=t.getName()){if(!GameWorld.isHaveGuide()){if(this.submitBattleID>0)return void xworld.toBattle(this.submitBattleID,!0);if(this.submitJumpMapID>0)return void xworld.doJumpMap(this.submitJumpMapID,this.submitJumpMapGx,this.submitJumpMapGy);if(this.submitNextMissionID>0){var e=t.getMissonById(this.submitNextMissionID);return void(null!=e&&NPC.handleChoiceMissionAction(e,t))}xworld.checkOneKeyMissionFinish(!0)}}else t.doNPC();else 1==GameWorld.useGuide&&(guide.setStatusFlag(!0,guide.IS_GUIDE_BAG_PARTNER_OPEN_UI),GameWorld.setGuide(GameWorld.GUIDE_BAG_UI_OPEN),GameWorld.guideNPCID=t.getId())},t.prototype.isBattleFinish=function(){return!(!this.isComplete()||!(this.acceptBattleID>0||this.isKillMonsterMission()))},t.prototype.isKillMonsterMission=function(){return this.filterMission((function(t){return t.getType(),!(!t.isKillMonsterType&&!t.isCollectMonsterDropItemType)}),this)},t.prototype.isNestedMission=function(){return this.filterMission((function(t){return t.getType(),!!t.isNestedMissionType||void 0}),this)},t.prototype.isCityBulltinMission=function(){return null!=t.cityBulltinMissions[this.id]},t.prototype.filterMission=function(t,e){if(null==this.submitCondition)return!1;for(var n=!1,i=0;i<this.submitCondition.length;i++){var o=this.submitCondition[i];if(null!=o&&1==(n=t.call(e,o)))return n}return n},t.outPutSaveTestMission=function(){console.log("  --- 刚刚接受的任务总表为： ----------");for(var t="[",e="[",n=0;n<this.saveTestMission.length;n++){var i=this.saveTestMission[n];t+="{id:"+i.id+", name:"+i.name+"},",e+=i.id+","}t+="]",e+="]",console.log(t),console.log(" --- id列表为： ----"),console.log(e)},t.doAcceptMissionMsg=function(e,n,i){if(null==e||null==n||null==i)return!1;var o=function(o){if(PanelManager.closeWaitForServer(),0==o.getByte()){TodayEvent.checkSaveMissionID(i.id);var a={id:i.id,name:i.name};if(t.saveTestMission.push(a),MsgHandler.processMissionNPCStatus(o),0!=o.getBoolean()){if(0!=o.getByte())return void AlertPanel.errorMessage(o.getString());if(MsgHandler.processMissionReward(e,i.id,o),GameWorld.checkNPCRelaMissions(!0),PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update()}else{if(e.addMission(i),0==Tool.isNullText(i.simpleDesc)&&WorldMessage.addPromptMsg(Tool.manageString(GameText.STR_MISSION_BULLETIN,i.simpleDesc)),GameWorld.checkNPCRelaMissions(!0),i.doAcceptEndCheck(n),PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update()}}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString())},a=function(){PanelManager.openWaitForServer();var t=MsgHandler.createTaskAcceptMsg(n.getId(),i.getId());nato.Network.sendCmd(t,o,this)};i.isEscort()&&null!=i.escortCost&&3==i.escortCost.length?Model.checkEnoughMoney(i.escortCost[0],i.escortCost[1],i.escortCost[2],a,this):a()},t.doSubmitMissionMsg=function(e,n,i,o){if(null==e||null==n||null==i)return!1;if(this.doingMissionID=i.id,!(i.exp>0&&e.isTourist())){PanelManager.openWaitForServer();var a=MsgHandler.createTaskDeliverMsg(n.getId(),i.id,null!=o?o.id:-1);return nato.Network.sendCmd(a,(function(o){if(PanelManager.closeWaitForServer(),0==o.getByte()){if(MsgHandler.processMissionNPCStatus(o),MsgHandler.processMissionReward(xself,t.doingMissionID,o),e.submitMission(i),GameWorld.checkNPCRelaMissions(!0),i.doSubmitEndCheck(n),PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update();OneKeyDailyMission.checkIsEndWhileFinishMission(i.getId())}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString())}),this),!0}t.doTouristSubmitMission(e,n,i,o)},t.doDeleteMissionMsg=function(t,e){if(null==e)return!1;if(null==t.getMissionById(e.id))return!1;var n=MsgHandler.createTaskAbandonMsg(e.getId());return nato.Network.sendCmd(n,(function(n){return 0!=n.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString()):(MsgHandler.processMissionNPCStatus(n),t.deleteMission(e),GameWorld.checkNPCRelaMissionsStatus(!0,!0),void(PanelManager.isPanelShow(TaskScene)&&PanelManager.getPanel(TaskScene).updateTab()))}),this),!0},t.doMenuButton=function(e,n,i,o){var a=xself;if(null==a||null==o)return!1;var r=!1;if(i==NPCConst.EVENT_ALL_BACK)return!0;if(i==NPCConst.EVENT_ALL_TASK_DIRECT_STEP2)return NPC.doMissionInfoView(a,o,e,NPCConst.SUB_MISSION_DIRECT_STEP2),!0;if(i==NPCConst.EVENT_ALL_TASK_OFF_ACTIVATE)return t.doOffLineActivate(o);if(i==NPCConst.EVENT_ALL_TASK_ITEM_SEE)return!1;if(i==NPCConst.EVENT_MISSION_FIGHT)return o.doAcceptEndCheck(e),!0;if(i==NPCConst.EVENT_ALL_TASK_ACCEPT)r=!o.isRandomMission()&&t.doAcceptMissionMsg(a,e,o);else{if(i==NPCConst.EVENT_ALL_TASK_PATH){if(o.isCityBulltinMission()&&0==o.isComplete()){var s=t.cityBulltinMissions[o.getId()];return AutoGamer.requestAutoFindPath(s.mapid,s.npcid),void PanelManager.closeScene(!0)}return t.doMissionAutoPathMsg(o)}if(i==NPCConst.EVENT_ALL_TASK_DEL)if(o.isRandomMission())r=!1;else{AlertPanel.alert(GameText.getText(GameText.TI_DELECT_MISSION),Tool.manageString(GameText.STR_MISSION_DEL_ASK,o.name),(function(){t.doDeleteMissionMsg(a,o)}),this),r=!1}else if(i==NPCConst.EVENT_ALL_RANDOM_MISSION_REFLASH);else if(i==NPCConst.EVENT_ALL_TASK_SUBMIT){if(o.isRandomMission());else{if(o.isHasSelectItem()&&null==n)for(var l=0;l<o.selectItems.length;l++)if(null!=o.selectItems[l]){n=o.selectItems[l];break}r=t.doSubmitMissionMsg(a,e,o,n)}GuideHandler.checkMissionSubmitGuide(o)}}return r},t.doMissionAutoPathMsg=function(e){var n=MsgHandler.createAutoMoveMsgByMisssion(e.id);return nato.Network.sendCmd(n,t.onMissionAutoPathMsg,this),!0},t.doMissionAutoPathMsgByID=function(e){var n=MsgHandler.createAutoMoveMsgByMisssion(e);return nato.Network.sendCmd(n,t.onMissionAutoPathMsg,this),!0},t.onMissionAutoPathMsg=function(e){var n=xself;if(null!=n){var i=e.getByte();if(0>i){var o=e.getString();return void(i!=t.AUTO_MOVE_ERROR26&&i!=t.AUTO_MOVE_ERROR27?AlertPanel.alertCommon(o):(xworld.setAutoMissionFindPath(!0),PanelManager.closeScene(!0)))}n.fromBytesByAutoMove(e),xworld.setAutoMissionFindPath(!0),PanelManager.isPanelShow(TaskScene)&&PanelManager.closeScene(!0)}},t.prototype.getOffsetLineDesc=function(){var t=new StringBuffer;return t.append(this.desc),t.append("\n"),t.append("\n"),t.append(Tool.manageString(GameText.STR_MISSION_OFFSET_LINE_DESC,PowerString.makeColorString(Tool.getTimeStrByMin(this.honor,!1),ColorUtils.COLOR_GREEN))),t.toString()},t.doOffLineList=function(e){var n=MsgHandler.createTaskOffLineListMsg();nato.Network.sendCmd(n,(function(n){var i=n.getByte();if(0>=i)AlertPanel.alertCommon(GameText.STR_MISSION_OFFSET_LINE_NULL);else{for(var o=[],a=[],r=0;i>r;r++){var s=new t(n.getShort());s.name=n.getString(),s.desc=n.getString(),s.honor=n.getShort(),o.push(s);var l=new NPCActionData(s.name,10,s,NPCActionData.Type_off_mission);a.push(l)}l=new NPCActionData(GameText.getText(GameText.TI_QUIT),7,null);a.push(l),PanelManager.openNPCDialogue(e.name,e.talkDetail,a,null,null,e)}}),this)},t.doOffLineActivate=function(t){if(null==t)return!1;var e=function(t){MsgHandler.isMessageHaveError(t)||GameWorld.doOpenPlayerList()};return AlertPanel.alert(GameText.STR_MISSION_OFFSET_LINE,GameText.STR_MISSION_OFFSET_LINE_ASK,(function(){var n=MsgHandler.createTaskOffLineActivateMsg(t.id);nato.Network.sendCmd(n,e,this)}),this),!0},t.checkBattleMissionFinish=function(){var e=!1;return null!=t.curUpdateMission&&(t.curUpdateMission.isBattleFinish()&&0==GameWorld.isSpecialStatus()&&(t.doMissionAutoPathMsg(t.curUpdateMission),e=!0),t.curUpdateMission=null),e},t.prototype.getUnCompleteKillMonsterCondition=function(){if(null==this.submitCondition)return null;for(var t,e=this.submitCondition.length,n=0;e>n;n++)if((t=this.submitCondition[n].getKillMonsterCondition())&&!t.isComplete)return t;return null},t.prototype.getUnCompleteCollectionCondition=function(){if(null==this.submitCondition)return null;for(var t,e=this.submitCondition.length,n=0;e>n;n++)if((t=this.submitCondition[n].getCollectItemCondition())&&!t.isComplete)return t;return null},t.doTouristSubmitMission=function(e,n,i,o){function a(){GameWorld.doModifyTourist(!0,!1)}function r(){PanelManager.openWaitForServer();var t=MsgHandler.createTaskDeliverMsg(n.getId(),i.id,null!=o?o.id:-1);nato.Network.sendCmd(t,_,l)}var s=new nato.Message(ProtocolDefine.CG_ACTOR_IS_TOURIST);nato.Network.sendCmd(s,(function(t){if(t.getBoolean()){var e=t.getString();AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),e,a,this,r)}else r()}),this);var l=this,_=function(o){return PanelManager.closeWaitForServer(),0!=o.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString()):(MsgHandler.processMissionNPCStatus(o),MsgHandler.processMissionReward(xself,t.doingMissionID,o),e.submitMission(i),GameWorld.checkNPCRelaMissions(!0),void i.doSubmitEndCheck(n))}},t.getSourceByMissionStatus=function(t){return t==MissionConst.CAN_SUBMIT?"task_finish":t==MissionConst.NOT_CAN_SUBMIT?"task_unfinish":t==MissionConst.CAN_ACCEPT?"task_can_accept":t==MissionConst.NOT_CAN_ACCEPT?"task_not_accept":null},t.newRadarMapID=0,t.newRadarGx=0,t.newRadarGy=0,t.cityBulltinMissions={3060:{name:"精灵之森林初阶段",mapid:254,npcid:101},3061:{name:"月牙山初阶任务",mapid:22,npcid:1},3062:{name:"封印墓地初阶任务",mapid:914,npcid:101},3063:{name:"汉王古墓初阶任务",mapid:813,npcid:3},3064:{name:"精灵之森林中级任务",mapid:254,npcid:101},3065:{name:"月牙山中级任务",mapid:22,npcid:1},3066:{name:"封印墓地中级任务",mapid:914,npcid:101},3067:{name:"汉王古墓中级任务",mapid:813,npcid:3},3068:{name:"精灵之森林高级任务",mapid:254,npcid:101},3069:{name:"月牙山高级任务",mapid:22,npcid:1},3070:{name:"封印古墓高级任务",mapid:914,npcid:101},3071:{name:"汉王古墓高级任务",mapid:813,npcid:3},3072:{name:"绝望冰原中级任务",mapid:920,npcid:101},3073:{name:"失魂沙漠中级任务",mapid:820,npcid:5},3074:{name:"绝望冰原高级任务",mapid:920,npcid:101},3075:{name:"失魂沙漠高级任务",mapid:820,npcid:5}},t.saveTestMission=[],t.doingMissionID=0,t.AUTO_MOVE_ERROR26=-26,t.AUTO_MOVE_ERROR27=-27,t}();__reflect(Mission.prototype,"Mission");var ModelConst=function(){function t(){}return t.getAttributeName=function(e){switch(e){case t.STR:return GameText.STR_ATTR_STR;case t.CON:return GameText.STR_ATTR_CON;case t.AGI:return GameText.STR_ATTR_AGI;case t.ILT:return GameText.STR_ATTR_ILT;case t.WIS:return GameText.STR_ATTR_WIS}},t.EXP=0,t.EXPMAX=1,t.HP=2,t.MP=3,t.CP=4,t.SP=5,t.STR=6,t.CON=7,t.AGI=8,t.ILT=9,t.WIS=10,t.MONEY1=11,t.MONEY2=12,t.MONEY3=13,t.NUM_BAG=14,t.NUM_STROE=15,t.COUNTRY_HONOR=16,t.CITY_ID=17,t.KILL_COUNT=18,t.PK_WIN_COUNT=19,t.PK_LOSE_COUNT=20,t.TOTAL_ONLINE=21,t.PARTNER_ID=22,t.MASTER_ID=23,t.APPRENTICE1=24,t.APPRENTICE2=25,t.APPRENTICE3=26,t.APPRENTICE4=27,t.APPRENTICE5=28,t.HPMAX=29,t.MPMAX=30,t.SPEED=31,t.ATK_TYPE=32,t.ATK_MIN=33,t.ATK_MAX=34,t.ATK_TIME=35,t.ATK_STR=36,t.ATK_AGI=37,t.ATK_MAGIC=38,t.DEF_STR=39,t.DEF_AGI=40,t.DEF_MAGIC=41,t.DODGE=42,t.HIT_RATE=43,t.HIT_MAGIC=44,t.CRITICAL=45,t.FORCE_HIT=46,t.EXP_UP=47,t.WIL=48,t.TOUGH=49,t.BLOCK=51,t.BRK_ARMOR=52,t.INSIGHT=53,t.DEF_FIELD=54,t.BACK=55,t.MAGIC_BACK=56,t.LIFE_ABSORPTION=57,t.MANA_ABSORPTION=58,t.MAGIC_PENETRATION=59,t.HEAL_RECOVERY=60,t.MANA_RECOVERY=61,t.RECOVERY=62,t.ARGO=63,t.BACK_MAX=64,t.MASTER_FLAG=65,t.HELP_COUNTRY=66,t.LOVE_PLAYER=67,t.INTEGRAL=68,t.PARTNER_NAME=69,t.LEFT_WEAPON_TYPE=71,t.RIGHT_WEAPON_TYPE=72,t.LEFT_ATK_MIN=73,t.LEFT_ATK_MAX=74,t.RIGHT_ATK_MIN=75,t.RIGHT_ATK_MAX=76,t.LEFT_ATK_TIME=77,t.RIGHT_ATK_TIME=78,t.WEAPON_DAMAGE_PERCENT=79,t.PET_COLOR=81,t.PET_GRADE=82,t.PET_GROW_LEVEL=83,t.BUFFER_REMOVE_STATUS=90,t.HP_DISPLAY=91,t.MP_DISPLAY=92,t.UID=101,t.ID=102,t.SEX=103,t.RACE=104,t.JOB=105,t.LEVEL=106,t.ICON=107,t.SETTING=108,t.STATUS=109,t.COUNTRY_ID=110,t.COUNTRY_RANK=111,t.COUNTRY_NAME=112,t.PX=113,t.PY=114,t.COUNTRY_RANK_SET=115,t.COUNTRY_ID_SET=116,t.STATUS_SET=117,t.LEVEL2=118,t.EXP2=119,t.EXPMAX2=120,t.ENCHANTVALUE=121,t.IGNORE_BACK=200,t.IGNORE_MAGIC_BACK=201,t.IGNORE_BLOCK=202,t.IGNORE_INSIGHT=203,t.IGNORE_WIL=204,t.IGNORE_TOUCH=205,t.KEEPOUT_ATK_TIME=250,t.SET_EXP=5001,t.SET_EXPMAX=5002,t.SET_EXP2=5003,t.SET_EXPMAX2=5004,t.MAX_STORE_NUM=60,t.MAX_PLAYER_HP=9999999,t.MAX_PLAYER_MP=9999999,t.MAX_MOSTER_HP=5e6,t.MAX_BASE_ATTRIBUTE=32767,t.MAX_OTHER_ATTRIBUTE=1e6,t.MAX_DEF=65535,t.MAX_PROBABILITY=100,t.MIN_HIT_RATE=30,t.MIN_HIT_MAGIC=20,t.MIN_FORCE_HITRATE=30,t.MAX_FORCE_RATE=70,t.MIN_HIT_TIME=1,t.MAX_HIT_TIME=99,t.MAX_ATK=99999999,t.MAX_KEEPOUT_ATK_TIME=100,t.MAX_OTHER_PROBABILITY=1e3,t.MIN_DEF_FIELD=-999999,t.MIN_HEAL_RECOVERY=-999999,t.MIN_MANA_RECOVERY=-999999,t.COUNTRY_FFLAG_IS_VIP=1,t.COUNTRY_FFLAG_IS_VIP_CQ=2,t.COUNTRY_MEMBER_IS_VIP=1,t.COUNTRY_MEMBER_IS_VIP_CQ=2,t.STATUS_NONE=0,t.STATUS_ONLINE=1,t.STATUS_ALL_DEL=2,t.STATUS_TEMP_DEL=4,t.STATUS_FROST=8,t.STATUS_SELL=16,t.STATUS_ENGAGE=32,t.STATUS_CLOSE=64,t.STATUS_MOUTH=128,t.STATUS_COMMENTS=256,t.STATUS_OFFLINEMISSION=512,t.STATUS_VIP=1024,t.STATUS_IS_CARD=2048,t.STATUS_CAN_MASTER=4096,t.STATUS_IS_SOLDIER=8192,t.STATUS_IS_HELP=16384,t.STATUS_IS_PHOTO=32768,t.STATUS_IS_GM=65536,t.STATUS_IS_CITY=1<<17,t.STATUS_IS_TEACHER=1<<18,t.STATUS_VIP_TX_CQ=1<<19,t.STATUS_IS_TOURIST=1<<20,t.STATUS_IS_ROBOT=1<<21,t}();__reflect(ModelConst.prototype,"ModelConst");var ScenePanelBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"prevPanel",{get:function(){for(var t=0;t<e._prevPanelList.length;t++)if(e._prevPanelList[t].panel==this)return e._prevPanelList[t].prevPanel;return null},set:function(t){var n={};n.panel=this,n.prevPanel=t,e._prevPanelList.push(n)},enumerable:!0,configurable:!0}),e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.removePanel=function(){this.parent&&(this.parent.removeChild(this),e._prevPanelList.length>0&&e._prevPanelList[e._prevPanelList.length-1].panel==this&&(PanelManager.openScene(this.prevPanel),e._prevPanelList.pop()))},e._prevPanelList=[],e}(WindowPanelBase);__reflect(ScenePanelBase.prototype,"ScenePanelBase");var TabPanelBase=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"tabIndex",{set:function(t){this._tabIndex=t,this.updateTab()},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[];for(var n=0;this["tabBtn_"+n];){var i=this["tabBtn_"+n];this.tabBtnLabel&&this.tabBtnLabel[n]&&(i.label=this.tabBtnLabel[n]),this._tabBtnList.push(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this),n++}this.updateTab()},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this.tabPanelList)for(var n=this.tabPanelList.length-1;n>=0;n--)this.tabPanelList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)},e.prototype.setTabBtnLabel=function(t){var e=0;for(this.tabBtnLabel=t;this["tabBtn_"+e];){var n=this["tabBtn_"+e];if(!this.tabBtnLabel||!this.tabBtnLabel[e])break;n.label=this.tabBtnLabel[e],e++}},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel();var t=this.getCurrentPanel();t&&(this.addChild(t),"update"in t&&t.update())},e.prototype.getCurrentPanel=function(){return this.tabPanelList?this.tabPanelList[this._tabIndex]:null},e.prototype.closePanel=function(){this._tabIndex=0,PanelManager.closeScene()},e.prototype.removeAllPanel=function(){if(this.tabPanelList)for(var t=this.tabPanelList.length-1;t>=0;t--)this.tabPanelList[t].parent&&this.tabPanelList[t].parent.removeChild(this.tabPanelList[t])},e}(WindowPanelBase);__reflect(TabPanelBase.prototype,"TabPanelBase");var Monster=function(t){function e(){var e=t.call(this)||this;return e.atkType=0,e.monstertype=0,e.bornStatus=0,e.rewardMoney=0,e.rewardExp=0,e.monsterAI=null,e.setType(2),e}return __extends(e,t),e.prototype.setAI=function(t){this.monsterAI=t},e.prototype.checkBattleMsg=function(){null!=this.monsterAI&&(Tool.isNullText(this.message)||"0"==this.message||(this.dialogAIFrame=new MessageFrame(this.message),this.dialogAIFrame.setDrawCount(30),this.dialogAIFrame.show(),this.dialogAIFrame.setScale(nato.mapRatio),this.dialogAIFrame.x=this.battleSprite.x-this.dialogAIFrame.width/2*xhdRatio,this.dialogAIFrame.y=this.battleSprite.y-(this.battleSprite.height+this.dialogAIFrame.height)*xhdRatio,BattleView.instance.addChild(this.dialogAIFrame),this.message=null))},e.prototype.getAITargetPos=function(){return null==this.monsterAI?-1:this.monsterAI.targetPos},e.prototype.getAttackTarget=function(t){return null==t?-1:null!=this.monsterAI&&t.isValidPos(this.monsterAI.targetPos)?this.monsterAI.targetPos:MonsterAI.selectValueTarget(t,this,Define.AI_HATE_MAX,!0)},e.prototype.getSkillByAI=function(t,e){if(null==t)return null;if(null==this.monsterAI)return null;if(e)return this.monsterAI.getAutoSkill(t,this);var n=this.monsterAI.getBattleSkill(t,this);return null==n||n.useMP>this.get(ModelConst.MP)?null:n.isEnoughHP(this)?n:null},e.prototype.setBattleStatus=function(e){return(e==Player.BSTATUS_ESCAPE||!this.isBornStatus(e)||Define.getBufferType(e,!0)!=Define.BUFFER_TYPE_DEBUFF)&&t.prototype.setBattleStatus.call(this,e)},e.prototype.isBattleStatus=function(e){return!(e==Player.BSTATUS_ESCAPE||!this.isBornStatus(e)||Define.getBufferType(e,!0)!=Define.BUFFER_TYPE_BUFF&&e!=Define.getBufferBitValue(Define.BUFFER_DIE_CANNOT_RELIVE))||t.prototype.isBattleStatus.call(this,e)},e.prototype.isBornStatus=function(t){return 0!=(this.bornStatus&t)},e.prototype.get=function(e){switch(e){case ModelConst.ATK_TYPE:return this.getAttackType();case ModelConst.HPMAX:return this.hpMax;case ModelConst.MPMAX:return this.mpMax;case ModelConst.SPEED:return this.speed;case ModelConst.DODGE:return this.dodge;case ModelConst.LEFT_ATK_MIN:return Tool.sumValue(this.atkMin,0,0,ModelConst.MAX_ATK);case ModelConst.LEFT_ATK_MAX:return Tool.sumValue(this.atkMax,0,0,ModelConst.MAX_ATK);case ModelConst.RIGHT_ATK_MIN:case ModelConst.RIGHT_ATK_MAX:return 0;case ModelConst.LEFT_ATK_TIME:case ModelConst.ATK_TIME:return Tool.sumValue(this.atk_time+1,0,ModelConst.MIN_HIT_TIME,ModelConst.MAX_HIT_TIME);case ModelConst.RIGHT_ATK_TIME:return 0;case ModelConst.ATK_STR:return this.atk_str;case ModelConst.ATK_AGI:return this.atk_agi;case ModelConst.ATK_MAGIC:return this.atk_magic;case ModelConst.DEF_STR:return this.def_str;case ModelConst.DEF_AGI:return this.def_agi;case ModelConst.DEF_MAGIC:return this.def_magic;case ModelConst.WIL:return this.wil;case ModelConst.TOUGH:return this.tough;case ModelConst.BLOCK:return this.block;case ModelConst.BRK_ARMOR:return this.brkArmor;case ModelConst.MAGIC_PENETRATION:return this.magic_penetration;case ModelConst.INSIGHT:return this.insight;case ModelConst.DEF_FIELD:return this.def_field;case ModelConst.BACK:return this.back;case ModelConst.MAGIC_BACK:return this.magic_back;case ModelConst.LIFE_ABSORPTION:return this.life_absorption;case ModelConst.MANA_ABSORPTION:return this.mana_absorption;case ModelConst.FORCE_HIT:return ModelConst.MIN_FORCE_HITRATE;case ModelConst.BACK_MAX:return 100;default:return t.prototype.get.call(this,e)}},e.prototype.getAttackType=function(){return this.atkType},e.prototype.getAttakAnimePos=function(){return this.atkType==Define.ATKTYPE_STR||this.atkType==Define.ATKTYPE_AGI?Define.SKILL_POS_FRONT:Define.SKILL_POS_STAND},e.fromMonsterBytes=function(t,e){var n=e.getInt();return 0>n?null:(t.id=n,t.playerName=e.getString(),t.icon1=e.getInt(),t.level=e.getByte(),t.monstertype=e.getByte(),t.hpMax=e.getInt(),t.mpMax=e.getInt(),t.speed=65535&e.getShort(),t.atkType=e.getByte(),t.atkMin=65535&e.getShort(),t.atkMax=65535&e.getShort(),t.atk_time=e.getByte(),t.dodge=e.getShort(),t.atk_str=65535&e.getShort(),t.atk_agi=65535&e.getShort(),t.atk_magic=65535&e.getShort(),t.def_str=65535&e.getShort(),t.def_agi=65535&e.getShort(),t.def_magic=65535&e.getShort(),t.hitrate=e.getShort(),t.hitMagic=e.getShort(),t.critical=e.getShort(),t.wil=e.getShort(),t.tough=e.getShort(),t.block=e.getShort(),t.brkArmor=e.getShort(),t.insight=e.getShort(),t.def_field=e.getShort(),t.back=e.getShort(),t.magic_back=e.getShort(),t.life_absorption=e.getShort(),t.mana_absorption=e.getShort(),t.magic_penetration=e.getShort(),t.bornStatus=e.getInt(),t)},e.prototype.getClone=function(){var t=new e;return this.setMonsterData(t),t},e.prototype.setMonsterData=function(t){t.id=this.id,t.playerName=this.playerName,t.icon1=this.icon1,t.icon2=this.icon2,t.icon3=this.icon3,t.level=this.level,t.monstertype=this.monstertype,t.hpMax=this.hpMax,t.mpMax=this.mpMax,t.speed=this.speed,t.atkType=this.atkType,t.atkMin=this.atkMin,t.atkMax=this.atkMax,t.dodge=this.dodge,t.atk_time=this.atk_time,t.atk_str=this.atk_str,t.atk_agi=this.atk_agi,t.atk_magic=this.atk_magic,t.def_str=this.def_str,t.def_agi=this.def_agi,t.def_magic=this.def_magic,t.hitrate=this.hitrate,t.hitMagic=this.hitMagic,t.critical=this.critical,t.wil=this.wil,t.tough=this.tough,t.block=this.block,t.brkArmor=this.brkArmor,t.insight=this.insight,t.def_field=this.def_field,t.back=this.back,t.magic_back=this.magic_back,t.life_absorption=this.life_absorption,t.mana_absorption=this.mana_absorption,t.magic_penetration=this.magic_penetration,t.bornStatus=this.bornStatus,t.rewardMoney=this.rewardMoney,t.rewardExp=this.rewardExp,t.monsterAI=this.monsterAI},e.prototype.isHaveCanNotReliveBuffer=function(){return!!this.isBornStatus(Define.getBufferBitValue(Define.BUFFER_DIE_CANNOT_RELIVE))||t.prototype.isHaveCanNotReliveBuffer.call(this)},e}(Player);__reflect(Monster.prototype,"Monster");var Escort=function(){function t(){this.timeX=0,this.timeY=0,this.favourerStatus=0,this.id=0,this.money1=0,this.money2=0,this.money3=0,this.type=t.ESCORT_TURN_FAVOURER,this.status=0,this.nextMoveTime=0,this.nextOverTime=0,this.nextUpdateTime=0,this.moveCount=0,this.moveMaxCount=0,this.moveTime=0,this.moveStartTime=0,this.moveDirX=0,this.moveDirY=0,this.isInitPos=!1,this._logicCount=0}return t.prototype.setStatus=function(t,e){this.status=Tool.setBit(t,e,this.status)},t.prototype.isStatus=function(t){return Tool.isBit(t,this.status)},t.prototype.setRobMove=function(e){e==t.ESCORT_TURN_HUN?(this.setStatus(!0,t.STATUS_ROB_MOVE),this.setStatus(!1,t.STATUS_MOVE)):this.setStatus(!1,t.STATUS_ROB_MOVE)},t.prototype.isRobMove=function(){return this.isStatus(t.STATUS_ROB_MOVE)},t.prototype.setTimeXY=function(t,e){this.timeX=t,this.timeY=e},t.getModelListDesc=function(t){for(var e=new StringBuffer,n=0;n<t.length;n++){var i=t[n];null!=i&&(e.append(i.getName()),0==n?e.append("("+GameText.STR_LEADER+")"):3==i.getType()?e.append("("+GameText.STR_MEMBER+")"):5==i.getType()&&e.append("("+GameText.getText(GameText.TI_MERCENARY)+")"),e.append("    "),e.append(Tool.manageString(GameText.getText(GameText.TI_LEVEL),i.getLevel()+"")),e.append(Define.getJobString(i.getJob())),e.append("\n"))}return e.toString()},t.prototype.clearAutoMove=function(){this.moveCount=this.moveMaxCount=0},t.fromBytes=function(e,n){for(var i=e.getByte(),o=e.getByte(),a=e.getInt(),r=e.getInt(),s=this.getMoveList(i,o,e.getInt()),l=[],_=0;_<t.uiRow;_++){for(var h=new Array(t.uiCol),u=0;u<t.uiCol;u++){var c=!1;_>=0&&_<=s.length-1&&u>=0&&u<=s[_].length-1&&(c=s[_][u]),h[u]=c}l.push(h)}var T=e.getShort(),p=e.getByte(),d=e.getByte(),E=[];for(_=0;i>_;_++){var g=[];for(u=0;o>u;u++)g[u]=e.getByte();E.push(g)}var S=[];for(_=0;i>_;_++){var m=[];for(u=0;o>u;u++){var f=-1;_>=0&&_<=E.length-1&&u>=0&&u<=E[_].length-1&&(f=E[_][u]),m[u]=f}S.push(m)}var I=0,A=0,y=0,R=0,P=0,C=0,M=e.getByte();if(M==t.ESCORT_TURN_HUN)R=e.getInt(),P=e.getInt(),C=e.getInt(),I=e.getByte(),A=e.getByte(),y=e.getByte();else{xself.clearFightPower();for(var L=e.getByte(),v=0;L>v;v++)xself.addFightPower(e.getShort(),e.getShort());xself.checkHPMP()}var O=p,N=d,D=GameWorld.getEscort();return(null==D||D.type!=M)&&((D=new t).type=M,M==t.ESCORT_TURN_HUN&&(D.setRobMove(I),D.robEscortModel=new ListPlayer,D.robEscortModel.setDir(1),D.robEscortModel.setPlayerSprite(GameSprite.cloneSprite(n)),D.robEscortModel.setAnimationByDir(!1),D.robEscortModel.setGridXY(y,A),D.robEscortModel.scaleX=D.robEscortModel.scaleY=xhd?1.5:1,O=y,N=y,n=SpriteHelper.createSpriteByIcon(R,P,C,!1)),D.escortModel=new ListPlayer,D.escortModel.setDir(0),D.escortModel.setGridXY(d,p),D.escortModel.setPlayerSprite(GameSprite.cloneSprite(n)),D.escortModel.setAnimationByDir(!1),D.escortModel.scaleX=D.escortModel.scaleY=xhd?1.5:1),D.round=T,D.moveList=l,D.moveList[O][N]=!0,D.eventList=S,D.eventList[0][0]=t.IMAGE_START,D.eventList[i-1][o-1]=t.IMAGE_END,D.nextMoveTime=Tool.currentTime+a,D.nextOverTime=Tool.currentTime+r,D.nextUpdateTime=Tool.currentTime+t.POST_UPDATE_TIME,D},t.prototype.isMoveIndex=function(t){return this.isMove(this.getRowByIndex(t),this.getColByIndex(t))},t.prototype.isMove=function(t,e){return!(0>t||t>=this.moveList.length)&&(!(0>e||e>=this.moveList[t].length)&&this.moveList[t][e])},t.prototype.setMove=function(t,e){0>t||t>=this.moveList.length||0>e||e>=this.moveList[t].length||(this.moveList[t][e]=!0)},t.prototype.setAbsByGWidget=function(t,e,n,i,o){null!=o&&o.setPos(t+n/2,e+i/2)},t.prototype.isMoveTime=function(){return Tool.getPlanTime(this.nextMoveTime)<=0},t.prototype.isOverTimeMove=function(){return Tool.getPlanTime(this.nextOverTime)<=0},t.prototype.refreshTime=function(t,e){var n=Tool.currentTime;this.nextMoveTime=n+t,this.nextOverTime=n+e},t.prototype.getEventList=function(){return this.eventList},t.prototype.getEventImage=function(e){var n=this.getRowByIndex(e),i=this.getColByIndex(e),o=this.eventList[n];if(null==o||0==o.length)return t.IMAGE_NO_PASS;if(o[i]<0)return t.IMAGE_NO_PASS;var a=this.getEvent(n,i);return 0==this.isMove(n,i)&&a!=t.IMAGE_END&&(a=t.IMAGE_DEFAULT),a},t.prototype.getEvent=function(t,e){var n=this.eventList[t];return null==n||0==n.length?-1:this.eventList[t][e]},t.prototype.isNearGird=function(t){var e=this.getRowByIndex(t),n=this.getColByIndex(t);return Math.abs(this.getNowRow()-e)+Math.abs(this.getNowCol()-n)==1},t.prototype.isNowGird=function(t){var e=this.getRowByIndex(t),n=this.getColByIndex(t);return this.getNowRow()==e&&this.getNowCol()==n},t.prototype.getAllRow=function(){return this.moveList.length},t.prototype.getAllCol=function(){return this.moveList[0].length},t.prototype.getRowByIndex=function(t){return Math.floor(t/this.getAllRow())},t.prototype.getColByIndex=function(t){return t%this.getAllCol()},t.prototype.getIndexNow=function(t){return null!=t?t.getGridY()*this.getAllCol()+t.getGridX():-1},t.prototype.getNowRow=function(){return this.type==t.ESCORT_TURN_FAVOURER&&null!=this.escortModel?this.escortModel.getGridY():this.type==t.ESCORT_TURN_HUN&&null!=this.robEscortModel?this.robEscortModel.getGridY():0},t.prototype.getNowCol=function(){return this.type==t.ESCORT_TURN_FAVOURER&&null!=this.escortModel?this.escortModel.getGridX():this.type==t.ESCORT_TURN_HUN&&null!=this.robEscortModel?this.robEscortModel.getGridX():0},t.prototype.setNowGird=function(t,e,n){var i=null;if(null!=(i=1==n?this.getEscortModel():this.getEscortRobModel())){var o=i.getGridX(),a=i.getGridY();i.setGridXY(e,t);var r=this.getIndexNow(i);-1==r&&(r=n?0:15);var s=PanelManager.getPanel(EscortScene).getItemByIndex(r),l=s.x+s.parent.x,_=s.y+s.parent.y,h=s.width,u=s.height;if(0==n)this.setAbsByGWidget(l,_,h,u,i);else{if(i.getGridX()==o&&i.getGridY()==a)return;var c=l+h/2,T=_+u/2,p=0,d=0,E=0;c==i.x&&T<i.y?(p=Math.abs(i.y-T),E=-1):c==i.x&&T>i.y?(p=Math.abs(T-i.y),E=1):c<i.x&&T==i.y?(p=Math.abs(i.x-c),d=-1):c>i.x&&T==i.y&&(p=Math.abs(c-i.x),d=1);var g=Tool.currentTime;(0!=d||0!=E)&&h+u>p?(this.moveCount=0,this.moveMaxCount=p,this.moveTime=Math.ceil((this.nextMoveTime-g)/p),this.moveStartTime=g,this.moveDirX=2*d,this.moveDirY=2*E):this.setAbsByGWidget(l,_,h,u,i)}}},t.prototype.updateGirdPos=function(){var t=this.getEscortModel();if(null!=t){t.setAnimationByDir(!1),this.clearAutoMove();var e=this.getIndexNow(t);0>e&&(e=0);var n=PanelManager.getPanel(EscortScene,!1);if(n&&n.stage){var i=n.getItemByIndex(e);if(i&&i.parent){var o=i.x+i.parent.x,a=i.y+i.parent.y,r=i.width,s=i.height;this.setAbsByGWidget(o,a,r,s,t)}}}},t.prototype.initModelPositon=function(){if(!this.isInitPos){if(this.isInitPos=!0,this.escortModel){-1==(o=this.getIndexNow(this.escortModel))&&(o=0);var t=(a=PanelManager.getPanel(EscortScene).getItemByIndex(o)).x+a.parent.x,e=a.y+a.parent.y,n=a.width,i=a.height;this.setAbsByGWidget(t,e,n,i,this.escortModel)}if(this.robEscortModel){var o;-1==(o=this.getIndexNow(this.robEscortModel))&&(o=15);var a;t=(a=PanelManager.getPanel(EscortScene).getItemByIndex(o)).x+a.parent.x,e=a.y+a.parent.y,n=a.width,i=a.height;this.setAbsByGWidget(t,e,n,i,this.robEscortModel)}}},t.prototype.getHunInfo=function(){switch(this.favourerStatus){case t.ESCORT_STATE_FAVOURER_NORMAL:return GameText.STR_ESCORT_STATE_FAVOURER_NORMAL;case t.ESCORT_STATE_FAVOURER_BATTLE:return GameText.STR_ESCORT_STATE_FAVOURER_BATTLE;case t.ESCORT_STATE_FAVOURER_OFFLINE:return GameText.STR_ESCORT_STATE_FAVOURER_OFFLINE;default:return""}},t.prototype.logic=function(){this._logicCount+=1,this._logicCount>1e3&&(this._logicCount=0),0==Tool.isNullText(this.battleMsg)&&(this.battleMsg=Tool.convertLastLinefeed(this.battleMsg),AlertPanel.alertNotify(GameText.getText(GameText.TI_MISSION_REWARD),this.battleMsg,null,null,PopUpManager.CloseType.NONE),this.battleMsg=null);var e=Tool.currentTime;if(null!=this.escortModel){if(this.escortModel.logic(this._logicCount),this.moveCount<this.moveMaxCount&&this.moveStartTime+this.moveCount*this.moveTime<e){this.moveCount++;var n=MapTool.getDirByMovePixels(this.moveDirX,this.moveDirY,!1);this.escortModel.getDir()!=n&&this.escortModel.setDir(n),this.escortModel.setAnimationByDir(!0),this.escortModel.moveByPixel(this.moveDirX,this.moveDirY),this.moveCount==this.moveMaxCount&&(this.escortModel.setAnimationByDir(!1),this.updateGirdPos())}1==this.isMoveTime()&&0==this.isOverTimeMove()?1!=this.isStatus(t.STATUS_UPDATE_POS)&&(this.setStatus(!0,t.STATUS_UPDATE_POS),this.updateGirdPos()):this.setStatus(!1,t.STATUS_UPDATE_POS)}if(null!=this.robEscortModel&&this.robEscortModel.logic(this._logicCount),!(e<this.nextUpdateTime)){var i=MsgHandler.createEscortRefreshMsg(this.round);nato.Network.sendCmd(i,(function(e){GameWorld.isEscortStatus()&&t.processEscortRefreshMsg(e,GameWorld.getEscort())}),this),this.nextUpdateTime=e+t.POST_UPDATE_TIME}},t.getMoveList=function(t,e,n){for(var i=[],o=0,a=0;t>a;a++){for(var r=[],s=0;e>s;s++){var l=1<<o++;r.push(0!=(n&l))}i.push(r)}return i},t.prototype.setId=function(t){this.id=t},t.prototype.getId=function(){return this.id},t.prototype.setSimpleDesc=function(t){this.simpleDesc=t},t.prototype.getSimpleDesc=function(){return this.simpleDesc},t.prototype.getTeamDesc=function(){return this.teamDesc},t.prototype.setTeamDesc=function(t){this.teamDesc=t},t.prototype.setMoney1=function(t){this.money1=t},t.prototype.getMoney1=function(){return this.money1},t.prototype.setMoney2=function(t){this.money2=t},t.prototype.getMoney2=function(){return this.money2},t.prototype.setMoney3=function(t){this.money3=t},t.prototype.getMoney3=function(){return this.money3},t.prototype.setBattleMsg=function(t){this.battleMsg=t},t.prototype.getBattleMsg=function(){return this.battleMsg},t.prototype.getEscortModel=function(){return this.escortModel},t.prototype.getEscortRobModel=function(){return this.robEscortModel},t.isCanMove=function(e,n){if(xself.isMember())return AlertPanel.alertCommon(GameText.STR_ESCORT_MOVE_IS_MEMBER),!1;if(null!=e.getEscortRobModel()){if(0==e.isRobMove())return AlertPanel.alertCommon(GameText.STR_ESCORT_ROB_MOVE),!1}else{if(0==e.isMoveTime())return AlertPanel.alertCommon(GameText.STR_ESCORT_MOVE_COOL),!1;if(e.isOverTimeMove())return AlertPanel.alertCommon(GameText.STR_ESCORT_MOVE_TIME_OUT),!1}return 1==e.isStatus(t.STATUS_MOVE)?(AlertPanel.alertCommon(GameText.STR_ESCORT_STATUS_MOVE),!1):e.isNowGird(n)?(AlertPanel.alertCommon(GameText.STR_ESCORT_NOW_GRIRD),!1):0!=e.isNearGird(n)||(AlertPanel.alertCommon(GameText.STR_ESCORT_NEAR_GRIRD),!1)},t.doEscortMove=function(e,n){if(null==e)return!1;if(0==this.isCanMove(e,n))return!1;var i=e.getRowByIndex(n),o=e.getColByIndex(n);e.setStatus(!0,t.STATUS_MOVE);var a=function(n){t.doEscortEventMsg(e,n)},r=MsgHandler.createEscortMoveMsg(i,o);return nato.Network.sendCmd(r,(function(n){PanelManager.closeWaitForServer();var i=n.getByte();if(0>i)AlertPanel.errorMessage(n.getString());else{var o=i;if(0>=o)t.clearRefreshTime(e);else{e.eventContent=n.getString(),e.eventID=new Array(o),e.eventButton=new Array(o);for(var r,s=[],l=0;o>l;l++)e.eventID[l]=n.getShort(),e.eventButton[l]=n.getString(),r=new MenuActionData(e.eventButton[l],e.eventID[l]),s.push(r);e.refreshTime(n.getInt(),n.getInt()),PanelManager.openSelectMenuPanel(e.eventContent,s,a,this,PopUpManager.CloseType.NONE)}}}),this),PanelManager.openWaitForServer(),!0},t.doEscortEventMsg=function(e,n){var i=MsgHandler.createEscortEventMsg(n);return nato.Network.sendCmd(i,(function(n){if(!MsgHandler.isMessageHaveError(n)){PanelManager.closeSelectMenuPanel();var i=n.getShort();return i>0?void xworld.toBattle(i,!0):void t.clearRefreshTime(e)}}),this),!0},t.clearRefreshTime=function(t){null!=t&&(t.nextUpdateTime=0)},t.processEscortRefreshMsg=function(e,n){var i=e.getByte();if(-1==i)return AlertPanel.errorMessage(e.getString()),void GameWorld.clearEscort();if(2!=i){var o=e.getByte();o>0&&PopUpManager.closeAll();for(var a=0;o>a;a++)MsgHandler.processEscortEventReword(e);return 1==i?(PopUpManager.closeAll(),void t.processEscostEndMsg(e,n)):0==i?(t.escortType=e.getByte(),void(t.escortType==t.NEWESCORT?NewEscort.processEscrotRefreshPosMsg(e,n):t.escortType==t.OLDESCORT&&t.processEscrotRefreshPosMsg(e,n))):void 0}var r=e.getShort();xworld.toBattle(r,!0)},t.processEscrotRefreshPosMsg=function(e,n){var i=e.getByte(),o=e.getByte(),a=e.getInt(),r=e.getInt(),s=e.getShort(),l=i,_=o,h=0,u=0,c=0;if(1==e.getBoolean()&&(h=e.getByte(),u=e.getByte(),c=e.getByte(),n.favourerStatus=e.getByte(),l=u,_=c),null!=n){(l!=n.getNowRow()||_!=n.getNowCol())&&(PopUpManager.closeAll(),n.setStatus(!1,t.STATUS_MOVE)),n.setMove(i,o),n.round=s,n.refreshTime(a,r),n.setNowGird(i,o,!0),null!=n.getEscortRobModel()&&(n.setNowGird(u,c,!1),n.setRobMove(h));var T=PanelManager.getPanel(EscortScene,!1);T&&T.stage&&T.update()}},t.processEscostEndMsg=function(e,n){if(null!=e){var i="",o=e.getBoolean(),a=0;o?MsgHandler.processMissionReward(xself,-1,e):(a=e.getByte(),n.type==t.ESCORT_TURN_FAVOURER&&(i=e.getString()));var r=e.getByte();0==r&&TodayEvent.curMissionID>0&&TodayEvent.saveMissionIDInPlayerData(),GameWorld.clearEscort(),MsgHandler.instance.processDataBlockFlagMsg(e),MsgHandler.createWorldDataReflashMsg();var s=(n.type==t.ESCORT_TURN_HUN?GameText.STR_ESCORT_ROB_SUCCESS:GameText.STR_ESCORT_MISSION_SUCCESS)+GameText.STR_ESCORT_MISSION_SUCCESS_INFO;n.type==t.ESCORT_TURN_FAVOURER&&(s+=Tool.manageString(GameText.STR_ESCORT_TURN_FAVOURER,r+""));var l=GameText.STR_ESCORT_MISSION_FAIL;n.type==t.ESCORT_TURN_HUN?l+=a==t.ESCORT_STATE_FINISH_SYSTEM?GameText.STR_ESCORT_STATE_FINISH_SYSTEM:a==t.ESCORT_STATE_FINISH_CANCEL?GameText.STR_ESCORT_STATE_FINISH_CANCEL:a:0==Tool.isNullText(i)&&(l=i),o?AlertPanel.alertNotify(GameText.STR_ESCORT_MISSION_END,s):WorldMessage.addTips(l)}},t.doEscortPostQuitMsg=function(){var t=function(t){MsgHandler.isMessageHaveError(t)||(PanelManager.closeScene(!0),GameWorld.clearEscort(),MsgHandler.instance.processDataBlockFlagMsg(t),PanelManager.updateWorldIconPoint(),xself.checkHPMP(),AlertPanel.alertNotify(GameText.STR_ESCORT_MISSION_QUIT,GameText.STR_ESCORT_MISSION_QUIT_SUCCESS))};return AlertPanel.alert(GameText.STR_ESCORT_MISSION_QUIT,GameText.STR_ESCORT_MISSION_QUIT_ASK,(function(){var e=MsgHandler.createEscortPostQuit();nato.Network.sendCmd(e,t,this)}),this),!0},t.doEscortRobListMsg=function(e,n){var i=MsgHandler.createEscortRobList(e,n);nato.Network.sendCmd(i,(function(e){for(var n=(e.getShort(),e.getByte()),i=[],o=0;n>o;o++){var a=new t;a.setId(e.getInt()),a.setMoney1(e.getInt()),a.setMoney2(e.getInt()),a.setMoney3(e.getInt());for(var r=e.getByte(),s=[],l=0;r>l;l++){var _=new Model(3);_.setName(e.getString()),_.setLevel(e.getByte()),_.setJob(e.getByte()),_.setType(e.getByte()),s.push(_),0==l&&a.setSimpleDesc(Tool.manageStringList(GameText.STR_ESCORT_SIMPLE_DESC,[r+"",_.getName()]))}a.setTeamDesc(t.getModelListDesc(s)),i.push(a)}null==i||0==i.length?AlertPanel.alertCommon(GameText.STR_ESCORT_ROB_LIST_NULL):PanelManager.openEscortRobListPanel(i)}),this)},t.doEscortRobMsg=function(t){if(null==t)return!1;var e=function(t){MsgHandler.isMessageHaveError(t)};return AlertPanel.alert(GameText.STR_ESCORT_ATTACK_MISSION,Tool.manageString(GameText.STR_ESCORT_ATTACK_MISSION_INFO,t.getMoneyDesc()),(function(){var n=MsgHandler.createEscortRob(t.getId());nato.Network.sendCmd(n,e,this)}),this),!0},t.prototype.getMoneyDesc=function(){var t=new StringBuffer;return this.money1>0&&t.append(PowerString.makeColorString(GameText.STR_MONEY1+this.money1,ColorUtils.COLOR_YELLOW)+" "),this.money2>0&&t.append(PowerString.makeColorString(GameText.STR_MONEY2+this.money2,ColorUtils.COLOR_MONEY2)+" "),this.money3>0&&t.append(PowerString.makeColorString(GameText.STR_MONEY3+this.money3,ColorUtils.COLOR_MONEY3)+" "),t.append("\n"),t.toString()},t.doEscortListPlayer=function(e){if(null==e)return!1;if(e.type==t.ESCORT_TURN_FAVOURER)return AlertPanel.alertCommon(GameText.STR_ESCORT_TURN_FAVOURER_INFO),!0;var n=MsgHandler.createEscortListPlayer();return nato.Network.sendCmd(n,(function(t){var e=t.getByte();if(!(0>e)){for(var n=new Array(e),i=-1,o=0,a=0;a<n.length;a++)n[a]=ListPlayer.fromBytesToEscortTeam(t),3==n[a].getType()&&o++;if(o>1){i=n[0].getId();for(a=0;a<n.length;a++)n[a].setLeaderID(i)}return null==n||n.length<=0?void AlertPanel.alertCommon(GameText.STR_ESCORT_PLAYER_LIST_NULL):void 0}AlertPanel.alertCommon(t.getString())}),this),!0},t.POST_UPDATE_TIME=2500,t.ESCORT_TURN_FAVOURER=1,t.ESCORT_TURN_HUN=2,t.ESCORT_STATE_FAVOURER_NORMAL=0,t.ESCORT_STATE_FAVOURER_BATTLE=1,t.ESCORT_STATE_FAVOURER_OFFLINE=2,t.ESCORT_STATE_READY=0,t.ESCORT_STATE_START=1,t.ESCORT_STATE_FIGHT_MON=2,t.ESCORT_STATE_FIGHT_HUN=3,t.ESCORT_STATE_FINISH_SYSTEM=4,t.ESCORT_STATE_FINISH_FAVOURER=5,t.ESCORT_STATE_FINISH_HUN=6,t.ESCORT_STATE_FINISH_CANCEL=7,t.ESCORT_STATE_FINISH_OVER=8,t.IMAGE_DEFAULT=0,t.IMAGE_BATTLE=1,t.IMAGE_ITEM=2,t.IMAGE_GOOD_BUF=3,t.IMAGE_MONSTER=4,t.IMAGE_BAD_BUF=5,t.IMAGE_EVENT=6,t.IMAGE_START=7,t.IMAGE_END=8,t.IMAGE_NO_PASS=9,t.STATUS_MOVE=1,t.STATUS_ROB_MOVE=2,t.STATUS_VIEW=4,t.STATUS_UPDATE_POS=8,t.escortType=-1,t.OLDESCORT=0,t.NEWESCORT=1,t.uiRow=4,t.uiCol=4,t}();__reflect(Escort.prototype,"Escort");var SoldierItemBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._data=null},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.initPanel=function(){this._data&&(this.label_name.text=this._data.getName(),this._data.vipLevel>0?this.vip_icon.source=xitem.getItemIcon(39):this.vip_icon.source=xitem.getItemIcon(50),this.label_lv_job&&(this.label_lv_job.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._data.getLevel()+"")+Define.getJobString(this._data.getJob())),this.label_rank&&(this.label_rank.text=Define.getRankString(this._data.getCountryRank())),this instanceof SoldierHelpItem&&(this.label_rank.y=this.label_lv_job.y,this.label_rank.x=this.label_lv_job.x+this.label_lv_job.textWidth+10),this.label_identity&&(this.label_identity.text=Tool.isNullText(this._data.getCountryName())?"--":this._data.getCountryName()),this.label_online&&(this.label_online.text=this._data.getOnlineDesc()),this.label_country_name&&(this.label_country_name.text=this._data.getCountryName()))},e}(ComponentBase);__reflect(SoldierItemBase.prototype,"SoldierItemBase");var RankItem=function(t){function e(){var e=t.call(this)||this;return e._subTitle="",e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.vipLevel),Tool.removeObjSafe(this.rankIndex),Tool.removeObjSafe(this.headSpr),Tool.removeObjSafe(this.roleLevel),this.headSpr=null,this.roleLevel=null,this.vipLevel=null,this.rankIndex=null,this._data=null},e.prototype.setData=function(t,e){this._data=t,this._subTitle=e,this.stage&&this.initPanel()},e.prototype.getData=function(){return this._data},e.prototype.initPanel=function(){if(this._data){this.label_name.text=this._data.actorName,this.label_value.text=this._subTitle+"："+this._data.rankStr[1],this.label_job.text=Define.getJobString(this._data.job);var t=xhd?"_hd":"_sd";this._data.topIndex<4?(this.index_icon.source="rank_"+this._data.topIndex+t,this.index_icon.parent||this.addChild(this.index_icon)):(this.createRankIndex(),Tool.removeObjSafe(this.index_icon)),this.createVipLevel(),this.headIcon(),this.createRoleLevel()}else this.label_name.text="",this.label_value.text=""},e.prototype.headIcon=function(){if(Tool.removeObjSafe(this.headSpr),this._data&&0!=this._data.icon1){var t=this._data.icon1>>Model.OFFSET_SEX&Model.LEN_SEX,e=t==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(e),this.headSpr.x=66*xhdRatio,this.headSpr.y=45*xhdRatio,this.headSpr.setScale(xhd?2.7:1.25),this.roleLevel?this.addChildAt(this.headSpr,this.getChildIndex(this.roleLevel)):this.addChild(this.headSpr);var n=new ChangeSpriteInfo(this._data.icon1,0,0,t,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(n)}},e.prototype.createRoleLevel=function(){this.roleLevel||(this.roleLevel=ImageNum.create(2007),this.roleLevel.numSpace=-4,this.roleLevel.x=51*xhdRatio,this.roleLevel.y=45*xhdRatio,this.roleLevel.scaleX=this.roleLevel.scaleY=.5*xhdRatio,this.addChild(this.roleLevel)),this.roleLevel.num=this._data.level},e.prototype.createVipLevel=function(){null==this.vipLevel&&(this.vipLevel=ImageNum.create(2006),this.vipLevel.x=41*xhdRatio,this.vipLevel.y=8*xhdRatio,this.vipLevel.scaleX=this.vipLevel.scaleY=.6*xhdRatio,this.group_vip.addChild(this.vipLevel)),this.vipLevel.num=this._data.vipLevel},e.prototype.createRankIndex=function(){null==this.rankIndex&&(this.rankIndex=ImageNum.create(2009),this.rankIndex.numSpace=-4,this.rankIndex.x=this.index_icon.x+.5*this.index_icon.width,this.rankIndex.y=this.index_icon.y+.5*this.index_icon.height,this.rankIndex.scaleX=this.rankIndex.scaleY=.6*xhdRatio,this.addChild(this.rankIndex)),this.rankIndex.num=this._data.topIndex},e}(ComponentBase);__reflect(RankItem.prototype,"RankItem");var RolePropBasePanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e.color_green=6749952,e.color_blue=52479,e.color_yellow=16763904,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.addAttribute=function(t,e,n,i){var o=this._itemList[this._index];o||(o=new RolePropItem,nato.attachSkin(o),this._itemList[this._index]=o),o.setData(t,e,n,i),this.container.add(o,0),this._index++},e.prototype.initAttributeText=function(t){e.CHANGE_TEXT=PlayerInfoUIAction.getChangeText(t)},e.CHANGE_TEXT=[],e}(ComponentBase);__reflect(RolePropBasePanel.prototype,"RolePropBasePanel");var SocietyBasePanel=function(t){function e(){var n=t.call(this)||this;return e._itemList=[],n}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._radioBtns&&this._radioBtns.removeEventListener(egret.Event.CHANGE,this.radioChange,this)},e.prototype.getList=function(){},e.prototype.getListCallbackFunc=function(t){t.length>0&&this.showItem()},e.prototype.showItem=function(){if(e._itemList){this._radioBtns?this._radioBtns.clear():this._radioBtns=new RadioButtonComponent,this._radioBtns.addEventListener(egret.Event.CHANGE,this.radioChange,this);for(var t,n=0,i=0,o=this.currListData.length;o>i;i++)(t=e._itemList[i])||(t=new SocietyFriendItem,nato.attachSkin(t),e._itemList[i]=t),t.setData(this.currListData[i],this),this.currListData[i].isStatusBit(ModelConst.STATUS_ONLINE)&&(this.currListData.splice(n,0,this.currListData.splice(i,1)[0]),n++);for(i=0,o=this.currListData.length;o>i;i++)(t=e._itemList[i])||(t=new SocietyFriendItem,nato.attachSkin(t),e._itemList[i]=t),t.setData(this.currListData[i],this),this.container.add(e._itemList[i],0);this._radioBtns.add(e._itemList,0,!0,!0)}this.container.update()},e.prototype.radioChange=function(t){var e=this._radioBtns.getCurentSelectItem();SocietyScene.from==SocietyScene.OPEN_FROM_MAIL?(xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_FRIEND_ID,e.player.getId())),PanelManager.getPanel(SocietyScene).closePanel()):(PanelManager.getPanel(SocietyScene).getCurrentPanel().currSeeItem=e,PanelManager.openPlayerMenuPanel(e.player,OtherPlayerPanel.menuType))},e.prototype.reset=function(){this.container.reset()},e.prototype.update=function(t){void 0===t&&(t=!0),this.init&&this.reset()},e.prototype.updateList=function(){this.currSeeItem&&this.container.remove(this.currSeeItem)},e}(ComponentBase);__reflect(SocietyBasePanel.prototype,"SocietyBasePanel");var TradeTypeSelectPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;this["btn_type_"+n];)this["btn_type_"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTypeSelect,this),this["btn_type_"+n].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTypeBeginSelect,this),n++;this.typeBtns=null},e.prototype.initPanel=function(){var t=Define.purchaseIcon;this.typeBtns=[];for(var e=0;this["btn_type_"+e];)this["btn_type_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTypeSelect,this),this["btn_type_"+e].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTypeBeginSelect,this),this["btn_type_"+e].label=Define.getPurchaseTypeText(e+1),this.typeBtns.push(this["btn_type_"+e]),this["icon_type_"+e].source=xitem.getItemIcon(t[e]),this["type_icon_group_"+e].touchChildren=!1,this["type_icon_group_"+e].touchEnabled=!1,e++;ButtonUtils.selectTabBtnList(this.typeBtns,this._currSelectTypeIndex)},e.prototype.onTypeBeginSelect=function(t){this._currSelectTypeIndex=this.typeBtns.indexOf(t.currentTarget),ButtonUtils.selectTabBtnList(this.typeBtns,this._currSelectTypeIndex)},e.prototype.onTypeSelect=function(t){},e}(ComponentBase);__reflect(TradeTypeSelectPanel.prototype,"TradeTypeSelectPanel");var PanelBase=function(t){function e(e){var n=t.call(this)||this;return n._resUrls=e,n}return __extends(e,t),e.prototype.show=function(t,e,n){void 0===t&&(t=PopUpManager.EffectType.NONE),void 0===e&&(e=PopUpManager.CloseType.OUTSIDE),void 0===n&&(n=!0),this._closeType=e,this._effectType=t,this._grayBack=n,!this._resUrls||this._resUrls.length<=0?this.showHelper():(PanelManager.openWaitForServer(),nato.loadGroup(this._resUrls,this.showHelper,this))},e.prototype.close=function(){PopUpManager.removePopUp(this)},e.prototype.showHelper=function(){PanelManager.closeWaitForServer(),this.initComponent(),this.initListeners(),this.addToStage()},e.prototype.addToStage=function(){PopUpManager.addPopUp(this,this._effectType,this._grayBack,this._closeType),this.afterShowFunc()},e.prototype.afterShowFunc=function(){},e.prototype.initComponent=function(){},e.prototype.initListeners=function(){this._clickHelper=new ClickHelper(this),this._clickHelper.regClickFunc("btnClose",this.onClose,this)},e.prototype.removeListeners=function(){},e.prototype.removeFromStage=function(){},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeListeners(),this.removeFromStage()},e.prototype.onClose=function(){this.close()},e}(ComponentBase);__reflect(PanelBase.prototype,"PanelBase");var CountryWarArmyFightItem=function(t){function e(){var e=t.call(this)||this;return e.tabEvent=1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_0),ButtonUtils.removeTouchEvent(this.btn_1)},e.prototype.initPanel=function(){if(this._data){var t=this._data.getArmyInfo1();this._data.isMyArmy()&&(t=PowerString.makeColorString(t,ColorUtils.COLOR_GREEN)),this.label_name.textFlow=Tool.convertDescToTextFlow(t);var e=[];if(WarArmy.getMenuAndEvent(this._data,e,this.tabEvent,!1),null!=e&&e.length>0)for(var n,i=0;2>i;i++)(n=e[i])?(this["btn_"+i].label=n.menu,this.addChild(this["btn_"+i]),ButtonUtils.addTouchEvent(this["btn_"+i],this.onBtnClick,this,[n.action])):Tool.removeObjSafe(this["btn_"+i]),this["btn_"+i+"_action"]=n.action}},e.prototype.onBtnClick=function(t){if(t==CountryWarHandler.EVENT_ALL_WAR_ARMY_REMOVE)CountryWar.doRemoveArmy(this._data);else if(t==CountryWarHandler.EVENT_ALL_WAR_ARMY_DELETE)CountryWar.doDeleteArmy(this._data);else if(t==CountryWarHandler.EVENT_ALL_WAR_ARMY_INSERT)if(CountryWarArmyListScene.subType==CountryWarHandler.SUB_TYPE_COUNTRYWAR_BUILD_TEAM)CountryWar.doInsertArmy(CountryWarArmyListScene.buildPos,this._data);else{var e=PanelManager.getPanel(CountryWarSelectBuildPanel);e.data=this._data,PopUpManager.addPopUp(e)}},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CountryWarArmyFightItem.prototype,"CountryWarArmyFightItem");var FragmentFile=function(){function t(t){this._fragmentNameID=t,this.gameImage=new GameImage(t,-1)}return Object.defineProperty(t.prototype,"fragmentNameID",{get:function(){return this._fragmentNameID},enumerable:!0,configurable:!0}),t.prototype.getNameID=function(){return null==this.gameImage?-1:this._fragmentNameID},t.prototype.getPalID=function(){return null==this.gameImage?-1:this.gameImage.getPalID()},t.prototype.clearImage=function(){this.gameImage=null},t}();__reflect(FragmentFile.prototype,"FragmentFile");var Frame=function(){function t(t){this.setup=t}return t.prototype.load=function(t,e){var n=this.setup;null==n.array&&(n.array=[]);for(var i=n.array.length,o=new Array(i),a=new Array(i),r=e.fragmentFiles,s=0;i>s;s++){var l=n.array[s],_=SpriteHelper.getFragmentFileIndex(t,l.fragmentFileId);o[s]=_,a[s]=r[_]}this.fragmentFileIndexs=o,this.fragments=a},t.prototype.getFrameWidth=function(t){if(null==this.fragmentFileIndexs)return 0;if(null==t.fragmentFiles)return 0;for(var e=0,n=0,i=this.setup.array,o=0,a=i.length;a>o;o++){var r=i[o],s=this.fragments[o].getNameID();if(-1!=s){var l=r.fragmentId,_=nato.findSheetForAni(s,l);if(null!=_){var h=this.getWidthByTransform(_,r)/2;e=Math.min(r.centerX-h,e),n=Math.max(r.centerX+h,n)}}}return Math.abs(e-n)},t.prototype.getWidthByTransform=function(t,e){return null==t?0:Utility.isRotate(e.transformType)?t.h:t.w},t.prototype.getFrameHeight=function(t){if(null==this.fragmentFileIndexs)return 0;if(null==t.fragmentFiles)return 0;for(var e=0,n=0,i=this.setup.array,o=0,a=i.length;a>o;o++){var r=i[o],s=this.fragments[o].getNameID();if(-1!=s){var l=r.fragmentId,_=nato.findSheetForAni(s,l);if(null!=_){var h=this.getHeightByTransform(s,_,r)/2;e=Math.min(e,r.centerY-h),n=Math.max(n,r.centerY+h)}}}var u=Math.abs(e-n);return u>100&&(u=100),u},t.prototype.getHeightByTransform=function(t,e,n){return t>=ActorConst.START_WEAPON&&t<=ActorConst.START_HELMET||t>=ActorConst.START_FLASH&&t<ActorConst.START_MINI_SPRITE?0:Utility.isRotate(n.transformType)?e.w:e.h},t.prototype.apply=function(t){var e=this.setup,n=e.array.length;if(0>=n)t(null);else{for(var i=new nato.Xramer,o=0;n>o;o++){var a=e.array[o],r=this.fragments[o].getNameID();-1!=r&&i.add(r,a.fragmentId,a.centerX,a.centerY,a.transformType)}nato.FrameCache.instance.apply(i,t)}},t.prototype.toFrameString=function(){for(var t="",e=0,n=this.setup.array.length;n>e;e++){var i=this.setup.array[e];t+="切片文件id："+i.fragmentFileId+"，",t+="切片id："+i.fragmentId+"，",t+="centerX:"+i.centerX+"，",t+="centerY："+i.centerY+"，",t+="transform："+i.transformType+"\n"}return t},t}();__reflect(Frame.prototype,"Frame");var FrameSuite=function(){function t(){this._null=!1}return t.prototype.null=function(t){this._null=t},Object.defineProperty(t.prototype,"default",{get:function(){return nato.FrameCache.instance.default},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=this._arr;if(!e)return this._default;var n=e[t];if(null==n){var i=this._cache.get(t);null!=i?(n=i,e[t]=n):n=this._last}return this._last=n,n},t.prototype.load=function(t){this._cache=SpriteCache.instance.find(t),this._arr=new Array(t.frames.length),this._last||this._null||(this._last=this.default)},t.prototype.setFirstFrameLoaded=function(t,e){this._cache.setFirstFrameLoaded(t,e)},t}();__reflect(FrameSuite.prototype,"FrameSuite");var GameSprite=function(t){function e(e,n){void 0===n&&(n=!0);var i=t.call(this)||this;return i.nameID=-1,i.fragmentFiles=null,i.frames=null,i.animations=null,i.scale=1,i.cache=null,i.presetLoopTime=-1,i.maxWidth=0,i.maxHeight=0,i.changeIcons=[],i.nameID=e,i.setSpriteVisible(!0),i.setMotionAlive(!0),i.cache=xlocal?new FrameSuite:new XrameSuite,i.body=new egret.Bitmap,i.addChild(i.body),i.cache.null(!n),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAdded,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemove,i),i}return __extends(e,t),e.prototype.onAdded=function(t){GameSpriteManager.instance.add(this)},e.prototype.onRemove=function(t){GameSpriteManager.instance.remove(this)},e.prototype.getnameID=function(){return this.nameID},e.prototype.loadBytes=function(){var t=nato.findSpriteSetup(this.nameID);this.create(t),this.presetChangeSpriteInfo&&(this.doChangeSpriteIcon(this.presetChangeSpriteInfo),this.presetChangeSpriteInfo=null)},e.prototype.refresh=function(){this.setup&&this.cache.load(this)},e.prototype.setFirstFrameLoaded=function(t,e){this.cache.setFirstFrameLoaded(t,e)},e.prototype.create=function(t){this.setup=t,null!=t&&(egret.is(t,"nato.SpriteSetup")?this.createWithSpriteSetup(t):this.createWithXpriteSetup(t))},e.prototype.needToHideCloak=function(){if(this.nameID>=31513&&this.nameID<=31593)return!0;if(null==this.setup||null==this.setup.files)return!1;for(var t=0;t<this.setup.files.length;t++){var e=this.setup.files[t];if(14169==e||14165==e)return!0}return!1},e.prototype.ontick=function(t){var e=!1;if(!this.isMotionAlive())return e;if(null==this.curAnimation)return this.setMotionAlive(!1),e;(e=this.curAnimation.ontick(t),null!=this.cloakSprite)&&(this.needToHideCloak()||this.contains(this.cloakSprite)||this.addChildAt(this.cloakSprite,0));return this.checkVisibleSetting(),e},e.prototype.checkVisibleSetting=function(){if(!xworld.inBattle&&!PanelManager.isOpeningFullScene){var t=this.parent;if(null!=t)if(!egret.is(t,"NPC"))if(egret.is(t,"Player")||egret.is(t,"Model")){var e=null!=xworld.otherModels[t.getId()],n=!1;if(t.follower&&null!=xworld.otherModels[t.follower.getId()]&&(n=!0),e||n){var i=xworld.getTypeModel(Define.NEAR_MY_TEAM);if(i&&i.indexOf(t)>=0)return;this.visible=!xworld.hidingOtherPlayers}}}},e.prototype.createWithSpriteSetup=function(t){for(var e=[],n=0,i=t.fragmentFiles;n<i.length;n++){var o=i[n],a=new FragmentFile(o);e.push(a)}this.fragmentFiles=e;for(var r=t.frames,s=new Array(r.length),l=0,_=r.length;_>l;l++){var h=new Frame(r[l]);h.load(t.fragmentIds,this),s[l]=h}this.frames=s;var u=t.animations,c=new Array(u.length),T=new Array(u.length);for(l=0,_=u.length;_>l;l++){var p=new Animation(u[l],this);c[l]=p,T[l]=p.setup.animationID}this.animations=c,this.setFirstAnimation()},e.prototype.createWithXpriteSetup=function(t){for(var e=[],n=0,i=t.files;n<i.length;n++){var o=i[n],a=new FragmentFile(o);e.push(a)}this.fragmentFiles=e;for(var r=new Array(t.count),s=0;s<t.count;s++){var l=new Xrame(s);r[s]=l}this.frames=r;for(var _,h=t.animations,u=new Array(h.length),c=[],T=(s=0,h.length);T>s;s++)_=new Xnimation(h[s],this),u[s]=_,c[s]=_.getAnimationID();this.animations=u,this.setFirstAnimation()},Object.defineProperty(e.prototype,"isAllAniStop",{get:function(){for(var t=0,e=this.animations;t<e.length;t++){if(e[t].visible)return!1}return!0},enumerable:!0,configurable:!0}),e.prototype.setScale=function(t){this.scale=t,this.scaleX=t,this.scaleY=t},e.prototype.getScale=function(){return this.scale},e.prototype.setSpritePosition=function(t,e){this.x=t,this.y=e},e.prototype.getCurAnimation=function(){return this.curAnimation},e.prototype.getCurAniID=function(){var t=this.getCurAnimation();return null!=t?t.getAnimationID():-1},e.prototype.setFirstAnimation=function(){null!=this.animations&&this.animations.length>0&&(this.setCurAnimation(this.animations[0]),this.setCurAnimationLoopTime(this.presetLoopTime),this.presetLoopTime=-1)},e.prototype.setCurAnimation=function(t){return null!=t&&(this.getCurAnimation()==t?(this.curAnimation.visible||(this.curAnimation.visible=!0),!0):(this.curAnimation=t,this.curAnimation.setLoopTime(-1),this.curAnimation.init(),!0))},e.prototype.setCurAnimationAsId=function(t){return this.setCurAnimation(this.getAnimation(t))},e.prototype.setCurAnimationAsIdAndTime=function(t,e){this.visible=!0,this.setCurAnimationAsId(t),this.setCurAnimationLoopTime(e)},e.prototype.setCurAnimationLoopTime=function(t){var e=this.getCurAnimation();e?e.setLoopTime(t):this.presetLoopTime=t},e.prototype.getCurAnimationLoopTime=function(){var t=this.getCurAnimation();return null!=t?t.getLoopTime():-1},e.prototype.getAnimation=function(t){if(null==this.animations)return null;for(var e=0,n=this.animations;e<n.length;e++){var i=n[e];if(null!=i&&i.getAnimationID()==t)return i}return null},e.prototype.getWidth=function(){return this.curAnimation.getWidth()},e.prototype.getHeight=function(){return this.curAnimation.getHeight()},e.prototype.doPresetChangeSprite=function(t){this.presetChangeSpriteInfo=t},e.prototype.doChangeSpriteIcon=function(t){var n=t.icon1,i=t.icon2,o=t.icon3,a=t.sex,r=t.lWeaponStyle,s=t.rWeaponStyle,l=t.backStyle,_=t.transportStyle,h=t.isTwoHand,u=(t.isBattle,n>>Model.OFFSET_HAIR_STYLE&Model.LEN_HAIR_STYLE),c=n>>Model.OFFSET_HAIR_COLOR&Model.LEN_HAIR_COLOR,T=n>>Model.OFFSET_FACE_STYLE&Model.LEN_FACE_STYLE,p=n>>Model.OFFSET_HAND_STYLE&Model.LEN_HAND_STYLE,d=n>>Model.OFFSET_HAND_COLOR&Model.LEN_HAND_COLOR,E=n>>Model.OFFSET_FEET_STYLE&Model.LEN_FEET_STYLE,g=n>>Model.OFFSET_FEET_COLOR&Model.LEN_FEET_COLOR;3==p&&(E=4);var S=n>>Model.OFFSET_HELMET_STYLE&Model.LEN_HELMET_STYLE,m=n>>Model.OFFSET_HELMET_COLOR&Model.LEN_HELMET_COLOR,f=i>>Model.OFFSET_SHOULDER_STYLE&Model.LEN_SHOULDER_STYLE,I=i>>Model.OFFSET_SHOULDER_COLOR&Model.LEN_SHOULDER_COLOR,A=i>>Model.OFFSET_SHOULDER_ADD&Model.LEN_SHOULDER_ADD;A>0&&(f+=A<<Tool.getBitNum(Model.LEN_SHOULDER_STYLE)),3==p&&(f=-1);var y=i>>Model.OFFSET_LWEAPON_COLOR&Model.LEN_LWEAPON_COLOR,R=i>>Model.OFFSET_RWEAPON_COLOR&Model.LEN_RWEAPON_COLOR,P=i>>Model.OFFSET_WEAPON_FLASH&Model.LEN_WEAPON_FLASH,C=o>>Model.OFFSET_BACK_COLOR&Model.LEN_BACK_COLOR,M=o>>Model.OFFSET_CLOTHES_STYLE&Model.LEN_CLOTHES_STYLE,L=o>>Model.OFFSET_CLOTHES_COLOR&Model.LEN_CLOTHES_COLOR;0>=M&&(M=1);var v=o>>Model.OFFSET_TROUSERS_STYLE&Model.LEN_TROUSERS_STYLE,O=o>>Model.OFFSET_TROUSERS_COLOR&Model.LEN_TROUSERS_COLOR;if(0>=v&&(v=1),(o>>Model.OFFSET_FASH_ADD&Model.LEN_FASH_ADD)>0)switch(23==M||24==M?(p=4,E=5):26==M&&(T=2==E?14:15,p=5,E=6,u=0,S=0),M){case 29:S=43,m=L,1==a&&(E=5);break;case 30:S=32,m=L,1==a&&(E=5);break;case 31:S=33,m=L,f=32,I=L,1==a&&(E=5);break;case 32:S=34,m=L,f=33,I=L,1==a&&(E=5);break;case 33:S=35,m=L,f=34,I=L,1==a&&(E=5);break;case 34:S=36,m=L,f=35,I=L,1==a&&(E=5);break;case 35:S=37,m=L,f=36,I=L,1==a&&(E=5);break;case 36:S=38,m=L,f=37,I=L,1==a&&(E=5);break;case 37:S=39,m=L,f=38,I=L,1==a&&(E=5);break;case 38:S=40,m=L,f=39,I=L,1==a&&(E=5);break;case 39:S=41,m=L,f=40,I=L,1==a&&(E=5);break;case 40:S=42,m=L,f=41,I=L,1==a&&(E=5);break;case 41:f=42,T=16+L,p=6,E=7,u=0,S=0;break;case 42:f=43,T=20+L,p=6,E=7,u=0,S=0}var N=o>>Model.OFFSET_TRANSPORT_COLOR&Model.LEN_TRANSPORT_COLOR;if(null!=this.fragmentFiles){var D=null,B=l==SpriteHelper.HOUSE_TWO_PEOPLE_SPRITE;this.changeIcons=[];for(var b=0;b<this.fragmentFiles.length;b++){var x=this.fragmentFiles[b];if(null!=x){var G=x.getNameID(),U=-1,w=Math.floor(G/1e3);if(B)switch(w){case e.PNG_HAIR:if(u>0){if((G-1>>2&1)!=a)continue;U=Model.START_HAIR+(u<<3)-7+(a<<2)+c}break;case e.PNG_FACE:if(T>0){if((G-1>>2&1)!=a)continue;U=Model.START_FACE+(T<<3)-7+(a<<2)}break;case e.PNG_CLOTHES:if(M>0){if((G-1>>2&1)!=a)continue;U=Model.START_CLOTHES+(M<<3)-7+(a<<2)+L}break;case e.PNG_TROUSERS:if(v>0){if((G-1>>2&1)!=a)continue;U=Model.START_TROUSERS+(v<<3)-7+(a<<2)+O}break;case e.PNG_SHOULDER:if((G-1>>2&1)!=a)continue;f>0&&(U=Model.START_SHOULDER+(f<<3)-7+(a<<2)+I);break;case e.PNG_TRANSPORT:if(!(_>0))continue;U=G-(G-1&3)+N;break;default:continue}else switch(w){case e.PNG_MINI:break;case e.PNG_HAIR:u>0&&(U=Model.START_HAIR+(u<<3)-7+(a<<2)+c);break;case e.PNG_FACE:T>0&&(U=Model.START_FACE+(T<<3)-7+(a<<2));break;case e.PNG_HAND:p>0&&(U=Model.START_HAND+(p<<3)-7+(a<<2)+d);break;case e.PNG_FEET:E>0&&(U=Model.START_FEET+(E<<3)-7+(a<<2)+g);break;case e.PNG_SHOULDER:f>0&&(U=Model.START_SHOULDER+(f<<3)-7+(a<<2)+I);break;case e.PNG_BACK:l>0&&(U=Model.START_BACK+(l<<2)-3+C);break;case e.PNG_CLOTHES:M>0&&(U=Model.START_CLOTHES+(M<<3)-7+(a<<2)+L);break;case e.PNG_TROUSERS:v>0&&(U=Model.START_TROUSERS+(v<<3)-7+(a<<2)+O);break;case e.PNG_TRANSPORT:_>0&&(U=G-(G-1&3)+N);break;case e.PNG_PET:_>0&&(U=G-(G-1&3)+l);break;case e.PNG_WEAPON:h?null==D?(r>0&&(U=e.getWeaponIcon(r,y)),D=x):(!0,s>0&&(U=e.getWeaponIcon(s,R))):(r>0&&(U=e.getWeaponIcon(r,y)),s>0?U=e.getWeaponIcon(s,R):-99==s&&(U=G));break;case e.PNG_HELMET:S>0&&(U=Model.START_HELMET+(S<<2)-3+m);break;case e.PNG_WEAPON_FLASH:P>0?U=G-(G-1&3)+(P-1):-99==s&&(U=G);break;default:continue}if(-1!=U){if(U!=G){this.changeIcons.push({origin:G,change:U});var F=new FragmentFile(U);if(this.fragmentFiles[b]=F,xlocal)for(var H=0,k=this.frames;H<k.length;H++){k[H].load(this.setup.fragmentIds,this)}}}else this.changeIcons.push({origin:G,change:0}),x.clearImage()}}}},Object.defineProperty(e.prototype,"key",{get:function(){if(this.changeIcons.length){for(var t=this.setup.files.concat(),e=0,n=this.changeIcons.length;n>e;e++){var i=this.changeIcons[e],o=t.indexOf(i.origin);t[o]=i.change}return this.nameID+"_"+t.join("_")}return this.nameID+""},enumerable:!0,configurable:!0}),e.prototype.cloneKey=function(t){this.changeIcons=t.changeIcons.concat()},e.prototype.updateFragmentByPngName=function(t,e,n,i,o){},e.getWeaponIcon=function(t,e){return Model.START_WEAPON+(t<<2)-3+e},e.prototype.getFragmentFileByNameID=function(t){return null},e.prototype.getFragmentIndexById=function(t,e){return 0},e.prototype.setRotate=function(t){this.spriteStatusFlag&=~e.FLAG_ROTATE,t&&(this.spriteStatusFlag|=e.FLAG_ROTATE),this.scaleX=t?-this.scale:this.scale},e.prototype.getRotate=function(){return 0!=(this.spriteStatusFlag&e.FLAG_ROTATE)},e.prototype.setHighTransport=function(t){this.spriteStatusFlag&=~e.FLAG_HIGH_TRANSPORT,t&&(this.spriteStatusFlag|=e.FLAG_HIGH_TRANSPORT)},e.prototype.isHighTransport=function(){return 0!=(this.spriteStatusFlag&e.FLAG_HIGH_TRANSPORT)},e.prototype.setMotionTurnOff=function(t){this.spriteStatusFlag&=~e.FLAG_MOTION_TURN_OFF,t&&(this.spriteStatusFlag|=e.FLAG_MOTION_TURN_OFF)},e.prototype.isMotionTurnOff=function(){return 0!=(this.spriteStatusFlag&e.FLAG_MOTION_TURN_OFF)},e.prototype.setMotionAlive=function(t){this.spriteStatusFlag&=~e.FLAG_MOTION_ALIVE,t&&(this.spriteStatusFlag|=e.FLAG_MOTION_ALIVE),this.setSpriteVisible(t),this.cloakSprite&&this.cloakSprite.setMotionAlive(t)},e.prototype.isMotionAlive=function(){return 0!=(this.spriteStatusFlag&e.FLAG_MOTION_ALIVE)},e.prototype.setSpriteVisible=function(t){this.spriteStatusFlag&=~e.FLAG_SPRITE_VISIBLE,t&&(this.spriteStatusFlag|=e.FLAG_SPRITE_VISIBLE),this.visible=t,this.cloakSprite&&this.cloakSprite.setSpriteVisible(t),this.visible?GameSpriteManager.instance.add(this):GameSpriteManager.instance.remove(this)},e.prototype.isSpriteVisible=function(){return 0!=(this.spriteStatusFlag&e.FLAG_SPRITE_VISIBLE)},e.cloneSprite=function(t,n){if(void 0===n&&(n=!0),null==t)return null;var i=new e(t.nameID);return i.create(t.setup),i.fragmentFiles=t.fragmentFiles,i.frames=t.frames,i.cloneKey(t),i.refresh(),n&&null!=t.cloakSprite&&(i.cloakSprite=e.cloneSprite(t.cloakSprite,!1)),i},e.prototype.get=function(t){return this.cache.get(t)},e.HOUSE_NUM_S40=6,e.HOUSE_TWO_PEOPLE=11,e.HOUSE_TWO_PEOPLE_SPRITE=790,e.SPRITE_HEIGHT=60,e.ANIMATION_NONE=-99,e.ANIMATION_STAND=0,e.ANIMATION_STAND_BACK=1,e.ANIMATION_MOVE=2,e.ANIMATION_MOVE_BACK=3,e.ANIMATION_BATTLE_STAND=4,e.ANIMATION_BATTLE_ATTACK_START=5,e.ANIMATION_BATTLE_ATTACK_MOVE=6,e.ANIMATION_BATTLE_ATTACK_ACTION=7,e.ANIMATION_BATTLE_ATTACK_FALLBACK=8,e.ANIMATION_BATTLE_ATTACK_USE=9,e.ANIMATION_BATTLE_ATTACK_THROW=10,e.ANIMATION_BATTLE_ATTACK_DEF=11,e.ANIMATION_BATTLE_ATTACK_HURT=12,e.ANIMATION_BATTLE_ATTACK_SKILL=13,e.ANIMATION_BATTLE_DEF_START=14,e.ANIMATION_BATTLE_ATTACK_GUN=15,e.PNG_HAIR=0,e.PNG_FACE=1,e.PNG_HAND=2,e.PNG_FEET=3,e.PNG_SHOULDER=4,e.PNG_BACK=5,e.PNG_CLOTHES=6,e.PNG_TROUSERS=7,e.PNG_WEAPON=8,e.PNG_HELMET=10,e.PNG_EQUIP_OTHER=11,e.PNG_PET=12,e.PNG_PET_ORHTER=13,e.PNG_TRANSPORT=14,e.PNG_WEAPON_FLASH=15,e.PNG_MINI=16,e.SPR_INDEX_MAN_WORLD_MINI=1,e.SPR_INDEX_MAN_BATTLE_MINI=11,e.SPR_INDEX_WOMAN_WORLD_MINI=2,e.SPR_INDEX_WOMAN_BATTLE_MINI=12,e.SPR_INDEX_PET_WORLD_MINI=3,e.SPR_INDEX_PET_BATTLE_MINI=13,e.SPR_INDEX_MAN_WORLD_START=100,e.SPR_INDEX_MAN_BATTLE_START=200,e.SPR_INDEX_WOMAN_WORLD_START=300,e.SPR_INDEX_WOMAN_BATTLE_START=400,e.SPR_INDEX_PET_WORLD_START=500,e.SPR_INDEX_PET_BATTLE_START=600,e.SPR_INDEX_MAN_HOUSE_WORLD_START=700,e.SPR_INDEX_WOMAN_HOUSE_WORLD_START=900,e.SPR_INDEX_WEAPON_HOUSE_START=2e3,e.SPR_INDEX_WEAPON_HOUSE_END=4e3,e.SPR_INDEX_WEAPON_HOUSE_START_ADD=3e4,e.SPR_INDEX_WEAPON_HOUSE_ADD_DIS=e.SPR_INDEX_WEAPON_HOUSE_START_ADD-e.SPR_INDEX_WEAPON_HOUSE_END,e.SPR_INDEX_EFF_START=1300,e.SPR_INDEX_CLOAK_START=1100,e.ANI_BATTLE_CUR=1207,e.SPRITE_CURSOR=1209,e.SPRITE_HLIGHT=1212,e.SPRITE_MAN_HEAD=1213,e.SPRITE_WOMAN_HEAD=1214,e.SPRITE_USE_ITEM_EFFECT=1215,e.SPRITE_POINTER_EFFECT=1216,e.SPRITE_GUIDE_ARROW=1221,e.SPRITE_LEVUP_UP=1217,e.SPRITE_MYPLAYER_POS=1231,e.SPRITE_BATTLE_LOADING=1232,e.SPRITE_DEF_FIELD=1225,e.SPRITE_VIP=1228,e.SPRITE_SUPER_QQ=1227,e.SPRITE_JUMP_MAP=1338,e.ANIMATION_BATTLE_CURSOR=0,e.ANIMATION_BATTLE_DIE=1,e.ANIMATION_BATTLE_BONES=2,e.ANIMATION_BATTLE_CURSOR_CANNOT=3,e.ANIMATION_BATTLE_CURSOR_RANGE=4,e.ANIMATION_ARROW_LEFT_DOWN=0,e.ANIMATION_ARROW_RIGHT_UP=1,e.ANIMATION_ARROW_DOWN=2,e.ANIMATION_ARROW_LEFT=3,e.ANIMATION_ARROW_UP=4,e.ANIMATION_MAP_POINTER_PRESS=0,e.ANIMATION_UI_POINTER_PRESS=1,e.EFF_HIT=e.SPR_INDEX_EFF_START+3,e.EFF_RANGE=1,e.FLAG_HASH_DATA=1,e.FLAG_MOTION_TURN_OFF=2,e.FLAG_MOTION_ALIVE=4,e.FLAG_SPRITE_VISIBLE=8,e.FLAG_ROTATE=16,e.FLAG_LOAD_PNG=32,e.FLAG_FRONT=64,e.FLAG_SIMPLE_SPRITE=128,e.FLAG_HIGH_TRANSPORT=256,e.FLAG_VIP=512,e.FLAG_SUPERQQ=1024,e}(egret.DisplayObjectContainer);__reflect(GameSprite.prototype,"GameSprite");var GameSpriteManager=function(){function t(){this.list=new Array}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e=this.list;e.indexOf(t)>=0||e.push(t)},t.prototype.remove=function(t){var e=this.list,n=e.indexOf(t);0>n||(e[n]=e[e.length-1],e.length=e.length-1)},t.prototype.loop=function(t){for(var e=this.list,n=0,i=e.length;i>n;n++)null!=e[n]&&e[n].ontick(t)},t}();__reflect(GameSpriteManager.prototype,"GameSpriteManager");var MovieClip=function(t){function e(e,n,i,o){var a=t.call(this)||this;return a.totalFrame=0,a.curFrame=1,a.looptime=0,a._rate=5,a.frameList=[],a.isDone=!1,a.defaultWidth=0,a.defaultHeight=0,a.mcName=e,a.looptime=n,a.onLoaded=i,a.onLoadedObj=o,a.bitmap=new egret.Bitmap,a.addChild(a.bitmap),a}return __extends(e,t),Object.defineProperty(e.prototype,"jsonPath",{get:function(){return e.DIR_PREFIX+this.mcName+e.JSON_SUFFIX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pngPath",{get:function(){return e.DIR_PREFIX+this.mcName+e.PNG_SUFFIX},enumerable:!0,configurable:!0}),e.prototype.setScale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.setScaleXY=function(t,e){this.scaleX=t,this.scaleY=e},e.prototype.setRate=function(t){this._rate=t},Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},enumerable:!0,configurable:!0}),e.prototype.load=function(){this.isDone=!1,nato.loadJson(this.jsonPath,this.loadJsonComplete,this)},e.prototype.loadJsonComplete=function(t,e){var n=t.frames,i=0;for(var o in n){var a=parseInt(o);a>i&&(i=a),this.frameList[a]=n[o],0==this.defaultWidth&&0==this.defaultHeight&&(this.defaultWidth=n[o].h,this.defaultHeight=n[o].w)}this.totalFrame=i,nato.loadImage(this.pngPath,this.loadPngComplete,this)},e.prototype.loadPngComplete=function(t,e){this.sheet=t,null!=this.onLoaded?this.onLoaded.call(this.onLoadedObj):this.play()},Object.defineProperty(e.prototype,"width",{get:function(){return this.defaultWidth*this.scaleX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.defaultHeight*this.scaleY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaded",{get:function(){return null!=this.sheet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"done",{get:function(){return this.isDone},enumerable:!0,configurable:!0}),e.prototype.setDone=function(){this.isDone=!0},e.prototype.play=function(){MovieClipManager.instance.add(this)},e.prototype.gotoAndPlay=function(t){0>=t?t=1:t>this.totalFrame&&(t=this.totalFrame),this.curFrame=t,this.isDone&&(this.isDone=!1,MovieClipManager.instance.add(this))},e.prototype.logic=function(t){var e=this.frameList[this.curFrame];if(null==e)this.bitmap.texture=null;else{var n;n=nato.createTexture(this.sheet,e.x,e.y,e.w,e.h,e.offX,e.offY,e.sourceW,e.sourceH),this.bitmap.texture=n}this.curFrame+=1,this.curFrame>this.totalFrame&&(-1==this.looptime?this.curFrame=1:this.looptime>0&&(this.looptime-=1,this.curFrame=1,this.looptime<=0&&(this.isDone=!0)))},e.DIR_PREFIX="mc/",e.JSON_SUFFIX=".json",e.PNG_SUFFIX=".png",e}(egret.DisplayObjectContainer);__reflect(MovieClip.prototype,"MovieClip");var MovieClipManager=function(){function t(){this.mclist=[]}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.add=function(t){this.mclist.indexOf(t)>=0||this.mclist.push(t)},t.prototype.remove=function(t){var e=this.mclist.indexOf(t);this.removeByIndex(e)},t.prototype.removeByIndex=function(t){if(t>=0){var e=this.mclist,n=e.length;e[t]=e[n-1],e.length=n-1}},t.prototype.logic=function(t){var e=this.mclist,n=e.length;if(0!=n)for(var i,o=0;n>o;o++)null!=(i=e[o])?t%i.rate==0&&(i.done&&(i.parent&&i.parent.removeChild(i),this.removeByIndex(o),n=e.length,o--),i.logic(t)):console.warn(e,o,i)},t._instance=new t,t}();__reflect(MovieClipManager.prototype,"MovieClipManager");var SpriteFrames=function(){function t(t){this._cache=null,this._loading=null,this.firstFrameLoadedFunc=[],this.firstFrameLoadedObj=[],this._sprite=t,this._cache=new Array(t.frames.length),this._loading=new Array(t.frames.length)}return t.prototype.get=function(t){var e=this._cache[t];return e||(this._loading[t]||(this.load(t),this._loading[t]=!0),e=this._cache[t])},t.prototype.load=function(t){var e,n=this._sprite.frames[t].fragments,i=n.length;this._count=i;for(var o=this,a=0;i>a;a++)e=n[a],nato.loadImageDataForAni(e.fragmentNameID,(function(){o._count--,o._count<=0&&o.onLoad(t)}))},t.prototype.onLoad=function(t){if(null!=this._sprite){var e=this._sprite.frames[t];this.apply(e,t)}},t.prototype.apply=function(t,e){var n=this;t.apply((function(t){n._cache[e]=t,0==e&&n.execFirstFrameLoaded()}))},t.prototype.setFirstFrameLoaded=function(t,e){this.firstFrameLoadedFunc.push(t),this.firstFrameLoadedObj.push(e)},t.prototype.execFirstFrameLoaded=function(){for(;this.firstFrameLoadedFunc.length;){var t=this.firstFrameLoadedFunc.pop(),e=this.firstFrameLoadedObj.pop();t&&e&&t.call(e)}},t}();__reflect(SpriteFrames.prototype,"SpriteFrames");var SpriteKey=function(){};__reflect(SpriteKey.prototype,"SpriteKey");var SpriteCache=function(){function t(){this._map={}}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.find=function(t){var e=new SpriteKey;e.id=t.nameID,e.fragmentFiles=t.fragmentFiles;var n=JSON.stringify(e),i=this._map[n];return i||(i=new SpriteFrames(t),this._map=i),i},t._instance=new t,t}();__reflect(SpriteCache.prototype,"SpriteCache");var SpriteHelper=function(){function t(){}return t.createSprite=function(t,e){return void 0===e&&(e=!0),this.createSpritex(t,!1,!1,e)},t.createBattleEffSprite=function(t){return this.createSpritex(t,!0)},t.createSpritex=function(t,e,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!0),this.createSpritexx(t,!0,!1,e,n,i)},t.createWorkerSprite=function(t,e){return this.createSpritexx(t,!0,!0,e)},t.createSpritexx=function(t,e,n,i,o,a){return void 0===o&&(o=!1),void 0===a&&(a=!0),this.createSpritexxx(t,e,n,i,-1,o,a)},t.createSpritexxx=function(t,e,n,i,o,a,r){if(void 0===a&&(a=!1),void 0===r&&(r=!0),0>=t)return console.debug("GameSprite.createSprite() var nameID:wrong, nameID = "+t),null;var s=new GameSprite(t,r);return s.loadBytes(),a||s.refresh(),s},t.createHeadSpriteByIcon=function(t){return null},t.createOtherHeadSpriteByIcon=function(e){var n=e>>Model.OFFSET_SEX&Model.LEN_SEX,i=n==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD,o=t.createSprite(i);if(null==o)return o;var a=new ChangeSpriteInfo(e,0,0,n,0,0,0,0,!1,!1);return o.doChangeSpriteIcon(a),o},t.createPetSpriteByIcon=function(e,n){var i=e>>Model.OFFSET_PET_STYLE&Model.LEN_PET_STYLE,o=e>>Model.OFFSET_PET_COLOR&Model.LEN_PET_COLOR;if(0>=i)return null;var a;a=n?GameSprite.SPR_INDEX_PET_BATTLE_START+i-1:GameSprite.SPR_INDEX_PET_WORLD_START+i-1;var r=t.createSpritexx(a,false,!1,n,!0);if(null==r)return r;var s=new ChangeSpriteInfo(e,0,0,0,0,-99,o,i,!1,n);return r.doChangeSpriteIcon(s),r.refresh(),r},t.createRandomSprite=function(){return null},t.createMiniSpriteByIcon=function(t,e,n,i){return null},t.createHouseTwoPeopleSprite=function(e,n){if(null==e||null==n)return null;var i=GameSprite.HOUSE_TWO_PEOPLE_SPRITE,o=t.createSpritex(i,!1);if(null==o)return o;var a=e.getIcon3()>>Model.OFFSET_TRANSPORT_STYLE&Model.LEN_TRANSPORT_STYLE,r=new ChangeSpriteInfo(e.getIcon1(),e.getIcon2(),e.getIcon3(),e.getSex(),0,0,GameSprite.HOUSE_TWO_PEOPLE_SPRITE,a,!1,!1);return o.doChangeSpriteIcon(r),r=new ChangeSpriteInfo(n.getIcon1(),n.getIcon2(),n.getIcon3(),n.getSex(),0,0,GameSprite.HOUSE_TWO_PEOPLE_SPRITE,0,!1,!1),o.doChangeSpriteIcon(r),e.setTabStatus(!1,Model.HIDE_SPIRTE),n.setTabStatus(!0,Model.HIDE_SPIRTE),o},t.createSpriteByIcon=function(e,n,i,o){t.randIcon1=e,t.randIcon2=n,t.randIcon3=i;var a=e>>Model.OFFSET_SEX&Model.LEN_SEX,r=(Model.OFFSET_RACE,Model.LEN_RACE,Model.OFFSET_JOB,Model.LEN_JOB,n>>Model.OFFSET_LWEAPON_STYLE&Model.LEN_LWEAPON_STYLE),s=n>>Model.OFFSET_RWEAPON_STYLE&Model.LEN_RWEAPON_STYLE,l=i>>Model.OFFSET_BACK_STYLE&Model.LEN_BACK_STYLE,_=i>>Model.OFFSET_BACK_ADD&Model.LEN_BACK_ADD;_>0&&(l+=_<<Tool.getBitNum(Model.LEN_BACK_STYLE));var h=i>>Model.OFFSET_TRANSPORT_STYLE&Model.LEN_TRANSPORT_STYLE,u=i>>Model.OFFSET_TRANSPORT_ADD&Model.LEN_TRANSPORT_ADD;u>0&&(h+=u<<Tool.getBitNum(Model.LEN_TRANSPORT_STYLE));var c=i>>Model.OFFSET_TRANSPORT_ADD_2&Model.LEN_TRANSPORT_ADD_2;c>0&&(h+=c<<Tool.getBitNum(Model.LEN_TRANSPORT_STYLE)+Model.LEN_TRANSPORT_ADD);var T,p=r>0&&s>0;T=h>0&&!o?h==t.HOUSE_TWO_PEOPLE?a==Define.SEX_MALE?t.SPR_INDEX_MAN_HOUSE_WORLD_START+h:t.SPR_INDEX_WOMAN_HOUSE_WORLD_START+h:this.getHorseSpriteNameIDByWeapon(a,h,r,s,p):t.getSpriteNameIDByWeapon(t.getDefaultSprNameID(a,o),r,s,p,o);var d=t.createSpritexxx(T,!1,!1,o,a,!0);if(null==d)return d;var E=new ChangeSpriteInfo(e,n,i,a,r,s,l,h,p,o);if(d.setup?d.doChangeSpriteIcon(E):d.doPresetChangeSprite(E),l>0&&(d.cloakSprite=t.createSpritex(t.SPR_INDEX_CLOAK_START+l,o),d.cloakSprite)){var g=new ChangeSpriteInfo(e,n,i,a,r,s,l,h,p,o);d.cloakSprite.doChangeSpriteIcon(g)}return 2!=h&&4!=h||o||d.setHighTransport(!0),d.refresh(),d},t.getDefaultSprNameID=function(t,e){var n;return t==Define.SEX_MALE?(n=GameSprite.SPR_INDEX_MAN_WORLD_START,e&&(n=GameSprite.SPR_INDEX_MAN_BATTLE_START)):(n=GameSprite.SPR_INDEX_WOMAN_WORLD_START,e&&(n=GameSprite.SPR_INDEX_WOMAN_BATTLE_START)),n},t.getDefaultMiniSprNameID=function(t,e){return null},t.getSpriteNameIDByWeapon=function(t,e,n,i,o){var a=0;e>0&&((a=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD+(e-1>>4))==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?a=0:a==Define.BALL_WEAPON_ID_AREA?a=Define.ITEM_TYPE_WEAPON_BALL:a==Define.BALL_WEAPON_ID_ONEHAND_GUN?a=Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:a==Define.BALL_WEAPON_ID_TWOHAND_GUN&&(a=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN));var r=0;n>0&&((r=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD+(n-1>>4))==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?r=0:r==Define.BALL_WEAPON_ID_AREA?r=Define.ITEM_TYPE_WEAPON_BALL:r==Define.BALL_WEAPON_ID_ONEHAND_GUN?r=Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:r==Define.BALL_WEAPON_ID_TWOHAND_GUN&&(r=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN));var s=a;switch(0!=r&&(s=r),s){case 0:case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:break;case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:t+=i?63:13;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:t+=i?65:15;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:t+=i?71:21;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:t+=72;break;case Define.ITEM_TYPE_WEAPON_TWOHAND_GUN:t+=73;break;default:t+=s}return t},t.getHorseSpriteNameIDByWeapon=function(t,e,n,i,o){var a=0;n>0&&((a=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD+(n-1>>4))==Define.BALL_WEAPON_ID_AREA?a=Define.ITEM_TYPE_WEAPON_BALL:a==Define.BALL_WEAPON_ID_ONEHAND_GUN?a=Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:a==Define.BALL_WEAPON_ID_TWOHAND_GUN&&(a=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN));var r=0;i>0&&((r=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD+(i-1>>4))==Define.BALL_WEAPON_ID_AREA?r=Define.ITEM_TYPE_WEAPON_BALL:r==Define.BALL_WEAPON_ID_ONEHAND_GUN?r=Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:r==Define.BALL_WEAPON_ID_TWOHAND_GUN&&(r=Define.ITEM_TYPE_WEAPON_TWOHAND_GUN));var s=a;0!=r&&(s=r);var l=GameSprite.SPR_INDEX_WEAPON_HOUSE_START+100*(e-1);switch(l>=GameSprite.SPR_INDEX_WEAPON_HOUSE_END&&(l+=GameSprite.SPR_INDEX_WEAPON_HOUSE_ADD_DIS),t==Define.SEX_FEMALE&&(l+=50),s){case 0:case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:return t==Define.SEX_MALE?GameSprite.SPR_INDEX_MAN_HOUSE_WORLD_START+e:GameSprite.SPR_INDEX_WOMAN_HOUSE_WORLD_START+e;case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:l+=o?33:13;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:l+=o?35:15;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:l+=o?41:21;break;case Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:l+=42;break;case Define.ITEM_TYPE_WEAPON_TWOHAND_GUN:l+=43;break;default:l+=s}return l},t.getSpriteByName=function(t,e){return null},t.getFragmentByName=function(t,e){return null},t.cloneSprite=function(e){return t.cloneSpritex(e,!0)},t.cloneSpritex=function(t,e){return null},t.getFragmentFileIndex=function(t,e){if(null==t)return-1;for(var n=0,i=t.length;i>n;n++)if(t[n]==e)return n;return-1},t.HOUSE_TWO_PEOPLE=11,t.HOUSE_TWO_PEOPLE_SPRITE=790,t.SPR_INDEX_MAN_HOUSE_WORLD_START=700,t.SPR_INDEX_WOMAN_HOUSE_WORLD_START=900,t.SPR_INDEX_CLOAK_START=1100,t}();__reflect(SpriteHelper.prototype,"SpriteHelper");var FrsCache,ChangeSpriteInfo=function(t,e,n,i,o,a,r,s,l,_){this.icon1=t,this.icon2=e,this.icon3=n,this.sex=i,this.lWeaponStyle=o,this.rWeaponStyle=a,this.backStyle=r,this.transportStyle=s,this.isTwoHand=l,this.isBattle=_};__reflect(ChangeSpriteInfo.prototype,"ChangeSpriteInfo"),function(t){var e={};t.parse=function(t){for(var n=new egret.ByteArray(t);n.position<n.length;){var i=n.readUnsignedShort(),o=(n.readUnsignedShort(),LocalFragmentFileSetup.parse(n));e[i]=o}},t.get=function(t){return e[t]}}(FrsCache||(FrsCache={}));var AnimationFrame=function(){};__reflect(AnimationFrame.prototype,"AnimationFrame");var LocalAnimationSetup=function(){function t(){this.animationID=-1,this.checkID=-1}return t.prototype.load=function(e){var n=e.readUnsignedByte(),i=e.readByte();this.animationID=e.readByte(),this.checkID=e.readByte();for(var o=new Array(n),a=new Array(n),r=0;n>r;r++){var s=new AnimationFrame;s.id=e.readByte(),s.duration=3*e.readByte(),i==t.MOVING&&(s.xSpeed=e.readByte()/3,s.ySpeed=e.readByte()/3),a[r]=s,o[r]=s.id}this.frames=a,this.frameIds=o},t.MOVING=16,t.NOT_MOVING=4,t}();__reflect(LocalAnimationSetup.prototype,"LocalAnimationSetup");var FragmentFileItem=function(){};__reflect(FragmentFileItem.prototype,"FragmentFileItem");var LocalFragmentFileSetup=function(){function t(){}return t.prototype.find=function(t){if(null==this.array)return null;for(var e=0;e<this.array.length;e++)if(this.array[e].id==t)return this.array[e];return null},t.parse=function(t){var e=t.readUnsignedByte();if(!(0>=e)){for(var n=new Array(e),i=0;e>i;i++){var o=new FragmentFileItem;o.id=t.readByte(),o.x=t.readUnsignedByte(),o.y=t.readUnsignedByte(),o.width=t.readUnsignedByte(),o.height=t.readUnsignedByte(),n[i]=o}return n}},t}();__reflect(LocalFragmentFileSetup.prototype,"LocalFragmentFileSetup");var FrameItem=function(){};__reflect(FrameItem.prototype,"FrameItem");var LocalFrameSetup=function(){function t(){}return t.prototype.load=function(t){var e=t.readUnsignedByte();if(!(0>=e)){for(var n=new Array(e),i=0;e>i;i++){var o=new FrameItem;o.fragmentFileId=t.readByte(),o.fragmentId=t.readByte(),o.centerX=t.readByte(),o.centerY=t.readByte(),o.transformType=Utility.getTranslate(t.readByte()),n[i]=o}this.array=n}},t}();__reflect(LocalFrameSetup.prototype,"LocalFrameSetup");var SpriteFrameRender,LocalSpriteSetup=function(){function t(){}return t.prototype.load=function(t,e){this.icons=e,this.loadFragmentFile(t),this.loadFrame(t),this.loadAnimation(t)},t.prototype.findAndReplaceIcon=function(t){for(var e in this.icons){var n=this.icons[e];if(0!=n&&!this.replaced[e]&&Math.floor(n/1e3)==Math.floor(t/1e3))return this.replaced[e]=!0,n}return 0==this.icons.length?t:0},t.prototype.loadFragmentFile=function(t){var e=t.readUnsignedByte();if(0>=e)return null;var n=new Array(e),i=new Array(e);this.replaced={};for(var o=0;e>o;o++){n[o]=t.readByte();var a=new LocalFragmentFileSetup,r=t.readShort(),s=this.findAndReplaceIcon(r);a.baseNameID=r,a.fragmentNameID=s,i[o]=a}this.fragmentIds=n,this.fragmentFiles=i;for(var l=(i.length,0),_=i;l<_.length;l++){var h=_[l].fragmentNameID;if(0!=h)for(o=0;o<this.fragmentFiles.length;o++)this.fragmentFiles[o].fragmentNameID==h&&(this.fragmentFiles[o].array=FrsCache.get(h))}},t.prototype.onFragmentFileLoaded=function(t,e){},t.prototype.getFragmentFileData=function(t){for(var e=-1,n=0;n<this.fragmentIds.length;n++)if(this.fragmentIds[n]==t){e=n;break}return-1!=e?this.fragmentFiles[e]:null},t.prototype.loadFrame=function(t){var e=t.readUnsignedByte();if(!(0>=e)){for(var n=new Array(e),i=0;e>i;i++){var o=new LocalFrameSetup;o.load(t),n[i]=o}this.frames=n}},t.prototype.loadAnimation=function(t){var e=t.readUnsignedByte();if(!(0>=e)){for(var n=new Array(e),i=0;e>i;i++){var o=new LocalAnimationSetup;o.load(t),n[i]=o}this.animations=n}},t}();__reflect(LocalSpriteSetup.prototype,"LocalSpriteSetup"),function(t){t.gen=function(t,e,n){if(0!=t.length){var i=t.split("_");if(0!=i.length){var o=i.slice(1).map((function(t){return parseInt(t)})),a=i[0],r=this;RES.getResByUrl("resource/res/"+a+".spr",(function(t){var i=new egret.ByteArray(t),a=new LocalSpriteSetup;a.load(i,o),r.onSprLoaded(a,e,n)}),this)}}},t.onSprLoaded=function(t,e,n){var i=t.frames[e],o=i.array.length,a=new egret.DisplayObjectContainer,r=0,s=0,l=0,_=0,h=0,u=0,c=0,T=new Array(i.array.length),p={},d=function(e){var d=i.array[e],g=t.getFragmentFileData(d.fragmentFileId);if(null==g)return console.log("load fragment file setup failed"),"continue";var S=g.find(d.fragmentId);if(null==S)return o--,"continue";var m=g.fragmentNameID+"_"+S.id+"_"+d.centerX+"_"+d.centerY+"_"+d.transformType;p[m]=e,RES.getResByUrl("resource/res/"+g.fragmentNameID+".png",(function(t,e){if(r+=1,null!=t){var i=new egret.Bitmap(t),E=new egret.RenderTexture,g=new egret.Rectangle;g.x=S.x,g.y=S.y,g.width=S.width,g.height=S.height,E.drawToTexture(i,g),i.texture=E;var m=S.width,f=S.height;(d.transformType==Utility.TRANS_MIRROR_ROT270||d.transformType==Utility.TRANS_ROT90||d.transformType==Utility.TRANS_ROT270||d.transformType==Utility.TRANS_MIRROR_ROT90)&&(m=S.height,f=S.width),i.x=d.centerX-m/2,i.y=d.centerY-f/2,d.transformType==Utility.TRANS_MIRROR_ROT180?(i.rotation=180,i.scaleX=-1,i.y+=f):d.transformType==Utility.TRANS_MIRROR?(i.scaleX=-1,i.x+=m):d.transformType==Utility.TRANS_ROT180?(i.rotation=180,i.x+=m,i.y+=f):d.transformType==Utility.TRANS_MIRROR_ROT270?(i.rotation=270,i.scaleX=-1):d.transformType==Utility.TRANS_ROT90?(i.rotation=90,i.x+=m):d.transformType==Utility.TRANS_ROT270?(i.rotation=270,i.y+=f):d.transformType==Utility.TRANS_MIRROR_ROT90&&(i.rotation=90,i.scaleX=-1,i.x+=m,i.y+=f);var I=parseInt(e.substring(e.lastIndexOf("/")+1,e.length-4)),A=I+"_"+S.id+"_"+d.centerX+"_"+d.centerY+"_"+d.transformType,y=p[A];if(T[y]=i,s=Math.min(s,d.centerX-S.width/2),l=Math.max(l,d.centerX+S.width/2),_=Math.max(_,d.centerY+S.height/2),h=Math.min(h,d.centerY-S.height/2),Math.floor(I/1e3)==GameSprite.PNG_CLOTHES&&(u=d.centerX,c=d.centerY),r==o){for(var R=0;R<T.length;R++)null!=T[R]&&a.addChild(T[R]);var P=new egret.RenderTexture,C=new egret.Rectangle;C.x=s,C.y=h,C.width=l-s,C.height=_-h,P.drawToTexture(a,C),null!=n&&n(P,{x:-s,y:-h,cx:u,cy:c})}}}),E)},E=this;for(var g in i.array)d(g)}}(SpriteFrameRender||(SpriteFrameRender={}));var Xnimation=function(t){function e(e,n){var i=t.call(this)||this;return i.setup=e,i.sprite=n,i.name="animation",i}return __extends(e,t),e.prototype.getAnimationID=function(){return this.setup.id},e.prototype.getCheckID=function(){return this.setup.checkid},e.prototype.onInit=function(){this.frameIndex=0;var t=(this.sprite,this.setup.frames);if(null!=t){var e=t[0];this.curFrameDuration=e.duration,this.curFrameDurationCounter=0}},e.prototype.action=function(t){},e.prototype.ontick=function(t){var e=this.loopTime;if(0==e)return!1;if(this.leftTime-=t,this.leftTime>0)return!1;var n=this.sprite,i=this.setup.frames;if(null==i)return!1;var o,a=this.frameIndex;return o=i[a],this.sx+=o.xSpeed*t,this.sy+=o.ySpeed*t,++a>=i.length&&(-1==e?a=0:e>0?(a=0,0>=--e&&(a=i.length-1,null!=n&&n.isMotionTurnOff()&&n.setMotionAlive(!1))):a=i.length-1),o=i[a],this.leftTime=o.duration,this.loopTime=e,this.frameIndex=a,this.render(),!0},e.prototype.render=function(){var t=this.sprite,e=t.frames,n=this.frameIndex,i=this.setup.frames[n].id;if(null!=e[i]){this.x=this.originalX+this.sx,this.y=this.originalY+this.sy;var o=(this.numChildren,t.get(i));if(null!=o){t.body.texture=o,t.body.anchorOffsetX=o.xratio,t.body.anchorOffsetY=o.yratio;var a=t.cloakSprite;if(t.innerSprite,null!=a){var r=o.cloakx,s=o.cloaky;null!=r&&null!=s&&(r=this.sx+r,s=this.sy+s,a.x=r,a.y=s)}}}},e}(Animate);__reflect(Xnimation.prototype,"Xnimation");var XpriteFrames=function(){function t(t){this._loading=null,this._cache=null,this._center=null,this.firstFrameLoadedFunc=[],this.firstFrameLoadedObj=[],this._sprite=t;var e=t.setup;this._cache=new Array(e.count),this._loading=new Array(e.count)}return t.prototype.get=function(t){var e=this._cache[t];return e||(this._loading[t]||(this._loading[t]=!0,this.load(t)),e=this._cache[t])},t.prototype.load=function(t){var e=this._sprite.key,n=this;XpriteCache.instance.apply(e,(function(i){null==n._center&&(n._center=i),n._center[t],nato.loadImage("ani/"+e+"-"+t+".png",(function(e,i){n.onLoadImage(t,e)}),this)}))},t.prototype.onLoadImage=function(t,e){if(null!=e){this._cache[t]=e;var n=this._center[t];if(!n)return void console.error("load error: "+this._sprite.key+"-"+t);e.xratio=n.x,e.yratio=n.y,e.cloakx=n.cx,e.cloaky=n.cy,0==t&&this.execFirstFrameLoaded()}},t.prototype.setFirstFrameLoaded=function(t,e){this.firstFrameLoadedFunc.push(t),this.firstFrameLoadedObj.push(e)},t.prototype.execFirstFrameLoaded=function(){for(;this.firstFrameLoadedFunc.length;){var t=this.firstFrameLoadedFunc.pop(),e=this.firstFrameLoadedObj.pop();t&&e&&t.call(e)}},t}();__reflect(XpriteFrames.prototype,"XpriteFrames");var XpriteCache=function(){function t(){this._map={},this.maping={}}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.find=function(t){var e=t.key;this.apply(e,null);var n=this._map[e];return n||(n=new XpriteFrames(t),this._map=n),n},t.prototype.apply=function(t,e){var n;if(xlocal||!(n=nato.getAnchor(t))){var i=this.maping,o=i[t];if(o)o.push(e);else{(o=new Array).push(e),i[t]=o;var a=xprefix+t,r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(a,egret.HttpMethod.POST),r.send(),r.addEventListener(egret.Event.COMPLETE,(function(e){var n=JSON.parse(e.currentTarget.response),o=nato.addAnchor(t,n),a=i[t];if(a)for(var r;a.length>0;)(r=a.pop())&&r(o)}),null)}}else e&&e(n)},t._instance=new t,t}();__reflect(XpriteCache.prototype,"XpriteCache");var Xrame=function(){function t(t){this._id=t}return t.prototype.apply=function(t){},t}();__reflect(Xrame.prototype,"Xrame");var XrameSuite=function(){function t(){this._null=!1}return t.prototype.null=function(t){this._null=t},Object.defineProperty(t.prototype,"default",{get:function(){return nato.FrameCache.instance.default},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=this._arr;if(!e)return this._default;var n=e[t];if(null==n){var i=this._cache.get(t);null!=i?(n=i,e[t]=n):n=this._last}return this._last=n,n},t.prototype.load=function(t){this._cache=XpriteCache.instance.find(t),this._arr=new Array(t.frames.length),this._last||this._null||(this._last=this.default)},t.prototype.setFirstFrameLoaded=function(t,e){this._cache.setFirstFrameLoaded(t,e)},t}();__reflect(XrameSuite.prototype,"XrameSuite");var AnimationControl=function(){function t(e,n){this.type=t.BATTLE_CONTROL_NONE,this.subControlIndex=0,this.counter=0,this.delayTime=-1,this._isDone=!1,this.battleView=e,this.type=n}return t.prototype.setDelay=function(t){this.delayTime=t},t.prototype.excetePlayerVisible=function(){var t=this.actorPlayer;t&&t.battleSprite&&(t.battleSprite.setSpriteVisible(!0),t.dieSprite.parent&&t.dieSprite.parent.removeChild(t.dieSprite)),this.done()},t.prototype.executePlayerEscape=function(){if(null!=this.battleView&&null!=this.aniControl){if(0==this.counter){this.counter+=1;var e=this.aniControl.byte0,n=this.aniControl.byte1;if(this.actorPlayer=this.battleView.getPlayerByPos(e),null==this.actorPlayer)return void this.done();var i=void 0,o=[];if(n==Battle.ESCAPE_FAILED)return i=t.createBattlePlayerAnimation(this.battleView,e,GameSprite.ANIMATION_BATTLE_ATTACK_FALLBACK,GameSprite.ANIMATION_BATTLE_STAND,20,0,!1),this.battleView.addAnimationControl(i),void this.done();i=t.createBattlePlayerVisible(this.battleView,e),o.push(i),i=t.createBattlePlayerAnimation(this.battleView,e,GameSprite.ANIMATION_BATTLE_ATTACK_FALLBACK,GameSprite.ANIMATION_NONE,1,0,!1),o.push(i);var a=this.battleView.getPosition(e,BattleView.COORD_X),r=this.battleView.getPosition(e,BattleView.COORD_Y);a=Battle.isLeftSide(e)?-50:Main.instance.stage.stageWidth+50,i=t.createBattlePlayerMove(this.battleView,e,a,r),o.push(i),i=t.createBattlePlayerAnimation(this.battleView,e,GameSprite.ANIMATION_BATTLE_STAND,GameSprite.ANIMATION_NONE,-1,0,!1),o.push(i),this.setSubControlList(o)}else if(this.executeSubControls()){this.actorPlayer&&this.actorPlayer.battleSprite&&(this.resetPosition(this.actorPlayer),this.actorPlayer.battleSprite.setSpriteVisible(!1)),this.done();var s=this.battleView.getBattle();s&&s.type==Battle.LOCAL&&this.actorPlayer&&this.actorPlayer==xself&&this.battleView.closePlayerAnimation()}}else this.done()},t.prototype.executeSkill=function(){if(null!=this.battleView&&null!=this.aniControl&&null!=this.aniControl.datas)if(0==this.counter){this.counter+=1;var e=this.aniControl.datas;e.position=0;var n=this.aniControl.byte0,i=e.readByte(),o=e.readByte(),a=-1;Tool.isBit(Control.BCONTROL_HAS_AREA_LIST,o)&&(a=e.readByte());var r=null,s=null;if(a>=0&&null!=(s=this.battleView.getBattle().getSelectArea(n,i,a))){r=new Array(s.length);for(var l=0;l<s.length;l++)r[l]=this.battleView.getPlayerByPos(s[l])}var _=e.readByte(),h=e.readByte(),u=e.readUnsignedShort(),c=0;Tool.isBit(Control.BCONTROL_HAS_ANIME2,o)&&(c=e.readUnsignedShort());var T=null;if(Tool.isBit(Control.BCONTROL_HAS_NAME,o)&&(T=e.readUTF()),this.actorPlayer=this.battleView.getPlayerByPos(n),null==this.actorPlayer||null==this.actorPlayer.battleSprite)return void this.done();if(_==Define.SKILL_POS_CENTER){var p=Main.instance.stage.stageWidth/2,d=Main.instance.stage.stageHeight/2;this.actorPlayer.battleSprite.setSpritePosition(p,d)}if(3==this.actorPlayer.getType()||6==this.actorPlayer.getType()||4==this.actorPlayer.getType()||7==this.actorPlayer.getType())this.actorPlayer.checkBattleMsgByName(T);else if(egret.is(this.actorPlayer,"Monster")){this.actorPlayer.checkBattleMsg()}if(null!=this.selfControlList)for(l=0;l<this.selfControlList.length;l++){var E=this.selfControlList[l];this.battleView.addAnimationControl(E)}var g=this.battleView.getPlayerByPos(i);(null==r||r.length<=0)&&(r=[]).push(g);var S=[],m=void 0;if(_==Define.SKILL_POS_FRONT){m=t.createBattlePlayerAnimation(this.battleView,n,GameSprite.ANIMATION_BATTLE_ATTACK_START,GameSprite.ANIMATION_BATTLE_ATTACK_MOVE,1,0,!1),S.push(m);var f=this.battleView.getPosition(i,BattleView.COORD_X),I=this.battleView.getPosition(i,BattleView.COORD_Y),A=this.battleView.getPosition(this.actorPlayer.position,BattleView.COORD_X);A>f?f+=2*BattleView.POS_MIN_WIDTH-10:f>A&&(f-=2*BattleView.POS_MIN_WIDTH-10),m=t.createBattlePlayerMove(this.battleView,n,f,I),S.push(m)}if(m=t.createBattleDoAttack(this.battleView,this.actorPlayer,r,_,h,u,c,this.effectControlList),S.push(m),_==Define.SKILL_POS_FRONT){m=t.createBattlePlayerAnimation(this.battleView,n,GameSprite.ANIMATION_BATTLE_ATTACK_FALLBACK,GameSprite.ANIMATION_NONE,1,0,!1),S.push(m);f=this.battleView.getPosition(n,BattleView.COORD_X),I=this.battleView.getPosition(n,BattleView.COORD_Y);m=t.createBattlePlayerMove(this.battleView,n,f,I),S.push(m)}m=t.createBattlePlayerAnimation(this.battleView,n,GameSprite.ANIMATION_BATTLE_STAND,GameSprite.ANIMATION_NONE,-1,0,!1),S.push(m),this.setSubControlList(S)}else this.executeSubControls()&&(this.resetPosition(this.actorPlayer),this.done());else this.done()},t.prototype.executePlayerMove=function(){if(null!=this.actorPlayer&&null!=this.actorPlayer.battleSprite){var e=this.baseX,n=this.baseY,i=Tool.entropy(this.actorPlayer.battleSprite.x,e,!0),o=Tool.entropy(this.actorPlayer.battleSprite.y,n,!0);this.actorPlayer.battleSprite.setSpritePosition(i,o),this.counter++,this.counter>t.MAX_SKILL_MOVE_COUNT&&this.actorPlayer.battleSprite.setSpritePosition(e,n),this.actorPlayer.battleSprite.x==e&&this.actorPlayer.battleSprite.y==n&&this.done()}else this.done()},t.prototype.executePlayerShake=function(){if(null!=this.actorPlayer&&null!=this.actorPlayer.battleSprite){this.counter--;var t=0,e=0;this.counter>0&&(t=0==(1&this.counter)?-2:2,e=Tool.rand(-1,1)),this.actorPlayer.battleSprite.setSpritePosition(this.baseX+t,this.baseY+e),this.counter<=0&&(this.actorPlayer.battleSprite.setSpritePosition(this.baseX,this.baseY),this.done())}else this.done()},t.prototype.executePlayerAnimation=function(){if(null!=this.obj)if(this.obj instanceof PlayerAnimation){var t=this.obj;t.action()&&(this.playerDie(t),this.done())}else this.done();else this.done()},t.prototype.playerDie=function(t){if(null!=t){var e=t.player,n=e.battleSprite;if(null!=e&&null!=n&&n.isSpriteVisible()&&t.isDie){n.setSpriteVisible(!1);var i=e.dieSprite;null!=i&&(i.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_DIE,1),i.setMotionTurnOff(!0),i.setSpritePosition(n.x,n.y),e.battleEffectSpriteList.push(i),this.battleView.addChild(i))}}},t.prototype.executeDoAttack=function(){null!=this.obj?this.obj instanceof DoAttack?this.obj.action()&&this.done():this.done():this.done()},t.prototype.action=function(){if(this.delayTime>0)this.delayTime--;else switch(this.type){case t.BATTLE_CONTROL_NUM_EFFECT:this.executeNumEffect();break;case t.BATTLE_CONTROL_HPMP_UPDATE:this.executeHPMPUpdate();break;case t.BATTLE_CONTROL_SKILL:this.executeSkill();break;case t.BATTLE_CONTROL_ESCAPE:this.executePlayerEscape();break;case t.BATTLE_CONTROL_VISIBLE:this.excetePlayerVisible();break;case t.BATTLE_CONTROL_PLAYER_ANIMATION:this.executePlayerAnimation();break;case t.BATTLE_CONTROL_PLAYER_SHAKE:this.executePlayerShake();break;case t.BATTLE_CONTROL_MOVE:this.executePlayerMove();break;case t.BATTLE_CONTROL_DO_ATTACK:this.executeDoAttack()}},t.prototype.executeHPMPUpdate=function(){if(null!=this.obj&&null!=this.actorPlayer){var t=this.obj;null!=t&&t.length>=2&&this.actorPlayer.addValue(t[0],t[1]);var e=!1;(this.actorPlayer==xself||this.actorPlayer==xself.getPet())&&(e=!0),1==e&&(PanelManager.battleUI.headInfoView.updateRoleProgress(),PanelManager.battleUI.headInfoView.updatePetProgress()),this.done()}else this.done()},t.prototype.executeNumEffect=function(){null!=this.obj?egret.is(this.obj,"EffectNum")?this.obj.action()&&this.done():this.done():this.done()},Object.defineProperty(t.prototype,"isDone",{get:function(){return this._isDone},enumerable:!0,configurable:!0}),t.prototype.done=function(){this._isDone=!0},t.prototype.resetPosition=function(t){if(null!=this.battleView&&null!=t&&null!=t.battleSprite){var e=this.battleView.getPosition(t.position,BattleView.COORD_X),n=this.battleView.getPosition(t.position,BattleView.COORD_Y);t.battleSprite.setSpritePosition(e,n)}},t.prototype.executeSubControls=function(){return null==this.subControls||this.subControlIndex<0||this.subControlIndex>=this.subControls.length||(null==this.subControls[this.subControlIndex]?this.subControlIndex++:(this.subControls[this.subControlIndex].action(),this.subControls[this.subControlIndex].isDone&&(this.subControlIndex++,this.subControlIndex<this.subControls.length&&this.subControls[this.subControlIndex].action())),!1)},t.prototype.setSubControlList=function(t){null!=t&&(this.subControls=t)},t.prototype.addVSpeed=function(t){null!=this.obj&&egret.is(this.obj,"EffectNum")&&(this.obj.vSpeed+=t)},t.createBattleDoAttack=function(e,n,i,o,a,r,s,l){if(null==e)return null;var _=new t(e,t.BATTLE_CONTROL_DO_ATTACK),h=new DoAttack(e,n,i,o,a,r,s,l);return _.obj=h,_},t.createBattlePlayerMove=function(e,n,i,o){if(null==e)return null;var a=e.getPlayerByPos(n);if(null==a)return null;var r=new t(e,t.BATTLE_CONTROL_MOVE);return r.actorPlayer=a,r.baseX=i,r.baseY=o,r},t.createBattlePlayerShake=function(e,n,i){if(null==e)return null;var o=e.getPlayerByPos(n);if(null==o||null==o.battleSprite)return null;var a=new t(e,t.BATTLE_CONTROL_PLAYER_SHAKE);return a.actorPlayer=o,a.counter=i,a.baseX=o.battleSprite.x,a.baseY=o.battleSprite.y,a},t.createBattlePlayerVisible=function(e,n){if(null==e)return null;var i=e.getPlayerByPos(n);if(null==i)return null;var o=new t(e,t.BATTLE_CONTROL_VISIBLE);return o.actorPlayer=i,o},t.createBattleSkill=function(e,n){if(null==e)return null;if(null==n)return null;var i=new t(e,t.BATTLE_CONTROL_SKILL);return i.aniControl=n,i.getAniEffectList(e,n.subControls),i},t.createBattlePlayerEscape=function(e,n){if(null==e)return null;if(null==n)return null;var i=new t(e,t.BATTLE_CONTROL_ESCAPE);return i.aniControl=n,i},t.getEffectCloneSprite=function(t,e){if(null==t)return null;if(e==GameSprite.EFF_HIT)return GameSprite.cloneSprite(t.effHitSprite);if(e==GameSprite.SPRITE_DEF_FIELD)return GameSprite.cloneSprite(t.effMagicFieldSprite);for(var n,i=0;i<Battle.MAX_POS;i++){var o=t.getPlayerByPos(i);if(null!=o&&null!=(n=o.battleEffectSpriteList))for(var a=n.length,r=0;a>r;r++){var s=n[r];if(null!=s&&s.getnameID()==e)return GameSprite.cloneSprite(s)}}return null},t.getAniEffectByControl=function(e,n,i,o){var a,r=n.byte0,s=n.counter,l=n.int0,_=n.int1,h=n.int2,u=BattleConst.isEffectStatus(s,BattleConst.EFFECT_CRITICAL),c=BattleConst.isEffectStatus(s,BattleConst.EFFECT_DIE),T=BattleConst.isEffectStatus(s,BattleConst.EFFECT_HIT),p=BattleConst.isEffectStatus(s,BattleConst.EFFECT_REBORN),d=BattleConst.isEffectStatus(s,BattleConst.EFFECT_STUN),E=BattleConst.isEffectStatus(s,BattleConst.EFFECT_MP_CHANGE),g=BattleConst.isEffectStatus(s,BattleConst.EFFECT_BLOCK),S=BattleConst.isEffectStatus(s,BattleConst.EFFECT_DEF_FIELD),m=BattleConst.isEffectStatus(s,BattleConst.EFFECT_TOUCH),f=BattleConst.isEffectStatus(s,BattleConst.EFFECT_DIE_DELAY),I=BattleConst.isEffectStatus(s,BattleConst.EFFECT_KEEPOUT);if(_>0){var A=t.getEffectCloneSprite(e,_);null==A&&(A=SpriteHelper.createBattleEffSprite(_)),t.addBattleSprite(A,1,e.getPlayerByPos(r))}if(d&&(a=t.createBattlePlayerShake(e,r,6),o.push(a)),p&&(a=t.createBattlePlayerVisible(e,r),o.push(a)),T){if(I){var y=xworld.offsetImg;return a=t.createNumEffect(e,null,e.getPlayerByPos(r),-1,0,0,-1,y),t.updateAffectCount(a,i,r),void o.push(a)}if(0!=l)E&&0>l||(a=t.createDropHpEffect(e,l,r,u,E),t.updateAffectCount(a,i,r),o.unshift(a)),a=t.createHPMPUpdate(e,r,E?ModelConst.MP_DISPLAY:ModelConst.HP_DISPLAY,l),o.push(a);else if(m){if(null!=(a=t.createDropHpEffect(e,l,r,u,E)))a.obj.setIndex=ImageSet.IMG_SET_NUMBER_BATTLE_DMG;t.updateAffectCount(a,i,r),o.unshift(a)}if(!E&&(0>l||S||m)){var R=GameSprite.ANIMATION_BATTLE_ATTACK_HURT,P=GameSprite.ANIMATION_BATTLE_STAND;a=t.createBattlePlayerAnimation(e,r,R,P,1,0,c,S),o.push(a),S&&(a=t.createDropHpEffect(e,h,r,u,E,S),t.updateAffectCount(a,i,r),o.unshift(a))}}else{if(f)return a=t.createBattlePlayerAnimation(e,r,GameSprite.ANIMATION_BATTLE_ATTACK_HURT,GameSprite.ANIMATION_BATTLE_STAND,1,0,!0,!1),void o.push(a);y=void 0;if(g)y=xworld.blockImg;else{var C=3;Battle.isLeftSide(r)&&(C=-C),a=t.createBattlePlayerAnimation(e,r,GameSprite.ANIMATION_BATTLE_ATTACK_FALLBACK,GameSprite.ANIMATION_BATTLE_STAND,10,C,!1),o.push(a),y=xworld.missImg}a=t.createNumEffect(e,null,e.getPlayerByPos(r),-1,0,0,-1,y),t.updateAffectCount(a,i,r),o.push(a)}},t.createHPMPUpdate=function(e,n,i,o){var a=new t(e,t.BATTLE_CONTROL_HPMP_UPDATE);return a.actorPlayer=e.getPlayerByPos(n),a.obj=[i,o],a},t.createNumEffect=function(e,n,i,o,a,r,s,l){var _=new t(e,t.BATTLE_CONTROL_NUM_EFFECT),h=new EffectNum(i,o,a,n,r,s);return h.setImage(l),_.obj=h,_},t.createDropHpEffect=function(t,e,n,i,o,a){void 0===a&&(a=!1);var r=t.getPlayerByPos(n);if(null==r)return null;if(null==r.battleSprite)return null;var s=0;s=Battle.isLeftSide(n)?-1:1;var l,_=-4,h=ImageSet.IMG_SET_NUMBER_BATTLE_DMG;return e>=0&&(h=ImageSet.IMG_SET_NUMBER_BATTLE_ADD,s=0,_=-3),1==o&&(h=ImageSet.IMG_SET_NUMBER_BATTLE_MP),0>e&&(e=-e),i&&(l=t.criticalImage,h=ImageSet.IMG_SET_NUMBER_BATTLE_CRITICAL),a&&(h=ImageSet.IMG_SET_NUMBER_BATTLE_MAGICDEF),this.createNumEffect(t,""+e,r,h,0,s,_,l)},t.createBattlePlayerAnimation=function(e,n,i,o,a,r,s,l){if(void 0===l&&(l=!1),null==e)return null;var _=e.getPlayerByPos(n);if(null==_)return null;var h=new t(e,t.BATTLE_CONTROL_PLAYER_ANIMATION),u=new PlayerAnimation(e,_,i,o,a,r,s);return u.isMagicField=l,h.obj=u,h},t.updateAffectCount=function(t,e,n){if(null!=t&&null!=e&&!(0>n||n>=e.length)){var i=e[n];t.setDelay(2*i),t.addVSpeed(-i),e[n]++}},t.prototype.getAniEffectList=function(e,n){for(var i=[],o=0;o<Battle.MAX_POS;o++)i[o]=0;null==this.effectControlList&&(this.effectControlList=[]),null==this.selfControlList&&(this.selfControlList=[]);for(var a=0,r=n;a<r.length;a++){var s=r[a];null!=s&&(s.type==Control.TYPE_BATTLE_SELF_EFFECT?t.getAniEffectByControl(e,s,null,this.selfControlList):t.getAniEffectByControl(e,s,i,this.effectControlList))}},t.prototype.toString=function(){return""+["空动画","攻击/技能","逃跑","掉血动画","角色晃动","角色动作切换","复活","移动","攻击/技能发生","","更新血量"][this.type]},t.addBattleSprite=function(t,e,n){null!=n&&null!=n.battleSprite&&null!=t&&(null==n.battleEffectSpriteList&&(n.battleEffectSpriteList=[]),t.setMotionAlive(!0),t.setMotionTurnOff(!0),t.setCurAnimationLoopTime(e),t.setSpritePosition(n.battleSprite.x,n.battleSprite.y),BattleView.instance.addChild(t),xhd&&t.setScale(nato.mapRatio),Battle.isLeftSide(n.position)||t.setRotate(!0),n.battleEffectSpriteList.push(t))},t.prototype.removeEffectFromStage=function(){egret.is(this.obj,"EffectNum")&&this.battleView.contains(this.obj)&&this.battleView.removeChild(this.obj)},t.BAR_WIDTH=30,t.BAR_WIDTH_HALF=t.BAR_WIDTH>>1,t.BAR_HEIGHT=7,t.BAR_HEIGHT_HALF=t.BAR_HEIGHT>>1,t.BATTLE_CONTROL_NONE=0,t.BATTLE_CONTROL_SKILL=1,t.BATTLE_CONTROL_ESCAPE=2,t.BATTLE_CONTROL_PLAYER_SHAKE=4,t.BATTLE_CONTROL_NUM_EFFECT=3,t.BATTLE_CONTROL_PLAYER_ANIMATION=5,t.BATTLE_CONTROL_VISIBLE=6,t.BATTLE_CONTROL_HPMP_UPDATE=10,t.BATTLE_CONTROL_MOVE=7,t.BATTLE_CONTROL_DO_ATTACK=8,t.HURT_SHAKE_TIME=6,t.MAX_SKILL_MOVE_COUNT=15,t}();__reflect(AnimationControl.prototype,"AnimationControl");var Battle=function(){function t(e,n,i,o){this.battleSeq=0,this.type=t.LOCAL,this.inOneKeyDaily=!1,this.result=0,this._isRemoteWaiting=!1,this.round=0,this.roundEndTime=0,this.isLeftHavePlayer=!1,this.isRightHavePlayer=!1,this.seed=0,this.guardHash={},this.playerPlanData={},this.resultControlList=[],this.totalHitTime=1,this.block=0,this.isLeftHand=!0,this.atkType=0,this.waitStatus=0,this.nextBattleGroupID=0,this.type=i,this.seed=e,this.random=new Random(e),this.playerList=n,this.setMonsterGroup(o),xworld.readyToBattle=!0,this.initBattleRowNum(),this.isLeftHavePlayer=this.isHavePlayer(0,t.LEFT_MAX_POS),this.isRightHavePlayer=this.isHavePlayer(t.LEFT_MAX_POS,t.MAX_POS),this.round=0,this.updateRoundEndTime(),this.initKeepoutatktime(n)}return t.isEffectStatus=function(t,e){return 0!=(t&e)},t.getPositionSide=function(e){return e<t.LEFT_MAX_POS?t.LEFT_SIDE:t.RIGHT_SIDE},t.isLeftSide=function(e){return this.getPositionSide(e)==t.LEFT_SIDE},t.prototype.getLeftPosNum=function(){return 2*this.rowLeft},t.prototype.getRightPosNum=function(){return 2*this.rowRight},t.prototype.setRemoteWaiting=function(t){this._isRemoteWaiting=t},t.prototype.isRemoteWaiting=function(){return this._isRemoteWaiting},t.prototype.getPlanTime=function(){return Utility.getPlanTime(this.roundEndTime)},t.prototype.updateRoundEndTime=function(){0==this.round?this.roundEndTime=(new Date).getTime()+t.FIRST_ROUND_PLAN_TIME:this.roundEndTime=(new Date).getTime()+t.NORMAL_ROUND_PLAN_TIME},t.prototype.setMonsterGroup=function(t){this.monsterGroup=t},t.prototype.getMonsterGroup=function(){return this.monsterGroup},t.prototype.initKeepoutatktime=function(t){if(!(null==t||t.length<=0))for(var e=0;e<t.length;e++){var n=t[e];null!=n&&(n.keepout_atk_time=n.get(ModelConst.KEEPOUT_ATK_TIME))}},t.prototype.isBattleFinish=function(){return 0!=this.result},t.prototype.setBattleResult=function(t){this.result=t},t.prototype.resetBattleResult=function(){this.result=0},t.prototype.updateBattleResult=function(){var e=this.getActivePlayerNum(0,this.getLeftPosNum(),this.isLeftHavePlayer),n=this.getActivePlayerNum(t.LEFT_MAX_POS,t.MAX_POS,this.isRightHavePlayer);0>=e&&0>=n?this.result=4:0>=e?this.result=2:0>=n?this.result=1:this.round>=t.MAX_ROUND&&(this.result=3)},t.prototype.getPlayerByPos=function(t){return null==this.playerList||this.isInvalidePos(t)?null:this.playerList[t]},t.prototype.isInvalidePos=function(e){return 0>e||e>t.MAX_POS},t.prototype.isHavePlayer=function(t,e){for(var n=t;e>n;n++){var i=this.getPlayerByPos(n);if(null!=i&&3==i.getType())return!0}return!1},t.prototype.getActivePlayerNum=function(t,e,n,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1);for(var a=0,r=t;e>r;r++){var s=this.getPlayerByPos(r);null!=s&&(n&&3!=s.getType()||this.isValidBattlePlayer(s,i,o)&&a++)}return a},t.prototype.isValidBattlePlayer=function(t,e,n){if(void 0===e&&(e=!1),void 0===n&&(n=!1),null==t)return!1;if(t.isBattleStatus(Player.BSTATUS_ESCAPE)){if(n)if(i=t.battleSprite&&t.battleSprite.isSpriteVisible())return!0;return!1}if(t.isDeadNoWithDelay()){if(e){var i=t.battleSprite&&t.battleSprite.isSpriteVisible(),o=t.dieSprite&&!t.dieSprite.isAllAniStop;if(i||o)return!0}return!1}return!0},t.createLocalBattle=function(e,n,i){return new t(e,n,t.LOCAL,i)},t.createRemoteBattle=function(e,n,i){return new t(e,n,t.REMOTE,i)},t.createPKBattle=function(e,n){return new t(e,n,t.PK,null)},t.getPositionColumn=function(e){return t.isLeftSide(e)?0==(1&e)?t.POSITION_COLUMN_1:t.POSITION_COLUMN_2:0==(1&e)?t.POSITION_COLUMN_3:t.POSITION_COLUMN_4},t.prototype.initBattleRowNum=function(){this.rowLeft=5,this.rowRight=5;for(var e,n,i=0;i<t.MAX_POS;i++){null!=this.getPlayerByPos(i)&&(t.isLeftSide(i)?(e=i/2+1)>this.rowLeft&&(this.rowLeft=e):(n=(i-t.LEFT_MAX_POS)/2+1)>this.rowRight&&(this.rowRight=n))}this.rowLeft>=t.MAX_ROW_NUM&&(this.rowLeft=t.MAX_ROW_NUM),this.rowRight>=t.MAX_ROW_NUM&&(this.rowRight=t.MAX_ROW_NUM)},t.prototype.cleanGuardData=function(){this.guardHash={}},t.prototype.setSkillGuardData=function(t,e,n){if(null!=t&&!(null==n||n.length<=0)){var i=t.power1;if(!(i<Define.POWER_GUARD_STR_ATTACK||i>Define.POWER_GUARD_ALL_ATTACK)){var o=t.powerValue1;if(!(0>=o))for(var a=0;a<n.length;a++){var r=n[a];this.addGuardData(r,i,e,o)}}}},t.prototype.addGuardData=function(e,n,i,o){if(!(0>e||e>=t.MAX_POS)){var a=Tool.setKeyXY(e,n),r=Tool.setKeyXY(i,o);this.guardHash[a]=r}},t.prototype.getGuardHashSize=function(){var t=0;for(var e in this.guardHash)t+=1;return t},t.prototype.getGuardPos=function(e,n){if(this.getGuardHashSize()<=0)return-1;if(0>e||e>=t.MAX_POS)return-1;if(n==Define.ATKTYPE_BLESS)return-1;var i=0,o=Tool.setKeyXY(e,Define.POWER_GUARD_ALL_ATTACK),a=this.guardHash[o];null!=a&&(i=a);var r=0,s=-1;switch(n){case Define.ATKTYPE_STR:case Define.ATKTYPE_RANGE_STR:s=this.guardHash[Tool.setKeyXY(e,Define.POWER_GUARD_STR_ATTACK)];break;case Define.ATKTYPE_AGI:case Define.ATKTYPE_RANGE_AGI:s=this.guardHash[Tool.setKeyXY(e,Define.POWER_GUARD_AGI_ATTACK)];break;case Define.ATKTYPE_MAGIC:s=this.guardHash[Tool.setKeyXY(e,Define.POWER_GUARD_MAGIC_ATTACK)];break;case Define.ATKTYPE_CURSE:s=this.guardHash[Tool.setKeyXY(e,Define.POWER_GUARD_CURSE_ATTACK)]}if(null==a&&-1==s)return-1;null!=s&&(r=s);var l=Tool.getXKey(i),_=Tool.getYKey(i),h=Tool.getXKey(r),u=Tool.getYKey(r);return _>u&&(u=_,h=l),u>0&&this.randInt(100)<u?h:-1},t.prototype.setPlan=function(e,n){null!=n&&(0>e||e>=t.MAX_POS||(this.playerPlanData[e]=n))},t.prototype.getPlanData=function(e){return null==this.playerPlanData||0>e||e>=t.MAX_POS?null:this.playerPlanData[e]},t.prototype.clearPlan=function(e){null!=this.playerPlanData&&(0>e||e>=t.MAX_POS||(this.playerPlanData[e]=null))},t.prototype.cleanAniControlList=function(){this.resultControlList.length=0},t.prototype.addAniControl=function(t){null!=t&&this.resultControlList.push(t)},t.prototype.mergeControlList=function(e,n){if(null==e)return null;for(var i=0;i<e.length;i++){var o=e[i];if(null!=o)for(var a=o.counter,r=o.int1,s=e.length-1;s>i;s--){var l=e[s];if(null!=l){var _=o.int0,h=l.counter,u=l.int0;if(r==l.int1&&!(n&&t.isEffectStatus(h,BattleConst.EFFECT_REBORN)||t.isEffectStatus(a,BattleConst.EFFECT_MP_CHANGE)!=t.isEffectStatus(h,BattleConst.EFFECT_MP_CHANGE)||0>_&&u>=0||_>=0&&0>u)){var c=t.isEffectStatus(a,BattleConst.EFFECT_HIT);if(c==t.isEffectStatus(h,BattleConst.EFFECT_HIT)&&(0!=c||t.isEffectStatus(a,BattleConst.EFFECT_BLOCK)==t.isEffectStatus(h,BattleConst.EFFECT_BLOCK))){o.counter|=h,o.int0+=u;var T=e.indexOf(l);e.splice(T,1)}}}}}return e},t.prototype.logicRound=function(){var t;this.cleanGuardData(),this.cleanAniControlList(),this.doRoundBuffer(),t=this.sortModelListBySpeed();for(var e=0;e<t.length;e++){null!=(o=t[e])&&this.doRoundHpMp(o)}for(e=0;e<t.length;e++){null!=(o=t[e])&&this.doAutoSkill(o)}for(var n=0,i=t=this.sortModelListBySpeed();n<i.length;n++){var o;if(null!=(o=i[n])){var a=this.getPlanData(o.position),r=!1;a&&(r=this.doPlayerPlan(o,a)),1!=r&&(3==o.getType()||(4==o.getType()?this.doPetAI(o):o instanceof Monster&&this.doMonsterAI(o)))}}this.doEndRoundCheckBuffer(),this.round+=1,this.updateRoundEndTime(),this.waitStatus=0,this.updateBattleResult()},t.prototype.doRoundHpMp=function(t){var e=t.get(ModelConst.HEAL_RECOVERY),n=t.get(ModelConst.MANA_RECOVERY),i=[];if(e>0){var o=!0;(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BURN))||t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BLOOD)))&&(o=!1),o&&Define.processBattleHpMpPower(t,ModelConst.HP,e,0,i)}if(n>0){o=!0;t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_POISON))&&(o=!1),o&&Define.processBattleHpMpPower(t,ModelConst.MP,n,0,i)}for(var a=0;a<i.length;a++){var r=i[a];this.addAniControl(r)}},t.prototype.doRoundBuffer=function(){for(var t=0;t<this.playerList.length;t++){var e=this.playerList[t];if(null!=e)if(e.isDeadNoWithDelay()){e.isHaveCanNotReliveBuffer()&&e.runBufferList(!0)}else if(!e.isBattleStatus(Player.BSTATUS_ESCAPE)){var n=e.runBufferList(!0);if(null!=(n=this.mergeControlList(n,!0)))for(var i=0;i<n.length;i++){var o=n[i];this.addAniControl(o)}}}},t.prototype.checkDie1Hp=function(t,e){if(null!=t&&0!=t.isDead()){var n=[];if(0==t.isTabStatus(Model.BUFFER_DIE_1HP_CHECK)&&t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_DIE_1HP)))0==t.isHaveCanNotReliveBuffer()&&(t.setTabStatus(!0,Model.BUFFER_DIE_1HP_CHECK),null!=e?Define.processBattleReborn(t,1,0,Define.SPRITE_USE_ITEM,e):Define.processBattleReborn(t,1,0,Define.SPRITE_USE_ITEM,n));if(null==e)for(var i=0;i<n.length;i++){var o=n[i];this.addAniControl(o)}}},t.prototype.doEndRoundCheckBuffer=function(){for(var t=[],e=0;e<this.playerList.length;e++){var n=this.playerList[e];if(null!=n){var i=n.isHaveCanNotReliveBuffer();if(n.isDead())if(0==n.isTabStatus(Model.BUFFER_DIE_FULLHP_CHECK)&&n.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_DIE_FULLHP))){if(0==i){n.setTabStatus(!0,Model.BUFFER_DIE_FULLHP_CHECK),Define.processBattleReborn(n,n.get(ModelConst.HPMAX),0,Define.SPRITE_USE_ITEM,t);continue}}else if(n.isDeadDelay()){n.setTabStatus(!0,Model.BUFFER_DIE_DELAY_CHECK);var o=Control.createBattleTargetEffectOther(n.position,0,BattleConst.EFFECT_DIE_DELAY,0);t.push(o),n.clearBufferList(!1),i&&n.runBufferList(!1);continue}n.isDead()||n.isBattleStatus(Player.BSTATUS_ESCAPE)?(n.clearBufferList(!1),i&&n.runBufferList(!1)):(n.runBufferList(!1),this.doCheckWilBufferRemove(n))}}for(var a=0;a<t.length;a++){o=t[a];this.addAniControl(o)}},t.prototype.doCheckWilBufferRemove=function(t){if(null!=t){var e=t.battleBufferList;if(!(null==e||e.length<=0)){for(var n=[],i=0;i<e.length;i++){var o=e[i];null!=o&&o.getStatus()!=Define.BUFFER_NONE&&Define.getBufferType(o.getStatus())==Define.BUFFER_TYPE_DEBUFF&&n.push(o)}if(!(n.length<=0))if(0!=this.isWilSuccess(t,null,null)){var a=this.randRange(0,n.length-1);if(!(0>a||a>=n.length)){var r=n[a];if(null!=r){r.destroy(t);var s=e.indexOf(r);e.splice(s,1),s=n.indexOf(r),n.splice(s,1);for(i=0;i<n.length;i++){var l=n[i];if(null!=l&&l.getStatus()==r.getStatus())return}t.clearBattleStatus(Define.getBufferBitValue(r.getStatus()))}}}}}},t.prototype.doAutoSkill=function(t){if(null!=t){var e=null;if(t instanceof Monster){if(null==(e=t.getSkillByAI(this,!0)))return;return void this.doUseSkill(t,e,this.searchAICursor(t,e.area))}var n=this.getAutoSkillIDByRound(t);if(!(0>n)&&null!=(e=t.getSkillByID(n))){var i;i=this.searchAICursor(t,e.area),this.doUseSkillByID(t,n,i)}}},t.prototype.doUseSkillByID=function(t,e,n){if(null!=t){var i=t.getSkillByID(e);null!=i&&this.doUseSkill(t,i,n)}},t.prototype.doUseSkill=function(t,e,n){if(0!=this.isValidPos(n)&&null!=t&&!t.isDeadNoWithDelay()&&!t.isBattleStatus(Player.BSTATUS_ESCAPE)&&e.type!=Define.SKILL_TYPE_PASSIVE&&0!=Skill.isCanUse(t,e,null)&&!t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN))){if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_CHAO))){if(e.type==Define.SKILL_TYPE_ROUND)return;n=MonsterAI.selectRandActivePlayer(this,t)}else{if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_SILENCE))){if(e.type==Define.SKILL_TYPE_ROUND)return;return void(0==this.isSameSide(t.position,n)&&this.doAttack(t,n))}if(1==Define.isPhysicalAtkType(e.skillAtkType)){if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BLOCK_SKILL))){if(e.type==Define.SKILL_TYPE_ROUND)return;return void(0==this.isSameSide(t.position,n)&&this.doAttack(t,n))}}else if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BLOCK_TALK))){if(e.type==Define.SKILL_TYPE_ROUND)return;return void(0==this.isSameSide(t.position,n)&&this.doAttack(t,n))}}var i=this.getSelectArea(t.position,n,e.area);if(null!=i){this.atkType=t.getAttackTypeBySkill(e);var o=null;(3==t.getType()||4==t.getType())&&(o=e.name);var a=Control.createBattleUseSkillControl(t.position,n,e.area,e.position,e.anime1,e.anime2,e.anime3,o);this.addAniControl(a);var r=[];e.useMP>0&&Define.processBattleHpMpPowerBySelf(t,ModelConst.MP,-e.useMP,0,r,!0),e.useHP>0&&Define.processBattleHpMpPowerBySelf(t,ModelConst.HP,-e.useHP,0,r,!0),this.setSkillGuardData(e,t.position,i),e.type==Define.SKILL_TYPE_ACTIVE&&(e.power1==Define.POWER_SKILL_REMOVE_STATUS&&t.removeBufferByStatus(e.powerValue1),e.power2==Define.POWER_SKILL_REMOVE_STATUS&&t.removeBufferByStatus(e.powerValue2),e.power3==Define.POWER_SKILL_REMOVE_STATUS&&t.removeBufferByStatus(e.powerValue3));for(var s=!1,l=[],_=0;_<i.length;_++){var h=i[_];if(0!=this.isValidPos(h))if(null!=(T=this.getPlayerByPos(h))&&!T.isBattleStatus(Player.BSTATUS_ESCAPE)){if(T.isDead()){if(T.isDeadDelay())continue;if(0==e.isRebornSkill())continue}l.push(T)}}var u=this.isExpendHp(e,this.atkType),c=l.length;for(_=0;c>_;_++){var T=l[_],p=this.getGrardPet(T,this.atkType,u);if(null!=p)T=p;else{var d=this.getGuardPos(T.position,this.atkType);null!=T&&T.keepout_atk_time>0&&u&&(d=-1),d>=0&&(p=this.getPlayerByPos(d),this.isValidBattlePlayer(p)&&(T=p))}null!=T&&T.setTabStatus(!1,Model.TAG_IS_KEEP_OUT),this.calDamage(t,T,e,r,c)&&(s=!0,this.processSkillPower(T,t,e,r),null!=T&&T.isTabStatus(Model.TAG_IS_KEEP_OUT)&&(T.doKeepAtkTime(this),T.setTabStatus(!1,Model.TAG_IS_KEEP_OUT)))}if(s){var E=e.getPowerValue(Define.POWER_SKILL_HP);0>E&&(E=0);var g=e.getPowerValue(Define.POWER_SKILL_HP_PERCENT);g>0&&(E+=g*t.get(ModelConst.HPMAX)/100),E>0&&Define.processBattleHpMpPower(t,ModelConst.HP,E,0,r),0>(E=e.getPowerValue(Define.POWER_SKILL_MP))&&(E=0),(g=e.getPowerValue(Define.POWER_SKILL_MP_PERCENT))>0&&(E+=g*t.get(ModelConst.MPMAX)/100),E>0&&Define.processBattleHpMpPower(t,ModelConst.MP,E,0,r)}var S=new Array(r.length);for(_=0;_<r.length;_++)S[_]=r[_];a.setSubControlList(S)}}},t.prototype.isExpendHp=function(t,e){if(null==t)return!0;if(e==Define.ATKTYPE_CURSE||e==Define.ATKTYPE_BLESS){var n=t.getPowerValue(Define.POWER_HP);return 0>n||0>(n=t.getPowerValue(Define.POWER_HP_PERCENT))}return!0},t.prototype.processSkillPower=function(t,e,n,i){null!=t&&null!=n&&(n.power1>0&&Define.processBattlePower(this,t,e,n,n.power1,n.powerValue1,n.statusBit1,n.round,n.anime3,i),n.power2>0&&Define.processBattlePower(this,t,e,n,n.power2,n.powerValue2,n.statusBit2,n.round,n.anime3,i),n.power3>0&&Define.processBattlePower(this,t,e,n,n.power3,n.powerValue3,n.statusBit3,n.round,n.anime3,i))},t.prototype.doUseItem=function(e,n,i){if(null!=e&&!e.isDeadNoWithDelay()&&!e.isBattleStatus(Player.BSTATUS_ESCAPE)){var o=e.bag;if(null!=o){var a=o.getBagItemBySlotPos(n);if(null!=a&&ItemData.isValidEquipRequire(e,a)==Define.OK&&0!=a.isCanUse(2)&&!e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN))){e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_CHAO))&&(i=MonsterAI.selectRandActivePlayer(this,e));var r=this.getSelectArea(e.position,i,a.area);if(null!=r){var s=null;3==e.getType()&&(s=a.name);var l=Control.createBattleUseSkillControl(e.position,i,a.area,Define.SKILL_POS_STAND,Define.ANIME_TYPE_USE_ITEM,Define.SPRITE_USE_ITEM,0,s);this.addAniControl(l);for(var _=[],h=0;h<r.length;h++){var u=r[h];if(!(0>u||u>=t.MAX_POS)){var c=this.getPlayerByPos(u);if(null!=c&&!c.isBattleStatus(Player.BSTATUS_ESCAPE)){if(c.isDead()){if(c.isDeadDelay())continue;if(0==a.isRebornItem())continue}c&&c.setTabStatus(!1,Model.TAG_IS_KEEP_OUT),this.processItemPower(c,a,_)}}}var T=new Array(_.length);for(h=0;h<_.length;h++)T[h]=_[h];l.setSubControlList(T),o.removeBagItemByPos(n,1)}}}}},t.prototype.processItemPower=function(t,e,n){if(null!=t&&null!=e){e.power1>0&&Define.processBattlePower(this,t,null,null,e.power1,e.powerValue1,0,e.round,0,n),e.power2>0&&Define.processBattlePower(this,t,null,null,e.power2,e.powerValue2,0,e.round,0,n)}},t.prototype.doEscape=function(e,n){if(null!=e&&!e.isDead()&&!e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN))){var i;(i=n?t.ESCAPE_SUCCESS:this.isEscapeSuccess(e))==t.ESCAPE_SUCCESS&&e.setBattleStatus(Player.BSTATUS_ESCAPE);var o=Control.createBattleEscape(e.position,i);this.addAniControl(o)}},t.prototype.isEscapeSuccess=function(e){if(null==e)return t.ESCAPE_FAILED;var n=-1,i=0,o=t.LEFT_MAX_POS;t.isLeftSide(e.position)&&(i=t.LEFT_MAX_POS,o=t.MAX_POS);for(var a=0,r=i;o>r;r++){var s=this.getPlayerByPos(r);null!=s&&((a=s.get(ModelConst.LEVEL))>n&&(n=a))}var l;return l=-7>=(a=e.get(ModelConst.LEVEL))-n?t.ESCAPE_RATE_LOW:a-n>=7?t.ESCAPE_RATE_HIGH:t.ESCAPE_RATE_MID,this.randInt(100)<l?t.ESCAPE_SUCCESS:t.ESCAPE_FAILED},t.prototype.doPetAI=function(t){if(this.isValidBattlePlayer(t)){var e=MonsterAI.selectValueTarget(this,t,Define.AI_HATE_MAX,!0);this.doAttack(t,e)}},t.prototype.doMonsterAI=function(t){if(this.isValidBattlePlayer(t)){var e=t.getSkillByAI(this,!1);if(t.getAITargetPos()==MonsterAI.TARGET_ESCAPE)return void this.doEscape(t,!0);var n=t.getAttackTarget(this);this.isValidPos(n)&&(null==e?this.doAttack(t,n):this.doUseSkill(t,e,n))}},t.prototype.sortModelListBySpeed=function(){var t=[];if(null==this.playerList)return t;for(var e=0;e<this.playerList.length;e++){var n=this.playerList[e];if(null!=n){for(var i=0;!(i>=t.length);){var o=t[i];if(n.get(ModelConst.SPEED)>o.get(ModelConst.SPEED)){t.splice(i,0,n);break}i++}i==t.length&&t.push(n)}}return t},t.prototype.getAutoSkillIDByRound=function(t){if(null==t)return-1;if(null==t.autoSkillID)return-2;var e=-1,n=t.getAutoSkillCount();if(0>=n)return-3;var i=this.round%n;return i>=0&&i<t.autoSkillID.length&&(e=t.autoSkillID[i]),e},t.prototype.doPlayerPlan=function(t,e){if(null==t)return!1;if(null==e)return!1;var n=0;switch(e.position=0,e.readByte()){case BattleConst.PLAN_ATTACK:n=e.readByte(),this.doAttack(t,n);break;case BattleConst.PLAN_USE_SKILL:n=e.readByte();var i=e.readShort();this.doUseSkillByID(t,i,n);break;case BattleConst.PLAN_USE_ITEM:n=e.readByte();var o=e.readByte();this.doUseItem(t,o,n);break;case BattleConst.PLAN_ESCAPE:this.doEscape(t,!1);break;case BattleConst.PLAN_NONE:return!1}return!0},t.prototype.isPetSucessGrard=function(t,e,n,i){if(null==t||null==e)return!1;var o=t.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_PET_GRARD_ALL_ATTACK),a=e.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_GRARD_MASTER_ALL_ATTACK),r=t.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,n);return r>o&&(o=r),o>0&&this.randInt(100)<o||((r=e.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,i))>a&&(a=r),a>0&&this.randInt(100)<a)},t.prototype.getGrardPet=function(t,e,n){if(null==t||3!=t.getType())return null;if(e==Define.ATKTYPE_BLESS)return null;if(0==this.isValidBattlePlayer(t))return null;if(null!=t&&t.keepout_atk_time>0&&n)return null;var i=this.getPlayerPet(t.position);if(null==i)return null;if(0==this.isValidBattlePlayer(i))return null;if(i.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN)))return null;if(i.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_CHAO)))return null;var o=!1;switch(e){case Define.ATKTYPE_STR:case Define.ATKTYPE_RANGE_STR:o=this.isPetSucessGrard(t,i,Define.POWER_PET_GRARD_STR_ATTACK,Define.POWER_GRARD_MASTER_STR_ATTACK);break;case Define.ATKTYPE_AGI:case Define.ATKTYPE_RANGE_AGI:o=this.isPetSucessGrard(t,i,Define.POWER_PET_GRARD_AGI_ATTACK,Define.POWER_GRARD_MASTER_AGI_ATTACK);break;case Define.ATKTYPE_MAGIC:o=this.isPetSucessGrard(t,i,Define.POWER_PET_GRARD_MAGIC_ATTACK,Define.POWER_GRARD_MASTER_MAGIC_ATTACK);break;case Define.ATKTYPE_CURSE:o=this.isPetSucessGrard(t,i,Define.POWER_PET_GRARD_CURSE_ATTACK,Define.POWER_GRARD_MASTER_CURSE_ATTACK)}return o?i:null},t.prototype.doAttack=function(t,e){if(null!=t&&!t.isDeadNoWithDelay()&&!t.isBattleStatus(Player.BSTATUS_ESCAPE)&&!t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN))&&(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_CHAO))&&(e=MonsterAI.selectRandActivePlayer(this,t)),this.isValidPos(e))){var n=this.getPlayerByPos(e);if(null!=n&&(!n.isDeadNoWithDelay()&&!n.isBattleStatus(Player.BSTATUS_ESCAPE)||(e=MonsterAI.selectRandTarget(this,t,!0),null!=(n=this.getPlayerByPos(e))))){this.atkType=t.getAttackTypeBySkill(null);var i=this.getGrardPet(n,this.atkType,!0);if(null!=i)n=i;else{var o=this.getGuardPos(n.position,this.atkType);null!=n&&n.keepout_atk_time>0&&(o=-1),o>=0&&(i=this.getPlayerByPos(o),this.isValidBattlePlayer(i)&&(n=i))}var a=t.getAttakAnimePos(),r=t.getAttackRangeAnime(),s=Control.createBattleUseSkillControl(t.position,e,-1,a,BattleConst.ANIME_TYPE_PHYSIC,r,0,null);this.addAniControl(s);var l=[];if(!n.isBattleStatus(Player.BSTATUS_ESCAPE)&&!n.isDeadNoWithDelay()){null!=n&&n.setTabStatus(!1,Model.TAG_IS_KEEP_OUT),this.calDamage(t,n,null,l,1),null!=n&&n.isTabStatus(Model.TAG_IS_KEEP_OUT)&&(n.doKeepAtkTime(this),n.setTabStatus(!1,Model.TAG_IS_KEEP_OUT));for(var _=new Array(l.length),h=0;h<l.length;h++)_[h]=l[h];s.setSubControlList(_)}}}},t.prototype.calInsight=function(t,e,n,i){if(this.atkType!=Define.ATKTYPE_MAGIC&&this.atkType!=Define.ATKTYPE_CURSE)return!1;var o=0;if(null!=n&&n.useMP>0&&(o=n.useMP),e.get(ModelConst.MP)<o)return!1;var a=this.calc(BattleConst.BATTLE_INSIGHT,e,t,n);if(0>=a)return!1;var r=a>this.randInt(100);if(r){e.addValue(ModelConst.MP,-o);var s=new DamageData;this.dealDamageEffect(s,t,e,n,i,i)}return r},t.prototype.calDamage=function(e,n,i,o,a){if(null==e)return!1;if(null==n)return!1;if(null!=i&&Define.getSkillAreaPlayerNum(i.area)!=Define.SKILL_AREA_CURSOR_1&&this.atkType!=Define.ATKTYPE_MAGIC&&this.atkType!=Define.ATKTYPE_CURSE&&n.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_HIDE)))return!1;if(this.atkType==Define.ATKTYPE_BLESS)return(T=new DamageData).damageEffect|=BattleConst.EFFECT_HIT,this.dealDamageEffect(T,e,n,i,o,o),!0;if(n.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_INVINCIBLE)))return!1;if(n.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_MAGIC))&&0==Define.isPhysicalAtkType(this.atkType))return!1;if(n.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_PHYSIC))&&1==Define.isPhysicalAtkType(this.atkType))return!1;if(this.calInsight(e,n,i,o))return!1;this.isLeftHand=!0,this.block=0,this.totalHitTime=e.get(ModelConst.ATK_TIME),i&&(this.totalHitTime+=i.atk_time),this.totalHitTime=Tool.sumValue(this.totalHitTime,0,Model.MIN_HIT_TIME,Model.MAX_HIT_TIME),1==Define.isPhysicalAtkType(this.atkType)&&(this.block=this.calc(BattleConst.BATTLE_BLOCK,n,e,i));var r=e.get(ModelConst.LEFT_ATK_TIME),s=e.get(ModelConst.RIGHT_ATK_TIME),l=r>0&&s>0;0>=r&&s>0&&(this.isLeftHand=!1);for(var _=!1,h=[],u=[],c=0;c<this.totalHitTime;c++){var T=this.calcDirectDamage(e,n,i,a);if(l&&(this.isLeftHand=!this.isLeftHand),null!=T&&DamageData.isEffectStatus(T.damageEffect,BattleConst.EFFECT_HIT)&&(_=!0),_&&(this.block-=BattleConst.BLOCK_HIT_REDUCE),this.dealDamageEffect(T,e,n,i,h,u),1==n.isDead()){this.checkDie1Hp(n,null);break}}var p=t.MAX_SHOW_HIT_2;null!=i&&Define.getSkillAreaPlayerNum(i.area)>Define.SKILL_AREA_CURSOR_2&&(p=t.MAX_SHOW_HIT),h.length>=p&&(h=this.mergeControlList(h,!1)),u=this.mergeControlList(u,!1);for(var d=0,E=h;d<E.length;d++){var g=E[d];o.push(g)}for(var S=0,m=u;S<m.length;S++){var f=m[S];o.push(f)}return _},t.prototype.calcDirectDamage=function(t,e,n,i){var o=new DamageData;if(null==t)return o;if(null==e)return o;var a=this.calc(BattleConst.BATTLE_HITRATE,t,e,n)>this.randInt(100),r=this.calc(BattleConst.BATTLE_DAMAGE,t,e,n),s=0;if(e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_WEAK))&&(s+=20),e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BLOOD))&&(s+=10),s>0&&(r+=r*s/100>>0),this.calc(BattleConst.BATTLE_CRI_RATE,t,e,n)>this.randInt(100)&&(r=15*r/10>>0,o.damageEffect|=BattleConst.EFFECT_CRITICAL),a&&this.block>0&&(this.randInt(100)<this.block&&(a=!1),o.damageEffect|=BattleConst.EFFECT_BLOCK),a){r>0&&e.keepout_atk_time>0&&(0==e.isTabStatus(Model.TAG_IS_KEEP_OUT)&&(o.damageEffect|=BattleConst.EFFECT_KEEPOUT),e.setTabStatus(!0,Model.TAG_IS_KEEP_OUT),r=0),o.damageBackValue=this.calBackValue(t,e,n,r);var l=r;l!=(r=this.calTouchDmg(e,t,n,r))&&(o.damageEffect|=BattleConst.EFFECT_TOUCH),(l=r)!=(r=this.calDefFieldDmg(e,r))&&(o.damageEffect|=BattleConst.EFFECT_DEF_FIELD,o.magicDefDamageValue=l-r)}return o.damageValue=r,a&&(o.damageEffect|=BattleConst.EFFECT_HIT,o.damageHpGet=this.calHPMPGetValue(t,n,r,!0,i),o.damageMpGet=this.calHPMPGetValue(t,n,r,!1,i)),o},t.prototype.isWilSuccess=function(e,n,i){var o=e.get(ModelConst.WIL);return null!=i&&(o-=i.getPowerValue(Define.POWER_SKILL_TARGET_WIL)),null!=n&&e!=n&&(o-=n.get(ModelConst.IGNORE_WIL)),!(0>=o)&&(o>t.MAX_RATE_WIL&&(o=t.MAX_RATE_WIL),o>this.randInt(1e3))},t.prototype.calTouchDmg=function(e,n,i,o){if(null==e)return o;var a=t.calTouch(e);if(null!=i&&(a-=i.getPowerValue(Define.POWER_SKILL_TARGET_TOUCH)),n&&e!=n&&(a-=n.get(ModelConst.IGNORE_TOUCH)),a>t.MAX_RATE_TOUCH&&(a=t.MAX_RATE_TOUCH),0>=a)return o;var r=o-(o*a/1e3>>0);return 0>r&&(r=0),r},t.calTouch=function(t){if(null==t)return 0;var e=t.get(ModelConst.TOUGH);return t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BLOOD))&&(e=e/2>>0),t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_WEAK))&&(e=e/2>>0),0>=e?0:e},t.prototype.calHPMPGetValue=function(e,n,i,o,a){if(null==e)return 0;if(e.isDead())return 0;0>=a&&(a=1);var r=0;if(o){if(e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_BURN)))return 0;r=e.get(ModelConst.LIFE_ABSORPTION),null!=n&&(r+=n.getPowerValue(Define.POWER_SKILL_LIFE_ABSORPTION))}else{if(e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_POISON)))return 0;r=e.get(ModelConst.MANA_ABSORPTION),null!=n&&(r+=n.getPowerValue(Define.POWER_SKILL_MANA_ABSORPTION))}return 0>=(r=r/a>>0)?0:(r>t.MAX_RATE_HPMP_GET&&(r=t.MAX_RATE_HPMP_GET),i*r/1e3>>0)},t.prototype.calBackValue=function(t,e,n,i){var o=0;if(e.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_STUN)))return 0;if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_INVINCIBLE)))return 0;if(this.atkType==Define.ATKTYPE_MAGIC){if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_MAGIC)))return 0;o=this.calc(BattleConst.BATTLE_MAGIC_BACK,e,t,n)}else if(Define.isPhysicalAtkType(this.atkType)){if(t.isBattleStatus(Define.getBufferBitValue(Define.BUFFER_RESIST_PHYSIC)))return 0;o=this.calc(BattleConst.BATTLE_BACK,e,t,n)}if(0>=o)return 0;if(0==o>this.randInt(100))return 0;var a=i*o/100>>0;return this.atkType==Define.ATKTYPE_MAGIC||Define.isPhysicalAtkType(this.atkType),a},t.prototype.calDefFieldDmg=function(t,e){if(null==t||0==e)return e;var n=t.get(ModelConst.DEF_FIELD);if(0>=n)return e;var i=t.get(ModelConst.MP);if(0>=i)return e;i>n&&(i=n);var o=Math.min(e,i);return t.addValue(ModelConst.MP,-o),t.addValue(ModelConst.DEF_FIELD,-o),e-o},t.prototype.calc=function(t,e,n,i){var o=0;switch(null==i&&(i=Skill.DUMMY_SKILL),t){case BattleConst.BATTLE_DAMAGE:return this.calcWithType(BattleConst.BATTLE_DAMAGE,e.getAttackTypeBySkill(i),e,n,i);case BattleConst.BATTLE_HITRATE:return this.calcWithType(BattleConst.BATTLE_HITRATE,e.getAttackTypeBySkill(i),e,n,i);case BattleConst.BATTLE_STR_HITRATE:var a=e.get(ModelConst.HIT_RATE)+i.getPowerValue(Define.POWER_SKILL_HITRATE)-n.get(ModelConst.DODGE)>>0;return(r=e.get(ModelConst.FORCE_HIT))>Model.MAX_FORCE_RATE&&(r=Model.MAX_FORCE_RATE),(r+=i.getPowerValue(Define.POWER_SKILL_HIT_FORCE))>a&&(a=r),a;case BattleConst.BATTLE_AGI_HITRATE:var r;return o=e.get(ModelConst.HIT_RATE)+i.getPowerValue(Define.POWER_SKILL_HITRATE)-n.get(ModelConst.DODGE)>>0,(r=e.get(ModelConst.FORCE_HIT))>Model.MAX_FORCE_RATE&&(r=Model.MAX_FORCE_RATE),(r+=i.getPowerValue(Define.POWER_SKILL_HIT_FORCE))>o&&(o=r),o;case BattleConst.BATTLE_MAGIC_HITRATE:return o=e.get(ModelConst.HIT_MAGIC),o+=i.getPowerValue(Define.POWER_SKILL_HITRATE),0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),10*o/A>>0;case BattleConst.BATTLE_DMG_STR:var s=this.calc(BattleConst.BATTLE_RD_STR,n,e,i),l=this.calc(BattleConst.BATTLE_AP_STR,e,n,i),_=this.randRange(BattleConst.BATTLE_DMG_MIN,BattleConst.BATTLE_DMG_MAX),h=(100-s)*l*_;return l>0&&_>0&&100-s>0&&0>h&&(h=Tool.MAX_VALUE_int),0>=(o=h/1e4>>0)&&(o=1),o;case BattleConst.BATTLE_AP_STR:var u=this.calc(BattleConst.BATTLE_RAND_ATC,e,n,i);return(e.get(ModelConst.ATK_STR)/this.totalHitTime>>0)+u+i.getPowerValue(Define.POWER_SKILL_DAMAGE)/this.totalHitTime>>0;case BattleConst.BATTLE_RD_STR:return o=80*(e.get(ModelConst.DEF_STR)-n.get(ModelConst.BRK_ARMOR)-i.getPowerValue(Define.POWER_SKILL_BRK_ARMOR))/100>>0,0>=(A=this.getLevelIncludeLevel2(n)+12)&&(A=1),(o=o/A>>0)>BattleConst.BATTLE_RD_MAX?o=BattleConst.BATTLE_RD_MAX:0>o&&(o=0),o;case BattleConst.BATTLE_DMG_AGI:var c=this.calc(BattleConst.BATTLE_RD_AGI,n,e,i),T=this.calc(BattleConst.BATTLE_AP_AGI,e,n,i),p=this.randRange(BattleConst.BATTLE_DMG_MIN,BattleConst.BATTLE_DMG_MAX),d=(100-c)*T*p;return 100-c>0&&T>0&&p>0&&0>d&&(d=Tool.MAX_VALUE_int),0>=(o=d/1e4>>0)&&(o=1),o;case BattleConst.BATTLE_AP_AGI:u=this.calc(BattleConst.BATTLE_RAND_ATC,e,n,i);return(e.get(ModelConst.ATK_AGI)/this.totalHitTime>>0)+u+(i.getPowerValue(Define.POWER_SKILL_DAMAGE)/this.totalHitTime>>0);case BattleConst.BATTLE_RD_AGI:return o=80*(e.get(ModelConst.DEF_AGI)-n.get(ModelConst.BRK_ARMOR)-i.getPowerValue(Define.POWER_SKILL_BRK_ARMOR))/100>>0,0>=(A=this.getLevelIncludeLevel2(n)+12)&&(A=1),(o=o/A>>0)>BattleConst.BATTLE_RD_MAX?o=BattleConst.BATTLE_RD_MAX:0>o&&(o=0),o;case BattleConst.BATTLE_DMG_MAGIC:var E=this.calc(BattleConst.BATTLE_RD_MAGIC,n,e,i),g=this.calc(BattleConst.BATTLE_AP_MAGIC,e,n,i),S=this.randRange(BattleConst.BATTLE_DMG_MIN,BattleConst.BATTLE_DMG_MAX),m=(100-E)*g*S&4294967295;return 100-E>0&&g>0&&S>0&&0>m&&(m=Tool.MAX_VALUE_int),0>=(o=m/1e4>>0)&&(o=1),o;case BattleConst.BATTLE_AP_MAGIC:u=this.calc(BattleConst.BATTLE_RAND_ATC,e,n,i);if(e.bag){var f=e.getEquipWeaponType();f!=Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF&&f!=Define.ITEM_TYPE_WEAPON_BALL&&(u=0)}return(e.get(ModelConst.ATK_MAGIC)/this.totalHitTime>>0)+u+(i.getPowerValue(Define.POWER_SKILL_DAMAGE)/this.totalHitTime>>0);case BattleConst.BATTLE_RD_MAGIC:return o=80*(e.get(ModelConst.DEF_MAGIC)-n.get(ModelConst.MAGIC_PENETRATION)-i.getPowerValue(Define.POWER_SKILL_MAGIC_PENETRATION))/100,0>=(A=this.getLevelIncludeLevel2(n)+12)&&(A=1),(o=o/A>>0)>BattleConst.BATTLE_RD_MAX?o=BattleConst.BATTLE_RD_MAX:0>o&&(o=0),o;case BattleConst.BATTLE_CRI_RATE:var I=e.get(ModelConst.CRITICAL)+i.getPowerValue(Define.POWER_SELF_CRITICAL);return 0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),15*I/A>>0;case BattleConst.BATTLE_RAND_ATC:return this.randRange(e.get(ModelConst.ATK_MIN),e.get(ModelConst.ATK_MAX));case BattleConst.BATTLE_BLOCK:return o=e.get(ModelConst.BLOCK),o-=i.getPowerValue(Define.POWER_SKILL_TARGET_BLOCK),o-=n.get(ModelConst.IGNORE_BLOCK),0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),0>(o=7*o/A>>0)&&(o=0),o>BattleConst.MAX_BLOCK_TOUCH&&(o=BattleConst.MAX_BLOCK_TOUCH),o;case BattleConst.BATTLE_INSIGHT:return o=e.get(ModelConst.INSIGHT),o-=i.getPowerValue(Define.POWER_SKILL_TARGET_INSIGHT),o-=n.get(ModelConst.IGNORE_INSIGHT),0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),0>(o=7*o/A>>0)&&(o=0),o>BattleConst.MAX_INSIGHT_TOUCH&&(o=BattleConst.MAX_INSIGHT_TOUCH),o;case BattleConst.BATTLE_BACK:return o=e.get(ModelConst.BACK),o-=i.getPowerValue(Define.POWER_SKILL_TARGET_BACK),o-=n.get(ModelConst.IGNORE_BACK),0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),0>(o=7*o/A>>0)&&(o=0),o>e.get(ModelConst.BACK_MAX)&&(o=e.get(ModelConst.BACK_MAX)),o;case BattleConst.BATTLE_MAGIC_BACK:var A;return o=e.get(ModelConst.MAGIC_BACK),o-=i.getPowerValue(Define.POWER_SKILL_TARGET_MAGIC_BACK),o-=n.get(ModelConst.IGNORE_MAGIC_BACK),0>=(A=this.getLevelIncludeLevel2(n))&&(A=1),0>(o=7*o/A>>0)&&(o=0),o>e.get(ModelConst.BACK_MAX)&&(o=e.get(ModelConst.BACK_MAX)),o}return 0},t.prototype.calcWithType=function(t,e,n,i,o){switch(t){case BattleConst.BATTLE_DAMAGE:switch(e){case Define.ATKTYPE_STR:case Define.ATKTYPE_RANGE_STR:return this.calc(BattleConst.BATTLE_DMG_STR,n,i,o);case Define.ATKTYPE_AGI:case Define.ATKTYPE_RANGE_AGI:return this.calc(BattleConst.BATTLE_DMG_AGI,n,i,o);case Define.ATKTYPE_MAGIC:return this.calc(BattleConst.BATTLE_DMG_MAGIC,n,i,o);case Define.ATKTYPE_CURSE:default:return 0}case BattleConst.BATTLE_HITRATE:switch(e){case Define.ATKTYPE_STR:case Define.ATKTYPE_RANGE_STR:return this.calc(BattleConst.BATTLE_STR_HITRATE,n,i,o);case Define.ATKTYPE_AGI:case Define.ATKTYPE_RANGE_AGI:return this.calc(BattleConst.BATTLE_AGI_HITRATE,n,i,o);case Define.ATKTYPE_MAGIC:case Define.ATKTYPE_CURSE:return this.calc(BattleConst.BATTLE_MAGIC_HITRATE,n,i,o);case Define.ATKTYPE_BLESS:return 100;default:return 0}}return 0},t.prototype.dealDamageEffect=function(t,e,n,i,o,a){var r=DamageData.isEffectStatus(t.damageEffect,BattleConst.EFFECT_HIT),s=-t.damageValue;r&&(n.addValue(ModelConst.HP,s),e.addValue(ModelConst.ARGO,-s)),n.isDeadNoWithDelay()&&(t.damageEffect|=BattleConst.EFFECT_DIE);var l=Control.createBattleTargetEffect(!1,n.position,s,t.damageEffect,0,t.magicDefDamageValue);if(o.push(l),r){var _=t.damageHpGet;_>0&&(e.addValue(ModelConst.HP,_),l=Control.createBattleTargetEffectOther(e.position,_,BattleConst.EFFECT_HIT,0),a.push(l));var h=t.damageMpGet;h>0&&(e.addValue(ModelConst.MP,h),l=Control.createBattleTargetEffectOther(e.position,h,BattleConst.EFFECT_HIT|BattleConst.EFFECT_MP_CHANGE,0),a.push(l));var u=-t.damageBackValue;if(0!=u){e.addValue(ModelConst.HP,u),n.addValue(ModelConst.ARGO,-u);var c=BattleConst.EFFECT_HIT;e.isDeadNoWithDelay()&&(c|=BattleConst.EFFECT_DIE,this.checkDie1Hp(e,null)),l=Control.createBattleTargetEffectOther(e.position,u,c,0),a.push(l)}}},t.prototype.randInt=function(t){if(null==this.random)return 0;var e=this.random.nextInt();return Math.abs(e)%t},t.prototype.randRange=function(t,e){return t==e?t:t+this.randInt(e-t+1)},t.prototype.isSameSide=function(e,n){return t.getPositionSide(e)==t.getPositionSide(n)},t.prototype.isValidPosByCursor=function(e,n){var i=0,o=2*this.rowLeft;return 0==t.isLeftSide(e)&&(i=t.LEFT_MAX_POS,o=t.MAX_POS),!(i>n||n>=o)},t.prototype.isValidPos=function(e){return!(0>e||e>=t.MAX_POS)},t.prototype.getLevelIncludeLevel2=function(t){return t.get(ModelConst.LEVEL)+t.get(ModelConst.LEVEL2)},t.prototype.getSelectArea=function(e,n,i){switch(Define.getSearchTypeByArea(i)){case Define.SKILL_AREA_SEARCH_ALL:break;case Define.SKILL_AREA_SEARCH_ENEMY:if(1==this.isSameSide(e,n))return null;break;case Define.SKILL_AREA_SEARCH_FRIEND:if(0==this.isSameSide(e,n))return null;break;case Define.SKILL_AREA_SEARCH_MY_SELF:return e!=n?null:[n];case Define.SKILL_AREA_SEARCH_MY_OWNER:return[n]}var o=null,a=[];switch(i){case Define.SKILL_AREA_SINGLE:case Define.SKILL_AREA_ENEMY_SINGLE:case Define.SKILL_AREA_ME_SIGHLE:a=this.getColumnTypeTarget(n,1,!1);break;case Define.SKILL_AREA_PLAYER_AND_PET:case Define.SKILL_AREA_FRONT_BACK_TWO:case Define.SKILL_AREA_ENEMY_FONT_BACK_TWO:case Define.SKILL_AREA_ME_FONT_BACK_TWO:a=this.getRowTypeTarget(n,1);break;case Define.SKILL_AREA_UP_DOWN_TWO:case Define.SKILL_AREA_ENEMY_UP_DOWN_TWO:case Define.SKILL_AREA_ME_UP_DOWN_TWO:a=this.getColumnTypeTarget(n,2,!1);break;case Define.SKILL_AREA_UP_DOWN_THREE:case Define.SKILL_AREA_ENEMY_UP_DOWN_THREE:case Define.SKILL_AREA_ME_UP_DOWN_THREE:a=this.getColumnTypeTarget(n,3,!1);break;case Define.SKILL_AREA_UP_DOWN_FOUR:case Define.SKILL_AREA_ENEMY_UP_DOWN_FOUR:case Define.SKILL_AREA_ME_UP_DOWN_FOUR:a=this.getColumnTypeTarget(n,4,!1);break;case Define.SKILL_AREA_UP_DOWN_FIVE:case Define.SKILL_AREA_ENEMY_UP_DOWN_FIVE:case Define.SKILL_AREA_ME_UP_DOWN_FIVE:a=this.getColumnTypeTarget(n,5,!1);break;case Define.SKILL_AREA_TEN:case Define.SKILL_AREA_ENEMY_TEN:case Define.SKILL_AREA_ME_TEN:a=this.getColumnTypeTarget(n,3,!0);break;case Define.SKILL_AREA_SQUARE:case Define.SKILL_AREA_ENEMY_SQUARE:case Define.SKILL_AREA_ME_SQUARE:a=this.getRowTypeTarget(n,2);break;case Define.SKILL_AREA_AROUND_SIX:case Define.SKILL_AREA_ENEMY_AROUND_SIX:case Define.SKILL_AREA_ME_AROUND_SIX:a=this.getRowTypeTarget(n,3);break;case Define.SKILL_AREA_ALL:case Define.SKILL_AREA_ENEMY_ALL:case Define.SKILL_AREA_ME_ALL:case Define.SKILL_AREA_ME_ALL_NO_SELF:case Define.SKILL_AREA_ALL_NO_SELF:var r=t.getPositionSide(n);(i==Define.SKILL_AREA_ALL||i==Define.SKILL_AREA_ALL_NO_SELF)&&(r=-1),o=this.getAllTypeTarget(r,e,i);break;case Define.SKILL_AREA_ENEMY_HP_LEAST:case Define.SKILL_AREA_ENEMY_HP_MOST:case Define.SKILL_AREA_ME_HP_LEAST:case Define.SKILL_AREA_ME_HP_MOST:return[n]}if(null!=a&&a.length>0&&(o=t.getTarget(a),i==Define.SKILL_AREA_PLAYER_AND_PET)){var s=!1;if(null!=o&&o.length>0)for(var l=0;l<o.length;l++)o[l]==e&&(s=!0);if(0==s)return null}if(null!=o)for(l=0;l<o.length;l++){o[l];for(var _=l+1;_<o.length;_++)o[_]}return o},t.prototype.getColumnTypeTarget=function(e,n,i){for(var o=[],a=0;n>a;a++){var r=0;if(a%2==0){if(1==i&&0==a){t.getLeftRightTypeTarget(o,e);continue}r=e-2*Math.floor(a/2)}else r=e+2*(Math.floor(a/2)+1);0!=this.isValidPosByCursor(e,r)&&o.push(r)}return o},t.prototype.getRowTypeTarget=function(e,n){for(var i=[],o=0;n>o;o++){var a;a=o%2==0?e-2*Math.floor(o/2):e+2*(Math.floor(o/2)+1),0!=this.isValidPosByCursor(e,a)&&t.getLeftRightTypeTarget(i,a)}return i},t.getLeftRightTypeTarget=function(t,e){t.push(e);var n=e%2==0?e+1:e-1;t.push(n)},t.prototype.getAllTypeTarget=function(e,n,i){var o=0,a=t.MAX_POS;e==t.LEFT_SIDE?a=(o=0)+this.getLeftPosNum():e==t.RIGHT_SIDE&&(a=(o=t.LEFT_MAX_POS)+this.getRightPosNum());var r=a-o;if(0>=r)return null;var s=new Array(r),l=!0;n>=0&&(i==Define.SKILL_AREA_ME_ALL_NO_SELF||i==Define.SKILL_AREA_ALL_NO_SELF)&&(l=!1);for(var _=0,h=o;a>h;h++)(0!=l||h!=n)&&(s[_++]=h);if(_>r)return null;var u=new Array(_);return Tool.arraycopy(s,0,u,0,_),u},t.getTarget=function(t){if(null==t)return null;if(t.length<=0)return null;for(var e=new Array(t.length),n=0;n<t.length;n++){var i=t[n];null!=i&&(e[n]=i)}return e},t.prototype.countNotNullPlayerPos=function(t){if(null==t||t.length<=0)return 0;for(var e=0,n=0;n<t.length;n++){var i=this.getPlayerByPos(t[n]);0!=this.isValidBattlePlayer(i)&&e++}return e},t.prototype.getPlayerPet=function(e){var n=this.getPlayerByPos(e);if(null==n||3!=n.getType())return null;var i=e-1;t.isLeftSide(e)&&(i=e+1);var o=this.getPlayerByPos(i);return null==o||4!=o.getType()?null:o},t.prototype.getPetOwnerPos=function(t){if(null==t)return-1;if(t instanceof MyPet){var e=t;if(null!=e.owner)return e.owner.position}return t.position},t.prototype.searchAICursor=function(t,e){return this.searchAICursorByRandom(t,e,!1)},t.prototype.searchAICursorByRandom=function(e,n,i){if(null==e)return 0;switch(n){case Define.SKILL_AREA_ENEMY_HP_LEAST:return MonsterAI.selectValueTarget(this,e,Define.AI_HP_MIN_ENEMY,!0);case Define.SKILL_AREA_ENEMY_HP_MOST:return MonsterAI.selectValueTarget(this,e,Define.AI_HP_MAX_ENEMY,!0);case Define.SKILL_AREA_ME_HP_LEAST:return MonsterAI.selectValueTarget(this,e,Define.AI_HP_MIN_FRIEND,!1);case Define.SKILL_AREA_ME_HP_MOST:return MonsterAI.selectValueTarget(this,e,Define.AI_HP_MAX_FRIEND,!1);case Define.SKILL_AREA_PLAYER_AND_PET:return e.position}var o=0,a=t.MAX_POS;switch(Define.getSearchTypeByArea(n)){case Define.SKILL_AREA_SEARCH_ALL:if(n!=Define.SKILL_AREA_SINGLE)break;case Define.SKILL_AREA_SEARCH_ENEMY:t.isLeftSide(e.position)?(o=t.LEFT_MAX_POS,a=t.MAX_POS):(o=0,a=t.LEFT_MAX_POS);break;case Define.SKILL_AREA_SEARCH_FRIEND:t.isLeftSide(e.position)?(o=0,a=t.LEFT_MAX_POS):(o=t.LEFT_MAX_POS,a=t.MAX_POS);break;case Define.SKILL_AREA_SEARCH_MY_SELF:return e.position;case Define.SKILL_AREA_SEARCH_MY_OWNER:return this.getPetOwnerPos(e)}for(var r=o,s=0,l=Define.getSkillAreaPlayerNum(n),_={},h=o;a>h;h++)if(l!=Define.SKILL_AREA_CURSOR_ALL){var u=this.getSelectArea(e.position,h,n),c=this.countNotNullPlayerPos(u);if(i){if(c>0)null==(p=_[c])&&(p=[],_[c]=p),p.push(h),c>s&&(s=c)}else{if(c==Define.getSkillAreaPlayerNum(n))return h;c>s&&(s=c,r=h)}}else{if((n==Define.SKILL_AREA_ME_ALL_NO_SELF||n==Define.SKILL_AREA_ALL_NO_SELF)&&h==e.position)continue;var T=this.getPlayerByPos(h);if(1==this.isValidBattlePlayer(T))return h}if(i){var p,d=0;for(var E in _)d+=1;if(d>0)if((p=_[s])&&p.length>0)return p[Tool.randByRange(p.length)]}return r},t.prototype.setWaitStatus=function(t){this.waitStatus|=1<<t},t.prototype.clearWaitStatus=function(t){this.waitStatus&=~(1<<t)},t.prototype.isWaitStatus=function(t){return 0!=(this.waitStatus&1<<t)},t.BATTLE_STATUS_NOTSTART=1,t.BATTLE_STATUS_NOTREADY=2,t.BATTLE_STATUS_READY=3,t.BATTLE_STATUS_FINISH=4,t.LOCAL_BATTLE_MY_POS=25,t.LOCAL=0,t.REMOTE=2,t.PK=4,t.ESCAPE_SUCCESS=1,t.ESCAPE_FAILED=0,t.LEFT_MAX_POS=20,t.RIGHT_MAX_POS=14,t.MAX_POS=t.LEFT_MAX_POS+t.RIGHT_MAX_POS,t.MAX_ROUND=30,t.NUM_COLUMN_1=t.LEFT_MAX_POS/2,t.NUM_COLUMN_2=t.NUM_COLUMN_1,t.NUM_COLUMN_3=t.RIGHT_MAX_POS/2,t.NUM_COLUMN_4=t.NUM_COLUMN_3,t.LEFT_SIDE=1,t.RIGHT_SIDE=2,t.MAX_ROW_NUM=10,t.FIRST_ROUND_PLAN_TIME=6e4,t.NORMAL_ROUND_PLAN_TIME=4e4,t.POSITION_COLUMN_1=1,t.POSITION_COLUMN_2=2,t.POSITION_COLUMN_3=3,t.POSITION_COLUMN_4=4,t.ESCAPE_RATE_HIGH=95,t.ESCAPE_RATE_MID=75,t.ESCAPE_RATE_LOW=40,t.MAX_SHOW_HIT=5,t.MAX_SHOW_HIT_2=10,t.MAX_RATE_WIL=700,t.MAX_RATE_TOUCH=700,t.MAX_RATE_HPMP_GET=1e3,t.MAX_BLOCK_TOUCH=70,t.BLOCK_HIT_REDUCE=10,t.MAX_INSIGHT_TOUCH=100,t}();__reflect(Battle.prototype,"Battle");var DamageData=function(){function t(){this.damageValue=0,this.damageEffect=0,this.damageBackValue=0,this.damageHpGet=0,this.damageMpGet=0,this.magicDefDamageValue=0}return t.isEffectStatus=function(t,e){return 0!=(t&e)},t}();__reflect(DamageData.prototype,"DamageData");var BattleConst,BattleBar=function(t){function e(){var e=t.call(this)||this;return e.color=16765737,e.totalWidth=AnimationControl.BAR_WIDTH,e.totalHeight=AnimationControl.BAR_HEIGHT,e.barWidth=e.totalWidth-4,e.barHeight=e.totalHeight-4,e.name="battleBar",e.scaleX=nato.mapRatio,e.scaleY=nato.mapRatio,e.base=new egret.Shape,e.base.name="base",e.base.graphics.beginFill(15917285),e.base.graphics.drawRect(0,0,e.totalWidth,e.totalHeight),e.addChild(e.base),e.bg=new egret.Shape,e.bg.name="bg",e.bg.graphics.beginFill(4063534),e.bg.graphics.drawRect(1,1,e.totalWidth-2,e.totalHeight-2),e.bg.graphics.endFill(),e.addChild(e.bg),e.mid=new egret.Shape,e.mid.name="mid",e.mid.graphics.beginFill(9519695),e.mid.graphics.drawRect(2,2,e.barWidth,e.barHeight),e.mid.graphics.endFill(),e.addChild(e.mid),e.bar=new egret.Shape,e.bar.name="bar",e.bar.graphics.beginFill(e.color),e.bar.graphics.drawRect(2,2,0,e.barHeight),e.bar.graphics.endFill(),e.addChild(e.bar),e}return __extends(e,t),e.prototype.setColor=function(t){this.color=t},e.prototype.updatePercent=function(t,e){var n=this.barWidth*t/e;t>0&&0==n&&(n=1),this.bar.graphics.clear(),this.bar.graphics.beginFill(this.color),this.bar.graphics.drawRect(2,2,n,this.barHeight),this.bar.graphics.endFill()},e}(egret.DisplayObjectContainer);__reflect(BattleBar.prototype,"BattleBar"),function(t){t.PLAN_NONE=0,t.PLAN_ATTACK=1,t.PLAN_USE_SKILL=2,t.PLAN_USE_ITEM=3,t.PLAN_ESCAPE=4,t.TAG_ALL_END=1,t.TAG_PLAYER_PLAN_END=2,t.TAG_MAP_INIT=4,t.TAG_REMOTE_SEND=8,t.TAG_HAVE_MY_PET=16,t.TAG_PET_ORDER=32,t.TAG_REMOTE_SEND_WAITING=64,t.TAG_IS_ORDER_POP=128,t.TAG_IS_WORKER_START=256,t.TAG_IS_GUIDE_ATTACK_MENU=512,t.TAG_IS_GUIDE_ATTACK_TARGET=1024,t.TAG_IS_BATTLE_SEE=2048,t.TAG_IS_AUTO_FIGHT=4096,t.TAG_WAITING_NEXT_BATTLE=8192,t.TAG_IS_GUIDE_ATTACK_AUTO=16384,t.TAG_IS_GUIDE_OPEN_SKILL=32768,t.TAG_IS_GUIDE_SELECT_SKILL=65536,t.TAG_IS_GUIDE_USE_SKILL=1<<17,t.TAG_IS_GUIDE_PET_AUTO=1<<18,t.TAG_IS_SKIP_BATTLE=1<<19,t.TAG_IS_GUIDE_SKIP_ROUND=1<<20,t.TAG_IS_GUIDE_SKIP_BATTLE=1<<21,t.ANIME_TYPE_PHYSIC=0,t.ANIME_TYPE_MAGIC=1,t.ANIME_TYPE_USE_ITEM=2,t.ANIME_TYPE_BACKUP=3,t.SKILL_POS_STAND=0,t.SKILL_POS_FRONT=1,t.SKILL_POS_CENTER=2,t.EFFECT_BLOCK=1,t.EFFECT_HIT=2,t.EFFECT_CRITICAL=4,t.EFFECT_DIE=8,t.EFFECT_REBORN=16,t.EFFECT_STUN=32,t.EFFECT_MP_CHANGE=64,t.EFFECT_DEF_FIELD=128,t.EFFECT_TOUCH=256,t.EFFECT_DIE_DELAY=512,t.EFFECT_HAS_ANIME=1024,t.EFFECT_BYTE_VALUE=2048,t.EFFECT_SHORT_VALUE=4096,t.EFFECT_INT_VALUE=8192,t.EFFECT_KEEPOUT=16384,t.isEffectStatus=function(t,e){return 0!=(t&e)},t.BATTLE_DMG_MIN=95,t.BATTLE_DMG_MAX=105,t.BATTLE_RD_MAX=75,t.BATTLE_STR_HITRATE=1,t.BATTLE_AGI_HITRATE=2,t.BATTLE_MAGIC_HITRATE=3,t.BATTLE_DMG_STR=5,t.BATTLE_DMG_AGI=6,t.BATTLE_DMG_MAGIC=7,t.BATTLE_RD_STR=8,t.BATTLE_RD_AGI=9,t.BATTLE_RD_MAGIC=10,t.BATTLE_AP_STR=11,t.BATTLE_AP_AGI=12,t.BATTLE_AP_MAGIC=13,t.BATTLE_CRI_RATE=14,t.BATTLE_RAND_ATC=20,t.BATTLE_BLOCK=21,t.BATTLE_INSIGHT=22,t.BATTLE_BACK=23,t.BATTLE_MAGIC_BACK=24,t.BATTLE_DAMAGE=30,t.BATTLE_HITRATE=31,t.MAX_RATE_WIL=700,t.MAX_RATE_TOUCH=700,t.MAX_RATE_HPMP_GET=1e3,t.MAX_BLOCK_TOUCH=70,t.BLOCK_HIT_REDUCE=10,t.MAX_INSIGHT_TOUCH=100}(BattleConst||(BattleConst={}));var BattleTester,BattleInputHandler=function(){function t(){this.hlightSpriteCopies=[],this.cursor=0,this.isEnable=!0,this.planVector=[],this.orderIndex=t.ORDER_NONE,this.petOrderIndex=t.ORDER_NONE,this._isOrderInit=!1,this.nameTextPool=[],this.nameTextCurrentlyUsed=[],this.battleBarPool=[],this.battleBarCurrentlyUsed=[],this.buffPool=[],this.buffCurrentlyUsed=[],this.battle=xworld.battle,this.battleView=BattleView.instance,this.cursorSprite=SpriteHelper.createBattleEffSprite(GameSprite.SPRITE_CURSOR),this.hlightSprite=SpriteHelper.createBattleEffSprite(GameSprite.SPRITE_HLIGHT),this.cursorSprite.setScale(nato.mapRatio),this.hlightSprite.setScale(nato.mapRatio),this.orderPlayer=xself}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.clean=function(){t._instance=null},t.prototype.setCursor=function(t){this.cursor=t},t.prototype.getCursor=function(){return this.cursor},t.prototype.isCursorEnable=function(){return this.isEnable},t.prototype.setCursorEnable=function(t){this.isEnable=t,null!=this.cursorSprite&&(t?this.cursorSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_CURSOR,-1):this.gotoBattleMenu())},t.prototype.setBattle=function(t){this.battle=t},t.prototype.setOrderPet=function(t){this.orderPet=t},t.prototype.setSelectSkill=function(t){this.isPetRound()?this.petSelectSkill=t:this.selectSkill=t},t.prototype.getSelectSkill=function(){return this.isPetRound()?this.petSelectSkill:this.selectSkill},t.prototype.setSelectItem=function(t){this.isPetRound()?this.petSelectItem=t:this.selectItem=t},t.prototype.getSelectItem=function(){return this.isPetRound()?this.petSelectItem:this.selectItem},t.prototype.getOrderPlayer=function(){return this.isPetRound()?this.orderPet:this.orderPlayer},t.prototype.getMyPlayer=function(){return this.orderPlayer},t.prototype.gotoBattleMenu=function(){if(this.cleanTargetSelect(),t.instance.hideInfoMsg(),!this.battleView.isTag(BattleConst.TAG_IS_BATTLE_SEE)){PanelManager.battleUI.showMenu();var e=this.isPetRound();PanelManager.battleUI.updateMenuShow(!e);var n=this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET),i=this.isPetAuto();PanelManager.battleUI.updatePetAutoStatus(n,i),GuideHandler.setGuideWidgetVisible(!1)}},t.prototype.addPlan=function(t,e){null!=e&&(this.battle.setPlan(t,e),this.planVector.push(e))},t.prototype.cleanPlanVector=function(){this.planVector=[]},t.prototype.isRemoteReady=function(){if(null==this.planVector)return!1;if(null==this.battleView||null==this.battle)return!1;if(null==this.orderPlayer)return!1;var t=this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET)?2:1;return!(this.planVector.length<t)},t.prototype.getPlanData=function(t){return Tool.isArrayIndexOutOfBounds(t,this.planVector)?null:this.planVector[t]},t.prototype.setOrderIndex=function(t){this.isPetRound()?this.petOrderIndex=t:this.orderIndex=t},t.prototype.getOrderIndex=function(){return this.isPetRound()?this.petOrderIndex:this.orderIndex},t.prototype.setOrderInit=function(t){this._isOrderInit=t},t.prototype.isOrderInit=function(){return this._isOrderInit},t.prototype.setPetRound=function(t){this.battleView.setTag(BattleConst.TAG_PET_ORDER,t),PanelManager.battleUI.showMenu();var e=!t;PanelManager.battleUI.updateMenuShow(e)},t.prototype.isPetRound=function(){return this.battleView.isTag(BattleConst.TAG_PET_ORDER)},t.prototype.isUseSkillInitiative=function(t){if(null==t)return!1;var e=t.getSkillByID(t.autoSkillID_Initiative);if(e&&Skill.isCanUse(t,e,null)){var n,i=this.getCursor();return n=this.battle.searchAICursorByRandom(t,e.area,!0),this.setCursor(n),this.addPlan(t.position,this.getBattlePlanData(BattleConst.PLAN_USE_SKILL,e.id)),this.setCursor(i),!0}return!1},t.prototype.hideInfoMsg=function(){for(;this.nameTextCurrentlyUsed.length;){var t=this.nameTextCurrentlyUsed.pop();this.battleView.contains(t)&&this.battleView.removeChild(t),this.nameTextPool.push(t)}for(;this.battleBarCurrentlyUsed.length;){var e=this.battleBarCurrentlyUsed.pop();this.battleView.contains(e)&&this.battleView.removeChild(e),this.battleBarPool.push(e)}for(;this.buffCurrentlyUsed.length;){var n=this.buffCurrentlyUsed.pop();this.battleView.contains(n)&&this.battleView.removeChild(n),this.buffPool.push(n)}},t.prototype.drawInfoMsg=function(t){for(var e=0;e<this.battle.playerList.length;e++){var n=this.battleView.getPosition(e,BattleView.COORD_X),i=this.battleView.getPosition(e,BattleView.COORD_Y);this.drawCurMsg(e,n,i,e==t,!0)}},t.prototype.drawCurMsg=function(t,e,n,i,o){var a=this.battle.getPlayerByPos(t);if(null!=a&&!a.isBattleStatus(Player.BSTATUS_ESCAPE)){var r=e-AnimationControl.BAR_WIDTH_HALF,s=n-AnimationControl.BAR_HEIGHT_HALF;if(a.hp>0){var l=a.get(ModelConst.HPMAX);if(this.drawBattleBar(r,s,16765737,a.hp,l),o)for(var _=24*(xhd?1:.5),h=21*(xhd?1:.5),u=r,c=s-2*(h+1),T=r,p=s-h-1,d=Define.BUFFER_POISON;d<=Define.BUFFER_DIE_CANNOT_RELIVE;d++)if(d!=Define.BUFFER_TYPE_BUFF&&d!=Define.BUFFER_TYPE_DEBUFF&&0!=a.isBattleStatus(Define.getBufferBitValue(d))){var E=BattleView.getBufferImageIndex(d);Define.getBufferType(d)==Define.BUFFER_TYPE_BUFF?(this.drawBuff(E,u,c),u+=_):(this.drawBuff(E,T,p),T+=_)}}i&&this.drawNameText(13757398,a.getName(),e,s+5)}},t.prototype.drawBattleBar=function(t,e,n,i,o){var a=this.getBattleBar();a.x=t,a.y=e,a.setColor(n),a.updatePercent(i,o),this.battleView.addChild(a),this.battleBarCurrentlyUsed.push(a)},t.prototype.drawNameText=function(t,e,n,i){var o=this.getNameText();o.textColor=t,o.text=e,o.x=n-o.textWidth/2,o.y=i+5,this.battleView.addChild(o),this.nameTextCurrentlyUsed.push(o)},t.prototype.drawBuff=function(t,e,n){var i=this.getBuffBitmap();i.texture=nato.findTextureForSheet(ImageSet.IMG_SET_BATTLE_BUFF,t),i.x=e,i.y=n,i.scaleX=xhd?1:.5,i.scaleY=xhd?1:.5,this.battleView.addChild(i),this.buffCurrentlyUsed.push(i)},t.prototype.getNameText=function(){if(this.nameTextPool.length>=1)return this.nameTextPool.pop();var t=new egret.TextField;return t.scaleX=nato.mapRatio,t.scaleY=nato.mapRatio,t.name="nameText",t.size=14,t},t.prototype.getBattleBar=function(){return this.battleBarPool.length>=1?this.battleBarPool.pop():new BattleBar},t.prototype.getBuffBitmap=function(){return this.buffPool.length>=1?this.buffPool.pop():new egret.Bitmap},t.prototype.updateCursor=function(){if(null!=this.targetSelectPanel){var e=this.getCursor(),n=this.battleView.getPosition(e,BattleView.COORD_X),i=this.battleView.getPosition(e,BattleView.COORD_Y);return this.battleView.contains(this.cursorSprite)||this.battleView.addChild(this.cursorSprite),this.cursorSprite.visible=!0,this.cursorSprite.setScale(nato.mapRatio),this.cursorSprite.x=n,this.cursorSprite.y=i-t.CURSOR_OFFSET_Y,this.hideInfoMsg(),this.getOrderIndex()==t.ORDER_INFO?void this.drawInfoMsg(e):void this.drawCurMsg(e,n,i,!0,!1)}},t.prototype.updateHLight=function(){if(null!=this.targetSelectPanel){var t=this.targetSelectPanel.getTargetPos();if(null!=t&&null!=this.hlightSprite){for(var e=0,n=this.hlightSpriteCopies.length;n>e;e++)this.hlightSpriteCopies[e].visible=!1;for(e=0,n=t.length;n>e;e++){null==this.hlightSpriteCopies[e]&&(this.hlightSpriteCopies[e]=GameSprite.cloneSprite(this.hlightSprite),this.hlightSpriteCopies[e].setScale(nato.mapRatio));var i=t[e],o=this.battleView.getPosition(i,BattleView.COORD_X),a=this.battleView.getPosition(i,BattleView.COORD_Y);this.battleView.contains(this.hlightSpriteCopies[e])||this.battleView.addChildAt(this.hlightSpriteCopies[e],1),this.hlightSpriteCopies[e].visible=!0,this.hlightSpriteCopies[e].x=o,this.hlightSpriteCopies[e].y=a-3}}}},t.prototype.hideCountDown=function(){this.planTimeCountDown&&(this.planTimeCountDown.visible=!1)},t.prototype.updatePlanTime=function(){if(!xself.isNovice&&this.battleView.isTag(BattleConst.TAG_PLAYER_PLAN_END)&&this.battleView.isTag(BattleConst.TAG_ALL_END)&&!GameWorld.isNewArenaStatus()&&null!=this.battle){var t=Utility.getPlanTime(this.battle.roundEndTime);if(!(0>=t)){var e=t/1e3;0>=e&&(e=0),t%1e3!=0&&e++;var n=ImageSet.IMG_SET_NUMBER_BATTLE_ADD;10>e&&(n=ImageSet.IMG_SET_NUMBER_BATTLE_DMG);var i=Math.floor(e).toString();this.updatePlanTimeCountDown(n,i)}}},t.prototype.updatePlanTimeCountDown=function(t,e){null==this.planTimeCountDown&&(this.planTimeCountDown=new egret.Sprite,this.planTimeCountDown.scaleX=nato.mapRatio,this.planTimeCountDown.scaleY=nato.mapRatio),0==this.battleView.contains(this.planTimeCountDown)&&this.battleView.addChild(this.planTimeCountDown),this.planTimeCountDown.visible=!0,this.planTimeCountDown.removeChildren();for(var n=nato.findTextureForSheet(t,0),i=n.textureWidth,o=(n.textureHeight,e.length),a=0;o>a;a++){var r=parseInt(e.charAt(a)),s=new egret.Bitmap;s.texture=nato.findTextureForSheet(t,r),s.x=i*a,this.planTimeCountDown.addChild(s)}this.planTimeCountDown.anchorOffsetX=this.planTimeCountDown.width/2,this.planTimeCountDown.anchorOffsetY=this.planTimeCountDown.height/2,this.planTimeCountDown.x=PanelManager.battleUI.headInfoView.width+15*xhdRatio,this.planTimeCountDown.y=this.planTimeCountDown.width/2+10*xhdRatio},t.prototype.logic=function(t){if(this.battle=xworld.battle,this.battle.type==Battle.LOCAL){if(0>=this.battle.getPlanTime()&&0==xself.isNovice)return null==this.battle.getPlanData(this.orderPlayer.position)&&this.addPlan(this.orderPlayer.position,this.getBattlePlanData(BattleConst.PLAN_NONE)),this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET)&&this.orderPet&&null==this.battle.getPlanData(this.orderPet.position)&&this.addPlan(this.orderPet.position,this.getBattlePlanData(BattleConst.PLAN_NONE)),this.updatePlayerHpMpInfo(),void this.doPlanData()}else if(this.isRemoteWaitting())return this.updatePlayerHpMpInfo(),void this.battle.setRemoteWaiting(!0);this.initRoundStartOrder(),this.handlerMouseReleased(),this.logicTargetSelect(),this.updateCursor(),this.updateHLight(),PanelManager.battleUI.updateRound(this.battle.round)},t.prototype.handlerMouseReleased=function(){var t=Main.getXFromPointer(Main.pointReleasedFlag),e=Main.getYFromPointer(Main.pointReleasedFlag);if(-1!=t&&-1!=e){if(Main.instance.hasPopupUI){var n=AlertPanel.isTouchClose(t,e),i=!this.battleView.isTag(BattleConst.TAG_ALL_END);return void(1==n&&0==i&&this.gotoBattleMenu())}if(!Main.instance.hasDialogueUI)if(!this.handleOrderPanelMouse(t,e)&&null!=this.targetSelectPanel)this.targetSelectPanel.handlerMouse(t,e)||this.gotoBattleMenu(),PanelManager.battleUI.showHeadInfoView()}},t.prototype.logicBattleSee=function(){this.initRoundStartOrder(),this.handlerMouseReleased(),this.logicRemoteWaiting(),this.logicTargetSelect(),this.updateCursor(),this.updateHLight(),this.updatePlanTime(),PanelManager.battleUI.updateRound(this.battle.round)},t.prototype.logicRemoteWaiting=function(){this.handlerMouseReleased()},t.prototype.isRemoteWaitting=function(){return!this.battle.isValidBattlePlayer(this.orderPlayer)&&(null==this.orderPet||(1==this.isPetAuto()||!this.battle.isValidBattlePlayer(this.orderPet)))},t.prototype.logicTargetSelect=function(e){if(void 0===e&&(e=0),null!=this.targetSelectPanel&&this.targetSelectPanel.isFinshSelect()){var n=this.targetSelectPanel.getTargetPos();return this.getOrderIndex()==t.ORDER_INFO?(this.doViewPlayerInfo(n),void this.targetSelectPanel.setFinshSelect(!1)):void this.doOrderAction(this.getOrderIndex(),n)}},t.prototype.handleOrderPanelMouse=function(t,e){return null!=PanelManager.battleUI&&0!=PanelManager.battleUI.visible&&(PanelManager.battleSkillPanel&&null!=PanelManager.battleSkillPanel.parent&&PanelManager.battleSkillPanel.visible&&(n=PanelManager.battleSkillPanel.searchPressWidget(t,e),i=PanelManager.battleSkillPanel),PanelManager.battleItemPanel&&null!=PanelManager.battleItemPanel.parent&&PanelManager.battleItemPanel.visible&&(n=PanelManager.battleItemPanel.searchPressWidget(t,e),i=PanelManager.battleItemPanel),null==i&&(n=PanelManager.battleUI.searchPressWidget(t,e),i=PanelManager.battleUI),null==n?(PanelManager.battleUI.closeListPanel(),!1):(PanelManager.battleUI.setActionWidget(n),this.processLayerAction(i),!0));var n,i},t.prototype.processLayerAction=function(t){switch(t){case PanelManager.battleItemPanel:case PanelManager.battleSkillPanel:this.processInfoList();break;case PanelManager.battleUI:this.processOrderPopPanel()}},t.prototype.processOrderPopPanel=function(){switch(PanelManager.battleUI.getActionWidgetEvent()){case BattleMenu.EVENT_BATTLE_ORDER_ATTACK:if(1==GameWorld.useGuide&&this.battleView.isTag(BattleConst.TAG_IS_GUIDE_ATTACK_MENU))return this.battleView.setTag(BattleConst.TAG_IS_GUIDE_ATTACK_MENU,!1),this.battleView.setTag(BattleConst.TAG_IS_GUIDE_ATTACK_TARGET,!0),this.changeOrder(t.ORDER_ATTACK),!0;if(this.getOrderIndex()==t.ORDER_ATTACK&&this.isCursorEnable()&&this.targetSelectPanel)return this.targetSelectPanel.setFinshSelect(!0),!0;this.changeOrder(t.ORDER_ATTACK);break;case BattleMenu.EVENT_BATTLE_ORDER_SKILL:1==GameWorld.useGuide&&this.battleView.isTag(BattleConst.TAG_IS_GUIDE_OPEN_SKILL)&&(this.battleView.setTag(BattleConst.TAG_IS_GUIDE_OPEN_SKILL,!1),this.battleView.setTag(BattleConst.TAG_IS_GUIDE_SELECT_SKILL,!0)),this.changeOrder(t.ORDER_SKILL);break;case BattleMenu.EVENT_BATTLE_ORDER_ITEM:if(this.isPetRound())return!1;this.changeOrder(t.ORDER_ITEM);break;case BattleMenu.EVENT_BATTLE_ORDER_INFO:case BattleMenu.EVENT_BATTLE_ORDER_INFO_SEE:this.changeOrder(t.ORDER_INFO);break;case BattleMenu.EVENT_BATTLE_ORDER_AUTO:1==GameWorld.useGuide&&this.battleView.isTag(BattleConst.TAG_IS_GUIDE_ATTACK_AUTO)&&this.battleView.setTag(BattleConst.TAG_IS_GUIDE_ATTACK_AUTO,!1),0==this.battleView.isTag(BattleConst.TAG_IS_AUTO_FIGHT)&&(this.battleView.setTag(BattleConst.TAG_IS_AUTO_FIGHT,!0),this.updateAutoFightText(!0),this.doAutoFight());break;case BattleMenu.EVENT_BATTLE_ORDER_ESCAPE:if(1==this.isPetRound())return!1;this.doOrderAction(t.ORDER_ESCAPE,null),this.setOrderIndex(t.ORDER_NONE);break;case BattleMenu.EVENT_BATTLE_ORDER_SKIP_ANI:GameWorld.useGuide&&(this.battleView.isTag(BattleConst.TAG_IS_GUIDE_SKIP_ROUND)&&this.battleView.setTag(BattleConst.TAG_IS_GUIDE_SKIP_ROUND,!1),this.battleView.isTag(BattleConst.TAG_IS_GUIDE_SKIP_BATTLE)&&this.battleView.setTag(BattleConst.TAG_IS_GUIDE_SKIP_BATTLE,!1)),this.battleView.isSkipBattleAvaliable()&&this.battleView.setTag(BattleConst.TAG_IS_SKIP_BATTLE,!0),this.battleView.closePlayerAnimation(),this.checkSkipAnimeGWidgetShow(!1);break;case BattleMenu.EVENT_BATTLE_ORDER_CANCEL_AUTO:this.battleView.isTag(BattleConst.TAG_IS_AUTO_FIGHT)&&(this.battleView.setTag(BattleConst.TAG_IS_AUTO_FIGHT,!1),this.updateAutoFightText(!1));break;case BattleMenu.EVENT_BATTLE_ORDER_PET_AUTO:case BattleMenu.EVENT_BATTLE_ORDER_PET_CANCEL_AUTO:this.doChangePetAutoHand();break;case BattleMenu.EVENT_BATTLE_ORDER_QUIT_SEE:this.battleView.doBattleSeeExit()}},t.prototype.doChangePetAutoHand=function(){if(null!=this.orderPlayer){var t=this.isPetAuto();if(t=!t,this.orderPlayer.clearSettingBit(Define.SETTING_PET_PLAN_OFF),t&&this.orderPlayer.setSettingBit(Define.SETTING_PET_PLAN_OFF),this.checkPetGWidgetShow(),1==this.isPetRound()&&1==this.isPetAuto()){if(null==this.orderPet)return;if(1==this.battle.isRemoteWaiting())return;if(0==this.battleView.isTag(BattleConst.TAG_ALL_END))return;this.battle.isValidBattlePlayer(this.orderPet),0==this.isUseSkillInitiative(this.orderPet)&&this.addPlan(this.orderPet.position,this.getBattlePlanData(BattleConst.PLAN_NONE)),this.doPlanData()}}},t.prototype.processInfoList=function(){var t=PanelManager.battleUI.getActionWidget();if(null!=t)if(t.obj instanceof Skill){var e=t.obj;if(PanelManager.battleSkillPanel.selectedBtn!=t)return PanelManager.battleSkillPanel.updateDesc(Tool.convertDescToTextFlow(e.getDesc(!1))),void(PanelManager.battleSkillPanel.selectedBtn=t);var n=new StringBuffer;if(0==Skill.isCanUse(this.getOrderPlayer(),e,n))return void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.toString());this.setSelectSkill(e),this.targetSelectPanel=this.getTargetSelectPanel(),PanelManager.battleUI.hideMenu(),PanelManager.battleUI.closeListPanel(),GameWorld.useGuide&&1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_SELECT_SKILL)&&(this.battleView.setTag(BattleConst.TAG_IS_GUIDE_SELECT_SKILL,!1),this.battleView.setTag(BattleConst.TAG_IS_GUIDE_ATTACK_TARGET,!0),this.battleView.setTag(BattleConst.TAG_IS_GUIDE_PET_AUTO,!0),this.setAttackTargetGuide(4))}else if(t.obj instanceof ItemData){var i=t.obj;if(PanelManager.battleItemPanel.selectedBtn!=t)return PanelManager.battleItemPanel.updateDesc(i.getDesc(null)),void(PanelManager.battleItemPanel.selectedBtn=t);this.setSelectItem(i),this.targetSelectPanel=this.getTargetSelectPanel(),PanelManager.battleUI.hideMenu(),PanelManager.battleUI.closeListPanel()}},t.prototype.checkSkipAnimeGWidgetShow=function(t){0==guide.isSkipBattleUnlocked()&&0==xworld.noviceQuickBattle&&(t=!1);var e=guide.isSkipBattleUnlocked(),n=this.battleView.isTag(BattleConst.TAG_IS_AUTO_FIGHT);if(0==e&&1==n&&(t=!1),PanelManager.battleUI.setSkipAnimeVisible(t),1==t&&1==GameWorld.useGuide&&egret.callLater(this.checkSkipAniGuide,this),this.battleView.isTag(BattleConst.TAG_IS_BATTLE_SEE))PanelManager.battleUI.setCancelAutoVisible(!1),PanelManager.battleUI.setOrderInfoVisible(!t);else{var i=this.battleView.isTag(BattleConst.TAG_IS_AUTO_FIGHT);PanelManager.battleUI.setCancelAutoVisible(i)}},t.prototype.checkSkipAniGuide=function(){1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_SKIP_ROUND)?this.setSkipAniGuide():1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_SKIP_BATTLE)&&this.setSkipAniGuide(!0)},t.prototype.checkPetGWidgetShow=function(){if(null!=this.battleView&&null!=this.orderPlayer){var t=this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET),e=this.isPetAuto(),n=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_PET_AUTO);null!=n&&(n.visible=!!t&&!e);var i=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_PET_CANCEL_AUTO);null!=i&&(i.visible=!!t&&e)}},t.prototype.updateAutoFightText=function(t){this.battleView.isTag(BattleConst.TAG_IS_BATTLE_SEE)?PanelManager.battleUI.setCancelAutoVisible(!1):PanelManager.battleUI.setCancelAutoVisible(t)},t.prototype.changeOrder=function(e){switch(this.setOrderIndex(e),this.cleanTargetSelect(),this.getOrderIndex()){case t.ORDER_ATTACK:this.targetSelectPanel=this.getTargetSelectPanel(),PanelManager.battleUI.hideHeadInfoView(),1==GameWorld.useGuide&&this.setAttackTargetGuide(5);break;case t.ORDER_SKILL:this.initSkillListPanel(),PanelManager.battleUI.hideHeadInfoView();break;case t.ORDER_ITEM:this.initItemListPanel(),PanelManager.battleUI.hideHeadInfoView();break;case t.ORDER_INFO:this.targetSelectPanel=this.getTargetSelectPanel(),PanelManager.battleUI.hideHeadInfoView()}},t.prototype.doViewPlayerInfo=function(t){if(!(null==t||t.length<=0)){var e=this.battle.getPlayerByPos(t[0]);null!=e&&AlertPanel.alertNotify(GameText.STR_PLAYER_INFO,this.getPlayerDesc(e))}},t.prototype.setAttackTargetGuide=function(t){if(null!=this.targetSelectPanel&&null!=this.battleView&&0!=this.battleView.isTag(BattleConst.TAG_IS_GUIDE_ATTACK_TARGET)){this.battleView.setTag(BattleConst.TAG_IS_GUIDE_ATTACK_TARGET,!1);var e=this.battle.getPlayerByPos(t);if(null!=e&&null!=e.battleSprite&&2==e.getType()){var n=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_ATTACK_TARGET,i=this.battleView.getPosition(t,BattleView.COORD_X),o=this.battleView.getPosition(t,BattleView.COORD_Y),a=0,r=0;Battle.isLeftSide(t)?(a=BattleView.POS_MIN_WIDTH+this.battleView.posData.posLeftSpace,r=this.battleView.posData.posLeftHeight):(a=BattleView.POS_MIN_WIDTH+this.battleView.posData.posRightSpace,r=this.battleView.posData.posRightHeight);var s=i-a/2,l=o-r;GameWorld.setGuide(GameWorld.GUIDE_BATTLE_ATTACK_TARGET),GameWorld.getGuideFrame(n).show(i,l),GameWorld.setGuideRect(s,l,a,r),this.getCursor()!=t&&this.targetSelectPanel.dealCursorLogic(t)}}},t.prototype.setAttackMenuGuide1=function(){if(null!=this.battleView){var t=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_ATTACK);if(null!=t&&null!=t.parent){var e=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_ATTACK_CHOICE,n=t.parent.localToGlobal(t.x,t.y);GameWorld.setGuide(GameWorld.GUIDE_BATTLE_ATTACK_MENU);var i=BattleMenu.BTN_WIDTH*xhdRatio,o=BattleMenu.BTN_HEIGHT*xhdRatio;GameWorld.getGuideFrame(e).show(n.x+i/2,n.y+5),GameWorld.setGuideRect(n.x,n.y,i,o)}}},t.prototype.setAttackMenuGuide2=function(){if(null!=this.battleView){var t=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_AUTO);if(null!=t&&null!=t.parent){var e=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_ATTACK_AUTO,n=t.parent.localToGlobal(t.x,t.y);GameWorld.setGuide(GameWorld.GUIDE_BATTLE_ATTACK_AUTO);var i=BattleMenu.BTN_WIDTH*xhdRatio,o=BattleMenu.BTN_HEIGHT*xhdRatio;GameWorld.getGuideFrame(e).show(n.x+i/2,n.y+5),GameWorld.setGuideRect(n.x,n.y,i,o)}}},t.prototype.setSkillMenuGuide=function(){if(null!=this.battleView){var t=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_SKILL);if(null!=t&&null!=t.parent){var e=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_SKILL_CHOICE,n=t.parent.localToGlobal(t.x,t.y);GameWorld.setGuide(GameWorld.GUIDE_BATTLE_OPEN_SKILL);var i=BattleMenu.BTN_WIDTH*xhdRatio,o=BattleMenu.BTN_HEIGHT*xhdRatio;GameWorld.getGuideFrame(e).show(n.x+i/2,n.y+5),GameWorld.setGuideRect(n.x,n.y,i,o)}}},t.prototype.setSkipAniGuide=function(t){if(void 0===t&&(t=!1),null!=this.battleView){var e=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_SKIP_ANI);if(null!=e&&null!=e.parent){var n=t?"跳过战斗过程":"跳过当前回合的战斗动画",i=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuide(GameWorld.GUIDE_SKIP_ROUND);var o=BattleMenu.BOTTOM_BTN_WIDTH*xhdRatio,a=BattleMenu.BOTTOM_BTN_HEIGHT*xhdRatio;GameWorld.getGuideFrame(n).show(i.x+o/2,i.y+5),GameWorld.setGuideRect(i.x,i.y,o,a)}}},t.prototype.setPetAutoGuide=function(){if(null!=this.battleView){var t=PanelManager.battleUI.getWidgetByEventType(BattleMenu.EVENT_BATTLE_ORDER_PET_AUTO);if(null!=t&&null!=t.parent){var e=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_ATTACK_AUTO,n=t.parent.localToGlobal(t.x,t.y);GameWorld.setGuide(GameWorld.GUIDE_BATTLE_PET_ATTACK_AUTO),guide.arrow_direction=guide.GUIDE_ARROW_UP;var i=BattleMenu.BTN_WIDTH*(xhdRatio/2),o=BattleMenu.BTN_HEIGHT*(xhdRatio/2);GameWorld.getGuideFrame(e).show(n.x+i/2,n.y+5),GameWorld.setGuideRect(n.x,n.y,i,o)}}},t.prototype.initRoundStartOrder=function(){if(!this.isOrderInit()){if(GuideHandler.setGuideWidgetVisible(!1),this.setOrderInit(!0),this.checkSkipAnimeGWidgetShow(!1),this.battleView.isTag(BattleConst.TAG_IS_AUTO_FIGHT))return void this.doAutoFight();if(1==GameWorld.useGuide&&(1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_ATTACK_MENU)?this.setAttackMenuGuide1():1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_ATTACK_AUTO)?this.setAttackMenuGuide2():1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_OPEN_SKILL)&&this.setSkillMenuGuide(),GameWorld.guideType==GameWorld.GUIDE_SKIP_ROUND&&GameWorld.cleanGuide()),this.updatePlayerHpMpInfo(),null!=this.battleView&&this.battleView.isTag(BattleConst.TAG_IS_BATTLE_SEE))return;!this.battle.isValidBattlePlayer(this.orderPlayer)&&this.battle.isValidBattlePlayer(this.orderPet)&&(this.orderPlayer&&null==this.battle.getPlanData(this.orderPlayer.position)&&this.addPlan(this.orderPlayer.position,this.getBattlePlanData(BattleConst.PLAN_NONE)),this.setPetRound(!0)),this.gotoBattleMenu()}},t.prototype.selectAutoFightTarget=function(t){if(null==this.battle)return 0;var e=0,n=this.battle.getLeftPosNum();Battle.isLeftSide(t.position)&&(e=Battle.LEFT_MAX_POS,n=Battle.MAX_POS);for(var i=e;n>i;i++){var o=this.battle.getPlayerByPos(i);if(this.battle.isValidBattlePlayer(o))return i}return e},t.prototype.doAutoFight=function(){!this.battleView.isTag(BattleConst.TAG_ALL_END)||this.battle.isRemoteWaiting()||this.battle.type==Battle.LOCAL&&!this.battle.isValidBattlePlayer(this.orderPlayer)||(null==this.battle.getPlanData(this.orderPlayer.position)&&(this.battle.isValidBattlePlayer(this.orderPlayer)?this.isUseSkillInitiative(this.orderPlayer)||(this.setCursor(this.selectAutoFightTarget(this.orderPlayer)),this.addPlan(this.orderPlayer.position,this.getBattlePlanData(BattleConst.PLAN_ATTACK))):this.addPlan(this.orderPlayer.position,this.getBattlePlanData(BattleConst.PLAN_NONE))),this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET)&&this.orderPet&&null==this.battle.getPlanData(this.orderPet.position)&&(this.isUseSkillInitiative(this.orderPet)||this.addPlan(this.orderPet.position,this.getBattlePlanData(BattleConst.PLAN_NONE))),this.updatePlayerHpMpInfo(),this.doPlanData(),this.battleView.isTag(BattleConst.TAG_IS_SKIP_BATTLE)&&this.battleView.closePlayerAnimation())},t.prototype.getBattlePlanData=function(t,e){var n=new egret.ByteArray;switch(n.writeByte(t),t){case BattleConst.PLAN_ATTACK:n.writeByte(this.getCursor());break;case BattleConst.PLAN_USE_SKILL:n.writeByte(this.getCursor()),e>0?n.writeShort(e):n.writeShort(this.getSelectSkill().id);break;case BattleConst.PLAN_USE_ITEM:n.writeByte(this.getCursor()),n.writeByte(this.getSelectItem().slotPos);case BattleConst.PLAN_ESCAPE:case BattleConst.PLAN_NONE:}return n},t.prototype.isReady=function(){if(this.battle.type==Battle.LOCAL){if(null==this.battleView||null==this.battle)return!0;if(null==this.orderPlayer)return!0;var t=this.battleView.isTag(BattleConst.TAG_HAVE_MY_PET);if(null==this.battle.getPlanData(this.orderPlayer.position))return!1;if(t){if(null==this.orderPet)return!1;if(null==this.battle.getPlanData(this.orderPet.position))return!1}return!0}return this.isRemoteReady()},t.prototype.isPetAuto=function(){return null!=this.orderPlayer&&this.orderPlayer.isSettingBit(Define.SETTING_PET_PLAN_OFF)},t.prototype.initAttackOrder=function(){var e=this.getOrderPlayer();null!=e&&(this.setCursor(e.position<Battle.LEFT_MAX_POS?Battle.LEFT_MAX_POS:0),this.changeOrder(t.ORDER_ATTACK))},t.prototype.updatePlayerHpMpInfo=function(){null!=this.orderPlayer&&(this.orderPlayer.hpDisplay=this.orderPlayer.hp,this.orderPlayer.mpDisplay=this.orderPlayer.mp,this.orderPet&&(this.orderPet.hpDisplay=this.orderPet.hp,this.orderPet.mpDisplay=this.orderPet.mp),PanelManager.battleUI.headInfoView.updateRoleProgress(),PanelManager.battleUI.headInfoView.updatePetProgress())},t.prototype.doPlanData=function(){if(this.cleanTargetSelect(),this.isReady()){if(this.setPetRound(!1),this.battle.type===Battle.LOCAL)this.doBattleRoundLogic();else this.battle.setRemoteWaiting(!0);this.orderPlayer&&this.battle.clearPlan(this.orderPlayer.position),this.orderPet&&this.battle.clearPlan(this.orderPet.position)}PanelManager.battleUI.hideMenu(),this.setOrderInit(!1)},t.prototype.removeBagUseItem=function(e){if(e==t.ORDER_ITEM){var n=this.getMyPlayer();if(null!=n&&this.battle.type!=Battle.LOCAL){var i=n.bag;if(null==i)return;var o=this.getSelectItem();if(null==o)return;i.removeBagItemByPos(o.slotPos,1)}}},t.prototype.initItemListPanel=function(){var t=this.getMyPlayer();if(null!=t&&null!=t.bag){var e=t.bag.getCanUseItemList(2);if(null==e||0==e.length)return void AlertPanel.alertNotify(GameText.STR_BATTLE_ITEM_USE_NULL,GameText.STR_BATTLE_ITEM_USE_NULL_INFO);var n=GameWorld.getItemNameInfo(e,!1),i=null,o=e[0];o&&(i=o.getDesc(null)),PanelManager.openBattleItemPanel(i,n,e)}},t.prototype.initSkillListPanel=function(){var t=this.getOrderPlayer();if(null!=t){var e=Player.getSkillListByType(t.skillList,Define.SKILL_TYPE_ACTIVE);if(null==e||0==e.length)return void AlertPanel.alertCommon(GameText.getText(GameText.TI_BATTLE_NO_SKILL));for(var n=null,i=new Array(e.length),o=0;o<e.length;o++){var a=e[o];if(null!=a){i[o]=a.name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),a.level+"")+")";var r=new StringBuffer;0==Skill.isCanUse(t,a,r)&&(i[o]+="("+r.toString()+")"),null==n&&(n=Tool.convertDescToTextFlow(a.getDesc(!1)))}}PanelManager.openBattleSkillPanel(n,i,e)}},t.prototype.getTargetSelectPanel=function(){var e=null;switch(this.getOrderIndex()){case t.ORDER_ATTACK:e=new TargetSelectPanel(this,Define.SKILL_AREA_SINGLE);break;case t.ORDER_SKILL:var n=this.getSelectSkill();if(null==n)return null;(e=new TargetSelectPanel(this,n.area)).setSelectSkill(n);break;case t.ORDER_ITEM:var i=this.getSelectItem();if(null==i)return null;(e=new TargetSelectPanel(this,i.area)).setSelectItem(i);break;case t.ORDER_INFO:e=new TargetSelectPanel(this,Define.SKILL_AREA_SINGLE)}return null!=e&&(e.init(),PanelManager.battleUI.hideMenu()),e},t.prototype.cleanTargetSelect=function(){this.setCursorEnable(!0),this.targetSelectPanel=null,this.cursorSprite.visible=!1;for(var t=0,e=this.hlightSpriteCopies.length;e>t;t++)this.hlightSpriteCopies[t].visible=!1},t.prototype.doBattleRoundLogic=function(){this.battle.logicRound(),this.battleView.makeBattleAni()},t.prototype.doOrderAction=function(e,n){var i=this.getOrderPlayer();if(null!=i){var o=null;switch(e){case t.ORDER_ATTACK:o=this.getBattlePlanData(BattleConst.PLAN_ATTACK);break;case t.ORDER_SKILL:o=this.getBattlePlanData(BattleConst.PLAN_USE_SKILL);break;case t.ORDER_ITEM:(o=this.getBattlePlanData(BattleConst.PLAN_USE_ITEM))&&this.removeBagUseItem(e);break;case t.ORDER_ESCAPE:o=this.getBattlePlanData(BattleConst.PLAN_ESCAPE)}this.addPlan(i.position,o),0==this.isPetRound()&&this.orderPet&&(e==t.ORDER_ESCAPE||this.isPetAuto()||!this.battle.isValidBattlePlayer(this.orderPet)?0==this.isUseSkillInitiative(this.orderPet)&&this.addPlan(this.orderPet.position,this.getBattlePlanData(BattleConst.PLAN_NONE)):(this.setPetRound(!0),GameWorld.useGuide&&1==this.battleView.isTag(BattleConst.TAG_IS_GUIDE_PET_AUTO)&&(this.battleView.setTag(BattleConst.TAG_IS_GUIDE_PET_AUTO,!1),this.setPetAutoGuide()))),this.doPlanData()}},t.prototype.getSequenceList=function(){var t=[];if(null==this.battle.resultControlList)return t;for(var e,n=0,i=0,o=0,a=0,r=this.battle.resultControlList;a<r.length;a++){var s=r[a],l=s;if(null!=l){switch(n=i,i=s.byte0,o=s.counter,s.type){case Control.TYPE_BATTLE_SKILL:case Control.TYPE_BATTLE_ESCAPE:0==this.battle.isSameSide(n,i)&&(e=[],t.push(e));break;case Control.TYPE_BATTLE_TARGET_EFFECT:(Battle.isEffectStatus(o,BattleConst.EFFECT_REBORN)||Battle.isEffectStatus(o,BattleConst.EFFECT_DIE_DELAY))&&(e=[],t.push(e))}null==e&&(e=[],t.push(e)),e.push(l)}}return this.cleanTargetSelect(),PanelManager.battleUI.hideMenu(),this.setOrderInit(!1),0==GameWorld.isNewArenaStatus()&&this.setPetRound(!1),this.battle.type!=Battle.LOCAL&&this.cleanPlanVector(),this.checkSkipAnimeGWidgetShow(!0),t},t.prototype.getPlayerDesc=function(t){var e=new StringBuffer;return e.append(t.getName()+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),t.getLevel()+"")+")\n"),e.append(GameText.STR_PLAYER_HP+t.get(ModelConst.HP)+"/"+t.get(ModelConst.HPMAX)+"  "),e.append(GameText.STR_PLAYER_MP+t.get(ModelConst.MP)+"/"+t.get(ModelConst.MPMAX)+"\n"),e.append(GameText.STR_ATTR_KEEPOUT_ATK_TIME+":"+t.keepout_atk_time+"\n"),e.append("法力护盾:"+t.get(ModelConst.DEF_FIELD)+"\n"),e.append(this.getPlayerBufferMsg(t)),null!=t.formationSkill&&e.append(t.formationSkill.getFormationInfo()),e.toString()},t.prototype.getPlayerBufferMsg=function(e){if(null==e)return"";for(var n="",i="",o=Define.BUFFER_POISON;o<=Define.BUFFER_DIE_CANNOT_RELIVE;o++)if(o!=Define.BUFFER_TYPE_BUFF&&o!=Define.BUFFER_TYPE_DEBUFF){if(0!=e.isBattleStatus(Define.getBufferBitValue(o))){var a=BattleView.getBufferImageIndex(o),r=!1;if(egret.is(e,"Monster")){var s=e;0!=s.bornStatus&&s.isBornStatus(Define.getBufferBitValue(o))&&(r=!0)}if(egret.is(e,"MyPet")){var l=e;0!=l.bornStatus&&l.isBornStatus(Define.getBufferBitValue(o))&&(r=!0)}r?i+=t.getBufferdescInfo(a,o)+"\n":n+=t.getBufferdescInfo(a,o)+"\n"}}return""!=n.trim()&&(n=GameText.STR_STATUS+"\n"+n),""!=i.trim()&&(i=GameText.STR_BORN_STATUS+"\n"+i),n+i},t.getBufferdescInfo=function(t,e){var n="";return(n+=PowerString.makeIconString(BattleView.BUFF_IMAGE_SET,t))+(Define.getBufferType(e)==Define.BUFFER_TYPE_BUFF?PowerString.makeColorString("("+Define.getBufferString(e)+")",ColorUtils.COLOR_GREEN):PowerString.makeColorString("("+Define.getBufferString(e)+")",ColorUtils.COLOR_RED))},t.prototype.getPlayerBufferDebugMsg=function(e){var n=new StringBuffer;if(null!=e&&null!=e.battleBufferList){e.battleBufferList.length>0&&n.append("====[Buffer列表]====\n");for(var i=0;i<e.battleBufferList.length;i++){var o=e.battleBufferList[i];if(null!=o){var a=o.toString();Define.getBufferType(o.getStatus())==Define.BUFFER_TYPE_BUFF?n.append(PowerString.makeColorString(a,ColorUtils.COLOR_GREEN)+"\n"):n.append(PowerString.makeColorString(a,ColorUtils.COLOR_RED)+"\n")}}for(var r=Define.BUFFER_POISON;r<=Define.BUFFER_DIE_CANNOT_RELIVE;r++){0!=e.isBattleStatus(Define.getBufferBitValue(r))&&1!=t.isBuffer(e,r)&&n.append("错误状态： "+Define.getBufferString(r)+"\n")}}if(egret.is(e,"Monster")){var s=e;if(0!=s.bornStatus){n.append("====[怪物bornStatus]====\n");for(r=Define.BUFFER_POISON;r<=Define.BUFFER_DIE_CANNOT_RELIVE;r++){0!=s.isBornStatus(Define.getBufferBitValue(r))&&(Define.getBufferType(r)==Define.BUFFER_TYPE_DEBUFF?n.append("天生免疫:"+Define.getBufferString(r)+"\n"):n.append("天生获得:"+Define.getBufferString(r)+"\n"))}}}return n.toString()},t.isBuffer=function(t,e){if(null==t)return!1;for(var n=0;n<t.battleBufferList.length;n++){var i=t.battleBufferList[n];if(null!=i&&i.getStatus()==e)return!0}return!1},t.CURSOR_OFFSET_Y=50,t.ORDER_NONE=-1,t.ORDER_ATTACK=1,t.ORDER_SKILL=2,t.ORDER_ITEM=3,t.ORDER_AUTO=4,t.ORDER_INFO=5,t.ORDER_ESCAPE=6,t}();__reflect(BattleInputHandler.prototype,"BattleInputHandler"),function(t){t.battleTestData={playerList:[{id:"5",type:2,name:"怪物5",pos:4,hp:1e3,hpMax:1e3,mp:800,mpMax:800,icon1:20148},{id:"6",type:2,name:"怪物6",pos:5,hp:1e3,hpMax:1e3,mp:800,mpMax:800,icon1:20176},{id:"7",type:2,name:"怪物7",pos:6,hp:1e3,hpMax:1e3,mp:800,mpMax:800,icon1:20009},{id:"10000",type:3,name:"shane",pos:25,hp:1e3,hpMax:1e3,mp:800,mpMax:800,icon1:20019}]},t.test=function(){for(var e=[],n=0,i=this.battleTestData.playerList;n<i.length;n++){var o=i[n],a=t.parsePlayer(o);e[a.position]=a}var r=Battle.createLocalBattle(0,e,null);r.result=0,r.round=0,xworld.battle=r,xworld.inBattle=!0;var s=BattleView.instance;Main.instance.addGame(s),s.initBattle()},t.parsePlayer=function(t){var e;return(e=t.id==xself.getId()?xself:new Monster).setIcon1(t.icon1),e.position=t.pos,e}}(BattleTester||(BattleTester={}));var BattleView=function(t){function e(){var e=t.call(this)||this;e.endCountTime=-1,e.tagValue=0,e.battlePosition=[[],[]],e.posData=new PosData,e.playersColumn1=new Array(Battle.NUM_COLUMN_1),e.playersColumn2=new Array(Battle.NUM_COLUMN_2),e.playersColumn3=new Array(Battle.NUM_COLUMN_3),e.playersColumn4=new Array(Battle.NUM_COLUMN_4),e.animationControlList=[],e.startHP=0,e.startMP=0,e.nextPollTime=0,e.waitNextBattleTime=0,e.battle=xworld.battle,e.gameMap=xworld.gameMap;for(var n=0;n<Battle.MAX_POS;n++)e.battlePosition[0][n]=0,e.battlePosition[1][n]=0;return e.criticalImage=e.createBattleImage(ImageSet.IMG_SET_BATTLE_CRIT_EFF),e.winImage=e.createBattleImage(ImageSet.IMG_SET_BATTLE_RESULT_WIN),e.lostImage=e.createBattleImage(ImageSet.IMG_SET_BATTLE_RESULT_LOST),e.okImage=e.createBattleImage(ImageSet.IMG_SET_BATTLE_OK),e.baseCurSprite=SpriteHelper.createSpritex(GameSprite.ANI_BATTLE_CUR,!0),e.effHitSprite=SpriteHelper.createBattleEffSprite(GameSprite.EFF_HIT),e.effMagicFieldSprite=SpriteHelper.createBattleEffSprite(GameSprite.SPRITE_DEF_FIELD),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.initializResolution=function(){e.POS_MIN_WIDTH=xhd?60:30,e.POS_MIN_HEIGHT=xhd?40:20,e.SIDE_POS_MIN_WIDTH=2*e.POS_MIN_WIDTH,e.BOREDER_MIN_DIS=xhd?30:15,e.MAX_OFFSET_Y=xhd?12:6},e.prototype.getBattle=function(){return this.battle},e.prototype.setEndCounter=function(){xself.isNovice?this.endCountTime=e.END_COUNT_TIME_NOVICE:this.endCountTime=e.END_COUNT_TIME},e.prototype.isEndCounter=function(){return this.endCountTime>0},e.getBufferImageIndex=function(t){switch(t){case Define.BUFFER_POISON:return e.BUFF_POISON;case Define.BUFFER_BURN:return e.BUFF_FIRE;case Define.BUFFER_BLOOD:return e.BUFF_BLEED;case Define.BUFFER_ATTR_DOWN:return e.BUFF_ATTR_DEL;case Define.BUFFER_BLOCK_TALK:case Define.BUFFER_BLOCK_SKILL:case Define.BUFFER_SILENCE:case Define.BUFFER_STUN:case Define.BUFFER_CHAO:case Define.BUFFER_WEAK:case Define.BUFFER_DIE_CANNOT_RELIVE:return e.BUFF_NEGATIVE_EFFECT;case Define.BUFFER_ATTR_UP:case Define.BUFFER_ADD_MP:case Define.BUFFER_ADD_HP:return e.BUFF_ATTR_ADD;case Define.BUFFER_HIDE:return e.BUFF_HIDE;case Define.BUFFER_RESIST_MAGIC:case Define.BUFFER_RESIST_PHYSIC:case Define.BUFFER_RESIST_SILENCE:case Define.BUFFER_RESIST_STUN:case Define.BUFFER_RESIST_CHAO:case Define.BUFFER_RESIST_DEBUFF:case Define.BUFFER_RESIST_TALK:case Define.BUFFER_RESIST_SKILL:case Define.BUFFER_RESIST_WEAK:return e.BUFF_IMMUNE;case Define.BUFFER_INVINCIBLE:return e.BUFF_INVINCI;default:return e.BUFF_ATTR_ADD}},e.prototype.setBattle=function(t){xworld.inBattle&&this.exit(),this.battle=t,BattleInputHandler.instance.setBattle(t)},e.prototype.createBattleImage=function(t,e){void 0===e&&(e=1);var n=new egret.Bitmap;return n.texture=nato.findTextureForSheet(t),n.anchorOffsetX=.5*n.width*e,n.anchorOffsetY=.5*n.height*e,n.scaleX=e,n.scaleY=e,n},e.prototype.setGuide=function(t){this.setTag(t,!0)},e.prototype.setTag=function(t,e){e?this.tagValue|=t:this.tagValue&=~t},e.prototype.isTag=function(t){return 0!=(this.tagValue&t)},e.prototype.initBottomBg=function(){null==this.bottomBg&&(this.bottomBg=new egret.Sprite,this.bottomBg.name="bottomBg",this.bottomBg.graphics.beginFill(0,.8),this.bottomBg.graphics.drawRect(0,0,nato.stageWidth,nato.stageHeight),this.bottomBg.graphics.endFill()),this.addChild(this.bottomBg)},e.prototype.openBattleUI=function(){PanelManager.openBattleUI()},e.prototype.closeBattleUI=function(){GameWorld.isEscortStatus()?GameWorld.openEscort():GameWorld.isSkyArenaStatus()?PanelManager.openSkyArenaScene(GameWorld.skyarena,GameWorld.skyarena.isupdatesprite):GameWorld.isArenaStatus()?PanelManager.openArenaScene(GameWorld.arena):GameWorld.isNewArenaStatus()?PanelManager.openNewArenaScene(GameWorld.newArena):GameWorld.isCountryBossStatus()?PanelManager.openCountryBossScene(GameWorld.countryBoss):GameWorld.isTeamBossStatus()?PanelManager.openTeamBossScene(GameWorld.teamBoss):PanelManager.openMainMenuScene()},e.prototype.initBattle=function(){xworld.inBattle=!0,this.openBattleUI(),this.initBottomBg(),this.battleX=0,this.battleY=0,this.battleWidth=Main.instance.stage.stageWidth,this.battleHeight=Main.instance.stage.stageHeight;var t=this.battle.rowLeft,n=this.battle.rowRight,i=e.BATTLE_TOP_HEIGHT,o=e.BATTLE_BOTTOM_HEIGHT,a=this.battleX,r=this.battleWidth,s=this.battleY+i,l=this.battleHeight-i-o,_=this.getOffsetY(l,t),h=this.getOffsetY(l,n);this.initBattlePosition(a,s,r,l,_,t,!1),this.initBattlePosition(a,s,r,l,h,n,!0);for(var u=0;u<Battle.MAX_POS;u++){var c=this.getPlayerByPos(u);this.addBattlePlayer(c,u)}this.check(),1==GameWorld.useGuide&&(GameWorld.isLoginSetting(GameWorld.IS_GUIDE_BATTLE_DOING)?(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_BATTLE_DOING),this.setGuide(BattleConst.TAG_IS_GUIDE_ATTACK_MENU)):GameWorld.isLoginSetting(GameWorld.IS_GUIDE_BATTLE_AUTO)?(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_BATTLE_AUTO),this.setGuide(BattleConst.TAG_IS_GUIDE_ATTACK_AUTO)):GameWorld.isLoginSetting(GameWorld.IS_GUIDE_OPEN_BATTLE_SKILL)&&(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_OPEN_BATTLE_SKILL),this.setGuide(BattleConst.TAG_IS_GUIDE_OPEN_SKILL)),GameWorld.isLoginSetting(GameWorld.IS_GUIDE_SKIP_ROUND)?(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_SKIP_ROUND),this.setGuide(BattleConst.TAG_IS_GUIDE_SKIP_ROUND)):GameWorld.isLoginSetting(GameWorld.IS_GUIDE_SKIP_BATTLE)&&(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_SKIP_BATTLE),this.setGuide(BattleConst.TAG_IS_GUIDE_SKIP_BATTLE)))},e.prototype.check=function(){this.checkBattleSee(),this.checkMyPetInBattle()},e.prototype.checkBattleSee=function(){if(PanelManager.battleUI.setQuitSeeVisible(!1),PanelManager.battleUI.setOrderInfoVisible(!1),PanelManager.battleUI.showMenu(),this.battle.type!=Battle.LOCAL){var t=xself;if(null!=t){for(var e=0;e<Battle.MAX_POS;e++){var n=this.getPlayerByPos(e);if(null!=n&&3==n.getType()&&n.getId()==t.getId())return}PanelManager.battleUI.hideMenu(),this.setTag(BattleConst.TAG_IS_BATTLE_SEE,!0),WorldMessage.addPromptMsg(PowerString.makeColorString(GameText.STR_BATTLE_ANI_ENGINE_BATTLE_SEE,ColorUtils.COLOR_GREEN)),PanelManager.battleUI.setQuitSeeVisible(!0),PanelManager.battleUI.setOrderInfoVisible(!0)}}},e.prototype.checkMyPetInBattle=function(){this.setTag(BattleConst.TAG_HAVE_MY_PET,!1);var t=xself;if(null!=t){var e=t.position,n=this.getPlayerByPos(e);if(null!=n&&n.getId()==t.getId()){var i;i=Battle.isLeftSide(e)?e+1:e-1;var o=this.getPlayerByPos(i);return null==o?void BattleInputHandler.instance.setOrderPet(null):void(4==o.getType()&&(this.setTag(BattleConst.TAG_HAVE_MY_PET,!0),BattleInputHandler.instance.setOrderPet(o)))}}},e.prototype.getPlayerByPos=function(t){return null==this.battle?null:this.battle.getPlayerByPos(t)},e.prototype.getOffsetY=function(t,n){if(0==n||n>=Battle.MAX_ROW_NUM)return 0;var i=0,o=e.POS_MIN_HEIGHT*n;if(t>o){var a=(t-o)/n;0>a&&(a=0),(i=a)>=e.MAX_OFFSET_Y&&(i=e.MAX_OFFSET_Y)}return i},e.prototype.createBattlePlayerSprite=function(t){null!=t&&(t.getType(),t.battleSprite=t.createSprite(!0),xhd&&t.battleSprite.setScale(nato.mapRatio))},e.prototype.addBattlePlayer=function(t,n){null!=t&&(t.battlePlanControlList=[],t.battleEffectSpriteList=[],this.setColumnPlayer(t,n),this.createBattlePlayerSprite(t),egret.is(t,"Monster")||t.checkHPMP(),t==xself&&(this.startHP=t.hp,this.startMP=t.mp),t.hpDisplay=t.hp,t.mpDisplay=t.mp,t.dieSprite=SpriteHelper.createSprite(GameSprite.ANI_BATTLE_CUR),t.dieSprite.name="dieSprite",t.dieSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_BONES,-1),xhd&&t.dieSprite.setScale(nato.mapRatio),Battle.isLeftSide(n)?t.battleSprite&&t.battleSprite.setRotate(!0):t.dieSprite.setRotate(!0),t.battleSprite&&(t.battleSprite.x=this.getPosition(n,e.COORD_X),t.battleSprite.y=this.getPosition(n,e.COORD_Y)),t.dieSprite.x=this.getPosition(n,e.COORD_X),t.dieSprite.y=this.getPosition(n,e.COORD_Y),this.addChild(t.battleSprite))},e.prototype.getPosition=function(t,e){return 0>t||t>=Battle.MAX_POS?0:this.battlePosition[e][t]},e.prototype.setPosition=function(t,e,n){0>t||t>=Battle.MAX_POS||(this.battlePosition[e][t]=n)},e.prototype.initBattlePosition=function(t,n,i,o,a,r,s){var l=(o-a)/r,_=i/2-e.SIDE_POS_MIN_WIDTH,h=_/10;h<e.BOREDER_MIN_DIS&&(h=e.BOREDER_MIN_DIS),0>=(_-=h)&&(_=0);var u=3*_/10;s?(this.posData.posRightHeight=l,this.posData.posRightSpace=u):(this.posData.posLeftHeight=l,this.posData.posLeftSpace=u);var c=t+h,T=n,p=0;s&&(p=Battle.LEFT_MAX_POS,c=t+i-h);for(var d=p+2*r,E=0,g=0,S=p;d>S;S++){var m=Battle.getPositionColumn(S),f=Math.floor((S-p)/2)+1;E=c,g=T+l*f,(m==Battle.POSITION_COLUMN_2||m==Battle.POSITION_COLUMN_3)&&(g+=a),s?(E-=e.POS_MIN_WIDTH/2,m==Battle.POSITION_COLUMN_3&&(E-=u+e.POS_MIN_WIDTH)):(E+=e.POS_MIN_WIDTH/2,m==Battle.POSITION_COLUMN_2&&(E+=u+e.POS_MIN_WIDTH)),r>=Battle.MAX_ROW_NUM&&0==(1&f)&&(s?E-=2*u/3:E+=2*u/3),this.setPosition(S,e.COORD_X,E),this.setPosition(S,e.COORD_Y,g)}},e.prototype.setColumnPlayer=function(t,e){var n,i=-1;switch(Battle.getPositionColumn(e)){case Battle.POSITION_COLUMN_1:n=this.playersColumn1,i=e/2;break;case Battle.POSITION_COLUMN_2:n=this.playersColumn2,i=(e-1)/2;break;case Battle.POSITION_COLUMN_3:n=this.playersColumn3,i=(e-Battle.LEFT_MAX_POS)/2;break;case Battle.POSITION_COLUMN_4:n=this.playersColumn4,i=(e-Battle.LEFT_MAX_POS-1)/2}return null!=n?0>i||i>=n.length?void console.debug("setColumnPlayer() ERROR: addPos out of size, addPos = + "+i):void(n[i]=t):void 0},e.prototype.addPlayerPlanControl=function(t,e){if(null!=e){var n=this.getPlayerByPos(t);null!=n&&n.battlePlanControlList.push(e)}},e.prototype.addAnimationControl=function(t){null!=t&&this.animationControlList.push(t)},e.prototype.sendLocalBattleReward=function(){if(this.battle.type==Battle.LOCAL){this.updateMercenaryHpMP();var t=new nato.Message(ProtocolDefine.CG_FIGHT_RUN_LOCALBATTLE);t.putInt(this.startHP),t.putInt(this.startMP),t.putInt(xself.hp),t.putInt(xself.mp),t.putShort(this.battle.seed);var e=this.battle.getMonsterGroup(),n=-1;e&&(n=e.groupId),t.putShort(n);var i=this.isTag(BattleConst.TAG_HAVE_MY_PET);t.putBoolean(i);var o=BattleInputHandler.instance.planVector,a=o.length;i&&(a/=2),t.putByte(a);for(var r=0;r<o.length;){var s=o[r++];if(t.putBytes(s),i){var l=null;r<o.length&&(l=o[r++]),t.putBytes(l)}}nato.Network.sendCmd(t),this.printBattleProtocol(t)}},e.prototype.printBattleProtocol=function(t){t.reposition();for(var e=(t.getInt(),t.getInt(),t.getInt(),t.getInt(),t.getShort(),t.getShort(),t.getBoolean()),n=t.getByte(),i=0;n>i;i++){var o=t.getBytes();o.position=0;for(var a=[];o.bytesAvailable;)a.push(o.readByte());if(e){var r=t.getBytes();r.position=0;for(var s=[];r.bytesAvailable;)s.push(r.readByte())}}},e.prototype.sendRemoteBattleUpdate=function(){var t=BattleInputHandler.instance.isRemoteReady();if(!(Date.now()<this.nextPollTime&&0==t)){this.battle.isBattleFinish();var n=this.battle.round;if(1==t){var i=BattleInputHandler.instance.getPlanData(0),o=BattleInputHandler.instance.getPlanData(1),a=MsgHandler.createBattlePlan(n,i,o);nato.Network.sendCmd(a),BattleInputHandler.instance.cleanPlanVector()}var r=MsgHandler.createBattleUpdate(n);nato.Network.sendCmd(r),this.setTag(BattleConst.TAG_REMOTE_SEND,!0),this.setTag(BattleConst.TAG_REMOTE_SEND_WAITING,!0),this.nextPollTime=Date.now()+e.POLL_INTERVAL}},e.prototype.doBattleSeeExit=function(){if(this.battle.isBattleFinish())PanelManager.battleUI.setQuitSeeVisible(!1);else{var t=MsgHandler.createFightSeeQuitMsg();nato.Network.sendCmd(t)}},e.prototype.updateMercenaryHpMP=function(){for(var t=0;t<Battle.MAX_POS;t++){var e=this.getPlayerByPos(t);null!=e&&egret.is(e,"Mercenary")&&e.refreshWorldMercenaryData()}},e.prototype.closePlayerAnimation=function(){for(var t=this.battle.playerList,n=0;n<Battle.MAX_POS;n++){var i=t[n];if(null!=i){i.hpDisplay=i.hp,i.mpDisplay=i.mp;for(var o=0,a=i.battleEffectSpriteList;o<a.length;o++){var r=a[o];r&&r.parent&&r.parent.removeChild(r)}i.battleEffectSpriteList.length=0;for(var s=0,l=i.battlePlanControlList;s<l.length;s++){l[s].removeEffectFromStage()}i.battlePlanControlList.length=0,i.removeBattleMsg();var _=i.battleSprite;null!=_&&(_.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_STAND,-1),_.setSpritePosition(this.getPosition(i.position,e.COORD_X),this.getPosition(i.position,e.COORD_Y)),_.setSpriteVisible(!0),(i.isBattleStatus(Player.BSTATUS_ESCAPE)||i.isDead())&&_.setSpriteVisible(!1),null!=i.dieSprite&&i.isDead()&&(i.dieSprite.setMotionAlive(!0),i.dieSprite.setSpritePosition(_.x,_.y),this.addChild(i.dieSprite)))}}for(var h=0,u=this.animationControlList;h<u.length;h++){u[h].removeEffectFromStage()}this.animationControlList.length=0,this.planSequenceList.length=0,this.setTag(BattleConst.TAG_ALL_END,!0),PanelManager.battleUI.headInfoView.updateRoleProgress(),PanelManager.battleUI.headInfoView.updatePetProgress()},e.prototype.isSkipBattleAvaliable=function(){return 0!=guide.isSkipBattleUnlocked()&&(0!=this.isTag(BattleConst.TAG_IS_AUTO_FIGHT)&&(!(xworld.getTypeModel(Define.NEAR_MY_TEAM).length>0)&&this.battle.type!=Battle.PK))},e.prototype.clear=function(){for(var t=0;t<Battle.MAX_POS;t++){var e=this.getPlayerByPos(t);null!=e&&(e.battleSprite=null,e.dieSprite=null,e.dialogAIFrame=null,e.battleEffectSpriteList=null,e.battlePlanControlList=null,e.battleBufferList=null)}if(this.animationControlList&&(this.animationControlList.length=0),this.planSequenceList&&(this.planSequenceList.length=0),xself){xself.resetBattleBuffer();var n=xself.getPet();n&&n.resetBattleBuffer()}BattleInputHandler.instance.cleanPlanVector(),this.tagValue&=BattleConst.TAG_IS_AUTO_FIGHT},e.prototype.displayResultBitmap=function(){PanelManager.battleUI.setSkipAnimeVisible(!1),PanelManager.battleUI.setCancelAutoVisible(!1),PanelManager.openBattleResult(this.isWin()),GameWorld.guideType==GameWorld.GUIDE_SKIP_ROUND&&GameWorld.cleanGuide()},e.prototype.doExit=function(){this.setEndCounter(),this.exit()},e.prototype.exit=function(){xworld.inBattle=!1,xworld.inBattleResult=!1,xworld.readyToBattle=!1,GuideHandler.setGuideWidgetVisible(!0),this.clear(),this.closeBattleUI(),this.endCountTime=-1;var t=2==this.battle.result;if(this.battle.resetBattleResult(),PanelManager.closeBattleResult(),Main.instance.removeBattleItemView(),this.removeChildren(),this.parent&&this.parent.removeChild(this),1==GameWorld.useGuide&&GameWorld.isLoginSetting(GameWorld.IS_GUIDE_SEL_AUTO_SKILL)&&(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_SEL_AUTO_SKILL),GameWorld.setGuide(GameWorld.GUIDE_SEL_AUTO_SKILL)),xworld.battleChangeMap){xworld.battleChangeMap=!1;var e=MsgHandler.createWorldDataMessage(Define.SIMPLE_FLASH_DATA_FLAG,!0);nato.Network.sendCmd(e)}if((null==xworld.npcList||0==xworld.npcList.length)&&MsgHandler.createWorldDataReflashMsg(),null==GameWorld.skyarena){if(null!=GameWorld.countryBoss)return GameWorld.countryBoss.setStatus(!t,CountryBoss.STATUS_FIGHT_FAIL),void GameWorld.countryBoss.setStatus(!0,CountryBoss.STATUS_FIGHT_EXIT);if(null!=GameWorld.teamBoss)return GameWorld.teamBoss.setStatus(!t,TeamBoss.STATUS_FIGHT_FAIL),void GameWorld.teamBoss.setStatus(!0,TeamBoss.STATUS_FIGHT_EXIT);if(!t&&GameWorld.countryWar&&(GameWorld.countryWar.clearUpdate(),GameWorld.countryWar=null),OneKeyDailyMission.isDoingOnekeyMission&&0==t&&ItemManager.doQuickAddHP(xself),0==Mission.checkBattleMissionFinish()&&AutoGamer.checkAutoGameEnable()&&AutoGamer.autoFindMission(),this.battle.type!=Battle.LOCAL&&null==GameWorld.getEscort()){var n=Define.SIMPLE_FLASH_DATA_FLAG;e=MsgHandler.createWorldDataMessage(n,!1);nato.Network.sendCmd(e)}}else this.isTag(BattleConst.TAG_IS_BATTLE_SEE)||(0==t?GameWorld.skyarena.setStatus(!0,SkyArena.SKYARENA_STAGE_BATTLE_FAIL):GameWorld.skyarena.setStatus(!0,SkyArena.SKYARENA_STAGE_BATTLE_WIN))},e.prototype.getNextBattleID=function(){var t=this.getBattle();return null==t?-1:t.nextBattleGroupID},e.prototype.logic=function(t,n){if(this.doBattleAnimations(t),!this.isTag(BattleConst.TAG_ALL_END))return BattleInputHandler.instance.handlerMouseReleased(),BattleInputHandler.instance.hideCountDown(),void BattleInputHandler.instance.hideInfoMsg();if(1!=this.isTag(BattleConst.TAG_WAITING_NEXT_BATTLE)){if(this.endCountTime>0)return void(this.endCountTime>1e3?(this.endCountTime-=n,PanelManager.battleResultPanel.updateCountDown(this.endCountTime)):1==this.isWin()&&(this.getNextBattleID()>0&&this.isWin()&&0==this.isTag(BattleConst.TAG_IS_BATTLE_SEE)?(this.setTag(BattleConst.TAG_WAITING_NEXT_BATTLE,!0),this.waitNextBattleTime=Date.now()+e.INTERVAL_NEXT_BATTLE_TIME):this.exit()));if(1==this.battle.isRemoteWaiting())this.isTag(BattleConst.TAG_IS_BATTLE_SEE)?BattleInputHandler.instance.logicBattleSee():BattleInputHandler.instance.logicRemoteWaiting();else{if(this.battle.isBattleFinish())return this.battle.type==Battle.LOCAL||this.isTag(BattleConst.TAG_REMOTE_SEND)?(PanelManager.battleUI.hideMenu(),this.setEndCounter(),this.displayResultBitmap(),void this.sendLocalBattleReward()):void this.battle.setRemoteWaiting(!0);this.isTag(BattleConst.TAG_IS_BATTLE_SEE)?BattleInputHandler.instance.logicBattleSee():BattleInputHandler.instance.logic(t)}if(this.battle.type===Battle.LOCAL)xworld.doSync();else 0==this.isTag(BattleConst.TAG_REMOTE_SEND_WAITING)&&(GameWorld.isNewArenaStatus()||this.sendRemoteBattleUpdate());BattleInputHandler.instance.updatePlanTime()}else{if(Date.now()>=this.waitNextBattleTime)return void this.exit();if(null!=xself&&xself.isMember());else{var i=MsgHandler.createEnterRemoteBattle(this.getNextBattleID());nato.Network.sendCmd(i,(function(){this.waitNextBattleTime=Date.now()}),this)}}},e.prototype.doBattleAnimations=function(t){this.setTag(BattleConst.TAG_ALL_END,!0),this.setTag(BattleConst.TAG_PLAYER_PLAN_END,!0);var e=this.battle.getActivePlayerNum(0,this.battle.getLeftPosNum(),this.battle.isLeftHavePlayer,!0,!0),n=this.battle.getActivePlayerNum(Battle.LEFT_MAX_POS,Battle.MAX_POS,this.battle.isRightHavePlayer,!0,!0);if(0!=e&&0!=n){for(var i=this.battle.playerList,o=0;o<Battle.MAX_POS;o++){var a=i[o];if(null!=a){var r=a.battleSprite;if(null!=r){if(null!=a.dialogAIFrame&&a.dialogAIFrame.logic(t)&&(a.dialogAIFrame=null),a.battlePlanControlList.length>0)null==(c=a.battlePlanControlList[0])?a.battlePlanControlList.shift():(this.setTag(BattleConst.TAG_ALL_END,!1),this.setTag(BattleConst.TAG_PLAYER_PLAN_END,!1),c.action(),c.isDone&&a.battlePlanControlList.shift());for(var s=a.battleEffectSpriteList.length-1;s>=0;s--){var l=a.battleEffectSpriteList[s];if(null!=l)if(this.setTag(BattleConst.TAG_ALL_END,!1),!l.isMotionAlive()){var _=a.battleEffectSpriteList.indexOf(l);a.battleEffectSpriteList.splice(_,1),l==a.dieSprite&&(l.setMotionAlive(!0),l.setSpritePosition(r.x,r.y))}}var h=this.battle.isWaitStatus(a.position);a.setWaitStatus(h),a.drawWaitStatus()}}}for(var u=this.animationControlList.length-1;u>=0;u--){var c;if(null!=(c=this.animationControlList[u])&&(c.type==AnimationControl.BATTLE_CONTROL_PLAYER_ANIMATION&&this.setTag(BattleConst.TAG_PLAYER_PLAN_END,!1),this.setTag(BattleConst.TAG_ALL_END,!1),c.action(),c.isDone)){s=this.animationControlList.indexOf(c);this.animationControlList.splice(s,1)}}this.makeBattleAnim()}},e.prototype.setPlanSequenceList=function(t){this.planSequenceList=t},e.prototype.makeBattleAni=function(){this.isTag(BattleConst.TAG_IS_BATTLE_SEE)&&(this.isTag(BattleConst.TAG_ALL_END)||this.closePlayerAnimation());var t=BattleInputHandler.instance.getSequenceList();t&&t.length>0&&this.setPlanSequenceList(t),this.battle.cleanAniControlList()},e.prototype.makeBattleAnim=function(){if(null!=this.planSequenceList&&0!=this.planSequenceList.length&&this.isTag(BattleConst.TAG_PLAYER_PLAN_END)){var t=this.planSequenceList.shift();if(!(t.length<=0)){for(var n,i=0,o=new Array(Battle.MAX_POS),a=0;a<Battle.MAX_POS;a++)o[a]=0;for(var r=0,s=t;r<s.length;r++){var l=s[r];if(null!=l){var _=l.byte0;switch(l.type){case Control.TYPE_BATTLE_SKILL:n=AnimationControl.createBattleSkill(this,l),this.addPlayerPlanControl(_,n),n.setDelay(i),i+=e.DEFAULT_DELAY_TIME;break;case Control.TYPE_BATTLE_ESCAPE:n=AnimationControl.createBattlePlayerEscape(this,l),this.addPlayerPlanControl(_,n);break;case Control.TYPE_BATTLE_TARGET_EFFECT:var h=[];AnimationControl.getAniEffectByControl(this,l,o,h);for(a=0;a<h.length;a++){var u=h[a];this.addAnimationControl(u)}}}}this.setTag(BattleConst.TAG_ALL_END,!1)}}},e.prototype.isWin=function(){var t=!1;return null!=this.battle&&null!=xself&&(Battle.getPositionSide(xself.position)==Battle.LEFT_SIDE?1==this.battle.result&&(t=!0):2==this.battle.result&&(t=!0)),t},e.clean=function(){e._instance=null},e.BATTLE_TOP_HEIGHT=20,e.BATTLE_BOTTOM_HEIGHT=15,e.POS_MIN_WIDTH=30,e.POS_MIN_HEIGHT=20,e.SIDE_POS_MIN_WIDTH=2*e.POS_MIN_WIDTH,e.BOREDER_MIN_DIS=15,e.MAX_OFFSET_Y=6,e.END_COUNT_TIME_NOVICE=4e3,e.END_COUNT_TIME=8e3,e.BUFF_IMAGE_SET=10,e.BUFF_ATTR_ADD=0,e.BUFF_ATTR_DEL=1,e.BUFF_HIDE=2,e.BUFF_BLEED=3,e.BUFF_NEGATIVE_EFFECT=4,e.BUFF_POISON=5,e.BUFF_FIRE=6,e.BUFF_INVINCI=7,e.BUFF_IMMUNE=8,e.COORD_X=0,e.COORD_Y=1,e.POLL_INTERVAL=2e3,e.INTERVAL_NEXT_BATTLE_TIME=1e4,e.DEFAULT_DELAY_TIME=50,e}(egret.DisplayObjectContainer);__reflect(BattleView.prototype,"BattleView");var PosData=function(){this.posLeftHeight=0,this.posRightHeight=0,this.posLeftSpace=0,this.posRightSpace=0};__reflect(PosData.prototype,"PosData");var DoAttack=function(){function t(e,n,i,o,a,r,s,l){this.step=t.STEP_INIT,this.battleView=e,this.actorPlayer=n,this.targetList=i,this.animePos=o,this.animeStartType=a,this.effectList=l,r>0&&(this.effectSprite=AnimationControl.getEffectCloneSprite(e,r),null==this.effectSprite&&(this.effectSprite=SpriteHelper.createBattleEffSprite(r))),s>0&&(this.lastEffectSprite=AnimationControl.getEffectCloneSprite(e,s),null==this.lastEffectSprite&&(this.lastEffectSprite=SpriteHelper.createBattleEffSprite(s)))}return t.prototype.setSkillCheckSprite=function(t){this.skillCheckSprite||(this.skillCheckSprite=t)},t.prototype.doInit=function(){switch(Define.getAnimeStartType(this.animeStartType)){case Define.ANIME_TYPE_PHYSIC:this.actorPlayer.battleSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_ATTACK_ACTION,1);break;case Define.ANIME_TYPE_MAGIC:this.actorPlayer.battleSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_ATTACK_SKILL,1);break;case Define.ANIME_TYPE_USE_ITEM:this.actorPlayer.battleSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_ATTACK_USE,1)}},t.prototype.addTargetSkillEffect=function(){if(null!=this.targetList)for(var t=0;t<this.targetList.length;t++){var e=this.targetList[t];if(null!=e){var n=GameSprite.cloneSprite(this.effectSprite),i=GameSprite.cloneSprite(this.lastEffectSprite);this.setSkillCheckSprite(n),this.setSkillCheckSprite(i),AnimationControl.addBattleSprite(n,1,e),AnimationControl.addBattleSprite(i,1,e)}}},t.prototype.action=function(){if(null==this.battleView||null==this.actorPlayer||null==this.actorPlayer.battleSprite)return!0;switch(this.animePos==Define.SKILL_POS_STAND&&0==this.actorPlayer.battleSprite.getCurAnimationLoopTime()&&this.actorPlayer.battleSprite.setCurAnimationAsIdAndTime(GameSprite.ANIMATION_BATTLE_STAND,-1),this.step){case t.STEP_INIT:this.doInit(),this.step=t.STEP_CHECK_ACTOR_ANIME;break;case t.STEP_CHECK_ACTOR_ANIME:if(!t.isAnimationIDCheck(this.actorPlayer.battleSprite))break;this.addTargetSkillEffect(),(null==this.skillCheckSprite||Define.getAnimeStartType(this.animeStartType)==Define.ANIME_TYPE_USE_ITEM)&&this.setEffectListToBattle(),this.step=t.STEP_CHECK_SKILL_ANIME;break;case t.STEP_CHECK_SKILL_ANIME:if(!t.isAnimationIDCheck(this.skillCheckSprite))break;this.setEffectListToBattle(),this.step=t.STEP_END;break;case t.STEP_TRACE_ANIME:break;case t.STEP_END:if(this.actorPlayer.battleSprite.getCurAnimationLoopTime()<=0)return!0}return!1},t.prototype.setEffectListToBattle=function(){if(null!=this.battleView&&null!=this.effectList){for(var t=0;t<this.effectList.length;t++){var e=this.effectList[t];this.battleView.addAnimationControl(e)}this.effectList=null}},t.isAnimationIDCheck=function(t){if(null==t)return!0;var e=!1,n=t.getCurAnimation();if(null==n)e=!0;else{var i=n.getCheckID();(i>=0&&n.getCurFrame()==i||n.getLoopTime()<=0)&&(e=!0)}return e},t.STEP_INIT=0,t.STEP_CHECK_ACTOR_ANIME=1,t.STEP_CHECK_SKILL_ANIME=2,t.STEP_TRACE_ANIME=3,t.STEP_END=4,t}();__reflect(DoAttack.prototype,"DoAttack");var EffectNum=function(t){function e(e,n,i,o,a,r){var s=t.call(this)||this;return s.image=null,s.setIndex=0,s.startIndex=0,s.hSpeed=0,s.vSpeed=0,s.xMove=0,s.yMove=0,s.endCount=0,s.battleView=BattleView.instance,s.numPlayer=e,s.setIndex=n,n>=0&&(s.startIndex=i),s.numString=o,s.hSpeed=a*xhdRatio,s.vSpeed=r*xhdRatio,s}return __extends(e,t),e.prototype.initImgs=function(){var t=0,e=0;if(this.setIndex>=0){var n=nato.findTextureForSheet(this.setIndex,0),i=n.textureWidth;e=n.textureHeight;for(var o=this.numString.length,a=0;o>a;a++){var r=parseInt(this.numString.charAt(a)),s=new egret.Bitmap;s.texture=nato.findTextureForSheet(this.setIndex,r),s.x=i*a,t+=i,this.addChild(s)}}this.image&&(this.image.x=this.image.width/2,this.addChildAt(this.image,0)),this.anchorOffsetX=.5*t,this.anchorOffsetY=.5*e,this.x=this.drawX,this.y=this.drawY,this.battleView.addChild(this),this.setScale(nato.mapRatio)},e.prototype.setScale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.getNumberString=function(){return this.numString},e.prototype.setDrawXY=function(t,e){this.drawX=t,this.drawY=e},e.prototype.setImage=function(t){return null==t?void(this.image=null):(this.image=e.getBitmap(),this.image.scaleX=t.scaleX,this.image.scaleY=t.scaleY,this.image.anchorOffsetX=t.anchorOffsetX*xhdRatio,this.image.anchorOffsetY=t.anchorOffsetY*xhdRatio,void(this.image.texture=t.texture))},e.getBitmap=function(){return e.bitmapPool.length>0?e.bitmapPool.pop():new egret.Bitmap},e.prototype.setDrawPosition=function(t){if(null!=t){var e=t.battleSprite;if(null!=e){var n=e.x,i=e.y-MapSetup.GRID_HEIGHT;(this.setIndex==ImageSet.IMG_SET_NUMBER_BATTLE_ADD||this.setIndex==ImageSet.IMG_SET_NUMBER_BATTLE_MP)&&(i=e.y-GameSprite.SPRITE_HEIGHT*xhdRatio),this.setDrawXY(n,i)}}},e.prototype.action=function(){if(this.numPlayer&&(this.setDrawPosition(this.numPlayer),this.initImgs(),this.numPlayer=null),this.xMove+=this.hSpeed,this.setIndex>=0&&this.numString&&0!=this.hSpeed){var t=nato.findTextureForSheet(this.setIndex,this.startIndex).textureWidth*this.numString.length>>1;if(this.hSpeed>0){var e=Main.instance.stage.stageWidth;this.drawX+this.xMove+t*xhdRatio>=e&&(this.hSpeed=-2*this.hSpeed)}else{0>=this.drawX+this.xMove-t*xhdRatio&&(this.hSpeed=-2*this.hSpeed)}}if(this.yMove+=this.vSpeed,this.endCount>0){if(this.vSpeed++,this.endCount--,0==this.endCount)return this.destroy(),!0}else{var n=12;0==this.hSpeed&&(n=0),this.yMove>=n?(this.vSpeed=-this.vSpeed/2,this.endCount=4):this.vSpeed++}return this.draw(),!1},e.prototype.draw=function(){var t=this.drawX+this.xMove,e=this.drawY+this.yMove;return this.numString,this.x=t,void(this.y=e)},e.prototype.destroy=function(){this.battleView.contains(this)&&this.battleView.removeChild(this),null!=this.image&&e.bitmapPool.push(this.image)},e.bitmapPool=[],e}(egret.DisplayObjectContainer);__reflect(EffectNum.prototype,"EffectNum");var MonsterAI=function(){function t(){this.conType=null,this.conValue=null,this.msg=null,this.skill1=null,this.skill2=null,this.targetType=null,this.targetPos=0}return t.prototype.getBattleSkill=function(t,e){if(null==this.conType||this.conType.length<=0)return null;var n=this.conType.length;this.targetPos=-1,e.message=null;for(var i=0;n>i;i++)if(this.isValidConAI(t,e,i)){var o=this.getConSkill(t,i);if(!o||o.type!=Define.SKILL_TYPE_ROUND)return this.targetPos=this.selectAttackTarget(t,e,i),e.message=this.msg[i],o}return null},t.prototype.getAutoSkill=function(t,e){if(null==this.conType||this.conType.length<=0)return null;var n=this.conType.length;e.message=null;for(var i=0;n>i;i++)if(this.isValidConAI(t,e,i)){var o=this.getConSkill(t,i);if(null!=o&&o.type==Define.SKILL_TYPE_ROUND&&!(o.useMP>e.get(ModelConst.MP))&&o.isEnoughHP(e))return e.message=this.msg[i],o}return null},t.prototype.isValidConAI=function(t,e,n){var i=0,o=t.getLeftPosNum();switch(this.conType[n]){case Define.CONDITION_NONE:return!0;case Define.CONDITION_HP_BELOW:return 100*e.get(ModelConst.HP)/e.get(ModelConst.HPMAX)<this.conValue[n];case Define.CONDITION_HP_HIGH:return 100*e.get(ModelConst.HP)/e.get(ModelConst.HPMAX)>this.conValue[n];case Define.CONDITION_HELP_RATE:return t.randInt(100)<this.conValue[n];case Define.CONDITION_ROUND:return this.conValue[n]<=t.round;case Define.CONDITION_PLAYER_COUNT:return 1==Battle.isLeftSide(e.position)&&(i=Battle.LEFT_MAX_POS,o=Battle.MAX_POS),this.conValue[n]<=t.getActivePlayerNum(i,o,!1);case Define.CONDITION_MONSTER_COUNT:return Battle.isLeftSide(e.position)||(i=Battle.LEFT_MAX_POS,o=Battle.MAX_POS),this.conValue[n]<=t.getActivePlayerNum(i,o,!1)}return!1},t.prototype.getConSkill=function(t,e){if(null==this.skill1||this.skill1.length<=0)return null;if(null==this.skill2||this.skill2.length<=0)return null;var n=this.skill1[e],i=this.skill2[e];return n&&i?0==(1&t.random.nextInt())?n:i:n||i},t.prototype.selectAttackTarget=function(e,n,i){if(null==e)return-1;if(null==n)return-1;if(Tool.isArrayIndexOutOfBounds(i,this.targetType))return-1;var o=this.targetType[i];switch(o){case Define.AI_ESCAPE:return t.TARGET_ESCAPE;case Define.AI_HATE_MIN:case Define.AI_HATE_MAX:case Define.AI_HP_MIN_ENEMY:case Define.AI_HP_MAX_ENEMY:case Define.AI_SPEED_MIN_ENEMY:case Define.AI_SPEED_MAX_ENEMY:return t.selectValueTarget(e,n,o,!0);case Define.AI_HP_MIN_FRIEND:case Define.AI_HP_MAX_FRIEND:case Define.AI_SPEED_MIN_FRIEND:case Define.AI_SPEED_MAX_FRIEND:return t.selectValueTarget(e,n,o,!1);case Define.AI_RAND_ENEMY:return t.selectRandTarget(e,n,!0);case Define.AI_RAND_FRIEND:return t.selectRandTarget(e,n,!1);case Define.AI_SELF:return n.position;case Define.AI_RAND_FRIEND_DEAD:return t.selectRandDeadFriend(e,n);case Define.AI_RAND_ALL_ALIVE:return t.selectRandActivePlayer(e,n)}return-1},t.selectRandActivePlayer=function(t,e){for(var n=Battle.MAX_POS,i=new Array(Battle.MAX_POS),o=0,a=0;n>a;a++){var r=t.getPlayerByPos(a);t.isValidBattlePlayer(r)&&r.position!=e.position&&(Tool.isArrayIndexOutOfBounds(o,i)||(i[o]=r.position,o++))}if(0>=o)return 0;if(1==o)return i[0];var s=t.randRange(0,o-1);return null==i[s]?0:i[s]},t.selectRandDeadFriend=function(t,e){var n=0,i=t.getLeftPosNum();Battle.isLeftSide(e.position)||(n=Battle.LEFT_MAX_POS,i=Battle.MAX_POS);for(var o=new Array(Battle.MAX_POS),a=0,r=n;i>r;r++){var s=t.getPlayerByPos(r);null!=s&&(s.isBattleStatus(Player.BSTATUS_ESCAPE)||s.isDead()&&(Tool.isArrayIndexOutOfBounds(a,o)||(o[a]=s.position,a++)))}if(0>=a)return n;if(1==a)return o[0];var l=t.randRange(0,a-1);return null==o[l]?n:o[l]},t.selectValueTarget=function(t,e,n,i){var o=0,a=t.getLeftPosNum();i?Battle.isLeftSide(e.position)&&(o=Battle.LEFT_MAX_POS,a=Battle.MAX_POS):Battle.isLeftSide(e.position)||(o=Battle.LEFT_MAX_POS,a=Battle.MAX_POS);for(var r=-1,s=-1,l=o;a>l;l++){var _=t.getPlayerByPos(l);if(t.isValidBattlePlayer(_)){var h=0;switch(n){case Define.AI_HATE_MIN:case Define.AI_HATE_MAX:h=_.get(ModelConst.ARGO);break;case Define.AI_HP_MIN_ENEMY:case Define.AI_HP_MAX_ENEMY:case Define.AI_HP_MIN_FRIEND:case Define.AI_HP_MAX_FRIEND:h=_.get(ModelConst.HP);break;case Define.AI_SPEED_MIN_ENEMY:case Define.AI_SPEED_MAX_ENEMY:case Define.AI_SPEED_MIN_FRIEND:case Define.AI_SPEED_MAX_FRIEND:h=_.get(ModelConst.SPEED)}-1==r&&(s=l,r=h),(n==Define.AI_HATE_MIN||n==Define.AI_HP_MIN_ENEMY||n==Define.AI_SPEED_MIN_ENEMY||n==Define.AI_HP_MIN_FRIEND||n==Define.AI_SPEED_MIN_FRIEND)&&r>h&&(s=l,r=h),(n==Define.AI_HATE_MAX||n==Define.AI_HP_MAX_ENEMY||n==Define.AI_SPEED_MAX_ENEMY||n==Define.AI_HP_MAX_FRIEND||n==Define.AI_SPEED_MAX_FRIEND)&&h>r&&(s=l,r=h)}}return s},t.selectRandTarget=function(t,e,n){var i=0,o=t.getLeftPosNum();n?Battle.isLeftSide(e.position)&&(i=Battle.LEFT_MAX_POS,o=Battle.MAX_POS):Battle.isLeftSide(e.position)||(i=Battle.LEFT_MAX_POS,o=Battle.MAX_POS);for(var a=new Array(Battle.MAX_POS),r=0,s=i;o>s;s++){var l=t.getPlayerByPos(s);t.isValidBattlePlayer(l)&&(Tool.isArrayIndexOutOfBounds(r,a)||(a[r]=l.position,r++))}if(0>=r)return i;if(1==r)return a[0];var _=t.randRange(0,r-1);return null==a[_]?i:a[_]},t.fromBytes=function(e,n){var i=new t;i.id=e.getShort();var o=e.getByte();i.conType=new Array(o),i.conValue=new Array(o),i.msg=new Array(o),i.skill1=new Array(o),i.skill2=new Array(o),i.targetType=new Array(o);for(var a=0;o>a;a++)i.conType[a]=e.getByte(),i.conValue[a]=e.getInt(),i.msg[a]=e.getString(),i.skill1[a]=GameWorld.getSkillById(n,e.getShort(),e.getByte()),i.skill2[a]=GameWorld.getSkillById(n,e.getShort(),e.getByte()),i.targetType[a]=e.getByte();return i},t.TARGET_ESCAPE=100,t}();__reflect(MonsterAI.prototype,"MonsterAI");var PlayerAnimation=function(){function t(t,e,n,i,o,a,r){this.isDie=!1,this.isInit=!0,this.isMagicField=!1,this.counter=0,this.battle=t,this.player=e,this.fromAniID=n,this.toAniID=i,this.loopTime=o,this.offsetX=a,this.isDie=r}return t.prototype.action=function(){if(null==this.player)return!0;var e=this.player.battleSprite;if(null==e)return!0;if(this.isInit){if(!e.setCurAnimationAsId(this.fromAniID)&&this.loopTime>0&&(this.loopTime=1),e.setCurAnimationLoopTime(this.loopTime),this.loopTime<=0)return!0;if(this.initAnimationID=e.getCurAniID(),e.setSpritePosition(e.x+this.offsetX,e.y),this.fromAniID==GameSprite.ANIMATION_BATTLE_ATTACK_HURT){var n=this.isMagicField?this.battle.effMagicFieldSprite:this.battle.effHitSprite;n.name=this.isMagicField?"魔法护盾":"打击光效";var i=GameSprite.cloneSprite(n);i&&(AnimationControl.addBattleSprite(i,1,this.player),i.setSpritePosition(e.x,e.y-e.getHeight()/2+i.getHeight()/2+5))}this.isInit=!1}var o=e.getCurAniID();return 0>o||this.initAnimationID<0||o!=this.initAnimationID?(e.setSpritePosition(e.x-this.offsetX,e.y),!0):e.getCurAnimationLoopTime()<=0?(this.toAniID!=GameSprite.ANIMATION_NONE&&e.setCurAnimationAsIdAndTime(this.toAniID,-1),e.setSpritePosition(e.x-this.offsetX,e.y),!0):(this.counter++,this.counter>t.MAX_ANIMATION_COUNT)},t.MAX_ANIMATION_COUNT=30,t}();__reflect(PlayerAnimation.prototype,"PlayerAnimation");var Param=function(){function t(e,n){this._browser=e,this._param=n,t._map[e]=this}return Object.defineProperty(t.prototype,"browser",{get:function(){return this._browser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"countForDrawPerFrame",{get:function(){return this._param.countForDrawPerFrame},enumerable:!0,configurable:!0}),t.get=function(){var e=nato.getBrowser(),n=t._map[e];return null==n&&((n=t._map.default)._browser=e),n},t._map={},t}();__reflect(Param.prototype,"Param");var safariParam=new Param("safari",{countForDrawPerFrame:1}),defaultParam=new Param("default",{countForDrawPerFrame:2}),TargetSelectPanel=function(){function t(t,e){this.parentBattlePanel=t,null!=t&&(this.battleView=t.battleView,this.battle=t.battle),this.areaType=e}return t.prototype.getTargetPos=function(){return this.targetPos},t.prototype.setTargetPos=function(t){this.targetPos=t},t.prototype.isFinshSelect=function(){return this._isFinshSelect},t.prototype.setFinshSelect=function(t){this._isFinshSelect=t},t.prototype.setSelectItem=function(t){this.selectItem=t},t.prototype.setSelectSkill=function(t){this.selectSkill=t},t.prototype.init=function(){var e=this.parentBattlePanel.getCursor();if(this.initCursor(e,this.areaType,!0)!=t.INIT_SUCCESS){var n=this.parentBattlePanel.getOrderPlayer(),i=0;this.parentBattlePanel&&n&&this.battle&&(i=this.battle.searchAICursor(n,this.areaType)),this.initCursor(i,this.areaType,!1)}},t.prototype.handlerMouse=function(t,e){if(-1!=t&&-1!=e){for(var n,i,o=!1,a=0;a<Battle.MAX_POS;a++){var r=this.battleView.getPosition(a,BattleView.COORD_X),s=this.battleView.getPosition(a,BattleView.COORD_Y);Battle.isLeftSide(a)?(n=BattleView.POS_MIN_WIDTH+this.battleView.posData.posLeftSpace,i=this.battleView.posData.posLeftHeight):(n=BattleView.POS_MIN_WIDTH+this.battleView.posData.posRightSpace,i=this.battleView.posData.posRightHeight);var l=r-n/2,_=s-i;if(Tool.rectIn(l,_,n,i,t,e)){this.dealCursorLogic(a),o=!0;break}}return o}},t.prototype.dealCursorLogic=function(t){this.parentBattlePanel.getCursor()==t?1==this.parentBattlePanel.isCursorEnable()&&this.setFinshSelect(!0):this.initCursor(t,this.areaType,!1)},t.prototype.initCursor=function(e,n,i){var o=this.parentBattlePanel.getOrderPlayer();if(null==o)return t.INIT_FAIL;var a=null;if(null!=this.battle)if(n==Define.SKILL_AREA_MY_OWNER){var r=this.battle.getPetOwnerPos(o);r>=0&&(a=[r])}else a=this.battle.getSelectArea(o.position,e,n);var s=this.isCursorEnable(a);return 1==i&&0==s?t.INIT_FAIL:(this.parentBattlePanel.setCursorEnable(s),this.parentBattlePanel.setCursor(e),this.setTargetPos(a),t.INIT_SUCCESS)},t.prototype.isCursorEnable=function(t){if(null==t)return!1;for(var e=this.parentBattlePanel.getOrderIndex(),n=0,i=0;i<t.length;i++){var o=t[i],a=this.battle.getPlayerByPos(o);if(null!=a){if(this.selectItem&&e==BattleInputHandler.ORDER_ITEM){if(a.isDead()&&0==this.selectItem.isRebornItem())continue}else if(this.selectSkill&&e==BattleInputHandler.ORDER_SKILL){if(0==Skill.isCanUse(this.parentBattlePanel.getOrderPlayer(),this.selectSkill,null))continue;if(a.isBattleStatus(Player.BSTATUS_ESCAPE))continue;if(a.isDead()&&!this.selectSkill.isRebornSkill())continue}else if(e==BattleInputHandler.ORDER_ATTACK){if(0==this.battle.isValidBattlePlayer(a))continue;var r=this.parentBattlePanel.getOrderPlayer();if(null!=r&&a.position==r.position)continue}else if(e==BattleInputHandler.ORDER_INFO&&0==this.battle.isValidBattlePlayer(a))continue;n++}}return!(0>=n)},t.INIT_SUCCESS=1,t.INIT_FAIL=-1,t}();__reflect(TargetSelectPanel.prototype,"TargetSelectPanel");var PayDescribe=function(){function t(){}return t.prototype.isCanGet=function(){return this.iscanType==t.PAYDESCRIBE_CANGET},t.prototype.isHasGet=function(){return this.iscanType==t.PAYDESCRIBE_HASGET},t.prototype.isNotReach=function(){return this.iscanType==t.PAYDESCRIBE_NOT_REACH},t.processPayDes=function(e){var n=new t;n.itemType=new Array,n.itemfalsh=new Array,n.achievementInfo=new Array,n.chargeMoney=e.getInt(),n.topDesc=e.getString(),n.bottomDesc=e.getString();var i=e.getBoolean();i&&(n.mypet=MyPet.fromBytesInfo(e,xself)),(i=e.getBoolean())&&(n.item1=new ItemData,ItemData.fromBytesAtts2(n.item1,e),n.item1.durability=n.item1.durMax),(i=e.getBoolean())&&(n.item2=new ItemData,ItemData.fromBytesAtts2(n.item2,e),n.item2.durability=n.item2.durMax);var o=e.getByte();if(0!=o)for(var a=0;o>a;a++){var r=new t;r.achieveID=e.getInt(),r.category=e.getByte(),r.gainValue=e.getInt(),n.achievementInfo.push(r)}n.achieveMoney=e.getInt(),n.reqLevel=e.getByte(),n.count=e.getInt(),n.exp=e.getInt();var s=e.getInt();n.paydescribeList=new Array;for(var l=0;s>l;l++){var _=new t;_.iscanType=e.getByte(),_.achieveID=e.getShort(),_.category=e.getByte(),e.getBoolean()&&(_.item=new ItemData,_.item.quantity=e.getShort(),ItemData.fromBytesAtts2(_.item,e),_.item.durability=_.item.durMax),n.paydescribeList.push(_)}return n},t.doPayDesList=function(){var t=MsgHandler.createPayDescribe();nato.Network.sendCmd(t,(function(e){null!=e&&(t.getBoolean()&&this.processPayDes(t))}),this)},t.PAYDESCRIBE_CANGET=1,t.PAYDESCRIBE_HASGET=2,t.PAYDESCRIBE_NOT_REACH=3,t}();__reflect(PayDescribe.prototype,"PayDescribe");var PayInfo=function(){function t(){this.opeType=t.CHARGE_TYPE_ZHIFUBAO,this.ratio=1,this.linkId="",this.needht={},this.Hashtable={}}return t.prototype.setRemark=function(t){t.indexOf(";")>0?(this.isRecommend="1"==t.split(";")[0],this.chargeCode=t.split(";")[1]):this.isRecommend="1"==t},t.prototype.getIsRecommend=function(){return this.isRecommend},t.prototype.getChargeCode=function(){return this.chargeCode},t.prototype.getRemark=function(){return this.remark},t.prototype.getGainmoney1=function(){return this.gainMoney1},t.prototype.getGainmoney2=function(){return this.gainMoney2},t.prototype.getMoney=function(){return this.money},t.prototype.getRatio=function(){return this.ratio},t.prototype.getOpeType=function(){return this.opeType},t.prototype.getGoodsId=function(){return this.id},t.prototype.getOrderNum=function(){return this.orderNum},t.prototype.getInfo=function(){return this.info},t.prototype.getTitle=function(){return this.title},t.prototype.getAwardId=function(){return this.awardId},t.fromBytes=function(e){var n=new t;return n.opeType=e.getByte(),n.id=e.getInt(),n.money=e.getInt(),n.title=e.getString(),n.info=e.getString(),n.setRemark(e.getString()),n.opeType==t.CHARGE_TYPE_ZHIFUBAO&&(n.aliInfo=e.getString()),n},t.getPayList=function(e){if(void 0===e&&(e=!1),Sdk.canCharge){var n=new nato.Message(ProtocolDefine.CG_NEWBILL_LIST);n.putInt(1),n.putInt(0),PanelManager.openWaitForServer(),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),null==n)return null;var i=new t,o=(n.getInt(),n.getInt());i.billList=new Array;for(var a=0;o>a;a++){for(var r=new t,s=n.getInt(),l=0;s>l;l++){var _=n.getString(),h=n.getString();Tool.isNullText(_)||Tool.isNullText(h)||("openType"==_?r.opeType=parseInt(h):"defineId"==_?r.id=Tool.parseInt(h):"title"==_?r.title=h:"info"==_?r.info=h:"money"==_?r.money=Tool.parseInt(h):"gainMoney1"==_?r.gainMoney1=Tool.parseInt(h):"gainMoney2"==_?r.gainMoney2=Tool.parseInt(h):"orderNum"==_?r.orderNum=Tool.parseInt(h):"remark"==_?r.setRemark(h):"processId"==_?r.processId=Tool.parseInt(h):"awardId"==_?r.awardId=Tool.parseInt(h):"awardNum"==_?r.awardNum=Tool.parseInt(h):"ratio"==_&&(r.ratio=Number(h)))}i.billList.push(r)}i.billList=i.billList.sort(t.sortByOrder),7500==xchannel?PanelManager.openChargePanelForWanba(i,e):PanelManager.openChargePanel(i,e)}),this)}},t.sortByOrder=function(t,e){return t.isRecommend>e.isRecommend?-1:t.isRecommend<e.isRecommend?1:t.orderNum<e.orderNum?-1:t.orderNum>e.orderNum?1:0},t.doChargeMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_NEWBILL_BILL);i.putInt(t),i.putInt(e);var o="{}";n&&(o=JSON.stringify(n)),i.putString(o);nato.Network.sendCmd(i,(function(t){if(PanelManager.closeWaitForServer(),null!=t){if(0>t.getInt())return void AlertPanel.alertCommon(t.getString());var e=(t.getString(),t.getInt(),t.getString());Sdk.pay(e)}}),this),PanelManager.openWaitForServer()},t.getTestPayInfo=function(){var e=new t;e.billList=[];for(var n=[1,2,6,12,30,98,198,398],i=0;i<n.length;i++){var o=new t;o.opeType=1,o.orderNum=i,o.id=i;var a=n[i];o.money=a,o.title=a+"元",o.info=50*a+"黄金",o.gainMoney1=50*a*.7,o.gainMoney2=50*a*.3,o.isRecommend=30==a,e.billList.push(o)}return PanelManager.openChargePanel(e,!0),e},t.CHARGE_TYPE_ZHIFUBAO=2,t.isMo9AutoPayOpen=!1,t}();__reflect(PayInfo.prototype,"PayInfo");var QQBrowserLogin=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.group_layout.touchEnabled=!1,nato.fitBG(this),this.btn_qq.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQQLogin,this),this.btn_weixin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onWXLogin,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onQQLogin=function(){return Sdk.xsdk.loginWithType("qq"),Sdk.xsdk.param&&Sdk.xsdk.param.isOnCheck?void(Sdk.xsdk.param.isOnCheck=!1):void PanelManager.closeQQBroswerLoginPanel()},e.prototype.onWXLogin=function(){return Sdk.xsdk.loginWithType("wx"),Sdk.xsdk.param&&Sdk.xsdk.param.isOnCheck?void(Sdk.xsdk.param.isOnCheck=!1):void PanelManager.closeQQBroswerLoginPanel()},e.prototype.setData=function(t,e){this.loginTypes=t,this.usedloginType=e,null==this.usedloginType&&(this.img_qq.visible=!1,this.img_wx.visible=!1),this.update()},e.prototype.update=function(){if(0!=this.init&&null!=this.loginTypes&&0!=this.loginTypes.length){if(null!=this.loginTypes&&1==this.loginTypes.length)return Sdk.xsdk.param.showCheckBtn=!1,void("qq"==this.loginTypes[0]?this.onQQLogin():"wx"==this.loginTypes[0]&&this.onWXLogin());this.loginTypes[0]&&(this.btn_qq.visible="qq"==this.loginTypes[0],this.btn_weixin.visible="wx"==this.loginTypes[0]),this.loginTypes[1]&&("qq"==this.loginTypes[1]?this.btn_qq.visible=!0:"wx"==this.loginTypes[1]&&(this.btn_weixin.visible=!0)),null!=this.usedloginType&&(("qq"==this.usedloginType[0]||"qq"==this.usedloginType[1])&&(this.img_qq.visible=!0),("wx"==this.usedloginType[0]||"wx"==this.usedloginType[1])&&(this.img_wx.visible=!0))}},e}(ComponentBase);__reflect(QQBrowserLogin.prototype,"QQBrowserLogin");var Sdk=function(){function t(){}return Object.defineProperty(t,"noneSdk",{get:function(){return"NoneSdk"==egret.getQualifiedClassName(t.xsdk)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"canLogin",{get:function(){return null==t.param||null==t.param.canLogin},enumerable:!0,configurable:!0}),Object.defineProperty(t,"canCharge",{get:function(){return null==t.param||null==t.param.canCharge},enumerable:!0,configurable:!0}),t.start=function(e,n,i,o){t.channel=n;var a=t.prefix+"/xres.do?gameid="+e+"&chanid="+n+"&ts="+Math.random(),r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(a,egret.HttpMethod.POST),r.send(),r.addEventListener(egret.Event.COMPLETE,(function(n){var a=JSON.parse(n.currentTarget.response);return 0!=a.result?(xchannel=1100,void t.start(e,xchannel,i,o)):(t.chanName=a.name,t.param=JSON.parse(a.param),void t.loadCode(a.urls,i,o))}),null)},t.loadCode=function(e,n,i){return null==t.loadScripts?(alert("Sdk.loadScripts is null"),void n.call(i)):null==e||0==e.length?void t.onload((function(){n&&n.call(i)}),this):void t.loadScripts(e,(function(){t.onload((function(){n&&n.call(i)}),this)}))},t.onload=function(e,n){t.xsdk.init(e,n)},t.getServiceQQ=function(){return t.param&&null!=t.param.qq_service?t.param.qq_service:t.qq_service},t.getServiceQQgroup=function(){return t.param&&null!=t.param.qq_group?t.param.qq_group:t.qq_group},t.setServiceQQ=function(e){t.qq_service=e},t.setServiceQQgroup=function(e){t.qq_group=e},t.getGMInfo=function(){return t.param&&null!=t.param.gm_info?t.param.gm_info:""},t.desktop=function(){var e=this.entry,n=e.lastIndexOf("/");return e.substring(0,n)+"/desktop/"+t.channel+".png"},t.preload=function(t,e){},t.showLogin=function(t,e){PanelManager.openQQBrowserLoginPanel(t,e)},t.logout=function(t){Login.instance.logout()},t.clean=function(){xworld.stopUpdate(),Main.instance.clearAll()},t.openLogin=function(){return t.canLogin?(0==xhd&&(Main.instance.hdStage(),PanelManager.waitForServerPanel=null),null==LoadManager.loadingUI&&(LoadManager.loadingUI=new LoadingUI,nato.attachSkin(LoadManager.loadingUI)),Main.instance.addUI(LoadManager.loadingUI),void LoadManager.loadingUI.showLoginRegion()):void alert("渠道异常，登录失败！")},t.channelLogin=function(t){var e=MsgHandler.createUserLoginMsg(JSON.stringify(t),nato.getBrowser());Login.instance.sendLogin(e)},t.channelShare=function(t,e){MsgHandler.createChannelShareMsg(t,e)},t.pay=function(e){var n=JSON.parse(e);t.xsdk.pay(n.goodsid,n.name,n.money,n.orderid,n.ext,n)},t.getPlayerID=function(){return xself?xself.getId()+"":""},t.getPlayName=function(){return xself?xself.getName():""},t.getChannelRoleID=function(){return GameWorld.photoIp},t.getServerID=function(){return ServerInfo.currentSelectServerInfo.id},t.getServerName=function(){return ServerInfo.currentSelectServerInfo.name},t.getPlayerLevel=function(){return xself?xself.getLevel():0},t.order=function(t,e,n){PayInfo.doChargeMsg(t,e,n)},t.getGameUrl=function(){return location.href.substr(0,location.href.indexOf("?"))+"?xameid=1000&xhannel="+this.channel},t.analyseParams=function(){var t=new QueryString;return t.parse()?t:null},t.getServer=function(){return ServerInfo.getSelectServer().id},t.openPcPayView=function(t,e){AlertPanel.alert("充值确认","点击确定按钮，继续充值!",t,e)},t.addTips=function(t,e,n){WorldMessage.addTips(t,e,n)},t.closeQQBroswerLoginPanel=function(){PanelManager.closeQQBroswerLoginPanel()},t.prefix="https://sdker.gamehz.cn",t.channel=1100,t.serverid=1,t.xsdk=new NoneSdk,t.qq_group="",t.qq_service="",t}();__reflect(Sdk.prototype,"Sdk");var md5=function(){function t(){this.hexcase=0,this.b64pad=""}return t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,n){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),n)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var n=this.rstr2binl(t);n.length>16&&(n=this.binl_md5(n,8*t.length));for(var i=Array(16),o=Array(16),a=0;16>a;a++)i[a]=909522486^n[a],o[a]=1549556828^n[a];var r=this.binl_md5(i.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(o.concat(r),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(t){this.hexcase=0}for(var e,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",o=0;o<t.length;o++)e=t.charCodeAt(o),i+=n.charAt(e>>>4&15)+n.charAt(15&e);return i},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(t){this.b64pad=""}for(var e="",n=t.length,i=0;n>i;i+=3)for(var o=t.charCodeAt(i)<<16|(n>i+1?t.charCodeAt(i+1)<<8:0)|(n>i+2?t.charCodeAt(i+2):0),a=0;4>a;a++)e+=8*i+6*a>8*t.length?this.b64pad:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-a)&63);return e},t.prototype.rstr2any=function(t,e){var n,i,o,a,r,s=e.length,l=Array(Math.ceil(t.length/2));for(n=0;n<l.length;n++)l[n]=t.charCodeAt(2*n)<<8|t.charCodeAt(2*n+1);var _=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),h=Array(_);for(i=0;_>i;i++){for(r=Array(),a=0,n=0;n<l.length;n++)a=(a<<16)+l[n],a-=(o=Math.floor(a/s))*s,(r.length>0||o>0)&&(r[r.length]=o);h[i]=a,l=r}var u="";for(n=h.length-1;n>=0;n--)u+=e.charAt(h[n]);return u},t.prototype.str2rstr_utf8=function(t){for(var e,n,i="",o=-1;++o<t.length;)e=t.charCodeAt(o),n=o+1<t.length?t.charCodeAt(o+1):0,e>=55296&&56319>=e&&n>=56320&&57343>=n&&(e=65536+((1023&e)<<10)+(1023&n),o++),127>=e?i+=String.fromCharCode(e):2047>=e?i+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i},t.prototype.str2rstr_utf16le=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(255&t.charCodeAt(n),t.charCodeAt(n)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t.charCodeAt(n)>>>8&255,255&t.charCodeAt(n));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},t.prototype.binl2rstr=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var n=1732584193,i=-271733879,o=-1732584194,a=271733878,r=0;r<t.length;r+=16){var s=n,l=i,_=o,h=a;n=this.md5_ff(n,i,o,a,t[r+0],7,-680876936),a=this.md5_ff(a,n,i,o,t[r+1],12,-389564586),o=this.md5_ff(o,a,n,i,t[r+2],17,606105819),i=this.md5_ff(i,o,a,n,t[r+3],22,-1044525330),n=this.md5_ff(n,i,o,a,t[r+4],7,-176418897),a=this.md5_ff(a,n,i,o,t[r+5],12,1200080426),o=this.md5_ff(o,a,n,i,t[r+6],17,-1473231341),i=this.md5_ff(i,o,a,n,t[r+7],22,-45705983),n=this.md5_ff(n,i,o,a,t[r+8],7,1770035416),a=this.md5_ff(a,n,i,o,t[r+9],12,-1958414417),o=this.md5_ff(o,a,n,i,t[r+10],17,-42063),i=this.md5_ff(i,o,a,n,t[r+11],22,-1990404162),n=this.md5_ff(n,i,o,a,t[r+12],7,1804603682),a=this.md5_ff(a,n,i,o,t[r+13],12,-40341101),o=this.md5_ff(o,a,n,i,t[r+14],17,-1502002290),i=this.md5_ff(i,o,a,n,t[r+15],22,1236535329),n=this.md5_gg(n,i,o,a,t[r+1],5,-165796510),a=this.md5_gg(a,n,i,o,t[r+6],9,-1069501632),o=this.md5_gg(o,a,n,i,t[r+11],14,643717713),i=this.md5_gg(i,o,a,n,t[r+0],20,-373897302),n=this.md5_gg(n,i,o,a,t[r+5],5,-701558691),a=this.md5_gg(a,n,i,o,t[r+10],9,38016083),o=this.md5_gg(o,a,n,i,t[r+15],14,-660478335),i=this.md5_gg(i,o,a,n,t[r+4],20,-405537848),n=this.md5_gg(n,i,o,a,t[r+9],5,568446438),a=this.md5_gg(a,n,i,o,t[r+14],9,-1019803690),o=this.md5_gg(o,a,n,i,t[r+3],14,-187363961),i=this.md5_gg(i,o,a,n,t[r+8],20,1163531501),n=this.md5_gg(n,i,o,a,t[r+13],5,-1444681467),a=this.md5_gg(a,n,i,o,t[r+2],9,-51403784),o=this.md5_gg(o,a,n,i,t[r+7],14,1735328473),i=this.md5_gg(i,o,a,n,t[r+12],20,-1926607734),n=this.md5_hh(n,i,o,a,t[r+5],4,-378558),a=this.md5_hh(a,n,i,o,t[r+8],11,-2022574463),o=this.md5_hh(o,a,n,i,t[r+11],16,1839030562),i=this.md5_hh(i,o,a,n,t[r+14],23,-35309556),n=this.md5_hh(n,i,o,a,t[r+1],4,-1530992060),a=this.md5_hh(a,n,i,o,t[r+4],11,1272893353),o=this.md5_hh(o,a,n,i,t[r+7],16,-155497632),i=this.md5_hh(i,o,a,n,t[r+10],23,-1094730640),n=this.md5_hh(n,i,o,a,t[r+13],4,681279174),a=this.md5_hh(a,n,i,o,t[r+0],11,-358537222),o=this.md5_hh(o,a,n,i,t[r+3],16,-722521979),i=this.md5_hh(i,o,a,n,t[r+6],23,76029189),n=this.md5_hh(n,i,o,a,t[r+9],4,-640364487),a=this.md5_hh(a,n,i,o,t[r+12],11,-421815835),o=this.md5_hh(o,a,n,i,t[r+15],16,530742520),i=this.md5_hh(i,o,a,n,t[r+2],23,-995338651),n=this.md5_ii(n,i,o,a,t[r+0],6,-198630844),a=this.md5_ii(a,n,i,o,t[r+7],10,1126891415),o=this.md5_ii(o,a,n,i,t[r+14],15,-1416354905),i=this.md5_ii(i,o,a,n,t[r+5],21,-57434055),n=this.md5_ii(n,i,o,a,t[r+12],6,1700485571),a=this.md5_ii(a,n,i,o,t[r+3],10,-1894986606),o=this.md5_ii(o,a,n,i,t[r+10],15,-1051523),i=this.md5_ii(i,o,a,n,t[r+1],21,-2054922799),n=this.md5_ii(n,i,o,a,t[r+8],6,1873313359),a=this.md5_ii(a,n,i,o,t[r+15],10,-30611744),o=this.md5_ii(o,a,n,i,t[r+6],15,-1560198380),i=this.md5_ii(i,o,a,n,t[r+13],21,1309151649),n=this.md5_ii(n,i,o,a,t[r+4],6,-145523070),a=this.md5_ii(a,n,i,o,t[r+11],10,-1120210379),o=this.md5_ii(o,a,n,i,t[r+2],15,718787259),i=this.md5_ii(i,o,a,n,t[r+9],21,-343485551),n=this.safe_add(n,s),i=this.safe_add(i,l),o=this.safe_add(o,_),a=this.safe_add(a,h)}return[n,i,o,a]},t.prototype.md5_cmn=function(t,e,n,i,o,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(i,a)),o),n)},t.prototype.md5_ff=function(t,e,n,i,o,a,r){return this.md5_cmn(e&n|~e&i,t,e,o,a,r)},t.prototype.md5_gg=function(t,e,n,i,o,a,r){return this.md5_cmn(e&i|n&~i,t,e,o,a,r)},t.prototype.md5_hh=function(t,e,n,i,o,a,r){return this.md5_cmn(e^n^i,t,e,o,a,r)},t.prototype.md5_ii=function(t,e,n,i,o,a,r){return this.md5_cmn(n^(e|~i),t,e,o,a,r)},t.prototype.safe_add=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(md5.prototype,"md5");var Base64=function(){function t(){}return t.base64encode=function(t){for(var e,n,i,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,r=t.length,s="";r>a;){if(e=255&t.charCodeAt(a++),a==r){s+=o.charAt(e>>2),s+=o.charAt((3&e)<<4),s+="==";break}if(n=t.charCodeAt(a++),a==r){s+=o.charAt(e>>2),s+=o.charAt((3&e)<<4|(240&n)>>4),s+=o.charAt((15&n)<<2),s+="=";break}i=t.charCodeAt(a++),s+=o.charAt(e>>2),s+=o.charAt((3&e)<<4|(240&n)>>4),s+=o.charAt((15&n)<<2|(192&i)>>6),s+=o.charAt(63&i)}return s},t.base64decode=function(e){var n,i,o,a,r,s,l;for(s=e.length,r=0,l="";s>r;){do{n=t.base64DecodeChars[255&e.charCodeAt(r++)]}while(s>r&&-1==n);if(-1==n)break;do{i=t.base64DecodeChars[255&e.charCodeAt(r++)]}while(s>r&&-1==i);if(-1==i)break;l+=String.fromCharCode(n<<2|(48&i)>>4);do{if(61==(o=255&e.charCodeAt(r++)))return l;o=t.base64DecodeChars[o]}while(s>r&&-1==o);if(-1==o)break;l+=String.fromCharCode((15&i)<<4|(60&o)>>2);do{if(61==(a=255&e.charCodeAt(r++)))return l;a=t.base64DecodeChars[a]}while(s>r&&-1==a);if(-1==a)break;l+=String.fromCharCode((3&o)<<6|a)}return l},t.base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),t}();__reflect(Base64.prototype,"Base64");var StringBuffer=function(){function t(){this.content=""}return t.prototype.append=function(t){this.content+=t},t.prototype.toString=function(){return this.content},t.prototype.toTextFlow=function(){return Tool.convertDescToTextFlow(this.content)},t}();__reflect(StringBuffer.prototype,"StringBuffer");var Tool=function(){function t(){}return t.getTimeStrByMin=function(t,e){if(0>=t)return"";if((t=Math.floor(t))<this.MINUTE_IN_HOUR)return this.manageString(GameText.STR_MINUTE,t+"");var n=Math.floor(t/this.MINUTE_IN_DAY),i=Math.floor(t/this.MINUTE_IN_HOUR);if(n>0)return this.getTimeStrByHour(i,e);var o=t%this.MINUTE_IN_HOUR,a=this.manageString(GameText.STR_HOUR,i+"");return o>0&&e&&(a+=this.manageString(GameText.STR_MINUTE,o+"")),a},t.getTimeStrByHour=function(t,e){if(0>=t)return"";if((t=Math.floor(t))<this.HOUR_IN_DAY)return this.manageString(GameText.STR_HOUR,t+"");var n=Math.floor(t/this.HOUR_IN_DAY),i=Math.floor(t%this.HOUR_IN_DAY),o=this.manageString(GameText.STR_DAY,n+"");return i>0&&e&&(o+=this.manageString(GameText.STR_HOUR,i+"")),o},t.getTimeStrBySec=function(t){var e="",n=t-this.currentTime;if(n>0){var i=Math.floor(n/this.MILLIS_IN_DAY);i>0&&(e+=this.manageString(GameText.STR_DAY,i+""));var o=Math.floor((n-i*this.MILLIS_IN_DAY)/this.MILLIS_IN_HOUR);o>0&&(e+=this.manageString(GameText.STR_HOUR,o+""));var a=Math.floor((n-i*this.MILLIS_IN_DAY-o*this.MILLIS_IN_HOUR)/this.MILLIS_IN_MINUTE);a>0&&(e+=this.manageString(GameText.STR_MINUTE,a+""));var r=Math.floor((n-i*this.MILLIS_IN_DAY-o*this.MILLIS_IN_HOUR-a*this.MILLIS_IN_MINUTE)/this.MILLIS_IN_SECOND);r>0&&(e+=this.manageString(GameText2.STR_SECOND,r+""))}return e},t.getPlanTime=function(e){return e-t.currentTime},t.getPlanTimeStr=function(e){var n=t.getPlanTime(e),i="";if(n>0){var o=Math.floor(n/this.MILLIS_IN_HOUR);i+=o>=10?o.toString():"0"+o,i+=":";var a=Math.floor((n-o*this.MILLIS_IN_HOUR)/this.MILLIS_IN_MINUTE);i+=a>=10?a.toString():"0"+a,i+=":";var r=Math.floor((n-o*this.MILLIS_IN_HOUR-a*this.MILLIS_IN_MINUTE)/this.MILLIS_IN_SECOND);i+=r>=10?r.toString():"0"+r}return i},t.getPlanTimeString=function(e,n){void 0===n&&(n=!1);var i=t.getPlanTime(e);if(0>=i)return"";var o=Math.floor(i/1e3);if(0>=o&&(o=0),i%1e3!=0&&o++,n){var a=Math.floor(o/60);o%60!=0&&a++,o=a}return o.toString()},t.setKeyXY=function(t,e){return 65535&t|(65535&e)<<16},t.getXKey=function(e){return t.int2Short(65535&e)},t.getYKey=function(e){return t.int2Short(e>>16&65535)},t.int2Short=function(t){var e=new egret.ByteArray;return e.writeShort(t),e.position=0,e.readShort()},t.int2Byte=function(t){var e=new egret.ByteArray;return e.writeByte(t),e.position=0,e.readByte()},t.randByRange=function(e){return 0==e?0:Math.abs(t.random.nextInt()%e)},t.rand=function(e,n){var i=t.random.nextInt();return 0>i&&(i=-i),i%(n-e+1)+e},t.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xdebug&&console.log("-- deubg -- : ",t,e)},t.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xdebug&&console.error("--- error !!! --- : "+t+e.join(","))},t.isNullText=function(t){return null==t||"null"==t||""==t.trim()},t.copy=function(t){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length),document.execCommand("Copy"),document.body.removeChild(e),console.log("复制成功")},t.setBit=function(t,e,n){return t?n|=e:n&=~e,n},t.isBit=function(t,e){return 0!=(e&t)},t.getBitNum=function(e){for(var n=0,i=0;8>i;i++){var o=1<<i;t.isBit(o,e)&&(n+=1)}return n},t.isNumberString=function(e){if(1==t.isNullText(e))return!1;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(48>i||i>57)return!1}return!0},t.getFaceXY=function(t,e,n){var i=new egret.Point(t,e);switch(n){case 3:i.y--;break;case 0:i.x++;break;case 2:i.y++;break;case 1:i.x--;break;case 4:i.x--,i.y--;break;case 5:i.x--,i.y++;break;case 6:i.x++,i.y--;break;case 7:i.x++,i.y++}return i},t.getOffsetValue=function(t,e,n){var i;return e>n?(i=(n>>1)-t)>0?i=0:n-e>i&&(i=n-e):i=(n-e)/2,i},t.parseInt=function(t,e){return void 0===e&&(e=0),null==t||""==t?e:"number"==typeof t?Math.floor(t):"string"==typeof t?Number(t):e},t.getPointValue=function(t,e){if(0==t||0>=e)return t.toString();var n=t;0>t&&(n=-n);var i=String(n),o=i.length-e;if(o>0)i=i.substring(0,o)+"."+i.substring(o);else{o=-o;for(var a=0;o>a;a++)i="0"+i;i="0."+i}for(;!(i.length<=0);){var r=i.charAt(i.length-1);if("0"!=r){if("."==r){i=i.substring(0,i.length-1);break}break}i=i.substring(0,i.length-1)}return 0>t&&(i="-"+i),i},t.manageString=function(e,n,i){return void 0===i&&(i=!1),t.manageStringFull(e,"%U",n,i)},t.manageStringU=function(e,n,i){return void 0===i&&(i=!1),t.manageStringFull(e,"%U",n,i)},t.manageStringList=function(e,n){for(var i=e,o=0;o<n.length;o++)i=t.manageString(i,n[o]+"");return i},t.manageStringFull=function(t,e,n,i){var o=t;do{if(-1==o.indexOf(e))break;o=o.replace(e,n)}while(i);return o},t.manageStringColorU=function(t,e,n,i,o){if(void 0===i&&(i=-1),void 0===o&&(o=-1),t&&e&&""!=e&&n){var a=e.indexOf("%U");if(-1!=a){var r=e.substring(0,a),s=e.substring(a+2);""!=r&&t.push(TextFieldUtils.getTextFlowElement(r,o)),t.push(n,i),""!=s&&t.push(TextFieldUtils.getTextFlowElement(s,o))}}},t.convertDesc=function(e){if(t.isNullText(e))return e;var n=xself;return null==n?e:(e=t.manageStringFull(e,"{1}",n.getName(),!0),e=t.manageStringFull(e,"{2}",n.getSex()==Define.SEX_MALE?GameText.STR_SEUL:GameText.STR_HEROINE,!0),e=t.manageStringFull(e,"{3}",n.getSex()==Define.SEX_MALE?GameText.STR_CHILDE:GameText.STR_GIRL,!0),e=t.manageStringFull(e,"{4}",n.getSex()==Define.SEX_MALE?GameText.STR_BORTHER:GameText.STR_SISTER,!0),e=t.manageStringFull(e,"{5}",n.getSex()==Define.SEX_MALE?GameText.STR_KID:GameText.STR_SLAVE_GIRL,!0),e=t.manageStringFull(e,"{6}",n.getSex()==Define.SEX_MALE?GameText.STR_PRINCE:GameText.STR_PRINCESS,!0))},t.convertDescToTextFlow=function(t,e,n){if(void 0===e&&(e=-1),void 0===n&&(n=!0),n&&this.isNullText(t))return null;for(var i=[],o=[],a=this.getNextColorSignPosition(t);-1!=a;){var r=t.substring(0,a),s=-1;o.length>0&&(s=o[o.length-1]),i.push(TextFieldUtils.getTextFlowElement(r,s,-1,null,e,0)),"/c"==t.substr(a,2)?(s=Number("0x"+t.substring(a+2,a+8)),o.push(s),t=t.substring(a+8)):(o.pop(),t=t.substring(a+2)),a=this.getNextColorSignPosition(t)}i.push(TextFieldUtils.getTextFlowElement(t,-1,-1,null,e,0));for(var l=0;l<i.length;l++)""==i[l].text&&(i.splice(l,1),l--);return i},t.getNextColorSignPosition=function(t){var e=t.indexOf("/c"),n=t.indexOf("/p");return e>=0&&n>=0?n>e?e:n:n>=0?n:-1},t.convertTextFlowToString=function(t){if(null==t||0==t.length)return"";for(var e="",n=0;n<t.length;n++){var i=t[n];if(null!=i){var o=i.text,a=i.style;if(null!=a&&null!=a&&null!=a.textColor){var r=a.textColor;e+="/c"+ColorUtils.changeColorNumberToString(r)+o+"/p"}else e+=o}}return e},t.convertLastLinefeed=function(t){if(null==t||""==t)return t;for(var e=t.substring(t.length-1);"\n"==e;)e=(t=t.substring(0,t.length-1)).substring(t.length-1);return t},t.entropy=function(t,e,n){if(t!=e)if(n&&Math.abs(t-e)<30)t=e;else{t==(t=(3*t+2*e)/5)&&(t=e)}return t},t.getTime=function(){return(new Date).getTime()},Object.defineProperty(t,"currentTime",{get:function(){return(new Date).getTime()},enumerable:!0,configurable:!0}),t.isColliding=function(t,e,n,i,o,a,r,s){return!(o>=t+n)&&(!(t>=o+r)&&(!(a>=e+i)&&!(e>=a+s)))},t.rectIn=function(t,e,n,i,o,a){return!(t>o||e>a)&&(!(o>t+n)&&!(a>e+i))},t.nextSeed=function(e){return(e+1)%t.MAX_SEED_VALUE},t.printStackTrace=function(){var t=(new Error).stack;console.log(t)},t.sumValue=function(t,e,n,i){var o=t+e;return n>o&&(o=n),o>i&&(o=i),Math.floor(o)},t.getStarInfo=function(t,e){if(0>=e)return GameText.STR_LIST_NULL;var n="";if(0>t)return n;switch(t){case 0:n="☆";break;case 1:n="★";break;case 2:n="★★";break;case 3:n="★★★";break;case 4:n="★★★★";break;case 5:n="★★★★★";break;default:n="★×"+t}return n},t.getUpgradeStarInfo=function(t,e,n){if(void 0===n&&(n=!0),0>=e)return"";var i="";if(0>t)return i;switch(t){case 0:i="☆";break;case 1:i="★";break;case 2:i="★★";break;case 3:i="★★★";break;case 4:i="★★★★";break;case 5:i="★★★★★";break;default:i="★x"+t}if(n){i=PowerString.makeColorString(i,4177151)}return i},t.isVip=function(t){return null!=t&&!(t.getVipLevel()<1)},t.isVipEnough=function(e){var n=xself;if(null==n.bag)return!1;var i=n.bag.getItem(PlayerBag.SPIRIT_POS);return null!=i&&i.expireTime-t.getTime()>0&&n.vipLevel>=e},t.isArrayIndexOutOfBounds=function(t,e){if(null==e)return!0;var n=e.length;return 0>t||t>=n},t.arraycopy=function(t,e,n,i,o){for(var a=0;o>a;a++)n[i+a]=t[e+a]},t.compareColorText1=function(t,e){return t+" -> "+this.compareColorText(t,e,""+e)},t.compareColorText2=function(t,e,n,i,o){var a="("+t+o+e+") -> (";return a+=this.compareColorText(t,n,""+n),a+=o,(a+=this.compareColorText(e,i,""+i))+")"},t.compareColorText=function(t,e,n){return""+(e>t?PowerString.makeColorString(n,ColorUtils.COLOR_GREEN):e==t?n:PowerString.makeColorString(n,ColorUtils.COLOR_RED))},t.comparePower=function(e,n,i,o){var a=e==i,r="",s="";return 0>=e||e==Define.POWER_COMPOSITE?r+=GameText.STR_NOT_EFFECT:(s=Define.getPowerDesc(e,n),1==t.isNullText(s)?s=GameText.STR_NOT_EFFECT:0==a&&(s=PowerString.makeColorString(s,ColorUtils.COLOR_GREEN)),r+=s),r+=" -> ",0>=i||i==Define.POWER_COMPOSITE?r+=GameText.STR_NOT_EFFECT:(s=Define.getPowerDesc(i,o),r+=s=t.isNullText(s)?GameText.STR_NOT_EFFECT:1==a?t.compareColorText(n,o,s):PowerString.makeColorString(s,ColorUtils.COLOR_GREEN)),r},t.removeObjSafe=function(t){t&&t.parent&&t.parent.removeChild(t)},t.duringGameMinute=function(t){return(egret.getTimer()-t)/1e3/60},t.initTwoDimensionalArray=function(t,e,n){for(var i=[],o=0;t>o;o++){for(var a=[],r=0;e>r;r++)a.push(n);i.push(a)}return i},t.getMoneyText=function(e,n){if(0>=e)return e+"";switch(n){case t.DIVIDE_TEN_THOUSAND:if(e>=1e8)return t.manageString(GameText.STR_HUNDRED_MILLION,Math.floor(e/1e8)+"");if(e>=1e5)return t.manageString(GameText.STR_TEN_THOUSAND,Math.floor(e/1e4)+"");break;case t.DIVIDE_THOUSAND:return 1e4>e?e+"":t.manageString(GameText.STR_THOUSAND,Math.floor(e/1e3)+"")}return e+""},t.isAbleToAddHPMP=function(t){if(null==t)return!1;var e=t.getPower1AndPower2(Define.POWER_HP_PERCENT),n=t.getPower1AndPower2(Define.POWER_HP),i=t.getPower1AndPower2(Define.POWER_MP_PERCENT),o=t.getPower1AndPower2(Define.POWER_MP);return!(0>=e&&0>=n&&0>=i&&0>=o)},t.getChangeChnChar=function(e){if(e>=100)return"";if(10>=e)return t.getChangeChar2(e);var n=Math.floor(e/10);return 1==n&&(n=10),t.getChangeChar2(n)+t.getChangeChar2(e%10)},t.getChangeChar2=function(t){var e="";if(1>t||t>10)return e;switch(t){case 1:e="一";break;case 2:e="二";break;case 3:e="三";break;case 4:e="四";break;case 5:e="五";break;case 6:e="六";break;case 7:e="七";break;case 8:e="八";break;case 9:e="九";break;case 10:e="十"}return e},t.getFormatData=function(t){var e=new Date(t);return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日"},t.parseStringToArray=function(t,e){if(void 0===e&&(e=","),null==t||""==t.trim())return[];var n=[],i=t.split(e);if(null!=i&&i.length>0)for(var o=0;o<i.length;o++){var a=i[o];if(null!=a&&""!=a.trim())if(-1!=a.indexOf(":")){var r=this.parseStringToArray(a,":");n.push(r)}else n.push(this.parseStringToObject(a))}return n},t.parseStringToObject=function(t){if(null==t||""==t.trim())return t;if(-1!=t.indexOf("{")&&-1!=t.indexOf("}"))return JSON.parse(t);var e=Number(t);return e>0||0>e?e:0==e?new RegExp("[^0.]").exec(t)?t:0:t},t.parseStringToNumber=function(t,e){if(void 0===e&&(e=-1),null!=t&&""!=t.trim()){var n=Number(t);if(n>0||0>n)return n;if(0==n)return new RegExp("[^0.]").exec(t)?e:0}return e},t.MAX_VALUE_int=2147483647,t.MAX_VALUE_short=32767,t.MAX_VALUE_byte=127,t.MILLIS_IN_SECOND=1e3,t.MILLIS_IN_MINUTE=60*t.MILLIS_IN_SECOND,t.MILLIS_IN_HOUR=60*t.MILLIS_IN_MINUTE,t.MILLIS_IN_DAY=24*t.MILLIS_IN_HOUR,t.SECOND_IN_MINUTE=60,t.SECOND_IN_HOUR=3600,t.SECOND_IN_DAY=86400,t.MINUTE_IN_HOUR=60,t.MINUTE_IN_DAY=1440,t.HOUR_IN_DAY=24,t.random=new Random(Date.now()),t.MAX_SEED_VALUE=1e4,t.DIVIDE_TEN_THOUSAND=1,t.DIVIDE_THOUSAND=2,t}();__reflect(Tool.prototype,"Tool");var Achieve=function(){function t(){this.nowTabEvent=-1,this.titleObj=[],this.typeObj=[[],[],[],[]],this.playType=t.PLAYER_TYPE_NORMAL,this.checkType=t.SEARCH_ALL,this.isOtherAchieveFirstRequest=!0,this.payVectorList=new Array}return t.getAchieveType=function(e){return 0>e||e>=t.ACHIEVE_TYPE.length?-1:t.ACHIEVE_TYPE[e]},t.getAchieveTypeText=function(e){return 0>e||e>=t.ACHIEVE_TYPE_TEXT.length?"null":t.ACHIEVE_TYPE_TEXT[e]},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.getTabTypeByTabEvent=function(e){switch(e){case t.EVENT_ACHIEVE_TAB_1:return t.ACHIEVE_TAB_TYPE_1;case t.EVENT_ACHIEVE_TAB_2:return t.ACHIEVE_TAB_TYPE_2;case t.EVENT_ACHIEVE_TAB_3:return t.ACHIEVE_TAB_TYPE_3}return-1},t.prototype.getTypeObjData=function(t,e){return void 0===e&&(e=-1),-1!=e?0>t||t>=this.typeObj.length||0>e||e>=this.typeObj[t].length?-1:this.typeObj[t][e]:this.typeObj[t]},t.prototype.getTitleObjData=function(t){return-1!=t&&null!=this.titleObj?this.titleObj[t]:void 0},t.prototype.getNewAchieveNum=function(t){return this.getTypeObjData(t,0)},t.prototype.getAllNewAchieveNum=function(){var t=0;if(this.typeObj&&this.typeObj.length>0)for(var e=0;e<this.typeObj.length;e++){t+=this.typeObj[e][0]}return t},t.prototype.getTypeInfo=function(t){var e=new StringBuffer;return e.append(GameText.STR_REACH),e.append(this.getTypeObjData(t,1)+"/"+this.getTypeObjData(t,2)),e.toString()},t.prototype.getAchieveDesc=function(){var t=new StringBuffer;return t.append(Tool.manageString(GameText.STR_ACHIEVE_NAME,this.name)+"\n"),t.append(Tool.manageString(GameText.STR_ACHIEVE_INFO,this.desc)+"\n"),t.append(GameText.STR_ACHIEVE_REWARD),0==Tool.isNullText(this.title)&&t.append(Tool.manageString(GameText.STR_GET_ACHIEVE,PowerString.makeColorString(this.title,ColorUtils.COLOR_GREEN))+"\n"),this.point>0&&t.append(GameText.STR_ACHIEVE_POINT+this.point+"\n"),this.exp>0&&t.append(Tool.manageString(GameText.STR_EXP,this.exp+"")+"\n"),this.money1>0&&t.append(GameText.STR_MONEY1+":"+this.money1+"\n"),this.money2>0&&t.append(GameText.getMoneyText(ModelConst.MONEY2)+":"+this.money2+"\n"),this.money3>0&&t.append(GameText.getMoneyText(ModelConst.MONEY3)+":"+this.money3+"\n"),null!=this.item&&t.append(this.item.getRewardDesc()),t.toString()},t.doAchieveManageMsg=function(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=MsgHandler.createAchieveGetInfo(),o=t.instance;nato.Network.sendCmd(i,(function(t){if(null==t)return null;MsgHandler.processAchieveGetInfo(t),o.nowTitle=t.getString(),o.nowPoint=t.getInt(),o.nowRank=t.getShort(),o.nowCount=t.getShort();for(var i=0;4>i;i++)for(var a=0;3>a;a++)o.typeObj[i][a]=t.getShort();o.titleObj=null,null!=e&&null!=n?e.call(n,o):PanelManager.openAchieveScene(o)}),this)},t.doAchieveListMsg=function(e,n,i,o){if(null!=e){var a=MsgHandler.createAchieveList(e.getBigType(),n,o,i);nato.Network.sendCmd(a,(function(e){if(null==e)return null;if(0>e.getInt())AlertPanel.alertCommon(e.getString());else{for(var i=e.getShort(),o=new Array,a=0;i>a;a++){var r=new t;r.id=e.getShort(),r.name=e.getString(),e.getBoolean()&&(r.simpleDesc=e.getString()),r.point=e.getInt(),r.title=e.getString(),r.desc=e.getString(),r.exp=e.getInt(),r.money1=e.getInt(),r.money2=e.getInt(),r.money3=e.getInt();var s=e.getByte();-1!=s&&(r.item=new ItemData,r.item.name=e.getString(),r.item.bagIcon=e.getShort(),r.item.grade=e.getByte(),r.item.quantity=s),o.push(r)}n==t.ACHIEVE_TAB_TYPE_2?PanelManager.openNewAchievePanel(o,t.ACHIEVE_TAB_TYPE_2):n==t.ACHIEVE_TAB_TYPE_3?PanelManager.getPanel(NewAchievePanel,!1)&&PanelManager.getPanel(NewAchievePanel).setData(o,t.ACHIEVE_TAB_TYPE_3):n==t.ACHIEVE_TAB_TYPE_1&&PanelManager.getPanel(NewAchievePanel,!1)&&PanelManager.getPanel(NewAchievePanel).setData(o,t.ACHIEVE_TAB_TYPE_1)}}),this)}},t.doAchieveGainRewardMsg=function(t,e){if(null!=t){if(1==t.isGetReward)return void AlertPanel.alertCommon(GameText.STR_ACHIEVE_GET_REWARD);var n=MsgHandler.createAchieveGainReward(t.getId(),e);nato.Network.sendCmd(n,(function(e){null!=e&&(MsgHandler.processAchieveGainReward(e),t.isGetReward=!0,xevent.dispatchEvent(new WorldEvent(WorldEvent.ACHIEVE_GET_AWARD,t)))}),this)}},t.doAchieveChangeTitle=function(){this.doAchieveTitleListMsg(t.instance.ChangeTitleCallback)},t.prototype.ChangeTitleCallback=function(e,n){this.titleObj=e,t.doOpenTitleListUI(this.titleObj,n)},t.doOpenTitleListUI=function(e,n){if(null==e||e.length<=0)AlertPanel.alertCommon(GameText.STR_ACHIEVE_NO_TITLE);else{t.instance.titleObj=e;var i=new Array,o=new Array;i.push(GameText.STR_ACHIEVE_DEL_TITLE),o.push(null);for(var a=0;n>a;a++)o.push(e[a][0]),i.push(e[a][1]);PanelManager.openAchieveTitleList(i,o,AchieveTitleList.TYPE_ACHIEVE)}},t.doAchieveTitleListMsg=function(t){var e=MsgHandler.createAchieveTitleList();nato.Network.sendCmd(e,(function(e){if(null==e)return null;for(var n=e.getByte(),i=[],o=0;n>o;o++)i[o]=[],i[o][0]=e.getShort(),i[o][1]=e.getString(),i[o][2]=e.getUnsignedByte(),i[o][3]=e.getShort(),i[o][4]=e.getUnsignedByte(),i[o][5]=e.getShort();t(i,n)}),this)},t.doAchieveUseTitleMsg=function(e){if(null==e)return!1;var n=xself;if(null==n)return!1;var i=e[0],o="";if(i==t.ACHIEVE_CANCEL_TITLE)o=GameText.STR_ACHIEVE_DEL_TITLE_ASK;else{var a=e[1],r=e[2];504==i&&(r=167);var s=e[3],l=e[4],_=e[5];r>0&&(o+=PowerString.makeColorString(Define.getPowerDesc(r,s),ColorUtils.COLOR_GREEN)+"\n"),l>0&&(o+=PowerString.makeColorString(Define.getPowerDesc(l,_),ColorUtils.COLOR_GREEN)+"\n"),o+=Tool.manageString(GameText.STR_ACHIEVE_USE_TITLE_ASK,PowerString.makeColorString(a,ColorUtils.COLOR_YELLOW))}return AlertPanel.alert(GameText.STR_ACHIEVE_USE_TITLE_TITLE,o,(function(){var e=MsgHandler.createAchieveUseTitle(i);nato.Network.sendCmd(e,(function(e){if(null==e)return!1;if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var i=e.getString(),o=e.getShort(),a=e.getShort(),r=e.getShort(),s=e.getShort();n.setTitle(i),n.titlePower1=o,n.titlePowerValue1=a,n.titlePower2=r,n.titlePowerValue2=s,t.instance.setNowTitle(i),PopUpManager.removePopUp(PanelManager.getPanel(AchieveTitleList)),PanelManager.getPanel(AchieveScene,!1)&&PanelManager.getPanel(AchieveScene).updateNowTitle(i)}}),this)}),this),!0},t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getName=function(){return this.getisGetReward()?this.name+"("+GameText.STR_ACHIEVE_REACH+")":this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getSimpleDesc=function(){return Tool.isNullText(this.simpleDesc)?this.desc:this.simpleDesc},t.prototype.setSimpleDesc=function(t){this.simpleDesc=t},t.prototype.getPoint=function(){return this.point},t.prototype.setPoint=function(t){this.point=t},t.prototype.getTitle=function(){return this.title},t.prototype.setTitle=function(t){this.title=t},t.prototype.getDesc=function(){return this.desc},t.prototype.setDesc=function(t){this.desc=t},t.prototype.getExp=function(){return this.exp},t.prototype.setExp=function(t){this.exp=t},t.prototype.getMoney1=function(){return this.money1},t.prototype.setMoney1=function(t){this.money1=t},t.prototype.getMoney2=function(){return this.money2},t.prototype.setMoney2=function(t){this.money2=t},t.prototype.getMoney3=function(){return this.money3},t.prototype.setMoney3=function(t){this.money3=t},t.prototype.getItem=function(){return this.item},t.prototype.setItem=function(t){this.item=t},t.prototype.getNowTitle=function(){return Tool.isNullText(this.nowTitle)?"<"+GameText.STR_ACHIEVE_CHOICE_TITLE+">":this.nowTitle},t.prototype.setNowTitle=function(t){this.nowTitle=t},t.prototype.getNowPoint=function(){return this.nowPoint},t.prototype.setNowPoint=function(t){this.nowPoint=t},t.prototype.getNowRankStr=function(){return-1==this.nowRank?GameText.STR_ACHIEVE_NO_RANK:this.nowRank+""},t.prototype.setNowRank=function(t){this.nowRank=t},t.prototype.getNowCount=function(){return this.nowCount},t.prototype.setNowCount=function(t){this.nowCount=t},t.prototype.getBigType=function(){return this.bigType},t.prototype.setBigType=function(t){this.bigType=t},t.prototype.getisGetReward=function(){return this.isGetReward},t.prototype.getPlayType=function(){return this.playType},t.prototype.setPlayType=function(t){this.playType=t},t.prototype.getCheckType=function(){return this.checkType},t.prototype.setCheckType=function(t){this.checkType=t},t.doSeeAchieveListMsg=function(e,n,i,o){if(null==n)return null;var a=t.createSeeAchieveList(e.getId(),n.playType,n.checkType,i,o);nato.Network.sendCmd(a,(function(i){if(null==i)return null;if(0>i.getInt())return WorldMessage.addPromptMsg(i.getString()),null;var o=i.getShort();if(0!=o){n.seechieveList=new Array;for(var a=0;o>a;a++){var r=t.fromBytesToSeeAchieveList(i);null!=r&&n.seechieveList.push(r)}n.getCheckType()==t.SEARCH_ALL?PanelManager.openOtherAchievePanel(e,n):PanelManager.getPanel(AchieveOtherPanel,!1)&&PanelManager.getPanel(AchieveOtherPanel).setData(e,n)}else{var s=GameText.STR_NO_ACHIEVE;AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),s,null,this)}}),this)},t.createSeeAchieveList=function(t,e,n,i,o){var a=new nato.Message(ProtocolDefine.CG_ACTOR_SEE_ACHIEVEMENT);return a.putInt(t),a.putByte(e),a.putByte(n),a.putInt(o),a.putShort(i),a},t.fromBytesToSeeAchieveList=function(e){if(null==e)return null;var n=new t;return n.name=e.getString(),n.point=e.getInt(),n.simpleDesc=e.getString(),n},t.prototype.getSeeAchieveInfoData=function(t){return null==this.seechieveList||0==this.seechieveList.length||Tool.isArrayIndexOutOfBounds(t,this.seechieveList)?null:this.seechieveList[t]},t.prototype.getSeeAchieveList=function(){return null==this.seechieveList||0==this.seechieveList.length?null:this.seechieveList},t.seeOtherAchieve=function(e,n,i){if(null!=e){var o=new t;o.setCheckType(i),n?o.setPlayType(t.PLAYER_TYPE_SHOP):o.setPlayType(t.PLAYER_TYPE_NORMAL),t.doSeeAchieveListMsg(e,o,NewAchievePanel.pageCount,0)}},t.doPayAchieveList=function(e,n,i){if(null==e)return null;var o=new nato.Message(ProtocolDefine.CG_BILL_ACHIEVEMENT_GETLIST);o.putInt(i),o.putShort(n),nato.Network.sendCmd(o,(function(n){if(null==n)return null;if(0>n.getInt())return AlertPanel.alertCommon(o.getString()),null;var i=o.getShort();null==e.payVectorList&&(e.payVectorList=new Array);for(var a=0;i>a;a++){var r=t.fromBytesToPayAchieveList(o);null!=r&&e.payVectorList.push(r)}}),this)},t.fromBytesToPayAchieveList=function(e){if(null==e)return null;var n=t.instance;if(n.isHasItem=e.getBoolean(),n.isHasItem){n.power1=e.getShort(),n.item=new ItemData,ItemData.fromBytesAtts2(n.item,e);var i=e.getShort();n.item.quantity=i,n.item.durability=n.item.durMax}return n.power1==Define.POWER_PET_EGG&&(n.isHasPaypet=e.getBoolean(),n.isHasPaypet&&(n.payPet=MyPet.fromBytesInfo(e,xself))),n.strGet=e.getString(),n.id=e.getShort(),n.bigType=e.getByte(),n.name=e.getString(),n.point=e.getInt(),n.title=e.getString(),n.desc=e.getString(),n.exp=e.getInt(),n.money1=e.getInt(),n.money2=e.getInt(),n.money3=e.getInt(),n.isCanGet=e.getBoolean(),n},t.prototype.doGetPayAchieve=function(t){return null==this.payVectorList||0==this.payVectorList.length||Tool.isArrayIndexOutOfBounds(t,this.payVectorList)?null:this.payVectorList[t]},t.prototype.doSeePayAchieveItem=function(t){var e="";if(1==this.isHasPaypet&&null!=this.payPet?e=this.payPet.getDescribe():1==this.isHasItem&&null!=this.item&&(e=this.item.getDesc(null)),t)AlertPanel.alertCommon(e);else{e=this.getAchieveDesc();var n=new Array;new Array,n.push(GameText.getText(GameText.TI_BACK)),this.isCanGet?n.push(GameText.getText(GameText.TI_GET_MISSION)):n.push(GameText.STR_PAY_DESCRIBE_IN_RECHARGE)}},t.doSeePayAchieveItemSelect=function(e){t.doAchieveGainRewardMsg(e,e.bigType)},t.ACHIEVE_TYPE_1=1,t.ACHIEVE_TYPE_2=2,t.ACHIEVE_TYPE_3=3,t.ACHIEVE_TYPE_4=4,t.ACHIEVE_TYPE=[t.ACHIEVE_TYPE_1,t.ACHIEVE_TYPE_2,t.ACHIEVE_TYPE_3,t.ACHIEVE_TYPE_4],t.ACHIEVE_TYPE_TEXT=[GameText.STR_PERSONAL_GROWTH,GameText.STR_MISSION_ACHIEVE,GameText.STR_HONOUR,GameText.STR_MULTIPLE],t.ACHIEVE_TAB_TYPE_1=1,t.ACHIEVE_TAB_TYPE_2=2,t.ACHIEVE_TAB_TYPE_3=3,t.ACHIEVE_NO_GET_REWARD=0,t.ACHIEVE_GET_REWARD=1,t.ACHIEVE_CANCEL_TITLE=-1,t.ACHIEVE_ALL_REWARD=-1,t.EVENT_ACHIEVE_TAB_1=9207,t.EVENT_ACHIEVE_TAB_2=9208,t.EVENT_ACHIEVE_TAB_3=9209,t.SEARCH_ALL=1,t.SEARCH_COMPOSE=2,t.PLAYER_TYPE_NORMAL=1,t.PLAYER_TYPE_SHOP=2,t}();__reflect(Achieve.prototype,"Achieve");var ActivityData=function(){function t(){this.id=0,this.dateInfo="",this.title="",this.detailInfo="",this.mapID=0,this.gx=0,this.gy=0,this.reqLevel=0,this.shopID=0,this.isHaspoll=!1}return t.fromBytes=function(e){var n=new t;n.id=e.getInt(),n.dateInfo=e.getString(),n.title=e.getString(),n.detailInfo=e.getString(),n.mapID=e.getShort(),n.gx=e.getByte(),n.gy=e.getByte(),n.reqLevel=e.getByte();var i=e.getByte();n.pollIDList=new Array(i),n.pollMenuList=new Array(i);for(var o=0;i>o;o++)n.pollIDList[o]=e.getByte(),n.pollMenuList[o]=e.getString();return i>0&&(n.isHaspoll=e.getBoolean(),n.isHaspoll&&(n.pollResult=e.getString())),n.shopID=e.getInt(),n},t.doBrowseActivityList=function(){var e=new nato.Message(ProtocolDefine.CG_SYSTEM_GET_ACTIVITY);nato.Network.sendCmd(e,(function(e){for(var n=e.getByte(),i=[],o=0;n>o;o++){var a=t.fromBytes(e);i.push(a)}var r=PanelManager.getPanel(TaskScene,!1);r&&r.activityPanel&&r.activityPanel.setData(i)}),this)},t.prototype.isHasMap=function(){return this.mapID>0},t.prototype.isHasShop=function(){return this.shopID>0},t.prototype.doJumpMap=function(){var t=xself;if(null!=t&&null!=t.bag){var e=t.bag.getItem(PlayerBag.SPIRIT_POS);if(null!=e){var n=GameText.STR_VIP;if(Tool.manageStringList(GameText.STR_VIP_ACTIVITYDATA_NOTVIP,[n,n]),e.expireTime,Tool.currentTime,this.isHasShop())return void xworld.doBrowseShop(this.shopID,null);if(this.isHasMap()){var i=MsgHandler.createWroldMapVIPEnterMsg(this.id);nato.Network.sendCmd(i,(function(t){MsgHandler.isMessageHaveError(t)||MsgHandler.instance.processDataBlockFlagMsg(t)}),this)}}}},t.doPollList=function(e){if(null!=e&&!(e.pollIDList.length<1)){var n=e.detailInfo;e.isHaspoll&&(n+="\n"+e.pollResult);for(var i,o=[],a=0;a<e.pollIDList.length;a++)i=new MenuActionData(e.pollMenuList[a],t.Action_Poll,e.pollIDList[a]),o.push(i);i=new MenuActionData(GameText.getText(GameText.TI_BACK),t.Action_back),o.push(i),PanelManager.openSelectMenuPanel(n,o,(function(t,e){void 0===e&&(e=0)}),this)}},t.doSelectPollList=function(t,e){if(null!=t){var n=new nato.Message(ProtocolDefine.CG_SYSTEM_BALLOT);n.putInt(t.id),n.putByte(e),nato.Network.sendCmd(n,(function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(t.getString())}),this)}},t.doMixServerActivityActorJoin=function(){if(null!=xself&&0!=SafeLock.doSafeLockVerify()){var t=function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(t.getString())};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_MIX_SERVER_ACTOR_ASK,(function(){var e=new nato.Message(ProtocolDefine.CG_MIX_SERVER_ACTIVITY_ACTOR_JOIN);nato.Network.sendCmd(e,t,this)}),this)}},t.doMixServerActivityActorCancel=function(){if(null!=xself&&0!=SafeLock.doSafeLockVerify()){var t=function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(GameText.STR_MIX_SERVER_ACTIVITY_FAIL)};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_MIX_SERVER_ACTOR_CAN_ASK,(function(){var e=new nato.Message(ProtocolDefine.CG_MIX_SERVER_ACTIVITY_ACTOR_CANCEL);nato.Network.sendCmd(e,t,this)}),this)}},t.doMixServerActivityCountryJoin=function(){if(null!=xself&&0!=SafeLock.doSafeLockVerify()){var t=function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(t.getString())};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_MIX_SERVER_COUNTRY_ASK,(function(){var e=new nato.Message(ProtocolDefine.CG_MIX_SERVER_ACTIVITY_COUNTRY_JOIN);nato.Network.sendCmd(e,t,this)}),this)}},t.doMixServerActivityCountryCancel=function(){if(null!=xself&&0!=SafeLock.doSafeLockVerify()){var t=function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(GameText.STR_MIX_SERVER_ACTIVITY_FAIL)};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_MIX_SERVER_COUNTRY_CAN_ASK,(function(){var e=new nato.Message(ProtocolDefine.CG_MIX_SERVER_ACTIVITY_COUNTRY_CANCEL);nato.Network.sendCmd(e,t,this)}),this)}},t.Action_back=1,t.Action_Poll=2,t}();__reflect(ActivityData.prototype,"ActivityData");var Arena=function(){function t(){this.playerList=[],this.isfirstLogin=!1,this.arenaUI=null,this.numSet=0,this.nextSysnTime=0,this.nextupdateListTime=0,this.status=0,this.endTime=0,this.scoreSum=0,this.fightCount=0,this.info="",this.battleStatusCount=0}return t.prototype.isStatus=function(t){return Tool.isBit(t,this.status)},t.prototype.setStatus=function(t,e){this.status=Tool.setBit(t,e,this.status)},t.prototype.init=function(){this.numSet=ImageSet.IMG_SET_NUMBER_BATTLE_ADD,this.initUI()},t.prototype.initUI=function(){PanelManager.mainMenu.updateRoleProgress(),PanelManager.mainMenu.updatePetProgress()},t.doEnterArena=function(e,n){n&&t.doArenaEntryRequest(e,(function(e){if(0!=e){var i=new t;PanelManager.openArenaScene(i),i.arenaUI=PanelManager.getPanel(ArenaScene),i.init(),GameWorld.arena=i,i.arenaUI.update(),n&&(i.isfirstLogin=!0),nato.Network.addMsgHandler(ProtocolDefine.CG_TASK_ARENA_ACTOR_LIST,t.onArenaNearActorList,t)}}),this)},t.doprocessEnteryArena=function(e){if(null!=e){var n=e.getByte();t.doArenaRefurbish(e),e.getInt(),t.doEnterArena(n,!1)}},t.doArenaEntryRequest=function(e,n,i){var o=new nato.Message(ProtocolDefine.CG_TASK_ARENA_JOIN_NEW);o.putByte(e),nato.Network.sendCmd(o,(function(e){return 0>e.getByte()?(AlertPanel.alertCommon(e.getString()),void n.call(i,!1)):(t.doArenaRefurbish(e),void n.call(i,!0))}),this)},t.doArenaNearActorList=function(t,e,n,i){if(void 0===n&&(n=100),void 0===i&&(i=1),null==t)return null;var o=new nato.Message(ProtocolDefine.CG_TASK_ARENA_ACTOR_LIST);o.putByte(e),o.putByte(n),o.putShort(i),nato.Network.sendCmd(o)},t.onArenaNearActorList=function(e){if(0>e.getByte())return AlertPanel.alertCommon(e.getString()),null;var n=(e.getInt(),e.getByte()),i=GameWorld.arena;i.playerList=[];for(var o=0;n>o;o++){var a=t.getPlayerFromMsg(e);null!=a&&i.playerList.push(a)}i.arenaUI.update()},t.getPlayerFromMsg=function(t){if(null==t)return null;var e=new Player;return e.setId(t.getInt()),e.setName(t.getString()),e.setIcon1(t.getInt()),e.setJob(t.getByte()),e.setLevel(t.getByte()),e.arenaPoint=t.getInt(),e.Pkwincount=t.getInt(),e.arenaStutas=t.getByte(),e},t.prototype.getPlayerfromIndex=function(t){return null==this.playerList||0==this.playerList.length||Tool.isArrayIndexOutOfBounds(t,this.playerList)?null:this.playerList[t]},t.doUpdateArenaNearActorList=function(){var e=GameWorld.arena;null!=e&&(t.doArenaNearActorList(e,t.STATUS_NONE),1==e.isfirstLogin&&(e.isfirstLogin=!1,AlertPanel.alertCommon(GameText.STR_ARENA_ALERT_MESSAGE)))},t.doArenaRefresh=function(e){if(null!=e){var n=GameWorld.arena;if(null!=n){var i=e.getByte();if(1==i)return void t.clearArena(!1);if(2==i)return void t.clearArena(!1);if(3==i)return n.battleStatusCount++,void(n.battleStatusCount>3&&(n.battleStatusCount=0,MsgHandler.createWorldDataReflashMsg()));n.battleStatusCount=0,0==i&&t.doArenaRefurbish(e)}}},t.doArenaRefurbish=function(t){if(null!=t){var e=GameWorld.arena;null!=e&&(e.endTime=t.getInt()+Date.now(),e.scoreSum=t.getShort(),e.fightCount=t.getByte(),e.arenaUI.updateFightCountAndScore())}},t.prototype.logic=function(e){if(1==this.isStatus(t.STAGE_BATTLE_FAIL)&&(AlertPanel.alertCommon(this.getBattleFailStr()),this.setStatus(!1,t.STAGE_BATTLE_FAIL)),1==this.isStatus(t.STAGE_BATTLE_WIN)&&(AlertPanel.alertCommon(this.getBattleWinStr()),this.setStatus(!1,t.STAGE_BATTLE_WIN)),!(Date.now()<this.nextSysnTime)){var n=MsgHandler.createArenaRefresh();nato.Network.sendCmd(n),this.nextSysnTime=Date.now()+t.SYSN_TIME,Date.now()<this.nextupdateListTime||(this.nextupdateListTime=Date.now()+t.SYSN_UPDATE_TIME,t.doUpdateArenaNearActorList())}},t.prototype.isTimeOut=function(){return Date.now()>this.endTime},t.doOverNotice=function(t){if(null!=t){var e=t.getInt(),n=t.getInt(),i=t.getBoolean();null!=xself&&(xself.arenaPoint=n),i&&Tool.manageString(GameText.STR_ARENA_OVER_NOTICE,e+"")}},t.doArenaExit=function(){function e(e){var n=e.getInt();null!=xself&&(xself.arenaPoint=n),t.clearArena(!1)}AlertPanel.alert(GameText.STR_ARENA_EXIT_TITLE,GameText.STR_ARENA_EXIT_ASK,(function(){var t=MsgHandler.createArenaExit();nato.Network.sendCmd(t,e,this)}),this)},t.clearArena=function(e){return GameWorld.arena=null,PanelManager.openMainMenuScene(),nato.Network.removeMsgHandler(ProtocolDefine.CG_TASK_ARENA_ACTOR_LIST,t.onArenaNearActorList,t),1==e&&xworld.inBattle?void WorldMessage.addPromptMsg(GameText.STR_STAGE_BATTLE):void MsgHandler.createWorldDataReflashMsg()},t.doArenaPK=function(e,n){var i=new nato.Message(ProtocolDefine.CG_TASK_ARENA_PK);i.putInt(n),nato.Network.sendCmd(i,(function(i){if(0>i.getByte()&&(AlertPanel.alertCommon(i.getString()),n>0)){var o=i.getByte();null!=e&&(e.arenaStutas=o,t.doUpdateArenaNearActorList())}}),this)},t.doArenaWatch=function(){var t=new nato.Message(ProtocolDefine.CG_TASK_ARENA_SEE_RANDOM);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void 0}),this)},t.doPointMenu=function(t){if(null!=t){var e=xself;if(null!=e){var n=t.scoreSum,i=(e.arenaPoint,t.scoreSum,"");i+=Tool.manageStringList(GameText.STR_ARENA_GET_POINT_INFO,[n+"",t.fightCount+""]),AlertPanel.alertCommon(i)}}},t.prototype.getBattleFailStr=function(){return Tool.manageStringList(GameText.STR_ARENA_BATTLE_FAIL_INFO,[this.scoreSum+"",this.fightCount-1+""])},t.prototype.getBattleWinStr=function(){return GameText.STR_ARENA_BATTLE_WIN_INFO},t.SYSN_TIME=5e3,t.SYSN_UPDATE_TIME=3e5,t.ARENA_TYPE_SINGLE=1,t.ARENA_TYPE_TEAM=2,t.STAGE_BATTLE_FAIL=1,t.STAGE_BATTLE_VIEW_EXIT=2,t.STAGE_BATTLE_WIN=4,t.STATUS_ALL=-1,t.STATUS_NONE=0,t.STATUS_PK=1,t.STATUS_OB=2,t.STATUS_EXIT=3,t}();__reflect(Arena.prototype,"Arena");var Boss=function(){function t(){this.id=0,this.uiPos=0,this.num=0,this.icon=0,this.money1=0,this.money3=0,this.iron=0,this.wood=0,this.rock=0,this.level=0}return t.fromBytesByArena=function(e){var n=new t;return n.id=e.getByte(),n.model=new Model(3),n.model.setId(e.getInt()),n.num=e.getShort(),n.uiPos=-1,n},t.prototype.isOwnModel=function(t){if(null==t)return!1;var e=xself;return null!=e&&(e.isMember()?e.getLeaderID()==this.getModelID():this.getModelID()==GameWorld.getPlayerID())},t.prototype.isHasModel=function(){return null!=this.model&&this.model.getId()>0},t.prototype.isHasPlayerWait=function(){return this.isHasModel()&&this.num>0},t.prototype.getModelID=function(){return null!=this.model?this.model.getId():-1},t.fromBytesByTeamBoss=function(e){var n=new t;return n.id=e.getByte(),n.level=e.getByte(),n.num=e.getShort(),n.uiPos=-1,n},t.prototype.isOver=function(){return this.num<=0},t.fromBytesByCountryBoss=function(e){var n=new t;return n.id=e.getByte(),n.level=e.getByte(),n.num=e.getShort(),n.icon=e.getByte(),n.money1=e.getInt(),n.money3=e.getInt(),n.iron=e.getInt(),n.wood=e.getInt(),n.rock=e.getInt(),n.uiPos=-1,n},t.prototype.getSourceInfo=function(){var t="";return this.iron>0&&(t+=GameText.STR_COUNTRY_IRON+this.iron),this.rock>0&&(t+=" \n"+GameText.STR_COUNTRY_STONE+this.rock),this.wood>0&&(t+=" \n"+GameText.STR_COUNTRY_WOOD+this.wood),this.money1>0&&(t+=" \n"+GameText.STR_MONEY1+this.money1),this.money3>0&&(t+=" \n"+GameText.STR_MONEY3+this.money3),t},t}();__reflect(Boss.prototype,"Boss");var PlayerBuffer=function(){function t(t,e,n,i,o,a,r){this.attrID=0,this.addValue=0,this.statusBit=0,this.lastTime=0,this.animeID=0,this.battle=t,this.attrID=e,this.addValue=n,this.statusBit=i,this.lastTime=o,this.animeID=a,0==this.isPermanentBuffer()&&(this.addValue=r)}return t.prototype.getLastTime=function(){return this.lastTime},t.prototype.finish=function(){this.lastTime=0},t.prototype.getStatus=function(){return this.statusBit},t.prototype.isDieStatus=function(){return this.statusBit==Define.BUFFER_RESIST_DIE_1HP||this.statusBit==Define.BUFFER_RESIST_DIE_FULLHP||this.statusBit==Define.BUFFER_RESIST_DIE_DELAY},t.prototype.isCannotReliveStatus=function(){return this.statusBit==Define.BUFFER_DIE_CANNOT_RELIVE},t.prototype.clearStatus=function(){this.statusBit=Define.BUFFER_NONE},t.prototype.isClearStatusBitBuffer=function(){return this.attrID==ModelConst.BUFFER_REMOVE_STATUS},t.prototype.useKeeAtkTime=function(){return this.attrID==ModelConst.KEEPOUT_ATK_TIME&&(!(this.addValue<=0)&&(this.addValue--,!0))},t.prototype.getAddValue=function(){return this.addValue},t.prototype.isSameStatusType=function(t){if(t==Define.BUFFER_TYPE_BUFF||t==Define.BUFFER_TYPE_DEBUFF){if(0==this.statusBit)return!1;if(Define.getBufferType(this.statusBit)==t)return!0}else if(this.statusBit==t)return!0;return!1},t.prototype.run=function(t,e){this.lastTime<=0||(this.lastTime--,this.doBuffer(t,e))},t.prototype.doBuffer=function(t,e){if(null!=t)switch(this.attrID){case ModelConst.HP:case ModelConst.MP:Define.processBattleHpMpPower(t,this.attrID,this.addValue,this.animeID,e),this.battle.checkDie1Hp(t,e)}},t.prototype.destroy=function(t){null!=t&&(this.isPermanentBuffer()||t.addValue(this.attrID,-this.addValue))},t.prototype.isPermanentBuffer=function(){switch(this.attrID){case ModelConst.HP:case ModelConst.MP:case ModelConst.BUFFER_REMOVE_STATUS:return!0}return!1},t.prototype.toString=function(){var t=new StringBuffer;return t.append(Define.getBufferString(this.statusBit)),t.append("("+this.lastTime+")"),t.append(" ["+this.attrID+","+this.addValue+"]"),t.toString()},t.MAX_SIZE=3,t}();__reflect(PlayerBuffer.prototype,"PlayerBuffer");var ChargeActivity=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.doGetChargeActivityLists=function(e){void 0===e&&(e=0);var n=new nato.Message(ProtocolDefine.CG_CHARGE_ACTIVITY_LIST);nato.Network.sendCmd(n,(function(n){if(0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=t.instance;i.chargeTotal=n.getInt(),i.maxChargeTotal=n.getInt(),i.vChargeActivityList=[];for(var o=n.getByte(),a=0;o>a;a++){var r=new t;r.demand=n.getInt(),r.item=new ItemData,ItemData.fromBytesAtts2(r.item,n),r.item.quantity=n.getInt(),r.item.durability=r.item.durMax,r.status=n.getByte(),i.vChargeActivityList.push(r)}i.desc=n.getString(),PanelManager.openChargeActivityPanel(i.chargeTotal,i.vChargeActivityList,e)}}),this)},t.prototype.doGetChargeActivityItem=function(e,n){var i=new nato.Message(ProtocolDefine.CG_CHARGE_ACTIVITY_GET_GIFT);i.putInt(e),i.putByte(n),nato.Network.sendCmd(i,(function(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{AlertPanel.alertCommon(MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD));var i=t.instance,o=i.getChargeActivity(n);null!=o&&(o.status=t.STATUS_HAS_GET,i.vChargeActivityList[n]=o),PanelManager.updateChargeActivityPanel(i.chargeTotal,i.vChargeActivityList)}}),this)},t.convertChargeActivityToChargeActivityData=function(e){for(var n=[],i=e.length,o=null,a=null,r=0;i>r;r++)a=e[r],(o=new ChargeActivityData).chargeId=r,o.chargeMoney=a.demand,o.isDrawed=a.status==t.STATUS_HAS_GET,o.rewardList=[],o.rewardList.push(a.item),o.chargeActivitySrc=a,o.chargeActivityIndex=r,n.push(o);return n},t.prototype.getChargeActivity=function(t){return null==this.vChargeActivityList||this.vChargeActivityList.length<1||Tool.isArrayIndexOutOfBounds(t,this.vChargeActivityList)?null:this.vChargeActivityList[t]},t.prototype.getStatusText=function(){var e="";switch(this.status){case t.STATUS_CANNOT_GET:e=GameText2.STR_CANNOT_GET;break;case t.STATUS_CAN_GET:e=GameText2.STR_CAN_GET;break;case t.STATUS_HAS_GET:e=GameText2.STR_HAS_GET}return e},t.STATUS_CANNOT_GET=0,t.STATUS_CAN_GET=1,t.STATUS_HAS_GET=2,t.isChargeActivityOpen=!1,t}();__reflect(ChargeActivity.prototype,"ChargeActivity");var City=function(){function t(){this.isOtherPlayer=!1,this.race=0,this.cityScaleName="",this.cityBranch=0,this.cityStatus=0,this.cityStatusName="",this.prosperityDegree=0,this.armyStrength=0,this.money1=0,this.money2=0,this.money3=0,this.storageNum=0,this.cityName="",this.citySign="",this.icon1=0,this.icon2=0,this.icon3=0,this.masterLevel=0,this.masterName="",this.masterId=0,this.masterCountryName="",this.masterUnionName=""}return t.prototype.getMasterId=function(){return this.masterId},t.prototype.getMasterSprite=function(){return null==this.sprite&&(this.sprite=SpriteHelper.createSpriteByIcon(this.icon1,this.icon2,this.icon3,!1),this.sprite.setScale(nato.mapRatio)),this.sprite},t.fromBytes=function(e){var n=new t;return n.cityName=e.getString(),n.cityScaleName=e.getString(),n.cityStatusName=e.getString(),n.citySign=e.getString(),n.masterId=e.getInt(),n.masterName=e.getString(),n.masterLevel=e.getByte(),n.icon1=e.getInt(),n.icon2=e.getInt(),n.icon3=e.getInt(),n.prosperityDegree=e.getInt(),n.armyStrength=e.getInt(),n.masterCountryName=e.getString(),n.masterUnionName=e.getString(),n.money1=e.getInt(),n.money2=e.getInt(),n.money3=e.getInt(),n},t.prototype.doGetMoney=function(){if(0==this.money1&&0==this.money2&&0==this.money3)return AlertPanel.alertCommon(GameText.STR_CITY_DO_GET_MONEY_FAIL),!1;var t=this,e=MsgHandler.createGetCityMoneyMsg(this.masterId);return nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){var n=e.getInt(),i=e.getInt(),o=e.getInt();t.money1-=n,t.money2-=i,t.money3-=o;var a=xself;null!=a&&(a.addValue(ModelConst.MONEY1,n),a.addValue(ModelConst.MONEY2,i),a.addValue(ModelConst.MONEY3,o)),n>0&&WorldMessage.addTips("获得 "+PowerString.makeColorString(GameText.STR_MONEY1+"x"+n,ColorUtils.COLOR_MONEY2)),i>0&&WorldMessage.addTips("获得 "+PowerString.makeColorString(GameText.STR_MONEY2+"x"+i,ColorUtils.COLOR_MONEY2)),o>0&&WorldMessage.addTips("获得 "+PowerString.makeColorString(GameText.STR_MONEY3+"x"+o,ColorUtils.COLOR_MONEY3));var r=PanelManager.getPanel(ManorScene,!1);r&&r.stage&&(r.cityPanel.setData(t),r.cityPanel.update())}}),this),!0},t.prototype.doCityNameModify=function(t){if(0==SafeLock.doSafeLockVerify())return!1;var e=MsgHandler.createModifyCityNameMsg(this.masterId,t);return nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){this.cityName=t;var n=PanelManager.getPanel(ManorScene,!1);n&&n.stage&&(n.cityPanel.setData(this),n.cityPanel.update())}}),this),!0},t.prototype.doCitySignModify=function(t){var e=MsgHandler.createModifyCitySignMsg(this.masterId,t);return nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){this.citySign=t;var n=PanelManager.getPanel(ManorScene,!1);n&&n.stage&&(n.cityPanel.setData(this),n.cityPanel.update())}}),this),!0},t.getCityData=function(e,n,i){if(this._isGetingCityData)return this._getCityDataCallbackList.push(n),this._getCityDataThisObjList.push(i),void this._getCityDataModelIDList.push(e);var o=MsgHandler.createBrowseCityInfoMsg(e);nato.Network.sendCmd(o,(function(e){if(0>e.getByte())return e.getString(),void t.getCityDataBack(null);var n=t.fromBytes(e);t.getCityDataBack(n),t._isGetingCityData=!1}),this),null==this._getCityDataCallbackList&&(this._getCityDataCallbackList=[],this._getCityDataThisObjList=[],this._getCityDataModelIDList=[]),this._getCityDataCallbackList.push(n),this._getCityDataThisObjList.push(i),this._getCityDataModelIDList.push(e),this._isGetingCityData=!0},t.getCityDataBack=function(e){for(var n=0;n<t._getCityDataCallbackList.length;n++){var i=t._getCityDataCallbackList[n],o=t._getCityDataThisObjList[n],a=t._getCityDataModelIDList[n];(null==e||a==e.getMasterId())&&(i.call(o,e),t._getCityDataCallbackList.splice(n,1),t._getCityDataThisObjList.splice(n,1),t._getCityDataModelIDList.splice(n,1),n--)}},t.doViewCityInfo=function(e,n){void 0===n&&(n=ManorScene.FROM_NORMAL);var i=MsgHandler.createBrowseCityInfoMsg(e);nato.Network.sendCmd(i,t.processBrowseCityInfoMsg,t,[n]),PanelManager.openWaitForServer()},t.processBrowseCityInfoMsg=function(e,n){if(PanelManager.closeWaitForServer(),0>e.getByte()){var i=e.getString();AlertPanel.alertCommon(PowerString.makeColorString(i,ColorUtils.COLOR_RED))}else{var o=t.fromBytes(e);if(PanelManager.isPanelShow(ManorScene))PanelManager.getPanel(ManorScene).setCityData(o);else o.masterId==GameWorld.getPlayerID()||n[0]==ManorScene.FROM_NORMAL&&(n[0]=ManorScene.FROM_OTHER_CITY),PanelManager.openManorScene(ManorScene.TAB_INDEX_CITY,n[0],o)}},t.doEnterCity=function(t){var e=MsgHandler.createJumpCityMessage(t,Define.JUMP_MAP_DATA_FLAG);nato.Network.sendCmd(e),xself.clearAutoMoveList()},t.getCityMapId=function(t,e,n){return t==Define.RACE_EAST?Define.MAP_ID_START_CITY_EAST+100*e+10*n:t==Define.RACE_WEST?Define.MAP_ID_START_CITY_WEST+100*e+10*n:void 0},t._isGetingCityData=!1,t}();__reflect(City.prototype,"City");var Country=function(){function t(e){this.intValue1=0,this.searchBuildingID=Define.BUILDING_NONE,this.searchMemberStatus=Define.SEARCH_MEM_ALL,this.searchRankID=Define.RANK_NONE,this.commandCoolList=null,this.buildingList=[],this.myBookNum=0,this.id=0,this.name=null,this.kingId=-1,this.kingName="",this.createRace=0,this.status=t.STATUS_INACTIVE,this.scale=0,this.prosperity=0,this.prosperityMax=0,this.armyStrength=0,this.populaceNum=500,this.populaceMax=0,this.maxPeopleNum=0,this.allPeopleNum=1,this.applyPeopleNum=0,this.freeLand=0,this.freeBuild=0,this.bookNum=0,this.lastKingLogin=Tool.currentTime,this.isOpenRecruit=!1,this.onlineNotify=!1,this.coolKingChange=0,this.costmoney=0,this.createwarinfo="",this.money1=0,this.money2=0,this.money3=0,this.wood=0,this.stone=0,this.iron=0,this.taxRate=0,this.entryTaxMoney1=0,this.entryTaxMoney3=0,this.idefinecation=!1,this.idefinecationInfo="",this.affiche="",this.memberList=[],this.countryList=[],this.missionCommonList=[],this.missionAppointList=[],this.assignModelList={},this.taskMainType=[],this.missionPublicList=[],this.idPublicList=[],this.leagueid=0,this.unionName="",this.unionNum=0,this.searchBuildingLevel=0,this.usePoint=0,this.issuePoint=0,this.isMyMission=!0,this.numStore=0,this.donateText=[],this.donateObj=[],this.resourseText=[],this.resourseObj=[],this.warCount=0,this.warWinRate=0,this.campLevel=0,this.militaryStrength=0,this.soldierNum=0,this.soldierMax=0,this.helpNum=0,this.helpMax=0,this.fightID=0,this.fightTime=0,this.isAttack=!1,this.fightMoney1=0,this.fightMoney3=0,this.fightType=0,this.soldierType=t.SOLDIER_TYPE_WAR_MENBER,this.soldierRank=-1,this.countryID1=0,this.countryID2=0,this.id=e}return t.prototype.setLoadStatus=function(t,e){this.intValue1=Tool.setBit(t,e,this.intValue1)},t.prototype.isLoad=function(t){return Tool.isBit(t,this.intValue1)},t.prototype.clearLoadAssign=function(){this.setLoadStatus(!1,t.LOAD_FIRST_ASSIGN),this.assignModelList=null},t.prototype.getComandList=function(){return[Define.COUNTRY_COMMAND_CHANGE_NAME,Define.COUNTRY_COMMAND_ADD_PROSPERITY,Define.COUNTRY_COMMAND_TRANSFER_RESOURCE,Define.COUNTRY_COMMAND_ADD_PEOPLE,Define.COUNTRY_COMMAND_ADD_LAND,Define.COUNTRY_COMMAND_ADD_ARMY,Define.COUNTRY_COMMAND_ADD_ARMY_USELAND,Define.COUNTRY_COMMAND_REFRESH_TASK,Define.COUNTRY_COMMAND_KING_COMMAND,Define.COUNTRY_COMMAND_CREATE_WAR]},t.prototype.getCommandType=function(t){var e=this.getComandList();return Tool.isArrayIndexOutOfBounds(t,e)?Define.COUNTRY_COMMAND_NONE:e[t]},t.getBuildingTitle=function(t,e){var n=GameText.getText(GameText.TI_UP_LEVEL);0>=e&&(n=GameText.getText(GameText.TI_BUILD));var i=e+1,o=Define.getBuildingText(t);return n+Tool.manageString(GameText.getText(GameText.TI_LEVEL),i+"")+o},t.prototype.getBuildingName=function(t,e){return Define.getBuildingText(t)+(0>=e?PowerString.makeColorString(GameText.STR_COUNTRY_NOT_BUILD,ColorUtils.COLOR_RED):"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),e+"")+")")},t.prototype.getBuildingInfo=function(e,n){var i=new StringBuffer,o=this.getBuildingAttr(e);if(null!=o){var a=o[t.BUILDING_ID],r=o[t.BUILDING_LEVEL],s=r+1;if(1==n){var l=t.getBuildingTitle(a,r);i.append(Tool.manageString(GameText.STR_COUNTRY_ASK,PowerString.makeColorString(l,65280))),i.append("\n")}else i.append(this.getBuildingName(a,r)+"\n");0>=r?i.append(PowerString.makeColorString(GameText.STR_COUNTRY_BUILD_NEED,16776960)+"\n"):i.append(PowerString.makeColorString(Tool.manageString(GameText.STR_COUNTRY_BUILD_LEVEL_NEED,s+""),16776960)+"\n"),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_MONEY1+": ",o[t.BUILDING_REQ_MONEY1],this.money1,!1)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_MONEY3+": ",o[t.BUILDING_REQ_MONEY3],this.money3,!1)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_WOOD+": ",o[t.BUILDING_REQ_WOOD],this.wood,!1)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_STONE+": ",o[t.BUILDING_REQ_STONE],this.stone,!1)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_IRON+": ",o[t.BUILDING_REQ_IRON],this.iron,!1)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_LAND+": ",o[t.BUILDING_REQ_LAND],this.freeLand,!1)),o[t.BUILDING_REQ_SCALE]>0&&i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_LEVEL+": ",o[t.BUILDING_REQ_SCALE]+1,this.scale+1,!0)),i.append(t.getCompareBuildingReqText(GameText.STR_COUNTRY_PROSPERITY+": ",o[t.BUILDING_REQ_PROSPERITY],this.prosperity,!1))}return i.toString()},t.prototype.checkIsEnoughBuild=function(e){var n=this.getBuildingAttr(e);if(null!=n){if(n[t.BUILDING_REQ_SCALE]>this.scale)return AlertPanel.alertCommon("国家等级不足"),!1;var i=(n[t.BUILDING_ID],n[t.BUILDING_LEVEL],n[t.BUILDING_REQ_MONEY1]),o=n[t.BUILDING_REQ_MONEY3],a=n[t.BUILDING_REQ_WOOD],r=n[t.BUILDING_REQ_STONE],s=n[t.BUILDING_REQ_IRON],l=this;if(i>this.money1||o>this.money3||a>this.wood||r>this.stone||s>this.iron){var _="国库黄金/建筑材料不足，是否前往捐献？";return AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),_,(function(){PanelManager.openManorManageDonate(l)}),this),!1}var h=n[t.BUILDING_REQ_LAND],u=n[t.BUILDING_REQ_PROSPERITY];if(h>this.freeLand||u>this.prosperity){_="空地/国家繁荣度不足，请完成国家相关任务增加";return AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),_,(function(){PanelManager.openManorManageDonate(l)}),this),!1}}return!0},t.getCompareBuildingReqText=function(t,e,n,i){if(0==e)return"";var o=Tool.manageString(GameText.STR_COUNTRY_NOW_HAVE,n+"");return 1==i&&(o=Tool.manageString(GameText.STR_COUNTRY_NOW_LEVEL,n+"")),e>n&&(o=PowerString.makeColorString(o,16711680)),t+e+" "+o+"\n"},t.isBuildingCanDelete=function(t,e){return t!=Define.BUILDING_PALACE&&t!=Define.BUILDING_CAMP&&e>0},t.prototype.getBuildingListNum=function(){return this.buildingList.length},t.prototype.getHaveBuildNum=function(){for(var e=0,n=0;n<this.buildingList.length;n++){this.getBuildingAttrByIndex(n,t.BUILDING_LEVEL)>0&&e++}return e},t.prototype.getBuildingAttrByIndex=function(t,e){var n=this.getBuildingAttr(t);return Tool.isArrayIndexOutOfBounds(e,n)?0:n[e]},t.prototype.getBuildingAttr=function(t){return 0>t||t>=this.buildingList.length?null:this.buildingList[t]},t.prototype.getBuildAttr=function(e,n){if(null==this.buildingList)return 0;for(var i=0;i<this.buildingList.length;i++){var o=this.getBuildingAttr(i);if(null!=o)if(o[t.BUILDING_ID]==e)return o[n]}return 0},t.prototype.isTemp=function(){return this.id<0},t.prototype.getStatus=function(){return this.status},t.prototype.saveIdPublicList=function(){this.idPublicList=this.getIdPublicList()},t.prototype.getIdPublicList=function(){for(var t=[],e=0;e<this.missionPublicList.length;e++){var n=this.missionPublicList[e],i=this.missionPublicList[e];null!=i&&i.select&&t.push(n.getCountryMission().getId())}return t},t.prototype.isSameIdPublicList=function(){var t=this.getIdPublicList();if(null==t||null==this.idPublicList)return!0;if(t.length!=this.idPublicList.length)return!1;for(var e=0;e<this.idPublicList.length;e++)if(null!=this.idPublicList[e])for(var n=this.idPublicList[e],i=0;i<t.length;i++)if(null!=t[e]){if(t[i]==n)break;if(i==t.length-1)return!1}return!0},t.fromBytes=function(e,n){var i=n.getByte();if(i==t.INFO_NORMAL){e.myBookNum=n.getShort(),e.id=n.getInt(),e.name=n.getString(),e.createTime=n.getLong().value,e.status=n.getByte(),e.taxRate=n.getInt(),e.entryTaxMoney1=n.getInt(),e.entryTaxMoney3=n.getInt(),e.kingName=n.getString(),e.affiche=n.getString(),e.unionName=n.getString(),e.warCount=n.getShort(),e.warWinRate=n.getByte(),e.applyPeopleNum=n.getInt(),t.fromBytesReflash(e,n),e.coolKingChange=n.getByte();var o=n.getInt();o>=0&&(xself.countryHonor=o)}else if(i==t.INFO_REFRESH)t.fromBytesReflash(e,n);else if(i==t.INFO_BUILDING)t.fromBytesBuildingList(e,n);else if(i==t.INFO_ENTER)e.entryTaxMoney1=n.getInt(),e.entryTaxMoney3=n.getInt();else if(i==t.INFO_MISSION){var a=n.getByte();e.missionCommonList=[];for(var r=0;a>r;r++)e.missionCommonList.push(CountryTask.fromCountryValidListBytes(n));var s=n.getByte();e.missionAppointList=[];for(r=0;s>r;r++)e.missionAppointList.push(CountryTask.fromCountryValidListBytes(n))}else if(i==t.INFO_COMMAND){e.commandCoolList=Tool.initTwoDimensionalArray(e.getComandList().length,2,0);for(a=n.getByte(),r=0;a>r;r++){var l=n.getByte()-1,_=n.getBoolean(),h=n.getInt();l>=0&&l<e.commandCoolList.length&&(e.commandCoolList[l][0]=Boolean(_),e.commandCoolList[l][1]=Number(h))}e.onlineNotify=n.getBoolean()}},t.fromBytesReflash=function(t,e){t.scale=e.getByte(),t.prosperity=e.getInt(),t.armyStrength=e.getInt(),t.populaceNum=e.getInt(),t.maxPeopleNum=e.getInt(),t.allPeopleNum=e.getInt(),t.freeLand=e.getInt(),t.leagueid=e.getLong().value,t.bookNum=e.getShort(),t.isOpenRecruit=e.getBoolean(),t.money1=e.getInt(),t.money2=e.getInt(),t.money3=e.getInt(),t.wood=e.getInt(),t.stone=e.getInt(),t.iron=e.getInt(),t.freeBuild=e.getByte(),t.issuePoint=e.getByte(),t.prosperityMax=e.getInt(),t.populaceMax=e.getInt();var n=PanelManager.getPanel(ManorManageScene,!1);n&&n.setCountryData(t,n.getSeeOther())},t.fromBytesBuildingList=function(e,n){var i=n.getByte();e.buildingList.length=0;for(var o=0;i>o;o++){var a=new Array(t.BUILDING_ATTR_SIZE);a[t.BUILDING_ID]=n.getByte(),a[t.BUILDING_LEVEL]=n.getByte(),e.buildingList.push(a),t.fromBytesBuildingAttr(e,a[t.BUILDING_ID],a[t.BUILDING_LEVEL],n)}},t.fromBytesBuildingAttr=function(e,n,i,o){if(null!=e)for(var a=0;a<e.buildingList.length;a++){var r=e.buildingList[a];if(null!=r&&r[t.BUILDING_ID]==n){r[t.BUILDING_REQ_MONEY1]=o.getInt(),r[t.BUILDING_REQ_MONEY3]=o.getInt(),r[t.BUILDING_REQ_WOOD]=o.getInt(),r[t.BUILDING_REQ_STONE]=o.getInt(),r[t.BUILDING_REQ_IRON]=o.getInt(),r[t.BUILDING_REQ_LAND]=o.getInt(),r[t.BUILDING_REQ_SCALE]=o.getByte(),r[t.BUILDING_REQ_PROSPERITY]=o.getInt(),r[t.BUILDING_LEVEL]=i;break}}},t.fromBytesMemberList=function(t,e){for(var n=[],i=t.getShort(),o=0;i>o;o++){var a=new ListPlayer;if(0==e){a.setId(t.getInt()),a.setName(t.getString()),a.setLevel(t.getByte()),a.setJob(t.getByte()),a.setSex(t.getByte()),a.setCountryRank(t.getByte()),a.countryHonor=t.getInt(),a.countryBookNum=t.getShort(),t.getBoolean()?a.setStatusBit(ModelConst.STATUS_ONLINE):a.times=t.getInt();var r=t.getByte();if(Tool.isBit(ModelConst.COUNTRY_FFLAG_IS_VIP,r)||Tool.isBit(ModelConst.COUNTRY_FFLAG_IS_VIP_CQ,r)){var s=t.getByte();a.setVipLevel(s)}}else{a.setId(t.getInt()),a.setName(t.getString()),a.setLevel(t.getByte()),a.setJob(t.getByte()),a.setSex(t.getByte()),a.times=t.getInt();r=t.getByte();if(Tool.isBit(ModelConst.COUNTRY_FFLAG_IS_VIP,r)||Tool.isBit(ModelConst.COUNTRY_FFLAG_IS_VIP_CQ,r)){s=t.getByte();a.setVipLevel(s)}}n.push(a)}return n},t.prototype.updateBuildingUpgadeCost=function(e){var n=this.getBuildingAttr(e);null!=n&&(this.money1-=n[t.BUILDING_REQ_MONEY1],this.money3-=n[t.BUILDING_REQ_MONEY3],this.wood-=n[t.BUILDING_REQ_WOOD],this.stone-=n[t.BUILDING_REQ_STONE],this.iron-=n[t.BUILDING_REQ_IRON],this.freeLand-=n[t.BUILDING_REQ_LAND],this.prosperity-=n[t.BUILDING_REQ_PROSPERITY])},t.prototype.doCountryApply=function(){if(0!=SafeLock.doSafeLockVerify()){if(this.id==xself.getCountryId())return void AlertPanel.alertCommon(GameText.STR_COUNTRY_IS_MEMBER);var t=MsgHandler.createCountryApply(this.id);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_INFO_COUNTRY_APPLY)}),this)}},t.prototype.doCountryTaxRateModify=function(){if(0!=SafeLock.doSafeLockVerify()){var t=this;if(0==t.isKing(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO);CommonFormPanel.ChangeTax((function(e){var n=parseInt(e[0]),i=MsgHandler.createCountryTaxRate(t.id,n);nato.Network.sendCmd(i,(function(e){if(0>e.getByte())AlertPanel.errorMessage(e.getString());else{t.taxRate=n;var i=PanelManager.getPanel(ManorManageScene,!1);i&&i.setCountryData(t,i.getSeeOther())}}),this)}),this)}},t.prototype.doCountryEnterRateModify=function(){if(0!=SafeLock.doSafeLockVerify()){var t=this;if(0==t.isKing(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO);CommonFormPanel.changeCountryFee((function(e){""==e[0]&&(e[0]="0"),""==e[1]&&(e[1]="0");var n=parseInt(e[0]),i=parseInt(e[1]),o=MsgHandler.createCountryEnterRate(t.id,n,i);nato.Network.sendCmd(o,(function(e){if(0>e.getByte())AlertPanel.errorMessage(e.getString());else{t.entryTaxMoney1=n,t.entryTaxMoney3=i;var o=PanelManager.getPanel(ManorManageScene,!1);o&&o.setCountryData(t,o.getSeeOther())}}),this)}),t)}},t.prototype.doCountryChangeName=function(t){if(0==SafeLock.doSafeLockVerify())return!1;var e=this;if(0==e.isKing(xself))return AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO),!1;PanelManager.openEditNameView("国家改名","请输入国家名称","国家名称:",(function(t){var n=MsgHandler.createCountryChangeName(t);nato.Network.sendCmd(n,(function(n){if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{e.name=t;var i=PanelManager.getPanel(ManorManageScene,!1);i&&(e.commandCoolList[0][0]=!0,e.bookNum=e.bookNum-1,i.setCountryData(e,i.getSeeOther()),i.setPowerData(e))}}),this)}),null,this)},t.prototype.doCountryRecruit=function(t){if(0==SafeLock.doSafeLockVerify())return!1;var e=this;if(0==e.isKing(xself))return AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO),!1;var n=MsgHandler.createCountryRecruitMsg(e.id,t);nato.Network.sendCmd(n,(function(n){return 0>n.getByte()?void AlertPanel.errorMessage(n.getString()):void(e.isOpenRecruit=t)}),e)},t.prototype.doCountrySetOnlineNotify=function(t){if(0==SafeLock.doSafeLockVerify())return!1;var e=this,n=MsgHandler.createCountrySetOnlineNotify(e.id,t);return nato.Network.sendCmd(n,(function(n){return 0>n.getByte()?void AlertPanel.errorMessage(n.getString()):void(e.onlineNotify=t)}),this),!0},t.doCountryActive=function(e,n){if(0==SafeLock.doSafeLockVerify())return!1;var i=function(e){if(!MsgHandler.isMessageHaveError(e)){null!=n&&(n.status=t.STATUS_NORMAL);var i=e.getByte(),o=e.getInt();null!=xself&&xself.setMoneyByType(i,o),AlertPanel.alertCommon("激活成功！"),PanelManager.isPanelShow(ManorScene)&&PanelManager.getPanel(ManorScene).updateTab()}},o=function(){var t=MsgHandler.createCountryActiveMsg(e);nato.Network.sendCmd(t,i,this)};return AlertPanel.alert(GameText.STR_COUNTRY_ACTIVE,Tool.manageString(GameText.STR_COUNTRY_ACTIVE_INFO,t.ACTIVATE_MONEY[1]+GameText.getMoneyText(t.ACTIVATE_MONEY[0])),(function(){var e=GameWorld.getMoneyArrayValue(t.ACTIVATE_MONEY,Tool.MAX_VALUE_int);Model.checkEnoughMoney(e[0],e[1],e[2],o,this)}),this),!1},t.doCreateCountry=function(t){if(0!=SafeLock.doSafeLockVerify()){var e=MsgHandler.createCountryCreateMsg(t);nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){var n=e.getInt(),i=e.getShort(),o=e.getInt();xself.setCountryId(n),xself.setCountryName(t),xself.setCountryRank(Define.RANK_KING),xself.setMoneyByType(i,o),PanelManager.isPanelShow(ManorScene)&&PanelManager.getPanel(ManorScene).updateTab()}}),this)}},t.prototype.doCountryAfficheModify=function(t){if(0!=SafeLock.doSafeLockVerify()){if(0==this.isChangeNotice(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_AFFICHE_RIGHTLESSDO);var e=this,n=MsgHandler.createCountryAfficheModifyMsg(t);nato.Network.sendCmd(n,(function(n){!MsgHandler.isMessageHaveError(n)&&(e.affiche=t,PanelManager.isPanelShow(ManorScene))&&PanelManager.getPanel(ManorScene).updateTab()}),this)}},t.doViewCountryStatus=function(e){var n=new t(e);return 0==n.isTemp()&&this.getCountryInfo(n),n},t.doViewCountryInfo=function(e){var n=new t(e);t.getCountryInfo(n,t.INFO_NORMAL,!0)},t.doViewCountryInfo2=function(e){var n=new t(e);t.getCountryInfo(n,t.INFO_NORMAL)},t.doViewWarCountryInfo=function(e){var n=new t(e);t.getCountryInfo(n,t.INFO_NORMAL)},t.getCountryBuildingInfo=function(e){1!=e.isLoad(t.LOAD_BUILDING)&&(t.getCountryInfo(e,t.INFO_BUILDING),e.setLoadStatus(!0,t.LOAD_BUILDING))},t.getCountryMainMenu=function(t,e){var n=MsgHandler.createCountryMainMenu();nato.Network.sendCmd(n,(function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());var n=e.getByte(),i=e.getByte();t.usePoint=n,t.issuePoint=i;var o=e.getByte();t.taskMainType=new Array;for(var a=0;o>a;a++){var r=e.getByte(),s=e.getByte();t.taskMainType[a]=[r,s]}var l=PanelManager.getPanel(ManorManageScene,!1);l&&l.setTaskData(t)}}),this)},t.getCountryMissionInfo=function(t){var e=MsgHandler.createCountryGetAllMission();nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){var n=e.getByte();t.missionCommonList=[];for(var i=0;n>i;i++)t.missionCommonList.push(CountryTask.fromCountryAllMissionBytes(e));var o=e.getByte();t.missionAppointList=[];for(i=0;o>i;i++)t.missionAppointList.push(CountryTask.fromCountryAllMissionBytes(e));if(PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update()}}),this),PanelManager.openWaitForServer()},t.getCountryInfo=function(e,n,i,o,a){if(void 0===n&&(n=0),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===a&&(a=null),null!=e){var r=MsgHandler.createBrowseCountryInfoMsg(e.id,n);nato.Network.sendCmd(r,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){if(t.fromBytes(e,n),null!=o&&null!=a)o.call(a);else if(i)PanelManager.openManorManagerScene(e,i);else if(PanelManager.isPanelShow(ManorScene)){PanelManager.getPanel(ManorScene,!1).updateCountryStatus(e)}else if(PanelManager.isPanelShow(CountryTaskListPanel)){PanelManager.getPanel(CountryTaskListPanel).update()}if(PanelManager.isPanelShow(ManorManageScene)){var r=PanelManager.getPanel(ManorManageScene,!1);r&&(r.setBuilddingData(e),r.setPowerData(e),r.setCountryData(e,r.getSeeOther()))}}}),this),PanelManager.openWaitForServer()}},t.getCountryValidMission=function(t){if(null!=t){var e=MsgHandler.createCountryValidMission();nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){var n=e.getShort();t.missionCommonList=[];for(var i=0;n>i;i++)t.missionCommonList.push(CountryTask.fromCountryValidListBytes(e));var o=e.getShort();t.missionAppointList=[];for(i=0;o>i;i++)t.missionAppointList.push(CountryTask.fromCountryValidListBytes(e));var a=e.getBoolean();if(t.isMyMission=a,PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update()}}),this),PanelManager.openWaitForServer()}},t.prototype.doCountryBuildingUpgrade=function(e){if(0!=SafeLock.doSafeLockVerify()){if(0==this.isCreateBuild(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_BUILD_RIGHTLESSDO);var n=this.getBuildingAttrByIndex(e,t.BUILDING_ID),i=this.getBuildingAttrByIndex(e,t.BUILDING_LEVEL);if(13==i)return void AlertPanel.alertCommon(GameText.COUNTRY_BUILDING_LEVEL_UP);var o=this.getBuildingInfo(e,!0),a=this;AlertPanel.alert(t.getBuildingTitle(n,i),o,(function(){if(0!=a.checkIsEnoughBuild(e)){var o=MsgHandler.createCountryBuildingUpgradeMsg(n);nato.Network.sendCmd(o,(function(o){if(null==o)return!1;if(0>o.getByte())AlertPanel.alertCommon(o.getString());else{a.updateBuildingUpgadeCost(e),a.freeBuild=o.getShort(),t.fromBytesBuildingAttr(a,n,i+1,o),a.issuePoint=o.getByte();var r=xworld.getNpcByID(n,!1);null!=r&&r.setTabStatus(!1,Model.NPC_COUNTRY_BLOAD);var s=PanelManager.getPanel(ManorManageScene,!1);s&&s.setBuilddingData(a)}}),this)}}),this)}},t.prototype.doCountryBuildingRemove=function(e){if(0!=SafeLock.doSafeLockVerify()){if(0==this.isRemoveBuild(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_DEL_BUILD_RLESSDO);var n=this.getBuildingAttrByIndex(e,t.BUILDING_ID),i=this.getBuildingAttrByIndex(e,t.BUILDING_LEVEL);if(0==t.isBuildingCanDelete(n,i))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_CANNOT_DEL_BUILD);var o=this;AlertPanel.alert(GameText.STR_COUNTRY_DEL_BUILD,Tool.manageString(GameText.STR_COUNTRY_DEL_BUILD_ASK,PowerString.makeColorString(this.getBuildingName(n,i),16711680)),(function(){var e=MsgHandler.createCountryBuildingRemoveMsg(n);nato.Network.sendCmd(e,(function(e){if(null==e)return!1;if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{o.freeLand=e.getInt(),o.freeBuild=e.getShort(),t.fromBytesBuildingAttr(o,n,0,e);var i=xworld.getNpcByID(n,!1);null!=i&&i.setTabStatus(!1,Model.NPC_COUNTRY_BLOAD);var a=PanelManager.getPanel(ManorManageScene,!1);a&&a.setBuilddingData(o)}}),this)}),this)}},t.prototype.doCountryResourceChange=function(t,e,n){return!1},t.prototype.doCountryBookUse=function(e){if(0==SafeLock.doSafeLockVerify())return!1;var n=this;if(0==n.isKing(xself))return AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO),!1;var i=GameText.STR_COUNTRY_BOOK_USE,o=GameText.STR_COUNTRY_BOOK_USE_ASK;if(e==Define.COUNTRY_COMMAND_ADD_PROSPERITY)i=GameText.STR_COUNTRY_ADD_PROSPERITY,o=Tool.manageStringList(GameText.STR_COUNTRY_ADD_PROSPERITY_INFO,[n.scale+1+"",n.prosperityMax+"",n.prosperityMax*t.getProScale(n.scale)/100+""]);else if(e==Define.COUNTRY_COMMAND_ADD_PEOPLE){var a=n.getBuildAttr(Define.BUILDING_HOUSE,t.BUILDING_LEVEL);i=GameText.STR_COUNTRY_ADD_PEOPLE,o=Tool.manageStringList(GameText.STR_COUNTRY_ADD_PEOPLE_INOF,[a+"",n.populaceMax+"",t.getPopScale(a-1)])}else e==Define.COUNTRY_COMMAND_ADD_LAND?(i=GameText.STR_COUNTRY_ADD_LAND,o=Tool.manageStringList(GameText.STR_COUNTRY_ADD_LAND_INFO,[n.scale+1+"",t.getLandScale(n.scale)+""])):e==Define.COUNTRY_COMMAND_ADD_ARMY?(i=GameText.STR_COUNTRY_ADD_ARMY,o=GameText.STR_COUNTRY_ADD_ARMY_ASK):e==Define.COUNTRY_COMMAND_ADD_ARMY_USELAND&&(i=GameText.STR_COUNTRY_ADD_ARMY_USELAND,o=GameText.STR_COUNTRY_ARMY_USELAND_INFO);var r=function(){var i=MsgHandler.createCountryBookMsg(e);nato.Network.sendCmd(i,(function(i){if(null==i)return!1;if(0>i.getByte())AlertPanel.errorMessage(i.getString());else{i.getBoolean()?t.fromBytesReflash(n,i):n.bookNum-=1;var o=e-1;null!=n.commandCoolList[o]&&(n.commandCoolList[o][0]=new Boolean(!0),n.commandCoolList[o][1]=new Number(n.commandCoolList[o][1]-1)),AlertPanel.alertCommon(GameText.STR_COUNTRY_USE_BOOK_SUCCESS);var a=PanelManager.getPanel(ManorManageScene,!1);a&&a.setPowerData(n)}}),this)},s=function(t){"ok"==t&&r()};return AlertPanel.alert(i,o,(function(){return e==Define.COUNTRY_COMMAND_ADD_ARMY_USELAND?void t.doSureCountryAddArmyUseLand(s):void r()}),this),!0},t.doSureCountryAddArmyUseLand=function(t){CommonFormPanel.countryArmyValue((function(e){t("ok"==e[0].trim().toLowerCase()?"ok":"")}),this)},t.doEnterCountry=function(e){if(null!=e){var n=function(t){var n=t.getByte();if(0>n)-2==n?PanelManager.closeScene(!0):AlertPanel.errorMessage(t.getString());else{if(1==n)return e.entryTaxMoney1=t.getInt(),e.entryTaxMoney3=t.getInt(),void AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_ENTER_TWICE_SURE,GameText.getMoneyText(ModelConst.MONEY1)+e.entryTaxMoney1+","+GameText.getMoneyText(ModelConst.MONEY3)+e.entryTaxMoney3));var i=t.getInt(),o=t.getInt();xself.setPlayerMoneyValue(i,-1,o),MsgHandler.instance.processDataBlockFlagMsg(t),PanelManager.closeScene(!0)}},i=function(){var t=MsgHandler.createJumpCountryMessage(e.id,Define.JUMP_MAP_DATA_FLAG,e.entryTaxMoney1,e.entryTaxMoney3);nato.Network.sendCmd(t,n,this)},o=t.doGetNeedPayMemberNum(e);if(o>0){if(e.entryTaxMoney1>0||e.entryTaxMoney3>0){if(0==SafeLock.doSafeLockVerify())return;var a;a=1==o&&0==xself.isInTeam()?GameText.STR_COUNTRY_ENTER_ONE_NEED_PAY:GameText.STR_COUNTRY_ENTER_TEAM_NEED_PAY,AlertPanel.alert(GameText.STR_COUNTRY_ENTER_PAY,Tool.manageString(GameText.STR_COUNTRY_ENTER_ASK,a+PowerString.makeColorString(e.entryTaxMoney1>0?GameText.STR_MONEY1+e.entryTaxMoney1*o+"\n":"",ColorUtils.COLOR_YELLOW)+PowerString.makeColorString(e.entryTaxMoney3>0?GameText.STR_MONEY3+e.entryTaxMoney3*o+"\n":"",ColorUtils.COLOR_MONEY3)),(function(){i()}),this)}else i()}else i()}},t.doGetNeedPayMemberNum=function(t){if(null==t)return 0;var e=0;0==t.isMyCountry(xself)&&e++;var n=xself.getMembers();if(null==n||n.length<=0)return e;for(var i=n.length-1;i>=0;i--){var o=n[i];null!=o&&5!=o.getType()&&1!=t.isMyCountry(o)&&e++}return e},t.doLeaveCountry=function(t){if(0!=SafeLock.doSafeLockVerify()){var e=xself;if(null!=e){AlertPanel.alert(GameText.STR_COUNTRY_LEAVE,Tool.manageString(GameText.STR_COUNTRY_LEAVE_ASK,t.name),(function(){var n=MsgHandler.createCountryLeaveMsg();nato.Network.sendCmd(n,(function(n){return 0>n.getByte()?void AlertPanel.errorMessage(n.getString()):(e.clearCountry(),PanelManager.closeScene(!0),void AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_LEAVE_SUCCESS,PowerString.makeColorString(t.name,16776960))))}),this)}),this)}}},t.doCountryMemberList=function(e,n,i){if(null==e)return null;var o,a=e.searchMemberStatus==Define.SEARCH_MEM_APPLY;o=0==a?MsgHandler.createCountryMemberListMsg(e.id,e.searchRankID,n,i,e.searchMemberStatus):MsgHandler.createCountryMemberAppleListMsg(n,i);nato.Network.sendCmd(o,(function(n){if(null==n)return null;var i=n.getInt();if(0>i)AlertPanel.errorMessage(n.getString());else{var o=i;e.memberList=t.fromBytesMemberList(n,a),(null==e.memberList||e.memberList.length<=0)&&0==a&&AlertPanel.alertCommon(GameText.STR_COUNTRY_MEMBER_MISMATCH);var r=PanelManager.getPanel(ManorManageScene,!1);r&&r.manorManageMember&&r.setMemberData(e,o)}}),this)},t.doCountryApplyDeal=function(t,e,n){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e||1==e.isTabStatus(Model.DEL_STATUS))return!1;if(0==t.isDealApply(xself))return AlertPanel.alertCommon(GameText.STR_COUNTRY_APPLY_DEAL_LESSDO),!1;var i=MsgHandler.createCountryApplyDealMsg(e.getId(),n);nato.Network.sendCmd(i,(function(t){if(null==t)return!1;var i=GameText.getText(GameText.TI_MISSION_REFUSE);n&&(i=GameText.STR_COUNTRY_APPLY_AGREE),AlertPanel.alertTips(GameText.STR_COUNTRY_APPLY_DEAL,Tool.manageStringList(GameText.STR_COUNTRY_APPLY_DEAL_INFO,[i,e.getName()])),e.setTabStatus(!0,Model.DEL_STATUS);var o=PanelManager.getPanel(ManorManageScene,!1);o&&o.manorManageMember&&o.manorManageMember.getMemberInfo()}),this)},t.doCountryApplyAllDeal=function(t,e){if(0!=SafeLock.doSafeLockVerify()){if(0==t.isDealApply(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_APPLY_DEAL_LESSDO);var n=MsgHandler.createCountryApplyDealMsg(-1,e);nato.Network.sendCmd(n,(function(){var t=GameText.getText(GameText.TI_MISSION_REFUSE);e&&(t=GameText.STR_COUNTRY_APPLY_AGREE),AlertPanel.alertCommon(GameText.STR_COUNTRY_APPLY_DEAL_ALL,Tool.manageString(GameText.STR_COUNTRY_APPLY_DEAL_ALL_INFO,t));var n=PanelManager.getPanel(ManorManageScene,!1);n&&n.manorManageMember&&n.manorManageMember.getMemberInfo()}),this)}},t.doCountryDelMem=function(t){if(0!=SafeLock.doSafeLockVerify()&&null!=t&&1!=t.isTabStatus(Model.DEL_STATUS)){AlertPanel.alert(GameText.STR_COUNTRY_DEL_MENBER,Tool.manageString(GameText.STR_COUNTRY_DEL_MENBER_ASK,t.getName()),(function(){var e=MsgHandler.createCountryDelMemMsg(t.getId());nato.Network.sendCmd(e,(function(e){if(null==e)return!1;if(0>e.getByte())AlertPanel.errorMessage(e.getString());else{AlertPanel.alertCommon(GameText.STR_COUNTRY_DEL_MENBER,Tool.manageString(GameText.STR_COUNTRY_DEL_MENBER_SUCCESS,t.getName())),t.setTabStatus(!0,Model.DEL_STATUS);var n=PanelManager.getPanel(ManorManageScene,!1);n&&n.manorManageMember&&n.manorManageMember.getMemberInfo()}}),this)}),this)}},t.doCountryList=function(e,n,i){if(null==e)return null;var o=MsgHandler.createCountryListMsg(e.searchBuildingID,n,i);nato.Network.sendCmd(o,(function(i){PanelManager.closeWaitForServer();var o=i.getInt();if(0>o)AlertPanel.errorMessage(i.getString());else{for(var a=o,r=i.getShort(),s=[],l=0;r>l;l++){var _=new t(-1);_.id=i.getInt(),_.name=i.getString(),_.entryTaxMoney1=i.getInt(),_.entryTaxMoney3=i.getInt(),e.searchBuildingID<=0?(_.scale=i.getByte(),_.searchBuildingLevel=_.scale+1):_.searchBuildingLevel=i.getByte(),_.idefinecation=i.getBoolean(),s.push(_)}if(e.idefinecationInfo=i.getString(),e.countryList=s,PanelManager.isPanelShow(ManorScene)){var h=PanelManager.getPanel(ManorScene),u=Math.ceil(a/n);h.updateCountryList(e,u)}}}),this),PanelManager.openWaitForServer()},t.prototype.getStatusLevel=function(t){return 0>=t?this.scale+1:this.searchBuildingLevel},t.prototype.isValidStoragePos=function(t){return-1==this.numStore||t>=0&&t<=this.numStore-1},t.prototype.getStoreItem=function(t){return 0==Tool.isArrayIndexOutOfBounds(t,this.storeItemList)?this.storeItemList[t]:null},t.prototype.removeStoreItem=function(t){if(null!=this.storeItemList){var e=this.storeItemList.indexOf(t);if(-1!=e)return this.storeItemList.splice(e,1),!0}return!1},t.prototype.isSystemStore=function(){return this.isLoad(t.SET_STORAGE_SYSTEM)},t.prototype.doCountryStorageList=function(e){var n=this,i=MsgHandler.createCountryStorageList(e);nato.Network.sendCmd(i,(function(i){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(i)){n.setLoadStatus(e,t.SET_STORAGE_SYSTEM),n.numStore=i.getByte(),n.storeItemList=new Array;for(var o=i.getShort(),a=0;o>a;a++)n.storeItemList.push(ShopItem.fromBytesCountryStoreItem(i));var r=e?StorePanel.Type_country_system:StorePanel.Type_country;PanelManager.openStorePanel(r,xself,!1,n)}}),this),PanelManager.openWaitForServer()},t.doCountryStoragePut=function(t,e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=t&&null!=e&&null!=e.bag&&null!=n){CommonFormPanel.createPutInCountryStore((function(i){var o=Number(i[0]),a=Number(i[1]);if(o>n.quantity)AlertPanel.alertCommon(GameText.STR_COUNTRY_STORAGE_SUPER_LIMIT);else{var r=MsgHandler.createCountryStoragePut(n.slotPos,o,n.id,a);nato.Network.sendCmd(r,(function(i){if(!MsgHandler.isMessageHaveError(i)){var r=i.getLong(),s=i.getString();e.bag.removeBagItemByPos(n.slotPos,o);var l=new ShopItem;n.setItemDataTo(l),l.status=n.status,l.quantity=o,l.uid=r,l.honor=a,0==Tool.isNullText(s)&&(l.name=s),l.name+=Tool.manageString(GameText.STR_COUNTRY_CONTRIBUTION,a+""),t.storeItemList.push(l);var _=PanelManager.getPanel(StorePanel,!1);_&&(_.setData(StorePanel.Type_country,xself,t),_.update())}}),this)}}),this,n.quantity)}},t.doCountryStoreGet=function(t,e){function n(n){if(!MsgHandler.isMessageHaveError(n)){MsgHandler.processAddItemMsg(n);var a=n.getInt();if(o.countryHonor=a,0==t.isSystemStore()&&t.removeStoreItem(e),PanelManager.closeItemView(),PanelManager.isPanelShow(StorePanel))PanelManager.getPanel(StorePanel).update();(s-=1)>0?egret.callLater(i,this):PanelManager.closeItemExchangePanel()}}function i(){var i=t.isSystemStore(),o=MsgHandler.createCountryStorageGet(i,e.uid);nato.Network.sendCmd(o,n,this)}if(0!=SafeLock.doSafeLockVerify()&&null!=t&&null!=e&&e instanceof ShopItem){var o=xself;if(null!=o){var a=e.honor,r=o.countryHonor,s=0;PanelManager.openItemExchangePanel(a,(function(t){return a*t>r?void AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_STORAGE_GET_FAIL,a*t+"")):(s=t,void i())}),this)}}},t.doCountryStoreDel=function(t,e){if(0!=SafeLock.doSafeLockVerify()&&null!=t&&null!=e&&e instanceof ShopItem){var n=MsgHandler.createCountryStorageDel(e.uid);nato.Network.sendCmd(n,(function(n){(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)&&(t.removeStoreItem(e),PanelManager.closeItemView(),PanelManager.isPanelShow(StorePanel)))&&PanelManager.getPanel(StorePanel).update()}),this),PanelManager.openWaitForServer()}},t.doCountryAdjustJob=function(t){if(0!=SafeLock.doSafeLockVerify()&&null!=t){for(var e=new Array,n=Array(),i=xself.getCountryRank()+1;4>=i;i++)n.push(Define.getRankString(i)),e.push(i);if(0==n.length)return void AlertPanel.alertCommon(GameText.STR_COUNTRY_ADJUST_JOB_EMPTY);t.getCountryRank()!=Define.RANK_LORD&&t.getCountryRank()!=Define.RANK_COMTE&&t.getCountryRank()!=Define.RANK_VICOMTE&&t.getCountryRank()!=Define.RANK_NATIONAL&&(n.push(GameText.STR_COUNTRY_RECALL),e.push(Define.RANK_NO_RANK)),n.push(GameText.getText(GameText.TI_BACK)),e.push(-1),PanelManager.openAchieveTitleList(n,e,AchieveTitleList.TYPE_COUNTRY,t)}},t.doCountryAdjustJob2=function(t,e){if(null!=t){var n=Tool.manageStringList(GameText.STR_COUNTRY_ADJUST_JOB_ASK,[t.getName(),Define.getRankString(e)]);e==Define.RANK_NO_RANK&&(e=-1,n=Tool.manageString(GameText.STR_COUNTRY_RECALL_ASK,t.getName()));AlertPanel.alert(GameText.getText(GameText.TI_ADJUST_JOB),n,(function(){var n=MsgHandler.createCountryAdjustJobMessage(t.getId(),e);nato.Network.sendCmd(n,(function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());var n=e.getByte();t.setCountryRank(n);var i=PanelManager.getPanel(ManorManageScene,!1);i&&i.manorManageMember&&i.manorManageMember.getMemberInfo(),PanelManager.getPanel(AchieveTitleList,!1)&&PanelManager.closeAchieveTitleList()}}),this)}),this)}},t.doCountryBecomeKing=function(e){if(0!=SafeLock.doSafeLockVerify()&&null!=e){var n=this,i=function(t){"ok"==t&&function(){var t=MsgHandler.createCountryBecomeKingMessage(e.getId());nato.Network.sendCmd(t,(function(t){if(null!=t){if(0>t.getByte())return void AlertPanel.errorMessage(t.getString());e.setCountryRank(Define.RANK_KING);var n=xself,i=t.getByte();null!=n&&n.setCountryRank(i);var o=t.getByte(),a=PanelManager.getPanel(ManorScene,!1);if(a&&a.statusPanel){var r=PanelManager.getPanel(ManorManageScene,!1);if(r){var s=r.getCountry();s.coolKingChange=o,s.kingName=e.getName(),a.setTab(ManorScene.TAB_INDEX_STATUS),PanelManager.openScene(a),a.updateCountryStatus(s)}}}}),n)}()};AlertPanel.alert(GameText.STR_COUNTRY_BECOME_KILL,Tool.manageString(GameText.STR_COUNTRY_BECOME_KILL_ASK,e.getName()),(function(){t.doSureCountryBecomeKing(i)}),this)}},t.doSureCountryBecomeKing=function(t){CommonFormPanel.countryKing((function(e){t("ok"==e[0].trim().toLowerCase()?"ok":"")}),this)},t.prototype.doCountryMissionList=function(t){this.missionPublicList=new Array;var e=MsgHandler.createCountryGetMission(t),n=this;nato.Network.sendCmd(e,(function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());for(var i=e.getByte(),o=0;i>o;o++)n.missionPublicList.push(CountryTask.fromCountryNotValidListBytes(e));n.usePoint=e.getByte(),n.issuePoint=e.getByte(),n.saveIdPublicList(),PanelManager.openManorManageTaskReleasePanel(n.missionPublicList,n,t);var a=PanelManager.getPanel(ManorManageScene,!1);a&&a.setTaskData(n)}}),this)},t.prototype.doCountryMissionAppointList=function(){var t=this,e=MsgHandler.createCountryAssingMission();nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){for(var n=[],i=e.getByte(),o=0;i>o;o++)n.push(CountryTask.fromCountryAppointListBytes(e));if(t.missionPublicList=n,PanelManager.isPanelShow(CountryTaskListPanel))PanelManager.getPanel(CountryTaskListPanel).update()}}),this),PanelManager.openWaitForServer()},t.doCountryPublishMission=function(e,n){if(0!=n.isPublishMission(xself)){var i=n.getIdPublicList();n.setLoadStatus(!0,t.IS_OPERATE_MISSION);var o=MsgHandler.createCountryPublishMission(e,i);nato.Network.sendCmd(o,(function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):(n.saveIdPublicList(),void AlertPanel.alertCommon(GameText.STR_COUNTRY_DO_MISSION_SUCCESS))}),this)}else AlertPanel.alertCommon(GameText.STR_COUNTRY_MISSION_RIGHTLESSDO)},t.doCountryAssignMemList=function(e,n){if(null==e||null==n||null==n.mission)return null;var i=!1;0==e.isLoad(t.LOAD_FIRST_ASSIGN)&&(i=!0,e.setLoadStatus(!0,t.LOAD_FIRST_ASSIGN));var o=e.allPeopleNum;1>o&&(o=100);var a=MsgHandler.createCountryAssignMem(o,0,n.mission.getId(),i);nato.Network.sendCmd(a,(function(t){if(PanelManager.closeWaitForServer(),0>t.getInt())AlertPanel.errorMessage(t.getString());else{for(var n=t.getShort(),i=[],o=0;n>o;o++)i.push(ListPlayer.fromBytesToCountryAssingMem(t));if(e.appointListPlayerList=i,t.getBoolean()){var a=t.getByte();e.assignModelList={};for(o=0;a>o;o++){var r=ListPlayer.fromBytesToCountryAssingMem(t);null!=r&&(e.assignModelList[r.getId().toString()]=r)}}}}),this),PanelManager.openWaitForServer()},t.prototype.isAssignMem=function(t){return!1},t.doCountryAssignMission=function(t,e){return!0},t.prototype.toString=function(){var t=new StringBuffer;return t.append("国家名:"+name+"("+this.id+")\n"),t.append("创建种族:"+Define.getRaceString(this.createRace)+"\n"),t.append("状态:"+this.status+"\n"),t.append("规模:"+this.scale+"\n"),t.append("繁荣度:"+this.prosperity+"\n"),t.append("军力值:"+this.armyStrength+"\n"),t.append("民众数量:"+this.populaceNum+"\n"),t.append("国家成员上限:"+this.maxPeopleNum+"\n"),t.append("国家成员数量:"+this.allPeopleNum+"\n"),t.append("空余土地:"+this.freeLand+"\n"),t.append("空余建筑点:"+this.freeBuild+"\n"),t.append("指令书:"+this.bookNum+"\n"),t.append("招募:"+(this.isOpenRecruit?"是":"否")+"\n"),t.append("国库黄金:"+this.money1+"\n"),t.append("国库铜币:"+this.money3+"\n"),t.append("木材:"+this.wood+"\n"),t.append("石矿:"+this.stone+"\n"),t.append("铁矿:"+this.iron+"\n"),t.append("税率:"+this.taxRate+"\n"),t.append("入境税:"+this.entryTaxMoney1+"金  "+this.entryTaxMoney3+"铜\n"),t.toString()},t.prototype.isMyCountry=function(t){return null!=t&&this.id==t.getCountryId()},t.prototype.isChangeNotice=function(t){if(null==t)return!1;var e=t.getCountryRank();return e==Define.RANK_KING||e==Define.RANK_PRIME||e==Define.RANK_MARSHAL},t.prototype.isDealApply=function(t){if(null==t)return!1;var e=t.getCountryRank();return e==Define.RANK_KING||e==Define.RANK_PRIME||e==Define.RANK_MARSHAL||e==Define.RANK_KNIGHT},t.prototype.isRemoveBuild=function(t){return null!=t&&(t.getCountryId()==this.id&&t.getCountryRank()==Define.RANK_KING)},t.prototype.isCreateBuild=function(t){if(null==t)return!1;if(t.getCountryId()!=this.id)return!1;var e=t.getCountryRank();return e==Define.RANK_KING||e==Define.RANK_PRIME},t.prototype.isPublishMission=function(t){if(null==t)return!1;if(t.getCountryId()!=this.id)return!1;var e=t.getCountryRank();return e==Define.RANK_KING||e==Define.RANK_PRIME},t.prototype.isAssignMission=function(t){return!1},t.prototype.isKing=function(t){return null!=t&&(t.getCountryId()==this.id&&t.getCountryRank()==Define.RANK_KING)},t.handleCountryMissionAction=function(t,e){var n=xself;if(null!=n&&null!=t){if(null!=n.getMissionById(t.getId()))return t.isComplete()?void NPC.doMissionInfoView(n,t,new NPC,NPCConst.SUB_MISSION_SUBMIT_NORMAL):void NPC.doMissionInfoView(n,t,new NPC,NPCConst.SUB_MISSION_DOING);if(t.isCanAccept()){var i=NPCConst.SUB_MISSION_ACCEPT;return 1==t.isDirectSubmit()&&(i=NPCConst.SUB_MISSION_DIRECT_STEP1),void NPC.doMissionInfoView(n,t,new NPC,i)}var o=Tool.isNullText(t.dialogNotStartNotReady)?GameText.STR_COUNTRY_INSUFFICIENT_COND:t.dialogNotStartNotReady;AlertPanel.alertCommon(o)}},t.doCountryPeopleDonateAction=function(t,e){var n=xself;if(null!=n){var i=n.bag;if(null!=i&&null!=e){var o,a=e[0],r=e[1],s=0;switch(a){case Define.DONATE_TYPE_MONEY3:if(0>(s=n.get(ModelConst.MONEY3)-r))return o=Tool.manageString(GameText.STR_COUNTRY_DONATE_LACK,PowerString.makeColorString(-s+GameText.STR_MONEY3,ColorUtils.COLOR_RED)),void AlertPanel.alertMaterialLess(o,ItemGet.Type_money3);break;case Define.DONATE_TYPE_MONEY1:if(0>(s=n.get(ModelConst.MONEY1)-r)){o=Tool.manageString(GameText.STR_COUNTRY_DONATE_LACK,PowerString.makeColorString(-s+GameText.STR_MONEY1,ColorUtils.COLOR_RED));return void AlertPanel.alert(GameText.STR_MODEL_MONEY_NOT_ENOUGHT_TI,o+"，"+GameText.STR_MODEL_BILL_ASK,(function(){PayInfo.getPayList()}),this)}break;case Define.DONATE_TYPE_WOOD:if(0>(s=i.getItemNumByID(Define.ITEM_ID_WOOD)-r))return o=Tool.manageString(GameText.STR_COUNTRY_DONATE_LACK,PowerString.makeColorString(-s+GameText.STR_COUNTRY_WOOD,ColorUtils.COLOR_RED)),void AlertPanel.alertMaterialLess(o,ItemGet.Type_countryMaterial,1);break;case Define.DONATE_TYPE_STONE:if(0>(s=i.getItemNumByID(Define.ITEM_ID_STONE)-r))return o=Tool.manageString(GameText.STR_COUNTRY_DONATE_LACK,PowerString.makeColorString(-s+GameText.STR_COUNTRY_STONE,ColorUtils.COLOR_RED)),void AlertPanel.alertMaterialLess(o,ItemGet.Type_countryMaterial,2);break;case Define.DONATE_TYPE_IRON:if(0>(s=i.getItemNumByID(Define.ITEM_ID_IRON)-r))return o=Tool.manageString(GameText.STR_COUNTRY_DONATE_LACK,PowerString.makeColorString(-s+GameText.STR_COUNTRY_IRON,ColorUtils.COLOR_RED)),void AlertPanel.alertMaterialLess(o,ItemGet.Type_countryMaterial,3);break;default:AlertPanel.alertCommon(GameText.STR_COUNTRY_DONATE_ERROR)}var l=MsgHandler.createCountryPeopleDonate(a,r);nato.Network.sendCmd(l,(function(e){if(PanelManager.closeWaitForServer(),null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());for(var i=e.getByte(),o=0;i>o;o++){var s=e.getShort(),l=e.getByte(),_=(e.getInt(),n.bag.getItem(s));null!=_&&_.id;n.bag.removeBagItemByPos(s,l);Define.SUCCESS}var h=e.getInt();if(n.countryHonor=h,n.setMoneyByType(ModelConst.MONEY1,e.getInt()),n.setMoneyByType(ModelConst.MONEY3,e.getInt()),null!=t)switch(a){case Define.DONATE_TYPE_MONEY1:t.money1+=r;break;case Define.DONATE_TYPE_MONEY3:t.money3>0&&r>0&&t.money3+r<0?t.money3=Number.MAX_VALUE:(t.money3+=r,t.money3<0&&(t.money3=0));break;case Define.DONATE_TYPE_WOOD:t.wood+=r;break;case Define.DONATE_TYPE_STONE:t.stone+=r;break;case Define.DONATE_TYPE_IRON:t.iron+=r}var u=PanelManager.getPanel(ManorManageDonate);u&&u.update(),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_DONATE_SUCCESS,h+""))}}),this),PanelManager.openWaitForServer()}}},t.doCountryResourseAction=function(e,n){if(null!=n&&5==n.length){var i=MsgHandler.createCountryBookMsgId(Define.COUNTRY_COMMAND_TRANSFER_RESOURCE,n[0]);nato.Network.sendCmd(i,(function(n){if(null==n)return!1;if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{n.getBoolean()&&t.fromBytesReflash(e,n);var i=PanelManager.getPanel(ManorManageResourse);i&&i.update(),AlertPanel.alertCommon(GameText.STR_COUNTRY_RESOUTSE_SUCCESS)}}),this)}},t.prototype.getLoadDonateData=function(){1!=this.isLoad(t.LOAD_DONATE_LIST)&&this.setLoadStatus(!0,t.LOAD_DONATE_LIST)},t.prototype.getLoadResourseData=function(){var t=this,e=MsgHandler.createCountryExchargeData();nato.Network.sendCmd(e,(function(e){if(null!=e){for(var n=[],i=[],o=0;3>o;o++){var a=e.getByte();i[o]=[],n[o]=[];for(var r=0;a>r;r++){i[o][r]=[],n[o][r]=[];for(var s=0;5>s;s++)i[o][r][s]=e.getShort();n[o][r][0]=Define.getResourseText(i[o][r][1],i[o][r][2]),n[o][r][1]=Define.getResourseText(i[o][r][3],i[o][r][4])}}PanelManager.openManorManageResourse(t,n,i)}}),this)},t.prototype.getCountryDonateText=function(t){return null},t.prototype.getCountryDonateObj=function(t){return null},t.prototype.getCountryResourseText=function(t){return null},t.prototype.getCountryResourseObj=function(t){return null},t.getProScale=function(t){var e=90-10*t;return 10>=e?10:e},t.getPopScale=function(t){return 300+50*t},t.getLandScale=function(t){return 300+50*t},t.getWarTypeText=function(e){switch(e){case t.WAR_TYEP_XXX:return GameText.STR_COUNTRY_WAR_TYEP_XXX;case t.WAR_TYEP_MONEY:return GameText.STR_COUNTRY_WAR_TYEP_MONEY;case t.WAR_TYEP_BUILD:return GameText.STR_COUNTRY_WAR_TYEP_BUILD;default:return GameText.getText(GameText.TI_OTHER)}},t.getUnionStatusText=function(e){switch(e){case t.UNION_STATUS_NORMAL:return GameText.STR_COUNTRY_UNION_STATUS_NORMAL;case t.UNION_STATUS_PROTECT:return GameText.STR_COUNTRY_UNION_STATUS_PROTECT;case t.UNION_STATUS_WAR:return GameText.STR_COUNTRY_UNION_STATUS_WAR;case t.UNION_STATUS_TEST:return GameText.STR_COUNTRY_UNION_STATUS_TEST;default:return GameText.getText(GameText.TI_OTHER)}},t.doUIGetWarTopList=function(e,n,i){switch(e){case CountryWarTopScene.TAB_INDEX_CURRENT:return t.doGetWarTopPlayer(e,n,i);case CountryWarTopScene.TAB_INDEX_HERO:return t.doGetWarTopCountryPlayer(e,n,i);case CountryWarTopScene.TAB_INDEX_COUNTRY:return t.doGetWarTopCountry(e,n,i);default:return null}},t.doGetWarTopPlayer=function(t,e,n){var i=MsgHandler.createWarTopPlayer(e,n);nato.Network.sendCmd(i,(function(e){PanelManager.closeWaitForServer();var n=e.getInt();if(0>n)AlertPanel.errorMessage(e.getString());else{for(var i=[],o=e.getByte(),a=0;o>a;a++){var r=new ListPlayer;r.setId(e.getInt()),r.setName(e.getString()),r.setLevel(e.getByte()),r.setJob(e.getByte());var s=e.getShort(),l=e.getShort();r.killInfo=l+" / "+s,i.push(r)}if(PanelManager.isPanelShow(CountryWarTopScene)){var _=PanelManager.getPanel(CountryWarTopScene);_.setData(t,i,n),_.updateTab()}}}),this),PanelManager.openWaitForServer()},t.doGetWarTopCountryPlayer=function(t,e,n){var i=MsgHandler.createWarTopCountryPlayer(e,n);nato.Network.sendCmd(i,(function(e){PanelManager.closeWaitForServer();var n=e.getInt();if(0>n)AlertPanel.errorMessage(e.getString());else{for(var i=[],o=e.getByte(),a=0;o>a;a++){var r=new ListPlayer;r.setId(e.getInt()),r.setName(e.getString()),r.setLevel(e.getByte()),r.setJob(e.getByte());var s=e.getInt(),l=e.getInt();r.killInfo=l+" / "+s,i.push(r)}if(PanelManager.isPanelShow(CountryWarTopScene)){var _=PanelManager.getPanel(CountryWarTopScene);_.setData(t,i,n),_.updateTab()}}}),this),PanelManager.openWaitForServer()},t.doGetWarTopCountry=function(e,n,i){var o=MsgHandler.createWarTopCountry(n,i);nato.Network.sendCmd(o,(function(n){PanelManager.closeWaitForServer();var i=n.getInt();if(0>i)return AlertPanel.errorMessage(n.getString()),null;for(var o=[],a=n.getByte(),r=0;a>r;r++){var s=new t(n.getInt());s.name=n.getString(),s.scale=n.getByte();var l=n.getShort(),_=n.getShort();s.warInfo=l+" / "+_,o.push(s)}if(PanelManager.isPanelShow(CountryWarTopScene)){var h=PanelManager.getPanel(CountryWarTopScene);h.setData(e,o,i),h.updateTab()}}),this),PanelManager.openWaitForServer()},t.prototype.getUnionInfo2=function(){var t=0;return null!=this.myUnionList&&(t=this.myUnionList.length),"【"+t+"】"+this.name},t.prototype.getUnionInfo1=function(){return this.name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.getScale()+"")+")"},t.prototype.getUnionInfo3=function(){return this.name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.getScale()+"")+this.getUnionStatus()+")"},t.prototype.isApplyUnion=function(){return this.isLoad(t.WAR_IS_APPLY_UNION)},t.prototype.isUnionOwner=function(){return this.isLoad(t.WAR_IS_UNION_OWNER)},t.prototype.getUnionStatus=function(){return this.isApplyUnion()?GameText.STR_COUNTRY_UNION_APPLY_NOW:this.isUnionOwner()?GameText.STR_COUNTRY_UNION_OWNER:GameText.STR_COUNTRY_UNION},t.prototype.getUnionOwer=function(){if(null==this.myUnionList||0==this.myUnionList.length)return null;for(var t=0;t<this.myUnionList.length;t++){var e=this.myUnionList[t];if(null!=e&&e.isUnionOwner())return e}return null},t.doUnionApplyHelp=function(t){if(null!=t){var e=t.id;if(!(0>=e)){var n=MsgHandler.createWarUnionApplyHelp(e);nato.Network.sendCmd(n,(function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(GameText.STR_COUNTRY_UNION_APPLY_SUCCESS)}),this)}}},t.doUnionChange=function(e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=n){var i=MsgHandler.createWarUnionChange(n.id);nato.Network.sendCmd(i,(function(i){if(!MsgHandler.isMessageHaveError(i)){if(null!=e){var o=e.getUnionOwer();null!=o&&o.setLoadStatus(!1,t.WAR_IS_UNION_OWNER)}if(n.setLoadStatus(!0,t.WAR_IS_UNION_OWNER),e.myUnionList){var a=e.myUnionList.indexOf(n);a>=0&&e.myUnionList.unshift(e.myUnionList.splice(a,1)[0])}xevent.dispatchEvent(new WorldEvent(WorldEvent.MY_UNION_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_UNION_CHANGE_SUCCESS)}}),this)}},t.doUnionDelMember=function(t,e){if(0!=SafeLock.doSafeLockVerify()&&null!=e){AlertPanel.alert(GameText.getText(GameText.TI_WARN),Tool.manageString(GameText.STR_COUNTRY_UNION_DEL_MEN_ASK,e.name),(function(){var n=MsgHandler.createWarUnionDelMember(e.id);nato.Network.sendCmd(n,(function(n){if(!MsgHandler.isMessageHaveError(n)&&null!=t&&null!=t.myUnionList){var i=t.myUnionList.indexOf(e);i>=0&&t.myUnionList.splice(i,1),xevent.dispatchEvent(new WorldEvent(WorldEvent.MY_UNION_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_DEL_MEN_SUCCESS)}}),this)}),this)}},t.doDealApplyUnion=function(e,n,i,o){if(0!=SafeLock.doSafeLockVerify()&&null!=n){PanelManager.openWaitForServer();var a=MsgHandler.createWarUnionDealApply(n.id,i);nato.Network.sendCmd(a,(function(o){if(PanelManager.closeWaitForServer(),o){if(0>o.getByte())return void AlertPanel.errorMessage(o.getString());if(i)n.setLoadStatus(!1,t.WAR_IS_APPLY_UNION);else if(null!=e&&null!=e.myUnionList){var a=e.myUnionList.indexOf(n);a>=0&&e.myUnionList.splice(a,1)}xevent.dispatchEvent(new WorldEvent(WorldEvent.MY_UNION_UPDATE));var r=GameText.getText(GameText.TI_MISSION_REFUSE);i&&(r=GameText.STR_COUNTRY_APPLY_AGREE),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_DEAL_UNION_APPLY,r))}}),this)}},t.doAddUnion=function(t,e){if(0!=SafeLock.doSafeLockVerify()&&null!=t&&null!=e){var n=(e.getScale(),5);AlertPanel.alert(GameText.getText(GameText.TI_WARN),Tool.manageStringList(GameText.STR_COUNTRY_ADD_UNION_ASK,[n,GameText.STR_MONEY1+100,GameText.STR_MONEY3+5e5]),(function(){var e=t.leagueid,n=MsgHandler.createWarUnionApply(e);nato.Network.sendCmd(n,(function(t){if(t)return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_COUNTRY_ADD_UNION_WAIT)}),this)}),this)}},t.doQuitUnion=function(t,e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=t){AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_COUNTRY_QUIT_UNION_ASK,(function(){var i=MsgHandler.createWarUnionQuit();nato.Network.sendCmd(i,(function(i){MsgHandler.isMessageHaveError(i)||(t.leagueid=null,t.unionName="",e.call(n),AlertPanel.alertCommon(GameText.STR_COUNTRY_QUIT_UNION_SUCCESS))}),this)}),this)}},t.doCreateUnion=function(e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=e&&!Tool.isNullText(n)){PanelManager.openWaitForServer();var i=MsgHandler.createWarUnionCreate(n);nato.Network.sendCmd(i,(function(i){if(PanelManager.closeWaitForServer(),null!=i){if(0>i.getByte())return void AlertPanel.errorMessage(i.getString());e.leagueid=i.getInt(),e.unionName=n,e.myUnionList=[];var o=xself;if(null!=o){var a=new t(o.getCountryId());a.name=o.getCountryName(),a.scale=e.scale,a.setLoadStatus(!0,t.WAR_IS_UNION_OWNER),e.myUnionList.push(a)}AlertPanel.alertCommon(GameText.STR_COUNTRY_CREATE_UNION_SUCCESS)}}),this)}},t.doGetMyUnion=function(e,n,i){if(null!=e){var o=MsgHandler.createWarUnionMy();nato.Network.sendCmd(o,(function(o){if(e.scale=o.getByte(),-1==e.scale)return AlertPanel.errorMessage(o.getString()),void n.call(i);if(0==o.getBoolean())return e.leagueid=null,e.unionName="",void n.call(i);e.leagueid=o.getInt(),e.unionName=o.getString(),e.myUnionList=[];var a,r=o.getByte();for(a=0;r>a;a++){(l=new t(o.getInt())).name=o.getString(),l.scale=o.getByte(),0==a&&l.setLoadStatus(!0,t.WAR_IS_UNION_OWNER),l.status=o.getByte(),(l.status==t.UNION_STATUS_WAR||l.status==t.UNION_STATUS_TEST)&&(l.fightCountry=o.getString(),l.fightID=o.getInt(),l.countryFightTime=o.getString(),l.isAttack=o.getBoolean(),l.fightMoney1=o.getInt(),l.fightMoney3=o.getInt(),l.fightType=o.getByte()),e.myUnionList.push(l)}var s=o.getByte();for(a=0;s>a;a++){var l;(l=new t(o.getInt())).name=o.getString(),l.scale=o.getByte(),l.status=t.UNION_STATUS_APPLY,l.setLoadStatus(!0,t.WAR_IS_APPLY_UNION),e.myUnionList.push(l)}n.call(i)}),this)}else n.call(i)},t.doUIGetUnionList=function(t,e,n){return null},t.doGetUnionList=function(e,n,i){if(void 0===n&&(n=50),void 0===i&&(i=1),null==e)return null;PanelManager.openWaitForServer();var o=MsgHandler.createWarUnionList(n,i);nato.Network.sendCmd(o,(function(n){if(PanelManager.closeWaitForServer(),null==n)return null;if(0>n.getInt())return AlertPanel.errorMessage(n.getString()),null;e.scale=n.getByte();var i=n.getByte();e.unionList=[];for(var o=0;i>o;o++){var a=new t(-1);a.leagueid=n.getInt(),a.name=n.getString(),a.myUnionList=[];for(var r=n.getByte(),s=0;r>s;s++){var l=new t(n.getInt());l.name=n.getString(),l.scale=n.getByte(),a.myUnionList.push(l)}e.unionList.push(a)}xevent.dispatchEvent(new WorldEvent(WorldEvent.GET_UNION_LIST_BACK))}),this)},t.doGetWarList=function(e,n,i,o){if(void 0===i&&(i=50),void 0===o&&(o=1),null==e)return null;PanelManager.openWaitForServer();var a=MsgHandler.createWarUnionWarList(n,i,o);nato.Network.sendCmd(a,(function(i){if(PanelManager.closeWaitForServer(),null==i)return null;if(0>i.getInt())return AlertPanel.errorMessage(i.getString()),null;for(var o=i.getByte(),a=[],r=0;o>r;r++){var s=new t(-1);s.countryFightTime=i.getString(),s.countryID1=i.getInt(),s.countryName1=i.getString(),s.countryID2=i.getInt(),s.countryName2=i.getString(),s.fightID=i.getInt(),s.fightMoney1=i.getInt(),s.fightMoney3=i.getInt(),s.fightType=i.getByte();var l=i.getBoolean();s.status=l?t.UNION_STATUS_TEST:t.UNION_STATUS_WAR,a.push(s)}n==t.WAR_UNION_TYPE_UNION?e.myWarList=a:n==t.WAR_UNION_TYPE_OTHER&&(e.warList=a),xevent.dispatchEvent(new WorldEvent(WorldEvent.GET_WAR_LIST_BACK))}),this)},t.prototype.getSoldier=function(t){return null},t.prototype.getWarBuild=function(t){return null==this.buildList||0>t||t>=this.buildList.length?null:this.buildList[t]},t.prototype.getUnionName=function(){return Tool.isNullText(this.unionName)?GameText.STR_LIST_NULL:this.unionName},t.prototype.getFightCountry=function(){return Tool.isNullText(this.fightCountry)?GameText.STR_LIST_NULL:this.fightCountry},t.prototype.getFightTime=function(t){if(null==t&&(t=this.fightTime-Tool.currentTime),0>=t)return null!=this.fightCountry?GameText.STR_COUNTRY_FIGHT_NOW:GameText.STR_LIST_NULL;var e=Math.floor(t/Tool.MILLIS_IN_MINUTE);return t%Tool.MILLIS_IN_MINUTE>0&&e++,Tool.manageString(GameText.STR_COUNTRY_RESIDUE,Tool.getTimeStrByMin(e,!0))},t.doGetCampInfo=function(e,n){PanelManager.openWaitForServer();var i=MsgHandler.createCampInfo();nato.Network.sendCmd(i,(function(i){if(PanelManager.closeWaitForServer(),null==i)return null;if(0>i.getByte())AlertPanel.errorMessage(i.getString());else{var o=new t(i.getInt());o.name=i.getString(),o.kingId=i.getInt(),o.kingName=i.getString(),o.campLevel=i.getByte(),o.leagueid=i.getLong().value,o.leagueid>0&&(o.unionName=i.getString(),o.unionNum=i.getByte()),o.armyStrength=i.getInt(),o.militaryStrength=i.getInt(),o.soldierNum=i.getShort(),o.soldierMax=i.getShort(),o.helpNum=i.getShort(),o.helpMax=i.getShort(),o.warCount=i.getShort(),o.warWinRate=i.getByte(),o.fightID=i.getInt(),-1!=o.fightID&&(o.fightCountry=i.getString(),o.fightTime=i.getLong().value+Date.now(),o.fightMoney1=i.getInt(),o.fightMoney3=i.getInt()),o.money1=i.getInt(),o.money2=i.getInt(),o.money3=i.getInt(),o.wood=i.getInt(),o.stone=i.getInt(),o.iron=i.getInt(),o.bookNum=i.getShort(),e.call(n,o)}}),this)},t.doLoadSoldierList=function(t){},t.doGetSoldierList=function(t,e,n,i,o){if(null==t||null==t)return null;PanelManager.openWaitForServer();var a=MsgHandler.createSoldierList(t.soldierType,t.soldierRank,e,n);nato.Network.sendCmd(a,(function(e){if(PanelManager.closeWaitForServer(),null==e)return null;var n=e.getShort(),a=e.getByte();t.soldierList=[];for(var r=0;a>r;r++){var s=new ListPlayer;s.setId(e.getInt()),s.setName(e.getString()),s.setLevel(e.getByte()),s.setJob(e.getByte()),s.setSex(e.getByte()),s.setCountryRank(e.getByte()),s.setCountryName(e.getString()),e.getBoolean()?s.setStatusBit(ModelConst.STATUS_ONLINE):s.times=e.getInt(),t.soldierList.push(s)}i.call(o,n)}),this)},t.doSoldierDealApply=function(t,e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=e){var i=MsgHandler.createSoldierDealApply(e.getId(),n,t.soldierType);nato.Network.sendCmd(i,(function(t){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{e.setTabStatus(!0,Model.DEL_STATUS),xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_ARMY_SOLDIER_UPDATE,1));var i=GameText.getText(GameText.TI_MISSION_REFUSE);n&&(i=GameText.STR_COUNTRY_APPLY_AGREE),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_DEAL_UNION_APPLY,i+e.getName()))}}),this)}},t.doSoldierDealAllApply=function(t,e){if(0!=SafeLock.doSafeLockVerify()){var n=MsgHandler.createSoldierDealApply(-1,e,t.soldierType);nato.Network.sendCmd(n,(function(n){if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{t.soldierList=[],xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_ARMY_SOLDIER_UPDATE));var i=GameText.getText(GameText.TI_MISSION_REFUSE);e&&(i=GameText.STR_COUNTRY_APPLY_AGREE),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_DEAL_ALL_APPLY,i))}}),this)}},t.doSoldierDelete=function(t){if(0!=SafeLock.doSafeLockVerify()&&null!=t){AlertPanel.alert(GameText.STR_COUNTRY_SOLDIER_DEL,Tool.manageString(GameText.STR_COUNTRY_SOLDIER_DEL_ASK,PowerString.makeColorString("【"+t.getName()+"】",ColorUtils.COLOR_GREEN)),(function(){var e=MsgHandler.createDeleteSoldier(t.getId());nato.Network.sendCmd(e,(function(e){MsgHandler.isMessageHaveError(e)||(t.setTabStatus(!0,Model.DEL_STATUS),xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_ARMY_SOLDIER_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_SOLDIER_DEL_SUCCESS))}),this)}),this)}},t.doSoldierApply=function(){var t=MsgHandler.createSoldierApply();nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(GameText.STR_COUNTRY_SOLDIER_APPLY_WAIT)}),this)},t.doGetBuildList=function(e,n,i){if(null!=e){if(1==e.isLoad(t.WAR_LOAD_BUILD_LIST))return void n.call(i);e.setLoadStatus(!0,t.WAR_LOAD_BUILD_LIST);PanelManager.openWaitForServer();var o=MsgHandler.createWarBuildList();nato.Network.sendCmd(o,(function(t){if(PanelManager.closeWaitForServer(),null!=t){if(0>t.getByte())return void AlertPanel.errorMessage(t.getString());var o=t.getByte();e.buildList=[];for(var a=0;o>a;a++){e.buildList[a]=WarBuild.formBytesToList(t,!1),0!=t.getBoolean()&&(e.buildList[a].nextWarBuild=WarBuild.formBytesToList(t,!0))}n.call(i)}}),this)}},t.doBuildUpdateLevel=function(t,e){if(null!=t&&null!=e){PanelManager.openWaitForServer();var n=MsgHandler.createWarBuildLevel(e.buildPos);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),null!=n){if(0>n.getByte())return void AlertPanel.errorMessage(n.getString());e.exeDeductUpdateLevel(t),e.doUpdateLevel(),1==n.getBoolean()&&(e.nextWarBuild=WarBuild.formBytesToList(n,!0)),xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_ARMY_BUILD_UPDATE)),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_BUILD_UPDATE,e.buildName))}}),this)}},t.doWarDeclareList=function(e,n,i){if(null==e)return null;var o=MsgHandler.createWarDeclareList(e.searchBuildingID,n,i);nato.Network.sendCmd(o,(function(i){if(null==i)return null;var o=i.getInt();if(0>o)return AlertPanel.errorMessage(i.getString()),null;for(var a=i.getByte(),r=i.getInt(),s=i.getByte(),l=[],_=0;a>_;_++){var h=new t(-1);h.id=i.getInt(),h.name=i.getString(),e.searchBuildingID<=0?(h.scale=i.getByte(),h.searchBuildingLevel=h.scale+1):h.searchBuildingLevel=i.getByte(),h.armyStrength=r,h.bookNum=s,l.push(h)}if(e.countryList=l,PanelManager.isPanelShow(ManorScene)){var u=PanelManager.getPanel(ManorScene),c=Math.ceil(o/n);u.updateCountryList(e,c)}}),this)},t.doCommandCreateWarDeclareList=function(e,n,i){if(null==e)return null;var o=MsgHandler.createCommandCreateWarDeclareList(e.searchBuildingID,n,i);nato.Network.sendCmd(o,(function(i){if(null==i)return null;var o=i.getInt();if(0>o)return AlertPanel.errorMessage(i.getString()),null;for(var a=i.getInt(),r=i.getByte(),s=i.getInt(),l=i.getByte(),_=new Array,h=0;l>h;h++){var u=new t(-1);u.id=i.getInt(),u.name=i.getString(),e.searchBuildingID<=0?(u.scale=i.getByte(),u.searchBuildingLevel=u.scale+1):u.searchBuildingLevel=i.getByte(),u.armyStrength=a,u.bookNum=r,u.costmoney=s,_.push(u)}if(e.countryList=_,e.createwarinfo=i.getString(),PanelManager.isPanelShow(ManorScene)){var c=PanelManager.getPanel(ManorScene),T=Math.ceil(o/n);c.updateCountryList(e,T)}}),this)},t.doWarDeclare=function(t,e){if(null==t)return!1;var n=GameText.STR_COUNTRY_WAR_REAL;e&&(n=GameText.STR_COUNTRY_WAR_TEST),AlertPanel.alert(GameText.STR_COUNTRY_WAR_DECLARE,Tool.manageStringList(GameText.STR_COUNTRY_WAR_DECLARE_INFO,[t.armyStrength+"",t.bookNum+"",t.name,n]),(function(){var n=0,i=0,o=function(){var o=MsgHandler.createWarDeclare(t.id,n,i,e);nato.Network.sendCmd(o,(function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):(AlertPanel.alertCommon(e?GameText.STR_COUNTRY_WAR_TEST_SUCCESS:GameText.STR_COUNTRY_WAR_REAL_SUCCESS),void(CountryArmyScene.updateCountry=!0))}),this)};if(0==e){CommonFormPanel.createWarDeclare((function(t){for(var e=0,a=t.length;a>e;e++)if(Tool.isNullText(t[e])||parseInt(t[e])<0)return void AlertPanel.alertCommon(GameText.STR_COUNTRY_WAR_LOW);n=parseInt(t[0]),i=parseInt(t[1]),o()}),this)}else o()}),this)},t.prototype.doCommandCreateWarDeclare=function(e){if(null!=e){AlertPanel.alert(GameText.STR_COUNTRY_WAR_DECLARE,Tool.manageStringList(GameText2.STR_COUNTRY_CREATE_WAR_ASK,[e.armyStrength+"",e.costmoney+"",e.bookNum+"",e.name]),(function(){var n=0,i=0,o=function(){var o=MsgHandler.createCountryCreateWarCommand(e.id,n,i,!1);nato.Network.sendCmd(o,(function(n){if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{n.getBoolean()&&t.fromBytesReflash(e,n);var i=Define.COUNTRY_COMMAND_CREATE_WAR-1;null!=e.commandCoolList[i]&&(e.commandCoolList[i][0]=new Boolean(!0),e.commandCoolList[i][1]=new Number(e.commandCoolList[i][1].intValue()-1)),AlertPanel.alertCommon(GameText.STR_COUNTRY_WAR_REAL_SUCCESS)}}),this)};CommonFormPanel.createWarDeclare((function(t){for(var e=0,a=t.length;a>e;e++)if(Tool.isNullText(t[e])||parseInt(t[e])<0)return void AlertPanel.alertCommon(GameText.STR_COUNTRY_WAR_LOW);n=parseInt(t[0]),i=parseInt(t[1]),o()}),this)}),this)}},t.doGetWarDeclareInfo=function(){if(0!=SafeLock.doSafeLockVerify()){var e=MsgHandler.createWarAnswerInfo();nato.Network.sendCmd(e,(function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());var n=e.getInt(),i=e.getString(),o=e.getByte()+1,a=e.getInt(),r=e.getInt(),s=e.getBoolean(),l="";l+=s?Tool.manageStringList(GameText.STR_COUNTRY_WAR_TEST_DEC_INFO,[i,o+""]):Tool.manageStringList(GameText.STR_COUNTRY_WAR_DEC_INFO,[i,o+"",GameText.STR_MONEY1+a,GameText.STR_MONEY3+r]);var _,h=[];_=new MenuActionData(GameText.getText(GameText.TI_BACK),t.WAR_DECLARE_ASK_BACK),h.push(_),_=new MenuActionData(GameText.getText(GameText.TI_SEE_INFO),t.WAR_DECLARE_ASK_SEE,n),h.push(_),_=new MenuActionData(s?GameText.STR_COUNTRY_WAR_AGREE_INVITE:GameText.STR_COUNTRY_WAR_AGREE_PAY,t.WAR_DECLARE_ASK_AGREE),h.push(_),_=new MenuActionData(s?GameText.STR_COUNTRY_WAR_REFUSE_INVITE:GameText.STR_COUNTRY_WAR_REFUSE_PAY,t.WAR_DECLARE_ASK_REFUSE),h.push(_),PanelManager.openSelectMenuPanel(l,h,t.doWarDeclareAsk,this)}}),this)}},t.doWarDeclareAsk=function(e,n){if(PanelManager.closeSelectMenuPanel(),e==t.WAR_DECLARE_ASK_SEE)t.doViewCountryInfo(n);else{if(0==SafeLock.doSafeLockVerify())return;var i=MsgHandler.createWarDeclareAsk(e);nato.Network.sendCmd(i,(function(n){if(n)return 0>n.getByte()?void AlertPanel.errorMessage(n.getString()):void(e==t.WAR_DECLARE_ASK_AGREE?AlertPanel.alertCommon(GameText.STR_COUNTRY_AGREE_PAY_SUCCESS):e==t.WAR_DECLARE_ASK_REFUSE&&AlertPanel.alertCommon(GameText.STR_COUNTRY_REFUSE_PAY_SUCCESS))}),this)}},t.doWinActionInfo=function(){if(0!=SafeLock.doSafeLockVerify()){var e=MsgHandler.createWinActionInfo();nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){var n=new t(e.getInt());n.name=e.getString(),n.createTime=e.getInt();for(var i=e.getByte(),o=0;i>o;o++){var a=e.getByte(),r=e.getByte();n.buildingList.push([a,r])}n.warnInfoList=[];var s=e.getByte();for(o=0;s>o;o++){var l=e.getByte(),_=e.getString();n.warnInfoList.push([l,_])}var h,u=[];h=new MenuActionData(GameText.getText(GameText.TI_BACK),t.WAR_DECLARE_ASK_BACK),u.push(h),h=new MenuActionData(GameText.STR_COUNTRY_WAR_PUNISH,1,n),u.push(h);_=Tool.manageStringList(GameText.STR_COUNTRY_WAR_PUNISH_INFO,[n.name,Tool.getTimeStrByMin(n.createTime,!0)]);PanelManager.openSelectMenuPanel(_,u,(function(t,e){PanelManager.closeSelectMenuPanel(),1==t&&PanelManager.openCountryWarWinActionPanel(e)}),this)}}),this)}},t.doWinActionDo=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),t){var i,o;if(0==Tool.isArrayIndexOutOfBounds(e,t.buildingList))i=t.buildingList[e][0];if(0==Tool.isArrayIndexOutOfBounds(n,t.warnInfoList))o=t.warnInfoList[n][0];var a=MsgHandler.createWinActionDo(t.id,i,o);nato.Network.sendCmd(a,(function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon(GameText.STR_COUNTRY_WAR_PUNISH_SUCCESS)}),this)}},t.prototype.getWarFightInfo=function(){var e="";switch(this.status){case t.UNION_STATUS_NORMAL:e=GameText.STR_COUNTRY_WAR_STATUS_NORMAL;break;case t.UNION_STATUS_PROTECT:e=GameText.STR_COUNTRY_WAR_STATUS_PROTECT;break;case t.UNION_STATUS_TEST:case t.UNION_STATUS_WAR:this.status==t.UNION_STATUS_WAR?e+=GameText.STR_COUNTRY_WAR_STATUS_WAR:this.status==t.UNION_STATUS_TEST&&(e+=GameText.STR_COUNTRY_WAR_STATUS_TEST),e+=this.isAttack?Tool.manageStringList(GameText.STR_COUNTRY_WAR_ATTACK,[this.name,this.fightCountry]):Tool.manageStringList(GameText.STR_COUNTRY_WAR_ATTACK,[this.fightCountry,this.name]),e+=Tool.manageString(GameText.STR_COUNTRY_WAR_TIME,this.countryFightTime),this.status==t.UNION_STATUS_WAR&&(e+=Tool.manageStringList(GameText.STR_COUNTRY_WAR_INFO_APPEND,[GameText.STR_MONEY1+this.fightMoney1,GameText.STR_MONEY3+this.fightMoney3,t.getWarTypeText(this.fightType)]));break;case t.UNION_STATUS_APPLY:e=GameText.STR_COUNTRY_WAR_STATUS_APPLY}return e},t.prototype.doCountryKingCommand=function(e){if(0!=SafeLock.doSafeLockVerify()){var n=this;if(0==n.isKing(xself))return void AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO);CommonFormPanel.countryProsperity((function(i){if(10>i||i>100)AlertPanel.alertCommon(GameText.STR_KING_COMMAND_COUNT_INFO_ER);else{var o=MsgHandler.createCountryKingCommand(i);nato.Network.sendCmd(o,(function(i){var o=PanelManager.getPanel(ManorManageScene,!1);if(null!=i){if(0>i.getByte())return void AlertPanel.errorMessage(i.getString());var a=0;i.getBoolean()&&(t.fromBytesReflash(this,i),a=i.getShort());var r=e-1;null!=n.commandCoolList[r]&&(n.commandCoolList[r][0]=new Boolean(!0),n.commandCoolList[r][1]=new Number(parseInt(n.commandCoolList[r][1])-1)),(o=PanelManager.getPanel(ManorManageScene,!1))&&o.setPowerData(n),AlertPanel.alertCommon(Tool.manageString(GameText.STR_KING_COMMAND_USE_SUCCESS,a+""))}}),this)}}),this)}},t.prototype.doCountryCreateWarCommand=function(e){if(0==SafeLock.doSafeLockVerify())return!1;if(0==this.isKing(xself))return AlertPanel.alertCommon(GameText.STR_COUNTRY_RIGHTLESSDO),!1;var n=new t(this.id);0==n.isTemp()&&t.getCountryInfo(n)},t.prototype.getWarFightInfo2=function(){var e="";return this.status==t.UNION_STATUS_WAR?e+=GameText.STR_COUNTRY_WAR_STATUS_WAR:this.status==t.UNION_STATUS_TEST&&(e+=GameText.STR_COUNTRY_WAR_STATUS_TEST),e+=Tool.manageStringList(GameText.STR_COUNTRY_WAR_ATTACK,[this.countryName1,this.countryName2]),e+=Tool.manageString(GameText.STR_COUNTRY_WAR_TIME,this.countryFightTime),this.status==t.UNION_STATUS_WAR&&(e+=Tool.manageStringList(GameText.STR_COUNTRY_WAR_INFO_APPEND2,[GameText.STR_MONEY1+this.fightMoney1,GameText.STR_MONEY3+this.fightMoney3,t.getWarTypeText(this.fightType)])),e},t.prototype.getMoney1=function(){return Tool.getMoneyText(this.money1,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getMoney2=function(){return Tool.getMoneyText(this.money2,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getMoney3=function(){return Tool.getMoneyText(this.money3,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getWood=function(){return Tool.getMoneyText(this.wood,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getStone=function(){return Tool.getMoneyText(this.stone,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getIron=function(){return Tool.getMoneyText(this.iron,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getFightMoney1=function(){return Tool.getMoneyText(this.fightMoney1,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getFightMoney3=function(){return Tool.getMoneyText(this.fightMoney3,Tool.DIVIDE_TEN_THOUSAND)},t.prototype.getScale=function(){return this.scale+1},t.doCountryGetVipItem=function(){},t.doSeeCountryStoragePet=function(t){},t.getCountryMapId=function(t,e){var n=Define.MAP_ID_START_COUNTRY_EAST,i=e-1;return t==Define.RACE_EAST?n=Define.MAP_ID_START_COUNTRY_EAST+i:t==Define.RACE_WEST&&(n=Define.MAP_ID_START_COUNTRY_WEST+i),n},t.isMyPlayerRank=function(e){if(null==xself)return!1;var n=xself.getCountryRank();switch(e){case t.RANK_KING_EQUIP:return n==Define.RANK_KING;case t.RANK_KNIGHT_ABOVE:return n==Define.RANK_KING||n==Define.RANK_PRIME||n==Define.RANK_MARSHAL||n==Define.RANK_KNIGHT;default:return!1}},t.ACTIVATE_MONEY=[ModelConst.MONEY1,200],t.LOAD_BUILDING=1,t.LOAD_MEMBER_LIST=2,t.LOAD_POWER=4,t.LOAD_MISSION=8,t.LOAD_COUNTRY_LIST=16,t.SET_STORAGE_SYSTEM=32,t.LOAD_FIRST_ASSIGN=1024,t.IS_OPERATE_MISSION=2048,t.LOAD_DONATE_LIST=4096,t.LOAD_MAIN_MENU=8192,t.WAR_LOAD_BUILD_LIST=1<<20,t.WAR_LOAD_SOLDIER_LIST=1<<21,t.WAR_IS_APPLY_UNION=1<<22,t.WAR_IS_UNION_OWNER=1<<23,t.COUNTRY_MISSION_LEVEL_ALL=0,t.COUNTRY_MISSION_LEVEL_LOW=1,t.COUNTRY_MISSION_LEVEL_MID=2,t.COUNTRY_MISSION_LEVEL_HIGH=3,t.MAX_TAX_RATE=100,t.INFO_NORMAL=0,t.INFO_BUILDING=1,t.INFO_COMMAND=2,t.INFO_MISSION=3,t.INFO_REFRESH=4,t.INFO_ENTER=5,t.STATUS_NORMAL=1,t.STATUS_INACTIVE=2,t.STATUS_INVALID=3,t.BUILDING_ID=0,t.BUILDING_LEVEL=1,t.BUILDING_REQ_MONEY1=2,t.BUILDING_REQ_MONEY3=3,t.BUILDING_REQ_WOOD=4,t.BUILDING_REQ_STONE=5,t.BUILDING_REQ_IRON=6,t.BUILDING_REQ_LAND=7,t.BUILDING_REQ_SCALE=8,t.BUILDING_REQ_PROSPERITY=9,t.BUILDING_ATTR_SIZE=13,t.WAR_UNION_TYPE_UNION=1,t.WAR_UNION_TYPE_OTHER=2,t.WAR_UNION_TYPE_ALL=3,t.RANK_KING_EQUIP=1,t.RANK_KNIGHT_ABOVE=2,t.WAR_TYEP_XXX=0,t.WAR_TYEP_MONEY=1,t.WAR_TYEP_BUILD=2,t.SOLDIER_TYPE_WAR_MENBER=1,t.SOLDIER_TYPE_APPLY=2,t.SOLDIER_TYPE_HPLT_APPLY=3,t.UNION_STATUS_NORMAL=0,t.UNION_STATUS_PROTECT=1,t.UNION_STATUS_WAR=2,t.UNION_STATUS_TEST=3,t.UNION_STATUS_APPLY=4,t.WAR_DECLARE_ASK_AGREE=1,t.WAR_DECLARE_ASK_REFUSE=2,t.WAR_DECLARE_ASK_SEE=3,t.WAR_DECLARE_ASK_BACK=4,t}();__reflect(Country.prototype,"Country");var CountryBoss=function(){function t(){this.status=0,this.nextSysnTime=0,this.endTime=0,this.devote=0,this.nowdevote=0,this.myPos=0,this.countrymoney1=0,this.countrymoney3=0,this.countryIron=0,this.countryWood=0,this.countryRock=0,this.countryallmoney1=0,this.countryallmoney3=0,this.countryallIron=0,this.countryallWood=0,this.countryallRock=0,this.bossList=null,this.spriteModel=null}return t.prototype.isStatus=function(t){return Tool.isBit(t,this.status)},t.prototype.setStatus=function(t,e){this.status=Tool.setBit(t,e,this.status)},t.prototype.getBossByIndex=function(t){return null==this.bossList||0>t||t>=this.bossList.length?null:this.bossList[t]},t.prototype.getBossByID=function(t){if(null==this.bossList)return null;for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];if(null!=n&&n.id==t)return n}return null},t.prototype.getBossByPos=function(t){if(null==this.bossList)return null;for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];if(null!=n&&n.uiPos==t)return n}return null},t.prototype.isTimeOut=function(){return Tool.currentTime>this.endTime},t.prototype.initSprite=function(){var t=xself;if(null!=t){var e=null,n=xworld.getModel(t.getLeaderID());null!=n&&(e=n.getPlayerSprite()),null==e&&(e=t.getPlayerSprite()),this.spriteModel=new Model(3),this.spriteModel.setDir(1),this.spriteModel.setPlayerSprite(GameSprite.cloneSprite(e)),this.spriteModel.setAnimationByDir(!1),this.spriteModel.sprite.setScale(xhd?1.5:1)}},t.processCountryBoss=function(e,n){void 0===n&&(n=!1);var i=!1,o=GameWorld.countryBoss;if(null==o&&(o=new t,GameWorld.countryBoss=o,i=!0),n){var a=new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_JOIN);nato.Network.sendCmd(a,(function(t){0!=o.doEntryCountryBoss(t)&&(i&&o.initSprite(),PanelManager.openCountryBossScene(o))}),this)}else{if(null==e)return;if(0==o.doEntryCountryBoss(e))return;i&&o.initSprite(),PanelManager.openCountryBossScene(o)}},t.prototype.doEntryCountryBoss=function(e){var n=e.getByte();if(n>0)return!1;if(0>n){if(-2==n&&1==this.isStatus(t.STATUS_FIGHT_FAIL))return;return AlertPanel.alertCommon(e.getString()),!1}if(0==e.getBoolean())return!1;this.endTime=e.getInt()+Tool.currentTime,this.devote=e.getInt(),this.countrymoney1=e.getInt(),this.countrymoney3=e.getInt(),this.countryIron=e.getInt(),this.countryWood=e.getInt(),this.countryRock=e.getInt(),this.countryallmoney1=e.getInt(),this.countryallmoney3=e.getInt(),this.countryallIron=e.getInt(),this.countryallWood=e.getInt(),this.countryallRock=e.getInt(),this.myPos=e.getByte();var i=e.getByte();if(i>0){this.bossList=new Array(i);for(var o=0;i>o;o++)this.bossList[o]=Boss.fromBytesByCountryBoss(e)}return!0},t.prototype.toString=function(){return"我的位置："+this.myPos+"， 总资源：矿="+this.countryallIron+"木="+this.countryallWood+"石="+this.countryallRock+"金="+this.countryallmoney1+"铜="+this.countryallmoney3+"， 已获得：矿="+this.countryIron+"木="+this.countryWood+"石="+this.countryRock+"金="+this.countrymoney1+"铜="+this.countrymoney3},t.prototype.logic=function(e){if(null!=this.spriteModel&&this.spriteModel.logic(e),this.logicOther(),!(Tool.currentTime<this.nextSysnTime)){var n=MsgHandler.createCountryBossRefresh();nato.Network.sendCmd(n),this.nextSysnTime=Tool.currentTime+t.SYSN_TIME}},t.prototype.logicOther=function(){0==this.isStatus(t.STATUS_FIRST_ENTER)&&(AlertPanel.alertNotify(GameText.STR_TEAMBOSS_ENTER,this.getFirstInfo()),this.setStatus(!0,t.STATUS_FIRST_ENTER)),1==this.isStatus(t.STATUS_FIGHT_START)&&1==this.isStatus(t.STATUS_FIGHT_EXIT)&&(this.doAskContinue(),this.setStatus(!1,t.STATUS_FIGHT_START),this.setStatus(!1,t.STATUS_FIGHT_EXIT))},t.doRefresh=function(e){if(null!=e&&null!=GameWorld.countryBoss)if(GameWorld.countryBoss.doEntryCountryBoss(e)){if(PanelManager.isPanelShow(CountryBossScene))PanelManager.getPanel(CountryBossScene).update()}else t.clearCountryBoss(!1)},t.doQuitFight=function(){var t=MsgHandler.createCountryBossNotFight();nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)}),this)},t.doFightAsk=function(e){if(null!=e){if(e.isOver())return void AlertPanel.alertCommon(GameText.STR_COUNTRYBOSS_SELECT_OTHER);var n,i=Tool.manageStringList(GameText.STR_COUNTRYBOSS_ASK_INFO,[e.getSourceInfo(),e.num+""]),o=[];n=new MenuActionData(GameText.STR_COUNTRYBOSS_FIGHT,1),o.push(n),n=new MenuActionData(GameText.getText(GameText.TI_QUIT),2),o.push(n),PanelManager.openSelectMenuPanel(i,o,(function(n){PanelManager.closeSelectMenuPanel(),1==n&&t.doFight(GameWorld.countryBoss,e)}),this)}},t.doFight=function(e,n){if(null!=e&&null!=n){if(1==e.isStatus(t.STATUS_FIGHT_FAIL))return void AlertPanel.alertCommon(GameText.STR_COUNTRYBOSS_FAIL);var i=MsgHandler.createCountryBossFight(n.id);nato.Network.sendCmd(i,(function(n){MsgHandler.isMessageHaveError(n)||(MsgHandler.processRemoteBattleNotify(n),e.setStatus(!0,t.STATUS_FIGHT_START))}),this)}},t.doCountryBossQuit=function(){var e=function(e){MsgHandler.isMessageHaveError(e)||t.clearCountryBoss(!1)};AlertPanel.alert(GameText.STR_COUNTRYBOSS_QUIT,GameText.STR_COUNTRYBOSS_QUIT_ASK,(function(){var t=MsgHandler.createCountryBossQuit();nato.Network.sendCmd(t,e,this)}),this)},t.doCountryBossEnd=function(e){if(null!=e){var n=xself;if(null!=n){var i=e.getBoolean(),o=e.getByte();n.countrypowerValue=o,i&&(t.clearCountryBoss(!0),PanelManager.updateWorldIconPoint())}}},t.doCountryBossGetScore=function(e){if(null!=e){var n=e.getInt();null!=GameWorld.countryBoss&&(GameWorld.countryBoss.nowdevote=n,GameWorld.countryBoss.setStatus(!0,t.STATUS_FIGHT_SCORE),GameWorld.countryBoss.doEntryCountryBoss(e))}},t.clearCountryBoss=function(t){return GameWorld.countryBoss=null,1==t&&PanelManager.battleUI&&PanelManager.battleUI.stage?void WorldMessage.addPromptMsg(GameText.STR_COUNTRYBOSS_QUIT_END):(PanelManager.closeScene(!0),void MsgHandler.createWorldDataReflashMsg())},t.prototype.getFirstInfo=function(){return GameText.STR_COUNTRYBOSS_FIRST_INFO},t.prototype.doAskContinue=function(){if(1!=this.isStatus(t.STATUS_FIGHT_FAIL)){var e=GameWorld.countryBoss;if(null!=e){var n=e.getBossByIndex(e.myPos-1);if(null!=n){var i="";1==this.isStatus(t.STATUS_FIGHT_SCORE)&&(e.nowdevote>0&&(i=Tool.manageString(GameText.STR_COUNTRYBOSS_GET_SCORE,PowerString.makeColorString(e.nowdevote+"",ColorUtils.COLOR_GREEN))),this.setStatus(!1,t.STATUS_FIGHT_SCORE),e.nowdevote=0);var o="";if(0==n.isOver())o=Tool.manageStringList(GameText.STR_COUNTRYBOSS_BOSS_ASK,[i,n.num+""]);else{var a=e.getSourceInfo();0==Tool.isNullText(a)&&(a=Tool.manageString(GameText.STR_COUNTRYBOSS_GET_RESOURCE,a)),o=Tool.manageString(GameText.STR_COUNTRYBOSS_BOSS_OVER_ASK,i+a)}var r,s=[];0==n.isOver()&&(r=new MenuActionData(GameText.STR_COUNTRYBOSS_FIGHT_CONTINUE,1),s.push(r)),r=new MenuActionData(GameText.getText(GameText.TI_QUIT),2),s.push(r),PanelManager.openSelectMenuPanel(o,s,(function(e){1==e?t.doFight(GameWorld.countryBoss,n):2==e&&PanelManager.closeSelectMenuPanel()}),this,PopUpManager.CloseType.NONE)}}}else AlertPanel.alertCommon(GameText.STR_COUNTRYBOSS_FAIL)},t.prototype.getSourceInfo=function(){var t="";return this.countryIron>0&&(t+=GameText.STR_COUNTRY_IRON+this.countryIron),this.countryRock>0&&(t+=" \n"+GameText.STR_COUNTRY_STONE+this.countryRock),this.countryWood>0&&(t+=" \n"+GameText.STR_COUNTRY_WOOD+this.countryWood),this.countrymoney1>0&&(t+=" \n"+GameText.STR_MONEY1+this.countrymoney1),this.countrymoney3>0&&(t+=" \n"+GameText.STR_MONEY3+this.countrymoney3),t},t.prototype.getBattleResource=function(){return Tool.manageStringList(GameText.STR_COUNTRYBOSS_RESOURCE_INFO,[this.countryallIron-this.countryIron+"",this.countryallIron+"",this.countryallRock-this.countryRock+"",this.countryallRock+"",this.countryallWood-this.countryWood+"",this.countryallWood+"",this.countryallmoney1-this.countrymoney1+"",this.countryallmoney1+"",this.countryallmoney3-this.countrymoney3+"",this.countryallmoney3+""])},t.prototype.getBattleLog=function(){var t=this.getSourceInfo();return 0==Tool.isNullText(t)&&(t=Tool.manageString(GameText.STR_COUNTRYBOSS_GET_RESOURCE,t)),Tool.manageStringList(GameText.STR_COUNTRYBOSS_BATTLE_LOG,[this.getAllBossNum()+"",this.devote+"",t])},t.prototype.getAllBossNum=function(){var t=0;if(null!=this.bossList)for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];null!=n&&(t+=n.num)}return t},t.doCountryBossActivity=function(){var t=new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_ACTIVATE_DATA);nato.Network.sendCmd(t,(function(t){if(0>t.getByte())AlertPanel.alertCommon(t.getString());else{var e=t.getString();AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),e,(function(){if(0!=SafeLock.doSafeLockVerify()){var t=new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_ACTIVATE);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void AlertPanel.alertCommon(GameText.STR_COUNTRY_BOSS_ACTIVITY_INFO)}),this)}}),this)}}),this)},t.SYSN_TIME=5e3,t.STATUS_FIRST_ENTER=1,t.STATUS_FIGHT_START=2,t.STATUS_FIGHT_EXIT=4,t.STATUS_FIGHT_FAIL=8,t.STATUS_FIGHT_SCORE=16,t.IMAGESET_ATTACK_PALACE=0,t.IMAGESET_WALL=1,t.IMAGESET_TOWER=2,t.IMAGESET_ENEMY=3,t.IMAGESET_DESTROY=4,t.IMAGESET_NOPASS=5,t.IMAGESET_ARMY=6,t.IMAGESET_HP_OK=7,t.IMAGESET_HP_NO=8,t.IMAGESET_ATTACK_VALUE=9,t.IMAGESET_DEFEND_VALUE=10,t.IMAGESET_DEFEND_PALACE=11,t}();__reflect(CountryBoss.prototype,"CountryBoss");var CountryTask=function(){function t(){this.level=0,this.leftNum=0,this.rightNum=0,this.select=!1}return t.fromCountryValidListBytes=function(e){var n=new t;n.level=e.getByte(),n.leftNum=e.getShort(),n.rightNum=e.getShort();var i=Mission.fromBytes(e.getBytes());n.mission=i,n.countryAssignIds=[];for(var o="",a=e.getByte(),r=0;a>r;r++)n.countryAssignIds.push(e.getInt()),o+=e.getString()+";",r==a-1&&(o=o.substring(0,o.length-1));return n.remark=o,n},t.fromCountryAllMissionBytes=function(e){var n=new t,i=e.getByte();n.leftNum=i;for(var o="",a=0;i>a;a++)o+=e.getString()+";",a==i-1&&(o=o.substring(0,o.length-1));n.remark=o,n.level=e.getByte(),n.rightNum=e.getShort();var r=Mission.fromBytes(e.getBytes());return n.mission=r,n},t.fromCountryNotValidListBytes=function(e){var n=new t;return n.select=e.getBoolean(),n.rightNum=e.getByte(),n.level=e.getByte(),n.mission=Mission.fromBytes(e.getBytes()),n},t.fromCountryAppointListBytes=function(e){var n=new t,i=e.getShort();n.leftNum=i,n.level=e.getByte(),n.rightNum=e.getShort(),n.mission=Mission.fromBytes(e.getBytes());for(var o="",a=0;i>a;a++)o+=e.getString()+";",a==i-1&&(o=o.substring(0,o.length-1));return n.remark=o,n},t.prototype.getCountryLeftNum=function(){return this.leftNum},t.prototype.getCountryRightNum=function(){return this.rightNum},t.prototype.getCountryRemark=function(){return this.remark},t.prototype.getCountryMission=function(){return this.mission},t.prototype.setCountryAssignInfo=function(t){this.leftNum=t.size();var e="";for(var n in t){e+=t[n].getName()+";"}this.remark=e},t.prototype.getUpperBoundDesc=function(){return this.rightNum<=0?GameText.STR_NO_TOP_LIMIT:this.leftNum+"/"+this.rightNum},t.prototype.getCountryMissionDesc=function(){var t=new StringBuffer;return t.append(this.getCountryMission().getDetails(!1)),t.toString()},t.prototype.getCountryAssignIds=function(){return this.countryAssignIds},t}();__reflect(CountryTask.prototype,"CountryTask");var CountryWar=function(){function t(){this.nextSysnTime=0,this.warState=0,this.round=0,this.roundMax=0,this.roundState=0,this.roundEndTime=0,this.soldierAttack=0,this.soldierDefend=0,this.mySlotPos=-1,this.isUpdateWar=!1,this.battleStatusCount=0}return t.isAttackBuildPos=function(e){return e>=t.SLOTPOS_ATTACK_PALACE&&e<=t.SLOTPOS_ATTACK_DOWN_TOWER},t.prototype.isEnemyBuildPos=function(e){var n=this.isWarState(t.WAR_STATE_IS_ATTACK),i=t.isAttackBuildPos(e);return!!(n&&0==i||0==n&&i)},t.getBuildName=function(e,n){var i=GameText.STR_COUNTRY_BUILD;switch(e){case t.SLOTPOS_ATTACK_PALACE:case t.SLOTPOS_DEFEND_PALACE:i=GameText.STR_COUNTRY_PALACE;break;case t.SLOTPOS_ATTACK_UP_WALL:case t.SLOTPOS_DEFEND_UP_WALL:i=GameText.STR_COUNTRY_UP_WALL;break;case t.SLOTPOS_ATTACK_DOWN_WALL:case t.SLOTPOS_DEFEND_DOWN_WALL:i=GameText.STR_COUNTRY_DOWN_WALL;break;case t.SLOTPOS_ATTACK_UP_TOWER:case t.SLOTPOS_DEFEND_UP_TOWER:i=GameText.STR_COUNTRY_UP_TOWER;break;case t.SLOTPOS_ATTACK_MIDDLE_TOWER:case t.SLOTPOS_DEFEND_MIDDLE_TOWER:i=GameText.STR_COUNTRY_MIDDLE_TOWER;break;case t.SLOTPOS_ATTACK_DOWN_TOWER:case t.SLOTPOS_DEFEND_DOWN_TOWER:i=GameText.STR_COUNTRY_DOWN_TOWER}return 1==n&&(i+=t.isAttackBuildPos(e)?GameText.STR_COUNTRY_ATTACK:GameText.STR_COUNTRY_DEFEND),i},t.prototype.setWarState=function(t,e){this.warState=Tool.setBit(e,t,this.warState)},t.prototype.isWarState=function(t){return Tool.isBit(t,this.warState)},t.prototype.init=function(){this.setWarState(t.WAR_STATE_IS_LOCK_TIME,!0),this.initUI(),this.initArmySprite()},t.prototype.fromMsg=function(e){this.isTest=e.getBoolean(),this.isNotViewWar=e.getBoolean(),this.roundMax=e.getByte();var n=e.getBoolean();this.setWarState(t.WAR_STATE_IS_ATTACK,n);var i=e.getByte();this.buildList=[],0>=i&&WorldMessage.addPromptMsg("CountryWar.fromMsg() buildSize = "+i+"????");for(var o=0;i>o;o++){var a=e.getByte(),r=65535&e.getByte(),s=65535&e.getByte(),l=e.getByte();(T=new WarBuild(a,r,s)).buildLevel=l,this.buildList[o]=T}for(var _=t.SLOTPOS_ATTACK_PALACE;_<t.SLOTPOS_DEFEND_DOWN_TOWER;_++)null==this.getBuildByPos(_)&&WorldMessage.addPromptMsg("CountryWar.fromMsg() build == null?? buildPos = "+_);this.refreshWar(e),i=e.getByte();for(var h=0;i>h;h++){_=e.getByte();var u,c,T,p=0,d=0;(u=65535&e.getByte())>0&&(p=e.getShort()),(c=65535&e.getByte())>0&&(d=e.getShort()),null!=(T=this.getBuildByPos(_))&&(T.power1=u,T.powerValue1=p,T.power2=c,T.powerValue2=d)}return this.setWarState(t.WAR_STATE_IS_INIT_SUCCESS,!0),!0},t.prototype.initUI=function(){PanelManager.openCountryWarScene()},t.prototype.initArmySprite=function(){var e=xself;if(null!=e){var n=e.getPlayerSprite(),i=xworld.getModel(e.getLeaderID());if(null!=i){if(null==i.getPlayerSprite())return;n=i.getPlayerSprite()}this.armySprite=new Model(3),this.armySprite.setDir(0),0==this.isWarState(t.WAR_STATE_IS_ATTACK)&&this.armySprite.setDir(1),this.armySprite.setPlayerSprite(GameSprite.cloneSprite(n)),this.armySprite.setAnimationByDir(!1),this.armySprite.sprite.setScale(xhd?1.5:1)}},t.prototype.refreshWar=function(e){this.round=e.getByte(),this.roundState=e.getByte(),this.roundState==t.ROUND_READY?this.setWarState(t.WAR_STATE_IS_READY_ROUND,!0):this.roundState==t.ROUND_FIGHT&&this.setWarState(t.WAR_STATE_IS_FIGHT_ROUND,!0);var n=e.getInt();this.roundEndTime=Tool.currentTime+n,this.soldierAttack=e.getShort(),this.soldierDefend=e.getShort(),this.mySlotPos=e.getByte(),this.clearBuildArmyNum();for(var i=e.getByte(),o=0;i>o;o++){var a=e.getByte(),r=e.getByte(),s=e.getByte(),l=this.getBuildByPos(a);null!=l&&l.setArmyNum(r,s)}this.roundState==t.ROUND_FIGHT&&this.setWarState(t.WAR_STATE_IS_LOCK_TIME,!0)},t.prototype.isLockTime=function(){return this.roundState==t.ROUND_READY&&this.roundEndTime-Tool.currentTime<t.LOCK_TIME},t.prototype.beginToUpdateWar=function(){this.isUpdateWar||(this.isUpdateWar=!0,nato.WorldTicker.instance.register(GameWorld.countryWar.logic,GameWorld.countryWar))},t.prototype.clearUpdate=function(){this.isUpdateWar&&(this.isUpdateWar=!1,nato.WorldTicker.instance.unregister(GameWorld.countryWar.logic,GameWorld.countryWar))},t.prototype.logic=function(e){PanelManager.isPanelShow(CountryWarScene)&&PanelManager.getPanel(CountryWarScene).logic(e);if(xworld.inBattle)this.clearUpdate();else{if(null!=this.armySprite&&this.armySprite.logic(e),this.isLockTime()&&this.isWarState(t.WAR_STATE_IS_LOCK_TIME)&&(WorldMessage.addNoticeMsg(GameText.STR_COUNTRY_WAR_NOTICE),this.setWarState(t.WAR_STATE_IS_LOCK_TIME,!1)),0==this.isWarState(t.WAR_STATE_IS_FIRST_ENTER)&&(AlertPanel.closeAll(),AlertPanel.alertCommon(this.getFirstEnterInfo()),this.setWarState(t.WAR_STATE_IS_FIRST_ENTER,!0)),this.roundState==t.ROUND_FIGHT&&this.isWarState(t.WAR_STATE_IS_READY_ROUND)&&(AlertPanel.closeAll(),AlertPanel.alertCommon(this.getRoundReadyToFightInfo()),this.setWarState(t.WAR_STATE_IS_READY_ROUND,!1)),this.roundState==t.ROUND_READY&&this.isWarState(t.WAR_STATE_IS_FIGHT_ROUND)){AlertPanel.closeAll();var n=Tool.manageString(GameText.STR_COUNTRY_WAR_ROUND_REPORT,(this.round-1).toString());AlertPanel.alertNotify(n,this.getRoundFightToReadyInfo()),this.setWarState(t.WAR_STATE_IS_FIGHT_ROUND,!1)}if(!(Tool.currentTime<this.nextSysnTime)){var i=MsgHandler.createCountryWarUpdate();nato.Network.sendCmd(i),this.nextSysnTime=Tool.currentTime+t.SYSN_TIME}}},t.prototype.getRoundStateStr=function(){var e=GameText.STR_COUNTRY_WAR_ROUND_NULL;return this.roundState==t.ROUND_READY?e=GameText.STR_COUNTRY_WAR_ROUND_READY:this.roundState==t.ROUND_FIGHT&&(e=GameText.STR_COUNTRY_WAR_ROUND_FIGHT),e+": "},t.doEnterWar=function(t){var e=MsgHandler.createCountryWarEnter(t);nato.Network.sendCmd(e,(function(t){}),this)},t.doRefresh=function(t){if(null!=t){var e=t.getByte();if(0>e)return void AlertPanel.errorMessage(t.getString());var n=GameWorld.countryWar;if(null!=n){if(1==e)return n.battleStatusCount++,void(n.battleStatusCount>3&&(n.battleStatusCount=0,MsgHandler.createWorldDataReflashMsg()));if(n.battleStatusCount=0,2==e)return void this.clearCountryWar(!1);if(n.refreshWar(t),PanelManager.isPanelShow(CountryWarScene))PanelManager.getPanel(CountryWarScene).update()}}},t.doRoundNotice=function(t){var e=t.getByte();if(1!=e)if(2!=e){if(0==e){var n=GameWorld.countryWar;if(null==n)return;for(var i=t.getByte(),o=0;i>o;o++){var a=t.getByte(),r=65535&t.getByte(),s=n.getBuildByPos(a);null!=s?s.buildHP=r:ChatMsg.addChatSystemMsg("CountryWar.doRoundNotice() 找不到建筑 buildPos="+a)}var l=t.getInt(),_=t.getInt(),h=xself;null!=h&&(h.hp=l,h.mp=_);var u=t.getInt();if(u>=0){var c=t.getInt(),T=h.getPet();null!=T&&(T.hp=u,T.mp=c)}}}else this.clearCountryWar(!0);else this.clearCountryWar(!0)},t.doWarArmyList=function(t,e,n,i,o,a){var r=MsgHandler.createCountryWarArmyList(e,n,i);nato.Network.sendCmd(r,(function(e){var n=e.getShort(),i=e.getByte();t.armyList=[];for(var r=0;i>r;r++)t.armyList.push(WarArmy.fromBytes(e));o.call(a,n)}),this)},t.doAddArmy=function(t,e){var n=MsgHandler.createCountryWarOperArmy(e,GameWorld.getPlayerID());nato.Network.sendCmd(n,(function(n){if(!MsgHandler.isMessageHaveError(n)){null!=t&&(t.mySlotPos=e);var i=GameText.STR_COUNTRY_WAR_GARRISON;null!=t&&(i=t.getOpeBuildInfo(e)),AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_WAR_ADD_ARMY_INFO,i+this.getBuildName(e,!1))),xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE))}}),this)},t.doQuitCountryWar=function(e){if(null!=e){var n=e.isNotViewWar?GameText.STR_COUNTRY_WAR_QUIT_ASK:GameText.STR_COUNTRY_WAR_TEST_QUIT_ASK;AlertPanel.alert(GameText.STR_COUNTRY_WAR_QUIT,n,(function(){var e=MsgHandler.createCountryWarOperArmy(-2,GameWorld.getPlayerID());nato.Network.sendCmd(e,(function(){t.clearCountryWar(!1)}),this)}),this)}},t.doRemoveArmy=function(e){if(0!=SafeLock.doSafeLockVerify()&&null!=e){if(0==t.isOpeArmy(xself))return void AlertPanel.alertCommon(GameText.STR_WAR_OPE_ARMY);AlertPanel.alert(GameText.STR_COUNTRY_WAR_REMOVE_ARMY,Tool.manageString(GameText.STR_COUNTRY_WAR_REMOVE_ARMY_ASK,e.getLeaderName()),(function(){var t=MsgHandler.createCountryWarOperArmy(-1,e.getArmyID());nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)||(e.setStatus(WarArmy.STATUS_IS_DEL,!0),e.buildPos=-1,xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_REMOVE_ARMY_SUCCESS))}),this)}),this)}},t.doDeleteArmy=function(e){if(0!=SafeLock.doSafeLockVerify()&&null!=e){if(0==t.isOpeArmy(xself))return void AlertPanel.alertCommon(GameText.STR_WAR_OPE_ARMY);AlertPanel.alert(GameText.STR_COUNTRY_WAR_DEL_ARMY,Tool.manageString(GameText.STR_COUNTRY_WAR_DEL_ARMY_ASK,e.getLeaderName()),(function(){var t=MsgHandler.createCountryWarOperArmy(-3,e.getArmyID());nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)||(e.setStatus(WarArmy.STATUS_IS_DEL,!0),xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_WAR_DEL_ARMY_SUCCESS))}),this)}),this)}},t.doInsertArmy=function(e,n){if(0!=SafeLock.doSafeLockVerify()&&null!=n){if(0==t.isOpeArmy(xself))return void AlertPanel.alertCommon(GameText.STR_WAR_OPE_ARMY);var i=MsgHandler.createCountryWarOperArmy(e,n.getArmyID());nato.Network.sendCmd(i,(function(t){MsgHandler.isMessageHaveError(t)||(n.setStatus(WarArmy.STATUS_IS_DEL,!0),n.buildPos=e,xevent.dispatchEvent(new WorldEvent(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE)),AlertPanel.alertCommon(GameText.STR_COUNTRY_INSERT_ARMY_SUCCESS))}),this)}},t.doCommandList=function(t,e,n){if(null!=t){var i=MsgHandler.createCountryWarCommandList();nato.Network.sendCmd(i,(function(i){t.armyLevel=i.getByte(),t.bookNum=i.getInt(),t.strength=i.getInt(),t.strengthMax=i.getInt();var o=65535&i.getByte();t.command1List=[];for(var a=0;o>a;a++)t.command1List.push(WarCommand.formBytes(i));var r=65535&i.getByte();t.command2List=[];for(a=0;r>a;a++)t.command2List.push(WarCommand.formBytes(i));e.call(n,!0)}),this)}else e.call(n,!1)},t.doUseCommand=function(t){if(0!=SafeLock.doSafeLockVerify()&&null!=t){var e=MsgHandler.createCountryWarUseCommand(t.did);nato.Network.sendCmd(e,(function(e){return 0>e.getByte()?void AlertPanel.errorMessage(e.getString()):void AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_USE_COMMAND_SUCCESS,t.getNameInfo()))}),this)}},t.doGetViewArmyList=function(t){if(null!=t){t.viewArmyList=[];var e=MsgHandler.createWarBattleList();nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){for(var n=e.getByte(),i=0;n>i;i++){var o=e.getByte();if(!(0>=o)){var a=e.getByte(),r=e.getInt(),s=e.getString(),l=new WarArmy;l.armyPlayerNum=o,l.buildPos=a,l.leader=new Model(3),l.leader.setId(r),l.leader.setName(s),t.viewArmyList.push(l)}}if(PanelManager.isPanelShow(CountryWarInfoScene))PanelManager.getPanel(CountryWarInfoScene).battleWatchPanel.update()}}),this),PanelManager.openWaitForServer()}},t.doGetReportList=function(t){if(null!=t){var e=MsgHandler.createWarTextInfo(-1);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){t.reportList=[];for(var n=e.getByte(),i=0;n>i;i++){var o=e.getByte(),a=e.getByte();t.reportList.push(Tool.manageString(GameText.STR_COUNTRY_REPORT_LIST_ROUND,o+""));for(var r=0;a>r;r++)t.reportList.push(e.getString())}if(PanelManager.isPanelShow(CountryWarInfoScene))PanelManager.getPanel(CountryWarInfoScene).battleLogPanel.update()}}),this),PanelManager.openWaitForServer()}},t.prototype.getMyPalace=function(){return this.isWarState(t.WAR_STATE_IS_ATTACK)?t.SLOTPOS_ATTACK_PALACE:t.SLOTPOS_DEFEND_PALACE},t.prototype.isReadyRound=function(){return this.roundState==t.ROUND_READY},t.prototype.clearBuildArmyNum=function(){if(null!=this.buildList)for(var t=0;t<this.buildList.length;t++){var e=this.buildList[t];null!=e&&e.clearArmyNum()}},t.prototype.isCanPass=function(e){if(null==this.getBuildByPos(e))return!1;switch(e){case t.SLOTPOS_ATTACK_PALACE:return this.isCanPass2([t.SLOTPOS_ATTACK_UP_WALL,t.SLOTPOS_ATTACK_DOWN_WALL]);case t.SLOTPOS_DEFEND_PALACE:return this.isCanPass2([t.SLOTPOS_DEFEND_UP_WALL,t.SLOTPOS_DEFEND_DOWN_WALL]);case t.SLOTPOS_ATTACK_UP_WALL:return this.isCanPass2([t.SLOTPOS_ATTACK_UP_TOWER,t.SLOTPOS_ATTACK_MIDDLE_TOWER]);case t.SLOTPOS_ATTACK_DOWN_WALL:return this.isCanPass2([t.SLOTPOS_ATTACK_DOWN_TOWER,t.SLOTPOS_ATTACK_MIDDLE_TOWER]);case t.SLOTPOS_DEFEND_UP_WALL:return this.isCanPass2([t.SLOTPOS_DEFEND_UP_TOWER,t.SLOTPOS_DEFEND_MIDDLE_TOWER]);case t.SLOTPOS_DEFEND_DOWN_WALL:return this.isCanPass2([t.SLOTPOS_DEFEND_DOWN_TOWER,t.SLOTPOS_DEFEND_MIDDLE_TOWER]);default:return!0}},t.prototype.isCanPass2=function(t){for(var e=0;e<t.length;e++){var n=this.getBuildByPos(t[e]);if(null!=n&&n.isDestroy())return!0}return!1},t.prototype.getBuildIcon=function(e){var n=this.getBuildByPos(e);if(null==n||n.isDestroy())return t.IMAGESET_DESTROY;if(e==t.SLOTPOS_ATTACK_PALACE)return t.IMAGESET_ATTACK_PALACE;if(e==t.SLOTPOS_DEFEND_PALACE)return t.IMAGESET_DEFEND_PALACE;if(0==this.isCanPass(e))return t.IMAGESET_NOPASS;var i=this.isWarState(t.WAR_STATE_IS_ATTACK),o=t.isAttackBuildPos(e);if(0==i&&1==o)return t.IMAGESET_ENEMY;if(1==i&&0==o)return t.IMAGESET_ENEMY;switch(e){case t.SLOTPOS_ATTACK_UP_TOWER:case t.SLOTPOS_ATTACK_MIDDLE_TOWER:case t.SLOTPOS_ATTACK_DOWN_TOWER:case t.SLOTPOS_DEFEND_UP_TOWER:case t.SLOTPOS_DEFEND_MIDDLE_TOWER:case t.SLOTPOS_DEFEND_DOWN_TOWER:return t.IMAGESET_TOWER;case t.SLOTPOS_ATTACK_UP_WALL:case t.SLOTPOS_ATTACK_DOWN_WALL:case t.SLOTPOS_DEFEND_UP_WALL:case t.SLOTPOS_DEFEND_DOWN_WALL:return t.IMAGESET_WALL}return t.IMAGESET_DESTROY},t.prototype.getBuildByPos=function(t){for(var e=0;e<this.buildList.length;e++){var n=this.buildList[e];if(null!=n&&n.buildPos==t)return n}return null},t.prototype.getRoundReadyToFightInfo=function(){return GameText.STR_COUNTRY_ROUND_READY_TO_FIGHT},t.prototype.getRoundFightToReadyInfo=function(){var e=new StringBuffer;return e.append(GameText.STR_COUNTRY_ROUND_TO_FIGHT_INFO),e.append(GameText.STR_COUNTRY_SOLDIER_ATTACK+"  "+this.soldierAttack+"   :   "+this.soldierDefend+"\n"),e.append(GameText.STR_COUNTRY_PALACE+"   "+this.getBuildHP(t.SLOTPOS_ATTACK_PALACE)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_PALACE)+"\n"),e.append(GameText.STR_COUNTRY_UP_WALL+"   "+this.getBuildHP(t.SLOTPOS_ATTACK_UP_WALL)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_UP_WALL)+"\n"),e.append(GameText.STR_COUNTRY_DOWN_WALL+"   "+this.getBuildHP(t.SLOTPOS_ATTACK_DOWN_WALL)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_DOWN_WALL)+"\n"),e.append(GameText.STR_COUNTRY_UP_TOWER+"   "+this.getBuildHP(t.SLOTPOS_ATTACK_UP_TOWER)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_UP_TOWER)+"\n"),e.append(GameText.STR_COUNTRY_MIDDLE_TOWER+"   "+this.getBuildHP(t.SLOTPOS_ATTACK_MIDDLE_TOWER)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_MIDDLE_TOWER)+"\n"),e.append(GameText.STR_COUNTRY_DOWN_TOWER+"  "+this.getBuildHP(t.SLOTPOS_ATTACK_DOWN_TOWER)+"   :   "+this.getBuildHP(t.SLOTPOS_DEFEND_DOWN_TOWER)+"\n"),e.toString()},t.prototype.getFirstEnterInfo=function(){var e=this.isWarState(t.WAR_STATE_IS_ATTACK),n=GameText.STR_COUNTRY_FIRST_ENTER_INFO;return 0==e&&(n+=GameText.STR_COUNTRY_FIRST_ENTER_INFO2),n+GameText.STR_COUNTRY_FIRST_ENTER_INFO3},t.prototype.getOpeBuildInfo=function(t){return this.isEnemyBuildPos(t)?GameText.STR_COUNTRY_WAR_ASSAULT:GameText.STR_COUNTRY_WAR_GARRISON},t.prototype.getBuildHP=function(t){var e=this.getBuildByPos(t);return null!=e?e.getHPInfo():"0"},t.doUIOpeTouchBuild=function(e,n){return null!=e?0==e.isCanPass(n)?void AlertPanel.alertCommon(Tool.manageString(GameText.STR_COUNTRY_WAR_OPEN_TOUCH_BUILD,e.getOpeBuildInfo(n)+t.getBuildName(n,!1))):void(e.isReadyRound()?CountryWarHandler.createWarBuildInfo(e,n):CountryWarHandler.createCountryWarStatusUI(e)):void 0},t.clearCountryWar=function(t){GameWorld.countryWar.clearUpdate(),GameWorld.countryWar=null,1==t&&(WorldMessage.addPromptMsg(GameText.STR_COUNTRY_WAR_END),xworld.inBattle)||(PanelManager.closeScene(!0),MsgHandler.createWorldDataReflashMsg())},t.isOpeArmy=function(t){if(null!=t){var e=t.getCountryRank();if(e>=Define.RANK_KING&&e<=Define.RANK_KNIGHT)return!0}return!1},t.BUILD_NUM_MAX=12,t.SYSN_TIME=5e3,t.LOCK_TIME=1e4,t.ARMY_LIST_READY=-1,t.ARMY_LIST_ALL=-2,t.ROUND_READY=1,t.ROUND_FIGHT=2,t.SLOTPOS_ATTACK_PALACE=0,t.SLOTPOS_ATTACK_UP_WALL=1,t.SLOTPOS_ATTACK_DOWN_WALL=2,t.SLOTPOS_ATTACK_UP_TOWER=3,t.SLOTPOS_ATTACK_MIDDLE_TOWER=4,t.SLOTPOS_ATTACK_DOWN_TOWER=5,t.SLOTPOS_DEFEND_PALACE=6,t.SLOTPOS_DEFEND_UP_WALL=7,t.SLOTPOS_DEFEND_DOWN_WALL=8,t.SLOTPOS_DEFEND_UP_TOWER=9,t.SLOTPOS_DEFEND_MIDDLE_TOWER=10,t.SLOTPOS_DEFEND_DOWN_TOWER=11,t.IMAGESET_ATTACK_PALACE=0,t.IMAGESET_WALL=1,t.IMAGESET_TOWER=2,t.IMAGESET_ENEMY=3,t.IMAGESET_DESTROY=4,t.IMAGESET_NOPASS=5,t.IMAGESET_ARMY=6,t.IMAGESET_HP_OK=7,t.IMAGESET_HP_NO=8,t.IMAGESET_ATTACK_VALUE=9,t.IMAGESET_DEFEND_VALUE=10,t.IMAGESET_DEFEND_PALACE=11,t.WAR_STATE_IS_INIT_SUCCESS=1,t.WAR_STATE_IS_ATTACK=2,t.WAR_STATE_IS_LOCK_TIME=4,t.WAR_STATE_IS_FIRST_ENTER=8,t.WAR_STATE_IS_FIGHT_ROUND=16,t.WAR_STATE_IS_READY_ROUND=32,t.WAR_UI_IS_LOAD_VIEW_LIST=2048,t.WAR_UI_IS_LOAD_REPORT_LIST=4096,t}();__reflect(CountryWar.prototype,"CountryWar");var Craftsman=function(){this.id=0,this.isOpen=!1,this.price=0};__reflect(Craftsman.prototype,"Craftsman");var Enchant=function(){function t(){}return t.isOepn=function(){return null!=xself&&(!(xself.getLevel()<t.ENCHANT_OPEN_LEVEL)&&0!=t.isOpen)},t.doItemEnChant=function(e,n,i,o){if(void 0===i&&(i=null),void 0===o&&(o=null),t.ENCHANT_TYPE_SURE!=n||0!=SafeLock.doSafeLockVerify()){if(null==e||0==e.length)return void AlertPanel.alertCommon(GameText2.STR_ENCHANT_NO_ITEM);var a=xself;if(null!=a){var r=a.bag;if(null!=r){var s="",l="",_=new nato.Message(ProtocolDefine.CG_ENCHANTS_ADD);_.putByte(n),_.putByte(e.length);for(var h=0;h<e.length;h++){var u=e[h];null!=u&&(_.putShort(u.slotPos),_.putInt(u.id),t.ENCHANT_TYPE_SEE==n&&u.grade>=3&&(l+="\n"+u.getNameInfo()))}nato.Network.sendCmd(_,(function(_){PanelManager.closeWaitForServer();var h=_.getInt();if(0>h)AlertPanel.alertCommon(_.getString());else{var u=_.getInt();if(t.ENCHANT_TYPE_SEE==n){s="/cFF0000注意装备吸收后无法复原！/p\n即将获得:附魔值 /cc45712%U/p\n",s=Tool.manageString(s,h+""),""!=l&&(s=s+"\n注意！装备中包含史诗级以上装备"+l+"\n确定是否吸收？");AlertPanel.alert("确认吸收",s,(function(){t.doItemEnChant(e,t.ENCHANT_TYPE_SURE,i,o)}),this)}if(t.ENCHANT_TYPE_SURE==n){AlertPanel.alertCommon(Tool.manageString(GameText2.STR_ENCHANT_SUCCESS,h+"")),a.setEnchantValue(u);for(var c=0;c<e.length;c++){var T=e[c];null!=T&&r.removeItem(T.slotPos)}null!=i&&null!=o&&i.call(o)}}}),this),PanelManager.openWaitForServer()}}}},t.doEnchantGetLists=function(e,n){if(null!=e){if(null!=xself){var i=xself.bag;if(null!=i&&0!=SafeLock.doSafeLockVerify()){var o=new nato.Message(ProtocolDefine.CG_ENCHANTS_GETLIST);o.putInt(e.id),nato.Network.sendCmd(o,(function(o){if(null!=o){if(0>o.getByte())return void AlertPanel.alertCommon(o.getString());t.item=e,t.vItemList=[];for(var a=o.getByte(),r=[],s=0;a>s;s++){var l=o.getShort(),_=(o.getInt(),i.getItem(l));null!=_&&(t.vItemList.push(_),r.push(_))}if(null!=t.vItemList)if(n){var h=function(e,n,i){1==e?PanelManager.closeSelectMenuPanel():2==e?PanelManager.openSelectMenuPanel(Tool.manageString(GameText2.STR_ENCHANT_SHOP_BUY_INFO,i.getMoneyString())+"\n"+i.getDesc(xself,!0),T,h,t):3==e&&t.doEnchantShopBuy(n,i)},u=SellHandler.model;if(null==u)return;t.enchantplayerid=u.getId();var c,T=[];c=new MenuActionData(GameText.getText(GameText.TI_BACK),1),T.push(c),null!=e&&(c=new MenuActionData(GameText2.STR_AUTO_MESSAGE,2,e,e),T.push(c));for(var p=0,d=t.vItemList.length;d>p;p++){var E=t.vItemList[p];if(null!=E){var g=E.name;E.isUpgradeItem&&(g+="("+GameText2.STR_EQ_UPGRADE+")"),c=new MenuActionData(g,3,e,E),T.push(c)}}PanelManager.openSelectMenuPanel(Tool.manageString(GameText2.STR_ENCHANT_SHOP_BUY_INFO,e.getMoneyString()),T,h,t)}else PanelManager.openOtherShopPanel(ShopType.SUB_SHOP_ENCHAT_EQUIP,0,r)}}),this)}}}},t.doEnchantItemUse=function(t,e){if(null==t||null==e);else{var n=function(){var n=xself;if(null!=n){var i=n.bag;if(null!=i){var o=new nato.Message(ProtocolDefine.CG_ENCHANTS_EQUAL_SELF);o.putShort(e.slotPos),o.putInt(e.id),o.putShort(t.slotPos),o.putInt(t.id),nato.Network.sendCmd(o,(function(o){if(null!=o){if(0>o.getByte())return void AlertPanel.alertCommon(o.getString());i.removeBagItemByPos(t.slotPos,1),ItemData.fromBytesEdit(e,o),n.setEnchantValue(o.getInt()),AlertPanel.alertCommon(GameText2.STR_ENCHANT_SUCCESS_INFO),t.quantity<=0&&PanelManager.getPanel(OtherShopPanel).onClose()}}),this)}}};if(0!=e.enchantPower1&&0!=e.enchantPowerValue1||0!=e.enchantPower2&&0!=e.enchantPowerValue2){var i=t.clone();return i.enchantPower1=t.power2,i.enchantPowerValue1=t.powerValue2,i.enchantPower2=t.power3,i.enchantPowerValue2=t.powerValue3,void AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageStringList(GameText2.STR_ENCHANT_CHANGE_ASK,[e.getEnchantInfo(),i.getEnchantInfo()]),n,this)}AlertPanel.alert(GameText2.STR_ENCHANT,GameText2.STR_ENCHANT_ENSURE,n,this)}},t.doEnchantShopBuy=function(e,n){if(null==n||null==e||0==SafeLock.doSafeLockVerify());else{var i=function(){var i=xself;if(null!=i&&null!=i.bag){var o=new nato.Message(ProtocolDefine.CG_ENCHANTSHOP_BUY);o.putInt(t.enchantplayerid),o.putShort(e.slotPos),o.putInt(e.id),o.putShort(n.slotPos),o.putInt(n.id);nato.Network.sendCmd(o,(function(t){if(null!=t){if(0>t.getByte())return void AlertPanel.alertCommon(t.getString());i.money1=t.getInt(),i.money3=t.getInt(),ItemData.fromBytesEdit(n,t),e.quantity-=1,PanelManager.getPanel(OtherShopPanel).updateByItem(e),AlertPanel.alertCommon(GameText2.STR_ENCHANT_SUCCESS_INFO+r),PanelManager.closeSelectMenuPanel()}}),this)}},o=function(){if(e instanceof ShopItem){var t=e.money1,n=e.money2,o=e.money3;Model.checkEnoughMoney(t,n,o,i,this)}};console.log(e instanceof ShopItem,"getMoneyString"in e,"????????????????");var a=e.getMoneyString(),r="";if(0==Tool.isNullText(a)&&(r=Tool.manageString(GameText2.STR_ENCHANT_SHOP_BUY_NEED,a)),0!=n.enchantPower1&&0!=n.enchantPowerValue1||0!=n.enchantPower2&&0!=n.enchantPowerValue2){var s=e.clone();return s.enchantPower1=e.power2,s.enchantPowerValue1=e.powerValue2,s.enchantPower2=e.power3,s.enchantPowerValue2=e.powerValue3,void AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),r+"\n"+Tool.manageStringList(GameText2.STR_ENCHANT_CHANGE_ASK,[n.getEnchantInfo(),s.getEnchantInfo()]),o,this)}AlertPanel.alert(GameText2.STR_ENCHANT,r+"\n"+GameText2.STR_ENCHANT_ENSURE,o,this)}},t.item=null,t.vItemList=null,t.ENCHANT_OPEN_LEVEL=20,t.isOpen=!1,t.enchantshopitem=null,t.enchantplayerid=0,t.ENCHANT_TYPE_SEE=1,t.ENCHANT_TYPE_SURE=2,t}();__reflect(Enchant.prototype,"Enchant");var Furnace=function(){function t(){this.refineNum=0,this.maxRefineNum=0,this.todayRefineNum=0,this.maxTodayRefineNum=0,this.furnaceQuality=0,this.furnaceLevel=0,this.costMoney1=0,this.costMoney2=0,this.costMoney3=0,this.incTotalRefineNumCost=0,this.cancreatenum=0,this.moneytype=0,this.moneyvalue=0,this.isFirst=!0}return t.prototype.isCraftsmanOpenAll=function(){if(null==this.vCraftsman||this.vCraftsman.length<=0)return!0;for(var t=0;t<this.vCraftsman.length;t++){var e=this.vCraftsman[t];if(null!=e&&0==e.isOpen)return!1}return!0},t.doOpenFurnaceShop=function(e){xworld.shopID=e;var n=new nato.Message(ProtocolDefine.CG_FURNACE_OPEN_SHOP);n.putShort(e),nato.Network.sendCmd(n,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){var n=new t;n.refineNum=e.getByte(),n.maxRefineNum=e.getByte(),n.todayRefineNum=e.getInt(),n.maxTodayRefineNum=e.getInt(),n.furnaceQuality=e.getInt(),n.furnaceLevel=e.getByte(),n.costMoney1=e.getInt(),n.costMoney2=e.getInt(),n.costMoney3=e.getInt(),n.incTotalRefineNumCost=e.getInt(),n.tips=e.getString(),n.vCraftsman=[];for(var i=e.getByte(),o=0;i>o;o++){var a=t.getCraftsmanfrombyte(e);null!=a&&n.vCraftsman.push(a)}e.getBoolean()&&(n.item=new ItemData,ItemData.fromBytesAtts2(n.item,e),n.item.durability=n.item.durMax,GameWorld.doGetItemSuit([n.item])),n.cancreatenum=e.getByte(),n.firstdesc=e.getString(),PanelManager.openFurnacePanel(n)}}),this),PanelManager.openWaitForServer()},t.getCraftsmanfrombyte=function(t){var e=new Craftsman;return e.id=t.getByte(),e.isOpen=t.getBoolean(),e.price=t.getInt(),e.name=t.getString(),e.desc=t.getString(),e},t.doOpenCraftsmanMenu=function(e,n){if(null!=n&&null!=e){var i,o=[],a=n.desc;i=new MenuActionData(GameText.getText(GameText.TI_BACK),1),o.push(i),0==e.isCraftsmanOpenAll()&&(i=new MenuActionData(GameText2.STR_OPENCRAFTMAN,2),o.push(i),a=Tool.manageStringList(GameText2.STR_OPENCRAFTMAN_INFO,[n.desc,n.price+""])),PanelManager.openSelectMenuPanel(a,o,(function(i){PanelManager.closeSelectMenuPanel(),1==i||2==i&&t.doOpenCraftsman(e,n)}),this)}},t.doOpenCraftsman=function(e,n){if(null!=n&&null!=e){var i=xself;if(null!=i){var o=function(n){if(!MsgHandler.isMessageHaveError(n)){null==e.vCraftsman&&(e.vCraftsman=[]),e.vCraftsman.length=0;for(var o=n.getByte(),a=0;o>a;a++){var r=t.getCraftsmanfrombyte(n);null!=r&&e.vCraftsman.push(r)}if(i.money1=n.getInt(),AlertPanel.alertCommon(n.getString()),PanelManager.isPanelShow(FurnacePanel)){var s=PanelManager.getPanel(FurnacePanel);s.setData(e),s.update()}}},a=function(){var t=new nato.Message(ProtocolDefine.CG_FURNACE_BUY_CRAFTSMAN);t.putShort(xworld.shopID),t.putInt(n.price),nato.Network.sendCmd(t,o,this)};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText2.STR_OPENCRAFTMAN_ASK,n.price+""),(function(){0!=SafeLock.doSafeLockVerify()&&Model.checkEnoughMoney(n.price,0,0,a,this)}),this)}}},t.doOperateFurnace=function(e){if(null!=e&&null!=xself&&0!=SafeLock.doSafeLockVerify()){if(e.todayRefineNum==e.maxTodayRefineNum)return void t.doIncreateFurnaceNum(e);var n=function(n){if(!MsgHandler.isMessageHaveError(n)){var i="";if(n.getBoolean())i=n.getString(),n.getBoolean()&&(i+="\n"+MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_USE_REWARD));e.refineNum=n.getByte(),e.maxRefineNum=n.getByte(),e.todayRefineNum=n.getInt(),e.maxTodayRefineNum=n.getInt(),e.furnaceQuality=n.getInt(),e.furnaceLevel=n.getByte(),e.tips=n.getString(),null==e.vCraftsman&&(e.vCraftsman=[]),e.vCraftsman.length=0;for(var o=n.getByte(),a=0;o>a;a++){var r=t.getCraftsmanfrombyte(n);null!=r&&e.vCraftsman.push(r)}n.getBoolean()?(e.item=new ItemData,ItemData.fromBytesAtts2(e.item,n),e.item.durability=e.item.durMax,GameWorld.doGetItemSuit([e.item])):e.item=null;var s=n.getInt(),l=n.getInt(),_=n.getInt();if(xself.setPlayerMoneyValue(s,l,_),n.getBoolean()&&(i+=n.getString()),PanelManager.isPanelShow(FurnacePanel)){var h=PanelManager.getPanel(FurnacePanel);h.setData(e),h.update()}AlertPanel.alertCommon(i)}},i="",o=function(){var t=function(){var t=new nato.Message(ProtocolDefine.CG_FURNACE_REFINE);t.putShort(xworld.shopID),t.putByte(e.moneytype),t.putInt(e.moneyvalue),nato.Network.sendCmd(t,n,this)};e.isFirst?(e.isFirst=!1,AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageStringList(GameText2.STR_OPRATOR_FURNACE_ASK,[i,e.firstdesc]),t,this)):t()};switch(e.moneytype){case 0:return i=GameText.STR_MONEY1,void Model.checkEnoughMoney(e.moneyvalue,0,0,o,this);case 1:return i=GameText.STR_MONEY2,void Model.checkEnoughMoney(0,e.moneyvalue,0,o,this);case 2:return i=GameText.STR_MONEY3,void Model.checkEnoughMoney(0,0,e.moneyvalue,o,this)}}},t.doIncreateFurnaceNum=function(t){if(null!=t&&null!=xself){var e=function(e){if(!MsgHandler.isMessageHaveError(e)){t.maxTodayRefineNum=e.getInt(),t.tips=e.getString();var n=e.getInt();xself.setPlayerMoneyValue(n,-1,-1);var i=e.getString();if(AlertPanel.alertCommon(i),PanelManager.isPanelShow(FurnacePanel)){var o=PanelManager.getPanel(FurnacePanel);o.setData(t),o.update()}}},n=function(){var n=new nato.Message(ProtocolDefine.CG_FURNACE_INC_TOTAL_REFINE_NUM);n.putShort(xworld.shopID),n.putInt(t.incTotalRefineNumCost),nato.Network.sendCmd(n,e,this)};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageStringList(GameText2.STR_FURNACE_INCREATENUM_ASK,[t.cancreatenum+"",t.incTotalRefineNumCost+GameText.STR_MONEY1]),(function(){Model.checkEnoughMoney(t.incTotalRefineNumCost,0,0,n,this)}),this)}},t.doSeeFurnaceItemLists=function(){var e=new nato.Message(ProtocolDefine.CG_FURNACE_LIST_ITEMINFO);e.putShort(xworld.shopID),nato.Network.sendCmd(e,(function(e){if(!MsgHandler.isMessageHaveError(e)){for(var n=[],i=e.getByte(),o=0;i>o;o++){var a=e.getByte(),r=e.getByte(),s=new t;s.furnaceLevel=a,s.vItem=[];for(var l=0;r>l;l++){var _=new ItemData;ItemData.fromBytesAtts2(_,e),_.durability=_.durMax,s.vItem.push(_)}GameWorld.doGetItemSuit(s.vItem),n.push(s)}n.length>0&&PanelManager.openFurnaceHelpPanel(n)}}),this)},t.prototype.doGetFurnaceItemFromV=function(t){return null==this.vItem||0==this.vItem.length||Tool.isArrayIndexOutOfBounds(t,this.vItem)?null:this.vItem[t]},t.isFirstCheck=!0,t}();__reflect(Furnace.prototype,"Furnace");var GameNotice=function(){function t(){}return t.showNotice=function(){if(this._isLoad)this.show();else{var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.addEventListener(egret.Event.COMPLETE,this.onComplete,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),t.open("./resource/notify.txt?v=201807091415",egret.HttpMethod.GET),t.send()}},t.onComplete=function(t){var e=t.target;e&&(this.localNotice=e.response,this._isLoad=!0,this.show())},t.onIOError=function(t){},t.show=function(){AlertPanel.alertTipsTextFlow(GameText.STR_GAME_NOTICE,Tool.convertDescToTextFlow(t.localNotice),"left",null,null,PopUpManager.CloseType.NONE)},t.checkIsShowWhileLogin=function(){var t=new Date;return 9==t.getMonth()&&t.getDate()<=7?void PlayerDataManager.getPlayerData(this.waitPlayerDataCheck,this):void(this.isShowNotice&&(this.isShowNotice=!1,this.showNotice()))},t.waitPlayerDataCheck=function(){var t=new Date,e=PlayerDataManager.playerData,n=e.noticeDate,i=!1;if(null==n||0==n)i=!0;else{var o=new Date(n);(o.getMonth()!=t.getMonth()||o.getDate()!=t.getDate())&&(i=!0)}i&&(this.isShowNotice=!0,e.noticeDate=t.getTime(),PlayerDataManager.savePlayerData(e)),this.isShowNotice&&(this.isShowNotice=!1,this.showNotice())},t.localNotice="游戏公告！\n欢迎来到世界OL",t.isShowNotice=!1,t._isLoad=!1,t}();__reflect(GameNotice.prototype,"GameNotice");var InfoData=function(){function t(){this.type=-1,this.id=0,this.menu="",this.content="",this.prePageID=-1}return t.fromBytes=function(e){var n=new t;return n.id=e.getInt(),n.type=e.getByte(),n.menu=e.getString(),n.type==t.TYPE_CONTENT&&(n.content=e.getString()),n},t.prototype.doViewGameHelp=function(){return this.type==t.TYPE_CONTENT?void AlertPanel.alertTipsCommon(this.content,!1):this.type==t.TYPE_LEAVE?void(-1==this.prePageID?PanelManager.closeScene(!0):t.doBrowseGameHelpList(this.prePageID)):void t.doBrowseGameHelpList(this.id)},t.doBrowseGameHelpList=function(e){var n=new nato.Message(ProtocolDefine.CG_SYSTEM_GET_RAIDERS);n.putInt(e),nato.Network.sendCmd(n,(function(n){PanelManager.closeWaitForServer();for(var i=n.getInt(),o=n.getString(),a=n.getByte(),r=[],s=0;a>s;s++){var l=t.fromBytes(n);r.push(l)}var _=new t;_.type=t.TYPE_LEAVE,_.prePageID=i,r.push(_),PanelManager.openRaidersPanel(o,r,t.lastPageID),t.lastPageID=e}),this),PanelManager.openWaitForServer()},t.START_INDEX=-1,t.TYPE_MENU=0,t.TYPE_CONTENT=1,t.TYPE_LEAVE=2,t.lastPageID=0,t}();__reflect(InfoData.prototype,"InfoData");var Milestone=function(){function t(){this.chapterId=0,this.chapterOpen=!1,this.defaultchapterId=0,this.partId=0,this.level=0,this.hasgetreward=!1,this.rTime=0,this.isCanGetdate=!1,this.haveReward=!1,this.rewardTime=0,this.rewardMoney=0,this.rewardMoney2=0,this.rewardMoney3=0,this.milestones=!1,this.misMinLevel=!1,this.misState=0,this.findpathtype=0,this.mapId=0,this.npcId=0,this.missonRewardMoney2=0,this.missonRewardMoney3=0,this.missionRewardExp=0,this.hasrewardItem=!1}return t.prototype.isCanGet=function(){return this.chapterOpen&&this.rTime>0},t.doMilestoneEnter=function(){if(null!=xself){var e=new nato.Message(ProtocolDefine.CG_TASK_MILESTONE_OPEN);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),0!=e.getBoolean()){var n=new t,i=e.getByte();n.vChapterMilestone=[];for(var o=0;i>o;o++){var a=new t;a.chapterId=e.getByte(),a.chapterCon=e.getString(),n.vChapterMilestone.push(a)}n.defaultchapterId=e.getByte();var r=n.doGetChapterById(n.defaultchapterId);if(null!=r&&t.getChapterInfo(e,r),PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).updateMilestone(n)}else AlertPanel.alertCommon(GameText.STR_FUNCTION_NOT_OPEN)}),this),PanelManager.openWaitForServer()}},t.getChapterInfo=function(e,n){if(null!=e&&null!=n){var i=e.getByte();if(0==i)return void AlertPanel.alertCommon(e.getString());n.vPart=[];for(var o=0;i>o;o++){var a=new t;a.partId=e.getShort(),a.partName=e.getString(),a.misState=e.getByte(),a.chapterId=n.chapterId,n.vPart.push(a)}if(n.level=e.getByte(),n.chapterOpen=e.getBoolean(),n.rTime=e.getInt(),n.rTime>0)if(n.hasgetreward=e.getBoolean(),n.hasgetreward)t.getPartDetailInfo(e,n);else{if(0==e.getBoolean())return void AlertPanel.alertCommon(e.getString());if(n.haveReward=e.getBoolean(),1==n.haveReward){var r=e.getByte();n.vRewardItem=[];for(var s=0;r>s;s++){if(0!=e.getBoolean()){var l=new ItemData;l.id=e.getShort(),l.quantity=e.getByte(),l.name=e.getString(),l.bagIcon=e.getByte(),l.grade=e.getByte(),n.vRewardItem.push(l)}}}n.rewardMoney=e.getShort(),n.rewardMoney2=e.getShort(),n.rewardMoney3=e.getShort()}else t.getPartDetailInfo(e,n)}},t.getPartDetailInfo=function(t,e){if(null!=t&&null!=e){if(0==t.getBoolean())return void AlertPanel.alertCommon(t.getString());if(e.misMinLevel=t.getBoolean(),0!=e.misMinLevel&&(e.misState=t.getByte(),e.findpathtype=t.getByte(),e.mapId=t.getShort(),e.npcId=t.getByte(),e.misDescri=t.getString(),e.missionName=t.getString(),e.missonRewardMoney2=t.getShort(),e.missonRewardMoney3=t.getShort(),e.missionRewardExp=t.getInt(),e.hasrewardItem=t.getBoolean(),1==e.hasrewardItem)){var n=t.getByte();e.vMissionItem=[];for(var i=0;n>i;i++){var o=new ItemData;o.id=t.getShort(),o.quantity=t.getByte(),o.name=t.getString(),o.bagIcon=t.getByte(),o.grade=t.getByte(),e.vMissionItem.push(o)}}}},t.doSeeChapter=function(e,n){if(null!=xself&&n.defaultchapterId!=e){var i=n.doGetChapterById(e);if(i&&i.vPart&&i.vPart.length>0){if(n.defaultchapterId=e,PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).recordPanel.update()}else{var o=new nato.Message(ProtocolDefine.CG_TASK_MILESTONE_SHOW_TYPE);o.putByte(e),nato.Network.sendCmd(o,(function(o){(t.getChapterInfo(o,i),n.defaultchapterId=e,PanelManager.isPanelShow(TaskScene))&&PanelManager.getPanel(TaskScene).recordPanel.update()}),this)}}},t.doSeePartDetailsMenu=function(e){if(null!=e&&0!=e.isCanGetdate&&null!=xself){var n=new nato.Message(ProtocolDefine.CG_TASK_MILESTONE_GET_PART);n.putByte(e.chapterId),n.putShort(e.partId),nato.Network.sendCmd(n,(function(e){var n=new t;t.getPartDetailInfo(e,n);var i,o=[];i=new MenuActionData(GameText.getText(GameText.TI_BACK),1),o.push(i),t.MILESTONE_MISSION_STATE_OPEN==n.misState&&(i=new MenuActionData(GameText.getText(GameText.TI_TASK_PATH),2),o.push(i)),1==n.misMinLevel&&PanelManager.openSelectMenuPanel(n.getPartDetailsInfo(),o,(function(e){PanelManager.closeSelectMenuPanel(),1==e||2==e&&(t.MILESTONE_PATH_FIND_NPC==n.findpathtype?SpriteGuide.doSpriteGuideAutoMove(n.mapId,n.npcId):t.MILESTONE_PATH_FIND_MISSION==n.findpathtype&&Mission.doMissionAutoPathMsgByID(n.mapId))}),this)}),this)}},t.prototype.getPartDetailsInfo=function(){var e="",n=ColorUtils.COLOR_YELLOW;switch(this.misState){case t.MILESTONE_MISSION_STATE_NOTOPEN:n=ColorUtils.COLOR_GRAY,e="["+GameText2.STR_MILESTONE_MISSION_NOTOPEN+"]";break;case t.MILESTONE_MISSION_STATE_OPEN:break;case t.MILESTONE_MISSION_STATE_FINISH:e="["+GameText2.STR_MILESTONE_MISSION_FINISH+"]",n=ColorUtils.COLOR_GREEN}e=PowerString.makeColorString(this.missionName+e,n);var i="";if(this.missonRewardMoney2>0&&(i+=GameText.getMoneyText(ModelConst.MONEY2)+this.missonRewardMoney2+"\n"),this.missonRewardMoney3>0&&(i+=GameText.getMoneyText(ModelConst.MONEY3)+this.missonRewardMoney3+"\n"),this.missionRewardExp>0&&(i+=GameText2.STR_MILESTONE_EXP+this.missionRewardExp+"\n"),this.hasrewardItem)for(var o=0;o<this.vMissionItem.length;o++){var a=this.vMissionItem[o];null!=a&&(i+=a.getNameInfo()+"\n")}return Tool.manageStringList(GameText2.STR_MILESTONE_PART_INFO,[""+this.misDescri,e,i])},t.prototype.getRewardInfo=function(){var t="";if(this.rTime>0&&0==this.chapterOpen&&(t+=Tool.manageString(GameText2.STR_MILESTONE_PART_INFO_TIME,Tool.getTimeStrByMin(this.rTime,!1))),this.rewardMoney>0&&(t+=GameText.getMoneyText(ModelConst.MONEY1)+this.rewardMoney+"\n"),this.rewardMoney2>0&&(t+=GameText.getMoneyText(ModelConst.MONEY2)+this.rewardMoney2+"\n"),this.rewardMoney3>0&&(t+=GameText.getMoneyText(ModelConst.MONEY3)+this.rewardMoney3+"\n"),this.haveReward)for(var e=0;e<this.vRewardItem.length;e++){var n=this.vRewardItem[e];null!=n&&(t+=n.getNameInfo()+"\n")}return t},t.doSeeRewardMenu=function(e){if(null!=xself&&null!=e&&!(e.rTime<=0)){var n,i=[];n=new MenuActionData(GameText.getText(GameText.TI_BACK),1),i.push(n),n=new MenuActionData(GameText.getText(GameText.TI_GET_MISSION),2),i.push(n),PanelManager.openSelectMenuPanel(e.getRewardInfo(),i,(function(n){PanelManager.closeSelectMenuPanel(),1==n||2==n&&t.doGetReWard(e)}),this)}},t.doGetReWard=function(t){if(null!=t){var e=xself;if(null!=e){var n=new nato.Message(ProtocolDefine.CG_TASK_MILESTONE_GET_REWARD);n.putByte(t.chapterId),nato.Network.sendCmd(n,(function(t){if(0>t.getByte())AlertPanel.alertCommon(t.getString());else if(0!=t.getByte()){t.getByte()>0&&MsgHandler.processAddItemMsg(t,ProtocolDefine.ADD_ITEM_USE_REWARD);var n=t.getInt(),i=t.getInt(),o=t.getInt();if(e.setPlayerMoneyValue(n,i,o),PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).recordPanel.update();AlertPanel.alertCommon(GameText2.STR_VITALITY_GET_REWARD_SUCCESS)}}),this)}}},t.prototype.doGetChapterFromV=function(t){return null==this.vChapterMilestone||0==this.vChapterMilestone.length||Tool.isArrayIndexOutOfBounds(t,this.vChapterMilestone)?null:this.vChapterMilestone[t]},t.prototype.doGetChapterById=function(t){if(null==this.vChapterMilestone||0==this.vChapterMilestone.length)return null;for(var e=0;e<this.vChapterMilestone.length;e++){var n=this.vChapterMilestone[e];if(null!=n&&n.chapterId==t)return n}return null},t.doMilestOn=function(t){t.getByte(),t.getByte(),t.getString()},t.doMilestAb=function(t){t.getByte(),t.getByte(),t.getString()},t.MILESTONE_MISSION_STATE_NOTOPEN=0,t.MILESTONE_MISSION_STATE_OPEN=1,t.MILESTONE_MISSION_STATE_FINISH=2,t.MILESTONE_PATH_FIND_NPC=1,t.MILESTONE_PATH_FIND_MISSION=2,t}();__reflect(Milestone.prototype,"Milestone");var MonsterGroup=function(){function t(){this.flag=0,this.groupId=0,this.type=0,this.nextBattleGroupID=0,this.monsters=new Array(t.MONSTERGROUP_MONSTERS),this.npcs=new Array(t.MONSTERGROUP_NPCS)}return t.prototype.isFlag=function(t){return 0!=(this.flag&t)},t.fromBytes=function(e){var n=new t;n.groupId=65535&e.getShort(),n.type=e.getByte(),n.nextBattleGroupID=65535&e.getShort(),n.flag=e.getByte();var i=10;n.isFlag(t.FLAG_MONSTER_20)&&(i=t.MONSTERGROUP_MONSTERS);for(var o=0;i>o;o++)n.monsters[o]=e.getShort();if(n.isFlag(t.FLAG_HAVE_NPC))for(o=0;o<t.MONSTERGROUP_NPCS;o++)n.npcs[o]=e.getShort();return n},t.prototype.setGroupMonsterDataToBattle=function(t){if(null!=t&&null!=this.monsters)for(var e,n=0,i=0;i<this.monsters.length;i++)0>=(n=this.monsters[i])||i>=t.length||null!=(e=xworld.getMonster(n))&&((e=e.getClone()).resumeHPMP(),t[i]=e,e.position=i)},t.prototype.getGroupNPCList=function(){if(null==this.npcs)return null;for(var t,e,n=new Array(this.npcs.length),i=0;i<this.npcs.length;i++)0>=(t=this.npcs[i])||null!=(e=xworld.getMonster(t))&&((e=e.getClone()).resumeHPMP(),n[i]=e);return n},t.getLocalBattlePlayerList=function(t,e){if(null==t)return null;if(null==e)return null;var n=Battle.LOCAL_BATTLE_MY_POS,i=n-1,o=new Array(Battle.MAX_POS);e.setGroupMonsterDataToBattle(o),t.position=n,o[t.position]=t;var a=t.getPet();null!=a&&a.isAlive()&&(a.position=i,o[a.position]=a);var r=n-2,s=n+2,l=0,_=t.getMerList();if(null!=_)for(var h=0,u=0;u<_.length;u++){if(null!=(E=_[u])&&(0==(1&h)?(l=r,r-=2):(l=s,s+=2),h++,!(0>l||l>=Battle.MAX_POS||Battle.isLeftSide(l)))){var c=E.getClone();c.worldMer=E,c.position=l,o[c.position]=c;var T=E.getPet();if(null!=T){var p=T.getClone();p.worldMer=T,p.position=l-1,o[p.position]=p}}}var d=e.getGroupNPCList();if(null!=d)for(u=0;u<d.length;u++){var E;null!=(E=d[u])&&(l=r,u>=2&&(l=s),0!=(1&u)&&(l-=1),0>l||l>=Battle.MAX_POS||Battle.isLeftSide(l)||(E.position=l,o[E.position]=E))}return o},t.FLAG_MONSTER_20=1,t.FLAG_HAVE_NPC=2,t.MONSTERGROUP_MONSTERS=20,t.MONSTERGROUP_NPCS=4,t}();__reflect(MonsterGroup.prototype,"MonsterGroup");var MountRaiders=function(){function t(){this.mountIndex=0}return t.doGetMountRaidersData=function(){function e(){PanelManager.openPetRaidersPanel(PetRaidersPanel.Type_Mount,t.vmountList)}if(null==t.vmountList||0==t.vmountList.length){var n=new nato.Message(ProtocolDefine.CG_SYSTEM_GET_MOUNT_RAIDERS);n.putShort(40),n.putInt(1),n.putByte(-1),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getInt())AlertPanel.alertCommon(n.getString());else{for(var i=n.getByte(),o=[],a=0;i>a;a++){var r=new t;r.item=new ItemData,ItemData.fromBytesAtts2(r.item,n),r.item.durability=r.item.durMax,r.strInfo=n.getString(),o.push(r)}t.vmountList=o,e()}}),this),PanelManager.openWaitForServer()}else e()},t.isMatchLevel=function(e,n){return n==t.SEARCH_LEVEL_ALL||(n==t.SEARCH_LEVEL_1_40&&40>e||(n==t.SEARCH_LEVEL_41_50&&e>41&&50>=e||(n==t.SEARCH_LEVEL_51_60&&e>51&&60>=e||(n==t.SEARCH_LEVEL_61_70&&e>61&&70>=e||(n==t.SEARCH_LEVEL_71_80&&e>71&&80>=e||n==t.SEARCH_LEVEL_71_90&&e>81&&90>=e)))))},t.SEARCH_LEVEL_ALL=-1,t.SEARCH_LEVEL_1_40=1,t.SEARCH_LEVEL_41_50=2,t.SEARCH_LEVEL_51_60=3,t.SEARCH_LEVEL_61_70=4,t.SEARCH_LEVEL_71_80=5,t.SEARCH_LEVEL_71_90=6,t.mountLevelSortIDTable=[t.SEARCH_LEVEL_ALL,t.SEARCH_LEVEL_1_40,t.SEARCH_LEVEL_41_50,t.SEARCH_LEVEL_51_60,t.SEARCH_LEVEL_61_70,t.SEARCH_LEVEL_71_80,t.SEARCH_LEVEL_71_90],t.mountLevelText=[GameText.STR_UNLIMITED,"1-40"+GameText.STR_STEP,"41-50"+GameText.STR_STEP,"51-60"+GameText.STR_STEP,"61-70"+GameText.STR_STEP,"71-80"+GameText.STR_STEP,"81-90"+GameText.STR_STEP],t}();__reflect(MountRaiders.prototype,"MountRaiders");var NewArena=function(){function t(){this.actorId=0,this.competeCount=0,this.intervalTime=0,this.fightValue=0,this.rank=0,this.goldMoney=0,this.refreshMoney=0,this.intervalMoney=0,this.firstCost=0,this.score=0,this.icon1=0,this.level=0,this.job=0,this.leve2=0,this.time=0,this.isLead=!1,this.addmaxcount=0,this.isAlert=!1,this.type=0,this.result=0,this.round=0,this.planTime=0,this.waitStatus=0,this.pos=0,this.hp=0,this.mp=0,this.bstatus=0}return t.doActive=function(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_ACTIVE_COMPITION);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void AlertPanel.alertCommon(GameText2.STR_NEW_ARENA_ACTIVE_SUCCESS)}),this)},t.doEnter=function(e){var n=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_COMPTITION);nato.Network.sendCmd(n,t.onEnter,t,[e])},t.onEnter=function(e,n){var i=n[0];if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var o=GameWorld.newArena;0==i&&(o=new t),o.vArenaNew=[],o.competeCount=e.getByte();var a=e.getLong().value;a>0&&(a+=Date.now()+4e3),o.intervalTime=a,o.fightValue=e.getInt(),o.score=e.getInt(),o.rank=e.getInt(),o.goldMoney=e.getShort(),o.refreshMoney=e.getShort(),o.intervalMoney=e.getShort(),o.firstCost=e.getShort(),o.addmaxcount=e.getByte();for(var r=e.getByte(),s=0;r>s;s++){var l=t.getArenaNewfromByte(e);null!=l&&o.vArenaNew.push(l)}i?(null!=o.newArenaUI&&o.newArenaUI.update(),o.isAlert&&(AlertPanel.alertCommon(o.alertmsg),o.isAlert=!1,o.alertmsg="")):(PanelManager.openNewArenaScene(o),o.newArenaUI=PanelManager.getPanel(NewArenaScene),GameWorld.newArena=o,o.newArenaUI.update())}},t.getArenaNewfromByte=function(e){if(null==e)return null;var n=new t;return n.actorId=e.getInt(),n.name=e.getString(),n.fightValue=e.getInt(),n.rank=e.getInt(),n.score=e.getInt(),n.icon1=e.getInt(),n.level=e.getInt(),n.job=e.getInt(),n.leve2=e.getByte(),n.isLead=e.getBoolean(),n},t.doNewArenaActorList=function(t,e,n,i){if(void 0===n&&(n=100),void 0===i&&(i=1),null==t)return null;var o=new nato.Message(ProtocolDefine.CG_FIGHT_SHOW_RANK);o.putByte(e),o.putByte(n),o.putShort(i),nato.Network.sendCmd(o)},t.onNewArenaActorList=function(e){if(0>e.getByte())return AlertPanel.alertCommon(e.getString()),null;var n=e.getInt(),i=e.getByte(),o=GameWorld.newArena;o.vArenaNew=[];for(var a=0;i>a;a++){var r=t.getArenaNewfromByte(e);null!=r&&o.vArenaNew.push(r)}return[o.vArenaNew,n]},t.doExit=function(){function t(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):(GameWorld.newArena=null,PanelManager.openMainMenuScene(),xworld.vNewAreanbattle=null,void MsgHandler.createWorldDataReflashMsg())}AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText2.STR_NEW_ARENA_EXIT_ASK,(function(){var e=new nato.Message(ProtocolDefine.CG_FIGHT_EXIT_COMPTITION);nato.Network.sendCmd(e,t,this)}),this)},t.prototype.logic=function(t){this.newArenaUI&&this.newArenaUI.logic(t)},t.prototype.getTime=function(){var t="",e=this.intervalTime-Date.now();if(e>=1e3){var n=Math.floor(e/Tool.MILLIS_IN_HOUR);n>0&&(t+=Tool.manageString(GameText.STR_HOUR,n+""));var i=Math.floor((e-n*Tool.MILLIS_IN_HOUR)/Tool.MILLIS_IN_MINUTE);i>0&&(t+=Tool.manageString(GameText.STR_MINUTE,i+""));var o=Math.floor((e-n*Tool.MILLIS_IN_HOUR-i*Tool.MILLIS_IN_MINUTE)/Tool.MILLIS_IN_SECOND);o>0&&(t+=Tool.manageString(GameText2.STR_SECOND,o+""))}else t=GameText.STR_LIST_NULL;return t},t.prototype.isInCool=function(){return this.intervalTime-Date.now()>1e3},t.prototype.getNewArenaByIndex=function(t){return null==this.vArenaNew||this.vArenaNew.length<1||Tool.isArrayIndexOutOfBounds(t,this.vArenaNew)?null:this.vArenaNew[t]},t.doRefresh=function(){function e(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_REFRESH_COMPITION);nato.Network.sendCmd(t,n,this)}function n(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{o.money1=e.getInt(),o.money2=e.getInt();var n=e.getByte();i.vArenaNew=[];for(var a=0;n>a;a++){var r=t.getArenaNewfromByte(e);null!=r&&i.vArenaNew.push(r)}GameWorld.newArena=i,t.doEnter(!0),AlertPanel.alertCommon(GameText2.STR_NEW_ARENA_REFRESH_SUCCESS)}}var i=GameWorld.newArena;if(null!=i){var o=xself;if(null!=o){var a=o.money2>=i.refreshMoney?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED,r=Tool.manageString(GameText2.STR_RESIDUE_REFRESH,PowerString.makeColorString(i.refreshMoney+"",a));AlertPanel.alert(GameText2.STR_RESIDUE_REFRESH_TITLE,r,(function(){0!=SafeLock.doSafeLockVerify()&&Model.checkEnoughMoney(0,i.refreshMoney,0,e,this)}),this)}}},t.doSaveAdjust=function(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_SAVE_ADJUST);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void AlertPanel.alertCommon(GameText2.STR_NEW_ARENA_ADJUST_SUCCESS)}),this)},t.doChallenge=function(e,n){function i(){if(0!=SafeLock.doSafeLockVerify()){var n=new nato.Message(ProtocolDefine.CG_FIGHT_CREATE_COMPITION);n.putInt(e.actorId),nato.Network.sendCmd(n,t.onCreateCompition,t)}}if(null!=e){var o=xself;if(null!=o)if(e.isLead&&n>0){var a=o.money2>=n?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED,r=Tool.manageString(GameText2.STR_NEW_ARENA_LEAD_CHALLENGE_ASK,PowerString.makeColorString(n+"",a));AlertPanel.alert(GameText2.STR_RESIDUE_REFRESH_TITLE,r,(function(){Model.checkEnoughMoney(0,n,0,i,this)}),this)}else i()}},t.onCreateCompition=function(e){var n=xself;if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{n.money1=e.getInt(),n.money2=e.getInt();var i=e.getInt(),o=e.getByte(),a=e.getByte(),r=e.getByte(),s=e.getInt(),l=e.getInt(),_=e.getInt();o==Battle.LOCAL&&WorldMessage.addSystemChat("doChallenge() type = LOCAL, why????????????");for(var h=new Array(Battle.MAX_POS),u=e.getByte(),c=0;u>c;c++){var T=MsgHandler.parseBattleModel(e);null!=T&&(h[T.position]=T)}var p=Battle.createRemoteBattle(0,h,null);p.type=o,p.setBattleResult(a),p.round=r,p.roundEndTime=Date.now()+s,p.waitStatus=l,p.nextBattleGroupID=_,p.battleSeq=i,p.setRemoteWaiting(!1),xworld.battle=p,xworld.vNewAreanbattle=[];for(var d=e.getByte(),E=0;d>E;E++){var g=new t;g.result=e.getByte(),g.round=e.getByte(),g.planTime=e.getInt(),g.waitStatus=e.getInt(),u=e.getByte(),g.vplayer=[];for(var S=0;u>S;S++){var m=new t;m.pos=e.getByte(),m.hp=e.getInt(),m.mp=e.getInt(),m.bstatus=e.getInt(),g.vplayer.push(m)}var f=e.getByte();g.vresultControlList=[];for(var I=0;f>I;I++){var A=Control.fromBytes(e.getBytes());g.vresultControlList.push(A)}xworld.vNewAreanbattle.push(g)}var y="",R=e.getByte();if(1==R){var P=e.getInt(),C=e.getInt(),M=e.getInt(),L=e.getInt(),v=e.getInt(),O=e.getInt(),N=e.getInt(),D=e.getInt(),B=e.getInt(),b=e.getInt(),x=e.getInt(),G=e.getInt(),U=e.getInt(),w=e.getInt(),F=e.getInt();n.money2=O,n.money3=N,D>0&&n.addValue(ModelConst.LEVEL,D),n.exp=B,b>0&&n.addValue(ModelConst.SET_EXPMAX,b),x>0&&n.addValue(ModelConst.SP,x),G>0&&n.addValue(ModelConst.CP,G),U>0&&n.addValue(ModelConst.LEVEL2,U),n.exp2=w,F>0&&n.addValue(ModelConst.SET_EXPMAX2,F),P>0&&(y+=GameText.STR_INTEGRAL+":"+P+"\n"),C>0&&(y+=GameText2.STR_FIGHT_VALUE+C+"\n"),M>0&&(y+=GameText2.STR_MILESTONE_EXP+":"+M+"\n"),L>0&&(y+=GameText.STR_MONEY2+":"+L+"\n"),v>0&&(y+=GameText.STR_MONEY3+":"+v+"\n")}else if(2==R){P=e.getInt(),C=e.getInt();P>0&&(y+=GameText.STR_INTEGRAL+":"+P+"\n"),C>0&&(y+=GameText2.STR_FIGHT_VALUE+C+"\n")}null!=GameWorld.newArena&&0==Tool.isNullText(y)&&(GameWorld.newArena.alertmsg=Tool.manageString(GameText2.STR_STR_NEW_ARENA_GET_REWARD,y)),t.doEnter(!0),PanelManager.mainMenu.headInfoView.update(),PanelManager.updateWorldIconPoint();var H=BattleView.instance;H.setBattle(p),Main.instance.addGame(H),H.initBattle()}},t.doClearInterval=function(){function e(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_CLEAR_INTERVAL);nato.Network.sendCmd(t,n,this)}function n(e){return 0>e.getByte()?void AlertPanel.alertCommon(e.getString()):(o.money1=e.getInt(),o.money2=e.getInt(),i.intervalTime=0,GameWorld.newArena=i,t.doEnter(!0),void AlertPanel.alertCommon(GameText2.STR_NEW_ARENA_CLEAR_SUCCESS))}var i=GameWorld.newArena;if(null!=i){var o=xself;if(null!=o){var a=o.money2>=i.intervalMoney?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED,r=Tool.manageString(GameText2.STR_RESIDUE_COOLING,PowerString.makeColorString(i.intervalMoney+"",a));AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),r,(function(){0!=SafeLock.doSafeLockVerify()&&Model.checkEnoughMoney(0,i.intervalMoney,0,e,this)}),this)}}},t.doAddSurplus=function(){function e(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_ADD_FIGHT_COUNT);nato.Network.sendCmd(t,n,this)}function n(e){return 0>e.getByte()?void AlertPanel.alertCommon(e.getString()):(i.competeCount=e.getByte(),o.money1=e.getInt(),GameWorld.newArena=i,t.doEnter(!0),void AlertPanel.alertCommon(GameText2.STR_NEW_ARENA_ADD_COUNT_SUCCESS))}var i=GameWorld.newArena;if(null!=i){var o=xself;if(null!=o){var a=o.money1>=i.goldMoney?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED,r=Tool.manageStringList(GameText2.STR_RESIDUE_SURPLUS,[PowerString.makeColorString(i.goldMoney+"",a),i.addmaxcount+""]);AlertPanel.alert(GameText2.STR_RESIDUE_SURPLUS_TITLE,r,(function(){0!=SafeLock.doSafeLockVerify()&&Model.checkEnoughMoney(i.goldMoney,0,0,e,this)}),this)}}},t.doPushRefresh=function(e){null!=e&&(e.getBoolean()&&t.doEnter(!0))},t.doSeeState=function(){var t=new nato.Message(ProtocolDefine.GC_SYNC_INFO_COMPITION);nato.Network.sendCmd(t,(function(t){AlertPanel.alertNotify(GameText.getText(GameText.TI_WARM_SHOW),t.getString())}),this)},t.NEWARENA_TYPE_RANK=1,t.NEWARENA_TYPE_FIGHT=2,t.NEWARENA_TYPE_SCORE=3,t.NEWARENA_BATTLE_TIME=200,t}();__reflect(NewArena.prototype,"NewArena");var NewArenaRank=function(){function t(){this.ranktype=0,this.vipLv=0,this.actorId=0,this.actorValue=0,this.rank=0,this.fightValue=0,this.searchIndex=0}return t.doGetRankSearchType=function(){var e=new nato.Message(ProtocolDefine.GC_SYNC_MY_COMPITION_RANKLIST);nato.Network.sendCmd(e,t.onGetRank,t)},t.onGetRank=function(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var n=e.getByte(),i=new t;i.vNewArenaRankSearch=[],i.searchIndex=0;for(var o=0;n>o;o++){var a=new t;a.ranktype=e.getByte(),a.rankName=e.getString(),i.vNewArenaRankSearch.push(a)}PanelManager.openNewArenaRankScene(i),i.newArenaRankUI=PanelManager.getPanel(NewArenaRankScene);var r=i.getNewArenaSearchByIndex(0);t.doNewArenaRankActorList(i,r.ranktype,t.NEWARENA_RANK_PAGE_COUNT,1)}},t.doNewArenaRankActorList=function(e,n,i,o){if(null==e)return null;var a=new nato.Message(ProtocolDefine.CG_FIGHT_SHOW_RANK);a.putByte(n),a.putShort(i),a.putInt(o),nato.Network.sendCmd(a,t.onNewArenaRankActorList,t,[e])},t.onNewArenaRankActorList=function(e,n){var i=n[0];if(0>e.getByte())return AlertPanel.alertCommon(e.getString()),null;var o=e.getShort();i.valueName=e.getString();var a=e.getByte();i.vNewArenaRank=[];for(var r=0;a>r;r++){var s=t.getNewArenaRankFromByte(e);null!=s&&i.vNewArenaRank.push(s)}i.newArenaRankUI.update(i.vNewArenaRank,o)},t.getNewArenaRankFromByte=function(e){if(null==e)return null;var n=new t;return n.vipLv=e.getByte(),n.rank=e.getInt(),n.actorId=e.getInt(),n.actorname=e.getString(),n.actorValue=e.getInt(),n},t.prototype.getNewArenaSearchByIndex=function(t){return null==this.vNewArenaRankSearch||this.vNewArenaRankSearch.length<1||Tool.isArrayIndexOutOfBounds(t,this.vNewArenaRankSearch)?null:this.vNewArenaRankSearch[t]},t.prototype.getNewArenaActorByIndex=function(t){return null==this.vNewArenaRank||this.vNewArenaRank.length<1||Tool.isArrayIndexOutOfBounds(t,this.vNewArenaRank)?null:this.vNewArenaRank[t]},t.doSeeMyRank=function(){var t=new nato.Message(ProtocolDefine.GC_SYNC_MY_COMPITION_RANK);nato.Network.sendCmd(t,(function(t){t.getByte(),AlertPanel.alertCommon(t.getString())}),this)},t.doNewArenaSelectType=function(t){null==t||t.vNewArenaRankSearch},t.prototype.getSearchName=function(){var t="";if(null!=this.vNewArenaRankSearch){var e=this.getNewArenaSearchByIndex(this.searchIndex);null!=e&&(t=e.rankName)}return t},t.NEWARENA_RANK_PAGE_COUNT=8,t}();__reflect(NewArenaRank.prototype,"NewArenaRank");var NewArenaReward=function(){function t(){this.rwId=0,this.rwTotalScore=0,this.rwState=0,this.rwMoney1=0,this.rwMoney2=0,this.rwMoney3=0}return t.checkScoreReward=function(){var e=new nato.Message(ProtocolDefine.GC_SYNC_MY_COMPITION_REWARD);nato.Network.sendCmd(e,t.onCheckScoreReward,t)},t.onCheckScoreReward=function(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var n=new t;n.allList=[];for(var i=e.getByte(),o=0;i>o;o++){var a=new t;if(a.rwId=e.getInt(),a.rwTotalScore=e.getInt(),a.rwState=e.getByte(),e.getBoolean())if(e.getByte()>0){var r=e.getByte();if(r>0){a.rwItemList=[];for(var s=0;r>s;s++){var l=new ItemData;ItemData.fromBytesAtts2(l,e),l.quantity=e.getByte(),l.durability=l.durMax,a.rwItemList.push(l)}}else a.rwMoney1=e.getShort(),a.rwMoney2=e.getShort(),a.rwMoney3=e.getShort()}n.allList.push(a)}PanelManager.openNewArenaReward(n)}},t.prototype.doGetScoreReward=function(t,e){var n=new nato.Message(ProtocolDefine.GC_SYNC_MY_SCORE_REWARD);n.putInt(this.rwId),nato.Network.sendCmd(n,this.onGetScoreReward,this,[t,e])},t.prototype.onGetScoreReward=function(e,n){var i=n[0],o=n[1],a=xself;if(null!=a){if(0>e.getByte())return void AlertPanel.alertCommon(e.getString());if((e.getByte(),e.getByte())>0){var r=MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD);AlertPanel.alertCommon(GameText2.STR_ONLINE_REWARD_GET_ITEM_INFO+r),this.rwState=t.STATUS_HAS_GET}else{var s=e.getInt(),l=e.getInt(),_=e.getInt(),h=Tool.manageStringList(GameText2.STR_NEW_ARENA_REWARD_POPUP,[PowerString.makeColorString(this.rwMoney1+"",ColorUtils.COLOR_GREEN),PowerString.makeColorString(this.rwMoney2+"",ColorUtils.COLOR_GREEN),PowerString.makeColorString(this.rwMoney3+"",ColorUtils.COLOR_GREEN)]);AlertPanel.alertCommon(h),a.money1=s,a.money2=l,a.money3=_}i&&o&&i.call(o)}},t.prototype.getNewArenaReward=function(t){return null==this.allList||this.allList.length<1||Tool.isArrayIndexOutOfBounds(t,this.allList)?null:this.allList[t]},t.STATUS_CANNOT_GET=1,t.STATUS_HAS_GET=2,t.STATUS_CAN_GET=3,t}();__reflect(NewArenaReward.prototype,"NewArenaReward");var OfflineExp=function(){function t(){}return Object.defineProperty(t,"info",{get:function(){return null==t._info&&(t._info=new OfflineExpInfo),t._info},enumerable:!0,configurable:!0}),t.doOpenOfflineExp=function(){var e=new nato.Message(ProtocolDefine.CG_ACTOR_OFFLINE_EXP_OPEN);nato.Network.sendCmd(e,t.onOfflineExpHandler,t),PanelManager.openWaitForServer()},t.onOfflineExpHandler=function(e){PanelManager.closeWaitForServer(),t.info.fromBytes(e),PanelManager.openOffLineExpScene()},t.clean=function(){this.isOpen=!1,this._info=null},t.doGoddessUpgrade=function(){function e(e){if(PanelManager.closeWaitForServer(),0>e.getByte())AlertPanel.alertCommon(e.getString());else{for(var n=e.getShort(),i=0;n>i;i++){var o=e.getInt(),a=e.getShort(),r=e.getByte(),s=xself.bag.getItem(a);null==s?WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 删除的物品不存在"):s.id!=o&&WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 删除的物品ID错误. id1="+s.id+" id2="+o);var l=xself.bag.removeBagItemByPos(a,r);0>l&&WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 背包移出物品错误. rs="+l)}t.info.lv=e.getInt(),t.info.battleExp=e.getShort(),t.info.taskExp=e.getShort(),t.info.hpRecover=e.getShort(),t.info.mpRecover=e.getShort(),t.info.maxStoreMinutes=e.getInt(),t.info.itemCount=e.getShort(),t.info.expEachHour=e.getInt(),AlertPanel.alertCommon("女神像成功升级到"+t.info.lv+"级"),e.getBoolean()?t.info.nextLv=-1:(t.info.nextLv=e.getInt(),t.info.nextBattleExp=e.getShort(),t.info.nextTaskExp=e.getShort(),t.info.nextHpRecover=e.getShort(),t.info.nextMpRecover=e.getShort(),t.info.nextMaxStoreMinutes=e.getInt(),t.info.nextItemCount=e.getShort()),PanelManager.closeOffLineExpUpgradePanel(),PanelManager.updatePanel(OffLineExpScene)}}var n=this,i=t.info;if(null!=i){var o="是否花费 /cFFA500祈祷石*"+i.itemCount+"/p 升级女神像？";AlertPanel.alert("温馨提示",o,(function(){var t=new nato.Message(ProtocolDefine.CG_ACTOR_OFFLINE_UPGRADE);nato.Network.sendCmd(t,e,n),PanelManager.openWaitForServer()}),this)}},t.isOpen=!1,t}();__reflect(OfflineExp.prototype,"OfflineExp");var OfflineExpInfo=function(){function t(){this.nextLv=-1,this.nextBattleExp=-1,this.nextTaskExp=-1,this.nextHpRecover=-1,this.nextMpRecover=-1,this.nextMaxStoreMinutes=-1,this.nextItemCount=-1}return t.prototype.fromBytes=function(t){this.lv=t.getInt(),this.offlineTime=t.getInt(),this.prayedCount=t.getInt(),this.prayMaxCount=t.getInt(),this.prayCost=t.getShort(),this.prayExp=t.getInt(),this.battleExp=t.getShort(),this.taskExp=t.getShort(),this.hpRecover=t.getShort(),this.mpRecover=t.getShort(),this.maxStoreMinutes=t.getInt(),this.itemCount=t.getShort(),this.expEachHour=t.getInt(),this.trebleCost=t.getShort(),t.getBoolean()||(this.nextLv=t.getInt(),this.nextBattleExp=t.getShort(),this.nextTaskExp=t.getShort(),this.nextHpRecover=t.getShort(),this.nextMpRecover=t.getShort(),this.nextMaxStoreMinutes=t.getInt(),this.nextItemCount=t.getShort())},Object.defineProperty(t.prototype,"maxStoreHours",{get:function(){return Math.floor(this.maxStoreMinutes/30)/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expGetable",{get:function(){return Math.floor(this.offlineTime/30)/2*this.expEachHour},enumerable:!0,configurable:!0}),t}();__reflect(OfflineExpInfo.prototype,"OfflineExpInfo");var OneKeyDailyMission=function(){function t(){}return Object.defineProperty(t,"isDoingOnekeyMission",{get:function(){return this._isDoingOnekeyMission},set:function(e){this._isDoingOnekeyMission=e,this._isDoingOnekeyMission?this.start():(t.doStopOneKeyMission(),this.stop(),AutoGamer.autoGaming=!1)},enumerable:!0,configurable:!0}),t.start=function(){0==this._isStarting&&(this._isStarting=!0,nato.WorldTicker.instance.register(this.logic,this))},t.stop=function(){this._isStarting&&(this._isStarting=!1,nato.WorldTicker.instance.unregister(this.logic,this))},t.logic=function(e){if(this._logicCount+=e,!(this._logicCount<window.AUTO_MISSION_RATE)){if(window.__myEvent__.emit("auto:daily:logic"),t.checkIsFinish(this.ID_shihunshamo)&&xworld.isInCityNow()&&!t.f&&(this.stop(),this.doOneKeyMission_local(this.ID_yuangusenlin),t.f=!0),AlertPanel.instance&&AlertPanel.instance.stage)return void(AlertPanel.instance.tag==AlertPanel.Tag_loginout?this.isDoingOnekeyMission=!1:AlertPanel.instance.closePanel());if(this._logicCount=0,xworld.inBattle){var n=PanelManager.battleUI;n&&n.stage&&n.visible&&(n.btn_auto.stage&&n.btn_auto.visible&&n.btn_auto.parent.visible?(n.actionWidget=n.btn_auto,BattleInputHandler.instance.processOrderPopPanel()):n.btn_skip_anime.stage&&n.btn_skip_anime.visible&&(n.actionWidget=n.btn_skip_anime,BattleInputHandler.instance.processOrderPopPanel()));var i=PanelManager.battleResultPanel;return void(i&&i.stage&&i.visible&&BattleView.instance.doExit())}var o=PanelManager.npcDialogue;if(o&&o.stage&&o.visible){PanelManager.closeNPCDialogue();var a=o.getNpc();if(null!=t.waitSearchMissionIDList&&t.waitSearchMissionIDList.length>0){for(var r=o._actionList,s=null,l=0;l<r.length;l++){var _;if(s=null,8==(_=o._actionList[l]).action?s=_.data.mission:1==_.action&&(s=_.data),null!=s&&-1!=t.waitSearchMissionIDList.indexOf(s.getId()))return NPC.handleChoiceMissionAction(s,a),void(t.waitSearchMissionIDList=null)}return}if(8==(_=o._actionList[0]).action){s=_.data.mission;var h=_.data.subType;if(xworld.isInCityNow()&&!this.isCityTask(s))return;if(((u=s.getMissionStatus(xself))==MissionConst.NOT_CAN_SUBMIT||u==MissionConst.NOT_CAN_ACCEPT)&&h!=NPCConst.EVENT_MISSION_FIGHT&&h!=NPCConst.EVENT_ALL_TASK_PATH){if(null==(_=o._actionList[1])||_.type!=NPCActionData.Type_mission)return;s=_.data.mission,h=_.data.subType}if(s&&s.getId()==this._saveLastMissionID&&s.getMissionStatus(xself)==this._saveLastMissionStatus){if(this._saveLastMissionCount++,this._saveLastMissionCount>6)return this._saveLastMissionCount=0,this._saveLastMissionID=0,void(AutoGamer.autoGaming=!0)}else this._saveLastMissionID=s.getId(),this._saveLastMissionStatus=s.getMissionStatus(xself),this._saveLastMissionCount=0;Mission.doMenuButton(a,null,h,s)}else if(1==_.action){if(s=_.data){if(xworld.isInCityNow()&&!this.isCityTask(s))return;var u;((u=s.getMissionStatus(xself))==MissionConst.NOT_CAN_SUBMIT||u==MissionConst.NOT_CAN_ACCEPT)&&(_=o._actionList[1])}NPC.handlerMissionNPCAction(a,_)}else 2==_.action&&NPC.handlerMissionNPCAction(a,_)}else if(PanelManager.isOpeningFullScene);else if(xself.isAutoMove());else{AutoGamer.autoGaming||(AutoGamer.autoGaming=!0);var c=xself.x,T=xself.y;c==this._saveCurPosX&&T==this._saveCurPosY?(this._saveCount+=1e3,this._saveCount>5e3&&(this.isIgnoreAccepted=!0,this._saveCount=0)):(this._saveCurPosX=c,this._saveCurPosY=T,this._saveCount=0)}}},t.isCityTask=function(t){if(null!=t){var e=t.getId();return e>=3060&&3075>=e}},t.checkIsFinish=function(e){if(e==t.ID_yuangusenlin){e=t.idList_yuangusenlin[t.idList_yuangusenlin.length-1];if(Mission.isMissionFinish(xself,e))return!0}else{var n=this.getIDList(e),i=n[n.length-1];if(Mission.isMissionFinish(xself,i))for(var o=t.Task_cityList[e-1],a=0;a<o.length;a++){e=o[a];if(Mission.isMissionFinish(xself,e))return!0}}return!1},t.getIDList=function(e){var n=null;switch(e){case t.ID_yueyashan:n=t.idList_yueyashan;break;case t.ID_jinglingsenlin:n=t.idList_jinglingsenlin;break;case t.ID_fengyinmudi:n=t.idList_fengyinmudi;break;case t.ID_hanwanggumu:n=t.idList_hanwanggumu;break;case t.ID_juewangbingyuan:n=t.idList_juewangbingyuan;break;case t.ID_shihunshamo:n=t.idList_shihunshamo;break;case t.ID_yuangusenlin:n=t.idList_yuangusenlin;case t.ID_ziyunshan:n=t.idList_ziyunshan}return n},t.checkIsHaveAccept=function(e){if(e!=t.ID_yuangusenlin){for(var n=t.Task_cityList[e-1],i=0;i<n.length;i++){var o=n[i];if(null!=xself.getMissionById(o))return!0}return!1}return!1},t.checkIsEndWhileFinishMission=function(t){if(this._isDoingOnekeyMission&&null!=this.curCityTask_idList&&-1!=this.curCityTask_idList.indexOf(t)){this.curSelect;this.isDoingOnekeyMission=!1,AutoGamer.autoGaming=!1}},t.getNameByID=function(e){switch(e){case t.ID_fengyinmudi:return"封印墓地";case t.ID_hanwanggumu:return"汉王古墓";case t.ID_jinglingsenlin:return"精灵森林";case t.ID_juewangbingyuan:return"绝望冰原";case t.ID_shihunshamo:return"失魂沙漠";case t.ID_yuangusenlin:return"远古森林";case t.ID_yueyashan:return"月牙山"}return""},t.doOpenOnekeyDailyMission=function(){function e(e){PanelManager.closeWaitForServer(),t.isOpenOnekeyDailyMission=!0,PanelManager.updatePanel(OneKeyDailyMissionPanel)}!function(){var t=new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_ONEKEY_DAILY_MISSION);nato.Network.sendCmd(t,e,this),PanelManager.openWaitForServer()}()},t.doStopOneKeyMission=function(){var t=new nato.Message(ProtocolDefine.CG_ACTOR_STOP_ONEKEY_DAILY_MISSION);nato.Network.sendCmd(t,(function(t){return PanelManager.closeWaitForServer(),0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void 0}),this),PanelManager.openWaitForServer()},t.doExecOneKeyDailyMission=function(e){if(this.isOpenOnekeyDailyMission)if(t.checkIsFinish(e))AlertPanel.alertCommon("该系列任务已经完成!");else{var n=new nato.Message(ProtocolDefine.CG_ACTOR_EXEC_ONEKEY_DAILY_MISSION);n.putByte(e),nato.Network.sendCmd(n,(function(n){return PanelManager.closeWaitForServer(),0>n.getByte()?void AlertPanel.alertCommon(n.getString()):(PanelManager.closeOnekeyDailyMissionPanel(),void t.doOneKeyMission_local(e))}),this),PanelManager.openWaitForServer()}else AlertPanel.alertCommon("请先点击开启")},t.doOneKeyMission_local=function(e){if(this.curSelect=e,this.curSelect_idList=this.getIDList(e),this.curCityTask_idList=this.Task_cityList[e-1],e==t.ID_yuangusenlin){var n=this.yuangusenling_data[2];Mission.isMissionFinish(xself,n)||xself.getMissionById(n)?this.continueMissionInList(t.idList_yuangusenlin):(AutoFindPath.findTask(n),this.isDoingOnekeyMission=!0)}else{for(var i=this.Task_cityList[e-1],o=0;o<i.length;o++){var a=i[o],r=xself.getMissionById(a);if(null!=r){var s=this.getIDList(e);if(this.continueMissionInList(s))return;if(r.isComplete())return AutoFindPath.findTask(a),this.waitSearchMissionIDList=[a],void(this.isDoingOnekeyMission=!0)}}e==t.ID_juewangbingyuan||e==t.ID_shihunshamo?AutoFindPath.findPath(-1,AutoFindPath.NPCID_senior_cityTask):AutoFindPath.findPath(-1,AutoFindPath.NPCID_cityTask),this.waitSearchMissionIDList=i,this.isDoingOnekeyMission=!0}},t.continueMissionInList=function(e){if(null==e||0==e.length)return!0;for(var n=0;n<e.length;n++){var i=e[n];if(i>0&&0==Mission.isMissionFinish(xself,i))return AutoFindPath.findTask(i),t.waitSearchMissionIDList=null,t.isDoingOnekeyMission=!0,!0}return!1},t.isOpenOnekeyDailyMission=!1,t._isDoingOnekeyMission=!1,t.curSelect=0,t.yuangusenling_data=[263,15,2584],t.ziyunshan_data=[824,8,1703],t.ID_yueyashan=1,t.ID_jinglingsenlin=2,t.ID_fengyinmudi=3,t.ID_hanwanggumu=4,t.ID_juewangbingyuan=5,t.ID_shihunshamo=6,t.ID_yuangusenlin=7,t.ID_ziyunshan=8,t.openLvList=[30,35,40,40,40,40,50],t.idList_ziyunshan=[1552],t.idList_jinglingsenlin=[720,721,722,723,724,725,727,728,729,730,731,703,732,737,665,738,740,663,741,662,749,743,748,744,745,746,664,696,750,751,753,752,755,756,757,758,778,759,761,762,763,764,769,770,771,772,773,774,775,776,781,782,783,777,785],t.idList_yueyashan=[301,310,331,303,304,305,315,306,309,307,335,38,312,338,318,317,321,320,314,319,323,337,336,316,322,374,330,340,329,341,342,343,375,376,6,344,355,327,359,360,363,364,365,7,366,367,368,373,377,380],t.idList_fengyinmudi=[802,803,804,805,814,855,806,807,808,809,813,816,818,819,820,817,821,822,872,823,824,825,826,827,828,829,831,832,833,834,835,837,838,839,842,846,849,853,847,848,850,859,860,861,862,863,864,870,865,866,867,868,854,852],t.idList_hanwanggumu=[381,382,385,386,387,388,389,441,390,391,392,393,395,396,397,442,443,399,401,402,403,406,407,409,411,412,444,413,414,416,417,418,446,449,445,448,447,450,420,429,431,433,434,435,437],t.idList_juewangbingyuan=[500,502,503,504,501,505,506,509,510,511,513,515,516,518,519,521,523,524,525,526,528,529,530,517,547,531,532,533,534,537,538,548,539,549,540,543,550,542,551,541,552,553,544,545,554,555],t.idList_shihunshamo=[3022,3024,3025,71,72,73,74,75,76,1501,1502,1503,1505,8,9,78,13,1547,1546,15,1550,1516,17,1517,1518,1551,19,79,80,20,21,22,23,24,25,29,30,31,32,41],t.idList_yuangusenlin=[571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,613,614,615,616,617,628,629,618,619,620,621,622,623,624,625,626,627,630,631,632,633,634],t.Task_cityList=[[3061,3065,3069],[3060,3064,3068],[3062,3066,3070],[3063,3067,3071],[3072,3074],[3073,3075],[634]],t.curSelect_idList=[],t.curCityTask_idList=[],t._saveCurPosX=0,t._saveCurPosY=0,t._saveCount=0,t.isIgnoreAccepted=!1,t._saveLastMissionID=0,t._saveLastMissionStatus=0,t._saveLastMissionCount=0,t._isStarting=!1,t._logicCount=0,t}();__reflect(OneKeyDailyMission.prototype,"OneKeyDailyMission");var PetComposite=function(){function t(){this.petid=0,this.petlevel=0,this.petslotpos=0,this.pettype=0,this.petgrade=0,this.petbackicon=0,this.petneednum=0,this.petneedmoney1=0,this.petneedmoney2=0,this.petneedmoney3=0,this.ischoice=!1,this.petneegrade=0}return t.doGetPetCompositeShopData=function(e){var n=new nato.Message(ProtocolDefine.CG_COMPOSITE_PET_SHOP);n.putShort(e),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())return AlertPanel.alertCommon(n.getString()),null;for(var i=[],o=[],a=n.getByte(),r=0;a>r;r++){var s=new t;s.petcomposite=new t,s.petcompositepet=MyPet.fromBytesInfo(n,xself),s.petcompositepet.setName(n.getString()),s.petbackicon=n.getByte();var l=n.getInt();s.petcomposite.vcompositeList=[];for(var _=0;l>_;_++){var h=t.getPetCompositefrombytes(n);null!=h&&s.petcomposite.vcompositeList.push(h)}i.push(s);var u=new ShopItem;u.petComsiteInfo=s,u.bagIcon=s.petbackicon,u.name=s.petcompositepet.getName(),u.grade=s.petcompositepet.grade,o.push(u)}PanelManager.openOtherShopPanel(ShopType.SUB_SHOP_PETCOMPOSITE,e,o)}),this),PanelManager.openWaitForServer()},t.getPetCompositefrombytes=function(e){if(null==e)return null;var n=new t;return n.petid=e.getInt(),n.petname=e.getString(),n.pettype=e.getShort(),n.petgrade=e.getByte(),n.petneednum=e.getByte(),n.petneedmoney1=e.getInt(),n.petneedmoney2=e.getInt(),n.petneedmoney3=e.getInt(),n.petneegrade=e.getByte(),n},t.doPetCompositeSelectMenu=function(e,n){if(null!=n&&!(null==n.petcomposite.vcompositeList||n.petcomposite.vcompositeList.length<=0)){var i,o=[];i=new MenuActionData(GameText.getText(GameText.TI_BACK),t.Action_back),o.push(i);for(var a=0;a<n.petcomposite.vcompositeList.length;a++){var r=n.petcomposite.vcompositeList[a];null!=r&&(i=new MenuActionData(GameText.STR_COMBIN+Define.getGradeString(r.petgrade,!0),t.Action_grade_select,r),o.push(i))}PanelManager.openSelectMenuPanel(n.getPetCompositeNeedInfo(),o,(function(n,i){void 0===i&&(i=null),n==t.Action_back?PanelManager.closeSelectMenuPanel():n==t.Action_grade_select&&t.doPetCompositeSelect(e,i)}),this)}},t.prototype.getPetCompositeNeedInfo=function(){var t=null;t=Tool.manageString(GameText.STR_PETCOMPOSITE_NEED_INFO,this.petcompositepet.getName());for(var e=0;e<this.petcomposite.vcompositeList.length;e++){var n=this.petcomposite.vcompositeList[e];null!=n&&(t+="\n"+n.getPetCompositeInfo())}return t},t.prototype.getPetCompositeInfo=function(){var t="";return null==xself||(t=Define.getGradeString(this.petgrade,!0)+" : "+PowerString.makeColorString(this.petname,Define.getGradeColor(this.petneegrade))+(this.petneednum>0?"X"+this.petneednum:""),this.petneedmoney1>0&&(t+=" "+GameText.STR_MONEY1+this.petneedmoney1),this.petneedmoney2>0&&(t+=" "+GameText.STR_MONEY2+this.petneedmoney2),this.petneedmoney3>0&&(t+=" "+GameText.STR_MONEY3+this.petneedmoney3)),t},t.doPetCompositeSelect=function(t,e){if(null!=e){var n=new nato.Message(ProtocolDefine.CG_COMPOSITE_PET_DO);n.putShort(e.pettype),n.putByte(e.petgrade),n.putShort(t),n.putInt(e.petid),nato.Network.sendCmd(n,(function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){e.petcompositepet=new MyPet(null),MyPet.fromBytesDetail(t,e.petcompositepet);var n=t.getShort(),i=t.getByte();null!=e.petcompositepet?(e.petcompositepet.pettype=n,e.petcompositepet.petmaxage=i,e.petcompositepet.petneedid=e.petid,e.petcompositepet.refreshWorldSprite(),PanelManager.openPetDetailScene(e.petcompositepet,PetDetailScene.FromType_composite),PanelManager.closeSelectMenuPanel()):AlertPanel.alertCommon("查看失败")}}),this),PanelManager.openWaitForServer()}},t.doPetCompositeImmediately=function(e){if(null!=e){var n=xworld.shopID,i=new nato.Message(ProtocolDefine.CG_COMPOSITE_PET_PROMPTLY);i.putShort(e.pettype),i.putByte(e.grade),i.putShort(n),i.putInt(e.petneedid),nato.Network.sendCmd(i,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){var i,o=n.getBoolean(),a=n.getString(),r=0;if(o){r=n.getByte(),i=new Array(r);for(var s=0;r>s;s++)i[s]=n.getShort();var l=n.getInt(),_=n.getInt(),h=n.getInt();t.doPetCompositeEnSure(e.pettype,e.grade,i,a,l,_,h,e.petneedid)}else AlertPanel.alertCommon(a)}}),this),PanelManager.openWaitForServer()}},t.doPetCompositeEnSure=function(t,e,n,i,o,a,r,s){var l=xself;if(null==l)return!1;var _=l.bag;if(null==_)return!1;if(0==SafeLock.doSafeLockVerify())return!1;var h=xworld.shopID,u=function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){var e=MsgHandler.processAddItemMsg(t,ProtocolDefine.ADD_ITEM_USE_REWARD),n=t.getInt(),i=t.getInt(),o=t.getInt();l.money1=n,l.money2=i,l.money3=o;for(var a=t.getInt(),r=0;a>r;r++){var s=t.getShort();_.removeItem(s)}(PanelManager.isPanelShow(PetDetailScene)||PanelManager.isPanelShow(PetCompositeSelectPanel))&&PanelManager.closeScene(!0),AlertPanel.alertCommon(e)}},c=function(){var i=new nato.Message(ProtocolDefine.CG_COMPOSITE_PET_CONFIRM);i.putShort(t),i.putByte(e),i.putShort(h),i.putByte(n.length);for(var l=0;l<n.length;l++)i.putShort(n[l]);i.putInt(o),i.putInt(a),i.putInt(r),i.putInt(s),nato.Network.sendCmd(i,u,this),PanelManager.openWaitForServer()};return AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),i,(function(){Model.checkEnoughMoney(o,a,r,c,this)}),this),!0},t.doPetCompositeSelectPetData=function(e){if(null==e)return null;var n=xworld.shopID,i=new nato.Message(ProtocolDefine.CG_COMPOSITE_PET_GRADE);i.putShort(e.pettype),i.putByte(e.grade),i.putShort(n),i.putInt(e.petneedid),nato.Network.sendCmd(i,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){var i=new t;if(n.getBoolean()){i.petid=e.petneedid,i.petneednum=n.getByte(),i.pettype=n.getShort(),i.petgrade=n.getByte(),i.vcompositeList=[];for(var o=n.getByte(),a=0;o>a;a++){var r=new t;r.ischoice=n.getBoolean(),r.petslotpos=n.getShort(),r.petname=n.getString(),r.petlevel=n.getByte(),r.petgrade=n.getByte(),null!=r&&i.vcompositeList.push(r)}i.petneedmoney1=n.getInt(),i.petneedmoney2=n.getInt(),i.petneedmoney3=n.getInt(),i.petneedinfo=n.getString(),"null"==i.petneedinfo&&(i.petneedinfo=""),t.curSelectPetComposite=i,PanelManager.openPetCompositeSelectPanel(i)}else AlertPanel.alertCommon(n.getString())}}),this),PanelManager.openWaitForServer()},t.prototype.updateVcompositeList=function(t){if(!(null==this.vcompositeList||this.vcompositeList.length<=0))for(var e=0;e<this.vcompositeList.length;e++){var n=this.vcompositeList[e];null!=n&&n.petslotpos==t.petslotpos&&(this.vcompositeList[e]=t)}},t.prototype.isFullFit=function(){if(this.petneednum<=0)return!0;if(null==this.vcompositeList||this.vcompositeList.length<=0)return!1;for(var t=0,e=0;e<this.vcompositeList.length;e++){var n=this.vcompositeList[e];null!=n&&n.ischoice&&t++}return t==this.petneednum},t.prototype.getSelectInfo=function(){var t="";if(t+=" × "+this.petneednum,null!=this.vcompositeList||this.vcompositeList.length>0){for(var e=0,n=0;n<this.vcompositeList.length;n++){var i=this.vcompositeList[n];null!=i&&i.ischoice&&e++}if(e>0){var o=ColorUtils.COLOR_GREEN;e!=this.petneednum&&(o=ColorUtils.COLOR_RED),t+=" ("+PowerString.makeColorString(e+"",o)+")"}}return Tool.manageString(GameText.STR_COMPOSITE_INFO,t)},t.prototype.getSelectslotposArray=function(){if(null==this.vcompositeList||this.vcompositeList.length<=0)return null;for(var t=new Array(this.petneednum),e=0,n=0;n<this.vcompositeList.length;n++){var i=this.vcompositeList[n];if(null!=i&&1==i.ischoice){if(e>this.petneednum-1)break;t[e]=i.petslotpos,e++}}return t},t.prototype.getEnSureSelectInfo=function(){var t=xself;if(null==t)return"";var e="";if(this.petneedmoney1>0&&(e+=GameText.STR_MONEY1+this.getMoneyStr(t.money1,this.petneedmoney1,ModelConst.MONEY1)+"\n"),this.petneedmoney2>0&&(e+=GameText.STR_MONEY2+this.getMoneyStr(t.money2,this.petneedmoney2,ModelConst.MONEY2)+"\n"),this.petneedmoney3>0&&(e+=GameText.STR_MONEY3+this.getMoneyStr(t.money3,this.petneedmoney3,ModelConst.MONEY3)+"\n"),null!=this.vcompositeList&&this.vcompositeList.length>0){for(var n=[],i=new Array(this.vcompositeList.length),o=0,a=0;a<this.vcompositeList.length;a++){var r=this.vcompositeList[a];if(null!=r&&r.ischoice){var s=PowerString.makeColorString(r.petname,Define.getGradeColor(r.petgrade))+" "+Tool.manageString(GameText.getText(GameText.TI_LEVEL),r.petlevel+"");if(-1==n.indexOf(s))n.push(s),i[o]=1,o++;else{var l=n.lastIndexOf(s);i[l]=i[l]+1}}}for(var _=0;_<n.length;_++){e+=n[_]+" × "+i[_]+"\n"}}return Tool.manageStringList(GameText.STR_ENSURE_COMPOSITE_INFO,[e,this.petneedinfo])},t.prototype.getMoneyStr=function(t,e,n){var i=ColorUtils.COLOR_RED;if(t>=e)switch(n){case ModelConst.MONEY1:i=ColorUtils.COLOR_YELLOW;break;case ModelConst.MONEY2:i=ColorUtils.COLOR_MONEY2;break;case ModelConst.MONEY3:i=ColorUtils.COLOR_MONEY3}return PowerString.makeColorString(e+"",i)},t.Action_back=1,t.Action_grade_select=2,t}();__reflect(PetComposite.prototype,"PetComposite");var PlayerBag=function(){function t(e){this.bagEnd=t.BAG_SIZE-1,this.store=new Array(t.BAG_SIZE+t.MAX_STORE_SIZE+t.MAX_VIPSTORE_SIZE),this.nextTime=0,this.countOfTimeOpen=0,this.countOfMoneyOpen=0,this.countOfVipOpen=0,this.bagEnd_maxIndex=0,this._newItemList=[],null!=e&&(this.player=e,this.playerID=e.getId())}return t.prototype.getVipStorageEnd=function(){return t.VIPSTORE_END-1},t.prototype.isValidVipStoragePos=function(e){return e>=t.VIPSTORE_START&&e<=this.getVipStorageEnd()},t.prototype.getStorageNum=function(){return this.player.numStroe},t.prototype.getStorageEnd=function(){return t.STORE_START+this.player.numStroe-1},t.prototype.isValidStoragePos=function(e){return e>=t.STORE_START&&e<=this.getStorageEnd()},t.prototype.isStorageFull=function(){var e=this.getStartEndPos(t.TYPE_STORAGE_POS);if(null!=e)for(var n=e[0];n<=e[1];n++)if(null==this.getItem(n))return!1;return!0},t.prototype.putItemByStorage=function(t){if(null==t)return!1;var e=t.slotPos;if(0==this.isValidBagPos(e))return!1;var n=this.addStorageItem(t);return 0!=this.isValidStoragePos(n)&&(this.store[e]=null,!0)},t.prototype.putItemByVIPStorage=function(t){if(null==t)return!1;var e=t.slotPos;if(0==this.isValidBagPos(e))return!1;var n=this.addVIPStorageItem(t);return 0!=this.isValidVipStoragePos(n)&&(this.store[e]=null,!0)},t.prototype.getItemByStorage=function(t){if(null==t)return!1;var e=t.slotPos;if(0==this.isValidStoragePos(e))return!1;var n=this.addItemToBag(t);return 0!=this.isValidBagPos(n)&&(this.store[e]=null,!0)},t.prototype.getItemByVIPStorage=function(t){if(null==t)return!1;var e=t.slotPos;if(0==this.isValidVipStoragePos(e))return!1;var n=this.addItemToBag(t);return 0!=this.isValidBagPos(n)&&(this.store[e]=null,!0)},t.prototype.clearStorageItem=function(){this.clearItem(t.STORE_START,this.getStorageEnd())},t.prototype.clearVipStorageItem=function(){this.clearItem(t.VIPSTORE_START,this.getVipStorageEnd())},t.prototype.clearEquipAndBagItem=function(){this.clearItem(t.EQUIP_POS_START,this.bagEnd)},t.prototype.clearItem=function(t,e){for(var n=t;e>=n;n++)this.store[n]=null},t.prototype.getClone=function(e){var n=new t(e);return this.setPlayerBagData(n),n},t.prototype.setPlayerBagData=function(e){if(e.bagEnd=this.bagEnd,null!=this.store)for(var n=t.EQUIP_POS_START;n<t.EQUIP_POS_END;n++){var i=this.getItem(n);if(null!=i){var o=new ItemData;i.setItemDataTo(o),i.setVarItemDataTo(o),e.setItem(o)}}},t.prototype.initBagItem=function(t){if(null==this.store)return-1;if(null==t)return-2;for(var e=0;e<t.length;e++){var n=t[e];this.setItem(n)}return this.clearNewItemList(),Define.SUCCESS},t.prototype.getAttribute=function(e){switch(e){case 6:case 5:case 7:case 4:var n=[t.WEAPON_LEFT_POS,t.WEAPON_RIGHT_POS];return this.getAttributeByPosList(e,n);case 1:case 2:case 3:return this.getAttributeByRange(e,t.EQUIP_POS_START,t.EQUIP_POS_END);case 8:return this.getItemAtkType()}return 0},t.prototype.getAttributeByPos=function(t,e){return 0==this.isValidPos(e)||null==this.store[e]?-1:this.store[e].get(t)},t.prototype.getAttributeByPosList=function(t,e){if(null==e||e.length<=0)return 0;for(var n=0,i=0;i<e.length;i++){var o=e[i];0!=this.isValidPos(i)&&null!=this.store[o]&&(n+=this.store[o].get(t))}return n},t.prototype.getAttributeByRange=function(t,e,n){for(var i=0,o=e;n>o;o++)0!=this.isValidPos(o)&&null!=this.store[o]&&(i+=this.store[o].get(t));return i},t.prototype.getItemAtkType=function(){var e=this.getAttributeByPos(8,t.WEAPON_LEFT_POS);return-1!=e?e:-1!=(e=this.getAttributeByPos(8,t.WEAPON_RIGHT_POS))?e:Define.ATKTYPE_STR},t.prototype.getEquipPowerValue=function(e){if(0>=e)return 0;for(var n=0,i=t.EQUIP_POS_START;i<t.EQUIP_POS_END;i++)null!=this.store[i]&&(n+=this.store[i].getPowerValue(e));return n},t.prototype.getEquipItemSetNum=function(e){if(0>=e)return 0;for(var n,i=0,o=t.EQUIP_POS_START;o<t.EQUIP_POS_END;o++)null!=(n=this.store[o])&&n.get(10)==e&&i++;return i},t.prototype.addVIPStorageItem=function(e){return null==e?-1:this.addItem(t.TYPE_VIPSTORAGE_POS,e,e.quantity)},t.prototype.addStorageItem=function(e){return null==e?-1:this.addItem(t.TYPE_STORAGE_POS,e,e.quantity)},t.prototype.addItemToBag=function(e){return null==e?-1:this.addItem(t.TYPE_BAG_POS,e,e.quantity)},t.prototype.addItem=function(e,n,i){if(void 0===i&&(i=-1),null==n)return-1;if(-1==i&&(i=n.quantity),0>=i)return-2;if(1==n.isStackable()&&i>n.stackNum)return-3;var o=this.nextFreePos(e,n,i,!0);return 0==this.isValidPos(o)?-4:null!=this.store[o]?0==n.isStackable()?-5:this.store[o].quantity+i>this.store[o].stackNum?-6:(this.store[o].quantity+=i,o):(0==n.isStackable()?n.quantity=1:n.quantity=i,n.slotPos=o,this.store[o]=n,e==t.TYPE_BAG_POS&&this.addNewItem(n),o)},t.prototype.getStartEndPos=function(e){var n=0,i=0;switch(e){case t.TYPE_EQUIP_POS:n=t.EQUIP_POS_START,i=t.EQUIP_POS_END-1;break;case t.TYPE_BAG_POS:n=t.BAG_START,i=this.bagEnd;break;case t.TYPE_STORAGE_POS:n=t.STORE_START,i=this.getStorageEnd();break;case t.TYPE_VIPSTORAGE_POS:n=t.VIPSTORE_START,i=this.getVipStorageEnd()}return[n,i]},t.prototype.nextFreePosEmpty=function(t){var e=this.getStartEndPos(t);return this.findFreePos(e[0],e[1])},t.prototype.nextFreePos=function(t,e,n,i){var o=-1,a=this.getStartEndPos(t),r=a[0],s=a[1];if(1==e.isStackable())for(var l=r;s>=l;l++)if(0!=this.isValidPos(l)&&null!=this.store[l]&&!(this.store[l].isShopLocked()||this.store[l].id!=e.id||this.store[l].quantity+n>this.store[l].stackNum)){o=l;break}return 1==this.isValidPos(o)||0==i?o:this.nextFreePosEmpty(t)},t.prototype.findFreePos=function(t,e){for(var n=t;e>=n;n++)if(0!=this.isValidPos(n)&&null==this.store[n])return n;return-1},t.prototype.countFreePos=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++)null==this.store[n]&&e++;return e},t.prototype.countUsedSlot=function(t){var e=0;if(null==t)return e;for(var n=0;n<t.length;n++){var i=t[n];0!=this.isValidPos(i)&&null!=this.store[i]&&e++}return e},t.prototype.countUsedSlotBetween=function(t,e){for(var n=0,i=t;e>=i;i++)0!=this.isValidPos(i)&&null!=this.store[i]&&n++;return n},t.prototype.equipItem=function(e,n){if(void 0===n&&(n=null),null==this.store)return-1;var i=this.getItem(e);if(null==i)return-2;if(null==n&&(n=t.getEquipPosByType(i.type)),null==n||n.length<=0)return-3;for(var o=0;o<n.length;o++)if(0==this.isValidByEquipTypeAndPos(n[o],i.type))return-4;var a=!1;if(this.isHaveEquipOneHandHand()>0&&t.isOneHandWeaponType(i.type)&&(a=!0),0==a&&1==t.isValidWeaponPos(n[0])&&(this.isSameWeaponType(i.type)<0||1==t.isTwoHandWeaponType(i.type)))return i.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?-5:this.equipWeapon(i.slotPos);for(o=0;o<n.length;o++){var r=n[o];if(0==t.isValidEquipPos(r))return-5;var s=this.store[r];if(null==s)return this.swapItem(r,i.slotPos);if(i.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND){if(s.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND)return this.swapItem(r,i.slotPos)}else if(1==a&&t.isOneHandWeaponType(s.type))return this.swapItem(r,i.slotPos)}return i.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?-6:1==a?-7:this.swapItem(n[0],i.slotPos)},t.prototype.equipWeapon=function(e){var n=this.countUsedSlot([t.WEAPON_LEFT_POS,t.WEAPON_RIGHT_POS]);if(2==n){if(this.countFreePos()<n-1)return-11;var i=this.nextFreePosEmpty(t.TYPE_BAG_POS);if(this.isValidBagPos(i),1!=this.swapItem(t.WEAPON_LEFT_POS,e))return-12;if(1!=this.swapItem(t.WEAPON_RIGHT_POS,i))return this.swapItem(e,t.WEAPON_LEFT_POS),-13}else if(1==n){if(null!=this.store[t.WEAPON_RIGHT_POS])if(1!=this.swapItem(t.WEAPON_LEFT_POS,t.WEAPON_RIGHT_POS))return-14;if(1!=this.swapItem(t.WEAPON_LEFT_POS,e))return-15}else if(0==n){if(1!=this.swapItem(t.WEAPON_LEFT_POS,e))return-16}return 1},t.isOneHandWeaponType=function(t){return t==Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD||t==Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE||t==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW||t==Define.ITEM_TYPE_WEAPON_ONEHAND_GUN},t.getEquipChangeType=function(t){var e=t;return t>=Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD&&t<=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&(e=1e5),e},t.prototype.isHaveEquipOneHandHand=function(){return null!=this.store[t.WEAPON_LEFT_POS]&&this.store[t.WEAPON_LEFT_POS].type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?t.WEAPON_LEFT_POS:null!=this.store[t.WEAPON_RIGHT_POS]&&this.store[t.WEAPON_RIGHT_POS].type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND?t.WEAPON_RIGHT_POS:-1},t.prototype.isSameWeaponType=function(e){if(null==this.store)return-2;if(e==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND){var n=-1;null!=this.store[t.WEAPON_LEFT_POS]&&(n=this.store[t.WEAPON_LEFT_POS].type);var i=-1;return null!=this.store[t.WEAPON_RIGHT_POS]&&(i=this.store[t.WEAPON_RIGHT_POS].type),t.isOneHandWeaponType(n)&&(-1==i||i==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND)||t.isOneHandWeaponType(i)&&(-1==n||n==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND)?3:-5}return null!=this.store[t.WEAPON_LEFT_POS]&&e!=this.store[t.WEAPON_LEFT_POS].type?-3:null!=this.store[t.WEAPON_RIGHT_POS]&&e!=this.store[t.WEAPON_RIGHT_POS].type?-4:null==this.store[t.WEAPON_LEFT_POS]&&null==this.store[t.WEAPON_RIGHT_POS]?2:1},t.prototype.unequipItem=function(e){if(null==e)return-1;var n=e.slotPos;if(!t.isValidEquipPos(n))return-2;var i=this.nextFreePosEmpty(t.TYPE_BAG_POS);if(0>i)return-3;var o=!1,a=this.isHaveEquipOneHandHand();return t.isOneHandWeaponType(e.type)&&a>0&&(o=!0),1==o&&this.countFreePos()<2?-4:(this.swapItem(n,i),1==o&&(i=this.nextFreePosEmpty(t.TYPE_BAG_POS),1==this.isValidBagPos(i)&&this.swapItem(a,i)),i)},t.prototype.getItem=function(t){return null==this.store||0==this.isValidPos(t)?null:this.store[t]},t.prototype.getBagItemBySlotPos=function(t){return this.isValidBagPos(t)?this.getItem(t):null},t.prototype.setItem=function(t){return null==t?-1:this.setItemWithSlot(t,t.slotPos)},t.prototype.setItemWithSlot=function(t,e){return null==this.store?-1:null==t?-2:(-1==e&&(e=t.slotPos),0==this.isValidPos(e)?-3:(t.slotPos=e,this.store[e]=t,Define.SUCCESS))},t.prototype.removeItem=function(t){return 0==this.isValidPos(t)?-1:null==this.getItem(t)?-2:(this.store[t]=null,1)},t.prototype.removeBagItemByPos=function(t,e){var n=this.getItem(t);return null==n?-3:e>n.quantity?-4:0>e?-5:(n.quantity-=e,n.quantity<=0&&(this.store[t]=null),Define.SUCCESS)},t.prototype.removeBagItemByNum=function(e,n){if(n>this.getItemNumByID(e))return-1;for(var i=this.bagEnd;i>=t.BAG_START;i--){var o=this.getItem(i);if(null!=o&&o.id==e){if(o.quantity>n)return o.quantity-=n,1;if(o.quantity==n)return this.store[i]=null,1;n-=o.quantity,this.store[i]=null}}return n>0?-1:1},t.prototype.getCanUsePetItemList=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetCanUseItem()&&e.push(i))}return e},t.prototype.getCanUsePetItemList2=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetCanUseItem2()&&e.push(i))}return e},t.prototype.getPetItemReset1=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetReset1()&&e.push(i))}return e},t.prototype.getPetItemReset2=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetReset2()&&e.push(i))}return e},t.prototype.getPetAgeItem=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetAgeItem()&&e.push(i))}return e},t.prototype.getPetItemAddSkillList=function(){if(null==this.store)return null;for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&(i.isNotOperate()||i.isPetAddSkill()&&e.push(i))}return e},t.getMyBagPetItemAddSkillNum=function(){if(null==xself)return 0;var t=xself.bag;return null==t?0:t.getItemNumByID(Define.ITEM_ID_PET_ADD_SKILL)},t.prototype.getCanUseItemList=function(e){if(null==this.store)return null;for(var n=new Array,i=t.BAG_START;i<=this.bagEnd;i++){var o=this.store[i];null!=o&&(o.isNotOperate()||o.isPetCanUseItem()||o.vipLevelReq>this.player.getVipLevel()||Define.POWER_NEW_GET_PET!=o.power1&&Define.POWER_NEW_GET_ITEM!=o.power1&&Define.POWER_ENCHANT_ITEM!=o.power1&&Define.POWER_FORMATION_BOOK!=o.power1&&Define.POWER_TURN_MONSTER_CARD!=o.power1&&(o.isColorBox()||o.isUpgradeIntensifyScroll()||o.isIdentifyScrollItem()||o.isHighIdentifyScrollItem()||o.isUpgradeIdentifyScrollItem()||o.isCanUse(e)&&n.push(o)))}return n},t.prototype.getAttachGemItemList=function(e){if(null==this.store)return null;if(null==e)return null;for(var n=new Array,i=t.BAG_START;i<=this.bagEnd;i++){var o=this.store[i];null!=o&&(o.isNotOperate()||o.type==Define.ITEM_TYPE_GEM&&(e.isAttackBroken()||ItemData.isReplaceInlayGem(e.attachPower)&&e.attachValue>=20||0==e.attachDone||e.attachDone>0&&e.attachPower==o.power1)&&n.push(o))}return n},t.prototype.getCanChangeAttachGemItemList=function(e){if(null==this.store)return null;if(null==e)return null;for(var n=new Array,i=t.BAG_START;i<=this.bagEnd;i++){var o=this.store[i];null!=o&&(o.isNotOperate()||o.type==Define.ITEM_TYPE_GEM&&0!=ItemData.isReplaceInlayGem(o.power1)&&1!=o.powerValue1&&n.push(o))}return n},t.getCompareEquip=function(e,n){if(null==e)return-1;var i=this.getEquipPosByType(n);if(null==i)return-2;for(var o=null,a=0;a<i.length;a++){var r=i[a];if(0!=t.isValidEquipPos(r)){var s=e.getItem(r);if(null!=s){if(n==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&s.type!=n)continue;if(null==o)o=s;else null==ItemData.getBagGuideItem(o,s)&&(o=s)}}}return o},t.getTypeByEquipPos=function(e){var n=new Array;switch(e){case t.ARMOR_NECKLACE_POS:n.push(Define.ITEM_TYPE_ARMOR_NECKLACE);break;case t.PET_POS:n.push(Define.ITEM_TYPE_PET);break;case t.ARMOR_RING_LEFT_POS:case t.ARMOR_RING_RIGHT_POS:n.push(Define.ITEM_TYPE_ARMOR_RING);break;case t.ARMOR_FASHION_POS:n.push(Define.ITEM_TYPE_ARMOR_FASHION);break;case t.ARMOR_BACK_POS:n.push(Define.ITEM_TYPE_ARMOR_BACK);break;case t.ARMOR_CLOTHES_POS:n.push(Define.ITEM_TYPE_ARMOR_CLOTHES);break;case t.ARMOR_HAND_POS:n.push(Define.ITEM_TYPE_ARMOR_HAND);break;case t.ARMOR_HEAD_POS:n.push(Define.ITEM_TYPE_ARMOR_HEAD);break;case t.WEAPON_LEFT_POS:case t.WEAPON_RIGHT_POS:n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD),n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE),n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE),n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_BOW),n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_HAND),n.push(Define.ITEM_TYPE_WEAPON_BALL),n.push(Define.ITEM_TYPE_WEAPON_ONEHAND_GUN),n.push(Define.ITEM_TYPE_WEAPON_TWOHAND_GUN);break;case t.ARMOR_SHOES_POS:n.push(Define.ITEM_TYPE_ARMOR_SHOES);break;case t.ARMOR_WAIST_POS:n.push(Define.ITEM_TYPE_ARMOR_WAIST);break;case t.ARMOR_TROUSERS_POS:n.push(Define.ITEM_TYPE_ARMOR_TROUSERS);break;case t.ARMOR_SHOULDER_POS:n.push(Define.ITEM_TYPE_ARMOR_SHOULDER);break;case t.ARMOR_AMULET_POS:n.push(Define.ITEM_TYPE_ARMOR_AMULET);break;case t.ARMOR_TRANSPORT_POS:n.push(Define.ITEM_TYPE_ARMOR_TRANSPORT);break;case t.SPIRIT_POS:break;default:return null}return n},t.getEquipPosByType=function(e){var n=null;switch(e){case Define.ITEM_TYPE_ARMOR_HEAD:return(n=new Array(1))[0]=t.ARMOR_HEAD_POS,n;case Define.ITEM_TYPE_ARMOR_CLOTHES:return(n=new Array(1))[0]=t.ARMOR_CLOTHES_POS,n;case Define.ITEM_TYPE_ARMOR_TROUSERS:return(n=new Array(1))[0]=t.ARMOR_TROUSERS_POS,n;case Define.ITEM_TYPE_ARMOR_SHOULDER:return(n=new Array(1))[0]=t.ARMOR_SHOULDER_POS,n;case Define.ITEM_TYPE_ARMOR_WAIST:return(n=new Array(1))[0]=t.ARMOR_WAIST_POS,n;case Define.ITEM_TYPE_ARMOR_BACK:return(n=new Array(1))[0]=t.ARMOR_BACK_POS,n;case Define.ITEM_TYPE_ARMOR_SHOES:return(n=new Array(1))[0]=t.ARMOR_SHOES_POS,n;case Define.ITEM_TYPE_ARMOR_HAND:return(n=new Array(1))[0]=t.ARMOR_HAND_POS,n;case Define.ITEM_TYPE_ARMOR_NECKLACE:return(n=new Array(1))[0]=t.ARMOR_NECKLACE_POS,n;case Define.ITEM_TYPE_ARMOR_RING:return(n=new Array(2))[0]=t.ARMOR_RING_LEFT_POS,n[1]=t.ARMOR_RING_RIGHT_POS,n;case Define.ITEM_TYPE_ARMOR_AMULET:return(n=new Array(1))[0]=t.ARMOR_AMULET_POS,n;case Define.ITEM_TYPE_ARMOR_TRANSPORT:return(n=new Array(1))[0]=t.ARMOR_TRANSPORT_POS,n;case Define.ITEM_TYPE_ARMOR_FASHION:return(n=new Array(1))[0]=t.ARMOR_FASHION_POS,n;case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:case Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD:case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:case Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE:case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF:case Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE:case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_BOW:case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:case Define.ITEM_TYPE_WEAPON_BALL:case Define.ITEM_TYPE_WEAPON_ONEHAND_GUN:case Define.ITEM_TYPE_WEAPON_TWOHAND_GUN:return(n=new Array(2))[0]=t.WEAPON_LEFT_POS,n[1]=t.WEAPON_RIGHT_POS,n;case Define.ITEM_TYPE_PET:return(n=new Array(1))[0]=t.PET_POS,n}return null},t.prototype.swapItem=function(e,n){if(0==this.isValidPos(e))return-501;if(0==this.isValidPos(n))return-502;var i=this.store[e],o=this.store[n];return null!=i&&(i.slotPos=n,0==t.isValidEquipPos(n)&&i.durability>i.durMax&&(i.durability=i.durMax)),this.store[n]=i,null!=o&&(o.slotPos=e,0==t.isValidEquipPos(e)&&o.durability>o.durMax&&(o.durability=o.durMax)),this.store[e]=o,1},t.prototype.refreshBag=function(){for(var e=this.bagEnd;e>=t.BAG_START;e--){if(null!=(l=this.getItem(e))&&0!=l.isStackable()){var n=this.nextFreePos(t.TYPE_BAG_POS,l,l.quantity,!1);0!=this.isValidBagPos(n)&&null!=this.getItem(n)&&n!=l.slotPos&&(this.store[n].quantity+l.quantity>this.store[n].stackNum||(this.store[n].quantity+=l.quantity,this.store[e]=null))}}var i=new Array;for(e=t.BAG_START;e<=this.bagEnd;e++){if(null!=(l=this.getItem(e)))for(var o=0;;){if(o>=i.length){i.push(l);break}var a=i[o];if(null==a)return Define.ERROR;var r=[l.type,l.grade,l.reqLv],s=[a.type,a.grade,a.reqLv];if(1==this.canInsertByOrder(r,s)){i.splice(o,0,l);break}o++}}for(e=t.BAG_START;e<=this.bagEnd;e++){var l=null,_=e-t.BAG_START;_>=0&&_<i.length&&(l=i[_]),null!=l&&(l.slotPos=e),this.store[e]=l}return Define.SUCCESS},t.prototype.canInsertByOrder=function(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!=e[n])return t[n]<e[n];return!1},t.prototype.isValidPos=function(t){return t>=0&&t<this.store.length},t.prototype.isValidBagPos=function(e){return e>=t.BAG_START&&e<=this.bagEnd},t.isValidEquipPos=function(e){return e>=t.EQUIP_POS_START&&e<t.EQUIP_POS_END},t.isValidWeaponPos=function(e){return e==t.WEAPON_LEFT_POS||e==t.WEAPON_RIGHT_POS},t.isTwoHandWeaponType=function(t){return t==Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD||t==Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE||t==Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY||t==Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF||t==Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE||t==Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW||t==Define.ITEM_TYPE_WEAPON_BALL||t==Define.ITEM_TYPE_WEAPON_TWOHAND_BOW||t==Define.ITEM_TYPE_WEAPON_TWOHAND_GUN},t.prototype.isValidByEquipTypeAndPos=function(e,n){var i=t.getEquipPosByType(n);if(null==i||i.length<=0)return!1;for(var o=0;o<i.length;o++)if(i[o]==e)return!0;return!1},t.prototype.checkEquipTimeItem=function(){for(var e=t.EQUIP_POS_START;e<t.EQUIP_POS_END;e++){var n=this.getItem(e);null!=n&&(n.checkTimeItem(),n.setStatusBit(!1,64))}},t.prototype.changeDurability=function(e,n){for(var i=t.EQUIP_POS_START;i<t.EQUIP_POS_END;i++)if(i!=t.SPIRIT_POS){var o=this.getItem(i);if(null!=o&&0!=o.durability){var a=o.durability;if(0>e){if(n==t.DUR_CHANGE_TYPE_POINT)a+=e;else if(n==t.DUR_CHANGE_TYPE_PERCENT){a=a*(100+e)/100}0>a&&(a=0)}o.durability=a}}TodayEvent.updateTodayEvent(TodayEvent.ID_repair)},t.prototype.handlePlayerDurability=function(e){e?this.changeDurability(-t.DEAD_DUR_DOWN,t.DUR_CHANGE_TYPE_PERCENT):this.changeDurability(-t.DUR_DOWN_POINT,t.DUR_CHANGE_TYPE_POINT)},t.prototype.getItemNumByID=function(e){for(var n=0,i=t.BAG_START;i<=this.bagEnd;i++){var o=this.getItem(i);null!=o&&o.id==e&&(n+=o.quantity)}return n},t.prototype.isEquipItemByIdInEquip=function(e){for(var n=t.EQUIP_POS_START;n<t.EQUIP_POS_END;n++){var i=this.getItem(n);if(null!=i&&i.id==e)return!0}return!1},t.prototype.isBagFull=function(t){var e=new Array(1);return e[0]=t,this.isBagFull3(e,[])},t.prototype.isBagFull2=function(t,e){var n=new Array(1);return n[0]=e,this.isBagFull3(t,n)},t.prototype.isBagFull3=function(e,n){var i=this.countFreePos(),o=0,a=null;if(null!=e&&e.length>0)for(var r=0;r<e.length;r++)if(null!=(a=e[r]))if(0!=a.isStackable()){var s=this.nextFreePos(t.TYPE_BAG_POS,a,a.quantity,!1);0==this.isValidBagPos(s)&&o++}else o++;if(null!=n&&n.length>0)for(r=0;r<n.length;r++)if(null!=(a=n[r])){if(0==a.isStackable()){o++;break}s=this.nextFreePos(t.TYPE_BAG_POS,a,a.quantity,!1);if(0==this.isValidBagPos(s)){o++;break}}return o>i},t.isHaveBrokenEquip=function(){var t=xself;return!(!t||!t.bag)&&t.bag.isDestroyEquip(!1)},t.prototype.isDestroyEquip=function(e,n){void 0===n&&(n=null);for(var i=!1,o=t.EQUIP_POS_START;o<this.bagEnd;o++)if(o!=t.PET_POS&&o!=t.SPIRIT_POS){var a=this.getItem(o);null!=a&&a.isEquipClass()&&(a.isDestroy()||0==e&&a.isWillDestroy())&&(null!=n&&n.append("\n"+a.getNameInfo()+"("+a.durability+"/"+a.getDurMax(this.player)+")"),i=!0)}return i},t.prototype.getRepairEquipCount=function(){for(var e=0,n=t.EQUIP_POS_START;n<this.bagEnd;n++)if(n!=t.PET_POS&&n!=t.SPIRIT_POS){var i=this.getItem(n);null!=i&&i.isEquipClass()&&i.isWillDestroy()&&e++}return e},t.prototype.getStrongerEquipCount=function(){for(var e=[],n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.isEquipClass()&&this.checkIsStrongerItem(i)&&e.push(i)}return e.length},t.prototype.getIdentifyScrollNum=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.isIdentifyScrollItem()&&(e+=i.quantity)}return e},t.prototype.getHighIdentifyScrollNum=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.isHighIdentifyScrollItem()&&(e+=i.quantity)}return e},t.prototype.getUpgradeIdentifyScrollNum=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.isUpgradeIdentifyScrollItem()&&(e+=i.quantity)}return e},t.prototype.getUpgradeUpstarScrollNum=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.isUpgradeIntensifyScroll()&&(e+=i.quantity)}return e},t.getQuickHPItemVector=function(e){if(null==e)return null;var n=e.bag;if(null==n)return null;for(var i=new Array,o=t.BAG_START;o<=n.bagEnd;o++){var a=n.getItem(o);if(null!=a){var r=a.getPower1AndPower2(Define.POWER_HP_PERCENT);if(!(0>=r||0==a.isCanUse(1)&&0==a.isCanUse(3)))if(0!=i.length)for(var s=0;s<i.length;s++){if(r<=i[s].getPower1AndPower2(Define.POWER_HP_PERCENT)){i.splice(s,0,a);break}s==i.length-1&&i.push(a)}else i.push(a)}}return i},t.getIdentifyItemVector=function(e,n){if(void 0===n&&(n=!1),null==e)return null;var i=e.bag;if(null==i)return null;for(var o=new Array,a=t.BAG_START;a<=i.bagEnd;a++){var r=i.getItem(a);null!=r&&1==r.isIdentifyItem()&&0==r.isNotOperate()&&(n?r.isUpgradeItem&&o.push(r):o.push(r))}return o},t.prototype.getGemAndEquipList=function(t,e){for(var n=new Array,i=0;i<=this.bagEnd;i++){var o=this.getItem(i);null!=o&&(o.isNotOperate()||(e&&o.isCanEquip()&&o.isCanAttach()||t&&o.type==Define.ITEM_TYPE_GEM)&&n.push(o))}return n},t.prototype.getCanUpStarEquipList=function(t){for(var e=new Array,n=0;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&(i.isNotOperate()||(t?i.upgradeAscensionStar>0&&e.push(i):i.ascensionStar>0&&e.push(i)))}return e},t.prototype.getCanDecomposeItemList=function(){for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&0==i.isNotOperate()&&0==i.isIntegral()&&0==i.isEnchant()&&1==i.isEquipClass()&&0==this.player.isShopMode()&&0==i.isTimeItemTimeOut()&&e.push(i)}return e},t.prototype.getCanEnchantItemList=function(){for(var e=new Array,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&0==i.isNotOperate()&&0==i.isIntegral()&&0==i.isEnchant()&&i.grade>=2&&i.isEquipClass()&&e.push(i)}return e},t.getPagItemVector=function(e){if(null==e)return null;var n=e.bag;if(null==n)return null;for(var i=new Array,o=t.BAG_START;o<=n.bagEnd;o++){var a=n.getItem(o);null!=a&&i.push(a)}return i},t.prototype.getItemListByType=function(e,n){void 0===n&&(n="type");for(var i=new Array,o=t.BAG_START;o<=this.bagEnd;o++){var a=this.getItem(o);null!=a&&n in a&&a[n]==e&&i.push(a)}return i},t.clearBagAllItemStatus=function(e,n){if(null==e)return!1;var i=e.bag;if(null==i)return!1;for(var o=t.BAG_START;o<=i.bagEnd;o++){var a=i.getItem(o);if(null!=a)switch(n){case t.CLEAR_BAG_SELLING_STATUS:a.setSelling(!1);break;case t.CLEAR_BAG_MAIL_SELECT:a.setMailSelect(!1);break;case t.CLEAR_BAG_SHOP_LOCKED:a.setShopLocked(!1);break;case t.CLEAR_BAG_INTEGRAL:a.setIntegral(!1)}}return!0},t.prototype.getAllEquip=function(){for(var t=new Array,e=0;e<=this.bagEnd;e++){var n=this.getItem(e);null!=n&&n.isCanEquip()&&t.push(n)}return t},t.repairEquip=function(e,n,i){if(null==e)return-1;var o=e.bag;if(null==o)return-1;var a=t.EQUIP_POS_START,r=o.bagEnd;1==this.isValidEquipPos(n)&&(a=n,r=n);for(var s=0,l=a;r>=l;l++){var _=o.getItem(l);if(null!=_&&0!=_.isCanRepair())if(1==i){var h=_.getRepairCost();0>h&&(h=0),s+=h}else _.durability=_.getDurMax(e)}return s},t.getBagItemByID=function(e,n){if(null==e)return null;var i=e.bag;if(null==i)return null;for(var o=new Array,a=t.BAG_START;a<=i.bagEnd;a++){var r=i.getItem(a);null!=r&&r.id==n&&o.push(r)}return o},t.prototype.getRepairItemCount=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.getItem(n);null!=i&&i.id==Define.ITEM_ID_REPAIR&&(e+=i.quantity)}return e},t.prototype.doUseRepairItemInBag=function(){for(var e=t.BAG_START;e<=this.bagEnd;e++){var n=this.getItem(e);if(null!=n&&n.id==Define.ITEM_ID_REPAIR)return void ItemManager.doItem(n)}},t.prototype.isOnehandEquipeGuide=function(e,n){var i=-1;null!=xself.bag.store[t.WEAPON_LEFT_POS]&&xself.bag.store[e]&&(i=xself.bag.store[e].type);var o=-1;return null!=xself.bag.store[t.WEAPON_RIGHT_POS]&&xself.bag.store[n]&&(o=xself.bag.store[n].type),-1!=i&&-1!=o},t.checkServerEquip=function(e){if(xself.isNovice&&e.type!=Define.ITEM_TYPE_ARMOR_FASHION){var n,i=t.isOneHandWeaponType(e.type),o=Define.ITEM_TYPE_ARMOR_RING==e.type,a=!1;if(t.isOneHandWeaponType(e.type)&&(a=xself.bag.isOnehandEquipeGuide(t.WEAPON_LEFT_POS,t.WEAPON_RIGHT_POS)),Define.ITEM_TYPE_ARMOR_RING==e.type&&(a=xself.bag.isOnehandEquipeGuide(t.ARMOR_RING_LEFT_POS,t.ARMOR_RING_RIGHT_POS)),i=i&&!a,o=o&&!a,null==t.getCompareEquip(xself.bag,e.type)||i||o)n=e.isPetType()?e.getNameInfo()+" 已出战":e.getNameInfo()+" 已装备",WorldMessage.addTips(n),xself.checkPower()}},t.prototype.addNewItem=function(t){this._newItemList&&-1==this._newItemList.indexOf(t)&&this._newItemList.push(t)},t.prototype.getNewItemList=function(){return this._newItemList},t.prototype.clearNewItemList=function(){this._newItemList.length=0},t.prototype.checkIsNewItem=function(t){return!!(this._newItemList&&this._newItemList.length>0&&-1!=this._newItemList.indexOf(t))},t.prototype.checkIsStrongerItem=function(e){if(null==e)return!1;if(e.isEquipClass()){if(ItemData.isValidEquipRequire(xself,e)!=Define.OK)return!1;if(!ItemData.isFitJob(xself,e))return!1;var n=t.getCompareEquip(this,e.type);if(null==n)return!0;if(null!=ItemData.getBagGuideItem(n,e))return!0}return!1},t.prototype.expandPackageByTime=function(){var t=MsgHandler.createExpandPackage(1,this.bagEnd+1);nato.Network.sendCmd(t,this.expandPackage_serverbackFunc,this),PanelManager.openWaitForServer()},t.prototype.expandPackageByMoney=function(t){function e(){var t=MsgHandler.createExpandPackage(0,xself.bag.bagEnd+n);nato.Network.sendCmd(t,o.expandPackage_serverbackFunc,o),PanelManager.openWaitForServer()}var n=t-this.bagEnd,i=this.getOpenGridMoney(n),o=this,a="是否花费/c00ff00"+i+"/p金叶，开启/c00ff00"+n+"/p个格子";AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),a,(function(){Player.checkEnoughMoney(0,i,0,e,this)}),this)},t.prototype.expandPackage_serverbackFunc=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte()){var e=t.getString();AlertPanel.alertCommon(e)}else{var n=t.getInt(),i=t.getInt(),o=t.getInt(),a=t.getInt(),r=t.getLong().value,s=t.getInt(),l=t.getInt();xself.setPlayerMoneyValue(n,i,o),xself.bag.bagEnd=a,xself.bag.nextTime=r,xself.bag.countOfMoneyOpen=s,xself.bag.countOfTimeOpen=l,PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}},t.prototype.getOpenGridMoney=function(e){for(var n=0,i=0;e>i;i++){var o=this.countOfMoneyOpen+i;o>=t.gridMoneyCost.length&&(o=t.gridMoneyCost.length-1),n+=t.gridMoneyCost[o]}return n},t.prototype.calculateBagCount=function(){this.countOfVipOpen=this.bagEnd+1-t.EQUIP_POS_END-t.DEFAULT_OPEN_SIZE-this.countOfTimeOpen-this.countOfMoneyOpen,this.bagEnd_maxIndex=t.BAG_START+t.BAG_NUM*t.EACH_BAG_SIZE+this.countOfVipOpen-1},t.prototype.getRepaireItemCount=function(){for(var e=0,n=t.BAG_START;n<=this.bagEnd;n++){var i=this.store[n];null!=i&&i.isRepairItem()&&(e+=i.quantity)}return e},t.prototype.useRepaireItem=function(){for(var e=t.BAG_START;e<=this.bagEnd;e++){var n=this.store[e];if(null!=n&&n.isRepairItem())return void ItemManager.doItem(n)}AlertPanel.alertCommon("背包中没有找到野外修理卷")},t.ARMOR_NECKLACE_POS=0,t.PET_POS=1,t.ARMOR_RING_LEFT_POS=2,t.ARMOR_FASHION_POS=3,t.ARMOR_BACK_POS=4,t.ARMOR_CLOTHES_POS=5,t.ARMOR_HAND_POS=6,t.ARMOR_HEAD_POS=7,t.WEAPON_LEFT_POS=8,t.ARMOR_SHOES_POS=9,t.WEAPON_RIGHT_POS=10,t.ARMOR_WAIST_POS=11,t.ARMOR_TROUSERS_POS=12,t.ARMOR_SHOULDER_POS=13,t.ARMOR_AMULET_POS=14,t.ARMOR_TRANSPORT_POS=15,t.ARMOR_RING_RIGHT_POS=16,t.SPIRIT_POS=17,t.EQUIP_POS_START=0,t.EQUIP_POS_END=30,t.MAX_BAG_NUM=7,t.OPEN_BAG_NUM=7,t.BAG_NUM=4,t.EACH_BAG_SIZE=25,t.DEFAULT_OPEN_SIZE=60,t.OPEN_BAG_SIZE=t.EQUIP_POS_END+t.OPEN_BAG_NUM*t.EACH_BAG_SIZE,t.BAG_SIZE=t.EQUIP_POS_END+t.MAX_BAG_NUM*t.EACH_BAG_SIZE,t.BAG_START=t.EQUIP_POS_END,t.MAX_STORE_SIZE=60,t.STORE_START=t.BAG_SIZE,t.STORE_END=t.STORE_START+t.MAX_STORE_SIZE,t.MAX_VIPSTORE_SIZE=90,t.VIPSTORE_START=t.STORE_END,t.VIPSTORE_END=t.VIPSTORE_START+t.MAX_VIPSTORE_SIZE,t.TYPE_EQUIP_POS=1,t.TYPE_BAG_POS=2,t.TYPE_STORAGE_POS=3,t.TYPE_VIPSTORAGE_POS=4,t.DUR_CHANGE_TYPE_POINT=1,t.DUR_CHANGE_TYPE_PERCENT=2,t.DEAD_DUR_DOWN=10,t.DUR_DOWN_POINT=1,t.CLEAR_BAG_SELLING_STATUS=0,t.CLEAR_BAG_MAIL_SELECT=1,t.CLEAR_BAG_SHOP_LOCKED=2,t.CLEAR_BAG_INTEGRAL=3,t.gridMoneyCost=[25,50,100,150,150,200,200,200,250,250,300],t}();__reflect(PlayerBag.prototype,"PlayerBag");var PlayerDataManager=function(){function t(){}return Object.defineProperty(t,"playerData",{get:function(){return null==this._playerData&&(this._playerData=new PlayerData),this._playerData},enumerable:!0,configurable:!0}),t.clean=function(){this._isReqed=!1,this._playerData=null},t.savePlayerData=function(t,e){if(void 0===e&&(e=!0),null!=t){e&&(this._playerData=t);var n=xcacheurl+"save_data?id="+xself.getId()+"&value="+encodeURI(JSON.stringify(t)),i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(n,egret.HttpMethod.GET),i.addEventListener(egret.IOErrorEvent.IO_ERROR,(function(t){}),this),i.send()}},t.getDataBackCallback=function(){for(var e=0;e<this._callbackFuncList.length;e++){var n=this._callbackFuncList[e],i=this._callbackThisObjList[e];n.call(i,t.playerData)}this._callbackFuncList.length=0,this._callbackThisObjList.length=0},t.getPlayerData=function(e,n,i){if(void 0===i&&(i=!0),this._isReqed&&i)null!=e&&null!=n&&e.call(n,t.playerData);else if(null==this._callbackFuncList&&(this._callbackFuncList=[],this._callbackThisObjList=[]),this._callbackFuncList.push(e),this._callbackThisObjList.push(n),!this._isReqing){var o=xcacheurl+"apply_data?id="+xself.getId(),a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(o,egret.HttpMethod.GET),a.addEventListener(egret.Event.COMPLETE,(function(e){var n=null,i=e.currentTarget.response;0==Tool.isNullText(i)&&(i=decodeURI(i),n=JSON.parse(i),t._isReqed=!0),null==n&&(n=new PlayerData),t._playerData=n,t._isReqing=!1,t.getDataBackCallback()}),this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,(function(){t._isReqing=!1,t.getDataBackCallback()}),this),a.send(),this._isReqing=!0}},t.isIngoreMoney1Alert=function(){return!(!this.playerData||!this.playerData.isIngoreMoney2)},t._isReqed=!1,t._isReqing=!1,t}();__reflect(PlayerDataManager.prototype,"PlayerDataManager");var PlayerData=function(){this.msDate=0,this.curMsID=0,this.msList=[],this.isSpriteOpen=!1,this.isStrategyOpend=!1,this.isSkiiOpened=!1,this.isItemGetOpen=!1,this.isIngoreMoney2=!1,this.sellSetting=0,this.noticeDate=0};__reflect(PlayerData.prototype,"PlayerData");var PlayerTurnMonster=function(){function t(){this.pId=0,this.power1=0,this.powerValue1=0,this.power2=0,this.powerValue2=0,this.power3=0,this.powerValue3=0,this.icon=0,this.reqLevel=0,this.time=0}return t.doChangeTurnMonsterPush=function(e){if(null!=e){var n=xself;if(null!=n){if(0>e.getByte())return void AlertPanel.alertCommon(e.getString());if(e.getBoolean())t.setPlayerTurnMonsterInfo(e);else{if(n.playerTurnMonster=null,n.setIconpet1(0),PanelManager.closeSelectMenuPanel(),PanelManager.isPanelShow(RoleScene))PanelManager.getPanel(RoleScene).updateTab();PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}n.fromSkillData(e),n.updateAndRefreshIcon(),PanelManager.updateWorldIconPoint()}}},t.setPlayerTurnMonsterInfo=function(e){if(null!=e){var n=xself;if(null!=n){var i=new t;i.pId=e.getShort(),i.name=e.getString(),i.power1=e.getShort(),i.powerValue1=e.getShort(),i.power2=e.getShort(),i.powerValue2=e.getShort(),i.power3=e.getShort(),i.powerValue3=e.getShort(),i.icon=e.getShort(),i.time=e.getLong().value+Tool.currentTime;var o=e.getByte();if(i.skillDesc="",o>0)for(var a=0;o>a;a++){var r=e.getString(),s=e.getByte();i.skillDesc+=r+Tool.manageString(GameText.getText(GameText.TI_LEVEL),s+"")+"\n"}n.setIconpet1(i.icon),n.playerTurnMonster=i}}},t.doUseTurnMonsterCard=function(e){if(null!=e){var n=xself;if(null!=n){var i=n.bag;if(null!=i){var o=GameText2.STR_PLAYER_TURNMONSTER_ASK;null!=n.playerTurnMonster&&(o=n.playerTurnMonster.pId==e.powerValue1?GameText2.STR_PLAYER_TURNMONSTER_ASK_TIME:GameText2.STR_PLAYER_TURNMONSTER_ASK_CHA),o=Tool.manageString(o,PowerString.makeColorString(e.name,Define.getGradeColor(e.grade)));var a=function(o){PanelManager.closeWaitForServer();var a=o.getByte();if(0>a||1==a){if(AlertPanel.alertCommon(o.getString()),1==a){var r=o.getLong().value;null!=n.playerTurnMonster&&(n.playerTurnMonster.time=r+Tool.currentTime),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}}else a>=0&&i.removeBagItemByPos(e.slotPos,1),t.setPlayerTurnMonsterInfo(o),n.fromSkillData(o),n.updateAndRefreshIcon(),AlertPanel.alertCommon("变身成功"),PanelManager.updateWorldIconPoint(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),o,(function(){var t=new nato.Message(ProtocolDefine.CG_TURN_MONSTER_CARD);t.putInt(e.id),t.putShort(e.slotPos),nato.Network.sendCmd(t,a,this),PanelManager.openWaitForServer()}),this)}}}},t.doSeeTurnMonsterInfo=function(e){var n=xself;if(null!=n&&null!=n.playerTurnMonster){var i,o=[];i=new MenuActionData(GameText.getText(GameText.TI_BACK),1),o.push(i),i=new MenuActionData(GameText2.STR_PLAYER_TURNMONSTER_CANCEL,2),o.push(i);var a=Tool.manageStringList(GameText2.STR_PLAYER_TURNMONSTER_INFO,[n.playerTurnMonster.getPowerAddInfo(),"/cffcc00"+n.playerTurnMonster.skillDesc+"/p",n.playerTurnMonster.getLeftTime()]);0==Tool.isNullText(e)&&(a+="\n"+(e=Tool.manageString(GameText2.STR_PLAYER_COMMON_ATT,e))),PanelManager.openSelectMenuPanel(a,o,(function(e){1==e?PanelManager.closeSelectMenuPanel():2==e&&t.doCancelTurnMonsterCard()}),this)}},t.doCancelTurnMonsterCard=function(){AlertPanel.alert("变身取消","确定取消变身效果吗？",(function(){var t=new nato.Message(ProtocolDefine.CG_CHANGE_TURN_MONSTER);nato.Network.sendCmd(t)}),this)},t.prototype.getPowerValue=function(t){var e=0;return this.power1==t&&(e+=this.powerValue1),this.power2==t&&(e+=this.powerValue2),this.power3==t&&(e+=this.powerValue3),e},t.prototype.getPowerAddInfo=function(){var t="";if(0!=this.power1&&0!=this.powerValue1){var e=Define.getPowerDesc(this.power1,this.powerValue1);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)+"  "}if(0!=this.power2&&0!=this.powerValue2){e=Define.getPowerDesc(this.power2,this.powerValue2);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)+"  "}if(0!=this.power3&&0!=this.powerValue3){e=Define.getPowerDesc(this.power3,this.powerValue3);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)}return t},t.prototype.getLeftTime=function(){var t="",e=this.time-Tool.currentTime;if(e>0){var n=Math.floor(e/Tool.MILLIS_IN_DAY);n>0&&(t+=Tool.manageString(GameText.STR_DAY,n+""));var i=Math.floor((e-n*Tool.MILLIS_IN_DAY)/Tool.MILLIS_IN_HOUR);i>0&&(t+=Tool.manageString(GameText.STR_HOUR,i+""));var o=Math.floor((e-n*Tool.MILLIS_IN_DAY-i*Tool.MILLIS_IN_HOUR)/Tool.MILLIS_IN_MINUTE);Math.floor((e-n*Tool.MILLIS_IN_DAY-i*Tool.MILLIS_IN_HOUR-o*Tool.MILLIS_IN_MINUTE)/Tool.MILLIS_IN_SECOND)>0&&(o+=1),o>0&&(t+=Tool.manageString(GameText.STR_MINUTE,o+"")),t="/c00ff00"+t+"/p"}else t="/cff0000已过期/p";return t},t}();__reflect(PlayerTurnMonster.prototype,"PlayerTurnMonster");var Raiders=function(){function t(){}return t.doPetRaidersGetData=function(){function e(){PanelManager.openPetRaidersPanel(PetRaidersPanel.Type_Pet,t.petVectorList)}if(null==t.petVectorList||0==t.petVectorList.length){var n=new nato.Message(ProtocolDefine.CG_SYSTEM_GET_PET_RAIDERS);n.putShort(80),n.putInt(1),n.putByte(-1),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getInt())AlertPanel.alertCommon(n.getString());else{for(var i=n.getByte(),o=[],a=0;i>a;a++){var r=new t;r.pet=MyPet.fromBytesInfo(n,null),r.pet.petraidersinfo=n.getString(),o.push(r)}t.petVectorList=o,e()}}),this),PanelManager.openWaitForServer()}else e()},t.petjobSortIDTable=[-1,Define.JOB_PET_WIL,Define.JOB_PET_STR,Define.JOB_PET_AGI],t}();__reflect(Raiders.prototype,"Raiders");var SafeLock=function(){function t(){this.selectindex=-1,this.focusindex=-1,this.resettype=-1}return t.isSafeLockSet=function(){return GameWorld.isLoginSetting(GameWorld.IS_LOCK_SET)},t.doEnterQQSafeLockSeting=function(t){},t.doCreateQQSafeLockQuestionMenu=function(t){},t.doQQSafeLockQuestionAnswer=function(t){},t.doQQSafeLockResetGetQustion=function(t){},t.doQQSafeLockResetQuestionAnswer=function(t){},t.createSafeLockChooiceMenu=function(){var e,n=[];e=new MenuActionData(GameText.getText(GameText.TI_BACK),-1),n.push(e),1==t.isSafeLockSet()?(e=new MenuActionData(GameText.getText(GameText.TI_SOFELOCK_ALTER),this.EVENT_SAFELOCK_CHOICE_ALTER),n.push(e),e=new MenuActionData(GameText.getText(GameText.TI_SOFELOCK_REMOVE),this.EVENT_SAFELOCK_CHOICE_REMOVE),n.push(e),e=new MenuActionData(GameText.getText(GameText.TI_SOFELOCK_RESET),this.EVENT_SAFELOCK_CHOICE_RESET),n.push(e)):(e=new MenuActionData(GameText.getText(GameText.TI_SOFELOCK_SET),this.EVENT_SAFELOCK_CHOICE_SET),n.push(e)),PanelManager.openFilterMenuPanel(n,this.handlerLockMenuAction,this)},t.handlerLockMenuAction=function(e){switch(PanelManager.closeFilterMenuPanel(),e){case t.EVENT_SAFELOCK_CHOICE_SET:PanelManager.openSafeLockPanel(SafeLockPanel.Type_set,(function(e){t.doSafeLockSetting(e)}),this);break;case t.EVENT_SAFELOCK_CHOICE_ALTER:PanelManager.openSafeLockPanel(SafeLockPanel.Type_modify,(function(e,n){t.doSafeLockModify(e,n)}),this);break;case t.EVENT_SAFELOCK_CHOICE_REMOVE:PanelManager.openSafeLockPanel(SafeLockPanel.Type_remove,(function(e){t.doSafeLockRemove(e)}),this);break;case t.EVENT_SAFELOCK_CHOICE_RESET:t.doSafeLockReset();break;case t.EVENT_SAFELOCK_CHOICE_SET_QQ:t.doEnterQQSafeLockSeting(this.SAFELOCK_RESET_PWD);break;case t.EVENT_SAFELOCK_CHOICE_RESET_QQ:t.doQQSafeLockResetGetQustion(this.SAFELOCK_RESET_QUESTION)}},t.doSafeLockSetting=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_PROTECT_LOCK_SET);e.putString(t),nato.Network.sendCmd(e,(function(e){return PanelManager.closeWaitForServer(),0>e.getByte()?void AlertPanel.alertCommon(e.getString()):(GameWorld.setLoginSetting(!0,GameWorld.IS_LOCK_SET),GameWorld.setLoginSetting(!0,GameWorld.IS_LOCK_OPEN),AlertPanel.alertCommon(Tool.manageString(GameText.STR_REMEMBER_SAFE_LOCK_PWD,t)),void PanelManager.closeScene())}),this),PanelManager.openWaitForServer()},t.doSafeLockModify=function(t,e){var n=new nato.Message(ProtocolDefine.CG_ACTOR_PROTECT_LOCK_MODIFY);n.putString(t),n.putString(e),nato.Network.sendCmd(n,(function(t){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(t)||(GameWorld.setLoginSetting(!0,GameWorld.IS_LOCK_OPEN),AlertPanel.alertCommon(Tool.manageString(GameText.STR_REMEMBER_SAFE_LOCK_PWD,e)),PanelManager.closeScene())}),this),PanelManager.openWaitForServer()},t.doSafeLockRemove=function(e){var n=new nato.Message(ProtocolDefine.CG_ACTOR_PROTECT_LOCK_CHANCLE);n.putString(e),nato.Network.sendCmd(n,(function(e){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(e)||(GameWorld.setLoginSetting(!1,GameWorld.IS_LOCK_OPEN),AlertPanel.alertCommon(GameText.STR_SAFE_LOCK_REMOVE_SUCCESS),PanelManager.closeScene(),null!=t._successCallbackFucn&&null!=t._successThisObj&&(t._successCallbackFucn.apply(t._successThisObj,t._successParams),t._successCallbackFucn,t._successThisObj=null,t._successParams=null))}),this),PanelManager.openWaitForServer()},t.doSafeLockReset=function(){var t=new nato.Message(ProtocolDefine.CG_ACTOR_PROTECT_LOCK_RESET);nato.Network.sendCmd(t,(function(t){PanelManager.closeWaitForServer();var e=t.getString();AlertPanel.alertCommon(e)}),this),PanelManager.openWaitForServer()},t.doSafeLockVerify=function(e,n,i){return 0==this.isSafeLockSet()||(!GameWorld.isLoginSetting(GameWorld.IS_LOCK_OPEN)||(e&&(t._successCallbackFucn=e,t._successThisObj=n,t._successParams=i),this.handlerLockMenuAction(this.EVENT_SAFELOCK_CHOICE_REMOVE),!1))},t.doSafeLockSuccessCallback=function(t,e){this._successCallbackFucn=t,this._successThisObj=e},t.EVENT_SAFELOCK_CHOICE_SET=1,t.EVENT_SAFELOCK_CHOICE_ALTER=2,t.EVENT_SAFELOCK_CHOICE_REMOVE=3,t.EVENT_SAFELOCK_CHOICE_RESET=4,t.EVENT_SAFELOCK_CHOICE_SET_QQ=5,t.EVENT_SAFELOCK_CHOICE_RESET_QQ=6,t.SAFELOCK_RESET_PWD=0,t.SAFELOCK_RESET_QUESTION=1,t._successCallbackFucn=null,t._successThisObj=null,t._successParams=null,t}();__reflect(SafeLock.prototype,"SafeLock");var Skill=function(){function t(){this.maxLevel=0,this.id=0,this.level=0,this.addLevel=0,this.type=0,this.sp=0,this.money1=0,this.money2=0,this.money3=0,this.reqJob=0,this.reqLevel=0,this.anime1=0,this.anime2=0,this.anime3=0,this.skillWeapon=0,this.skillAtkType=0,this.atk_time=0,this.area=0,this.position=0,this.useMP=0,this.useHP=0,this.round=0,this.power1=0,this.powerValue1=0,this.statusBit1=0,this.power2=0,this.powerValue2=0,this.statusBit2=0,this.power3=0,this.powerValue3=0,this.statusBit3=0,this.formationtype=0,this.skillId=0,this.iconIndex=0,this.teamcount=0,this.isDefault=!1,this.maxLearnLevel=0}return t.getDelSkillMoneyStr=function(){var e=t.DELETE_SKILL_MONEY[1];return 0>=e?"":PowerString.makeColorString(Tool.manageString(GameText.STR_CONDITION_NEED,GameText.getMoneyText(t.DELETE_SKILL_MONEY[0])+e),ColorUtils.COLOR_RED)},t.prototype.getRealLevelInfo=function(){return this.addLevel>0?Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.level-this.addLevel+"+"+this.addLevel):Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.level+"")},t.prototype.getPowerValue=function(t){var e=0;return this.power1==t&&(e+=this.powerValue1),this.power2==t&&(e+=this.powerValue2),this.power3==t&&(e+=this.powerValue3),e},t.prototype.isRebornSkill=function(){return this.power1==Define.POWER_RECOVER||this.power1==Define.POWER_RECOVER_PERCENT||(this.power2==Define.POWER_RECOVER||this.power2==Define.POWER_RECOVER_PERCENT||(this.power3==Define.POWER_RECOVER||this.power3==Define.POWER_RECOVER_PERCENT))},t.prototype.isEnoughHP=function(t){return this.useHP<=0||null!=t&&t.get(ModelConst.HP)>=this.useHP+1},t.prototype.getName=function(){return PowerString.makeColorString(this.name,ColorUtils.COLOR_YELLOW)+" ("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.level+"")+")"},t.prototype.getDesc=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=null);var i=new StringBuffer,o="";if(e&&(o="",this.money1>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY1)+this.money1,ColorUtils.COLOR_YELLOW)),this.money2>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY2)+this.money2,ColorUtils.COLOR_MONEY2)),this.money3>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY3)+this.money3,ColorUtils.COLOR_MONEY3)),0==Tool.isNullText(o)&&i.append(Tool.manageString(GameText.STR_SKILL_GETD_DESC_COST,o+"\n")),this.sp>0&&(o=n&&n.sp>=this.sp?PowerString.makeColorString(this.sp+"",ColorUtils.COLOR_WHITE):PowerString.makeColorString(this.sp+"",ColorUtils.COLOR_RED),i.append(Tool.manageString(GameText.STR_SKILL_GETD_DESC_NEED_SP,o))),this.reqLevel>0&&null!=n&&n.getLevel()<this.reqLevel&&(o=PowerString.makeColorString("需求:等级"+this.reqLevel+"级",ColorUtils.COLOR_RED),i.append(o+"\n")),i.append("\n")),null!=name&&(i.append(this.getName()),i.append("    "+Define.getSkillTypeString(this.type)),i.append("\n")),this.type!=Define.SKILL_TYPE_PASSIVE&&(i.append(Define.getSkillAreaString(this.area)),i.append("    "+Define.getAtkTypeString(this.skillAtkType)+"\n")),0!=this.power1)if(0!=this.powerValue1){var a=Define.getPowerDesc(this.power1,this.powerValue1);0!=this.statusBit1&&(a+=","+Define.getBufferString(this.statusBit1)),i.append(PowerString.makeColorString(a+"\n",ColorUtils.COLOR_GREEN))}else 0!=this.statusBit1&&i.append(PowerString.makeColorString(Define.getBufferString(this.statusBit1)+"\n",ColorUtils.COLOR_GREEN));if(0!=this.power2)if(0!=this.powerValue2){a=Define.getPowerDesc(this.power2,this.powerValue2);0!=this.statusBit2&&(a+=","+Define.getBufferString(this.statusBit2)),i.append(PowerString.makeColorString(a+"\n",ColorUtils.COLOR_GREEN))}else 0!=this.statusBit2&&i.append(PowerString.makeColorString(Define.getBufferString(this.statusBit2)+"\n",ColorUtils.COLOR_GREEN));if(0!=this.power3)if(0!=this.powerValue3){a=Define.getPowerDesc(this.power3,this.powerValue3);0!=this.statusBit3&&(a+=","+Define.getBufferString(this.statusBit3)),i.append(PowerString.makeColorString(a+"\n",ColorUtils.COLOR_GREEN))}else 0!=this.statusBit3&&i.append(PowerString.makeColorString(Define.getBufferString(this.statusBit3)+"\n",ColorUtils.COLOR_GREEN));if(this.round>0&&i.append(Tool.manageString(GameText.STR_ITEM_GET_LAST_ROUND,this.round+"")+"\n"),0!=this.atk_time){var r=this.atk_time>0?"+":"";i.append(Tool.manageString(GameText.STR_ITEM_COM_ATK_TIME,r+this.atk_time)+"\n")}o="",0!=this.useMP&&(o+=" "+Tool.manageString(GameText.STR_SKILL_GETD_DESC_USE_MP,this.useMP+"")),0!=this.useHP&&(o+=" "+Tool.manageString(GameText.STR_SKILL_GETD_DESC_USE_HP,this.useHP+"")),0==Tool.isNullText(o)&&i.append(Tool.manageString(GameText.STR_SKILL_GETD_DESC_EXPEND,o)+"\n"),this.skillWeapon>0&&(o=Tool.manageString(GameText.STR_SKILL_GETD_DESC_WEAPON,Define.getSkillWeaponString(this.skillWeapon)),0==t.isValidSkillWeapon(xself.get(ModelConst.LEFT_WEAPON_TYPE),xself.get(ModelConst.RIGHT_WEAPON_TYPE),this)?i.append(PowerString.makeColorString(o,ColorUtils.COLOR_RED)+"\n"):i.append(o+"\n")),0==Tool.isNullText(this.info)&&i.append(this.info+"\n");var s=i.toString();return Tool.convertLastLinefeed(s)},t.isCanUse=function(e,n,i){if(null==e||null==n)return!1;if(e.get(ModelConst.MP)<n.useMP)return null!=i&&i.append(GameText.STR_SKILL_LACK_MP),!1;if(0==n.isEnoughHP(e))return null!=i&&i.append(GameText.STR_SKILL_LACK_HP),!1;if(3==e.getType()){var o=e.get(ModelConst.LEFT_WEAPON_TYPE),a=e.get(ModelConst.RIGHT_WEAPON_TYPE);if(n.type==Define.SKILL_TYPE_ACTIVE&&(o==Define.BACK_ERROR_DUR&&a==Define.BACK_ERROR_DUR||o==Define.BACK_ERROR_DUR&&-1==a||-1==o&&a==Define.BACK_ERROR_DUR))return null!=i&&i.append(GameText.STR_SKILL_WEAPON_DESTROY),!1;if(0==t.isValidSkillWeapon(o,a,n))return null!=i&&i.append(GameText.STR_SKILL_WEAPON_DISCREPANCIES),!1}return!0},t.prototype.isAddSkill=function(){return!(this.addLevel<=0)&&!(this.level-this.addLevel>0)},t.prototype.getSkillTypeIcon=function(){var t=11;switch(this.skillWeapon){case Define.SKILL_WEAPON_NONE:case Define.SKILL_WEAPON_MELEE_1:t=11;break;case Define.SKILL_WEAPON_MELEE_2:t=14;break;case Define.SKILL_WEAPON_MELEE_3:t=5;break;case Define.SKILL_WEAPON_RANGE:t=3;break;case Define.SKILL_WEAPON_ONE_HAND:t=10;break;case Define.SKILL_WEAPON_ONE_SWORD:t=15;break;case Define.SKILL_WEAPON_TWO_SWORD:t=7;break;case Define.SKILL_WEAPON_HEAVY_SWORD:t=6;break;case Define.SKILL_WEAPON_ONE_BLADE:t=12;break;case Define.SKILL_WEAPON_TWO_BLADE:t=13;break;case Define.SKILL_WEAPON_HEAVY_BLADE:t=12;break;case Define.SKILL_WEAPON_ONE_HEAVY:t=5;break;case Define.SKILL_WEAPON_LANCE:t=1;break;case Define.SKILL_WEAPON_ONE_CROSSBOW:t=4;break;case Define.SKILL_WEAPON_TOW_CROSSBOW:t=3;break;case Define.SKILL_WEAPON_HEAVY_CROSSBOW:t=4;break;case Define.SKILL_WEAPON_BOW:t=2;break;case Define.SKILL_WEAPON_HAND:t=10;break;case Define.SKILL_WEAPON_CANE:t=9;break;case Define.SKILL_WEAPON_BALL:t=8;break;case Define.SKILL_WEAPON_SWORD:t=6;break;case Define.SKILL_WEAPON_ONE_HAND_BLADE:t=14;break;case Define.SKILL_WEAPON_GUN:case Define.SKILL_WEAPON_TWO_GUN:t=16;break;case Define.SKILL_WEAPON_HEAVY_GUN:t=17}return"skill_type_"+t+(xhd?"_hd":"_sd")},t.isValidSkillWeapon=function(t,e,n){switch(n.skillWeapon){case Define.SKILL_WEAPON_NONE:return!0;case Define.SKILL_WEAPON_MELEE_1:if(Define.isNullHand(t,e)||Define.isValidSword(t,e)||Define.isValidBlade(t,e)||Define.isValidHeavy(t,e)||Define.isValidLance(t,e))return!0;break;case Define.SKILL_WEAPON_MELEE_2:if(Define.isValidOneSword(t,e)||Define.isValidOneBlade(t,e))return!0;break;case Define.SKILL_WEAPON_MELEE_3:if(Define.isValidTwoSword(t,e)||Define.isValidTwoBlade(t,e)||Define.isValidTwoHeavy(t,e)||Define.isValidLance(t,e))return!0;break;case Define.SKILL_WEAPON_RANGE:if(Define.isValidCrossrow(t,e)||Define.isValidBow(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_HAND:if(Define.isOneHandWeapon(t,e)||Define.isNullHand(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_SWORD:if(Define.isOneHandWeapon(t,e)&&Define.isValidOneSword(t,e))return!0;break;case Define.SKILL_WEAPON_TWO_SWORD:if(t==Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD&&e==Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD)return!0;break;case Define.SKILL_WEAPON_HEAVY_SWORD:if(Define.isValidTwoSword(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_BLADE:if(Define.isValidBlade(t,e))return!0;break;case Define.SKILL_WEAPON_TWO_BLADE:if(t==Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE&&e==Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE)return!0;break;case Define.SKILL_WEAPON_HEAVY_BLADE:if(Define.isValidTwoBlade(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_HEAVY:if(Define.isValidTwoHeavy(t,e))return!0;break;case Define.SKILL_WEAPON_LANCE:if(Define.isValidLance(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_CROSSBOW:if(Define.isValidCrossrow(t,e))return!0;break;case Define.SKILL_WEAPON_TOW_CROSSBOW:if(t==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW&&e==Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW)return!0;break;case Define.SKILL_WEAPON_HEAVY_CROSSBOW:if(Define.isValidTwoCrossrow(t,e))return!0;break;case Define.SKILL_WEAPON_BOW:if(Define.isValidBow(t,e))return!0;break;case Define.SKILL_WEAPON_HAND:if(Define.isNullHand(t,e))return!0;break;case Define.SKILL_WEAPON_CANE:if(Define.isValidStaff(t,e))return!0;break;case Define.SKILL_WEAPON_BALL:if(Define.isValidBall(t,e))return!0;break;case Define.SKILL_WEAPON_SWORD:if(Define.isValidSword(t,e))return!0;break;case Define.SKILL_WEAPON_ONE_HAND_BLADE:if(Define.isOneHandWeapon(t,e)&&Define.isValidOneBlade(t,e))return!0;break;case Define.SKILL_WEAPON_GUN:if(Define.isValidGun(t,e))return!0;break;case Define.SKILL_WEAPON_TWO_GUN:if(t==Define.ITEM_TYPE_WEAPON_ONEHAND_GUN&&e==Define.ITEM_TYPE_WEAPON_ONEHAND_GUN)return!0;break;case Define.SKILL_WEAPON_HEAVY_GUN:if(Define.isValidTwoGun(t,e))return!0}return!1},t.fromBytes=function(e){var n=new t;return t.fromBaseBytes(e,n),n},t.fromBaseBytes=function(t,e){return e.id=65535&t.getShort(),e.level=t.getByte(),e.name=t.getString(),e.type=t.getByte(),e.info=t.getString(),e.skillWeapon=t.getByte(),e.power1=t.getUnsignedByte(),e.powerValue1=t.getShort(),e.power2=t.getUnsignedByte(),e.powerValue2=t.getShort(),e.power3=t.getUnsignedByte(),e.powerValue3=t.getShort(),e.type!=Define.SKILL_TYPE_PASSIVE&&(e.skillAtkType=t.getByte(),e.area=t.getByte(),e.round=t.getByte(),e.atk_time=t.getByte(),e.useMP=65535&t.getShort(),e.useHP=65535&t.getShort(),e.anime1=t.getByte(),e.anime2=t.getShort(),e.anime3=t.getShort(),e.position=t.getByte(),e.statusBit1=t.getByte(),e.statusBit2=t.getByte(),e.statusBit3=t.getByte()),e.isLearnByBook=t.getBoolean(),e},t.fromShopBytes=function(e){var n=new t;return this.fromBaseBytes(e,n),this.fromShopBytesParse(e,n),n},t.fromShopBytesParse=function(t,e){return e.sp=65535&t.getShort(),e.money1=65535&t.getShort(),e.money2=65535&t.getShort(),e.money3=t.getInt(),e.reqJob=t.getByte(),e.reqLevel=t.getByte(),e},t.doSetAutoSkill=function(e,n){if(null==e||null==n)return!1;var i=e.isAutoSkill(n.id)<0,o=MsgHandler.createAutoSkillMsg(e,n.id,i);return PanelManager.openWaitForServer(),nato.Network.sendCmd(o,(function(o){return PanelManager.closeWaitForServer(),0>o.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString()):(i?e.setAutoSkillActive(n.id):e.setAutoSkillInvalid(n.id),void t.updateSkillUI())}),this),!0},t.updateSkillUI=function(){var t=PanelManager.getPanel(RoleScene,!1),e=PanelManager.getPanel(PetDetailScene,!1);t&&t.stage&&t.skillPanel.stage&&t.skillPanel.update(),e&&e.stage&&e.skillPanel.stage&&e.skillPanel.update(e.skillPanel.getPet())},t.doPlayerSetSkillInitiative=function(t,e){if(null==t||null==e)return!1;var n=new nato.Message(ProtocolDefine.CG_SKILL_INITIATIVE_SET),i=Define.SKILL_TYPE_PLAYER;return t&&4==t.getType()&&(i=Define.SKILL_TYPE_PET),n.putByte(i),n.putInt(e.id),nato.Network.sendCmd(n,(function(n){0>n.getByte()||(t.autoSkillID_Initiative=e.id,AlertPanel.alertCommon(Tool.manageString(GameText.STR_SKILL_INITIATIVE_SUCCESS,e.name)))}),this),!0},t.doPlayerCancelSkillInitiative=function(t,e){if(null==t||null==e)return!1;var n=new nato.Message(ProtocolDefine.CG_SKILL_INITIATIVE_CLEAN),i=Define.SKILL_TYPE_PLAYER;return t&&4==t.getType()&&(i=Define.SKILL_TYPE_PET),n.putByte(i),nato.Network.sendCmd(n,(function(e){0>e.getByte()||(t.autoSkillID_Initiative=-1,AlertPanel.alertCommon(GameText.STR_SKILL_INITIATIVE_FAIL))}),this),!0},t.updatePlayerSkill=function(t){if(null!=t){var e=xself;if(null!=e){e.skillList=MsgHandler.processDataPlayerSkillMsg(t,!0);var n=t.getByte();e.autoSkillID=new Array(n);for(var i=0;n>i;i++)e.autoSkillID[i]=t.getShort();e.autoSkillID_Initiative=t.getShort()}}},t.doGetFormation=function(e){var n=null,i=e.getByte();i>0&&(n=[]);for(var o=0;i>o;o++){var a=t.fromByteFormationSkill(e);a&&n.push(a)}return n},t.fromByteFormationSkill=function(e){var n=new t;return n.formationtype=e.getByte(),n.id=e.getInt(),n.skillId=e.getByte(),n.level=e.getByte(),n.name=e.getString(),n.iconIndex=e.getByte(),n.power1=e.getShort(),n.powerValue1=e.getShort(),n.power2=e.getShort(),n.powerValue2=e.getShort(),n.power3=e.getShort(),n.powerValue3=e.getShort(),n.teamcount=e.getByte(),n.isDefault=e.getBoolean(),n.type=Define.SKILL_TYPE_FORMATION,n},t.doDropSkill=function(e,n){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e||null==n)return!1;var i=function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){var i=n.getInt(),o=n.getInt(),a=n.getInt(),r=n.getInt(),s=n.getInt(),l=e.getSkillByID(i);if(null!=l){if(1==n.getBoolean()){var _=t.fromBytes(n);_.addLevel=n.getByte(),_.id!=l.id&&WorldMessage.addPromptMsg("Skill.doDropSkill() 技能id不一致，"+_.id+"->"+l.id),e.learnSkill(_)}else e.removeSkill(l);e.sp=o,e.checkHPMP(),xself&&xself.setPlayerMoney(a,r,s,null);var h=PanelManager.getPanel(RoleScene,!1),u=PanelManager.getPanel(PetDetailScene,!1);h&&h.stage&&h.skillPanel.stage&&h.skillPanel.update(),u&&u.stage&&u.skillPanel.stage&&u.skillPanel.update(u.skillPanel.getPet()),PanelManager.closeSelectMenuPanel()}}},o=function(){var t=Define.SKILL_TYPE_PLAYER;4==e.getType()&&(t=Define.SKILL_TYPE_PET);var o=MsgHandler.createDropSkill(n.id,t);nato.Network.sendCmd(o,i,this),PanelManager.openWaitForServer()},a=this.getDelSkillMoneyStr();return AlertPanel.alert(GameText.getText(GameText.TI_UN_SKILL),Tool.manageStringList(GameText.STR_SKILL_DROP_ASK,[n.name,"\n"+a+"\n"+n.getDesc(!1)]),(function(){var e=GameWorld.getMoneyArrayValue(t.DELETE_SKILL_MONEY,Tool.MAX_VALUE_int);Model.checkEnoughMoney(e[0],e[1],e[2],o,this)}),this),!0},t.doDropSkillOneLevel=function(e,n,i,o){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e||null==n)return!1;var a=function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){var a=n.getInt(),r=n.getInt(),s=n.getInt(),l=n.getInt(),_=n.getInt(),h=e.getSkillByID(a);if(null!=h){if(1==n.getBoolean()){var u=t.fromBytes(n);u.addLevel=n.getByte(),u.id!=h.id&&WorldMessage.addPromptMsg("Skill.doDropSkill() 技能id不一致，"+u.id+"->"+h.id),e.learnSkill(u)}else e.removeSkill(h);e.sp=r,e.checkHPMP(),xself&&xself.setPlayerMoney(s,l,_,null);var c=PanelManager.getPanel(RoleScene,!1),T=PanelManager.getPanel(PetDetailScene,!1);c&&c.stage&&c.skillPanel.stage&&c.skillPanel.update(),T&&T.stage&&T.skillPanel.stage&&T.skillPanel.update(T.skillPanel.getPet()),null!=i&&null!=o&&i.call(o)}}},r=function(){var t=Define.SKILL_TYPE_PLAYER;4==e.getType()&&(t=Define.SKILL_TYPE_PET);var i=MsgHandler.createDropSkillOneLevel(n.id,t);nato.Network.sendCmd(i,a,this),PanelManager.openWaitForServer()},s=this.getDelSkillMoneyStr();return AlertPanel.alert(GameText.getText(GameText.TI_UN_SKILL),Tool.manageStringList(GameText.STR_PLAYER_DROP_SKILL_ONE_ASK,[n.name,"\n"+s+"\n"+n.getDesc(!1)]),(function(){var e=GameWorld.getMoneyArrayValue(t.DELETE_SKILL_MONEY,Tool.MAX_VALUE_int);Model.checkEnoughMoney(e[0],e[1],e[2],r,this)}),this),!0},t.doUseLearnSkillItem=function(e,n,i,o){var a=xself;if(null!=a){var r=a.bag;if(null!=r&&0!=SafeLock.doSafeLockVerify()&&null!=e){var s=new nato.Message(ProtocolDefine.CG_SKILL_SCROLL_LEARN);s.putShort(e.slotPos);var l=-1;if(n){if(null==i||null==o)return void AlertPanel.alertCommon(GameText.STR_PET_ENTER_DETAIL_USE);l=o.slotPos}s.putShort(l),nato.Network.sendCmd(s,(function(o){function s(e){if(!MsgHandler.isMessageHaveError(e)){var o=e.getInt(),s=t.fromBytes(e),l=0;if(1==e.getBoolean()&&(s.addLevel=e.getByte(),l=s.addLevel),null!=s){n?(i.learnSkill(s),i.sp=o,i.checkHPMP()):(a.learnSkill(s),a.sp=o,a.checkHPMP());var _=e.getByte(),h=e.getShort();_>0&&r.removeBagItemByPos(h,_),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel();var u="";l>0&&(u=PowerString.makeColorString(s.name+"("+(s.level-l)+"+"+l+")",ColorUtils.COLOR_GREEN)+"\n");var c=new StringBuffer;c.append(u),c.append(s.getDesc(!1)),AlertPanel.alertNotify("学习成功",c.toString())}}}if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){var _=new StringBuffer,h=(o.getInt(),o.getByte(),o.getInt()),u=o.getShort(),c=o.getByte(),T=null;o.getByte()>0&&(T=t.fromBytes(o));var p=GameText.getText(GameText.TI_YOU);n&&(p=GameText.getText(GameText.TI_PET_INFO)),1==c?_.append(Tool.manageStringList(GameText.STR_USE_LEARN_SKILL_ITEM_NEW,[p,null!=T?T.getName():"",h+""])):_.append(Tool.manageStringList(GameText.STR_USE_LEARN_SKILL_ITEM_ADD,[p,null!=T?T.name:"",c+"",h+""])),_.append("\n"),null!=T&&_.append(T.getDesc(!1)),AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),_.toString(),(function(){var t=new nato.Message(ProtocolDefine.CG_SKILL_SCROLL_LEARN_ASK);t.putInt(u),t.putByte(c),t.putBoolean(!0),t.putShort(e.slotPos),t.putShort(l),nato.Network.sendCmd(t,s,this)}),this)}}),this),PanelManager.openWaitForServer()}}},t.doUsePetSealItemLearnSkill=function(e,n,i,o){if(null!=xself&&null!=xself.bag){var a=xself.bag;if(0!=SafeLock.doSafeLockVerify()&&null!=e){var r=new nato.Message(ProtocolDefine.CG_SKILL_BOOK_LEARN);r.putShort(e.slotPos);var s=-1;if(n){if(null==i||null==o)return void AlertPanel.alertCommon(GameText.STR_PET_ENTER_DETAIL_USE);s=o.slotPos}r.putShort(s),nato.Network.sendCmd(r,(function(o){function r(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){var o=e.getInt(),r=t.fromBytes(e),s=0;if(1==e.getBoolean()&&(r.addLevel=e.getByte(),s=r.addLevel),null!=r){n?(i.learnSkill(r),i.sp=o,i.checkHPMP()):(xself.learnSkill(r),xself.sp=o,xself.checkHPMP());var l=e.getByte(),_=e.getShort();l>0&&a.removeBagItemByPos(_,l);var h="";s>0&&(h=PowerString.makeColorString(r.name+"("+(r.level-s)+"+"+s+")",ColorUtils.COLOR_GREEN)+"\n"),AlertPanel.alertNotify("学习成功",h+r.getDesc(!1)),PanelManager.isPanelShow(DrugPanel)&&(PanelManager.getPanel(DrugPanel).update(),PanelManager.getPanel(DrugPanel).checkClose())}}}if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){var l=new StringBuffer,_=(o.getInt(),o.getByte(),o.getInt()),h=o.getShort(),u=o.getByte(),c=null;o.getByte()>0&&(c=t.fromBytes(o));var T=GameText.getText(GameText.TI_YOU);n&&(T=GameText.getText(GameText.TI_PET_INFO)),1==u?l.append(Tool.manageStringList(GameText.STR_USE_LEARN_SKILL_ITEM_NEW,[T,null!=c?c.getName():"",_+""])):l.append(Tool.manageStringList(GameText.STR_USE_LEARN_SKILL_ITEM_ADD,[T,null!=c?c.name:"",u+"",_+""])),null!=c&&l.append("\n"+c.getDesc(!1)),AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),l.toString(),(function(){var t=new nato.Message(ProtocolDefine.CG_SKILL_BOOK_LEARN_ASK);t.putInt(h),t.putByte(u),t.putBoolean(!0),t.putShort(e.slotPos),t.putShort(s),nato.Network.sendCmd(t,r,this),PanelManager.openWaitForServer()}),this)}}),this),PanelManager.openWaitForServer()}}},t.doUseFormationBookItem=function(e,n,i){if(void 0===n&&(n=null),void 0===i&&(i=null),null!=e){var o=xself;if(null!=o&&null!=o.bag){var a=o.bag;if(0!=SafeLock.doSafeLockVerify()){var r=new nato.Message(ProtocolDefine.CG_FORMATION_LEARN);r.putShort(e.slotPos),r.putInt(e.id),nato.Network.sendCmd(r,(function(n){var i=n.getByte();if(0>i)AlertPanel.alertCommon(n.getString());else{a.removeBagItemByPos(e.slotPos,1);var r=t.fromByteFormationSkill(n);null==o.formationList&&(o.formationList=[]);for(var s=!1,l=0;l<o.formationList.length;l++){var _=o.formationList[l];if(null!=_&&i==_.formationtype){s=!0,o.formationList[l]=r;break}}0==s&&o.formationList.push(r),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),AlertPanel.alertCommon(GameText2.STR_LEARN_FORMATION_SUCCESS)}}),this)}}}},t.doSetDefaultFormation=function(e){if(null!=xself&&null!=e){var n=e.skillId;e.isDefault&&(n=0);var i=new nato.Message(ProtocolDefine.CG_FORMATION_CHANGE_DEFAULT);i.putByte(n),nato.Network.sendCmd(i,(function(e){0>e.getByte()?AlertPanel.alertCommon(e.getString()):(xself.formationList=t.doGetFormation(e),AlertPanel.alertCommon("设置成功！"),PanelManager.isPanelShow(RoleScene)&&PanelManager.getPanel(RoleScene).updateTab())}),this)}},t.doForGetFormation=function(e){function n(e){0>e.getByte()?AlertPanel.alertCommon(e.getString()):(xself.formationList=t.doGetFormation(e),AlertPanel.alertCommon(GameText2.STR_FORGET_FORMATION_SUCCESS),PanelManager.closeSelectMenuPanel(),PanelManager.isPanelShow(RoleScene)&&PanelManager.getPanel(RoleScene).updateTab())}if(null!=xself&&null!=e&&0!=SafeLock.doSafeLockVerify()){var i=Tool.manageString(GameText2.STR_FORGET_FORMATION_ASK,e.name)+"\n\n"+e.getFormationInfo();AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),i,(function(){var t=e.skillId,i=new nato.Message(ProtocolDefine.CG_FORMATION_FORGET);i.putByte(t),nato.Network.sendCmd(i,n,this)}),this)}},t.doUpdateFormation=function(e){if(null!=e){var n=xself;if(null!=n){var i=n.getPet();e.getBoolean()?(n.formationSkill=t.fromByteFormationSkill(e),null!=i&&(i.formationSkill=n.formationSkill)):(n.formationSkill=null,null!=i&&(i.formationSkill=null)),PanelManager.updateWorldIconPoint()}}},t.prototype.getFormationInfo=function(){var t=this.name+"\n";if(0!=this.power1&&0!=this.powerValue1){var e=Define.getPowerDesc(this.power1,this.powerValue1);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)+"\n"}if(0!=this.power2&&0!=this.powerValue2){e=Define.getPowerDesc(this.power2,this.powerValue2);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)+"\n"}if(0!=this.power3&&0!=this.powerValue3){e=Define.getPowerDesc(this.power3,this.powerValue3);t+=PowerString.makeColorString(e,ColorUtils.COLOR_GREEN)+"\n"}return this.teamcount>0&&(t+=Tool.manageString(GameText2.STR_FORGET_TEAM_NEED,this.teamcount+"")),t},t.doWorldSeeFormation=function(){var t,e=[];t=new MenuActionData(GameText.getText(GameText.TI_BACK),1),e.push(t),xself.isLeader()&&(t=new MenuActionData(GameText2.STR_FORMATION_OPTION,2),e.push(t)),PanelManager.openSelectMenuPanel(xself.formationSkill.getFormationInfo(),e,(function(t){PanelManager.closeSelectMenuPanel(),2==t&&(PanelManager.openRoleScene(),PanelManager.getPanel(RoleScene).setTab(RoleScene.TAB_INDEX_SKILL))}),this)},t.DUMMY_SKILL=new t,t.gAction=0,t.DELETE_SKILL_MONEY=[ModelConst.MONEY2,0],t}();__reflect(Skill.prototype,"Skill");var SkyArena=function(){function t(){this.job=0,this.level=0,this.tier=0,this.challengeNumber=0,this.killNumber=0,this.topType=0,this.topNumber=0,this.icon1=0,this.icon2=0,this.icon3=0,this.isPass=!1,this.iconpet1=0,this.isupdatesprite=!1,this.status=0,this.nextSysnTime=0,this.skyarenaUI=null,this.nextChallengeTime=0,this.battleStatusCount=0}return t.prototype.getNextSysnTime=function(){return this.nextSysnTime},t.prototype.setNextSysnTime=function(t){this.nextSysnTime=t},t.prototype.isStatus=function(t){return Tool.isBit(t,this.status)},t.prototype.setStatus=function(t,e){this.status=Tool.setBit(t,e,this.status)},t.prototype.createSkyArenaUI=function(){return PanelManager.closeScene(),PanelManager.openSkyArenaScene(this,!0),PanelManager.getPanel(SkyArenaScene)},t.doEnterSkyArena=function(e,n){function i(){o.skyarenaUI=o.createSkyArenaUI(),GameWorld.skyarena=o,n&&(t.isfirst=!0),GameWorld.skyarena.isupdatesprite=!0}if(null!=xself){var o=new t;if(n)t.doSkyArenaEntry(o,i,this);else{if(null==e)return;o.doGetSkyArenaDatafrombyte(e,i,this)}nato.Network.addMsgHandler(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_DATA,this.onSkyArenaWatchInfo,this)}},t.doSkyArenaEntry=function(t,e,n){if(null!=t){var i=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE_LIST);nato.Network.sendCmd(i,(function(i){return 0>i.getByte()?void AlertPanel.alertCommon(i.getString()):void t.doGetSkyArenaDatafrombyte(i,e,n)}),this)}},t.prototype.doGetSkyArenaDatafrombyte=function(t,e,n){if(null!=t){var i=xself;if(null!=i){this.challengeNumber=t.getShort(),this.leadPlayer=new Player;var o=t.getString(),a=t.getInt(),r=t.getInt(),s=t.getInt(),l=t.getByte(),_=t.getByte(),h=t.getInt(),u=t.getInt();this.leadPlayer.setName(o),this.leadPlayer.setIcon1(a),this.leadPlayer.setIcon2(r),this.leadPlayer.setIcon3(s),this.leadPlayer.setJob(l),this.leadPlayer.setLevel(_),this.leadPlayer.skyarenaPoint=h,i.skyarenaPoint=u,this.icon1=t.getInt(),this.icon2=t.getInt(),this.icon3=t.getInt(),this.name=t.getString(),this.job=t.getByte(),this.level=t.getByte(),this.tier=t.getShort(),this.killNumber=t.getInt(),this.topType=t.getShort(),this.topNumber=t.getShort(),this.isPass=t.getBoolean();var c=t.getShort();this.leadPlayer.setIconpet1(c),e&&n&&e.call(n)}}},t.prototype.logic=function(e){1==this.isStatus(t.SKYARENA_STAGE_BATTLE_FAIL)&&(AlertPanel.alertCommon(this.getBattleFailStr()),this.setStatus(!1,t.SKYARENA_STAGE_BATTLE_FAIL)),t.isfirst&&(AlertPanel.alertCommon(this.getSkyArenaFirstEnterStr()),t.isfirst=!1);var n=0;if(this.nextChallengeTime>0&&(n=Math.floor((this.nextChallengeTime-Date.now())/1e3)),0>=n&&(n=0,this.nextChallengeTime=0),this.skyarenaUI.updateCDTime(n+"秒"),!(Date.now()<this.nextSysnTime)){var i=MsgHandler.createSkyArenaRefresh();nato.Network.sendCmd(i),this.nextSysnTime=Date.now()+t.SYSN_TIME,t.doSkyArenaWatchInfo(t.SKYARENA_WATCH_TYPE_PLAN)}},t.doSkyArenaRefresh=function(e){if(null!=e){var n=GameWorld.skyarena;if(null!=n){var i=e.getByte();if(1==i)return void t.doclearSkyArena(!1);if(2==i)return void t.doclearSkyArena(!1);if(3==i)return n.battleStatusCount++,void(n.battleStatusCount>3&&(n.battleStatusCount=0,MsgHandler.createWorldDataReflashMsg()));if(0==i){var o=n.tier,a=n.isupdatesprite;n.doGetSkyArenaDatafrombyte(e),1==n.isStatus(t.SKYARENA_STAGE_BATTLE_WIN)&&(AlertPanel.alertCommon(n.getBattleWinStr()),n.nextChallengeTime=Date.now()+t.COOLDOWN_TIME,n.setStatus(!1,t.SKYARENA_STAGE_BATTLE_WIN));var r=o!=GameWorld.skyarena.tier||a;1==a&&(n.isupdatesprite=!1),null==n.skyarenaUI?(n.skyarenaUI=n.createSkyArenaUI(),n.skyarenaUI.setData(n,!0)):n.skyarenaUI.setData(n,r),t.doSkyArenaWatchInfo(t.SKYARENA_WATCH_TYPE_DEFIER)}}}},t.doSkyArenaExit=function(){function e(e){return 0>e.getByte()?void AlertPanel.alertCommon(e.getString()):void t.doclearSkyArena(!1)}AlertPanel.alert(GameText.STR_SKYARENA_EXIT_TITLE,GameText.STR_SKYARENA_EXIT_ASK,(function(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE_EXIT);nato.Network.sendCmd(t,e,this)}),this)},t.doSkyArenaPK=function(){var t=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE);nato.Network.sendCmd(t,(function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void 0}),this)},t.doSkyArenaWatchInfo=function(t){if(null!=GameWorld.skyarena){var e=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_DATA);e.putByte(t),e.putShort(GameWorld.skyarena.tier),nato.Network.sendCmd(e)}},t.onSkyArenaWatchInfo=function(t){if(0>t.getByte())AlertPanel.alertCommon(t.getString());else{var e=t.getString(),n=t.getInt();if(GameWorld.skyarena.killNumber=n,null!=GameWorld.skyarena.skyarenaUI)"昵"==e.charAt(0)?GameWorld.skyarena.skyarenaUI.updateDefierInfo(e):GameWorld.skyarena.skyarenaUI.updatePlanInfo(e)}},t.doclearSkyArena=function(t){if(GameWorld.skyarena=null,nato.Network.removeMsgHandler(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_DATA,this.onSkyArenaWatchInfo,this),t&&xworld.inBattle)WorldMessage.addPromptMsg(GameText.STR_SKYARENA_END);else{PanelManager.openMainMenuScene();var e=Define.SIMPLE_FLASH_DATA_FLAG,n=MsgHandler.createWorldDataMessage(e,!1);nato.Network.sendCmd(n)}},t.prototype.getSkyArenaFirstEnterStr=function(){var t="";return null==GameWorld.skyarena?t:t=Tool.manageString(GameText.STR_SKYARENA_FIRST_ENTER_INFO,GameWorld.skyarena.tier+"")},t.prototype.getBattleFailStr=function(){return GameText.STR_SKYARENA_BATTLE_FAIL_INFO},t.prototype.getBattleWinStr=function(){var t="";return null==GameWorld.skyarena?t:t=GameWorld.skyarena.isPass?GameText.STR_SKYARENA_BATTLE_WIN_ALL_INFO:Tool.manageStringList(GameText.STR_SKYARENA_BATTLE_WIN_INFO,[GameWorld.skyarena.tier+"",GameWorld.skyarena.name])},t.SYSN_TIME=5e3,t.COOLDOWN_TIME=3e4,t.isfirst=!1,t.SKYARENA_STAGE_BATTLE_FAIL=1,t.SKYARENA_STAGE_BATTLE_WIN=2,t.SKYARENA_STAGE_BATTLE_WIN_ALL=4,t.SKYARENA_WATCH_TYPE_PLAN=1,t.SKYARENA_WATCH_TYPE_DEFIER=2,t}();__reflect(SkyArena.prototype,"SkyArena");var TeamBoss=function(){function t(){this.nextSysnTime=0,this.status=0,this.endTime=0,this.scoreSum=0,this.myPos=-1,this.bossList=null,this.spriteModel=null}return t.getImgByBoss=function(e){if(null==e)return t.IMG_BOSS_NONE;if(e.num<=0)return t.IMG_BOSS_NONE;var n=e.level;return 30>=n?t.IMG_BOSS_LEVEL4:40>=n?t.IMG_BOSS_LEVEL3:50>=n?t.IMG_BOSS_LEVEL2:t.IMG_BOSS_LEVEL1},t.prototype.isStatus=function(t){return Tool.isBit(t,this.status)},t.prototype.setStatus=function(t,e){this.status=Tool.setBit(t,e,this.status)},t.prototype.getBossByIndex=function(t){return null==this.bossList||0>t||t>=this.bossList.length?null:this.bossList[t]},t.prototype.getBossByID=function(t){if(null==this.bossList)return null;for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];if(null!=n&&n.id==t)return n}return null},t.prototype.getBossByPos=function(t){if(null==this.bossList)return null;for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];if(null!=n&&n.uiPos==t)return n}return null},t.prototype.getAllBossNum=function(){var t=0;if(null!=this.bossList)for(var e=0;e<this.bossList.length;e++){var n=this.bossList[e];null!=n&&(t+=n.num)}return t},t.prototype.isTimeOut=function(){return Tool.currentTime>this.endTime},t.prototype.initSprite=function(){var t=xself;if(null!=t){var e=null,n=xworld.getModel(t.getLeaderID());null!=n&&(e=n.getPlayerSprite()),null==e&&(e=t.getPlayerSprite()),this.spriteModel=new Model(3),this.spriteModel.setDir(1),this.spriteModel.setPlayerSprite(GameSprite.cloneSprite(e)),this.spriteModel.setAnimationByDir(!1),this.spriteModel.sprite.setScale(xhd?1.5:1)}},t.prototype.fromBytes=function(t){this.endTime=t.getInt()+Tool.currentTime,this.scoreSum=t.getInt(),this.myPos=t.getByte();var e=t.getByte();this.bossList=new Array(e);for(var n=0;e>n;n++)this.bossList[n]=Boss.fromBytesByTeamBoss(t);return!0},t.prototype.logic=function(e){if(null!=this.spriteModel&&this.spriteModel.logic(e),this.logicOther(),!(Tool.currentTime<this.nextSysnTime)){var n=MsgHandler.createTeamBossRefresh();nato.Network.sendCmd(n),this.nextSysnTime=Tool.currentTime+t.SYSN_TIME}},t.prototype.logicOther=function(){0==this.isStatus(t.STATUS_FIRST_ENTER)&&(AlertPanel.alertNotify(GameText.STR_TEAMBOSS_ENTER,this.getFirstInfo()),this.setStatus(!0,t.STATUS_FIRST_ENTER)),1==this.isStatus(t.STATUS_FIGHT_START)&&1==this.isStatus(t.STATUS_FIGHT_EXIT)&&(this.doAskContinue(),this.setStatus(!1,t.STATUS_FIGHT_START),this.setStatus(!1,t.STATUS_FIGHT_EXIT))},t.prototype.getIntegralInfo=function(){var t=0;return null!=xself&&(t=xself.get(ModelConst.INTEGRAL)),Tool.manageStringList(GameText.STR_TEAMBOSS_GET_INTEGRAL_INFO,[this.scoreSum+"",this.getAllBossNum()+"",t+this.scoreSum+""])},t.prototype.getFirstInfo=function(){return GameText.STR_GET_FIRST_INFO},t.doOverNotice=function(t){if(null!=t){var e=t.getBoolean(),n=t.getInt();null!=xself&&(xself.integral+=n);var i;i=0==e?Tool.manageString(GameText.STR_TEAMBOSS_OVER_NOTICE1,n+""):Tool.manageString(GameText.STR_TEAMBOSS_OVER_NOTICE2,n+""),AlertPanel.alertCommon(i)}},t.prototype.doAskContinue=function(){if(1!=this.isStatus(t.STATUS_FIGHT_FAIL)){var e=this.getBossByPos(this.myPos);if(null!=e){if(e.num>0&&e.num--,e.isOver())return void AlertPanel.alertCommon(GameText.STR_TEAMBOSS_SELECT_OTHER);var n,i=Tool.manageStringList(GameText.STR_TEAMBOSS_CONTINUE_ASK_INFO,[e.level+"",e.num+""]),o=[];n=new MenuActionData(GameText.STR_FIGHTON,1),o.push(n),n=new MenuActionData(GameText.getText(GameText.TI_QUIT),2),o.push(n),PanelManager.openSelectMenuPanel(i,o,(function(n){PanelManager.closeSelectMenuPanel(),1==n&&t.doFight_2(GameWorld.teamBoss,e)}),this)}}else AlertPanel.alertCommon(GameText.STR_TEAMBOSS_FAIL)},t.doQuitFight=function(){var t=MsgHandler.createTeamBossNotFight();nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)}),this)},t.doFight_1=function(e){if(null!=e){if(e.isOver())return void AlertPanel.alertCommon(GameText.STR_TEAMBOSS_SELECT_OTHER);var n,i=Tool.manageStringList(GameText.STR_DO_FIGHT_INFO,[e.level+"",e.num+""]),o=[];n=new MenuActionData(GameText.STR_ENTER_FIGHT,1),o.push(n),n=new MenuActionData(GameText.getText(GameText.TI_QUIT),2),o.push(n),PanelManager.openSelectMenuPanel(i,o,(function(n){PanelManager.closeSelectMenuPanel(),1==n&&t.doFight_2(GameWorld.teamBoss,e)}),this)}},t.doFight_2=function(e,n){if(1!=e.isStatus(t.STATUS_FIGHT_FAIL)){if(null!=e&&null!=n){var i=MsgHandler.createTeamBossFight(n.id);nato.Network.sendCmd(i,(function(i){MsgHandler.isMessageHaveError(i)||(MsgHandler.processRemoteBattleNotify(i),e.myPos=n.uiPos,e.setStatus(!0,t.STATUS_FIGHT_START))}),this)}}else AlertPanel.alertCommon(GameText.STR_TEAMBOSS_FAIL)},t.doRefresh=function(t){if(null!=t){var e=t.getByte();if(1==e)return void this.clearTeamBoss(!1);if(2==e)return void this.clearTeamBoss(!1);if(0==e){var n=GameWorld.teamBoss;if(null==n)return;n.endTime=t.getInt()+Tool.currentTime,n.scoreSum=t.getInt();var i=t.getByte(),o=n.getBossByID(i);n.myPos=null!=o?o.uiPos:-1;for(var a=t.getByte(),r=0;a>r;r++){var s=t.getByte(),l=t.getShort(),_=n.getBossByID(s);null!=_&&(_.num=l)}if(PanelManager.isPanelShow(TeamBossScene))PanelManager.getPanel(TeamBossScene).update()}}},t.doTeamBossQuit=function(){AlertPanel.alert(GameText.STR_TEAMBOSS_QUIT,GameText.STR_TEAMBOSS_QUIT_ASK,(function(){var e=MsgHandler.createTeamBossQuit();nato.Network.sendCmd(e,(function(e){MsgHandler.isMessageHaveError(e)||t.clearTeamBoss(!1)}),this)}),this)},t.clearTeamBoss=function(t){return GameWorld.teamBoss=null,1==t&&PanelManager.battleUI&&PanelManager.battleUI.stage?void WorldMessage.addPromptMsg(GameText.STR_TEAMBOSS_QUIT_END):(PanelManager.closeScene(!0),void MsgHandler.createWorldDataReflashMsg())},t.doEnterTeamBoss=function(){var t=MsgHandler.createTeamBossStart();nato.Network.sendCmd(t)},t.processTeamBoss=function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.errorMessage(e.getString());var n=GameWorld.teamBoss;if(null==n&&(n=new t,GameWorld.teamBoss=n),0==n.fromBytes(e))return void AlertPanel.alertCommon(GameText.STR_TEAMBOSS_ENTER_FAIL);n.initSprite(),PanelManager.openTeamBossScene(n)}},t.SYSN_TIME=5e3,t.IMG_BOSS_LEVEL1=0,t.IMG_BOSS_LEVEL2=1,t.IMG_BOSS_LEVEL3=2,t.IMG_BOSS_LEVEL4=3,t.IMG_BOSS_NONE=4,t.IMG_BOSS_NUM=5,t.STATUS_FIRST_ENTER=1,t.STATUS_FIGHT_START=2,t.STATUS_FIGHT_EXIT=4,t.STATUS_FIGHT_FAIL=8,t}();__reflect(TeamBoss.prototype,"TeamBoss");var VipInfo=function(){function t(){this.level=0,this.money=0}return t.doGetVipInfo=function(e,n){if(null!=this._dataList&&this._dataList.length>0)null!=e&&null!=n&&e.call(n);else{var i=this,o=new nato.Message(ProtocolDefine.CG_VIP_LEVEL_INFO);nato.Network.sendCmd(o,(function(o){PanelManager.closeWaitForServer(),t.curVipLevel=o.getByte(),t.curGainMoney=o.getInt();for(var a=[],r=o.getByte(),s=0;r>s;s++){var l=new t;l.level=o.getByte(),l.money=o.getInt(),l.ownRewardList=[];for(var _=o.getByte(),h=0;_>h;h++){var u=new ItemData;o.getBoolean()?(u.isMoney=!1,ItemData.fromBytesAtts2(u,o),u.quantity=o.getInt(),u.durMax>0&&(u.durability=u.durMax)):(u.isMoney=!0,u.moneyType=i.toMoneyType(o.getInt()),u.quantity=o.getInt()),l.ownRewardList.push(u)}l.ownRewardList.sort(t.sortByGrade),l.loginRewardList=[],_=o.getByte();for(var c=0;_>c;c++){u=new ItemData;o.getBoolean()?(u.isMoney=!1,ItemData.fromBytesAtts2(u,o),u.quantity=o.getInt(),u.durMax>0&&(u.durability=u.durMax)):(u.isMoney=!0,u.moneyType=i.toMoneyType(o.getInt()),u.quantity=o.getInt()),l.loginRewardList.push(u)}l.loginRewardList.sort(t.sortByGrade);var T=o.getString();T=(T=T.replace(/\\n/g,"\n")).replace(/\/n/g,"\n"),l.desc=T,a.push(l)}i._dataList=a,null!=e&&null!=n&&e.call(n)}),this),PanelManager.openWaitForServer()}},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.sortByGrade=function(t,e){if(t&&e){if(t.grade>e.grade)return-1;if(e.grade>t.grade)return 1}return 0},t.getDataList=function(){return this._dataList},t.getVipInfo=function(t){if(this._dataList&&this._dataList.length>0)for(var e=0;e<this._dataList.length;e++){var n=this._dataList[e];if(n.level==t)return n}return null},t.getMaxVipLevel=function(){return this._dataList?this._dataList.length:0},t.clearInfo=function(){this._dataList=null},t.clean=function(){this.curVipLevel=0,this.curGainMoney=0,this.todayIncomeCount=0,this.TodayIncomeLimit=0,this.todayPayCount=0,this.TodayPayLimit=0,this._dataList=null},t.refreshVIPPanel=function(){PanelManager.isPanelShow(VipScene)&&PanelManager.getPanel(VipScene).update();PanelManager.isPanelShow(ChargePanel)&&PanelManager.getPanel(ChargePanel).updateVip();PanelManager.isPanelShow(ChargePanelForWanba)&&PanelManager.getPanel(ChargePanelForWanba).updateVip();PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateVipLevel()},t.processVIPLevel=function(e){var n=e.getByte(),i=e.getInt();xself&&xself.setVipLevel(n),t.curVipLevel=n,t.curGainMoney=i,this.refreshVIPPanel()},t.getTodayPayDesc=function(){return this.TodayPayLimit<=0?"":"/cFFD07E可支出黄金：/p/cffffff"+this.todayPayCount+"/"+this.TodayPayLimit+"/p"},t.getTodayIncomeDesc=function(){return this.TodayIncomeLimit<=0?"":"/cFFD07E可收入黄金：/p/cffffff"+this.todayIncomeCount+"/"+this.TodayIncomeLimit+"/p"},t.isInPayLimit=function(t){return!(this.TodayPayLimit>0&&this.todayPayCount+t>this.TodayPayLimit)},t.isInIncomeLimit=function(t){return!(this.TodayIncomeLimit>0&&this.todayIncomeCount+t>this.TodayIncomeLimit)},t.reqTradeMoney1Limit=function(){if(!this._isReqTradeMoney1Limit){var t=this,e=new nato.Message(ProtocolDefine.CG_TRADE_MONEY1_EVERYDAY);nato.Network.sendCmd(e,(function(e){t._isReqTradeMoney1Limit=!1;var n=e.getInt(),i=e.getInt(),o=e.getInt(),a=e.getInt();t.todayIncomeCount=n,t.TodayIncomeLimit=i,t.todayPayCount=o,t.TodayPayLimit=a}),this),this._isReqTradeMoney1Limit=!0}},t.curVipLevel=0,t.curGainMoney=0,t.TodayPayLimit=-1,t.TodayIncomeLimit=-1,t.todayPayCount=0,t.todayIncomeCount=0,t._isReqTradeMoney1Limit=!1,t}();__reflect(VipInfo.prototype,"VipInfo");var Vitality=function(){function t(){this.allvalue=0,this.vipAddValue=0,this.rewardid=0,this.status=0,this.conid=0,this.progress=0,this.activeCount=0,this.activeValue=0,this.isPathFinding=!1,this.directs=0,this.mapId=0,this.npcId=0}return t.doEnter=function(){if(null==xself)return null;var e=new nato.Message(ProtocolDefine.CG_TASK_VITALITY_FIRST_OPEN);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),0!=e.getBoolean()){var n=new t;n.allvalue=e.getShort(),n.vipAddValue=e.getShort();var i=e.getShort();n.vItemVitality=[];for(var o=0;i>o;o++){var a=new t;a.rewardid=e.getShort(),a.status=e.getByte(),n.vItemVitality.push(a)}var r=e.getShort();n.vConVitality=[];for(var s=0;r>s;s++){var l=new t;l.conid=e.getByte(),l.content=e.getString(),l.progress=e.getInt(),l.activeCount=e.getInt(),l.activeValue=e.getShort(),l.isPathFinding=e.getBoolean(),l.isPathFinding&&(l.directs=e.getByte(),l.mapId=e.getShort(),l.npcId=e.getShort(),l.npcName=e.getString()),n.vConVitality.push(l)}if(PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).updateVitalityData(n);else PanelManager.openTaskScene(),PanelManager.getPanel(TaskScene).updateVitalityData(n)}else AlertPanel.alertCommon(GameText2.STR_VITALITY_NOT_OPEN)}),this),PanelManager.openWaitForServer()},t.getStatusText=function(t){var e="";switch(t){case 0:e=GameText2.STR_VITALITY_NOT_REACH;break;case 1:e=GameText2.STR_VITALITY_HAS_REACH;break;case 2:e=GameText2.STR_VITALITY_HAS_GET}return e},t.doSeeReward=function(e){if(null!=e&&null!=xself){var n=new nato.Message(ProtocolDefine.CG_TASK_VITALITY_SHOW_REWARD);n.putInt(e.rewardid),nato.Network.sendCmd(n,(function(n){if(0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i="";if(n.getByte()>0){for(var o=n.getByte(),a=0;o>a;a++){var r=new ItemData;ItemData.fromBytesAtts2(r,n),r.quantity=n.getByte(),r.durability=r.durMax,i+=PowerString.makeColorString(r.name,Define.getGradeColor(r.grade))+"\n"+r.getDesc(null)+"\n"}var s=n.getShort(),l=n.getShort(),_=n.getShort();s>0&&(i+=GameText.getMoneyText(ModelConst.MONEY1)+s+"\n"),l>0&&(i+=GameText.getMoneyText(ModelConst.MONEY2)+l+"\n"),_>0&&(i+=GameText.getMoneyText(ModelConst.MONEY3)+_+"\n");var h,u=[];h=new MenuActionData(GameText.getText(GameText.TI_BACK),1),u.push(h),t.VITALITY_REWARD_ITEM_TYPE1==e.status&&(h=new MenuActionData(GameText2.STR_VITALITY_GET_REWARD,2),u.push(h)),PanelManager.openSelectMenuPanel(i,u,(function(n){PanelManager.closeSelectMenuPanel(),1==n||2==n&&t.doGetReward(e)}),this)}}}),this)}},t.doGetReward=function(e){if(null!=e){var n=xself;if(null!=n&&0!=SafeLock.doSafeLockVerify()){var i=new nato.Message(ProtocolDefine.CG_TASK_VITALITY_GET_REWARD);i.putInt(e.rewardid),nato.Network.sendCmd(i,(function(i){if(0>i.getByte())AlertPanel.alertCommon(i.getString());else if(i.getByte()>0){i.getByte()>0&&MsgHandler.processAddItemMsg(i,ProtocolDefine.ADD_ITEM_USE_REWARD)+"\n";var o=i.getInt(),a=i.getInt(),r=i.getInt();if(n.setPlayerMoneyValue(o,a,r),PanelManager.isPanelShow(TaskScene)){var s=PanelManager.getPanel(TaskScene);e.status=t.VITALITY_REWARD_ITEM_TYPE2,s.updateTab(),AlertPanel.alertCommon(GameText2.STR_VITALITY_GET_REWARD_SUCCESS)}}}),this)}}},t.doSeeCon=function(e){if(null!=e){var n=xself;if(null!=n)if(!(e.progress==e.activeCount)){var i="";switch(e.conid){case t.DAILY_LOGIN:return void(i="");case t.GET_ONLINE_REWARD:i=GameText2.STR_VITALITY_GET_ONLINE_REWARD;break;case t.SUBMIT_DAILY_QUEST:i=GameText2.STR_VITALITY_SUBMIT_DAILY_QUEST;break;case t.COMPLETE_INSTANCE:break;case t.STRONG_EQUIPMENT:i=GameText2.STR_VITALITY_STRONG_EQUIPMENT;break;case t.RESOLVE_EQUIPMENT:i=GameText2.STR_VITALITY_RESOLVE_EQUIPMENT;break;case t.ENCHANT_EQUIPMENT:break;case t.LEARN_ACTOR_SPELL:case t.UP_ACTOR_SPELL:case t.LEARN_PET_SPELL:case t.UP_PET_SPELL:i=GameText2.STR_VITALITY_ASK_FIND_PATH_SKILL;break;case t.DUEL_PLAYER:return void(i=GameText2.STR_VITALITY_DUEL_PLAYER);case t.BUY_GOODS:i=GameText2.STR_VITALITY_BUY_GOODS;break;case t.ENTER_ARENA:i=GameText2.STR_VITALITY_ENTER_ARENA;break;case t.ENTER_MOBPLACE:i=GameText2.STR_VITALITY_ENTER_MOBPLACE;break;case t.JION_ESCORT:i=GameText2.STR_VITALITY_JION_ESCORT;break;case t.RECHARGE_MONEY:i=GameText2.STR_VITALITY_RECHARGE_MONEY;break;case t.REFINE_EQUIPMENT:i=GameText2.STR_VITALITY_REFINE_EQUIPMENT;break;case t.ANSWER_DAILY_QU:i=GameText2.STR_VITALITY_ANSWER_DAILY_QU;break;case t.JION_DAILY_LUCKY:i=GameText2.STR_VITALITY_JION_DAILY_LUCKY;break;case t.JION_CITY_LUCKY:i=GameText2.STR_VITALITY_JION_CITY_LUCKY;break;default:return}AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),i,(function(){if(e.isPathFinding){if(n.cityId<=0&&(e.conid==t.SUBMIT_DAILY_QUEST||e.conid==t.ANSWER_DAILY_QU||e.conid==t.JION_CITY_LUCKY))return void AlertPanel.alertCommon(GameText2.STR_VITALITY_DAILY_NOT_HAVE_CITY);e.directs==t.VITALITY_AUTO_RUN_NPC?SpriteGuide.doSpriteGuideAutoMove(e.mapId,e.npcId):e.directs==t.VITALITY_AUTO_RUN_MISSION&&(Mission.doMissionAutoPathMsgByID(e.npcId),PanelManager.closeScene(!0))}else switch(e.conid){case t.DAILY_LOGIN:break;case t.GET_ONLINE_REWARD:PanelManager.openMainMenuScene(),PanelManager.openOnlineRewardPanel();break;case t.SUBMIT_DAILY_QUEST:case t.COMPLETE_INSTANCE:break;case t.STRONG_EQUIPMENT:PanelManager.openForgeScene();break;case t.RESOLVE_EQUIPMENT:GameWorld.isShowResolveMenu()?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_DECOMPOSE):AlertPanel.alertCommon(GameText2.STR_VITALITY_LEVEL_NOTENOUGH);break;case t.ENCHANT_EQUIPMENT:case t.LEARN_ACTOR_SPELL:case t.UP_ACTOR_SPELL:case t.LEARN_PET_SPELL:case t.UP_PET_SPELL:case t.DUEL_PLAYER:break;case t.BUY_GOODS:xworld.doBrowseShop(4,null);break;case t.ENTER_ARENA:case t.ENTER_MOBPLACE:case t.JION_ESCORT:break;case t.RECHARGE_MONEY:PayDescribe.doPayDesList();break;case t.REFINE_EQUIPMENT:case t.ANSWER_DAILY_QU:break;case t.JION_DAILY_LUCKY:MenuEventHandler.doMenuButton(MenuEventHandler.EVENT_ALL_LOGIN_LOTTERYDRAW_SHOP);case t.JION_CITY_LUCKY:}}),this)}}},t.doSeeInfoMenu=function(){var t=xself;if(null!=t){var e,n=[];e=new MenuActionData(GameText.getText(GameText.TI_BACK),1),n.push(e);var i=GameText.STR_DO_OPEN_VIP;xworld.isVip(t)&&(i=GameText.STR_VIP_PRIVILEGE),e=new MenuActionData(i,2),n.push(e);var o=GameText.STR_VIP;PanelManager.openSelectMenuPanel(Tool.manageString(GameText2.STR_VITALITY_INFO,o),n,(function(e){PanelManager.closeSelectMenuPanel(),1==e||2==e&&xworld.isVip(t)}),this)}},t.doSeeInfoSelect=function(t){if(null!=xself){var e;e=new MenuActionData(GameText.getText(GameText.TI_BACK),1),[].push(e)}},t.doGetPush=function(t){t.getString()},t.VITALITY_REWARD_ITEM_TYPE0=0,t.VITALITY_REWARD_ITEM_TYPE1=1,t.VITALITY_REWARD_ITEM_TYPE2=2,t.VITALITY_AUTO_RUN_NPC=1,t.VITALITY_AUTO_RUN_MISSION=2,t.DAILY_LOGIN=1,t.GET_ONLINE_REWARD=2,t.SUBMIT_DAILY_QUEST=3,t.COMPLETE_INSTANCE=4,t.STRONG_EQUIPMENT=5,t.RESOLVE_EQUIPMENT=6,t.ENCHANT_EQUIPMENT=7,t.LEARN_ACTOR_SPELL=8,t.UP_ACTOR_SPELL=9,t.LEARN_PET_SPELL=10,t.UP_PET_SPELL=11,t.DUEL_PLAYER=12,t.BUY_GOODS=13,t.ENTER_ARENA=14,t.ENTER_MOBPLACE=15,t.JION_ESCORT=16,t.RECHARGE_MONEY=17,t.REFINE_EQUIPMENT=18,t.ANSWER_DAILY_QU=19,t.JION_DAILY_LUCKY=20,t.JION_CITY_LUCKY=21,t}();__reflect(Vitality.prototype,"Vitality");var WarArmy=function(){function t(){}return t.prototype.getLeaderID=function(){return null==this.leader?-1:this.leader.getId()},t.prototype.isStatus=function(t){return Tool.isBit(t,this.armyStatus)},t.prototype.setStatus=function(t,e){this.armyStatus=Tool.setBit(e,t,this.armyStatus)},t.fromBytes=function(e){var n=new t;n.modelList=[];var i=e.getByte();n.buildPos=e.getByte();for(var o=0;i>o;o++){var a=new Player;a.setId(e.getInt()),a.setName(e.getString()),a.setLevel(e.getByte()),a.setJob(e.getByte()),a.setIcon1(e.getInt()),a.setIcon2(e.getInt()),a.setIcon3(e.getInt()),a.hp=e.getInt(),a.hpMax=e.getInt(),n.modelList.push(a)}return n},t.prototype.refreshSprite=function(){if(!(null==this.modelList||this.modelList.length<=0))for(var t=0;t<this.modelList.length;t++){var e=this.modelList[t];null!=e&&null==e.getPlayerSprite()&&e.setPlayerSprite(e.createSprite(!1))}},t.prototype.isMyArmy=function(){if(null==this.modelList||this.modelList.length<=0)return!1;for(var t=0;t<this.modelList.length;t++){var e=this.modelList[t];if(null!=e&&e.getId()==GameWorld.getPlayerID())return!0}return!1},t.prototype.getArmyID=function(){if(null==this.modelList||this.modelList.length<=0)return-1;for(var t=0;t<this.modelList.length;t++){var e=this.modelList[t];if(null!=e)return e.getId()}return-1},t.prototype.getLeader=function(){return null==this.modelList||this.modelList.length<=0?null:this.modelList[0]},t.prototype.getLeaderName=function(){var t=this.getLeader();return null!=t?t.getName():"("+GameText.STR_COUNTRY_WAR_ROUND_NULL+")"},t.prototype.getArmyPlayerNum=function(){if(null==this.modelList||this.modelList.length<=0)return 0;for(var t=0,e=0;e<this.modelList.length;e++)null!=this.modelList[e]&&t++;return t},t.prototype.getModel=function(t){return Tool.isArrayIndexOutOfBounds(t,this.modelList)?null:this.modelList[t]},t.prototype.getArmyInfo1=function(){var t=Tool.manageStringList(GameText.STR_ESCORT_SIMPLE_DESC,[this.getArmyPlayerNum()+"",this.getLeaderName()]);return this.buildPos>=0&&(t="【"+CountryWar.getBuildName(this.buildPos,!0)+"】"+t),t},t.prototype.getArmyInfo2=function(){return"【"+CountryWar.getBuildName(this.buildPos,!0)+"】"+" "+Tool.manageStringList(GameText.STR_ESCORT_SIMPLE_DESC,[this.armyPlayerNum+"",null!=this.leader?this.leader.getName():GameText.STR_COUNTRY_WAR_ROUND_NULL])},t.prototype.getModelInfo=function(t){var e=this.getModel(t);return null==e?"null":e.getName()+" "+Tool.manageString(GameText.getText(GameText.TI_LEVEL),e.getLevel()+"")+Define.getJobString(e.getJob())},t.prototype.getModelId=function(t){var e=this.getModel(t);return null==e?-1:e.getId()},t.getMenuAndEvent=function(t,e,n,i){if(null!=t){var o=CountryWar.isOpeArmy(xself);if(1==n)if(o){var a;a=new MenuActionData(GameText.getText(GameText.TI_REMOVE_ARMY),CountryWarHandler.EVENT_ALL_WAR_ARMY_REMOVE),e.push(a),a=new MenuActionData(GameText.getText(GameText.TI_DELETE_ARMY),CountryWarHandler.EVENT_ALL_WAR_ARMY_DELETE),e.push(a)}else e.push(null);else 2==n&&(o?(a=new MenuActionData(GameText.getText(GameText.TI_INSERT_ARMY),CountryWarHandler.EVENT_ALL_WAR_ARMY_INSERT),e.push(a),a=new MenuActionData(GameText.getText(GameText.TI_DELETE_ARMY),CountryWarHandler.EVENT_ALL_WAR_ARMY_DELETE),e.push(a)):e.push(null));if(a=new MenuActionData(GameText.getText(GameText.TI_DETAIL),CountryWarHandler.EVENT_ALL_WAR_ARMY_DETAIL),e.push(a),null!=e&&i)for(var r=e.length-1;r>=0;r--)null==e[r]&&(e.splice(r,1),r--)}},t.STATUS_IS_DEL=1,t.STATUS_IS_REMOVE=2,t}();__reflect(WarArmy.prototype,"WarArmy");var WarBuild=function(){function t(t,e,n){this.buildPos=t,this.buildName=CountryWar.getBuildName(t,!0),this.buildHP=e,this.buildHPMax=n}return t.formBytesToList=function(e,n){if(null==e)return null;var i=e.getByte(),o=e.getByte(),a=new t(i,o,o);return a.buildName=CountryWar.getBuildName(i,!1),a.buildLevel=e.getByte(),a.buildInfo=e.getString(),a.power1=65535&e.getByte(),a.powerValue1=e.getShort(),a.power2=65535&e.getByte(),a.powerValue2=e.getShort(),a.enemyPower1=65535&e.getByte(),a.enemyPowerValue1=e.getShort(),a.enemyPower2=65535&e.getByte(),a.enemyPowerValue2=e.getShort(),0==n||(a.reqMoney1=e.getInt(),a.reqMoney3=e.getInt(),a.reqIron=e.getInt(),a.reqWood=e.getInt(),a.reqStone=e.getInt(),a.reqBookNum=e.getByte(),a.reqArmyValue=e.getInt(),a.reqProsperity=e.getInt(),a.reqCampLevel=e.getByte(),a.reqLand=e.getInt()),a},t.prototype.doUpdateLevel=function(){null!=this.nextWarBuild&&(this.buildPos=this.nextWarBuild.buildPos,this.buildHP=this.nextWarBuild.buildHP,this.buildLevel=this.nextWarBuild.buildLevel,this.buildInfo=this.nextWarBuild.buildInfo,this.power1=this.nextWarBuild.power1,this.powerValue1=this.nextWarBuild.powerValue1,this.power2=this.nextWarBuild.power2,this.powerValue2=this.nextWarBuild.powerValue2,this.enemyPower1=this.nextWarBuild.enemyPower1,this.enemyPowerValue1=this.nextWarBuild.enemyPowerValue1,this.enemyPower2=this.nextWarBuild.enemyPower2,this.enemyPowerValue2=this.nextWarBuild.enemyPowerValue2,this.nextWarBuild=null)},t.prototype.getBuildName=function(){return this.buildName+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.buildLevel+"")+")"},t.prototype.isCanUpdate=function(){return null!=this.nextWarBuild},t.prototype.exeDeductUpdateLevel=function(t){null!=t&&(t.freeLand-=this.nextWarBuild.reqLand,t.prosperity-=this.nextWarBuild.reqProsperity,t.armyStrength-=this.nextWarBuild.reqArmyValue,t.bookNum-=this.nextWarBuild.reqBookNum,t.money1-=this.nextWarBuild.reqMoney1,t.money3-=this.nextWarBuild.reqMoney3,t.wood-=this.nextWarBuild.reqWood,t.stone-=this.nextWarBuild.reqStone,t.iron-=this.nextWarBuild.reqIron)},t.prototype.getArmyBuildInfo=function(t){var e=new StringBuffer,n="";if(e.append(PowerString.makeColorString(Tool.manageStringList(GameText.STR_WARBUILD_INFO_DUR,[this.getBuildName(),this.buildHP+""]),ColorUtils.COLOR_YELLOW)+"\n"),n="",0!=this.power1&&0!=this.powerValue1&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.power1,this.powerValue1),ColorUtils.COLOR_GREEN)+"  "),0!=this.power2&&0!=this.powerValue2&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.power2,this.powerValue2),ColorUtils.COLOR_GREEN)+"  "),0==Tool.isNullText(n)&&e.append(Tool.manageString(GameText.STR_WARBUILD_TO_OUR_EFF,n+"\n")),n="",0!=this.enemyPower1&&0!=this.enemyPowerValue1&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.enemyPower1,this.enemyPowerValue1),ColorUtils.COLOR_RED)+"  "),0!=this.enemyPower2&&0!=this.enemyPowerValue2&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.enemyPower2,this.enemyPowerValue2),ColorUtils.COLOR_RED)+"  "),0==Tool.isNullText(n)&&e.append(Tool.manageString(GameText.STR_WARBUILD_TO_OTHER_EFF,n+"\n")),0==Tool.isNullText(this.buildInfo)&&e.append(Tool.manageString(GameText.STR_WARBUILD_INFO,this.buildInfo+"\n")),0==t)return e.toString();var i=Tool.manageStringList(GameText.STR_WARBUILD_INFO_NEED,[GameText.STR_MONEY1+this.reqMoney1+"\n"+GameText.STR_MONEY3+this.reqMoney3+"\n",this.reqIron+"",this.reqWood+"",this.reqStone+"",this.reqBookNum+"",this.reqArmyValue+"",this.reqProsperity+"",this.reqCampLevel+"",this.reqLand+""]);return e.append(i),e.toString()},t.prototype.isDestroy=function(){return this.buildHP<=0},t.prototype.getHPInfo=function(){return this.isDestroy()?GameText.STR_WARBUILD_DESTROY:this.buildHP+""},t.prototype.getArmyNumInfo=function(){return this.armyNum+"/"+this.playerNum},t.prototype.clearArmyNum=function(){this.armyNum=0,this.playerNum=0},t.prototype.setArmyNum=function(t,e){this.armyNum=t,this.playerNum=e},t.prototype.getInfo=function(){var t=new StringBuffer,e=Tool.manageStringList(GameText.STR_WARBUILD_GET_INFO,[this.buildLevel+"",this.buildHP+"",this.armyNum+"",this.playerNum+""]);return t.append(e),t.append(this.getPowerDesc(GameWorld.countryWar)),t.toString()},t.prototype.getPowerDesc=function(t){if(null==t)return"";var e=new StringBuffer;if(0!=this.power1&&0!=this.powerValue1&&e.append(PowerString.makeColorString(Define.getPowerDesc(this.power1,this.powerValue1),this.powerValue1>0?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)+"  "),0!=this.power2&&0!=this.powerValue2&&e.append(PowerString.makeColorString(Define.getPowerDesc(this.power2,this.powerValue2),this.powerValue2>0?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)+"  "),Tool.isNullText(e.toString()))return"";var n=t.isEnemyBuildPos(this.buildPos)?GameText.STR_ENEMY:GameText.STR_OUT_SIDE;return Tool.manageStringList(GameText.STR_WARBUILD_GET_POWER_DESC,[n,CountryWar.getBuildName(this.buildPos,!1),e.toString()])},t}();__reflect(WarBuild.prototype,"WarBuild");var WarCommand=function(){function t(){}return t.getBuildPowerDesc=function(e,n){if(e==t.BUILD_BUFF_ID_NULL||0==n)return"";var i=new StringBuffer;switch(n>0?i.append(GameText.STR_RECOVER):i.append(GameText.STR_REDUCE),e){case t.BUILD_BUFF_ID_PALACE:i.append(GameText.STR_COUNTRY_PALACE);break;case t.BUILD_BUFF_ID_UP_WALL:i.append(GameText.STR_COUNTRY_UP_WALL);break;case t.BUILD_BUFF_ID_DOWN_WALL:i.append(GameText.STR_COUNTRY_DOWN_WALL);break;case t.BUILD_BUFF_ID_UP_TOWER:i.append(GameText.STR_COUNTRY_UP_TOWER);break;case t.BUILD_BUFF_ID_MIDDLE_TOWER:i.append(GameText.STR_COUNTRY_MIDDLE_TOWER);break;case t.BUILD_BUFF_ID_DOWN_TOWER:i.append(GameText.STR_COUNTRY_DOWN_TOWER);break;case t.BUILD_BUFF_ID_ALL:i.append(GameText.STR_ALL_BUILD)}return i.append(Tool.manageString(GameText.STR_WAR_COMMAND_DUR,n+"")),PowerString.makeColorString(i.toString(),n>0?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)},t.formBytes=function(e){var n=new t;return n.did=e.getShort(),n.name=e.getString(),n.info=e.getString(),n.level=e.getByte(),n.reqCamp=e.getByte(),n.reqBook=e.getByte(),n.reqArmy=e.getInt(),n.round=e.getByte(),n.power1=65535&e.getByte(),n.powervalue1=e.getShort(),n.power2=65535&e.getByte(),n.powervalue2=e.getShort(),n.buildPower=e.getByte(),n.buildPowerValue=e.getShort(),n.enemypower1=65535&e.getByte(),n.enemypowervalue1=e.getShort(),n.enemypower2=65535&e.getByte(),n.enemypowervalue2=e.getShort(),n.reqArmyRate=e.getByte(),n},t.prototype.getNameInfo=function(){var t=new StringBuffer;return t.append(PowerString.makeColorString(Tool.manageStringList(GameText.STR_WAR_COMMAND_LEVEL_INFO,[this.name,this.level+""]),ColorUtils.COLOR_YELLOW)),t.toString()},t.prototype.getInfo=function(){var e=new StringBuffer,n=null;return e.append(PowerString.makeColorString(Tool.manageStringList(GameText.STR_WAR_COMMAND_LEVEL_INFO,[this.name,this.level+""]),ColorUtils.COLOR_YELLOW)+"\n"),this.round>0&&e.append(Tool.manageString(GameText.STR_WAR_COMMAND_GET_INFO_ROUND,this.round+"\n")),n="",this.reqCamp>0&&(n+=Tool.manageString(GameText.STR_WAR_COMMAND_INFO_REQ_CAMP,this.reqCamp+"")+"  "),this.reqBook>0&&(n+=Tool.manageString(GameText.STR_WAR_COMMAND_INFO_REQ_BOOK,this.reqBook+"  ")),this.reqArmy>0?n+=Tool.manageString(GameText.STR_WAR_COMMAND_INFO_REQ_ARMY,this.reqArmy+"  "):this.reqArmyRate>0&&(n+=Tool.manageStringList(GameText.STR_WAR_COMMAND_INFO_REQ_ARMY_RT,[this.getReqArmyRateValue()+"",this.reqArmyRate+""])+"  "),0==Tool.isNullText(n)&&e.append(Tool.manageString(GameText.STR_SKILL_GETD_DESC_NEED,n+"\n")),n="",0!=this.power1&&0!=this.powervalue1&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.power1,this.powervalue1),ColorUtils.COLOR_GREEN)+"  "),0!=this.power2&&0!=this.powervalue2&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.power2,this.powervalue2),ColorUtils.COLOR_GREEN)+"  "),0==Tool.isNullText(n)&&e.append(Tool.manageString(GameText.STR_WARBUILD_TO_OUR_ARMY_EFF,n+"\n")),0!=this.buildPower&&0!=this.buildPowerValue&&e.append(t.getBuildPowerDesc(this.buildPower,this.buildPowerValue)+"\n"),n="",0!=this.enemypower1&&0!=this.enemypowervalue1&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.enemypower1,this.enemypowervalue1),ColorUtils.COLOR_RED)+"  "),0!=this.enemypower2&&0!=this.enemypowervalue2&&(n+=PowerString.makeColorString(Define.getPowerDesc(this.enemypower2,this.enemypowervalue2),ColorUtils.COLOR_RED)+"  "),0==Tool.isNullText(n)&&e.append(Tool.manageString(GameText.STR_WARBUILD_TO_OTHER_ARMY_EFF,n+"\n")),0==Tool.isNullText(this.info)&&e.append(Tool.manageString(GameText.STR_WARBUILD_INFO,this.info+"\n")),e.toString()},t.prototype.getReqArmyRateValue=function(){return null==GameWorld.countryWar?0:GameWorld.countryWar.strengthMax*this.reqArmyRate/100},t.prototype.isCanUse=function(t){null==t&&(t=new StringBuffer);var e=GameWorld.countryWar;if(null==e)return!1;if(e.armyLevel<this.reqCamp)return t.append(Tool.manageString(GameText.STR_WAR_COMMAND_CAN_REQ_CAMP,this.reqCamp-e.armyLevel+"")),!1;if(e.bookNum<this.reqBook)return t.append(Tool.manageString(GameText.STR_WAR_COMMAND_CAN_REQ_BOOK,this.reqBook-e.bookNum+"")),!1;if(e.strength<this.reqArmy)return t.append(Tool.manageString(GameText.STR_WAR_COMMAND_CAN_REQ_ARMY,this.reqArmy-e.strength+"")),!1;var n=e.strengthMax*this.reqArmyRate/100;return!(e.strength<n)||(t.append(Tool.manageString(GameText.STR_WAR_COMMAND_CAN_REQ_ARMY,n-e.strength+"")),!1)},t.BUILD_BUFF_ID_NULL=0,t.BUILD_BUFF_ID_PALACE=1,t.BUILD_BUFF_ID_UP_WALL=2,t.BUILD_BUFF_ID_DOWN_WALL=3,t.BUILD_BUFF_ID_UP_TOWER=4,t.BUILD_BUFF_ID_MIDDLE_TOWER=5,t.BUILD_BUFF_ID_DOWN_TOWER=6,t.BUILD_BUFF_ID_ALL=100,t}();__reflect(WarCommand.prototype,"WarCommand");var WishPool=function(){function t(){}return t.doOpenWishPool=function(){var e=new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_WISHING_WELL);nato.Network.sendCmd(e,t.onWishPoolHandler,t)},t.onWishPoolHandler=function(t){var e=t.getInt(),n=t.getInt(),i=t.getInt(),o=t.getInt(),a=new WishPoolInfo(e,n,i,o);PanelManager.openWishPoolScene(a)},t.TYPE_WISHING_COIN=0,t.TYPE_WISHING_GOLD=1,t}();__reflect(WishPool.prototype,"WishPool");var WishPoolInfo=function(t,e,n,i){this.costMoney1=t,this.costItemCount1=e,this.costMoney2=n,this.costItemCount2=i};__reflect(WishPoolInfo.prototype,"WishPoolInfo");var WorldEvent=function(t){function e(e,n){var i=t.call(this,e)||this;return i.param=n,i}return __extends(e,t),e.PLAYER_ACTIVE_SKILL_SELECTED="player_active_skill_selected",e.AROUND_LOOK_PLAYER_INFO="around_look_player_info",e.AROUND__REFRESH_TEAM_INFO="around_refresh_team_info",e.HANG_SELL_READY="HANG_SELL_READY",e.HANG_SELL_SUCCESS="hang_sell_success",e.CANCEL_HANG_SELL_SUCCESS="cancel_hang_sell_success",e.HANG_SELL_BUY_SUCCESS="hang_sell_buy_success",e.SUPPLY_SUCCESS="suply_success",e.SUPPLY_IN_BAG="supply_in_bag",e.RETURN_SEE_ORDER="return_see_order",e.PUBLIC_ORDER="PUBLIC_ORDER",e.MERCENARY_REFRESH_INFO="mercenary_refresh_info",e.SELL_VIEW_UPDATE="sell_view_update",e.ITEM_SELL_START_SUCCESS="item_sell_start_success",e.ITEM_SELL_END="item_sell_end",e.SELL_TYPE_CHANGE="sell_type_change",e.RETURN_RANK_TYPE_LIST="return_rank_type_list",e.RETURN_RANK_INFO_LIST="return_rank_info_list",e.RETURN_MY_RANK_INFO="RETURN_MY_RANK_INFO",e.ACHIEVE_GET_AWARD="achieve_get_award",e.RETURN_MASTER_LIST="RETURN_MASTER_LIST",e.RETURN_DAILY_LOTTERY_DATA="RETURN_DAILY_LOTTERY_DATA",e.RETURN_DAILY_LOTTERY_DATA_HISTORY="RETURN_DAILY_LOTTERY_DATA_HISTORY",e.RETURN_FRIEND_ID="RETURN_FRIEND_ID",e.MANOR_TASK_DOT="MANOR_TASK_DOT",e.MY_UNION_UPDATE="MY_UNION_UPDATE",e.COUNTRY_ARMY_BUILD_UPDATE="COUNTRY_ARMY_BUILD_UPDATE",e.GET_WAR_LIST_BACK="GET_WAR_LIST_BACK",e.GET_UNION_LIST_BACK="GET_UNION_LIST_BACK",e.COUNTRY_ARMY_SOLDIER_UPDATE="COUNTRY_ARMY_SOLDIER_UPDATE",e.COUNTRY_WAR_ARMY_LIST_UPDATE="COUNTRY_WAR_ARMY_LIST_UPDATE",e.BAG_SHOW_CHECK_STAR="BAG_SHOW_CHECK_STAR",e.AUTO_ADD_POINT_FINISH="AUTO_ADD_POINT_FINISH",e.GET_LEVEL_REWARD_SUCCESS="GET_LEVEL_REWARD_SUCCESS",e.MODE_SHOP_CHANGE="MODE_SHOP_CHANGE",e.ACTOR_SELL_LIST="ACTOR_SELL_LIST",e.ACTOR_BUY_LIST="ACTOR_BUY_LIST",e.ACTOR_SELL_READY="ACTOR_SELL_READY",e.ACTOR_CANCEL_SELL="ACTOR_CANCEL_SELL",e.ACTOR_SELL_PANEL_UPDATE="ACTOR_SELL_PANEL_UPDATE",e.ACTOR_BUY_PANEL_UPDATE="ACTOR_BUY_PANEL_UPDATE",e}(egret.Event);__reflect(WorldEvent.prototype,"WorldEvent");var WorldEventDispatcher=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.EventDispatcher);__reflect(WorldEventDispatcher.prototype,"WorldEventDispatcher");var ChatUp=function(){function t(){this.isNew=!1}return t.prototype.getDesc=function(){return this.player?PowerString.makeColorString(this.player.getName(),ChatMsg.getSexColor(this.player.getSex()))+" 对你的第一印象不错哦~与TA交个朋友吧":""},t.doChatUpRefresh=function(e){var n=e.getBoolean();t.doSetSpriteGuideGlintShow(n),PanelManager.isPanelShow(ChatUpPanel)&&t.doSeeChatUpLists()},t.doChatUp=function(t){var e=new nato.Message(ProtocolDefine.CG_INITIATIVE_ACCOST);e.putInt(t),nato.Network.sendCmd(e,(function(t){PanelManager.closeWaitForServer(),t.getByte(),AlertPanel.alertCommon(t.getString())}),this),PanelManager.openWaitForServer()},t.doSeeChatUpLists=function(){t.doSetSpriteGuideGlintShow(!1);var e=new nato.Message(ProtocolDefine.CG_GET_ACCOST_MY_LIST);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),0>e.getByte())AlertPanel.alertCommon(e.getString());else{for(var n=[],i=e.getInt(),o=0;i>o;o++){if(e.getBoolean()){var a=t.getChatUpfromByte(e);null!=a&&n.push(a)}}PanelManager.isPanelShow(ChatUpPanel)?PanelManager.getPanel(ChatUpPanel).setData(n):PanelManager.openChatUpPanel(n)}}),this),PanelManager.openWaitForServer()},t.getChatUpfromByte=function(e){var n=new t;return n.player=new Model(3),n.player.setId(e.getInt()),n.player.setName(e.getString()),n.player.setSex(e.getByte()),n.player.setIcon1(e.getInt()),n.player.setIcon2(e.getInt()),n.player.setIcon3(e.getInt()),n.time=e.getLong(),n.isNew=e.getBoolean(),n},t.doSetSpriteGuideGlintShow=function(e){t.isShowGlint=e,PanelManager.updateWorldIconPoint()},t.isShowGlint=!1,t}();__reflect(ChatUp.prototype,"ChatUp");var CommonNpcItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.btnGo.once(egret.TouchEvent.TOUCH_TAP,this.onGoNpc,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.txtNpcName.text=e.npcName,this.txtNpcDesc.text="介绍："+e.npcDesc},e.prototype.onGoNpc=function(t){PopUpManager.closeAll();var e=this.data;AutoFindPath.findPath(e.mapId,e.npcId)},e}(eui.ItemRenderer);__reflect(CommonNpcItem.prototype,"CommonNpcItem");var CommonNpcPanel=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this),this.listNpc.itemRenderer=CommonNpcItem,this.listNpc.dataProvider=new eui.ArrayCollection(e.npcs)},e.npcs=[{mapId:906,npcId:16,npcName:"宠物训练师",npcDesc:"宠物训练师宠物训练师"},{mapId:906,npcId:16,npcName:"宠物训练师",npcDesc:"宠物训练师宠物训练师"},{mapId:906,npcId:16,npcName:"宠物训练师",npcDesc:"宠物训练师宠物训练师"},{mapId:906,npcId:16,npcName:"宠物训练师",npcDesc:"宠物训练师宠物训练师"},{mapId:906,npcId:16,npcName:"宠物训练师",npcDesc:"宠物训练师宠物训练师"}],e}(PanelBase);__reflect(CommonNpcPanel.prototype,"CommonNpcPanel");var GuideFrame=function(t){function e(n,i,o){void 0===i&&(i=e.DEFAULT_WIDTH),void 0===o&&(o=e.DEFAULT_HEIGHT);var a=t.call(this)||this;return a._isShow=!1,a.w=e.DEFAULT_WIDTH,a.h=e.DEFAULT_HEIGHT,a.arrowDir=guide.GUIDE_ARROW_DOWN,a.content=n,a.w=i*xhdRatio,a.h=o*xhdRatio,a.init(),a}return __extends(e,t),e.prototype.init=function(){null==this.txt&&(this.txt=new egret.TextField,this.txt.fontFamily="微软雅黑",this.txt.textColor=0,this.txt.size=xhd?28:14),this.txt.width=this.w,this.txt.x=16,this.txt.y=16,this.txt.textFlow=Tool.convertDescToTextFlow(this.content,-1),this.txt.textWidth<this.w&&(this.txt.width=this.txt.textWidth),this.width=this.txt.width+40,this.height=this.txt.textHeight+40,null==this.bg&&(this.bg=new eui.Image,this.bg.source="guide_bubble",this.bg.scale9Grid=new egret.Rectangle(12,12,20,20)),this.bg.width=this.width,this.bg.height=this.height,this.bg.cacheAsBitmap=!0,this.addChild(this.bg),this.addChild(this.txt)},e.prototype.updateMessage=function(t){this.content=t,this.w=e.DEFAULT_WIDTH*xhdRatio,this.h=e.DEFAULT_HEIGHT*xhdRatio,this.init()},e.prototype.show=function(t,e){this._isShow=!0,this.visible=!0,this.name="guideFrame";var n=guide.arrow_direction==guide.GUIDE_ARROW_DOWN,i=t-this.width/2,o=n?e-this.height-25*xhdRatio:e+this.height+guide.ARROW_HEIGHT;0>i&&(i=0),this.x=i,this.y=o,GameWorld.bigGuideType==GameWorld.NAN_FORCE_GUIDE_TYPE?UILayer.instance.guideLayer.addChild(this):Main.instance.stage.addChild(this)},e.prototype.logic=function(t){},Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},set:function(t){this._isShow&&!t&&this.clear()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._isShow=!1,this.parent&&this.parent.removeChild(this)},e.DEFAULT_WIDTH=150,e.DEFAULT_HEIGHT=40,e}(eui.Component);__reflect(GuideFrame.prototype,"GuideFrame");var GuideHandler=function(){function t(){}return t.setMissionDetailGuide=function(t){},t.setMissionUIOpenGuide=function(t,e,n){GameWorld.guideType=t;var i=Tool.manageString(GameText.STR_TOUCH_OPEN,n),o=GameWorld.getGuideFrame(i),a=e.parent.localToGlobal(0,0);a.x+=e.x,a.y+=e.y,PanelManager.mainMenu.expandGroupMenu1(),o.show(a.x+e.width/2,a.y-15),GameWorld.setGuideRect(a.x,a.y,e.width,e.height)},t.setRoleSkillPageGuide=function(t){var e=PanelManager.getPanel(RoleScene);if(null!=e){var n=e.tabBtn_skill,i=n.parent.localToGlobal(n.x,n.y),o=Tool.manageString(GameText.STR_TOUCH_OPEN,"技能面板");guide.arrow_direction=guide.GUIDE_ARROW_UP,GameWorld.getGuideFrame(o).show(i.x+n.width/2,i.y+20),GameWorld.setGuideRect(i.x,i.y,n.width,n.height),GameWorld.guideType=t}},t.setActiveSkillGuide=function(t){var e=PanelManager.getPanel(RoleScene);if(null!=e){var n=e.skillPanel;if(null!=n){var i=n.firstActiveSkillItem;if(null!=i){var o=i.btn_select,a=o.parent.localToGlobal(o.x,o.y);GameWorld.getGuideFrame("设置自动战斗中释放技能").show(a.x+o.width/2,a.y-20),GameWorld.setGuideRect(a.x,a.y,o.width,o.height),GameWorld.guideType=t}}}},t.setMissionActionGuide=function(t,e){if(null!=e&&null!=e.parent){var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height,!0),GameWorld.guideType=t}},t.setBagEquipSelectGuide=function(t,e){var n=e.parent.localToGlobal(e.x,e.y),i=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_CHOICE_EQUIP_ITEM;GameWorld.getGuideFrame(i).show(n.x+e.width/2,n.y-20),GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t},t.setBagPartnerSelectGuide=function(t){var e=PanelManager.bagScene;if(null!=e&&null!=e.bagView)for(var n,i=(n=e.bagView.getChildAt(0)).numChildren,o=null,a=0;i>a;a++)if(null!=(o=n.getChildAt(a))){if(null!=o.itemData&&o.id==ItemData.ITEM_ID_PET_PARTNER){var r=o.parent.localToGlobal(o.x,o.y),s=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_CHOICE_EQUIP_ITEM;GameWorld.getGuideFrame(s).show(r.x+o.width/2,r.y-20),GameWorld.setGuideRect(r.x,r.y,o.width,o.height),GameWorld.guideType=t;break}}},t.setBagDoEquipGuide=function(t){var e=PanelManager.itemView;if(null!=e){var n=e.btn0,i=n.parent.localToGlobal(n.x,n.y),o=GameText.STR_BATTLE_ATTACK_HERE+GameText.getText(GameText.TI_USE);GameWorld.getGuideFrame(o).show(i.x+n.width/2,i.y-20),GameWorld.setGuideRect(i.x,i.y,n.width,n.height),GameWorld.guideType=t}},t.setBagDoUseGuide=function(t){var e=PanelManager.itemView;if(null!=e){var n=e.btn0,i=n.parent.localToGlobal(n.x,n.y),o=GameText.STR_BATTLE_ATTACK_HERE+GameText.getText(GameText.TI_USE);GameWorld.getGuideFrame(o).show(i.x+n.width/2,i.y-20),GameWorld.setGuideRect(i.x,i.y,n.width,n.height),GameWorld.guideType=t}},t.setAddPointTipsGuide=function(t){if(!(xself.cp<=0)){var e;e=GameText.STR_KEY_ADD_SP_SURE_ONEKEY;var n=PanelManager.getPanel(RoleScene).basePanel.btn_add_auto,i=n.parent.localToGlobal(n.x,n.y);GameWorld.getGuideFrame(e).show(i.x+n.width/2,i.y-20),GameWorld.setGuideRect(i.x,i.y,n.width,n.height),GameWorld.guideType=t}},t.setAddPointSureShowGuide=function(t,e){var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t},t.setAddPointEnd=function(t){guide.arrow_direction=guide.GUIDE_ARROW_UP;var e=PanelManager.getPanel(RoleScene).closeBtn,n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t},t.setAddPointSureGuide=function(t){if(0!=PanelManager.isStatusFlag(PanelManager.FLAG_IS_ADD_POINT_SURE)){var e=AlertPanel.instance.btn_ok;if(null!=e){var n=GameText.STR_TOUCH_ADD_SP_SURE,i=e.parent.localToGlobal(e.x,e.y);GameWorld.getGuideFrame(n).show(i.x+e.width/2,i.y-20),GameWorld.setGuideRect(i.x,i.y,e.width,e.height),GameWorld.guideType=t}}},t.setAutopathGuide=function(t){var e=PanelManager.mainMenu.autogame_btn;if(null!=e){var n=(GameText.STR_TOUCH_AUTO_PATH_SURE,e.parent.localToGlobal(e.x,e.y));GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t}},t.setEquipChangeGuide=function(t){var e=PanelManager.mainMenu.equipChangePanel.label_change;if(null!=e){guide.rectBox&&guide.rectBox.parent&&guide.rectBox.parent.removeChild(guide.rectBox);var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t}},t.openCity=function(t){var e=PanelManager.mainMenu.btn_tower;if(null!=e){var n=GameText.STR_OPEN_CITY,i=e.parent.localToGlobal(e.x,e.y);GameWorld.getGuideFrame(n).show(i.x,i.y-20),GameWorld.setGuideRect(i.x,i.y,e.width,e.height,!1),GameWorld.guideType=t}},t.enterCity=function(t){var e=PanelManager.getPanel(ManorScene).cityPanel.btn_enterCity;if(null!=e){var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t}},t.openTask=function(t){var e=PanelManager.mainMenu.btn_task;if(null!=e){var n=e.parent.localToGlobal(e.x,e.y),i=GameText.STR_TASK_SHOW;GameWorld.getGuideFrame(i).show(n.x+e.width/2,n.y-20),GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t}},t.closeTask=function(t){guide.arrow_direction=guide.GUIDE_ARROW_UP;var e=PanelManager.getPanel(TaskScene,!1).return_btn;if(null!=e){var n=GameText.STR_CLOSE_TASK,i=e.parent.localToGlobal(e.x,e.y);GameWorld.getGuideFrame(n).show(i.x-e.width,i.y-20),GameWorld.setGuideRect(i.x,i.y,e.width,e.height,!1),GameWorld.guideType=t}},t.openSprite=function(t){var e=PanelManager.mainMenu.help_btn;if(null!=e){var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height),GameWorld.guideType=t}},t.mercenaryGuide=function(t){var e=PanelManager.getPanel(MercenaryShop,!1).getMercenaryItemList();if(null!=e){var n=e[0].btn_fire;if(null!=n){var i=n.parent.localToGlobal(n.x,n.y);GameWorld.setGuideRect(i.x,i.y,n.width,n.height,!1),GameWorld.guideType=t}}},t.mercenaryHire=function(t){var e=AlertPanel.instance.btn_ok;if(null!=e){var n=e.parent.localToGlobal(e.x,e.y);GameWorld.setGuideRect(n.x,n.y,e.width,e.height,!1),GameWorld.guideType=t}},t.npcDialogueGuide=function(t){var e,n=t.btn1,i=t.btn2,o=t.btn3;return t.return_btn,null!=(e=n.mission)&&guide.isGuideMission(e.getId(),1)&&1==GameWorld.useGuide?void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,n):null!=(e=i.mission)&&guide.isGuideMission(e.getId(),2)&&1==GameWorld.useGuide?void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,i):null!=(e=i.mission)&&guide.isGuideMission(e.getId(),3)&&1==GameWorld.useGuide?void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,o):guide.isNpcMissionMaster(t.getNpc())&&1==GameWorld.useGuide?void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,i):guide.isNpcMissionList(t.getNpc())&&GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_TASK_LIST_GET)?(guide.setStatusFlag(!1,guide.IS_GUIDE_TASK_LIST_GET),void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,n)):"精灵助手"==t.title_label.text&&GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_SPRITE_UI)?void GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,n):guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL)?(GameWorld.setGuide(GameWorld.GUIDE_MISSION_ACTION,n),void(guide.battleFailFirse=!1)):void 0},t.cityTaskGuide=function(){Define.isCityMap(xworld.orgMapID)&&guide.isStatusFlag(guide.IS_GUIDE_TASK_OPEN_UI)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_TASK_OPEN_UI),GameWorld.setGuide(GameWorld.GUDIE_TASK_OPEN))},t.checkRoleLevelGuide=function(){if(4==xself.getLevel()){if(xself.cp<=0)return;GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_UI_OPEN)}else if(7==xself.getLevel()||10==xself.getLevel()||13==xself.getLevel()){if(xself.cp<=0)return;GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_UI_OPEN,null,GameWorld.NAN_FORCE_GUIDE_TYPE)}},t.checkMissionSubmitGuide=function(t){if(null!=t&&(42==t.getId()&&GameWorld.setGuide(GameWorld.GUIDE_NEW_CITY_OPEN),664==t.getId()&&0==PlayerDataManager.playerData.isSpriteOpen)){guide.setStatusFlag(!0,guide.IS_GUIDE_SPRITE_GUIDE);PlayerDataManager.getPlayerData((function(t){PlayerDataManager.playerData.isSpriteOpen=!0,PlayerDataManager.savePlayerData(PlayerDataManager.playerData),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_1)}),this)}},t.ballGuide=function(){var t=PanelManager.mainMenu.help_btn,e=t.parent.localToGlobal(t.x,t.y);guide.startSpriteBall(e.x+t.width/2,e.y+t.height/2)},t.checkAutopathGuide=function(){xself.isNovice&&!AutoGamer.autoGaming&&(GameWorld.guideType!=GameWorld.GUIDE_AUTO_PATH_UI||0!=AutoGamer.autoGaming)&&GameWorld.useGuide&&PanelManager.mainMenu.getIsInit()&&GameWorld.setGuide(GameWorld.GUIDE_AUTO_PATH_UI,null,GameWorld.NAN_FORCE_GUIDE_TYPE)},t.setGuideWidgetVisible=function(t){if(GameWorld.guideType!=GameWorld.GUIDE_NONE&&GameWorld.bigGuideType!=GameWorld.FORCE_GUIDE_TYPE)if(t){if(PanelManager.isOpeningFullScene)return;guide.arrow&&!guide.arrow.visible&&(guide.arrow.visible=!0),GameWorld.guideFrame&&!GameWorld.guideFrame.visible&&(GameWorld.guideFrame.visible=!0)}else guide.arrow&&guide.arrow.visible&&(guide.arrow.visible=!1),GameWorld.guideFrame&&GameWorld.guideFrame.visible&&(GameWorld.guideFrame.visible=!1)},t}();__reflect(GuideHandler.prototype,"GuideHandler");var MountGuide=function(){function t(){this.itemslotPos=-1,this.itemid=-1,this.vItemList=null}return t.doGetMountGuideItemList=function(e){if(null!=e){var n=new nato.Message(ProtocolDefine.CG_GET_RIDE);n.putShort(e.slotPos),n.putInt(e.id),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=n.getByte(),o=new t;o.itemid=e.id,o.itemslotPos=e.slotPos,o.vItemList=[];for(var a=0;i>a;a++){var r=new ItemData;ItemData.fromBytesAtts2(r,n),r.durability=r.durMax,o.vItemList.push(r)}PanelManager.openPetSelectPanel(PetSelectPanel.Type_mount,o)}}),this),PanelManager.openWaitForServer()}},t.doMountGuideSelect=function(t,e,n){if(0!=SafeLock.doSafeLockVerify()){if(null!=xself){var i=xself.bag;if(null!=i){var o=new nato.Message(ProtocolDefine.CG_USE_NEW_GET_RIDE);o.putShort(t),o.putInt(e),o.putInt(n),nato.Network.sendCmd(o,(function(e){if(PanelManager.closeWaitForServer(),0>e.getByte())AlertPanel.alertCommon(e.getString());else{i.removeBagItemByPos(t,1);var n=MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD);AlertPanel.alertCommon(n),PanelManager.closeScene(!0),e.getBoolean()&&MenuEventHandler.doMenuButton(MenuEventHandler.EVENT_ALL_MENU_SYSTEM_REFLASH)}}),this),PanelManager.openWaitForServer()}}}},t}();__reflect(MountGuide.prototype,"MountGuide");var PetGuide=function(){function t(){this.itemslotPos=-1,this.itemid=0,this.vPetList=null}return t.doPetGuideList=function(e){if(null!=e){var n=new nato.Message(ProtocolDefine.CG_GET_PET);n.putShort(e.slotPos),n.putInt(e.id),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=n.getByte(),o=new t;o.itemslotPos=e.slotPos,o.itemid=e.id,o.vPetList=new Array;for(var a=0;i>a;a++){var r=new MyPet(null);r.setId(n.getInt()),r.setName(n.getString()),r.setLevel(n.getInt()),r.setJob(n.getInt()),r.compre=n.getInt(),r.grow=n.getInt(),r.setIcon1(n.getInt()),r.grade=n.getByte(),o.vPetList.push(r)}PanelManager.openPetSelectPanel(PetSelectPanel.Type_pet,o)}}),this),PanelManager.openWaitForServer()}},t.doPetGuideSelect=function(t,e,n){if(0!=SafeLock.doSafeLockVerify()){if(null!=xself){var i=xself.bag;if(null!=i){var o=new nato.Message(ProtocolDefine.CG_USE_NEW_GET_PET);o.putShort(t),o.putInt(e),o.putInt(n),nato.Network.sendCmd(o,(function(e){if(PanelManager.closeWaitForServer(),0>e.getByte())AlertPanel.alertCommon(e.getString());else{i.removeBagItemByPos(t,1);var n=MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD);AlertPanel.alertCommon(n),PanelManager.closeScene(!0),e.getBoolean()&&MenuEventHandler.doMenuButton(MenuEventHandler.EVENT_ALL_MENU_SYSTEM_REFLASH),1==GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_BAG_PARTNER_GET)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_BAG_PARTNER_GET),GameWorld.setGuide(GameWorld.GUIDE_BAG_PET_PARTNER_END))}}),this),PanelManager.openWaitForServer()}}}},t}();__reflect(PetGuide.prototype,"PetGuide");var SpriteGuide=function(){function t(){this.type=0,this.guidetype=0,this.repairitemslotpos=0,this.missionID=0,this.acceptmissionID=0,this.acceptmapid=0,this.acceptnpcid=0,this.equipslotpos=0,this.skillmapid=0,this.skillnpcid=0,this.strategysize=0,this.serviceEmailNum=0,this.serviceEmailSumNum=0,this.facetype=0,this.chapterId=0,this.partId=0}return t.doSpriteGuide=function(e,n,i,o){if(void 0===i&&(i=null),void 0===o&&(o=null),null!=xself){var a=function(){null!=i&&null!=o&&i.call(o)};if(0==t.isSpriteGuideReach())return void a();var r=n;null==r&&(r=new t);var s=0;null!=n&&(s=n.guidetype);var l=new nato.Message(ProtocolDefine.CG_SYSTEM_GUIDE);l.putByte(e),l.putByte(s),nato.Network.sendCmd(l,(function(i){if(0>i.getByte())return AlertPanel.alertCommon(i.getString()),void a();if(e==t.SPRITE_GUIDE_TYPE2){var o=i.getByte();switch(r.guidetype=o,o){case t.GUIDE_REPAIR_EQUIP:r.repairitemslotpos=i.getInt();break;case t.GUIDE_TASK_PROCEED:r.missionID=i.getShort();break;case t.GUIDE_TASK_ACCEPT:r.acceptmissionID=i.getShort(),r.acceptmapid=i.getInt(),r.acceptnpcid=i.getInt();break;case t.GUIDE_BAG_EQUIP:r.equipslotpos=i.getInt();break;case t.GUIDE_PET_DIE:i.getInt();break;case t.GUIDE_MAIL:case t.GUIDE_ADDATTRIBUTE:break;case t.GUIDE_LEARN_SKILL:r.skillmapid=i.getInt(),r.skillnpcid=i.getInt();break;case t.GUIDE_AUTO_ACTIVE:i.getInt();break;case t.GUIDE_COUNTRY_LIST:break;case t.GUIDE_PET_EVOLVE:return void t.openSpriteGuide();case t.GUIDE_VITALITY:break;case t.GUIDE_MILESTONE:r.chapterId=i.getByte(),r.partId=i.getShort()}var s=i.getString(),l=i.getString();r.hasguidetype=i.getBoolean(),r.hasStrategy=i.getBoolean(),r.serviceEmailNum=i.getInt(),r.serviceEmailSumNum=i.getInt(),r.facetype=i.getByte();var _,h=[];if(r.hasguidetype&&(_=new NPCActionData(l,11,r.guidetype),h.push(_),_=new NPCActionData(GameText.STR_SPRITE_GUIDE_OTHER,11,t.GUIDE_SEE_OTHER),h.push(_)),r.hasStrategy&&(_=new NPCActionData(GameText.STR_SPRITE_GUIDE_STRATEGY,11,t.GUIDE_STRATEGY),h.push(_)),_=new NPCActionData("VIP特权",11,t.GUIDE_VIP),h.push(_),_=new NPCActionData(GameText.STR_SPRITE_GUIDE_EMAIL,11,t.GUIDE_SERVICE_EMAIL),h.push(_),Tool.isBit(GameWorld.IS_ACCOST,GameWorld.loginSetting)){var u=GameText2.STR_CHAT_UP;GameWorld.isShowSrpiteGuideGlint()&&(u+=GameText2.STR_CHAT_NEW),_=new NPCActionData(u,11,t.GUIDE_CHAT_UP),h.push(_)}PanelManager.openNPCDialogue(GameText.STR_SPRITE_GUIDE,s,h,null,null,null),PanelManager.npcDialogue&&PanelManager.npcDialogue.stage&&PanelManager.npcDialogue.showSpriteGuide()}else if(e==t.SPRITE_GUIDE_TYPE3){if(r.strategysize=i.getInt(),r.strategyList=[],r.strategysize>0)for(var c=0;c<r.strategysize;c++){var T=InfoData.fromBytes(i);r.strategyList.push(T)}var p=new InfoData;p.type=InfoData.TYPE_LEAVE,p.prePageID=0,r.strategyList.push(p),PanelManager.openRaidersPanel("攻略指南",n.strategyList)}}),this)}},t.doMenuButton=function(e,n){if(null==e)return!1;var i=xself;if(null==i)return!1;var o=i.bag;if(null==o)return!1;var a=function(){PanelManager.closeNPCDialogue()};switch(n){case t.GUIDE_REPAIR_EQUIP:var r=o.getItem(e.repairitemslotpos);if(null!=r){AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_REPAIR_EQUIP_ASK,(function(){1==ItemManager.doWorldUseItemAction(i,r,!0)&&PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateWorldIconPoint(),a()}),this)}else AlertPanel.alertCommon(GameText.STR_REPAIR_EQUIP_INFO),a();break;case t.GUIDE_TASK_PROCEED:var s=i.getMissionById(e.missionID);null!=s&&NPC.doMissionInfoView(xself,s,null,NPCConst.SUB_MISSION_VIEW);break;case t.GUIDE_TASK_ACCEPT:e.acceptmapid<0||(0==e.acceptmapid?AlertPanel.alertCommon("进入城市可接取任务"):t.doSpriteGuideAutoMove(e.acceptmapid,e.acceptnpcid)),a();break;case t.GUIDE_BAG_EQUIP:PanelManager.openBag(),a();break;case t.GUIDE_PET_DIE:PanelManager.openPetScene();break;case t.GUIDE_MAIL:PanelManager.openMailScene(),a();break;case t.GUIDE_ADDATTRIBUTE:PanelManager.openRoleScene(),a();break;case t.GUIDE_LEARN_SKILL:e.skillmapid<0||(0==e.skillmapid?AlertPanel.alertCommon("进入城市可学习技能"):t.doSpriteGuideAutoMove(e.skillmapid,e.skillnpcid)),a();break;case t.GUIDE_AUTO_ACTIVE:AlertPanel.alertCommon("人物界面技能栏可设置自动技能");break;case t.GUIDE_COUNTRY_LIST:a();break;case t.GUIDE_PET_EVOLVE:AlertPanel.alertCommon("宠物进化尚未实现"),a();break;case t.GUIDE_SEE_OTHER:t.doSpriteGuide(t.SPRITE_GUIDE_TYPE2,e);break;case t.GUIDE_STRATEGY:t.doSpriteGuide(t.SPRITE_GUIDE_TYPE3,e),a();break;case t.GUIDE_SERVICE_EMAIL:e.serviceEmailSumNum>0?PanelManager.openMailListPanel(MailScene.TYPE_READ_FROM_GM,!0):PanelManager.openMailWriteToGMPanel(),a();break;case t.GUIDE_CHAT_UP:ChatUp.doSeeChatUpLists(),a();break;case t.GUIDE_QQ_DIAMOND:break;case t.GUIDE_VIP:AlertPanel.alertCommon("敬请期待！");case t.GUIDE_VITALITY:case t.GUIDE_MILESTONE:}return!0},t.doSpriteGuideAutoMove=function(e,n){PanelManager.closeScene(!0);var i=MsgHandler.createAutoMoveMsg(e,n);nato.Network.sendCmd(i,t.onSpriteGuideAutoMove,this)},t.onSpriteGuideAutoMove=function(t){var e=t.getByte();if(0>e){var n=t.getString();e!=Mission.AUTO_MOVE_ERROR26&&e!=Mission.AUTO_MOVE_ERROR27&&AlertPanel.alertCommon(n)}else xself.fromBytesByAutoMove(t),xworld.setAutoMissionFindPath(!0)},t.doPaintSpriteGuide=function(t,e,n,i){},t.clearSriteGuide=function(){},t.isSpriteGuideReach=function(){return null!=xself},t.doMission=function(){PopUpManager.closeAll();var e=new t;e.guidetype=t.GUIDE_TASK_ACCEPT,t.doSpriteGuide(t.SPRITE_GUIDE_TYPE2,e)},Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.openSpriteGuide=function(){PopUpManager.closeAll(),this.openLocalGuide()},t.openLocalGuide=function(){var t,e=[];t=new NPCActionData("今日还能做的事情",11,1),e.push(t),t=new NPCActionData("游戏攻略",11,2),e.push(t),t=new NPCActionData("道具获得途径",11,6),e.push(t);PanelManager.openNPCDialogue(GameText.STR_SPRITE_GUIDE,"您好！",e,null,null,null),PanelManager.npcDialogue&&PanelManager.npcDialogue.stage&&PanelManager.npcDialogue.showSpriteGuide()},t.doLocalGuide=function(t){var e=function(){PanelManager.closeNPCDialogue()};1==t?(PanelManager.openTodayEventPanel(),e()):2==t?(InfoData.doBrowseGameHelpList(0),e()):3==t?AlertPanel.alertCommon("敬请期待！"):4==t?(PanelManager.openMailWriteToGMPanel(),e()):5==t?(ChatUp.doSeeChatUpLists(),e()):6==t?(e(),ItemGet.openItemGet()):7==t&&(e(),(new CommonNpcPanel).show(PopUpManager.EffectType.NONE,PopUpManager.CloseType.NONE))},t.IMG_SET_SPRITEGUIDE=209,t.SPRITE_GUIDE_TYPE2=2,t.SPRITE_GUIDE_TYPE3=3,t.GUIDE_REPAIR_EQUIP=1,t.GUIDE_TASK_PROCEED=6,t.GUIDE_TASK_ACCEPT=7,t.GUIDE_BAG_EQUIP=2,t.GUIDE_PET_DIE=5,t.GUIDE_MAIL=9,t.GUIDE_ADDATTRIBUTE=4,t.GUIDE_LEARN_SKILL=8,t.GUIDE_AUTO_ACTIVE=3,t.GUIDE_COUNTRY_LIST=10,t.GUIDE_PET_EVOLVE=11,t.GUIDE_VITALITY=12,t.GUIDE_MILESTONE=13,t.GUIDE_SEE_OTHER=1e3,t.GUIDE_STRATEGY=1001,t.GUIDE_SERVICE_EMAIL=1002,t.GUIDE_CHAT_UP=1003,t.GUIDE_QQ_DIAMOND=1004,t.GUIDE_VIP=1005,t.SPRITE_GUIDE_SHOW_LEVEL=15,t.HELPER_PHIZ=0,t.HELPER_PHIZ_SAD=1,t.HELPER_PHIZ_ANGRY=2,t.HELPER_PHIZ_NONE=3,t.HELPER_PHIZ_HAPPY=4,t.HELPER_PHIZ_WELFARE=5,t}();__reflect(SpriteGuide.prototype,"SpriteGuide");var GameImage=function(){function t(t,e){}return t.prototype.getPalID=function(){return-1},t.prototype.getImage=function(){return null},t.color={},t}();__reflect(GameImage.prototype,"GameImage");var ImageSet=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t._instance=new t,t.IMG_SET_SMALL_MAP=4,t.IMG_SET_BATTLE_BUFF=10,t.IMG_SET_NUMBER_BATTLE_DMG=2e3,t.IMG_SET_NUMBER_BATTLE_ADD=2001,t.IMG_SET_NUMBER_BATTLE_MP=2002,t.IMG_SET_NUMBER_BATTLE_CRITICAL=2003,t.IMG_SET_NUMBER_BATTLE_MAGICDEF=2005,t.IMG_SET_NUMBER_PLATFORM_CODE=2008,t.IMG_SET_BATTLE_BLOCK=3001,t.IMG_SET_BATTLE_RESULT_LOST=3002,t.IMG_SET_BATTLE_CRIT_EFF=3003,t.IMG_SET_BATTLE_RESULT_WIN=3004,t.IMG_SET_BATTLE_MISS=3007,t.IMG_SET_BATTLE_OFFSET=3008,t.IMG_SET_BATTLE_OK=3009,t.IMG_ARROW=3006,t}();__reflect(ImageSet.prototype,"ImageSet");var BattleItemView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(t){PanelManager.closeBattleItemView()},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},enumerable:!0,configurable:!0}),e.prototype.show=function(t){this._itemData=t},e.prototype.update=function(){if(this.clearView(),this._itemData){this.container.add(this.itemIcon,5*xhdRatio,5*xhdRatio),this.itemIcon.setData(this._itemData.bagIcon,this._itemData.grade);var t=(ColorUtils.getGradeColor(this._itemData.grade),Tool.convertDescToTextFlow(this._itemData.getDesc(xself,!1,!1))),e="";null!=this._itemData.price&&this._itemData.price>0?(t.unshift(TextFieldUtils.getTextFlowElement(this._itemData.price+"\n")),this.copper_img.visible=!0):(t.unshift(TextFieldUtils.getTextFlowElement("\n")),this.copper_img.visible=!1),e=TextFieldUtils.getSpaceByWidth(22*xhdRatio,this.desc_label.size,this.desc_label.fontFamily),t.unshift(TextFieldUtils.getTextFlowElement("x"+this._itemData.quantity+e));var n=Tool.convertDescToTextFlow(this._itemData.getNameInfo());if(n&&n.length>0)for(var i=n.length-1;i>=0;i--)t.unshift(n[i]);e=TextFieldUtils.getSpaceByWidth(35*xhdRatio,this.desc_label.size,this.desc_label.fontFamily),t.unshift(TextFieldUtils.getTextFlowElement(e)),this.desc_label.textColor=ColorUtils.COLOR_TEXT_GOLD,this.desc_label.textFlow=t;var o=this._itemData.getNameInfo()+"x"+this._itemData.quantity,a=TextFieldUtils.getTextWidth(o,this.desc_label.size,this.desc_label.fontFamily);this.container.add(this.copper_img,a+43*xhdRatio,20*xhdRatio),this.desc_label.height=this.desc_label.textHeight,this.container.add(this.desc_label,7*xhdRatio,23*xhdRatio);var r=this.container.totalHeight;this.container.updateAutoSize(r,300*xhdRatio);var s=this.container.y+this.container.height+5*xhdRatio;this.height=s+11*xhdRatio}},e.prototype.clearView=function(){this.init&&(this.container.reset(),Tool.removeObjSafe(this.itemIcon),Tool.removeObjSafe(this.itemIcon2),Tool.removeObjSafe(this.copper_img),Tool.removeObjSafe(this.desc_label))},e}(ComponentBase);__reflect(BattleItemView.prototype,"BattleItemView");var Item=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e._isMask=!1,e._isNew=!1,e._isStronger=!1,e._isEquiped=!1,e._isLock=!1,e.touchChildren=!1,e.cacheAsBitmap=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._itemData=null,this.resetView()},e.prototype.resetView=function(){this.init&&(this.itemColorBg_img.source="",this.icon_img.source="",this.count_label.text="",this.select=!1,this.isNew=!1,this.isStronger=!1,this.isEquiped=!1,this.isLock=!1,this.isMask=!1)},e.prototype.update=function(){if(this.init){if(!this._itemData)return void this.resetView();this._itemData.isMoney?(this.itemColorBg_img.source=null,null!=this.itemData.quantity&&this.itemData.quantity>0?this.count_label.text=""+this.itemData.quantity:this.count_label.text="",this.icon_img.source=GameText.getMoneyResourceByItemMoneyType(this._itemData.moneyType),this.icon_img.scaleX=this.icon_img.scaleY=.75*xhdRatio):(this.itemColorBg_img.source=xitem.getItemColorTexture(this.itemData.grade),this.icon_img.source=xitem.getItemIcon(this.itemData.bagIcon),this.icon_img.scaleX=this.icon_img.scaleY=1*xhdRatio,this.itemData.isCanEquip()?this.count_label.text="":null!=this.itemData.quantity&&this.itemData.quantity>0?this.count_label.text=""+this.itemData.quantity:this.count_label.text=""),this.select=this._select,this.isNew=this._isNew,this.isStronger=this._isStronger,this.isEquiped=this._isEquiped,this.isLock=this._isLock,this.isMask=this._isMask}},Object.defineProperty(e.prototype,"id",{get:function(){return this._itemData?this._itemData.id:0},set:function(t){this._itemData?(this._itemData.clearData(),this._itemData.id=t):(this._itemData=new ItemData,this._itemData.id=t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){if(this._select=t,this.bg){var e=xhd?"_hd":"_sd";this.bg.source=this._select?"item_select"+e:"item_bg"+e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMask",{get:function(){return this._isMask},set:function(t){this._isMask=t,this.img_mask&&(t?this.addChild(this.img_mask):this.img_mask.parent&&this.img_mask.parent.removeChild(this.img_mask))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},set:function(t){this._isNew=t,this.img_newSign&&(t?this.addChild(this.img_newSign):this.img_newSign.parent&&this.img_newSign.parent.removeChild(this.img_newSign))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStronger",{get:function(){return this._isStronger},set:function(t){this._isStronger=t,this.img_strongerSign&&(this._isStronger?this.addChild(this.img_strongerSign):this.img_strongerSign.parent&&this.img_strongerSign.parent.removeChild(this.img_strongerSign))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEquiped",{get:function(){return this._isEquiped},set:function(t){this._isEquiped=t,this.img_equiped&&(this._isEquiped?this.addChild(this.img_equiped):this.img_equiped.parent&&this.img_equiped.parent.removeChild(this.img_equiped))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLock",{get:function(){return this._isLock},set:function(t){this._isLock=t,this.img_lock&&(this._isLock?this.addChild(this.img_lock):this.img_lock.parent&&this.img_lock.parent.removeChild(this.img_lock))},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(Item.prototype,"Item");var Item2=function(t){function e(){var e=t.call(this)||this;return e._grade=0,e._bagIcon=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n){this._bagIcon=t,this._grade=e,this._nameInfo=n,this.update()},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this._itemData?(this._bagIcon=this._itemData.bagIcon,this._grade=this._itemData.grade,this._nameInfo=this._itemData.getNameInfo()):(this._bagIcon=0,this._grade=0,this._nameInfo=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemSimpleData",{get:function(){return this._itemSimpleData},set:function(t){this._itemSimpleData=t,this._itemSimpleData?(this._bagIcon=this._itemSimpleData.bagIcon,this._grade=this._itemSimpleData.grade,this._nameInfo=this._itemSimpleData.nameInfo):(this._bagIcon=0,this._grade=0,this._nameInfo=null)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.itemIcon.source=null,this.label_name.text="")},e.prototype.update=function(){this.init&&(this.reset(),this._bagIcon>0&&(this.itemColor_bg.source=xitem.getItemColorTexture(this._grade),this.itemIcon.source=xitem.getItemIcon(this._bagIcon),this.label_name.textFlow=Tool.convertDescToTextFlow(this._nameInfo)))},e.getItem2=function(){var t;return e._pool.length>0?t=e._pool.shift():(t=new e,nato.attachSkin(t),t.height=18*xhdRatio),t},e.returnItem2=function(t){t&&e._pool.push(t)},e.clearPool=function(){e._pool=[]},e._pool=[],e}(ComponentBase);__reflect(Item2.prototype,"Item2");var Item3=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this.stage&&this.update()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.itemColorBg_img.source=null,this.icon_img.source=null,this.label_name.text="",this.count_label.text="")},e.prototype.update=function(){if(this.init){if(null==this._itemData)return void this.reset();this._itemData.isMoney?(this.itemColorBg_img.source=null,this.icon_img.source=GameText.getMoneyResourceByItemMoneyType(this._itemData.moneyType),this.icon_img.scaleX=this.icon_img.scaleY=.75*xhdRatio,this.count_label.text="",this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()+" "+this._itemData.quantity)):(this.itemColorBg_img.source=xitem.getItemColorTexture(this._itemData.grade),this.icon_img.source=xitem.getItemIcon(this._itemData.bagIcon),this.icon_img.scaleX=this.icon_img.scaleY=1*xhdRatio,this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()),this._itemData.quantity>1?this.count_label.text=""+this._itemData.quantity:this.count_label.text="");var t=new eui.Label;t.text=this._itemData.getNameInfo(),t.width>192*xhdRatio?this.label_name.maxWidth=60*xhdRatio:this.label_name.maxWidth=48*xhdRatio}},e}(ComponentBase);__reflect(Item3.prototype,"Item3");var ItemConst,Item4=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this.stage&&this.update()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.itemColorBg_img.source=null,this.icon_img.source=null,this.label_name.text="",this.count_label.text="")},e.prototype.update=function(){if(this.init){if(null==this._itemData)return void this.reset();this._itemData.isMoney?(this.itemColorBg_img.source=null,this.icon_img.source=GameText.getMoneyResourceByItemMoneyType(this._itemData.moneyType),this.icon_img.scaleX=this.icon_img.scaleY=.75*xhdRatio,this.count_label.text="",this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()+" "+this._itemData.quantity)):(this.itemColorBg_img.source=xitem.getItemColorTexture(this._itemData.grade),this.icon_img.source=xitem.getItemIcon(this._itemData.bagIcon),this.icon_img.scaleX=this.icon_img.scaleY=1*xhdRatio,this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()),this._itemData.quantity>1?this.count_label.text=""+this._itemData.quantity:this.count_label.text="");var t=new eui.Label;t.text=this._itemData.getNameInfo(),t.width>192*xhdRatio?this.label_name.width=60*xhdRatio:this.label_name.width=55*xhdRatio}},e}(ComponentBase);__reflect(Item4.prototype,"Item4"),function(t){t.WEAPON_FLASH_GEM_NUM=7,t.BAG_ICON_VIP=39}(ItemConst||(ItemConst={}));var SdkYijie=function(t){function e(){var n=t.call(this)||this;return e._instance=n,n}return __extends(e,t),e.prototype.openLogin=function(){if(!Tool.isNullText(native.loginParams)){var t=native.loginParams.split("#"),e={app:t[0],sdk:t[1],uin:t[2],sess:t[3]};Sdk.channelLogin(e)}},e.prototype.statistic=function(t){if(null!=xself){var e=t+"#"+xself.getId()+"#"+xself.getName()+"#"+xself.getLevel()+"#"+ServerInfo.currentSelectServerInfo.id+"#"+ServerInfo.currentSelectServerInfo.name+"#"+xself.money1+"#"+xself.vipLevel+"#"+(Tool.isNullText(xself.getCountryName())?"无帮派":xself.getCountryName())+"#";egret.ExternalInterface.call("reportInfo",e)}else console.log("xself信息为空")},e.prototype.logout=function(t){egret.ExternalInterface.addCallback("jsLogout",(function(e){Sdk.logout(t)})),egret.ExternalInterface.call("nativeLogout","js logout")},e.prototype.pay=function(t,e,n,i,o,a){var r=n+"#"+e+"#"+i;egret.ExternalInterface.call("payToNative",r)},e}(NoneSdk);__reflect(SdkYijie.prototype,"SdkYijie");var ItemDescView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),this._itemData=null},e.prototype.onClose=function(){PanelManager.closeItemDescView()},e.prototype.setData=function(t){this._itemData=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this.label_title.text="",this.label_content.text="")},e.prototype.update=function(){if(this.init){if(null==this._itemData)return void this.reset();var t=!1;if(this._itemData.isWeapon())t=!0;else switch(this._itemData.type){case Define.ITEM_TYPE_ARMOR_FASHION:case Define.ITEM_TYPE_ARMOR_TRANSPORT:case Define.ITEM_TYPE_ARMOR_BACK:case Define.ITEM_TYPE_ARMOR_TROUSERS:case Define.ITEM_TYPE_ARMOR_CLOTHES:t=!0}this.label_title.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()),this.group_role.removeChildren(),t?(this.label_content.width=145*xhdRatio,this._model=Player.getCompareSprite(xself,this._itemData),this._model.setScale(xhd?1.5:1),this.group_role.addChild(this._model)):this.label_content.width=225*xhdRatio,this.label_content.textAlign=t?"left":"center",this.label_content.textFlow=Tool.convertDescToTextFlow(this._itemData.getDesc(xself)),this.label_content.height=this.label_content.textHeight+5*xhdRatio,this.label_content.height<50*xhdRatio?(this.label_content.height=50*xhdRatio,this.label_content.verticalAlign="middle"):this.label_content.verticalAlign="top";var e=this.label_content.height+12*xhdRatio;this.container.reset(!0),this.container.add(this.label_content,5*xhdRatio,7*xhdRatio),this.container.updateAutoSize(e,250*xhdRatio),this.bg2.height=this.container.height+5*xhdRatio,this.height=this.bg2.y+this.bg2.height+10*xhdRatio}},e}(ComponentBase);__reflect(ItemDescView.prototype,"ItemDescView");var ItemIcon=function(t){function e(){var e=t.call(this)||this;return e._bagIcon=-1,e._grade=-1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._bagIcon=t,this._grade=e,this.update()},Object.defineProperty(e.prototype,"bagIcon",{get:function(){return this._bagIcon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grade",{get:function(){return this._grade},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(-1!=this._bagIcon&&-1!=this._grade?(this.itemColor_bg.source=xitem.getItemColorTexture(this._grade),this.itemIcon.source=xitem.getItemIcon(this._bagIcon)):(this.itemColor_bg.source=null,this.itemIcon.source=null))},e}(ComponentBase);__reflect(ItemIcon.prototype,"ItemIcon");var ItemManager=function(){function t(){}return t.prototype.getItemColorTexture=function(t){return nato.findTextureForIcon(100+t)},t.prototype.getItemColorTexture2=function(t){return nato.findTextureForIcon(110+t)},t.prototype.getItemIcon=function(t){return nato.findTextureForIcon(t)},t.prototype.getItemNumByIdInBag=function(t){if(xself){var e=xself.bag;if(e)return e.getItemNumByID(t)}return 0},t.prototype.getItemFromMissionBytes=function(t){var e=new ItemData;return e.id=65535&t.readShort(),e.quantity=t.readByte(),e.name=t.readUTF(),e.bagIcon=t.readUnsignedByte(),e.grade=t.readByte(),e},t.getItemStarFontColor=function(t,e){return t>e?ColorUtils.COLOR_RED:e>t?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_GOLD_YELLOW},t.prototype.getMoneyIconSource=function(t){return t==ModelConst.MONEY1?"gold_square"+(xhd?"_hd":"_sd"):t==ModelConst.MONEY2?"gold_leaf"+(xhd?"_hd":"_sd"):t==ModelConst.MONEY3?"gold_coin"+(xhd?"_hd":"_sd"):null},t.getCanEquipListByPos=function(t){var e=xself;if(null==e)return null;var n=e.bag;if(null==n)return null;var i=PlayerBag.getTypeByEquipPos(t);if(null==i||i.length<=0)return null;var o=[];if(1==PlayerBag.isValidWeaponPos(t))for(var a=0;a<i.length;a++){var r=i[a];if(null!=r){var s=r;n.isSameWeaponType(s)<0||o.push(r)}}else o=i;var l=[];for(a=PlayerBag.BAG_START;a<=n.bagEnd;a++){var _=n.store[a];if(null!=_&&!_.isNotOperate())for(var h=0;h<o.length;h++){var u=o[h];_.type==u&&ItemData.isValidEquipRequire(e,_)==Define.OK&&l.push(_)}}return l},t.doBagRefresh=function(t){if(void 0===t&&(t=!1),xself.isShopMode())AlertPanel.alertCommon(GameText.STR_SHOP_REFRESH_BAG);else{var e=MsgHandler.createBagRefreshMsg();nato.Network.sendCmd(e,null,null),t||PanelManager.openWaitForServer()}},t.doStorageRefresh=function(e){var n=xself;if(null==n||null==n.bag)return!1;var i=(n.bag,e);n.bag.clearStorageItem();var o=new nato.Message(ProtocolDefine.CG_STORAGE_CLEAN);return o.putByte(i),nato.Network.sendCmd(o,(function(i){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(i)){e==t.STORAGETYPE2&&n.bag.clearVipStorageItem();for(var o=i.getByte(),a=[],r=0;o>r;r++)a.push(ItemData.fromBytes(i));n.bag.initBagItem(a),GameWorld.doGetItemSuit(n.bag.getAllEquip()),PanelManager.isPanelShow(StorePanel)&&PanelManager.getPanel(StorePanel).update()}}),this),PanelManager.openWaitForServer(),!0},t.doItem=function(e,n){void 0===n&&(n=!0);var i=xself;if(0!=SafeLock.doSafeLockVerify()&&null!=e){if(e.isIdentifyScrollItem()||e.isHighIdentifyScrollItem())return void PanelManager.openForgeScene(ForgeScene.TAB_INDEX_IDENTIFY);if(e.isUpgradeIdentifyScrollItem())return void PanelManager.openForgeScene(ForgeScene.TAB_INDEX_IDENTIFY);if(e.isUpgradeIntensifyScroll())return void PanelManager.openForgeScene(ForgeScene.TAB_INDEX_UPSTAR);if(e.type==Define.ITEM_TYPE_SKILL_BOOK)return void Skill.doUseLearnSkillItem(e,!1,null,null);if(Define.POWER_NEW_GET_PET==e.power1)return void PetGuide.doPetGuideList(e);if(Define.POWER_NEW_GET_ITEM==e.power1)return void MountGuide.doGetMountGuideItemList(e);if(Define.POWER_ENCHANT_ITEM==e.power1)return void Enchant.doEnchantGetLists(e,!1);if(Define.POWER_FORMATION_BOOK==e.power1)return void Skill.doUseFormationBookItem(e);if(Define.POWER_TURN_MONSTER_CARD==e.power1)return void PlayerTurnMonster.doUseTurnMonsterCard(e);t.doWorldUseItemAction(i,e,n,null,null)&&PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}},t.doWorldUseItemAction=function(e,n,i,o,a){if(void 0===o&&(o=null),void 0===a&&(a=null),null==e||null==n||null==e.bag)return!1;var r=function(){t.doWorldUseItemActionToServer(e,n,i,o,a)};if(Define.isChangeJobItem(n.id))AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_PLAYER_CHANGE_JOB_ASK,PowerString.makeColorString(n.name,ColorUtils.COLOR_RED)),r,this);else if(null!=a&&n.isPetResetItem())AlertPanel.alert(GameText.STR_ITEM_SHOW,Tool.manageString(GameText.STR_PET_ITEM_RESET_ASK,a.getLevel()+""),r,this);else if(n.isChangeSexItem())AlertPanel.alert(GameText.STR_ITEM_SHOW,GameText2.STR_CHANGE_SEX_INFO,r,this);else{if(!(n.isCpPointAddItem()||n.isSpPointAddItem()||n.isProsperityDegreePointAddItem()||n.isSkillPlayerItem()||n.isSkillPetItem()))return t.doWorldUseItemActionToServer(e,n,i,o,a);AlertPanel.alert(GameText.STR_ITEM_SHOW,Tool.manageString(GameText2.STR_USE_ITEM_ASK,PowerString.makeColorString(n.name,ColorUtils.COLOR_WHITE)),r,this)}return!1},t.doWorldUseItemActionToServer=function(e,n,i,o,a){if(void 0===o&&(o=null),void 0===a&&(a=null),null==e)return!1;if(Tool.isAbleToAddHPMP(n)&&(GameWorld.isCountryBossStatus()||GameWorld.isEscortStatus()||GameWorld.isTeamBossStatus()||GameWorld.isCountryWarStatus()))return AlertPanel.alertCommon("当前场景下不能使用"),!1;var r=e.bag;if(null==r)return!1;if(null==n)return!1;if(n.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;var s=new StringBuffer,l=n.slotPos,_=r.getBagItemBySlotPos(l);if(null==_)return!1;var h=ItemData.isValidEquipRequire(e,_);if(h!=Define.OK)return AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),h),!1;if(0==_.isCanUse(1))return AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),GameText.STR_CANNOT_USE_IN_WORD),!1;if(n.isChangeNameItem())return GameWorld.doModifyActorName(!1,l);var u=ProtocolDefine.BAG_NO_WAIT;Define.isChangeJobItem(n.id)?u=ProtocolDefine.BAG_CHANGE_JOB:n.isPetEgg()?u=ProtocolDefine.BAG_USE_PET_EGG:n.isChestItem()?u=ProtocolDefine.BAG_USE_CHEST:n.isCountryBook()?u=ProtocolDefine.BAG_COMMAND_BOOK:n.isOpenStoreItem()?u=ProtocolDefine.BAG_ADD_STORE_NUM:n.isPetAddSkill()?u=ProtocolDefine.BAG_PET_ITEM_ADD_SKILLS:n.isPetAgeItem()?u=ProtocolDefine.BAG_PET_AGE:n.isPetResetItem()?u=ProtocolDefine.BAG_PET_RESET:n.isPetExpItem()?u=ProtocolDefine.BAG_ADD_PET_EXP:n.isPlayerExpItem()?u=ProtocolDefine.BAG_ADD_EXP:n.isRepairItem()?u=ProtocolDefine.BAG_REPAIR:n.isTitleItem()?u=ProtocolDefine.BAG_GET_TITLE:n.isChangeSexItem()?u=ProtocolDefine.BAG_ALERT_SEX:n.isCpPointAddItem()?u=ProtocolDefine.BAG_ADD_CP:n.isSpPointAddItem()?u=ProtocolDefine.BAG_ADD_SP:n.isProsperityDegreePointAddItem()?u=ProtocolDefine.BAG_ADD_PROSPERITY_DEGREE:n.isSkillPlayerItem()?u=ProtocolDefine.BAG_SKILL_SLOT_PALYER:n.isSkillPetItem()?u=ProtocolDefine.BAG_SKILL_SLOT_PET:(n.isTimeItem()||n.isVipItem())&&(u=ProtocolDefine.BAG_WAIT);var c=-1;if(null!=o&&(c=o.slotPos),n.isPetCanUseItem()&&-1==c){if(o=e.bag.getItem(PlayerBag.PET_POS),a=e.getPet(),null==o||null==a)return AlertPanel.alertCommon(GameText.STR_PET_NOT_SET_FIGHT),!1;c=o.slotPos}var T=function(){if(_.usePower(e),PanelManager.getPanel(DrugPanel,!1)&&PanelManager.getPanel(DrugPanel).checkClose(),1==i)if(n.isPetEgg())AlertPanel.alertNotify(GameText.STR_PET_EGG,s.toString());else if(n.isChestItem()){var t=s.toString();Tool.isNullText(t)&&(t=GameText.STR_BOX_NULL),AlertPanel.alertNotify(GameText.STR_OPEN_BOX_GET,t)}else if(n.isRepairItem()){var o=p>0?Tool.manageStringU(GameText.STR_ITEM_USE_SAVE,p+GameText.getMoneyText(ModelConst.MONEY3)):"。";AlertPanel.alertNotify(GameText.STR_REPAIR_EQUIP,Tool.manageStringU(GameText.STR_REPAIR_EQUIP_SUCCESS,o)),PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateWorldIconPoint()}else if(n.isCountryBook())AlertPanel.alertNotify(GameText.STR_USE_SUCCESS,GameText.STR_USE_ITEM_COUNTRY_BOOK);else if(n.isTitleItem())AlertPanel.alertNotify(GameText.STR_USE_SUCCESS,Tool.manageStringU(GameText.STR_USE_ITEM_TITLE_INFO,d));else if(Define.isChangeJobItem(n.id));else{var a=_.getPowerDesc();Tool.isNullText(a)?AlertPanel.alertCommon(GameText.STR_USE_SUCCESS):AlertPanel.alertNotify(GameText.STR_USE_SUCCESS,a)}},p=0,d="",E=MsgHandler.createPlayerBagMessage(u,ProtocolDefine.PLAYERBAG_USE,n,c);if(u==ProtocolDefine.BAG_NO_WAIT){if(r.removeBagItemByPos(l,1)!=Define.SUCCESS)return!1;T(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.closeItemView(),PanelManager.isPanelShow(DrugPanel)&&PanelManager.getPanel(DrugPanel).update(),nato.Network.sendCmd(E,null,null)}else{nato.Network.sendCmd(E,(function(i){PanelManager.closeWaitForServer();var h=i.getByte();if(0>h)GameWorld.doErrorJumpShop(i,h);else{var c=r.removeBagItemByPos(l,1);if(c!=Define.SUCCESS)return!1;switch(u=h){case ProtocolDefine.BAG_GET_TITLE:d=i.getString();break;case ProtocolDefine.BAG_CHANGE_JOB:MsgHandler.instance.processDataPlayerDetail(i,e),e.skillList=MsgHandler.processDataPlayerSkillMsg(i,!0),AlertPanel.alertNotify("转职成功",Tool.manageStringU(GameText.STR_PLAYER_CHANGE_SUCCEE,Define.getJobString(e.getJob())));break;case ProtocolDefine.BAG_ADD_EXP:MsgHandler.instance.processUpLevelMsg(i,e,s);break;case ProtocolDefine.BAG_ADD_PET_EXP:MsgHandler.parsePetReward(i,a,s),ItemData.fromBytesEdit(o,i);break;case ProtocolDefine.BAG_PET_ITEM_ADD_SKILLS:MyPet.doPetAddSkill(e,a,i,r,_,n,o),(A=PanelManager.getPanel(PetDetailScene,!1))&&(A.setData(a),PopUpManager.removePopUp(PanelManager.getPanel(PetEquipDes,!1)));break;case ProtocolDefine.BAG_PET_RESET:var E=MyPet.dogetResetItemInfo(a.grow),g=MyPet.dogetResetItemInfo(a.compre);ItemData.fromBytesEdit(o,i),MyPet.fromBytesDetail(i,a);var S=MyPet.dogetResetItemInfo(a.grow),m=MyPet.dogetResetItemInfo(a.compre),f=r.getItemNumByID(Define.ITEM_ID_PET_RESET),I=Tool.manageString(GameText.STR_PET_RESET_NUM,f+"")+"\n";if(I+=Tool.manageString(GameText.STR_PET_RESET_ITEM_GROW,E+" --\x3e "+S)+"\n",I+=Tool.manageString(GameText.STR_PET_RESET_ITME_COMPRE,g+" --\x3e "+m)+"\n",n.id==Define.ITEM_ID_PET_RESET)MyPet.doPetUseResetItemMenu(e,a,o,I);else if(n.id==Define.ITEM_ID_PET_RESET2){var A;(A=PanelManager.getPanel(PetDetailScene,!1))&&A.setData(a)}break;case ProtocolDefine.BAG_PET_AGE:null!=a&&(a.ageTime=i.getLong().value+(new Date).getTime(),AlertPanel.alertCommon(GameText.STR_PET_RESET_AGE_INFO));break;case ProtocolDefine.BAG_REPAIR:p=PlayerBag.repairEquip(e,-1,!1),xself.checkPower();break;case ProtocolDefine.BAG_COMMAND_BOOK:break;case ProtocolDefine.BAG_ADD_STORE_NUM:e.numStroe=i.getByte();break;case ProtocolDefine.BAG_ALERT_SEX:var y=i.getInt(),R=i.getInt(),P=i.getInt(),C=i.getByte(),M=i.getString();e.setIcon1(y),e.setIcon2(R),e.setIcon3(P),e.setSex(C),e.refreshPlayerAllSprite(),AlertPanel.alertCommon(M);break;case ProtocolDefine.BAG_ADD_CP:var L=i.getShort(),v=i.getString();e.cp=L,AlertPanel.alertCommon(v);break;case ProtocolDefine.BAG_ADD_SP:var O=i.getInt(),N=i.getString();e.sp=O,AlertPanel.alertCommon(N);break;case ProtocolDefine.BAG_ADD_PROSPERITY_DEGREE:var D=(i.getInt(),i.getString());AlertPanel.alertCommon(D);break;case ProtocolDefine.BAG_SKILL_SLOT_PALYER:var B=i.getString();AlertPanel.alertCommon(B);break;case ProtocolDefine.BAG_SKILL_SLOT_PET:var b=i.getString();AlertPanel.alertCommon(b);break;case ProtocolDefine.BAG_USE_PET_EGG:case ProtocolDefine.BAG_USE_CHEST:var x=i.getByte();if(0!=x){var G=i.getShort(),U=i.getInt(),w=r.getItem(G);(null==w||w.id!=U)&&WorldMessage.addSystemChat("checkItem.id != itemID, checkItem.id="+w.id+", -> itemID = "+U),c=r.removeBagItemByPos(G,x),Define.SUCCESS}var F=MsgHandler.processAddItemMsg(i,ProtocolDefine.ADD_ITEM_USE_REWARD);s.append(F),u==ProtocolDefine.BAG_USE_PET_EGG&&t.doQuickEquipPet(e)}T(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.isPanelShow(DrugPanel)&&PanelManager.getPanel(DrugPanel).update()}}),this),PanelManager.openWaitForServer()}return!0},t.doQuickEquipPet=function(e){if(null==e)return!1;var n=e.bag;if(null==n)return!1;if(null!=n.getItem(PlayerBag.PET_POS))return!1;for(var i=null,o=0,a=PlayerBag.BAG_START;a<=n.bagEnd;a++){var r=n.getItem(a);null!=r&&r.type==Define.ITEM_TYPE_PET&&(i=r,o++)}return 1==o&&(t.doEquipAction(e,i),!0)},t.doQuickAddHP=function(e){if(null!=e){if(xworld.inBattle)return void WorldMessage.addPromptMsg("战斗中不能使用快速回血功能");var n=e.get(ModelConst.HP),i=e.get(ModelConst.HPMAX),o=e.get(ModelConst.MP),a=e.get(ModelConst.MPMAX);if(n>=i&&o>=a)return void WorldMessage.addPromptMsg(GameText.STR_QUICK_ADDHP_FULL);var r=PlayerBag.getQuickHPItemVector(xself);if(null==r||r.length<=0)return void WorldMessage.addPromptMsg(GameText.STR_QUICK_ADDHP_NO_ITEM);for(var s=!1,l=new StringBuffer,_=0;_<r.length;_++){var h=r[_];if(null!=h){for(var u=0,c=h.quantity,T=0;c>T;T++){if(0==t.doWorldUseItemAction(xself,h,!1))return;if(u++,(n=e.get(ModelConst.HP))>=i&&(n=e.get(ModelConst.MP))>=a){s=!0;break}}if(1==s)break}}l.append(Tool.manageString(GameText.STR_QUICK_ADDHP_USE,h.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+u)),WorldMessage.addTips(l.toString())}},t.doEquipAction=function(t,e,n,i,o,a){function r(){var i=null;if(-1!=n&&(i=[n]),0>t.bag.equipItem(e.slotPos,i)){var r=GameText.STR_CANNOT_EQUIP_THIS;return e.type==Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&(r+=GameText.STR_EQUIP_THIS_BEFORE),void AlertPanel.alertCommon(r)}r=e.isPetType()?e.getNameInfo()+" 已出战":e.getNameInfo()+" 已装备",WorldMessage.addTips(r),T!=ProtocolDefine.BAG_UN_EQUIP_PET&&t.updateAndRefreshIcon(),t.checkHPMP(),t.checkPower(),PanelManager.closeItemView(),PanelManager.closeWaitForServer(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.getPanel(PetScene,!1)&&PanelManager.getPanel(PetScene).updateTab(),o&&o.call(a)}if(void 0===n&&(n=-1),null!=e&&null!=t){var s=t.bag;if(null!=s){var l=ItemData.isValidEquipRequire(t,e);if(l!=Define.OK)return void AlertPanel.alertCommon(l);if(PlayerBag.isOneHandWeaponType(e.type)||e.type==Define.ITEM_TYPE_ARMOR_RING){var _=PlayerBag.getEquipPosByType(e.type);if(null!=_&&_.length>0){for(var h=!0,u=0;u<_.length;u++){if(null==s.getItem(_[u])){h=!1;break}}if(h){var c=PlayerBag.getCompareEquip(s,e.type);null!=c&&(n=c.slotPos)}}}var T=ProtocolDefine.BAG_NO_WAIT;1==e.isPetType()?T=ProtocolDefine.BAG_EQUIP_PET:0!=e.getItemSetID()||e.isNeedWaitForSkill()?T=ProtocolDefine.BAG_EQUIP:(e.isTimeItem()||e.isVipItem())&&(T=ProtocolDefine.BAG_WAIT);var p=MsgHandler.createPlayerBagMessage(T,ProtocolDefine.PLAYERBAG_EQUIP,e,n);T==ProtocolDefine.BAG_NO_WAIT?(nato.Network.sendCmd(p,null,null),r()):(nato.Network.sendCmd(p,(function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(0>n)AlertPanel.errorMessage(e.getString());else{switch(n){case ProtocolDefine.BAG_EQUIP:t.fromItemSetData(e),t.fromSkillData(e);break;case ProtocolDefine.BAG_EQUIP_PET:var i=t.getPet(),o=t.bag.getItem(PlayerBag.PET_POS);null!=i&&null!=o&&(o.reqLv=i.getLevel());var a=null;null!=i?(MyPet.fromBytesDetail(e,i),a=i):a=MyPet.fromBytesMyPlayer(e,t),null!=a&&a.refreshWorldSprite(),t.setPet(a)}r()}}),this),PanelManager.openWaitForServer())}}},t.doUnEquipAction=function(t,e,n,i,o){function a(){if(0>t.bag.unequipItem(e)){var n=GameText.STR_UNEQUIP_BAG_NULL_ENG;AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n)}else{r!=ProtocolDefine.BAG_UN_EQUIP_PET?(t.updateAndRefreshIcon(),n=e.getNameInfo()+" 已卸下"):n=e.getNameInfo()+" 已休息",WorldMessage.addTips(n),t.checkHPMP(),t.checkPower(),PanelManager.getPanel(PetScene,!1)&&PanelManager.getPanel(PetScene).updateTab(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.closeItemView(),PanelManager.closeWaitForServer(),i&&i.call(o)}}if(null!=t&&null!=t.bag&&null!=t.bag.store&&null!=e&&!e.isNotOperate()){var r=ProtocolDefine.BAG_NO_WAIT;e.isPetType()?r=ProtocolDefine.BAG_UN_EQUIP_PET:e.isNeedWaitForSkill()&&(r=ProtocolDefine.BAG_UN_EQUIP);var s=MsgHandler.createPlayerBagMessage(r,ProtocolDefine.PLAYERBAG_UN_EQUIP,e,-1);r==ProtocolDefine.BAG_NO_WAIT?(nato.Network.sendCmd(s),a()):(nato.Network.sendCmd(s,(function(t){PanelManager.closeWaitForServer();var n=t.getByte();if(0>n)AlertPanel.errorMessage(t.getString());else{var i=n,o=xself,r=o.getPet();switch(i){case ProtocolDefine.BAG_UN_EQUIP_PET:!0,t.getShort(),o.setPet(null),null!=r&&(e.reqLv=r.getLevel());break;case ProtocolDefine.BAG_UN_EQUIP:o.fromSkillData(t)}a()}}),this),PanelManager.openWaitForServer())}},t.doSell=function(t){if(0!=SafeLock.doSafeLockVerify()){var e=xself;if(null!=e&&null!=e.bag){var n=t;if(null!=n){if(n.isNotOperate())return void AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_DEL);var i=n.slotPos;if(1==PlayerBag.isValidEquipPos(i))return void AlertPanel.alertNotify(GameText.STR_VIP_SELL_EQUIP,GameText.STR_VIP_SELL_EQUIP_INFO);var o=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString());else{var e=t.getInt(),i=xself;if(null!=i){i.setMoneyByType(ModelConst.MONEY3,e);var o=GameText.STR_SHOPITEM_SELL_SUCCESS+n.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+n.quantity+Tool.manageStringU(GameText.STR_GET_MONEY3,n.price*n.quantity+"");AlertPanel.alertCommon(o),i.checkHPMP(),PanelManager.closeItemView(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}}},a=Tool.manageStringU(GameText.STR_VIP_SELL_EQUIP_ASK,n.getNameInfo()),r=Tool.convertDescToTextFlow(a);AlertPanel.alertTextFlow(GameText.getText(GameText.TI_WARM_SHOW),r,(function(){if(1==e.bag.removeItem(i)){var t=MsgHandler.createItemShopSell(Define.SHOP_PET_USEITEM_ID,n.id,n.slotPos,n.quantity);nato.Network.sendCmd(t,o,this),PanelManager.openWaitForServer()}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),GameText.STR_VIP_SELL_FAIL)}),null,this)}}}else PanelManager.closeItemView()},t.doDelEquipAction=function(t,e,n,i){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;if(e.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_DEL),!1;var o=e.slotPos;if(1==PlayerBag.isValidEquipPos(o))return e.isPetType()?AlertPanel.alertNotify(GameText.STR_DEL_PET,GameText.STR_PET_DEL_EQUIP):AlertPanel.alertNotify(GameText.STR_DEL_EQUIP,GameText.STR_EQUIP_DEL_EQUIP),!1;var a=function(e){if(PanelManager.closeWaitForServer(),!(0>e.getByte()))return 1!=t.bag.removeItem(o)?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),"丢弃失败"):(t.checkHPMP(),PanelManager.closeItemView(),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.isPanelShow(StorePanel)&&PanelManager.getPanel(StorePanel).update(),PanelManager.getPanel(PetScene,!1)&&PanelManager.getPanel(PetScene).updateTab(),void(n&&n.call(i)));AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),e.getString())},r=function(){var t=ProtocolDefine.BAG_WAIT,n=MsgHandler.createPlayerBagMessage(t,ProtocolDefine.PLAYERBAG_LOSE,e,-1);nato.Network.sendCmd(n,a,this),PanelManager.openWaitForServer()};e.isPetType()?AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_DEL_PET_ASK,e.getNameInfo()),r,this):AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_DEL_EQUIP_ASK,e.getNameInfo()),r,this)},t.doItemStarSelectMenu=function(t){if(null!=t){null!=xself&&null!=xself.bag&&(PanelManager.closeItemView(),PanelManager.openForgeScene(ForgeScene.TAB_INDEX_UPSTAR,t))}},t.doItemTenUpStar=function(e,n){return null==e?null:(this.save_upstar_before_item=e.clone(),this._isTenUpStar=!0,this._tenUpCount=10,this._tenUpSuccessCount=0,void function i(){if(t._isTenUpStar)if(t._tenUpCount>0){var o="10连升星 第"+(10-t._tenUpCount+1)+"次";t.doItemStarMenu(e,t.ITEM_STAR_TYPE2,n,o,i,this)}else{t._tenUpCount=0,t._isTenUpStar=!1,PanelManager.closeWaitForServer();var a=t.getTenUpStarInfo(n);AlertPanel.alertCommon(a)}}())},t.getTenUpStarInfo=function(e){return null==t.save_upstar_before_item||null==t.save_upstar_after_item?null:"本次共进行了/cffcc00"+(10-t._tenUpCount)+"/p次升星，成功了/c00ff00"+t._tenUpSuccessCount+"/p次\n\n"+(e?t.getUpgradeCompareStarInfo(t.save_upstar_before_item,t.save_upstar_after_item):t.getCompareStarInfo(t.save_upstar_before_item,t.save_upstar_after_item))},t.doItemStarMenu=function(e,n,i,o,a,r){if(void 0===o&&(o=null),void 0===a&&(a=null),void 0===r&&(r=null),null!=e){var s=xself;if(null!=s&&null!=s.bag){var l=s.bag;if(n!=t.ITEM_STAR_TYPE2||0!=SafeLock.doSafeLockVerify()){var _;if(i)(_=new nato.Message(ProtocolDefine.CG_ADVANCE_STAR)).putShort(e.slotPos),_.putInt(e.id),_.putByte(n);else(_=new nato.Message(ProtocolDefine.CG_ASCENSION_STAR)).putShort(e.slotPos),_.putInt(e.id),_.putByte(n);nato.Network.sendCmd(_,(function(_){PanelManager.closeWaitForServer();var h=_.getByte();if(0>h){if(-10==h){var u=_.getString(),c=_.getShort();if(t._isTenUpStar&&t._tenUpCount<10){var T=t.getTenUpStarInfo(i);AlertPanel.alertCommon(T)}else AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_ITEM_ENTER_SHOP_ASK,u),(function(){var t=Define.ITEM_ID_STAR_SCROLL;i&&(t=Define.ITEM_ID_UPGRADE_INTENSIFY_SCROLL),xworld.doBrowseShop(c,null,t)}),this)}else{T=_.getString();t._isTenUpStar&&t._tenUpCount<10&&(T+="\n\n",T+=t.getTenUpStarInfo(i)),AlertPanel.alertCommon(T)}t._isTenUpStar=!1}else if(n==t.ITEM_STAR_TYPE2){var p,d=_.getShort(),E=_.getByte();_.getInt(),E>0&&l.removeBagItemByPos(d,E),p=i?"装备/c00ff00进阶升星成功/p！":GameText.STR_ITEM_STAR_SUCCEE;var g=_.getBoolean();g?(i?ItemData.fromItemAscensionUpgradeStarInfo(e,_):ItemData.fromBytesEdit(e,_),null!=e&&s.bag.setItemWithSlot(e,e.slotPos)):p=i?"装备/cff0000进阶升星失败/p！":GameText.STR_ITEM_STAR_FAIL,t._isTenUpStar&&(t.save_upstar_after_item=e,t._tenUpCount--,g&&t._tenUpSuccessCount++),t.save_star_success_info=p,t.doItemStarMenu(e,t.ITEM_STAR_TYPE1,i,o,a,r)}else{var S,m="";_.getBoolean()?i?(S=t.doGetNextUpgradeStarInfo(e,_,n),m=e.ascensionStarRate+"%"):(S=t.doGetNextStarInfo(e,_,n),m=e.ascensionStarRate+"%"):(S=e.getUpStarInfo(),S="已达最大星级\n"),0==Tool.isNullText(t.save_star_success_info)&&(S=t.save_star_success_info+"\n\n"+S,t.save_star_success_info=null);var f=PanelManager.getPanel(ForgeScene,!1);f&&f.stage&&f.upStarPanel.updateFromServer(S,m),null!=a&&null!=r&&a.call(r)}}),this),PanelManager.openWaitForServer(o)}}}},t.doGetNextStarInfo=function(e,n,i){if(null==xself)return"";if(null==xself.bag)return"";var o=(e.getItemClass(),new StringBuffer);i==t.ITEM_STAR_TYPE3&&o.append(GameText.STR_ITEM_STAR_BIND);var a=n.getByte(),r=n.getByte();e.ascensionStarRate=r;var s=n.getShort(),l=n.getShort(),_=n.getShort(),h=n.getShort(),u=n.getShort(),c=n.getShort(),T=n.getShort(),p=n.getShort();if(i==t.ITEM_STAR_TYPE1?o.append(Tool.manageStringList("升星：\n%U --\x3e %U \n",[Tool.getStarInfo(e.star,e.ascensionStar),Tool.getStarInfo(a,e.ascensionStar)])):i==t.ITEM_STAR_TYPE3&&(o.append(GameText.STR_ITEM_STAR_CHANGE),o.append(GameText.getText(GameText.TI_ACTIVATE)+": "+Tool.getStarInfo(a,e.ascensionStar)+"\n")),n.getBoolean()){var d=n.getShort(),E=n.getShort();0!=E&&o.append(Tool.manageStringList(GameText.STR_ITEM_STAR_ATK,[e.atkMin+"~"+e.atkMax,PowerString.makeColorString(d+"~"+E,t.getItemStarFontColor(e.atkMax,E))])),i==t.ITEM_STAR_TYPE3&&(e.atkMin=d,e.atkMax=E)}if(0!=s&&o.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_STR,[e.def_str+"",PowerString.makeColorString(s+"",t.getItemStarFontColor(e.def_str,s))])),0!=l&&o.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_AGI,[e.def_agi+"",PowerString.makeColorString(l+"",t.getItemStarFontColor(e.def_agi,l))])),0!=_&&o.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_MAG,[e.def_mag+"",PowerString.makeColorString(_+"",t.getItemStarFontColor(e.def_mag,_))])),0!=h&&0!=e.power1&&e.isAscension(e.power1)){var g=ItemData.getpowerValueAdd(e.powerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power1));o.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power1,g),PowerString.makeColorString(h+Define.getPercentSign(e.power1),t.getItemStarFontColor(g,h))]))}if(0!=u&&0!=e.power2&&e.isAscension(e.power2)){var S=ItemData.getpowerValueAdd(e.powerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power2));o.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power2,S),PowerString.makeColorString(u+Define.getPercentSign(e.power2),t.getItemStarFontColor(S,u))]))}if(0!=c&&0!=e.power3&&e.isAscension(e.power3)){var m=ItemData.getpowerValueAdd(e.powerValue3,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power3));o.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power3,m),PowerString.makeColorString(c+Define.getPercentSign(e.power3),t.getItemStarFontColor(m,c))]))}if(0!=T&&0!=e.bindPower1&&e.isAscension(e.bindPower1)){var f=ItemData.getpowerValueAdd(e.bindPowerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower1));o.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.bindPower1,f),PowerString.makeColorString(T+Define.getPercentSign(e.bindPower1),t.getItemStarFontColor(f,T))]))}if(0!=p&&0!=e.bindPower2&&e.isAscension(e.bindPower2)){var I=ItemData.getpowerValueAdd(e.bindPowerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower2));o.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.bindPower2,I),PowerString.makeColorString(p+Define.getPercentSign(e.bindPower2),t.getItemStarFontColor(I,p))]))}return i==t.ITEM_STAR_TYPE3&&(e.star=a,e.def_str=s,e.def_agi=l,e.def_mag=_),n.getShort(),n.getShort(),n.getShort(),n.getShort(),e.upgradeAscensionStar=n.getByte(),e.upgradeStar=n.getByte(),o.toString()},t.doGetNextUpgradeStarInfo=function(e,n,i){if(null==e||null==n)return"";if(null==xself)return"";var o=xself.bag;if(null==o)return"";var a=(e.getItemClass(),new StringBuffer);i==t.ITEM_STAR_TYPE3&&a.append(GameText.STR_ITEM_STAR_BIND),a.append(e.getRewardDesc()+"\n");var r=(n.getByte(),n.getByte());if(e.ascensionStarRate=r,n.getShort(),n.getShort(),n.getShort(),n.getShort(),n.getShort(),n.getShort(),n.getShort(),n.getShort(),n.getBoolean()){var s=n.getShort(),l=n.getShort();0!=l&&a.append(Tool.manageStringList(GameText.STR_ITEM_STAR_ATK,[e.atkMin+"~"+e.atkMax,PowerString.makeColorString(s+"~"+l,t.getItemStarFontColor(e.atkMax,l))])),i==t.ITEM_STAR_TYPE3&&(e.atkMin=s,e.atkMax=l,null!=e&&o.setItemWithSlot(e,e.slotPos))}var _=n.getShort(),h=n.getShort(),u=n.getShort(),c=n.getShort();e.upgradeAscensionStar=n.getByte(),e.upgradeStar=n.getByte(),i==t.ITEM_STAR_TYPE3&&(e.powerValue4=_,e.powerValue5=h,e.powerValue6=u,e.powerValue7=c);var T;if(T=e.upgradeStar+1,i==t.ITEM_STAR_TYPE1){var p=4177151;a.append(Tool.manageStringList(GameText2.STR_ITEM_UPGRADESTAR_NUM,[PowerString.makeColorString(Tool.getStarInfo(e.upgradeStar,e.upgradeAscensionStar)+"",p),PowerString.makeColorString(Tool.getStarInfo(T,e.upgradeAscensionStar)+"",p)]))}else i==t.ITEM_STAR_TYPE3&&(a.append(GameText.STR_ITEM_STAR_CHANGE),a.append(GameText.getText(GameText.TI_ACTIVATE)+": "+Tool.getStarInfo(e.upgradeStar,e.upgradeAscensionStar)+"\n"));if(0!=_&&0!=e.power4&&e.isAscension(e.power4)){var d=ItemData.getpowerValueAdd(e.powerValue4,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power4));a.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power4,d),PowerString.makeColorString(Define.getPowerDesc(e.power4,_),t.getItemStarFontColor(d,_))]))}if(0!=h&&0!=e.power5&&e.isAscension(e.power5)){var E=ItemData.getpowerValueAdd(e.powerValue5,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power5));a.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power5,E),PowerString.makeColorString(Define.getPowerDesc(e.power5,h),t.getItemStarFontColor(E,h))]))}if(0!=u&&0!=e.power6&&e.isAscension(e.power6)){var g=ItemData.getpowerValueAdd(e.powerValue6,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power6));a.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power6,g),PowerString.makeColorString(Define.getPowerDesc(e.power6,u),t.getItemStarFontColor(g,u))]))}if(0!=c&&0!=e.power7&&e.isAscension(e.power7)){var S=ItemData.getpowerValueAdd(e.powerValue7,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power7));a.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power7,S),PowerString.makeColorString(Define.getPowerDesc(e.power7,c),t.getItemStarFontColor(S,c))]))}return a.toString()},t.getCompareStarInfo=function(e,n){if(null==xself)return"";if(null==xself.bag)return"";var i=(e.getItemClass(),new StringBuffer),o=n.star,a=n.def_str,r=n.def_agi,s=n.def_mag,l=ItemData.getpowerValueAdd(n.powerValue1,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power1)),_=ItemData.getpowerValueAdd(n.powerValue2,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power2)),h=ItemData.getpowerValueAdd(n.powerValue3,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power3)),u=ItemData.getpowerValueAdd(n.bindPowerValue1,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.bindPower1)),c=ItemData.getpowerValueAdd(n.bindPowerValue2,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.bindPower2));if(i.append(Tool.manageStringList("升星：\n%U --\x3e %U \n",[Tool.getStarInfo(e.star,e.ascensionStar),Tool.getStarInfo(o,e.ascensionStar)])),n.isWeapon()){var T=n.atkMin,p=n.atkMax;0!=p&&i.append(Tool.manageStringList(GameText.STR_ITEM_STAR_ATK,[e.atkMin+"~"+e.atkMax,PowerString.makeColorString(T+"~"+p,t.getItemStarFontColor(e.atkMax,p))]))}if(0!=a&&i.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_STR,[e.def_str+"",PowerString.makeColorString(a+"",t.getItemStarFontColor(e.def_str,a))])),0!=r&&i.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_AGI,[e.def_agi+"",PowerString.makeColorString(r+"",t.getItemStarFontColor(e.def_agi,r))])),0!=s&&i.append(Tool.manageStringList(GameText.STR_ITEM_STAR_DEF_MAG,[e.def_mag+"",PowerString.makeColorString(s+"",t.getItemStarFontColor(e.def_mag,s))])),0!=l&&0!=e.power1&&e.isAscension(e.power1)){var d=ItemData.getpowerValueAdd(e.powerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power1));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power1,d),PowerString.makeColorString(l+Define.getPercentSign(e.power1),t.getItemStarFontColor(d,l))]))}if(0!=_&&0!=e.power2&&e.isAscension(e.power2)){var E=ItemData.getpowerValueAdd(e.powerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power2));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power2,E),PowerString.makeColorString(_+Define.getPercentSign(e.power2),t.getItemStarFontColor(E,_))]))}if(0!=h&&0!=e.power3&&e.isAscension(e.power3)){var g=ItemData.getpowerValueAdd(e.powerValue3,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.power3));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power3,g),PowerString.makeColorString(h+Define.getPercentSign(e.power3),t.getItemStarFontColor(g,h))]))}if(0!=u&&0!=e.bindPower1&&e.isAscension(e.bindPower1)){var S=ItemData.getpowerValueAdd(e.bindPowerValue1,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower1));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.bindPower1,S),PowerString.makeColorString(u+Define.getPercentSign(e.bindPower1),t.getItemStarFontColor(S,u))]))}if(0!=c&&0!=e.bindPower2&&e.isAscension(e.bindPower2)){var m=ItemData.getpowerValueAdd(e.bindPowerValue2,e.ascensionStar,e.star,e.isBinded(),e.isAscension(e.bindPower2));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.bindPower2,m),PowerString.makeColorString(c+Define.getPercentSign(e.bindPower2),t.getItemStarFontColor(m,c))]))}var f=ItemData.getpowerValueAdd(n.powerValue4,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power4)),I=ItemData.getpowerValueAdd(n.powerValue5,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power5)),A=ItemData.getpowerValueAdd(n.powerValue6,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power6)),y=ItemData.getpowerValueAdd(n.powerValue7,n.ascensionStar,n.star,n.isBinded(),n.isAscension(n.power7));if(n.upgradeAscensionStar,n.upgradeStar,0!=f&&0!=e.power4&&e.isAscension(e.power4)){var R=ItemData.getpowerValueAdd(e.powerValue4,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power4));i.append(Tool.manageStringList(GameText2.STR_ITEM_STAR_POWERVALUE4,[Define.getPowerDesc(e.power4,R),PowerString.makeColorString(Define.getPowerDesc(e.power4,f),t.getItemStarFontColor(R,f))]))}if(0!=I&&0!=e.power5&&e.isAscension(e.power5)){var P=ItemData.getpowerValueAdd(e.powerValue5,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power5));i.append(Tool.manageStringList(GameText2.STR_ITEM_STAR_POWERVALUE5,[Define.getPowerDesc(e.power5,P),PowerString.makeColorString(Define.getPowerDesc(e.power5,I),t.getItemStarFontColor(P,I))]))}if(0!=A&&0!=e.power6&&e.isAscension(e.power6)){var C=ItemData.getpowerValueAdd(e.powerValue6,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power6));i.append(Tool.manageStringList(GameText2.STR_ITEM_STAR_POWERVALUE6,[Define.getPowerDesc(e.power6,C),PowerString.makeColorString(Define.getPowerDesc(e.power6,A),t.getItemStarFontColor(C,A))]))}if(0!=y&&0!=e.power7&&e.isAscension(e.power7)){var M=ItemData.getpowerValueAdd(e.powerValue7,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power7));i.append(Tool.manageStringList(GameText2.STR_ITEM_STAR_POWERVALUE7,[Define.getPowerDesc(e.power7,M),PowerString.makeColorString(Define.getPowerDesc(e.power7,y),t.getItemStarFontColor(M,y))]))}return i.toString()},t.getUpgradeCompareStarInfo=function(e,n){if(null==xself)return"";if(null==xself.bag)return"";var i=(e.getItemClass(),new StringBuffer),o=n.upgradeStar;i.append(Tool.manageStringList("进阶升星：\n%U --\x3e %U \n",[Tool.getStarInfo(e.upgradeStar,e.upgradeAscensionStar),Tool.getStarInfo(o,e.upgradeAscensionStar)]));var a=ItemData.getpowerValueAdd(n.powerValue4,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power4)),r=ItemData.getpowerValueAdd(n.powerValue5,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power5)),s=ItemData.getpowerValueAdd(n.powerValue6,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power6)),l=ItemData.getpowerValueAdd(n.powerValue7,n.upgradeAscensionStar,n.upgradeStar,n.isBinded(),n.isAscension(n.power7));if(n.upgradeAscensionStar,n.upgradeStar,0!=a&&0!=e.power4&&e.isAscension(e.power4)){var _=ItemData.getpowerValueAdd(e.powerValue4,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power4));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power4,_),PowerString.makeColorString(Define.getPowerDesc(e.power4,a),t.getItemStarFontColor(_,a))]))}if(0!=r&&0!=e.power5&&e.isAscension(e.power5)){var h=ItemData.getpowerValueAdd(e.powerValue5,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power5));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power5,h),PowerString.makeColorString(Define.getPowerDesc(e.power5,r),t.getItemStarFontColor(h,r))]))}if(0!=s&&0!=e.power6&&e.isAscension(e.power6)){var u=ItemData.getpowerValueAdd(e.powerValue6,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power6));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power6,u),PowerString.makeColorString(Define.getPowerDesc(e.power6,s),t.getItemStarFontColor(u,s))]))}if(0!=l&&0!=e.power7&&e.isAscension(e.power7)){var c=ItemData.getpowerValueAdd(e.powerValue7,e.upgradeAscensionStar,e.upgradeStar,e.isBinded(),e.isAscension(e.power7));i.append(Tool.manageStringList("\n%U -> %U",[Define.getPowerDesc(e.power7,c),PowerString.makeColorString(Define.getPowerDesc(e.power7,l),t.getItemStarFontColor(c,l))]))}return i.toString()},t.doWorldItemBind=function(t,e,n,i,o){if(void 0===n&&(n=!0),void 0===i&&(i=null),void 0===o&&(o=null),0==SafeLock.doSafeLockVerify())return!1;if(null==t||null==t.bag||null==e)return!1;if(t.bag,e.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;var a=function(n){PanelManager.closeWaitForServer();var a=n.getByte();if(0>a)GameWorld.doErrorJumpShop(n,a);else{e.isEquited()&&t.checkPower(),e.setBinded();var r=new StringBuffer;r.append(Tool.manageString(GameText.STR_ITEM_BIND_SUCCESS,e.getNameInfo()));var s=new StringBuffer;e.bindPower1>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.bindPower1,e.bindPowerValue1),65280)+"\n"),e.bindPower2>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.bindPower2,e.bindPowerValue2),65280)+"\n"),e.power4>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.power4,e.powerValue4),65280)+"\n"),e.power5>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.power5,e.powerValue5),65280)+"\n"),e.power6>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.power6,e.powerValue6),65280)+"\n"),e.power7>0&&s.append(PowerString.makeColorString(Define.getPowerDesc(e.power7,e.powerValue7),65280)+"\n"),Tool.isNullText(s.toString())||(r.append(GameText.STR_ITEM_BIND_SUCCESS_GET),r.append(s.toString())),PanelManager.closeItemView(),AlertPanel.alertNotify(GameText.getText(GameText.TI_WARM_SHOW),r.toString()),null!=i&&null!=o&&i.call(o)}},r=function(){var t=MsgHandler.createPlayerBagMessage(ProtocolDefine.BAG_BIND,ProtocolDefine.BAG_BIND,e,-1);nato.Network.sendCmd(t,a,this),PanelManager.openWaitForServer()};if(n){var s=Tool.manageString(GameText.STR_ITEM_BIND_ASK,e.getNameInfo());AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),s,r,this)}else r();return!0},t.doWorldIdentifyItemSelect=function(t,e){return 0!=SafeLock.doSafeLockVerify()&&(null!=t&&null!=t.bag&&null!=e&&(0!=e.isIdentifyItem()&&(1==e.isEquited()?(AlertPanel.alertCommon(GameText.STR_UNEQUIP_INDENTIFY),!1):e.isNotOperate()?(AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1):(PanelManager.closeItemView(),PanelManager.openForgeScene(ForgeScene.TAB_INDEX_IDENTIFY,e),!0))))},t.onIdentifyMenuSelect=function(e,n){return e==t.Action_back?void PanelManager.closeSelectMenuPanel():void(null!=n&&(e==t.Action_EQ_identify_COMMON?t.doWorldIdentifyItemAction(xself,n,!1,!1):e==t.Action_EQ_identify_UPGRADE&&t.doWorldIdentifyItemAction(xself,n,!1,!0)))},t.doWorldIdentifyItemAction=function(e,n,i,o,a){if(void 0===o&&(o=!1),void 0===a&&(a=!1),0==SafeLock.doSafeLockVerify())return!1;if(null==e||null==e.bag||null==n)return!1;if(0==n.isIdentifyItem())return!1;if(1==n.isEquited())return AlertPanel.alertCommon(GameText.STR_UNEQUIP_INDENTIFY),!1;if(n.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;if(o&&!n.isUpgradeItem)return AlertPanel.alertCommon(GameText2.STR_EQ_IDENTIFY_CANNOT_UPGRADE),!1;var r=e.bag,s=n.slotPos,l=null;return i?(l=new nato.Message(ProtocolDefine.CG_IDENTIFY_USE_HIGH_KEY)).putBoolean(a):l=MsgHandler.createPlayerBagMessage(ProtocolDefine.BAG_CHECKUP,ProtocolDefine.PLAYERBAG_CHECKUP,n,-1,o,a),nato.Network.sendCmd(l,(function(e){PanelManager.closeWaitForServer();var a=e.getByte();if(0>a)if(i)AlertPanel.alertCommon(e.getString());else{var l=Define.ITEM_ID_IDENTIFY_SCROLL;o&&(l=Define.ITEM_ID_UPGRADE_IDENTIFY_SCROLL),GameWorld.doErrorJumpShop(e,a,l)}else{var _="",h=[],u=!1,c=null,T=0,p=0;if((i?e.getByte():a)===ProtocolDefine.BAG_CHECKUP){T=e.getByte();for(var d=e.getInt(),E=0;d>E;E++){var g=e.getByte(),S=e.getShort(),m=e.getInt(),f=r.getItem(S);null==f||f.id,a=r.removeBagItemByPos(S,g),Define.SUCCESS}if(T==Define.BAG_CHECKUP_RESULT_NEW)if(c=ItemData.fromBytes(e),u=!0,o){_=ItemData.getUpgradeIdentifyCompareInfo(n,c),e.getBoolean()&&ItemData.oldFromIdentifyUpgradePowerBytes(c,e),e.getBoolean()&&ItemData.fromIdentifyUpgradePowerBytes(n,e)}else{_=ItemData.getIdentifyCompareInfo(n,c),e.getBoolean()&&(ItemData.fromIdentify1PowerBytes(c,e),ItemData.fromIdentify1PowerBytes(n,e))}else if(T==Define.BAG_CHECKUP_RESULT_UPDATE){S=e.getShort(),m=e.getInt();if(n.slotPos!=S)return;if(n.id!=m)return;if(c=n.clone(),p=ItemData.COMPARE_IDENTIFY,o){p=ItemData.COMPARE_IDENTIFY_G,n.setVarItemDataTo(c),e.getBoolean()&&ItemData.oldFromIdentifyUpgradePowerBytes(c,e),e.getBoolean()&&ItemData.newFromIdentify2PowerBytes2(n,e)}else{var I=e.getBoolean();ItemData.fromIdentify2PowerBytes1(c,e,I),n.setVarItemDataTo(c),e.getBoolean()&&(ItemData.fromIdentify2PowerBytes2(n,e),c.powerValue3=n.powerValue3,c.powerValue3add=n.powerValue3add)}_=o?c.getUpgradeIdentifyInfo():c.getIdentifyInfo(),u=!1,c.setItemPowerDataTo(n)}else{S=e.getShort(),m=e.getInt();p=ItemData.COMPARE_IDENTIFY;var A=[];if(o){p=ItemData.COMPARE_IDENTIFY_G,e.getBoolean()&&ItemData.oldFromIdentifyUpgradePowerBytes(n,e);var y=e.getInt();for(E=0;y>E;E++){var R=n.clone();n.setVarItemDataTo(R),ItemData.newFromIdentifyUpgradePowerBytes(R,e),A.push(R)}}else{for(I=e.getBoolean(),y=e.getInt(),E=0;y>E;E++){var P=n.clone();n.setVarItemDataTo(P),ItemData.fromIdentify3PowerBytes1(P,e,I),A.push(P)}if(I){ItemData.fromIdentify3PowerBytes2(n,e);for(E=0;E<A.length;E++)A[E].powerValue3=n.powerValue3,A[E].powerValue3add=n.powerValue3add}for(E=0;E<A.length;E++){var C=A[E];if(C.slotPos!=S)break;if(C.id!=m)break;if(s!=S)break;if(n.id!=m)break}}for(E=0;E<A.length;E++){var M=A[E];_=o?ItemData.getUpgradeIdentifyCompareInfo(n,M):ItemData.getIdentifyCompareInfo(n,M),h.push(_)}u=!0,t.save_identify_newItemList=A}}var L=PanelManager.getPanel(ForgeScene,!1);L&&L.stage&&(h.length>1?L.identifyPanel.updateFromServerMulti(h,n,o):L.identifyPanel.updateFromServer(_,u)),t.save_identify_oldItem=n,t.save_identify_newItem=c,t.save_identify_checkRs=T,t.save_identify_uiType=p}}),this),PanelManager.openWaitForServer(),!0},t.doIdentifyReplace=function(e,n){var i=t.save_identify_newItem;null!=t.save_identify_newItemList&&(i=t.save_identify_newItemList[n],t.save_identify_newItemList=null),t.doIdentifyAsk(xself,t.save_identify_checkRs,t.save_identify_oldItem,i,e,t.save_identify_uiType,n)},t.doIdentifyAsk=function(t,e,n,i,o,a,r){var s=MsgHandler.createIdentifyAsk(e,n.slotPos,n.id,!0,o,r);nato.Network.sendCmd(s,(function(a){if(PanelManager.closeWaitForServer(),0>a.getByte())AlertPanel.errorMessage(a.getString());else{var r;r=o?i.getUpgradeIdentifyInfo():i.getIdentifyInfo();var s=PanelManager.getPanel(ForgeScene,!1);e==Define.BAG_CHECKUP_RESULT_NEW?(t.bag.setItemWithSlot(i,n.slotPos),s&&s.stage&&(s.identifyPanel.setdata(i),s.identifyPanel.update())):(i.setItemPowerDataTo(n),s&&s.stage&&s.identifyPanel.updateFromServer(r,!1))}}),this),PanelManager.openWaitForServer()},t.doAttachGem=function(t){if(null!=t){null!=xself&&null!=xself.bag&&(PanelManager.closeItemView(),PanelManager.openForgeScene(ForgeScene.TAB_INDEX_GEM,t))}},t.doWorldAttachItemAction=function(t,e,n){if(null==e||null==n||null==t||null==t.bag)return!1;if(0==e.isCanAttach())return!1;if(e.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;var i=t.bag,o=(e.slotPos,n.slotPos),a=MsgHandler.createPlayerBagMessage(ProtocolDefine.BAG_ENCHASE,ProtocolDefine.PLAYERBAG_ENCHASE,e,o);return nato.Network.sendCmd(a,(function(n){PanelManager.closeWaitForServer();var o=n.getByte();if(0>o)AlertPanel.errorMessage(n.getString());else{var a=!1;if(o===ProtocolDefine.BAG_ENCHASE){a=n.getBoolean(),e.setAttackBroken(!a),e.attachDone=n.getByte(),e.attachPower=n.getUnsignedByte(),e.attachValue=n.getShort();var r=n.getByte();if(0!=r){var s=n.getShort(),l=(n.getInt(),i.getItem(s));null==l||l.id,o=i.removeBagItemByPos(s,r),Define.SUCCESS}}var _=new StringBuffer;if(1==a){var h=Define.getGradeColor(Define.GRADE_2);e.attachDone>6?h=Define.getGradeColor(Define.GRADE_3):e.attachDone>3&&(h=Define.getGradeColor(Define.GRADE_4)),null!=_&&_.append(GameText.STR_ATTACH_ITEM_TITLE1+PowerString.makeColorString(Tool.manageString(GameText.STR_ATTACH_ITEM_TITLE2,e.attachDone+""),h)+GameText.STR_ATTACH_ITEM_TITLE3)}else null!=_&&_.append(PowerString.makeColorString(GameText.STR_ATTACH_ITEM_FAIL_INFO,ColorUtils.COLOR_RED));var u=t.getIcon1(),c=t.getIcon2(),T=t.getIcon3();t.updateIcon(),(t.getIcon1()!=u||t.getIcon2()!=c||t.getIcon3()!=T)&&t.refreshWorldSprite(),t.checkHPMP(),PanelManager.isPanelShow(ForgeScene)&&PanelManager.getPanel(ForgeScene).gemPanel.updateFromServer(_.toString())}}),this),PanelManager.openWaitForServer(),!1},t.doWorldAttachChangeGemMenu=function(e){if(null!=e&&0!=SafeLock.doSafeLockVerify()){var n=xself;if(null!=n&&null!=n.bag){var i=n.bag.getCanChangeAttachGemItemList(e);if(null==i||i.length<=0)return void AlertPanel.alertCommon(GameText.STR_NO_REPLACE_INLAY_GEM);var o=[],a=new MenuActionData(GameText.getText(GameText.TI_BACK),t.Action_back);o.push(a);for(var r=0;r<i.length;r++){var s=i[r];if(null!=s){var l=s.name+GameText.getText(GameText.TI_ITEM_X)+s.quantity;a=new MenuActionData(l,t.Action_Gem_select_replace,e,s),o.push(a)}}var _=e.getRewardDesc()+"\n";_+=Tool.manageString(GameText.STR_ATTACH_GEM_COUNT,e.attachDone+""),_+=PowerString.makeColorString(Tool.manageString(GameText.STR_ATTACH_GEM_VALUE,Define.getPowerDesc(e.attachPower,e.attachValue)),ColorUtils.COLOR_GREEN),_+=Tool.manageString(GameText.STR_REPLACE_INLAY_GEN_NEED,2*e.attachDone+""),PanelManager.openSelectMenuPanel(_,o,t.onGemReplaceSelectMenu,xitem)}}},t.onGemReplaceSelectMenu=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),e==t.Action_back?void PanelManager.closeSelectMenuPanel():void(null!=n&&null!=i&&t.doWorldAttachChangeGemSelect(i,n))},t.doWorldAttachChangeGemSelect=function(t,e){if(null!=t&&null!=e){var n=xself;if(null!=n&&null!=n.bag){var i=n.bag,o=new nato.Message(ProtocolDefine.CG_REPLACE_INLAY_GEM);o.putShort(e.slotPos),o.putInt(e.id),o.putShort(t.slotPos),nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),0>o.getByte())AlertPanel.errorMessage(o.getString());else{var a=o.getByte(),r=new StringBuffer;r.append(e.getRewardDesc()+"\n"),r.append(Define.getPowerDesc(e.attachPower,e.attachValue)+" -> "+PowerString.makeColorString(Define.getPowerDesc(t.power1,e.attachDone*t.powerValue1),ColorUtils.COLOR_GREEN)+"\n"),r.append(GameText.getText(GameText.TI_CONSUME)+": ");for(var s=new Array(a),l=new Array(a),_=0,h="",u=0,c="",T=0,p=0;a>p;p++){var d=o.getShort(),E=o.getByte(),g=i.getItem(d);s[p]=d,l[p]=E,null!=g&&(0==p?(_=g.id,h=g.name,u+=E):_==g.id?u+=E:(c=g.name,T+=E))}0==Tool.isNullText(h)&&u>0&&r.append(h+"x"+u+"\n"),0==Tool.isNullText(c)&&T>0&&r.append(c+"x"+T+"\n"),r.append(GameText.STR_REPLACE_INLAY_GEM_ASK);var S=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertCommon(t.getString());else{for(var o=0;a>o;o++){i.removeBagItemByPos(s[o],l[o]);Define.SUCCESS}ItemData.fromBytesEdit(e,t),n.bag.setItem(e),n.updateIcon(),n.refreshWorldSprite(),n.checkHPMP(),AlertPanel.alertCommon(Tool.manageString(GameText.STR_REPLACE_INLAY_GEM_SUCCEE,e.getNameInfo()+"\n"+PowerString.makeColorString(e.getAttackPowerDesc(!0),ColorUtils.COLOR_GREEN))),PanelManager.isPanelShow(ForgeScene)&&PanelManager.getPanel(ForgeScene).gemPanel.updateFromServer("/cffcc00替换成功/p")}};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),r.toString(),(function(){var t=new nato.Message(ProtocolDefine.CG_REPLACE_INLAY_GEM_ASK);t.putShort(e.slotPos),t.putInt(e.id),t.putByte(a);for(var n=0;a>n;n++)t.putShort(s[n]),t.putByte(l[n]);t.putBoolean(!0),nato.Network.sendCmd(t,S,this),PanelManager.openWaitForServer()}),this)}}),this),PanelManager.openWaitForServer()}}},t.doStorageListAction=function(t){if(null==t||null==t.bag)return!1;t.bag.clearStorageItem();var e=MsgHandler.createStorageListMsg();return nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){for(var n=e.getByte(),i=[],o=0;n>o;o++)i.push(ItemData.fromBytes(e));t.bag.initBagItem(i),PanelManager.openStorePanel(StorePanel.Type_person,t,!1)}}),this),PanelManager.openWaitForServer(),!0},t.doVIPStorageListAction=function(t){if(null==t||null==t.bag)return!1;var e=GameText.STR_VIP;t.bag.clearVipStorageItem();var n=MsgHandler.createVIPStorageListMsg();return nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){var i=n.getByte();if(0==i&&0==Tool.isVip(t)){var o=Tool.manageStringList(GameText.STR_VIP_STOREAGE_CNNONT_OPEN,[e,e,e]);AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),o,(function(){PanelManager.openVIPScene()}),this)}for(var a=[],r=0;i>r;r++)a.push(ItemData.fromBytes(n));t.bag.initBagItem(a),PanelManager.openStorePanel(StorePanel.Type_person_vip,t,!1)}}),this),PanelManager.openWaitForServer(),!0},t.doStorageOpeAction=function(e,n,i){if(null==e||null==e.bag||null==n)return!1;if(n.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;if(i!=t.STORAGE_OPE_GET&&i!=t.STORAGE_OPE_PUT)return!1;var o=MsgHandler.createStorageOperateMsg(i,n.slotPos);return nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){switch(i){case t.STORAGE_OPE_GET:e.bag.getItemByStorage(n);break;case t.STORAGE_OPE_PUT:e.bag.putItemByStorage(n)}PanelManager.isPanelShow(StorePanel)&&PanelManager.getPanel(StorePanel).update()}}),this),PanelManager.openWaitForServer(),!0},t.doVIPStorageOpeAction=function(e,n,i){if(null==e||null==e.bag||null==n)return!1;if(n.isNotOperate())return AlertPanel.alertCommon(GameText.STR_IN_SHOP_NO_USE),!1;if(i!=t.STORAGE_OPE_GET&&i!=t.STORAGE_OPE_PUT)return!1;var o=MsgHandler.createVIPStorageOperateMsg(i,n.slotPos);return nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){switch(i){case t.STORAGE_OPE_GET:e.bag.getItemByVIPStorage(n);break;case t.STORAGE_OPE_PUT:e.bag.putItemByVIPStorage(n)}PanelManager.isPanelShow(StorePanel)&&PanelManager.getPanel(StorePanel).update()}}),this),PanelManager.openWaitForServer(),!0},t.doCombinMulti=function(){t.doItemCombin_2(t.combin_shopType,t.combin_shopID,t.combin_item)},t.resetCombinMulti=function(){t.combin_shopID=0,t.combin_shopType=0,t.combin_item=null,t.combin_countTotal=0,t.combin_currCount=0},t.doItemCombin_1=function(e,n,i){if(0!=SafeLock.doSafeLockVerify()&&null!=i){t.resetCombinMulti();var o,a=[],r=GameText.STR_COMBIN_SURE,s=e==ShopType.SUB_SHOP_EQ_UPGRADE;s&&(r=GameText2.STR_EQ_UPGRADE_ITEM_COMBIN_SURE);var l=null;i.isCombin_AtoA()?l=i.getCombinDesc(xself,!0,s):(l=i.getCombinDesc(xself,!1,s),ModelConst.ENCHANTVALUE==i.enchantType&&(l+=Tool.manageString(GameText2.STR_ENCHANT_SHOP_INFO,i.enchantNeed+"")),l+=Tool.manageString(GameText.STR_COMBIN_GET,"\n"+i.getNameInfo()+"\n"),l+=i.getItemDesc(xself)),ModelConst.ENCHANTVALUE==i.enchantType||(s?l+=GameText2.STR_EQ_INDENTIFY_UPGRADE_INFO:10062==n&&(l+=GameText.STR_COMBINDESC_INFO)),o=new MenuActionData(r,t.CombinAction_combin_sure),a.push(o),(i.isPetEgg()||i.isGem())&&i.combinCount>1&&(o=new MenuActionData(GameText.STR_COMBIN_MULTI,t.CombinAction_combin_multi),a.push(o)),o=new MenuActionData(GameText.getText(GameText.TI_BACK),t.CombinAction_back),a.push(o),PanelManager.openSelectMenuPanel(l,a,(function(o){o==t.CombinAction_back?PanelManager.closeSelectMenuPanel():o==t.CombinAction_combin_sure?t.doItemCombin_2(e,n,i):o==t.CombinAction_combin_multi&&(CommonFormPanel.combinMulti((function(o){var a=parseInt(o[0]);a>0&&(t.combin_countTotal=a>i.combinCount?i.combinCount:a,t.combin_currCount=0,t.combin_item=i,t.combin_shopType=e,t.combin_shopID=n,t.doCombinMulti())}),i.combinCount,this),PanelManager.closeSelectMenuPanel())}),this)}},t.doItemCombin_2=function(e,n,i){if(null!=i){var o=e==ShopType.SUB_SHOP_EQ_UPGRADE,a=i.combinItemID;o&&(a=i.id);var r=PlayerBag.getBagItemByID(xself,a);if(null==r||0==r.length)return void(o?(AlertPanel.alertCommon(GameText2.STR_EQ_UPGRADE_ITEM_COMBIN_ERROR),PanelManager.closeSelectMenuPanel()):t.doItemCombin_2_2(e,n,i,null));if(1==r.length)return void t.doItemCombin_2_2(e,n,i,r[0]);for(var s,l=[],_=0;_<r.length;_++){var h=r[_];if(null!=h){var u="";h.isUpgradeItem&&(u="("+GameText2.STR_EQ_UPGRADE+")");var c=Tool.getUpgradeStarInfo(h.upgradeStar,h.upgradeAscensionStar);s=new MenuActionData(u+h.name+"("+Tool.getStarInfo(h.star,h.ascensionStar)+c+")",t.CombinAction_selectItem,h),l.push(s)}}s=new MenuActionData(GameText.getText(GameText.TI_BACK),t.CombinAction_back),l.push(s),PanelManager.openSelectMenuPanel("\n请选择需要进阶的装备：\n\n\n",l,(function(o,a){return void 0===a&&(a=null),o==t.CombinAction_back?void PanelManager.closeSelectMenuPanel():o==t.CombinAction_selectItem?void t.doItemCombin_2_2(e,n,i,a):void 0}),this)}},t.doItemCombin_2_2=function(e,n,i,o){t.doItemCombin_3(e,n,i,o)},t.doItemCombin_3=function(e,n,i,o){void 0===o&&(o=null);var a=xself;if(null==a||null==a.bag)return!1;var r=a.bag,s=function(t){PanelManager.closeWaitForServer();var e=t.getByte();if(0>e)AlertPanel.alertCommon(t.getString());else{a.setPlayerMoney(t.getInt(),t.getInt(),t.getInt(),null);for(var n=t.getByte(),i=0;n>i;i++){var s=t.getInt(),l=t.getShort(),_=t.getByte(),h=r.getItem(l);null==h?WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 删除的物品不存在"):h.id!=s&&WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 删除的物品ID错误. id1="+h.id+" id2="+s);var u=r.removeBagItemByPos(l,_);0>u&&WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 背包移出物品错误. rs="+u)}if(1==e)AlertPanel.alertCommon(t.getString());else{ItemData.fromBytesEdit(o,t);var c=[];o.itemUpgradeDesc(c);var T=new StringBuffer;for(i=0;i<c.length;i++){var p=c[i],d=p.text,E=p.color;Tool.isNullText(d)||(null!=E&&-1!=E?T.append(PowerString.makeColorString(d,E)+"\n"):T.append(d+"\n"))}AlertPanel.alertCommon(GameText2.STR_EQ_UPGRADE_GET_INFO+"\n"+o.getRewardDesc()+"\n"+T.toString())}if(PanelManager.isPanelShow(TimeLimitExchangePanel))PanelManager.getPanel(TimeLimitExchangePanel).updateMyItem();PanelManager.closeSelectMenuPanel()}},l=function(s){t.combin_currCount++,PanelManager.closeWaitForServer();var l=s.getByte();if(0>l)return t.resetCombinMulti(),void AlertPanel.errorMessage(s.getString());if(1==l)return GameWorld.doEnterCombinShop(e,n),void AlertPanel.alertCommon(GameText.STR_COUNTRY_PRICE_ADUST);a.setPlayerMoney(s.getInt(),s.getInt(),s.getInt(),null);for(var _=s.getByte(),h=0;_>h;h++){var u=s.getInt(),c=s.getShort(),T=s.getByte(),p=r.getItem(c);null==p?WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 删除的物品不存在"):p.id!=u&&WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 删除的物品ID错误. id1="+p.id+" id2="+u);var d=r.removeBagItemByPos(c,T);0>d&&WorldMessage.addPromptMsg("GameWorld.doItemCombin_2() 背包移出物品错误. rs="+d)}PanelManager.closeSelectMenuPanel();var E=s.getByte(),g=ItemData.fromBytes(s);if(E==t.COMBIN_NEW_ITEM)r.setItem(g),(t.combin_countTotal<=0||t.combin_currCount>0&&t.combin_currCount==t.combin_countTotal)&&AlertPanel.alertNotify(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_COMBIN_NEW_ITEM,g.getNameInfo()+(t.combin_countTotal>0?" x"+t.combin_currCount:"")+"\n"+g.getDesc(a)));else if(E==t.COMBIN_REPLACE)r.setItem(g),o&&g.setItemDataTo(o),t.doItemCombin_4(e,n,i,g,o,t.COMBIN_REPLACE);else if(E==t.COMBIN_REPLACE_ASK){var S=s.getBoolean();g.setCombinAttribute(s,S),null!=o&&S&&o.setCombinAttribute2(s,S),g.skillDesc=s.getString(),t.doItemCombin_4(e,n,i,g,o,t.COMBIN_REPLACE_ASK)}PanelManager.isPanelShow(TimeLimitExchangePanel)&&PanelManager.getPanel(TimeLimitExchangePanel).updateMyItem();t.combin_countTotal>0&&(t.combin_currCount<t.combin_countTotal?t.doCombinMulti():t.resetCombinMulti())},_=function(){var e=-1,a=-1;if(null!=o&&(e=o.slotPos,a=o.id),u){(r=new nato.Message(ProtocolDefine.CG_EQUIPMENT_UPGRADE)).putShort(n),r.putInt(i.id),r.putShort(e),r.putInt(a),r.putByte(i.combintype),nato.Network.sendCmd(r,s,this),PanelManager.openWaitForServer()}else{var r=MsgHandler.createCombinItem(n,i,e,a);nato.Network.sendCmd(r,l,this),t.combin_countTotal>0?PanelManager.openWaitForServer(Tool.manageString(GameText.STR_COMBIN_MULTI_WAIT,t.combin_currCount+1+"")):PanelManager.openWaitForServer()}},h=function(){if(0!=i.checkCombinEnough()){var e=t.combin_countTotal>0?t.combin_countTotal:1;Model.checkEnoughMoney(i.money1*e,i.money2*e,i.money3*e,_,this)}},u=e==ShopType.SUB_SHOP_EQ_UPGRADE,c=GameText.STR_COMBIN_EQUIP,T=GameText.STR_COMBIN_EQUIP_ASK;if(u?(c=GameText2.STR_EQ_UPGRADE_EQUIP,T=GameText2.STR_COMBIN_EQUIP_ASK):t.combin_countTotal>0&&(c=GameText.STR_COMBIN_MULTI),t.combin_currCount>0&&t.combin_countTotal==t.combin_currCount||t.combin_currCount<=0){var p=t.combin_countTotal>0?" x"+t.combin_countTotal:"";AlertPanel.alert(c,Tool.manageStringList(T,[i.getNameInfo()+p,i.getCombinDesc(a,!1)]),h,this)}else h();return!0},t.doItemCombin_4=function(e,n,i,o,a,r){if(null!=o){var s,l=[],_="";_+=Tool.manageString(GameText.STR_COMBIN_FOURTH_GET,o.getNameInfo()+"\n"),s=new MenuActionData(GameText.STR_COMBIN_CONTINUE,t.CombinAction_continue),l.push(s),r==t.COMBIN_REPLACE?(_+=o.getAllPowerDesc(),_+=GameText.STR_COMBIN_REPLACE_INFO):r==t.COMBIN_REPLACE_ASK&&(_+=ItemData.getEquipCompareDesc(o,a,ItemData.COMPARE_COMBIN)+"\n",_+=GameText.STR_COMBIN_REPLACE_ASK,s=new MenuActionData(GameText.STR_COMBIN_REPLACE_ALL,t.CombinAction_replace_all),l.push(s),o.isHasPower()&&(s=new MenuActionData(GameText.STR_COMBIN_REPLACE_POWER,t.CombinAction_replace_prop),l.push(s)),0==Tool.isNullText(o.skillDesc)&&(s=new MenuActionData(GameText.STR_COMBIN_REPLACE_SKILL,t.CombinAction_replace_skill),l.push(s))),s=new MenuActionData(GameText.getText(GameText.TI_BACK),t.CombinAction_back),l.push(s),PanelManager.openSelectMenuPanel(_,l,(function(o){o==t.CombinAction_back?PanelManager.closeSelectMenuPanel():o==t.CombinAction_continue?t.doItemCombin_3(e,n,i,a):o==t.CombinAction_replace_all?t.doItemCombin_5(e,n,i,t.COMBIN_REPLACE_ALL,a):o==t.CombinAction_replace_prop?t.doItemCombin_5(e,n,i,t.COMBIN_REPLACE_POWER,a):o==t.CombinAction_replace_skill&&t.doItemCombin_5(e,n,i,t.COMBIN_REPLACE_SKILL,a)}),this)}},t.doItemCombin_5=function(e,n,i,o,a){var r=MsgHandler.createCombinConfirm(o);nato.Network.sendCmd(r,(function(o){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){var r=ItemData.fromBytes(o),s=xself;null!=s&&null!=s.bag&&s.bag.setItem(r),a=r,t.doItemCombin_4(e,n,i,r,a,t.COMBIN_REPLACE)}}),this),PanelManager.openWaitForServer()},t.doItemIntegral_1=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),0!=SafeLock.doSafeLockVerify()){if(null==t||0==t.length)return void AlertPanel.alertCommon(GameText.STR_INTEGRAL_NO_ITEM);var i=xself;if(null!=i&&null!=i.bag){for(var o=i.bag,a=t.length,r="",s="",l=0;l<t.length;l++){var _=t[l];null!=_&&_.grade>=3&&(s+="\n"+_.getNameInfo())}""!=s&&(r="分解列表中包含史诗级以上装备"+s+"\n确认是否分解？");var h=function(r){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(r)){for(var s=0,l=0;a>l;l++){var _=t[l];null!=_&&(o.removeItem(_.slotPos),s+=_.price)}s>0&&(s/=2,i.addValue(ModelConst.MONEY3,-s));var h=MsgHandler.processAddItemMsg(r);AlertPanel.alertCommon(Tool.manageString(GameText.STR_RESOLVE_SUCCESS,h)),null!=e&&null!=n&&e.call(n)}},u=function(){var e=new nato.Message(ProtocolDefine.CG_ITEM_DECOM);e.putByte(a);for(var n=0;a>n;n++){var i=t[n];if(null==i)return void AlertPanel.alertCommon(GameText.STR_RESOLVE_ITEM_ERROR);var o=i.getItemClass();if(1!=o&&2!=o)return void AlertPanel.alertCommon(GameText.STR_RESOLVE_ITEM_NOT_EQUIP);e.putInt(i.id),e.putShort(i.slotPos)}nato.Network.sendCmd(e,h,this),PanelManager.openWaitForServer()};""!=r?AlertPanel.alert("分解确认",r,u,this):u()}}},t.STORAGETYPE1=1,t.STORAGETYPE2=2,t.ITEM_STAR_TYPE1=1,t.ITEM_STAR_TYPE2=2,t.ITEM_STAR_TYPE3=3,t.Action_back=1,t.Action_item_star=2,t.Action_upgrade_star=3,t.Action_item_star_action=4,t.Action_upgrade_star_action=5,t._isTenUpStar=!1,t._tenUpCount=0,t._tenUpSuccessCount=0,t.Action_EQ_identify_COMMON=10,t.Action_EQ_identify_UPGRADE=11,t.Action_EQ_identify_CONTINUE=12,t.Action_EQ_identify_REPLACE=13,t.save_identify_oldItem=null,t.save_identify_newItem=null,t.save_identify_newItemList=null,t.save_identify_checkRs=0,t.save_identify5_item=null,t.save_identify_uiType=0,t.Action_Gem_replace=20,t.Action_Gem_select=21,t.Action_Gem_select_replace=22,t.STORAGE_OPE_GET=0,t.STORAGE_OPE_PUT=1,t.CombinAction_back=1,t.CombinAction_combin_sure=2,t.CombinAction_selectItem=3,t.CombinAction_continue=4,t.CombinAction_replace_all=5,t.CombinAction_replace_prop=6,t.CombinAction_replace_skill=7,t.CombinAction_combin_multi=8,t.combin_countTotal=0,t.combin_currCount=0,t.COMBIN_NEW_ITEM=0,t.COMBIN_REPLACE=1,t.COMBIN_REPLACE_ASK=2,t.COMBIN_REPLACE_ALL=0,t.COMBIN_REPLACE_POWER=1,t.COMBIN_REPLACE_SKILL=2,t}();__reflect(ItemManager.prototype,"ItemManager");var ItemSelectView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.btn_action.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAction,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this.btn_action.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAction,this),this._itemData=null,this._actionName=null,this._callbackFunc=null,this._thisObj=null},e.prototype.onClose=function(){PanelManager.closeItemSelectView()},e.prototype.onBtnAction=function(t){this._itemData&&null!=this._callbackFunc&&null!=this._thisObj&&this._callbackFunc.call(this._thisObj,this._itemData),this.onClose()},e.prototype.setData=function(t,e,n,i){this._itemData=t,this._actionName=e,this._callbackFunc=n,this._thisObj=i},e.prototype.update=function(){this.init&&this._itemData&&(this.btn_action.label=this._actionName,this.itemIcon.setData(this._itemData.bagIcon,this._itemData.grade),this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()),this.label_content.textFlow=Tool.convertDescToTextFlow(this._itemData.getDesc(xself)),this.label_content.height=this.label_content.textHeight,this.height=this.label_content.height+110*xhdRatio)},e}(ComponentBase);__reflect(ItemSelectView.prototype,"ItemSelectView");var ItemSetup=function(){};__reflect(ItemSetup.prototype,"ItemSetup");var ItemSimpleData=function(){this.id=0,this.grade=0,this.bagIcon=0,this.name="",this.nameInfo="",this.isUpgrade=!1,this.index=-1,this.nameIndex=-1};__reflect(ItemSimpleData.prototype,"ItemSimpleData");var ItemStarIcon=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._count=0,e.touchChildren=e.touchEnabled=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._type=t,this._count=e,this.update()},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this.img_type.source=this.getResource(),this.label_count.text=this._count.toString())},e.prototype.getResource=function(){return this._type==e.Type_Star?"item_star_icon_star"+(xhd?"_hd":"_sd"):this._type==e.Type_Gem?"item_star_icon_gem"+(xhd?"_hd":"_sd"):null},e.getIcon=function(t,e){var n=ObjectPool.getPool("ItemStarIcon").createObject();return nato.attachSkin(n),n.setData(t,e),n},e.returnIcon=function(t){null!=t&&ObjectPool.getPool("ItemStarIcon").returnObject(t)},e.Type_Star=1,e.Type_Gem=2,e}(ComponentBase);__reflect(ItemStarIcon.prototype,"ItemStarIcon");var ItemView=function(t){function e(){var e=t.call(this)||this;return e._isCompare=!1,e._actionList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._btnList&&(this._btnList=[this.btn0,this.btn1,this.btn2,this.btn3,this.btn4,this.btn5]);for(var n=0;n<this._btnList.length;n++){this._btnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this)}ButtonUtils.addTouchEvent(this.close_btn,this.onClose,this),this.update(),egret.setTimeout(this.checkGuide,this,33)},e.prototype.checkGuide=function(){1==GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_BAG_PARTNER_USE)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_BAG_PARTNER_USE),GameWorld.setGuide(GameWorld.GUIDE_BAG_PET_PARTNER_USE))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._btnList.length;n++){this._btnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this)}ButtonUtils.removeTouchEvent(this.close_btn)},e.prototype.onClose=function(){PanelManager.closeItemView()},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},enumerable:!0,configurable:!0}),e.prototype.onBtnTouch=function(t){var n=t.target;ButtonUtils.buttonTweenEffect(n);var i=xself,o=this._btnList.indexOf(n),a=this._actionList[o];if(a==e.Action_putOn)ItemManager.doEquipAction(i,this._itemData),xworld.checkBagEquipChange();else if(a==e.Action_putDown)ItemManager.doUnEquipAction(i,this._itemData);else if(a==e.Action_bind)ItemManager.doWorldItemBind(xself,this._itemData);else if(a==e.Action_unBind);else if(a==e.Action_gem)ItemManager.doAttachGem(this._itemData);else if(a==e.Action_compare)this._isCompare=!0,this.update(),this.updateResize();else if(a==e.Action_returnCompare)this._isCompare=!1,this.update(),this.updateResize();else if(a==e.Action_sell)this.doSell();else if(a==e.Action_use)this.doUse();else if(a==e.Action_vip_active)AlertPanel.alertCommon("敬请期待！");else if(a==e.Action_vip_renew)AlertPanel.alertCommon("敬请期待！");else if(a==e.Action_vip_privilege)PanelManager.openVIPScene(),this.onClose();else if(a==e.Action_back)PanelManager.closeItemView();else if(a==e.Action_upStar)ItemManager.doItemStarSelectMenu(this._itemData);else if(a==e.Action_idetify)ItemManager.doWorldIdentifyItemSelect(xself,this._itemData);else if(a==e.Action_fight)ItemManager.doEquipAction(i,this._itemData);else if(a==e.Action_rest)ItemManager.doUnEquipAction(i,this._itemData);else if(a==e.Action_detail)PanelManager.openPetScene(),this.onClose();else if(a==e.Action_prop);else if(a==e.Action_free)ItemManager.doDelEquipAction(xself,this._itemData);else if(a==e.Action_put_store){var r=0;PanelManager.isPanelShow(StorePanel)&&(r=PanelManager.getPanel(StorePanel).type),r==StorePanel.Type_person?ItemManager.doStorageOpeAction(i,this._itemData,ItemManager.STORAGE_OPE_PUT):r==StorePanel.Type_person_vip?ItemManager.doVIPStorageOpeAction(i,this._itemData,ItemManager.STORAGE_OPE_PUT):AlertPanel.alertCommon("该类型仓库未处理！"),this.onClose()}else if(a==e.Action_get_store){r=0;PanelManager.isPanelShow(StorePanel)&&(r=PanelManager.getPanel(StorePanel).type),r==StorePanel.Type_person?ItemManager.doStorageOpeAction(i,this._itemData,ItemManager.STORAGE_OPE_GET):r==StorePanel.Type_person_vip?ItemManager.doVIPStorageOpeAction(i,this._itemData,ItemManager.STORAGE_OPE_GET):AlertPanel.alertCommon("该类型仓库未处理！"),this.onClose()}else a==e.Action_del?ItemManager.doDelEquipAction(xself,this._itemData):a==e.Action_sell_up?SellHandler.upItem(this._itemData):a==e.Action_sell_down?SellHandler.doStallDownItem(this._itemData):a==e.Action_sell_change_price?(SellHandler.doStallChangePrice(this._itemData),this.onClose()):a==e.Action_country_putIn?(Country.doCountryStoragePut(this._country,this._player,this._itemData),this.onClose()):a==e.Action_country_exchange?Country.doCountryStoreGet(this._country,this._itemData):a==e.Action_country_del?Country.doCountryStoreDel(this._country,this._itemData):a==e.Action_country_system_exchange?Country.doCountryStoreGet(this._country,this._itemData):a==e.Action_item_get?ItemGet.openItemGetItemData(this._itemData):a==e.Action_trade_down?(ShopItem.doGoodsSellRetrieveMsg(this._itemData),this.onClose()):a==e.Action_trade_up&&(xevent.dispatchEvent(new WorldEvent(WorldEvent.HANG_SELL_READY)),this.onClose())},e.prototype.doSell=function(){ItemManager.doSell(this._itemData)},e.prototype.doUse=function(){ItemManager.doItem(this._itemData),this.onClose()},e.prototype.show=function(t,e,n,i){this._itemData=t,this._fromType=e,this._player=n,this._country=i,this._isCompare=!1},e.prototype.update=function(){if(this.clearView(),this._itemData){if(this._isCompare){if(null==(T=PlayerBag.getCompareEquip(this._player.bag,this._itemData.type)))return;this.itemIcon.setData(T.bagIcon,T.grade),this.itemIcon2.setData(this._itemData.bagIcon,this._itemData.grade),this.container.add(this.itemIcon,5*xhdRatio,5*xhdRatio);var t=T.getNameInfo()+"->",n=TextFieldUtils.getTextWidth(t,this.desc_label.size,this.desc_label.fontFamily)+55*xhdRatio;this.container.add(this.itemIcon2,n,5*xhdRatio);var i=ItemData.getEquipCompareDesc(this._itemData,T,ItemData.COMPARE_ALL,"     "),o=Tool.convertDescToTextFlow(i);this.desc_label.textFlow=o}else{this.container.add(this.itemIcon,5*xhdRatio,5*xhdRatio),this.itemIcon.setData(this._itemData.bagIcon,this._itemData.grade);o=(ColorUtils.getGradeColor(this._itemData.grade),Tool.convertDescToTextFlow(this._itemData.getDesc(this._player,!1,!1)));var a="";!this._itemData.isCanEquip()&&this._itemData.isVipItem(),null!=this._itemData.price&&this._itemData.price>0?(o.unshift(TextFieldUtils.getTextFlowElement(this._itemData.price+"\n")),this.copper_img.visible=!0):(o.unshift(TextFieldUtils.getTextFlowElement("\n")),this.copper_img.visible=!1),a=TextFieldUtils.getSpaceByWidth(22*xhdRatio,this.desc_label.size,this.desc_label.fontFamily),o.unshift(TextFieldUtils.getTextFlowElement(a));var r=this._itemData.getNameInfo()+" ",s=Tool.convertDescToTextFlow(r);if(s&&s.length>0)for(var l=s.length-1;l>=0;l--)o.unshift(s[l]);a=TextFieldUtils.getSpaceByWidth(35*xhdRatio,this.desc_label.size,this.desc_label.fontFamily),o.unshift(TextFieldUtils.getTextFlowElement(a)),this.desc_label.textColor=ColorUtils.COLOR_TEXT_GOLD,this.desc_label.textFlow=o;var _=r,h=TextFieldUtils.getTextWidth(_,this.desc_label.size,this.desc_label.fontFamily);this.container.add(this.copper_img,h+43*xhdRatio,20*xhdRatio)}this.desc_label.height=this.desc_label.textHeight,this.container.add(this.desc_label,7*xhdRatio,23*xhdRatio);var u=this.container.totalHeight;if(this._isCompare?this.container.updateAutoSize(u,250*xhdRatio):this.container.updateAutoSize(u,300*xhdRatio),this.group_btns.y=this.container.y+this.container.height+5*xhdRatio,this.height=this.group_btns.y+this.group_btns.height+11*xhdRatio,this._isCompare&&(this.initCompareModelGroup(this._player),this.addChild(this._modelGroup)),this._actionList.length=0,this._player!=xself)this._actionList.push(e.Action_back);else if(3==this._fromType)this._actionList.push(e.Action_get_store),this._actionList.push(e.Action_del);else if(4==this._fromType)this._actionList.push(e.Action_put_store),this._actionList.push(e.Action_del);else if(5==this._fromType||0==this._fromType);else if(12==this._fromType)this._actionList.push(e.Action_trade_up);else if(13==this._fromType)this._actionList.push(e.Action_trade_down);else if(6==this._fromType)this._actionList.push(e.Action_sell_up);else if(7==this._fromType)this._actionList.push(e.Action_sell_down),this._actionList.push(e.Action_sell_change_price);else if(8==this._fromType)this._actionList.push(e.Action_country_exchange),this._actionList.push(e.Action_country_del);else if(9==this._fromType)this._actionList.push(e.Action_country_putIn),this._actionList.push(e.Action_del);else if(10==this._fromType)this._actionList.push(e.Action_country_system_exchange);else if(11==this._fromType)this._actionList.push(e.Action_del);else{var c=2==this._fromType;if(this._itemData.slotPos==PlayerBag.SPIRIT_POS)this._actionList[0]=e.Action_vip_privilege;else{switch(this._itemData.getItemClass()){case 1:case 2:var T;if(c?this._actionList.push(e.Action_putDown):this._actionList.push(e.Action_putOn),this._itemData.isCanAttach()&&this._actionList.push(e.Action_gem),0==this._itemData.isBinded()?this._actionList.push(e.Action_bind):this._itemData.ascensionStar>0&&this._actionList.push(e.Action_upStar),this._isCompare)this._actionList.push(e.Action_returnCompare);else null!=(T=PlayerBag.getCompareEquip(this._player.bag,this._itemData.type))&&0==c&&this._actionList.push(e.Action_compare);this._itemData.isIdentifyItem()&&this._actionList.push(e.Action_idetify),0==c&&this._actionList.push(e.Action_sell);break;case 3:c?this._actionList.push(e.Action_rest):this._actionList.push(e.Action_fight),this._actionList.push(e.Action_detail),0==c&&this._actionList.push(e.Action_free);break;case 4:1==this._itemData.isCanUse(1)&&0==this._itemData.isPetCanUseItem()?this._actionList.push(e.Action_use):this._actionList.push(e.Action_back),this._actionList.push(e.Action_sell);break;default:this._actionList.push(e.Action_back),this._actionList.push(e.Action_sell)}if(xself.getLevel()>ItemGet.OPEN_LEVEL)ItemGet.getItemType1(this._itemData)>0&&this._actionList.push(e.Action_item_get)}}this.showBtns()}},e.prototype.showBtns=function(){for(var t=0;t<this._actionList.length;t++){var e=this._actionList[t];if(e>0){var n=this._btnList[t];n&&(n.visible=!0,n.touchEnabled=!0,n.label=this.getBtnLabel(e))}}},e.prototype.getBtnLabel=function(t){switch(t){case e.Action_putOn:return GameText.getText(GameText.TI_EQUIP);case e.Action_putDown:return GameText.getText(GameText.TI_UN_EQUIP);case e.Action_bind:return GameText.getText(GameText.TI_EQUIP_BIND);case e.Action_unBind:return GameText.getText(GameText.TI_UN_BIND);case e.Action_gem:return GameText.getText(GameText.TI_GEM);case e.Action_compare:return GameText.getText(GameText.TI_COMPARE_EQUIP);case e.Action_returnCompare:return GameText.getText(GameText.TI_BACK_COMPARE);case e.Action_sell:return GameText.getText(GameText.TI_SHOP_TAB_SELL);case e.Action_use:return GameText.getText(GameText.TI_USE);case e.Action_vip_active:return GameText.STR_VIP_ACTIVATE;case e.Action_vip_renew:return GameText.STR_VIP_RENEWAL;case e.Action_vip_privilege:return GameText.STR_VIP_PRIVILEGE;case e.Action_back:return GameText.getText(GameText.TI_BACK);case e.Action_upStar:return GameText2.STR_ITEM_STAR;case e.Action_idetify:return GameText.STR_EQUIP_IDENTIFY;case e.Action_fight:return GameText.STR_PET_SET_FIGHT;case e.Action_rest:return GameText.STR_REST;case e.Action_detail:return GameText.STR_DETAIL;case e.Action_prop:return GameText.STR_PROP;case e.Action_free:return GameText.STR_FREE_PET;case e.Action_put_store:return GameText.STR_PUT_STORAGE;case e.Action_get_store:return GameText.STR_GET_STORAGE;case e.Action_del:return GameText.STR_DROP;case e.Action_sell_up:return GameText.STR_UP_SHOP;case e.Action_sell_down:return GameText.STR_DOWN_SHOP;case e.Action_sell_change_price:return GameText.STR_ITME_CHANGE_PRICE;case e.Action_country_putIn:return GameText.STR_PUT_COUNTRY_STORE;case e.Action_country_exchange:return GameText.STR_EXCHANGE;case e.Action_country_del:return GameText.STR_DEL;case e.Action_country_system_exchange:return GameText.STR_EXCHANGE;case e.Action_item_get:return"获取途径";case e.Action_trade_down:return GameText.STR_CANCEL_HANG_SELL;case e.Action_trade_up:return GameText.STR_HANG_SELL}return""},e.prototype.clearView=function(){this.init&&(this.container.reset(),this.clearBtnList(),Tool.removeObjSafe(this.itemIcon),Tool.removeObjSafe(this.itemIcon2),Tool.removeObjSafe(this.copper_img),Tool.removeObjSafe(this.desc_label),Tool.removeObjSafe(this._modelGroup))},e.prototype.clearBtnList=function(){for(var t=0;t<this._btnList.length;t++)this._btnList[t].visible=!1,this._btnList[t].touchEnabled=!1,this._actionList[t]=0},e.prototype.initCompareModelGroup=function(t){if(null==this._modelGroup){this._modelGroup=new eui.Group,this._modelGroup.touchChildren=this._modelGroup.touchEnabled=!1;var e=new egret.Shape;e.graphics.beginFill(0,.7),e.graphics.drawRect(0,0,290*xhdRatio,100*xhdRatio),e.graphics.endFill(),this._modelGroup.addChild(e),this._modelGroup.x=5*xhdRatio,this._modelGroup.y=-95*xhdRatio}this._modelGroup.removeChildren(),this._spr1=GameSprite.cloneSprite(t.sprite),this._spr1.x=75*xhdRatio,this._spr1.y=100*xhdRatio,this._spr1.setScale(xhd?1.5:1),this._modelGroup.addChild(this._spr1),this._spr2=Player.getCompareSprite(t,this._itemData),this._spr2.x=225*xhdRatio,this._spr2.y=100*xhdRatio,this._spr2.setScale(xhd?1.5:1),this._modelGroup.addChild(this._spr2)},e.prototype.updateResize=function(){this.anchorOffsetY=0;var t=this.height;this._isCompare?(t+=100*xhdRatio,this.y=(nato.standardHeight-t)/2+100*xhdRatio):this.y=(nato.standardHeight-t)/2},e.Action_putOn=1,e.Action_putDown=2,e.Action_bind=3,e.Action_unBind=4,e.Action_gem=5,e.Action_compare=6,e.Action_returnCompare=7,e.Action_sell=8,e.Action_use=9,e.Action_vip_active=10,e.Action_vip_renew=11,e.Action_vip_privilege=12,e.Action_back=13,e.Action_upStar=14,e.Action_idetify=15,e.Action_fight=16,e.Action_rest=17,e.Action_detail=18,e.Action_prop=19,e.Action_free=20,e.Action_put_store=21,e.Action_get_store=22,e.Action_del=23,e.Action_sell_up=24,e.Action_sell_down=25,e.Action_sell_change_price=26,e.Action_country_putIn=27,e.Action_country_exchange=28,e.Action_country_del=29,e.Action_country_system_exchange=30,e.Action_item_get=31,e.Action_trade_up=32,e.Action_trade_down=33,e}(ComponentBase);__reflect(ItemView.prototype,"ItemView");var ItemRender1=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(){e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.spItem.itemData=this.data},e.prototype.onClick=function(){var t=this.data;t.isMoney?AlertPanel.alertTipsCommon(this.getMoneyDesc(t)):AlertPanel.alertTipsCommon(t.getDesc(xself,!0))},e.prototype.getMoneyDesc=function(t){return t.getNameInfo()+"x"+t.quantity+"\n"},e}(eui.ItemRenderer);__reflect(ItemRender1.prototype,"ItemRender1");var ItemRender2=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.spItem.itemData=this.data},e}(eui.ItemRenderer);__reflect(ItemRender2.prototype,"ItemRender2");var ItemRender3=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(){e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.spItem.itemData=this.data},e.prototype.onClick=function(){var t=this.data;t.isMoney?AlertPanel.alertTipsCommon(this.getMoneyDesc(t)):AlertPanel.alertTipsCommon(t.getDesc(xself,!0))},e.prototype.getMoneyDesc=function(t){return t.getNameInfo()+"x"+t.quantity+"\n"},e}(eui.ItemRenderer);__reflect(ItemRender3.prototype,"ItemRender3");var ItemRender4=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.spItem.itemData=this.data},e}(eui.ItemRenderer);__reflect(ItemRender4.prototype,"ItemRender4");var Control=function(){function t(t){this.type=0,this.byte0=0,this.byte1=0,this.byte2=0,this.int0=0,this.int1=0,this.int2=0,this.counter=0,this.maxCounter=0,this.subControlIndex=0,this.subControls=[],this.spriteStatusFlag=0,this.POINTER_NEARFY=[[0,0],[-1,0],[1,0],[0,-1],[0,1]],this.type=t}return t.prototype.setStatus=function(t,e){this.spriteStatusFlag&=~t,e&&(this.spriteStatusFlag|=t)},t.prototype.isStatus=function(t){return 0!=(this.spriteStatusFlag&t)},t.prototype.setSubControlList=function(t){this.subControls=t},Object.defineProperty(t.prototype,"isTypeMoveTo",{get:function(){return this.type==t.TYPE_MOVE_TO},enumerable:!0,configurable:!0}),t.prototype.execute=function(){switch(this.type){case t.TYPE_JUMP_MAP:this.executeJumpMap();break;case t.TYPE_MOVE:this.executeMove();break;case t.TYPE_PIXEL_MOVE:this.executePixelMove();break;case t.TYPE_MOVE_TO:this.executeMoveTo();case t.TYPE_CHANGE_STAGE:}},t.prototype.executePixelMove=function(){var e=this.byte0,n=this.byte1,i=this.byte2,o=this.int0,a=this.int1;this.setStatus(t.FLAG_FINISH,!0),this.model=this.getMoveModel(o,a,i);var r=MapTool.getDirByMovePixels(e,n,!1);this.model.setDir(r),this.model.setAnimationByDir(!0),this.model.moveByPixel(e,n),this.model.setTabStatus(!0,Model.MOVE_END_CHECK)},t.prototype.executeMoveTo=function(){var e=this.byte0,n=this.byte1,i=this.int0;if(0==this.counter){if(this.model=this.getMoveModelByIdAndType(i,3),null==this.model)return;if(1==this.model.isMember())return void this.setStatus(t.FLAG_FINISH,!0);if(xworld.inBattle)return this.model.setTabStatus(!0,Model.MOVE_END_CHECK),this.model.setPosition(e,n),void this.setStatus(t.FLAG_FINISH,!0);for(var o=this.model.getGx(),a=this.model.getGy(),r=e,s=n,l=e,_=n,h=0;h<this.POINTER_NEARFY.length&&(l=e+this.POINTER_NEARFY[h][0],_=n+this.POINTER_NEARFY[h][1],!xworld.gameMap.isCanPass(l,_));h++);e=l,n=_;var u=xworld.searchPath(o,a,e,n,!1),c=u.length;if(1==this.isAutoMoveEndStep()&&(c-=1),0>=c){if(this.model.setTabStatus(!0,Model.MOVE_END_CHECK),1==this.isAutoMoveEndStep()){var T=xworld.getNpcByPos(r,s);this.doNPCList(T)}else this.model.setPosition(e,n);return void this.setStatus(t.FLAG_FINISH,!0)}this.subControls=new Array(c);for(h=0;c>h;h++){var p=u[h],d=t.createMove(i,p,t.DEFAULT_MOVE_SPEED,this.model.getType());this.subControls[h]=d}this.counter=1}if(this.executeSubControls()&&(this.setStatus(t.FLAG_FINISH,!0),1==this.isAutoMoveEndStep())){T=xworld.getNpcByPos(e,n);this.doNPCList(T)}},t.prototype.doNPCList=function(t){if(null!=t&&0!=t.length)for(var e,n=t.length,i=0;n>i;i++)if(null!=(e=t[i])){if(1==e.doNPC())break}},t.prototype.executeJumpMap=function(){var e=this.int0,n=this.byte0,i=this.byte1;this.setStatus(t.FLAG_FINISH,!0),xworld.doJumpMap(e,n,i)},t.prototype.executeMove=function(){var e=this.byte0,n=this.byte1,i=this.byte2,o=this.int0;if(!this.isStatus(t.FLAG_INIT)){if(this.model=this.getMoveModelByIdAndType(o,i),null==this.model)return void this.setStatus(t.FLAG_FINISH,!0);this.maxCounter=MapSetup.GRID_WIDTH/n,this.model.getDir()!=e&&this.model.setDir(e),this.model.setAnimationByDir(!0),this.setStatus(t.FLAG_INIT,!0)}this.model.moveByDir(e,n),this.counter+=1,this.counter>=this.maxCounter&&(this.model.setTabStatus(!0,Model.MOVE_END_CHECK),this.setStatus(t.FLAG_FINISH,!0))},t.prototype.executeSubControls=function(){return null==this.subControls||this.subControlIndex<0||this.subControlIndex>=this.subControls.length||(null==this.subControls[this.subControlIndex]?this.subControlIndex++:(this.subControls[this.subControlIndex].execute(),this.subControls[this.subControlIndex].isStatus(t.FLAG_FINISH)&&(this.subControlIndex+=1)),!1)},t.prototype.getMoveModelByIdAndType=function(t,e){return this.getMoveModel(t,0,e)},t.prototype.getMoveModel=function(t,e,n){var i=null;switch(n){case 3:i=xworld.getModel(t);break;case 1:i=xworld.getNpcByID(t,!1);break;case 4:(o=xworld.getModel(t))&&(i=o.getPet());break;case 5:var o;(o=xworld.getModel(t))&&(i=o.getMercenaryById(e))}return i},t.prototype.setAutoMoveEndStep=function(){this.int1=t.AUTO_MOVE_END_STEP},t.prototype.isAutoMoveEndStep=function(){return this.int1==t.AUTO_MOVE_END_STEP},t.createMove=function(e,n,i,o){var a=new t(t.TYPE_MOVE);return a.byte1=i,a.byte0=n,a.byte2=o,a.int0=e,a},t.createPixelMove=function(e,n,i,o){return t.createPixelMoveWithGroup(e,n,i,o,0)},t.createPixelMoveWithGroup=function(e,n,i,o,a){var r=new t(t.TYPE_PIXEL_MOVE);return r.byte0=n,r.byte1=i,r.byte2=o,r.int0=e,r.int1=a,r},t.createMoveTo=function(e,n,i){var o=new t(t.TYPE_MOVE_TO);return o.byte0=n,o.byte1=i,o.int0=e,o},t.createJumpMap=function(e,n,i){var o=new t(t.TYPE_JUMP_MAP);return o.int0=e,o.byte0=n,o.byte1=i,o},t.createBattleUseSkillControl=function(e,n,i,o,a,r,s,l){var _=new t(t.TYPE_BATTLE_SKILL);_.byte0=e;var h=new egret.ByteArray;h.writeByte(n);var u=0;return i>=0&&(u=Tool.setBit(!0,t.BCONTROL_HAS_AREA_LIST,u)),s>0&&(u=Tool.setBit(!0,t.BCONTROL_HAS_ANIME2,u)),null!=l&&(u=Tool.setBit(!0,t.BCONTROL_HAS_NAME,u)),h.writeByte(u),Tool.isBit(t.BCONTROL_HAS_AREA_LIST,u)&&h.writeByte(i),h.writeByte(o),h.writeByte(a),h.writeShort(r),Tool.isBit(t.BCONTROL_HAS_ANIME2,u)&&h.writeShort(s),Tool.isBit(t.BCONTROL_HAS_NAME,u)&&h.writeUTF(l),_.datas=h,_},t.createBattleEscape=function(e,n){var i=new t(t.TYPE_BATTLE_ESCAPE);return i.byte0=e,i.byte1=n,i},t.createBattleTargetEffectOther=function(e,n,i,o){return t.createBattleTargetEffect(!1,e,n,i,o)},t.createBattleTargetEffect=function(e,n,i,o,a,r){void 0===r&&(r=0);var s=new t(t.TYPE_BATTLE_TARGET_EFFECT);return e&&(s.type=t.TYPE_BATTLE_SELF_EFFECT),s.byte0=n,s.counter=o,s.int0=i,s.int1=a,s.int2=r,s},t.prototype.toBytesBattleEffect=function(t){this.int0>3e4||this.int0<-3e4?this.counter|=BattleConst.EFFECT_INT_VALUE:this.int0>120||this.int0<-120?this.counter|=BattleConst.EFFECT_SHORT_VALUE:this.counter|=BattleConst.EFFECT_BYTE_VALUE,0!=this.int1&&(this.counter|=BattleConst.EFFECT_HAS_ANIME),t.writeByte(this.byte0),t.writeShort(this.counter),Battle.isEffectStatus(this.counter,BattleConst.EFFECT_INT_VALUE)?t.writeInt(this.int0):Battle.isEffectStatus(this.counter,BattleConst.EFFECT_SHORT_VALUE)?t.writeShort(this.int0):Battle.isEffectStatus(this.counter,BattleConst.EFFECT_BYTE_VALUE)&&t.writeByte(this.int0),Battle.isEffectStatus(this.counter,BattleConst.EFFECT_HAS_ANIME)&&t.writeShort(this.int1)},t.prototype.fromBytesBattleEffect=function(t){this.byte0=t.readByte(),this.counter=t.readShort(),Battle.isEffectStatus(this.counter,BattleConst.EFFECT_INT_VALUE)?this.int0=t.readInt():Battle.isEffectStatus(this.counter,BattleConst.EFFECT_SHORT_VALUE)?this.int0=t.readShort():Battle.isEffectStatus(this.counter,BattleConst.EFFECT_BYTE_VALUE)&&(this.int0=t.readByte()),Battle.isEffectStatus(this.counter,BattleConst.EFFECT_HAS_ANIME)&&(this.int1=65535&t.readShort())},t.prototype.toBytesBattleEscape=function(t){t.writeByte(this.byte0),t.writeByte(this.byte1)},t.prototype.fromBytesBattleEscape=function(t){this.byte0=t.readByte(),this.byte1=t.readByte()},t.prototype.toBytesBattleSkill=function(e){if(e.writeByte(this.byte0),e.writeShort(null==this.datas?0:this.datas.length),null!=this.datas&&e.writeBytes(this.datas),e.writeByte(null==this.subControls?0:this.subControls.length),null!=this.subControls)for(var n=0;n<this.subControls.length;n++){var i=this.subControls[n];null!=i?e.writeBytes(i.toBytes()):e.writeByte(t.TYPE_NONE)}},t.prototype.fromBytesBattleSkill=function(e){this.byte0=e.readByte();var n=e.readShort();n>0&&(this.datas=new egret.ByteArray,e.readBytes(this.datas,0,n));var i=e.readByte();if(i>0){this.subControls=new Array(i);for(var o=0;i>o;o++){var a=new t(e.readByte());a.fromBytes(e),this.subControls[o]=a}}},t.prototype.fromBytes=function(e){switch(this.type){case t.TYPE_BATTLE_SKILL:this.fromBytesBattleSkill(e);break;case t.TYPE_BATTLE_ESCAPE:this.fromBytesBattleEscape(e);break;case t.TYPE_BATTLE_TARGET_EFFECT:case t.TYPE_BATTLE_SELF_EFFECT:this.fromBytesBattleEffect(e)}},t.fromBytes=function(e){var n=new t(e.readByte());return n.fromBytes(e),n},t.prototype.toBytes=function(){var e=new egret.ByteArray;switch(e.writeByte(this.type),this.type){case t.TYPE_BATTLE_SKILL:this.toBytesBattleSkill(e);break;case t.TYPE_BATTLE_ESCAPE:this.toBytesBattleEscape(e);break;case t.TYPE_BATTLE_TARGET_EFFECT:case t.TYPE_BATTLE_SELF_EFFECT:this.toBytesBattleEffect(e)}return e.position=0,e},t.removeControlByType=function(t,e){if(null!=t){var n=t.length;if(0!=n)for(var i=n-1;i>=0;i--){var o=t[i];null!=o&&o.type==e&&t.splice(i,1)}}},t.DEFAULT_MOVE_SPEED=14,t.AUTO_MOVE_END_STEP=1,t.TYPE_NONE=0,t.TYPE_JUMP_MAP=1,t.TYPE_MOVE_TO=14,t.TYPE_MOVE=15,t.TYPE_PIXEL_MOVE=80,t.TYPE_CHANGE_STAGE=81,t.BCONTROL_HAS_AREA_LIST=1,t.BCONTROL_HAS_NAME=2,t.BCONTROL_HAS_ANIME2=4,t.TYPE_BATTLE_SKILL=31,t.TYPE_BATTLE_ESCAPE=32,t.TYPE_BATTLE_TARGET_EFFECT=33,t.TYPE_BATTLE_SELF_EFFECT=34,t.FLAG_FINISH=2,t.FLAG_INIT=4,t}();__reflect(Control.prototype,"Control");var GameWorld=function(){function t(){this.opengm=!1,this.actorCreatableCount=1,this.kickBySelf=!1,this._npcList=[],this.otherModels={},this.isBattleFailFirst=!0,this.isBattleFailFirst_mer=!0,this.share_title="世界Online",this.share_desc="国民经典IP，再度唤醒你的记忆~自由交易，游戏致富不是梦",this.isDrawMicroReward=!1,this.isShare=!1,this.isFollow=!1,this.noviceQuickBattle=!1,this.remoteBattleExp=-1,this.remoteBattleMoney=-1,this.shopID=-1,this._touchNpcID=-1,this._isAutoMissionFindPath=!1,this._inBattle=!1,this.inBattleResult=!1,this.battleChangeMap=!1,this.readyToBattle=!1,this._isJumpingMap=!1,this.hidingOtherPlayers=!1,this.heartbeatInterval=0,this.monsterGroupList={},this.monsterList={},this.currentTargetMonster=null,this.battleSeed=0,this.nextBattleTime=0,this.nextSyncTime=0,this.counter=0,this.lastTickTime=0,this.loopTick=!1,this.arenaBattlecount=0,this.myMoveSpeed=Control.DEFAULT_MOVE_SPEED,this.head=0,this.tail=0,this.POINTER_NEARFY=[[0,0],[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,-1],[-1,1],[1,1],[-2,2],[-2,1],[-2,0],[-2,-1],[-2,-2],[-1,-2],[0,-2],[1,-2],[2,-2],[2,-1],[2,0],[2,1],[2,2],[1,2],[0,2],[-1,2]],this.equipChangeList=new Array,this._bagEquipChangeList=new Array,this.isEquipChangePanelShow=!1}return t.isCountryWarStatus=function(){return null!=t.countryWar},Object.defineProperty(t.prototype,"npcList",{get:function(){return this._npcData&&(this._npcList=NPC.loadNPC(this._npcData),this._npcData=null),this._npcList},enumerable:!0,configurable:!0}),t.prototype.clearNPC=function(){this._npcList=[],this._npcData=null},t.getGuideFrame=function(e){return null==t.guideFrame?(t.guideFrame=new GuideFrame(e),t.guideFrame):(t.guideFrame.updateMessage(e),t.guideFrame)},t.guideError=function(){return t.guideErrorCount+=1,t.guideErrorCount>=5&&(t.cleanGuide(),!0)},t.setGuide=function(t,e,n){},t.isHaveGuide=function(){},t.setGuideWithClearKey=function(t,e,n){},t.cleanGuide=function(){t.guideFrame&&(t.guideFrame.isShow=!1),UILayer.instance.forceGuideLayer.contains(guide.rectBox)&&UILayer.instance.forceGuideLayer.removeChild(guide.rectBox),t.guideType=t.GUIDE_NONE,t.guideRect=null,t.guideErrorCount=0,guide.finishRectBoxGuide(),guide.finishArrowGuide(),t.bigGuideType=0,guide.arrow_direction=guide.GUIDE_ARROW_DOWN},t.setGuideRect=function(e,n,i,o,a){void 0===a&&(a=!1),t.guideRect=new guide.Rect(e,n,i,o),guide.startRectBoxGuide(e,n,i,o,a),guide.startArrowGuide(e,n,i,o)},t.doGuide=function(t){},t.doTourist=function(e,n){function i(){var t=MsgHandler.createAutoCreateActor(e,n);nato.Network.sendCmd(t,o,this)}function o(t){if(0>t.getByte())AlertPanel.alertCommon(t.getString());else{var e=t.getInt(),n=new ListPlayer;n.setId(e),xworld.createMyPlayer(n.getId(),n.getName()),Login.instance.doPlayerLogin(),PanelManager.closeTouristPanel()}}var a=MsgHandler.createAutoCreatePlayer();nato.Network.sendCmd(a,(function(e){var n=e.getByte();if(0>n){var o=e.getString();n==t.CREATE_ERR_NEED_IMAGE_CHECK||AlertPanel.alertCommon(o)}else{t.username=e.getString(),t.password=e.getString(),t.tempUsername=t.username,t.tempPassword=t.password,t.ukey=e.getLong(),t.sessionId=e.getInt(),e.getString(),Login.instance.saveAccountInStorage(t.username,t.password);var a=ServerInfo.fromTouristBytes(e);Login.doPlayerListMsg(a.lineList[0],!1,i,this)}}),this)},t.isTouristActorName=function(t){return 1!=Tool.isNullText(t)&&t.substring(0,2)==GameText.STR_TOURIST},t.isTouristPlayerName=function(e){if(1==Tool.isNullText(e))return!1;if((e=e.toLowerCase()).substring(0,2)!=t.HOLE_ACCOUNT_NAME)return!1;var n=e.substring(t.HOLE_ACCOUNT_NAME.length);return 0!=Tool.isNumberString(n)},t.checkTourist=function(){return 0!=t.doModifyTourist(!1,!1)&&(AlertPanel.alert(GameText.STR_TOURIST_REGISTER,GameText.STR_TOURIST_REGISTER_ASK,(function(){t.doModifyTourist(!0,!1)}),this),!0)},t.doModifyTourist=function(e,n){var i="",o=xself;if(null!=o&&(i=o.getName(),1==n&&o.getLevel()<t.TOURIST_MODIFY_LEVEL))return!1;if(t.isTouristActorName(i)){if(1==e){var a=Tool.manageString(GameText.STR_TOURIST_CHAGENAME_INFO,o.getName());AlertPanel.alert(GameText.STR_TYPE_MODIFY_NAME,a,t.doTouristModifyActorName,t)}return!0}var r=t.username;if(1==t.isTouristPlayerName(r)){if(1==e){a=Tool.manageString(GameText.STR_TOURIST_CHAGENAME_ACCOUNT,r);AlertPanel.alertNotify(GameText.STR_TYPE_MODIFY_ACCCOUNT,a,t.doModifyPlayerName,t,PopUpManager.CloseType.NONE,!1)}return!0}return!1},t.doTouristModifyActorName=function(){return t.doModifyActorName(!0,-1)},t.doModifyActorName=function(e,n){var i=xself;if(null==i)return AlertPanel.alertCommon(GameText.STR_PLAYER_NULL_TITLE),!1;var o=i.getName();return(!e||0!=t.isTouristActorName(o))&&(PanelManager.openModifyNamePanel((function(o){var a;a=e?MsgHandler.createModifyActorName(o):MsgHandler.createModifyActorNameByItem(o,n),nato.Network.sendCmd(a,(function(a){var r=a.getByte();if(0>r)return e&&PanelManager.modifyNamePanel.setTips(a.getString()),!1;if(i.setName(o),1==e){var s=new StringBuffer;1==r&&MsgHandler.processUpLevelMsg(a,i,s),GameText.STR_MODIFY_NAME_SUCESS,s.toString(),t.doModifyTourist(!0,!1)}else null!=i.bag&&i.bag.removeBagItemByPos(n,1),AlertPanel.alertCommon(GameText.STR_MODIFY_NAME_SUCESS);PanelManager.closeModifyNamePanel()}),this)}),this),!0)},t.doModifyPlayerName=function(){var e=t.username;1==t.isTouristPlayerName(e)&&PanelManager.openModifyAccountPanel(t.sendModifyPlayerName,t)},t.sendModifyPlayerName=function(e,n){function i(){PanelManager.openModifyAccountPanel(t.sendModifyPlayerName,t)}if(1!=Tool.isNullText(e)&&1!=Tool.isNullText(n)){var o=t.username,a=t.password,r=MsgHandler.createModifyPlayerName(o,a,e,n);nato.Network.sendCmd(r,(function(o){var a=o.getByte();if(0>a){var r=o.getString();return AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),r,i,this),void(a==t.ERROR_USER_NAME&&(t.tempChangeNameInfo=o.getString()))}t.username=e,t.password=n,t.tempUsername=t.username,t.tempPassword=t.password,Login.instance.saveAccountInStorage(e,n),AlertPanel.alertCommon(GameText.STR_CHAGENAME_ACCOUNT_SUCCESS),xself.clearStatusBit(ModelConst.STATUS_IS_TOURIST),PanelManager.closeModifyAccountPanel()}),this)}},t.doWorldTouristFiveLevel=function(){var e=xself;return null!=e&&e.isTourist()&&e.getLevel()==t.TOURIST_FORCE_REGISTER_LEVEL?void t.doModifyTourist(!0,!1):void PanelManager.openRoleScene()},Object.defineProperty(t.prototype,"inBattle",{get:function(){return this._inBattle},set:function(t){this._inBattle=t,xself&&(this._inBattle?this.setOtherModelsVisible(!1):this.setOtherModelsVisible(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isJumpingMap",{get:function(){return this._isJumpingMap},set:function(t){this._isJumpingMap=t},enumerable:!0,configurable:!0}),t.prototype.setOtherModelsVisible=function(t){var e=this.otherModels,n=this.npcList;for(var i in e){var o=e[i];o.visible=t,o.getPet()&&(o.getPet().visible=t),this.setMerListVisible(o,t)}for(var i in n){n[i].visible=t}xself.visible=t,this.myPlayerPosSprite.visible=t,this.pointerSprite.visible=!1,this.gameMap&&this.gameMap.playerLayer&&this.gameMap.playerLayer.setNPCNameVisible(t);var a=xself.getPet();a&&(a.visible=t),this.setMerListVisible(xself,t)},t.prototype.setMerListVisible=function(t,e){var n=t.merList;if(null!=n&&0!=n.length)for(var i=n.length,o=0;i>o;o++)null!=n[o]&&(n[o].visible=e)},t.getPlayerID=function(){return null!=xself?xself.getId():-1},t.getMyPetID=function(){return null!=xself&&null!=xself.getPet()?xself.getPet().getId():-1},t.getCurMapID=function(){var t=-1;return null!=xworld.gameMap&&(t=xworld.gameMap.mapId),t},t.prototype.setLevelUPEffect=function(){function t(){0!=e.loaded&&0!=n.loaded&&(e.play(),n.play(),e.x=-40,e.y=-90,xself.addChildAt(e,0),n.x=-40,n.y=-100,xself.addChild(n))}var e=new MovieClip("levelup",1,t,this),n=new MovieClip("levelup2",1,t,this);e.load(),n.load()},t.prototype.preload=function(){this.myPlayerPosSprite=SpriteHelper.createSprite(GameSprite.SPRITE_MYPLAYER_POS),this.myPlayerPosSprite.name="myPlayerPosSprite",this.pointerSprite=SpriteHelper.createSprite(GameSprite.SPRITE_POINTER_EFFECT),this.pointerSprite.anchorOffsetX=MapSetup.GRID_HALF_WIDTH,this.pointerSprite.anchorOffsetY=MapSetup.GRID_HALF_HEIGHT,this.pointerSprite.name="pointerSprite",this.pointerSprite.setMotionAlive(!0),this.blockImg=this.createBattleImage(ImageSet.IMG_SET_BATTLE_BLOCK,1.2),this.missImg=this.createBattleImage(ImageSet.IMG_SET_BATTLE_MISS,1.2),this.offsetImg=this.createBattleImage(ImageSet.IMG_SET_BATTLE_OFFSET,1.2)},t.prototype.stopUpdate=function(){this.loopTick=!1,nato.WorldTicker.instance.unregister(this.onUpdate,this),window.clearInterval(this.heartbeatInterval)},t.prototype.startUpdate=function(){nato.WorldTicker.instance.register(this.onUpdate,this),this.loopTick=!0,this.heartbeatInterval=window.setInterval(this.sendHeartbeat,1e3),t.gameStartTime=egret.getTimer()},t.prototype.sendHeartbeat=function(){MsgHandler.doSocketHeart()},t.prototype.createBattleImage=function(t,e){void 0===e&&(e=1);var n=new egret.Bitmap;return n.texture=nato.findTextureForSheet(t),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.scaleX=e,n.scaleY=e,n},t.prototype.getCurMapID=function(){var t=-1;return this.gameMap&&(t=this.gameMap.mapId),t},t.prototype.createMyPlayer=function(t,e){(xself=new Player).setId(t),xself.setName(e)},Object.defineProperty(t.prototype,"isNewPlayer",{get:function(){return!(!xself||1!=xself.get(ModelConst.LEVEL)||0!=xself.missionList.length)},enumerable:!0,configurable:!0}),t.prototype.addMyPlayerToGameMap=function(){if(null!=this.gameMap&&null!=this.gameMap.playerLayer){var t=this.gameMap.playerLayer;t.addChild(xself),xself.getPet()&&t.addChild(xself.getPet());var e=xself.merList;if(e)for(var n=0,i=e.length;i>n;n++)e[n]&&t.addChild(e[n]);this.gameMap.addToForeground(this.myPlayerPosSprite),this.isNewPlayer&&PanelManager.openWelcomePanel()}},t.doJumpRebornMap=function(){xworld.doJumpMap(-1,0,0,!1)},t.prototype.doJumpMap=function(t,e,n,i){if(void 0===i&&(i=!1),null!=xself&&!xself.isShopMode()){if(this.getCurMapID()==t)return void(0==xself.isMember()&&xself.setPosition(e,n));var o=MsgHandler.createJumpMapMessage(t,e,n,Define.JUMP_MAP_DATA_FLAG);nato.Network.sendCmd(o),this.isJumpingMap=!0,GuideHandler.setGuideWidgetVisible(!0),GuideHandler.cityTaskGuide()}},t.prototype.addModel=function(t){null!=this.otherModels&&null!=t&&(xself&&t.getId()==xself.getId()||(this.otherModels[t.getId()]=t))},t.prototype.removeModel=function(t){null!=this.otherModels&&delete this.otherModels[t]},t.prototype.getModel=function(t){return xself&&t==xself.getId()?xself:null==this.otherModels?null:this.otherModels[t]},t.prototype.clearNPCList=function(){if(null!=this._npcList){for(var t,e=this._npcList,n=e.length,i=0;n>i;i++)(t=e[i])&&t.parent&&t.parent.removeChild(t);this._npcList=null}},t.prototype.setNPCData=function(t){return this.clearNPCList(),null!=t?(this._npcData=t,this.gameMap.loaded?void this.initNpcLoading():void 0):void 0},t.prototype.initNpcLoading=function(){var t=this.npcList;t&&(NPC.initNPCListData(t),this.gameMap.updateSmallMapNpcIcon())},t.prototype.getNpcByID=function(t,e){var n=this.npcList;if(null==n)return null;for(var i,o=n.length,a=0;o>a;a++)if(null!=(i=n[a])&&(!e||i.isVisible())&&i.getId()==t)return i;return null},t.prototype.getNpcByPos=function(t,e){var n=[],i=this.npcList;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=i[o];a.getGx()==t&&a.getGy()==e&&n.push(a)}return n},t.prototype.getAchieveNPC=function(){var t=this.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n.isAchieveNPC)return n}return null},t.getSuit=function(e){return t.suitList[e]},t.addSuit=function(e,n){null!=n&&(t.suitList[e]=n)},t.prototype.getMonsterGroup=function(t){return 0>=t?null:this.monsterGroupList[t]},t.prototype.addMonsterGroup=function(t){if(null!=t){var e=t.groupId;this.monsterGroupList[e]=t}},t.prototype.getMonster=function(t){return this.monsterList[t]},t.prototype.addMonster=function(t){if(null!=t){var e=t.getId();this.monsterList[e]=t}},t.prototype.autoMoveToMonster=function(t){for(var e=!1,n=xself,i=xworld.npcList,o=xworld.monsterGroupList,a=!0,r=null,s=i.length,l=0;s>l;l++){var _=i[l];if(_.isMonster){var h=o[_.battleID[0]];if(null!=h&&-1!=h.monsters.indexOf(t)){if(!_.isEnable()||!_.isVisible()){Math.abs(n.x-_.x)+Math.abs(n.y-_.y)>MapSetup.GRID_WIDTH&&(r=_);continue}a=!1,xworld.currentTargetMonster=_;var u=Control.createMoveTo(n.getId(),_.getGx(),_.getGy());n.addControl(u),e=!0;break}}}return a&&null!=r&&r.rebornImmediately(),e},t.findNearestMonster=function(){for(var t,e=xworld.npcList,n=null,i=9999,o=0,a=e.length;a>o;o++)if((t=e[o]).isEnable()&&t.isVisible()&&t.isMonster&&!(t.battleID&&t.battleID.length>0&&0==t.battleID[0])){var r=Math.abs(xself.x-t.x)+Math.abs(xself.y-t.y);i>r&&(i=r,n=t)}return n},t.prototype.getBattleByGroupID=function(t){var e=this.getMonsterGroup(t);if(null==e)return null;var n=MonsterGroup.getLocalBattlePlayerList(xself,e);return this.battleSeed=Tool.nextSeed(this.battleSeed),Battle.createLocalBattle(this.battleSeed,n,e)},t.prototype.toBattle=function(e,n){if(n&&egret.getTimer()<this.nextBattleTime)return!1;if(window.forbidBattle)return!1;var i=!1;xself.isLeader()&&xself.isHasPlayerMember()&&(i=!0),Define.isNetBattleID(e)&&(i=!0),t.isEscortStatus()&&(i=!0);var o=null;if(i||null==(o=this.getBattleByGroupID(e))&&(i=!0),this.syncMoveTo(),i){var a=MsgHandler.createEnterRemoteBattle(e);nato.Network.sendCmd(a),window.BATTLE_ID=e}else{a=MsgHandler.createEnterLocalBattle();nato.Network.sendCmd(a),this.nextSyncTime=0,this.battle=o;var r=BattleView.instance;r.setBattle(o),Main.instance.addGame(r),egret.callLater(this.gotoBattleStage,this),window.BATTLE_ID=e,window.__myEvent__.emit("enter:battle:map")}return xworld.currentTargetMonster=null,this.nextBattleTime=egret.getTimer()+t.SYNC_BATTLE_INTERVAL,!0},t.prototype.gotoBattleStage=function(){BattleView.instance.initBattle()},t.doBattleSeeInter=function(t){var e=MsgHandler.createFightSeeInterMsg(t);nato.Network.sendCmd(e)},t.prototype.hpRecover=function(t){null!=t&&(t.get(ModelConst.LEVEL)<10?t.hp=t.get(ModelConst.HPMAX):t.hp=1)},t.prototype.handeBattleEndHp=function(t){var e=xself;if(null!=e){if(0==t){var n=e.getBagEquipPowerValue(Define.POWER_HPMP_RECOVER);OfflineExp.isOpen&&(n+=OfflineExp.info.hpRecover),n>0&&(Define.addValuePlayer(e,ModelConst.HP,n,!0,ModelConst.HPMAX),Define.addValuePlayer(e,ModelConst.MP,n,!0,ModelConst.MPMAX))}e.isDead()&&this.hpRecover(e);var i=e.getPet();i&&i.isDead()&&this.hpRecover(i);var o=e.getMerList();if(o)for(var a=0;a<o.length;a++){var r=o[a];if(null!=r){r.isDead()&&this.hpRecover(r);var s=r.getPet();s&&s.isDead()&&this.hpRecover(s)}}}},t.prototype.handleMyPlayerDurability=function(t,e){var n=xself;if(null!=n){this.handeBattleEndHp(e);var i=n.bag;null!=i&&(i.checkEquipTimeItem(),i.handlePlayerDurability(t),n.checkHPMP(),xself.checkPower())}},t.prototype.onTick=function(t){var e=t-this.lastTickTime;return!(4>e)&&(this.lastTickTime=t,GameSpriteManager.instance.loop(e),0!=this.loopTick&&(this.inBattle||this.isJumpingMap||(this.gameMap&&this.gameMap.ontick(e),xself.logicPlayer(1),this.updatePlayerPosSprite(1)),!0))},t.prototype.onUpdate=function(e){if(1==this.loopTick){this.counter+=1,this.counter>1e3&&(this.counter=0);var n=this.counter;if(AutoGamer.logic(n),MovieClipManager.instance.logic(n),OnlineReward.instance.onlineLogic(e),TodayEvent.logic(e),1==t.useGuide&&t.doGuide(n),this.inBattle&&(t.isNewArenaStatus()?this.newArenaBattleLogic(n,e):BattleView.instance.logic(n,e)),Main.pointReleasedFlag!=Main.POINTER_NO&&Main.cleanPointerKey(),t.isSkyArenaStatus()&&!this.inBattle)return void t.skyarena.logic(n);if(t.isArenaStatus()&&!this.inBattle)return void t.arena.logic(n);if(t.isNewArenaStatus()&&!this.inBattle)return void t.newArena.logic(n);if(!this.inBattle&&!this.isJumpingMap){if(this.gameMap&&this.gameMap.update(n),xself&&this._touchNpcID>=0){var i=xself.getControlList();i&&0==i.length&&(this.doNPC(),this.setTouchNpcId(-1))}var o=this.otherModels;for(var a in o){o[a].logicPlayer(n)}xworld.logicNPCs()}this.doSync()}},t.prototype.newArenaBattleLogic=function(e,n){if(this.arenaBattlecount++,PanelManager.battleUI.hideMenu(),this.arenaBattlecount>NewArena.NEWARENA_BATTLE_TIME&&(this.arenaBattlecount=0,null!=this.vNewAreanbattle&&this.vNewAreanbattle.length>0)){var i=this.vNewAreanbattle[0];if(null!=i){if(this.battle.setBattleResult(i.result),this.battle.round=i.round,this.battle.roundEndTime=i.planTime,this.battle.waitStatus=i.waitStatus,this.battle.setRemoteWaiting(!1),null!=i.vplayer&&i.vplayer.length>0)for(var o=0;o<i.vplayer.length;o++){var a=i.vplayer[o];if(null!=a){var r=this.battle.getPlayerByPos(a.pos);if(null==r)continue;r.hp=a.hp,r.mp=a.mp,r.bStatus=a.bstatus}}if(null!=i.vresultControlList&&i.vresultControlList.length>0)for(var s=0;s<i.vresultControlList.length;s++){var l=i.vresultControlList[s];null!=l&&this.battle.addAniControl(l)}BattleView.instance.makeBattleAni(),0!=i.result&&(this.handleMyPlayerDurability(!1,!0),PanelManager.updateWorldIconPoint(),PanelManager.mainMenu.headInfoView.update());var _=this.vNewAreanbattle.indexOf(i);this.vNewAreanbattle.splice(_,1)}}BattleView.instance&&((null==this.vNewAreanbattle||this.vNewAreanbattle.length<1)&&BattleView.instance.setEndCounter(),BattleView.instance.logic(e,n)),(null==this.vNewAreanbattle||this.vNewAreanbattle.length<1)&&this.arenaBattlecount>NewArena.NEWARENA_BATTLE_TIME/2&&(BattleView.instance.doExit(),this.cleanNewArenaBattle(),null!=t.newArena&&(t.newArena.isAlert=!0),NewArena.doEnter(!0))},t.prototype.cleanNewArenaBattle=function(){if(null!=xself){xself.resetBattleBuffer();var t=xself.getPet();null!=t&&t.resetBattleBuffer()}},t.prototype.logicNPCs=function(){if(t.isEscortStatus())return!1;for(var e=this.npcList,n=0,i=e.length;i>n;n++)e[n].logic(this.counter)},t.prototype.doSync=function(){Date.now()<this.nextSyncTime||(this.syncMoveTo(),this.synOtherMoveTo(),this.nextSyncTime=Date.now()+t.SYNC_INTERVAL)},t.prototype.initMyPlayerSyncPosition=function(){var t=xself;null!=t&&(this.lastMoveTOGx=t.getGx(),this.lastMoveTOGy=t.getGy())},t.prototype.syncMoveTo=function(){var t=xself;if(null!=t&&null!=this.gameMap&&!this.inBattle&&1!=t.isMember()){var e=t.getGx(),n=t.getGy();if(e!=this.lastMoveTOGx||n!=this.lastMoveTOGy){var i=MsgHandler.createMoveMessage(e,n);nato.Network.sendCmd(i,null,null),this.lastMoveTOGx=e,this.lastMoveTOGy=n}}},t.prototype.synOtherMoveTo=function(){if(null!=this.gameMap){var t=MsgHandler.createOtherMoveMessage();nato.Network.sendCmd(t,null,null)}},t.prototype.updatePlayerPosSprite=function(t){null!=this.myPlayerPosSprite&&null!=xself&&null!=xself.sprite&&(this.myPlayerPosSprite.x=xself.x+MapSetup.GRID_HALF_WIDTH,this.myPlayerPosSprite.y=xself.y-xself.sprite.getHeight()+MapSetup.GRID_HEIGHT)},t.prototype.getSpeed=function(t){return t==xself?this.myMoveSpeed:Control.DEFAULT_MOVE_SPEED},t.prototype.findPath=function(t,e,n,i,o,a){for(var r,s,l,_,h=n,u=i,c=this.gameMap.setup;o>0;)o--,s=h+1,l=u-1,_=u+1,(r=h-1)>=0&&c.searchStep[u][r]==o?(h=r,a.unshift(0)):s<c.mapColumns&&c.searchStep[u][s]==o?(h=s,a.unshift(1)):l>=0&&c.searchStep[l][h]==o?(u=l,a.unshift(2)):_<c.mapRows&&c.searchStep[_][h]==o&&(u=_,a.unshift(3))},t.prototype.searchPath=function(t,e,n,i,o){var a=[];if(null==this.gameMap)return a;var r=this.gameMap.setup;if(0>t||0>e||t>=r.mapColumns||e>=r.mapRows)return a;r.clearSearchTable(),this.tail=0,this.head=0;var s=0,l=0,_=0;for(r.searchStep[e][t]=_,r.nextSearchPosX[this.head]=t,r.nextSearchPosY[this.head++]=e;this.head>this.tail;){s=r.nextSearchPosX[this.tail],l=r.nextSearchPosY[this.tail++],_=r.searchStep[l][s]+1;var h=s-1,u=s+1,c=l-1,T=l+1;if(h>=0&&this.canSearchCross(h,l,n,i,o)&&-1==r.searchStep[l][h]&&(r.nextSearchPosX[this.head]=h,r.nextSearchPosY[this.head++]=l,r.searchStep[l][h]=_,h==n&&l==i)){this.findPath(t,e,n,i,r.searchStep[i][n],a);break}if(T<r.mapRows&&this.canSearchCross(s,T,n,i,o)&&-1==r.searchStep[T][s]&&(r.nextSearchPosX[this.head]=s,r.nextSearchPosY[this.head++]=T,r.searchStep[T][s]=_,s==n&&T==i)){this.findPath(t,e,n,i,r.searchStep[i][n],a);break}if(u<r.mapColumns&&this.canSearchCross(u,l,n,i,o)&&-1==r.searchStep[l][u]&&(r.nextSearchPosX[this.head]=u,r.nextSearchPosY[this.head++]=l,r.searchStep[l][u]=_,u==n&&l==i)){this.findPath(t,e,n,i,r.searchStep[i][n],a);break}if(c>=0&&this.canSearchCross(s,c,n,i,o)&&-1==r.searchStep[c][s]&&(r.nextSearchPosX[this.head]=s,r.nextSearchPosY[this.head++]=c,r.searchStep[c][s]=_,s==n&&c==i)){this.findPath(t,e,n,i,r.searchStep[i][n],a);break}}return a},t.prototype.canSearchCross=function(t,e,n,i,o){return this.gameMap.isCanPass(t,e)},t.prototype.onFindWay=function(t,e){if(null!=this.gameMap){var n=this.gameMap.globalToLocal(t,e),i=n.x,o=n.y;this.setPointer(i+MapSetup.GRID_HALF_WIDTH,o+MapSetup.GRID_HALF_HEIGHT,GameSprite.ANIMATION_MAP_POINTER_PRESS);for(var a=Math.floor(xself.x/MapSetup.GRID_WIDTH),r=Math.floor(xself.y/MapSetup.GRID_HEIGHT),s=Math.floor(i/MapSetup.GRID_WIDTH),l=Math.floor(o/MapSetup.GRID_HEIGHT),_=s,h=l,u=0;u<this.POINTER_NEARFY.length&&(_=s+this.POINTER_NEARFY[u][0],h=l+this.POINTER_NEARFY[u][1],!this.gameMap.isCanPass(_,h));u++)if(u==this.POINTER_NEARFY.length-1)return;s=_,l=h;var c=this.gameMap.findPath(a,r,s,l,MapSetup.GRID_WIDTH),T=this.gameMap.changeDirMoveVectorToPixelMove(Control.DEFAULT_MOVE_SPEED,c);xself.removeAllControl();for(var p=0,d=T;p<d.length;p++){var E=d[p],g=Tool.getXKey(E),S=Tool.getYKey(E),m=Control.createPixelMove(xself.getId(),g,S,xself.getType());xself.addControl(m)}T&&T.length>0&&PanelManager.npcDialogue&&PanelManager.npcDialogue.stage&&PanelManager.closeNPCDialogue(),this.setTouchNpcId(-1),this.setAutoMissionFindPath(!1),this.checkNpc(i,o)}},t.prototype.getTouchNpcId=function(){return this._touchNpcID},t.prototype.setTouchNpcId=function(t){this._touchNpcID=t},t.prototype.setAutoMissionFindPath=function(t){this._isAutoMissionFindPath=t},t.prototype.checkNpc=function(t,e){var n=this.getPointCheckNPC(t,e);null!=n&&1!=n.npcType&&4!=n.npcType&&n.isEnable()&&n.isVisible()&&this.setTouchNpcId(n.getId())},t.prototype.getPointCheckNPC=function(t,e){var n=this.npcList;if(null==n)return null;for(var i,o=n.length,a=0;o>a;a++)if(null!=(i=n[a])&&i.isVisible()&&1!=i.npcType&&4!=i.npcType){var r=MapSetup.GRID_WIDTH,s=MapSetup.GRID_HEIGHT,l=i.sprite;l&&(r=l.getWidth(),s=l.getHeight()),r>48&&(r=48),s>100&&(s=100);var _=i.x+MapSetup.GRID_HALF_WIDTH-r/2,h=i.y+MapSetup.GRID_HEIGHT-s;if(8!=i.npcType){if(Tool.rectIn(_,h,r,s,t,e))return i}else{var u=Math.floor(t/MapSetup.GRID_WIDTH),c=Math.floor(e/MapSetup.GRID_HEIGHT);if(i.isInJumpMapArea(u,c))return i}}return null},t.prototype.doNPC=function(){var t=this.npcList;for(var e in t){var n=t[e];if(n.getId()==this._touchNpcID){n.doNPC();break}}},t.getSkillById=function(t,e,n){if(null==t)return null;for(var i=0;i<t.length;i++){var o=t[i];if(null!=o&&o.id==e&&o.level==n)return o}return null},t.prototype.setPointer=function(t,e,n){this.pointerSprite.x=t,this.pointerSprite.y=e,this.gameMap.playerLayer.addChild(this.pointerSprite),this.pointerSprite.setMotionAlive(!0),this.pointerSprite.setMotionTurnOff(!0),this.pointerSprite.setCurAnimationAsIdAndTime(n,1)},t.doErrorJumpShop=function(e,n,i){function o(){t.doChestUseHighKey()}if(void 0===i&&(i=-1),null!=e){PopUpManager.closeAll();var a=e.getString();if(n==Define.BACK_ERROR_JUMP_SHOP){var r=e.getShort();AlertPanel.alert(GameText.STR_SYSTEM,Tool.manageString(GameText.STR_ERROR_JUMP_SHOP_ASK,a+"\n"),(function(){xworld.doBrowseShop(r,null,i)}),this)}else if(n==Define.BACK_ERROR_HIGH_KEY3)AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),a,o,this);else if(n==Define.BACK_ERROR_HIGH_KEY4)AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),a,o,this);else if(n==Define.BACK_ERROR_IDENTIFY_KEY){var s=e.getShort();AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),a,(function(){t.doIdentifyUseHighKey(s)}),this)}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),a,null,null,PopUpManager.CloseType.NONE)}},t.doChestUseHighKey=function(){if(null!=xself){var t=xself.bag;if(null!=t){var e=new nato.Message(ProtocolDefine.CG_CHEST_USE_HIGH_KEY);nato.Network.sendCmd(e,(function(e){if(null!=e){if(0>e.getByte())return void AlertPanel.alertCommon(e.getString());var n=e.getShort(),i=e.getByte(),o=(e.getInt(),e.getShort());t.removeBagItemByPos(n,i),t.removeBagItemByPos(o,1);var a=MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD);AlertPanel.alertCommon(a),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel()}}),this)}}},t.doIdentifyUseHighKey=function(t){var e=xself;if(null!=e){var n=e.bag;if(null!=n){var i=n.getItem(t);i&&(PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),ItemManager.doWorldIdentifyItemAction(e,i,!0))}}},t.prototype.doBrowseShop=function(e,n,i,o){void 0===i&&(i=-1),void 0===o&&(o=!1),PopUpManager.closeAll(),1!=t.doSpecialShop(e,n)&&(xworld.shopID=e,Define.isSoldierShop(e)?t.openMercenaryShop(e):Define.isComposeShop(e)?t.openOtherShop(ShopType.SUB_SHOP_COMBIN,e):Define.isIntegralShop(e)?t.openOtherShop(ShopType.SUB_SHOP_INTEGRAL,e):Define.isArenaShop(e)?t.openOtherShop(ShopType.SUB_SHOP_ARENA,e):Define.isSkyArenaShop(e)?t.openOtherShop(ShopType.SUB_SHOP_SKYARENA,e):Define.isPetShop(e)?t.openOtherShop(ShopType.SUB_SHOP_PETCOMPOSITE,e):Define.isFurnaceShop(e)?Furnace.doOpenFurnaceShop(e):Define.isEnchantShop(e)||Define.isEnchantCountryShop(e)?t.openOtherShop(ShopType.SUB_SHOP_ENCHANT,e):Define.isAdvancedShop(e)?t.openOtherShop(ShopType.SUB_SHOP_EQ_UPGRADE,e):Define.isGuessGameShop(e)?AlertPanel.alertCommon("敬请期待!"):(xworld.shopID=-1,ShopItem.openItemShop(e,i,o)))},t.doSpecialShop=function(e,n){if(e==Define.SHOP_ARENA_SINGLE)return Arena.doEnterArena(Arena.ARENA_TYPE_SINGLE,!0),!0;if(e==Define.SHOP_ARENA_TEAM)return Arena.doEnterArena(Arena.ARENA_TYPE_TEAM,!0),!0;if(e==Define.SHOP_COUNTRY_MENU)return PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS),!0;if(e==Define.SHOP_REPAIR_ID)return t.doRepairEquip(),!0;if(e==Define.SHOP_REWARD_CODE){if(0==SafeLock.doSafeLockVerify())return!0;return PanelManager.openEditNameView("输入","领取码","",(function(e){t.doSpecialCode(e)}),null,this),!0}if(e==Define.SHOP_REBORN_MAP){var i=MsgHandler.createSetRebornMapMsg(t.getCurMapID());return nato.Network.sendCmd(i,(function(t){MsgHandler.isMessageHaveError(t)||AlertPanel.alertCommon("设置成功")}),this),!0}return e==Define.SHOP_ESCORT_LIST?(Escort.doEscortRobListMsg(20,0),!0):e==Define.OFFLINE_MISSION_LIST?(Mission.doOffLineList(n),!0):e==Define.SHOP_STORE_VIP?(PanelManager.openStorePanel(StorePanel.Type_person_vip,xself),!0):e==Define.SHOP_STORE?(PanelManager.openStorePanel(StorePanel.Type_person,xself),!0):e==Define.SHOP_COUNTRY_STORE?(PanelManager.openStorePanel(StorePanel.Type_country,xself),!0):e==Define.SHOP_COUNTRY_SYSTEM_STORE?(PanelManager.openStorePanel(StorePanel.Type_country_system,xself),!0):e==Define.SHOP_COUNTRY_WAR?(CountryWar.doEnterWar(!0),!0):e==Define.SHOP_WAR_DECLARE?(Country.doGetWarDeclareInfo(),!0):e==Define.SHOP_WAR_INFO?(CountryWar.doEnterWar(!1),!0):e==Define.SHOP_CAMP?(PanelManager.openCountryArmyScene(),!0):e==Define.SHOP_UNIN?(PanelManager.openScene(PanelManager.getPanel(WarUnionScene)),!0):e==Define.SHOP_WAR_RESULT?(Country.doWinActionInfo(),!0):e==Define.SHOP_COUNTRY_MISSION?(PanelManager.openCountryTaskListPanel(CountryTaskListPanel.Type_Operate),!0):e==Define.SHOP_MARRY?(MarryHandler.doPartnerApply(),!0):e==Define.SHOP_DIVORCE?(MarryHandler.doPartnerDel(),!0):e==Define.SHOP_TEAMBOSS?(TeamBoss.doEnterTeamBoss(),!0):e==Define.SHOP_PLAYER_SELL||e==Define.SHOP_PLAYER_BUY?(AlertPanel.alertCommon("敬请期待!"),!0):e==Define.SHOP_QUESTION?(ListPlayer.doOpenQuestion(!1,!1),!0):e==Define.SHOP_QUESTION_VIP?(ListPlayer.doOpenQuestion(!0,!1),!0):e==Define.SHOP_QUESTION_SUPER_QQ?(ListPlayer.doOpenQuestion(!1,!0),!0):e==Define.SHOP_COUNTRY_VIPGETMONEY?(AlertPanel.alertCommon("敬请期待!"),!0):e>Define.SHOP_BACKUP_START&&e<Define.SHOP_BACKUP_END?(AlertPanel.alertCommon(GameText.STR_SHOP_BACKUP_START),!0):e>=MenuEventHandler.EVENT_ALL_MENU_WORLD_ITEM&&e<=MenuEventHandler.EVENT_ALL_MENU_END&&(MenuEventHandler.doMenuButton(e),!0)},t.openMercenaryShop=function(t){Mercenary.doMercenaryListMsg(MercenaryShop.pageDisplayNum,MercenaryShop.currentPage,PanelManager.openMercenaryShop)},t.openOtherShop=function(e,n){e==ShopType.SUB_SHOP_COMBIN||e==ShopType.SUB_SHOP_ENCHANT||e==ShopType.SUB_SHOP_EQ_UPGRADE?t.doEnterCombinShop(e,n):e==ShopType.SUB_SHOP_INTEGRAL||e==ShopType.SUB_SHOP_ARENA||e==ShopType.SUB_SHOP_SKYARENA?t.doGetIntegralShopList(e,n):e==ShopType.SUB_SHOP_PETCOMPOSITE?PetComposite.doGetPetCompositeShopData(n):AlertPanel.alertCommon("敬请期待!")},t.doEnterCombinShop=function(e,n,i){void 0===i&&(i=!1);PanelManager.openWaitForServer();var o=MsgHandler.createCombinShop(n);nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(o)){var a=o.getByte();if(0==a)return void AlertPanel.alertCommon(GameText.STR_COMBIN_SHOP_DATA_ERROR);for(var r=[],s=0;a>s;s++){var l=new ShopItem;ItemData.fromBytesAtts2(l,o),l.durability=l.durMax;var _=o.getByte(),h=o.getInt();l.setMoney(_,h),l.extraList=[];for(var u=o.getByte(),c=0;u>c;c++){var T=new ItemData;T.name=o.getString(),T.grade=o.getByte(),T.quantity=o.getInt(),T.id=o.getInt(),T.type=o.getByte(),l.extraList.push(T)}l.combinItemID=o.getInt(),(Define.isEnchantShop(n)||Define.isEnchantCountryShop(n))&&(l.enchantType=o.getByte(),l.enchantNeed=o.getInt()),l.combintype=o.getByte(),Define.isAdvancedShop(n)&&(l.isUpgradeItem=o.getBoolean(),l.power4=o.getShort(),l.powerValue4=o.getShort(),l.power5=o.getShort(),l.powerValue5=o.getShort(),l.power6=o.getShort(),l.powerValue6=o.getShort(),l.power7=o.getShort(),l.powerValue7=o.getShort()),r.push(l)}if(0==r.length)return void AlertPanel.alertCommon("合成商店为空!");t.doGetItemSuit(r),i?PanelManager.openTimeLimitExchangePanel(e,n,r):PanelManager.openOtherShopPanel(e,n,r)}}),this)},t.doGetIntegralShopList=function(t,e){var n=MsgHandler.createIntegralShop(e);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){for(var i=[],o=n.getByte(),a=0;o>a;a++){var r=new ShopItem;ShopItem.fromBytesAtts2(r,n),r.durability=r.durMax,Define.isIntegralShop(e)?r.integral=n.getInt():Define.isArenaShop(e)?r.arenaPoint=n.getInt():Define.isSkyArenaShop(e)&&(r.skyarenaPoint=n.getInt()),r.status=n.getByte(),r.maxBuy=n.getShort(),r.allCount=n.getShort(),i.push(r)}return 0==i.length?void AlertPanel.alertCommon("商店为空"):void PanelManager.openOtherShopPanel(t,e,i)}}),this),PanelManager.openWaitForServer()},t.doIntegralBuy=function(t,e){if(void 0===e&&(e=1),0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;var n=xself;if(null==n)return!1;var i=n.bag;if(null==i)return!1;if(0>=e)return AlertPanel.alertCommon(GameText.STR_INTEGRAL_BUY_NUM_NULL),!1;var o=xworld.shopID,a=Define.isIntegralShop(o),r=Define.isArenaShop(o),s=Define.isSkyArenaShop(o),l=function(e){PanelManager.closeWaitForServer();var o=e.getByte();if(0>o)AlertPanel.errorMessage(e.getString());else{if(2==o){var l=e.getInt();return a?n.integral=l:r?n.arenaPoint=l:s&&(n.skyarenaPoint=l),t.maxBuy=e.getShort(),void(t.allCount=e.getShort())}if(0==o){var _=e.getInt(),h=e.getShort(),u=e.getByte();l=e.getInt();a?n.integral=l:r?n.arenaPoint=l:s&&(n.skyarenaPoint=l);var c=t.clone();c.status=t.status,c.setExpireTime(c.ownTime),t.maxBuy=e.getShort(),t.allCount=e.getShort(),i.addItem(PlayerBag.TYPE_BAG_POS,c,u)!=h&&WorldMessage.addSystemChat("积分兑换物品兑换之后位置错误"),_!=t.id&&WorldMessage.addSystemChat("积分兑换物品兑换之后物品ID错误"),PanelManager.isPanelShow(OtherShopPanel)&&PanelManager.getPanel(OtherShopPanel).updateMoney(),AlertPanel.alertCommon(GameText.STR_INTEGRAL_BUY_SUCCESS)}}},_="";return a?_=PowerString.makeColorString(Tool.manageString(GameText.STR_INTEGRAL_INFO,t.integral*e+""),ColorUtils.COLOR_GREEN):r?_=PowerString.makeColorString(Tool.manageString(GameText.STR_INTEGRAL_ARENA_INFO,t.arenaPoint*e+""),ColorUtils.COLOR_GREEN):s&&(_=PowerString.makeColorString(Tool.manageString(GameText.STR_INTEGRAL_SKYARENA_INFO,t.skyarenaPoint*e+""),ColorUtils.COLOR_GREEN)),AlertPanel.alert(GameText.STR_CMD_TYPE_INTEGRAL_BUY,Tool.manageStringList(GameText.STR_INTEGRAL_BUY_ASK,[_,t.getNameInfo(),e+""]),(function(){var n=MsgHandler.createIntegralBuy(o,t.id,e);nato.Network.sendCmd(n,l,this),PanelManager.openWaitForServer()}),this),!0},t.prototype.openShopSkill=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),Define.getTypeBySkillShopID(e)==Define.SKILL_TYPE_PET&&null==xself.getPet()?void AlertPanel.alertCommon(GameText.STR_SKILL_TYPE_PET_NULL):void t.getShopSkillListAndOpen(e,n,i)},t.getShopSkillListAndOpen=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o=MsgHandler.createBrowseSkillShop(e);nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),o.getShort()!=e)return AlertPanel.alertCommon(GameText.STR_SKILL_SHOP_ID_ERROR),null;var a=o.getByte();if(0>a)return AlertPanel.errorMessage(o.getString()),null;if(0==a)return AlertPanel.alertCommon(GameText.STR_SKILL_SHOP_SKILL_NULL),null;Skill.gAction=o.getByte();for(var r=new Array,s=0;a>s;s++){var l=Skill.fromShopBytes(o),_=o.getByte();l.maxLearnLevel=_,r.push(l)}null!=n&&null!=i?n.call(i,r):(PanelManager.openSkillShopPanel(e,r),Define.getTypeBySkillShopID(e)==Define.SKILL_TYPE_PLAYER&&t.doOpenSkillAlert()&&(AlertPanel.alertCommon(GameText2.STR_OPEN_SKILLSHOP_ALERT_INFO),t.OPEN_SKILLSHOP_ALERT_FIRST=!1))}),this),PanelManager.openWaitForServer()},t.doOpenSkillAlert=function(){return null!=xself&&!(xself.getLevel()>this.OPEN_SKILLSHOP_ALERT_LEVEL||0==this.OPEN_SKILLSHOP_ALERT_FIRST)},t.prototype.checkOneKeyMissionFinish=function(t){if(null!=xself&&!(xself.isMember()||1==t&&xself.isAutoMove())){var e=xself.missionList;if(null!=e)for(var n=0;n<e.length;n++){var i=e[n];if(null!=i&&0!=i.isOneKeyMission()&&1!=i.isOneKeyShow()&&i.isComplete()){if(OneKeyDailyMission.isDoingOnekeyMission&&i.radarMapID!=xworld.orgMapID)continue;return i.setOneKeySHow(),0==t&&xself.clearAutoMoveList(),void NPC.doMissionInfoView(xself,i,null,NPCConst.SUB_MISSION_ONE_SUBMIT)}}}},t.checkNPCRelaMissions=function(e){t.checkNPCRelaMissionsStatus(!1,e)},t.checkNPCRelaMissionsStatus=function(t,e){NPC.clearHideNPCs();var n=xworld.npcList;if(null!=n){for(var i=n.length,o=0;i>o;o++){var a=n[o];null!=a&&(1==t&&a.resetVisibleData(),a.checkRelaMissionVisible(),a.checkSetHidePlayer())}xworld.gameMap.updateSmallMapNpcIcon()}},t.getMoneyArrayValue=function(t,e){if(null==t||t.length<2)return null;var n=[0,0,0];switch(t[0]){case ModelConst.MONEY1:n[0]=Tool.sumValue(n[0],t[1],0,e);break;case ModelConst.MONEY2:n[1]=Tool.sumValue(n[1],t[1],0,e);break;case ModelConst.MONEY3:n[2]=Tool.sumValue(n[2],t[1],0,e)}return n},t.addPlayerEvent=function(t){null==this.playerEventList&&(this.playerEventList=[]),this.playerEventList.push(t),PanelManager.mainMenu&&PanelManager.mainMenu.updateWorldIconPoint()},t.removePlayerEvent=function(e){for(var n=0;null!=t.playerEventList&&n<t.playerEventList.length;n++){var i=t.playerEventList[n];if(null!=i&&i.eventID==e){t.playerEventList.splice(n,1);break}}0==t.playerEventList.length&&PanelManager.mainMenu&&PanelManager.mainMenu.checkPlayerEvent()},t.refreshPlayerEvent=function(){for(var e=t.playerEventList.length-1;e>=0;e--){var n=t.playerEventList[e];if(null!=n)if(Tool.currentTime>n.time)t.playerEventList.splice(e,1);else{var i=n.type;i!=Define.PLAYER_EVENT_TEAM_INVITE&&i!=Define.PLAYER_EVENT_TEAM_APPLY&&i!=Define.PLAYER_EVENT_PKASK||null!=xworld.getModel(n.sendID)||t.playerEventList.splice(e,1)}else t.playerEventList.splice(e,0)}},t.prototype.isVip=function(t){return null!=t&&(!(t.getVipLevel()<1)&&(t!=xself||!this.isVipOverDue(t)))},t.prototype.isVipOverDue=function(t){if(null==t)return!0;if(null==t.bag)return!0;var e=t.bag.getItem(PlayerBag.SPIRIT_POS);return!(e&&e.expireTime-Date.now()>0)},t.getItemNameInfo=function(t,e){for(var n=new Array(t.length),i=0;i<n.length;i++){var o=t[i];n[i]=null!=o?e?o.name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),o.reqLv+"")+")":o.name+GameText.getText(GameText.TI_ITEM_X)+o.quantity:1==i?GameText.STR_REPLACE_INLAY_GEM:GameText.getText(GameText.TI_BACK)}return n},t.doGetItemSuit=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o=function(){null!=n&&null!=i&&n.call(i)};if(null==e||e.length<=0)o();else{for(var a={},r=0;r<e.length;r++){var s=e[r];if(null!=s){var l=s.getItemSetID();0>=l||null==t.getSuit(l)&&(a[l]=l)}}var _=[];for(var h in a)_.push(a[h]);if(_.length<=0)o();else{var u=MsgHandler.createGetSuitInfoMsg(_);nato.Network.sendCmd(u,(function(e){for(var n=e.getByte(),i=0;n>i;i++){for(var a=e.getUnsignedByte(),r=e.getByte(),s=new Array(4*r),l=0,_=0;r>_;_++)s[l++]=e.getByte(),s[l++]=e.getUnsignedByte(),s[l++]=e.getShort(),s[l++]=e.getByte();t.addSuit(a,s)}o()}),this)}}},t.doSpecialCode=function(t){var e=MsgHandler.createSpecialCodeMsg(t);nato.Network.sendCmd(e,(function(t){MsgHandler.isMessageHaveError(t)||1==t.getBoolean()&&AlertPanel.alertCommon(GameText.STR_SPECIALCODE_SUCCESS)}),this)},t.doRepairEquip=function(){var t=xself;if(null!=t){var e=function(e){if(!MsgHandler.isMessageHaveError(e)){var n=e.getInt();t.setMoneyByType(ModelConst.MONEY3,n),PlayerBag.repairEquip(t,-1,!1),PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateWorldIconPoint(),AlertPanel.alertCommon(GameText.STR_REPAIR_EQUIP_SURE_SUCCESS),xself.checkPower()}};AlertPanel.alert(GameText.STR_REPAIR_EQUIP,Tool.manageString(GameText.STR_REPAIR_EQUIP_SURE,PowerString.makeColorString(PlayerBag.repairEquip(t,-1,!0)+GameText.getMoneyText(ModelConst.MONEY3),ColorUtils.COLOR_RED)),(function(){var t=new nato.Message(ProtocolDefine.CG_BAG_REPAIR);t.putShort(-1),nato.Network.sendCmd(t,e,this)}),this)}},t.prototype.getTypeModel=function(t){var e=[];for(var n in this.otherModels){var i=this.otherModels[n];if(null!=i)if(t!=Define.NEAR_MY_TEAM){switch(t){case Define.NEAR_TEAM:if(0==i.isPlayerTeam())continue;break;case Define.NEAR_SHOP:if(0==i.isShopMode())continue;if(i.isShopMode()&&Define.PLAYER_SHOP_TYPE_NORMAL!=i.getShoptype())continue;break;case Define.NEAR_ENCHANT_SHOP:if(0==i.isShopMode())continue;if(i.isShopMode()&&Define.PLAYER_SHOP_TYPE_ENCHANT!=i.getShoptype())continue;break;case Define.NEAR_FIGHT:if(0==i.isBattleMode())continue;break;case Define.NEAR_PHOTO:if(0==i.isHasPhoto())continue;break;case Define.NEAR_NULL:if(1==i.isPlayerTeam()||1==i.isShopMode()||1==i.isBattleMode())continue}e.push(i)}else xself.isPlayerTeam()&&xself.getLeaderID()==i.getLeaderID()&&e.push(i)}if(t!=Define.NEAR_MY_TEAM){for(var o=[],a=e.length-1;a>=0;a--){var r=e.length-1;if(0>r)break;var s=Tool.rand(0,r);0==Tool.isArrayIndexOutOfBounds(s,e)&&(o.push(e[s]),e.splice(s,1))}e=o,e=this.sortVipModelList(e),e=this.robotModelList(e)}return e},t.prototype.sortVipModelList=function(t){for(var e=[],n=0;n<t.length;n++){for(var i=t[n],o=0;!(o>=e.length);){var a=e[o];if(i.getVipLevel()>a.getVipLevel()){e.splice(o,0,i);break}o++}o==e.length&&e.push(i)}return e},t.prototype.robotModelList=function(t){if(null==t)return t;if(t.length<=0)return t;for(var e,n=[],i=[],o=[],a=0;a<t.length;a++)null!=(e=t[a])&&(e.isRobot()?o.push(e):i.push(e));for(var r=0;r<i.length;r++)null!=(e=i[r])&&n.push(e);for(var s=0;s<o.length;s++)null!=(e=o[s])&&n.push(e);return n},t.doAutoMove=function(t){var e=xself;if(null!=e)return MsgHandler.instance.processDataBlockFlagMsg(t),0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void e.fromBytesByAutoMove(t)},t.doGetIsOpen=function(t){var e=t.getShort(),n=t.getBoolean(),i=xself;if(null!=i)switch(e){case Define.IS_OPEN_TYPE_BONUS_ONLINE:OnlineReward.isShowIcon=n,0==OnlineReward.isShowIcon&&PanelManager.closeOnlineRewardPanel(),PanelManager.updateWorldIconPoint();break;case Define.IS_OPEN_TYPE_LOTTERY_DRAW_NEW:LoginLotteryDraw.isOpen=n,0==LoginLotteryDraw.isOpen&&PanelManager.isPanelShow(LoginLotteryPanel)&&PanelManager.closeScene(!0),PanelManager.updateWorldIconPoint();break;case Define.IS_OPEN_TYPE_CHARGE_ACTIVITY:break;case Define.IS_OPEN_TYPE_ENCHANT:Enchant.isOpen=n,PanelManager.updateWorldIconPoint();break;case Define.IS_OPEN_TYPE_FORMATION:0==n&&(i.formationList=null,i.formationSkill=null),PanelManager.updateWorldIconPoint();break;case Define.IS_OPEN_TYPE_WO:break;case Define.IS_OPEN_TYPE_MO9_POP:PayInfo.isMo9AutoPayOpen=n;break;case Define.IS_OPEN_TYPE_PLAYER_IDENTIFY:break;case Define.IS_OPEN_TYPE_UPGRADE:ItemData.isUpgradeItemOpen=n;break;case Define.IS_OPEN_TYPE_BATTLE:case Define.IS_OPEN_TYPE_COST_REWARD:break;case Define.IS_OPEN_TYPE_LEVEL_REWARD:RewardHandler.isLevelRewardOpen=n,RewardHandler.canGetLevelReward=t.getBoolean(),n||(RewardHandler.canGetLevelReward=!1),PanelManager.updateWorldTopMenu();break;case Define.IS_OPEN_TYPE_MICRO_REWARD:xworld.isDrawMicroReward=n,n||MicroPanel.processRewards(t);break;case Define.IS_OPEN_TYPE_SEVENDAY_REWARD:SevenDayReward.isOpen=!n,SevenDayReward.isOpen&&SevenDayReward.processReward(t);break;case Define.IS_OPEN_TYPE_SPRING:SpringReward.isOpen=!n,SpringReward.isOpen&&SpringReward.processReward(t);break;case Define.IS_OPEN_TYPE_OFFLINE_EXP:OfflineExp.isOpen=!n,OfflineExp.isOpen&&OfflineExp.info.fromBytes(t);break;case Define.IS_OPEN_TYPE_EXCHANGE_MONEY:ExchangeMoneyHandler.isExchangeMoneyOpen=!n,n||ExchangeMoneyHandler.process(t),PanelManager.updateWorldTopMenu();break;case Define.IS_OPEN_TYPE_DAYACTITY:FiveDayActityData.isOpen=n,PanelManager.updateWorldTopMenu();break;case Define.IS_OPEN_TYPE_SHARE:xworld.isShare=n,PanelManager.updateWorldTopMenu();break;case Define.IS_OPEN_TYPE_OPEN_ACTIVITIES:ActivityList.isOpen=n,n&&ActivityList.fromBytes(t);break;case Define.IS_OPEN_TYPE_FIRST_CHARGE:FirstCharge.isOpen=n,n&&FirstCharge.fromBytes(t),PanelManager.updateWorldIconPoint();break;case Define.IS_OPEN_TYPE_FOLLOW:xworld.isFollow=n,PanelManager.updateWorldTopMenu();break;case Define.IS_OPEN_TYPE_ONEKEY_DAILY:OneKeyDailyMission.isOpenOnekeyDailyMission=n}},t.prototype.dismissTeam=function(t){if(null!=xworld.otherModels&&null!=xself){for(var e in xworld.otherModels){var n=xworld.otherModels[e];null!=n&&t==n.getLeaderID()&&(n.clearMember(),n.isTwoPeopleHouse()&&null!=n.getPlayerSprite()&&n.getPlayerSprite().getnameID()==GameSprite.HOUSE_TWO_PEOPLE_SPRITE&&n.refreshWorldSprite())}t==xself.getLeaderID()&&(xself.clearMember(),xself.isTwoPeopleHouse()&&xself.refreshWorldSprite(),PanelManager.updateWorldIconPoint())}},t.isShowWorldShop=function(){return null!=xself&&!(xself.getLevel()<t.GAME_WORLD_SHOP_SHOW_LEVEL)},t.isSkyArenaStatus=function(){return null!=t.skyarena},t.isArenaStatus=function(){return null!=t.arena},t.isNewArenaStatus=function(){return null!=t.newArena},t.isEscortStatus=function(){return null!=t.escort},t.clearEscort=function(){t.escort=null,null!=xself&&xself.clearFightPower(),PanelManager.closeScene(!0)},t.createEscort=function(e,n){switch(t.escortType=n,t.escort=e,n){case Escort.OLDESCORT:PanelManager.openEscortScene(e);break;case Escort.NEWESCORT:PanelManager.openNewEscortScene(e)}},t.getEscort=function(){return t.escort},t.openEscort=function(){t.escortType==Escort.OLDESCORT?PanelManager.openEscortScene(t.escort):t.escortType==Escort.NEWESCORT&&PanelManager.openNewEscortScene(t.escort)},t.isCountryBossStatus=function(){return null!=t.countryBoss},t.isTeamBossStatus=function(){return null!=t.teamBoss},t.isSpecialStatus=function(){return!!(t.isEscortStatus()||t.isArenaStatus()||t.isNewArenaStatus()||t.isCountryBossStatus()||t.isCountryWarStatus()||t.isTeamBossStatus())},t.isLoginSetting=function(t){return 0!=(this.loginSetting&t)},t.setLoginSetting=function(t,e){this.loginSetting=Tool.setBit(t,e,this.loginSetting)},t.doBindTelephone=function(e){var n,i=function(){t.doBindTelephone(!1)},o=function(e){n=e,setTimeout((function(){PanelManager.openEditNameView("绑定邮箱","请再次输入邮箱：","",a,null,t)}),500)},a=function(o){n.trim()!=o.trim()?AlertPanel.alertNotify("温馨提示","两次输入的邮箱不一样，请重新输入。",i,t):t.doBindTelephotoSure(o,e)};if(e){var r=new nato.Message(ProtocolDefine.CG_BIND_SETTING);r.putByte(Define.BIND_SETTING_FUNCTION_BIND),nato.Network.sendCmd(r,(function(e){return PanelManager.closeWaitForServer(),e.getByte()==Define.BIND_SETTING_12114?void AlertPanel.alertCommon(e.getString()):void PanelManager.openEditNameView("绑定手机","请输入手机号码：","",o,null,t)}),this),PanelManager.openWaitForServer()}else PanelManager.openEditNameView("绑定邮箱","请输入邮箱：","",o,null,this,30,-1)},t.doBindTelephotoSure=function(e,n){var i=t.username,o=t.password,a=MsgHandler.createBindPhone(i,o,e,!1);nato.Network.sendCmd(a,(function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){var i=GameText.STR_GAMEWORLD_BIND_PHONE;0==n&&(i=GameText.STR_GAMEWORLD_BIND_EMAIL),AlertPanel.alertCommon(PowerString.makeColorString(i+e+"!",ColorUtils.COLOR_GREEN)+"\n")}}),this),PanelManager.openWaitForServer()},t.isShowSrpiteGuide=function(){return null!=xself&&(!xself.isSettingBit(Define.SETTING_SPRITE_GUIDE)&&0!=SpriteGuide.isSpriteGuideReach())},t.isShowSrpiteGuideGlint=function(){return 0!=this.isShowSrpiteGuide()&&0!=ChatUp.isShowGlint},t.doRelationFlyAction=function(t){if(null!=t){var e=xself;if(null!=e&&null!=e.bag){if(e.partnerId==t.getId())return void MarryHandler.doPartnerFly();if(0!=SafeLock.doSafeLockVerify()){var n=MsgHandler.createRelationFly(t.getId());nato.Network.sendCmd(n,(function(t){if(null!=t){var n=t.getShort();if(0>n)return void AlertPanel.alertCommon(t.getString());e.bag.removeBagItemByPos(n,1);Define.SUCCESS,Menu.clickBtn(),PanelManager.openMainMenuScene();var i=t.getByte();if(1==i){var o=t.getByte(),a=t.getByte();e.setPosition(o,a)}else 2==i&&MsgHandler.instance.processDataBlockFlagMsg(t);AlertPanel.alertNotify(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_SEND_SUCCESS)}}),this)}}}},t.doViewMyPlayerBuffInfo=function(t){if(null==t&&(t=xself),null==t)return"";if(0==t.isPower()&&0==t.isHasCountrypower())return"";var e="";if(t.isHasCountrypower()&&(e+=GameText.STR_COUNTRYBOSS_POWER_INFO),t.isPower()){var n=t.power,i=t.powerValue;if(e+=Define.getPowerDesc(n,i),Tool.isNullText(e))return"";e=PowerString.makeColorString(e,i>0?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)}return e},t.isShowResolveMenu=function(){return!!(xself&&xself.getLevel()>30)},t.doOpenPlayerList=function(){xworld.noviceQuickBattle=!1,t.useGuide=!0,t.cleanGuide(),t.doLogOutMsg(Define.ACTOR_LEAVE_TYPE_BACKTOLIST,!0)},t.doLogOutMsg=function(t,e){if(e){var n=MsgHandler.createPlayerLoginOutMsg(t);switch(t){case Define.ACTOR_LEAVE_TYPE_BACKTOLIST:return void nato.Network.sendCmd(n);case Define.ACTOR_LEAVE_TYPE_BACKTOLOGIN:nato.Network.sendCmd(n)}}switch(t){case Define.ACTOR_LEAVE_TYPE_BACKTOLIST:case Define.ACTOR_LEAVE_TYPE_KICKTOLIST:xworld.stopUpdate(),Login.instance.requestPlayerList();break;case Define.ACTOR_LEAVE_TYPE_BACKTOLOGIN:case Define.ACTOR_LEAVE_TYPE_KICKTOLOGIN:Sdk.xsdk.logout();break;case Define.ACTOR_LEAVE_TYPE_SELFKICK:xworld.kickBySelf=!0,AlertPanel.alertTips("提示","您的账号在其它地方登入，请注意账号安全，尽快修改密码")}},t.prototype.addEquipChange=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=!1),!(xself.getLevel()<t.reqLv)){var i=PlayerBag.getCompareEquip(xself.bag,t.type);if(null!=i&&-1!=i&&-2!=i){if(PlayerBag.isOneHandWeaponType(t.type))if(!xself.bag.isOnehandEquipeGuide(PlayerBag.WEAPON_LEFT_POS,PlayerBag.WEAPON_RIGHT_POS))return;if(Define.ITEM_TYPE_ARMOR_RING==t.type)if(!xself.bag.isOnehandEquipeGuide(PlayerBag.ARMOR_RING_LEFT_POS,PlayerBag.ARMOR_RING_RIGHT_POS))return;null!=ItemData.getBagGuideItem(i,t)&&(n?this._bagEquipChangeList.push(e):(this.equipChangeList.unshift(t),this.isEquipChangePanelShow=!1,this.checkEquipChange()))}}},t.prototype.checkEquipChange=function(){if(!this.isEquipChangePanelShow&&0!=this.equipChangeList.length&&!xworld.inBattle){var t=this.equipChangeList[0];null!=t&&PanelManager.mainMenu&&PanelManager.mainMenu.equipChangePanel.setData(t)}},t.prototype.addBagEquipChange=function(){if(xself.isNovice){var t=PanelManager.bagScene;if(null!=t&&null!=t.bagView)for(var e,n=(e=t.bagView.getChildAt(0)).numChildren,i=null,o=0;n>o;o++)if(null!=(i=e.getChildAt(o))){var a=i.itemData;null!=a&&this.addEquipChange(a,i,!0)}}},t.prototype.checkBagEquipChange=function(){if(xself.isNovice&&0!=this._bagEquipChangeList.length&&!xworld.inBattle){for(var e,n=this._bagEquipChangeList.shift(),i=0;i<this._bagEquipChangeList.length;){e=n.itemData;var o=this._bagEquipChangeList[i].itemData;if(null!=o)if(PlayerBag.getEquipChangeType(o.type)!=PlayerBag.getEquipChangeType(e.type))i++;else{null!=ItemData.getBagGuideItem(e,o)?n=this._bagEquipChangeList.splice(i,1)[0]:this._bagEquipChangeList.splice(i,1),i=0}else i++}null!=n&&t.setGuide(t.GUIDE_BAG_EQUIP_SELECT,n)}},t.prototype.checkTeamBtn=function(){xworld.getTypeModel(Define.NEAR_MY_TEAM).length>0?t.isBlinkzd=!0:t.isBlinkzd=!1,PanelManager.mainMenu&&PanelManager.mainMenu.updateTeamIcon()},t.prototype.isInCityNow=function(){var t=this.orgMapID;return!!Define.isCityMap(t)},t.GAME_WORLD_SHOP_SHOW_LEVEL=5,t.VERSION=320200,t.CP_ID=1e3,t.strImgCheck="abc",t.strImgCreate="abc",t.strImgAutoCheck="abc",t.username="",t.password="",t.lastServerID=0,t.lastServerName=null,t.lastPlayerID=0,t.tempUsername="",t.tempPassword="",t.tempChangeNameInfo="",t.gameStartTime=0,t.registerAccount="",t.registerPasswd="",t.modifyAccount="",t.modifyPwd="",t.modifyNewPwd="",t.curMissionID=0,t.useGuide=!0,t.isBlinkzd=!1,t.GUIDE_NONE=0,t.GUIDE_START_NPC=1,t.GUIDE_MISSION_ACTION=2,t.GUIDE_MISSION_UI_OPEN=3,t.GUIDE_MISSION_DETAIL=4,t.GUIDE_BATTLE_ATTACK_MENU=5,t.GUIDE_BATTLE_ATTACK_TARGET=6,t.GUIDE_BAG_UI_OPEN=7,t.GUIDE_BAG_EQUIP_SELECT=8,t.GUIDE_BAG_DO_EQUIP=9,t.GUIDE_BAG_MESSAGE_SHOW=10,t.GUIDE_BAG_END=11,t.GUIDE_ADD_POINT_UI_OPEN=20,t.GUIDE_ADD_POINT_TIPS=21,t.GUIDE_ADD_POINT_SURE_SHOW=22,t.GUIDE_ADD_POINT_SURE=23,t.GUIDE_ADD_POINT_MESSAGE_SHOW=24,t.GUIDE_ADD_POINT_END=25,t.GUIDE_BATTLE_ATTACK_AUTO=26,t.GUIDE_BAG_PET_PARTNER_SELECT=27,t.GUIDE_BAG_PET_PARTNER_USE=28,t.GUIDE_BAG_PET_PARTNER_END=29,t.GUIDE_PET_UI_OPEN=30,t.GUIDE_AUTO_PATH_UI=31,t.GUIDE_AUTO_EQUIP_CHANGE=32,t.GUIDE_BATTLE_OPEN_SKILL=33,t.GUIDE_BATTLE_SELECT_SKILL=34,t.GUIDE_BATTLE_PET_ATTACK_AUTO=35,t.GUIDE_NEW_CITY_OPEN=36,t.GUIDE_NEW_CITY_ENTER=37,t.GUDIE_TASK_OPEN=38,t.GUIDE_TASK_CLOSE=39,t.GUIDE_SPRITEGUIDE_BUTTON=40,t.GUIDE_SKIP_ROUND=41,t.GUIDE_SEL_AUTO_SKILL=42,t.GUIDE_SEL_AUTO_SKILL2=43,t.GUIDE_SEL_AUTO_SKILL3=44,t.GUIDE_BATTLE_FAIL_SHOP=45,t.GUIDE_MERCENARY_HIRE=46,t.bigGuideType=0,t.FORCE_GUIDE_TYPE=1,t.NAN_FORCE_GUIDE_TYPE=2,t.guideType=t.GUIDE_NONE,t.guideErrorCount=0,t.guideNPCID=-1,t.CREATE_ERR_NEED_IMAGE_CHECK=-13,t.toursex=-1,t.tourstyle=-1,t.HOLE_ACCOUNT_NAME="gd",t.TOURIST_MODIFY_LEVEL=1,t.ERROR_USER_NAME=-4,t.TOURIST_FORCE_REGISTER_LEVEL=15,t.cityMasterId=-1,t.cityArmy=0,t.cityDegree=0,t.cityScale=0,t.cityLevel=0,t.battleRewardMessage=null,t.loginLotteryDraw=null,t.isShowStarAndGem=!1,t.suitList={},t.SYNC_BATTLE_INTERVAL=1e3,t.SYNC_INTERVAL=5e3,t.BATTLE_UPDATE_RATE=4,t.OPEN_SKILLSHOP_ALERT_LEVEL=8,t.OPEN_SKILLSHOP_ALERT_FIRST=!0,t.playerEventList=[],t.debug_typeName=["按索引顺序对应","在线奖励领取功能开关","登录抽奖系统开放开关","副本奖励开关","充值活动","附魔开关","阵型开关","wo+开关","mo9弹窗开关","身份验证功能开关","装备进阶功能开关","战场按钮功能开关","消费活动开关","","","","等级奖励开关","微端奖励开关","7天登录奖励","","炼金系统开关","离线经验","开服列表","推送VIP信息","开服五日奖励","开服基金","是否开启分享","首冲礼包","关注","","一键日常","春节登录奖励","","",""],t.escort=null,t.escortType=0,t.loginSetting=0,t.IS_ZONE=1,t.IS_LOCK_SET=2,t.IS_LOCK_OPEN=4,t.IS_HAVA_AD_LOGIN=8,t.IS_HAVA_AD_GAME=16,t.IS_NO_ADD_POINT=32,t.IS_OPEN_TRADE=64,t.IS_INVITE_CODE=128,t.IS_ACCOST=256,t.IS_GUIDE_MISSION_LIST_DOING=2048,t.IS_GUIDE_BAG_EQUIP_SELECT=4096,t.IS_GUIDE_BAG_DO_EQUIP=8192,t.IS_GUIDE_BATTLE_DOING=16384,t.IS_GUIDE_ADD_POINT_TIPS=32768,t.IS_GUIDE_MAP=65536,t.IS_GUIDE_CITY=1<<17,t.IS_GUIDE_BATTLE_AUTO=1<<18,t.IS_GUIDE_OPEN_BATTLE_SKILL=1<<19,t.IS_GUIDE_SKIP_ROUND=1<<20,t.IS_GUIDE_SKIP_BATTLE=1<<21,t.IS_GUIDE_SEL_AUTO_SKILL=1<<22,t.IS_GUIDE_SEL_AUTO_SKILL2=1<<23,t.IS_GUIDE_SEL_AUTO_SKILL3=1<<24,t}();__reflect(GameWorld.prototype,"GameWorld");var MenuEventHandler=function(){function t(){}return t.doMenuButton=function(e){e==t.EVENT_ALL_MENU_SYSTEM_REFLASH?MsgHandler.createWorldDataReflashMsg():e==t.EVENT_ALL_MENU_WORLD_ITEM?PanelManager.openBag():e==t.EVENT_ALL_MENU_WORLD_SETTING?PanelManager.openSystemSettingScene():e==t.EVENT_ALL_MENU_WORLD_PET?PanelManager.openPetScene():e==t.EVENT_ALL_MENU_WORLD_MAIL?PanelManager.openMailScene():e==t.EVENT_ALL_MENU_ACTIVITY_LIST?(PanelManager.openTaskScene(),PanelManager.getPanel(TaskScene).openTab(TaskScene.TAB_INDEX_ACTIVITY)):e==t.EVENT_ALL_MENU_ACHIEVE?Achieve.doAchieveManageMsg():e==t.EVENT_ALL_PET_RAIDERS?Raiders.doPetRaidersGetData():e==t.EVENT_ALL_MOUNT_RAIDERS?MountRaiders.doGetMountRaidersData():e==t.EVENT_ALL_MENU_MASTER_LIST?PanelManager.openMasterPanel():e==t.EVENT_ALL_MENU_LOTTERY_DRAW?PanelManager.openDailyLotteryScene():e==t.EVENT_ALL_MENU_WORLD_CITY?PanelManager.openManorScene():e==t.EVENT_ALL_MENU_RANK?PanelManager.openRankPanel():e==t.EVENT_ALL_MENU_WORLD_CHAT_ROOM?PanelManager.openChatScene():e==t.EVENT_ALL_MENU_WORLD_MISSION?PanelManager.openTaskScene():e==t.EVENT_ALL_MENU_WORLD_EQUIP?PanelManager.openBag():e==t.EVENT_ALL_MENU_WORLD_PLAYER?PanelManager.openRoleScene():e==t.EVENT_ALL_MENU_WORLD_NEAR?PanelManager.openAroundScene():e==t.EVENT_ALL_MENU_WORLD_COUNTRY?PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS):e==t.EVENT_ALL_MENU_WORLD_MERCENARY?PanelManager.openPetScene():e==t.EVENT_ALL_MY_COUNTRY?PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS):e==t.EVENT_ALL_MENU_INFODATA_LIST?InfoData.doBrowseGameHelpList(0):e==t.EVENT_ALL_MENU_RELATION?PanelManager.openSocietyScene():e==t.EVENT_ALL_MENU_SHOPING?PanelManager.openBag(1):e==t.EVENT_ALL_MENU_NEAR?PanelManager.openAroundScene():e==t.EVENT_ALL_MENU_TEAM?(PanelManager.openAroundScene(),PanelManager.getPanel(AroundScene).setTab(AroundScene.TAB_INDEX_TEAM)):e==t.EVENT_ALL_MENU_SYSTEM_PLAYER_LIST||e==t.EVENT_ALL_MENU_SYSTEM_QUIT?Sdk.xsdk.logout():e==t.EVENT_ALL_MENU_SKILL_TAB?(PanelManager.openRoleScene(),PanelManager.getPanel(RoleScene).setTab(RoleScene.TAB_INDEX_SKILL)):e==t.EVENT_ALL_MENU_PLAYER_EVENT?PanelManager.openPlayerEventPanel():e==t.EVENT_ALL_PETRAIDERS_RAIDERS?Raiders.doPetRaidersGetData():e==t.EVENT_ALL_SKY_ARENA_MENU?SkyArena.doEnterSkyArena(null,!0):e==t.EVENT_ALL_ENTER_NEWARENA?NewArena.doEnter(!1):e==t.EVENT_ALL_ENTER_NEWARENA_SIGN?NewArena.doActive():e==t.EVENT_ALL_COUNTRY_BOSS_ACTIVATE?CountryBoss.doCountryBossActivity():e==t.EVENT_ALL_COUNTRY_BOSS?CountryBoss.processCountryBoss(null,!0):e==t.EVENT_ALL_MENU_WAR_RANKLIST?PanelManager.openCountryWarTopScene():AlertPanel.alertCommon("敬请期待!")},t.EVENT_ALL_MENU_WORLD_ITEM=11201,t.EVENT_ALL_MENU_WORLD_SETTING=11202,t.EVENT_ALL_MENU_WORLD_PET=11203,t.EVENT_ALL_MENU_WORLD_MAIL=11204,t.EVENT_ALL_MENU_WORLD_CHAT_ROOM=11205,t.EVENT_ALL_MENU_WORLD_CHAT_INPUT=11206,t.EVENT_ALL_MENU_WORLD_MISSION=11207,t.EVENT_ALL_MENU_WORLD_EQUIP=11208,t.EVENT_ALL_MENU_WORLD_PLAYER=11209,t.EVENT_ALL_MENU_WORLD_NEAR=11210,t.EVENT_ALL_MENU_WORLD_COUNTRY=11211,t.EVENT_ALL_MENU_WORLD_CITY=11212,t.EVENT_ALL_MENU_WORLD_MERCENARY=11213,t.EVENT_ALL_MY_COUNTRY=11214,t.EVENT_ALL_COUNTRY_WAR=11215,t.EVENT_ALL_MENU_ACTIVITY_LIST=11216,t.EVENT_ALL_MENU_INFODATA_LIST=11217,t.EVENT_ALL_MENU_MONSTER_LIST=11218,t.EVENT_ALL_MENU_RELATION=11219,t.EVENT_ALL_MENU_ACHIEVE=11220,t.EVENT_ALL_MENU_ALBUMS_LIST=11221,t.EVENT_ALL_MENU_MY_ALBUMS=11222,t.EVENT_ALL_MENU_MY_CARD=11223,t.EVENT_ALL_MENU_SHOPING=11224,t.EVENT_ALL_MENU_NEAR=11225,t.EVENT_ALL_MENU_TEAM=11226,t.EVENT_ALL_MENU_NOTICE=11227,t.EVENT_ALL_MENU_SYSTEM_PLAYER_LIST=11228,t.EVENT_ALL_MENU_SYSTEM_CHAT_SET=11229,t.EVENT_ALL_MENU_SYSTEM_MOVE=11230,t.EVENT_ALL_MENU_SYSTEM_QUIT=11231,t.EVENT_ALL_MENU_SYSTEM_REFLASH=11232,t.EVENT_ALL_MENU_SYSTEM_DEBUG_MENU=11233,t.EVENT_ALL_MENU_STALL_START=11234,t.EVENT_ALL_MENU_STALL_END=11235,t.EVENT_ALL_MENU_STALL_RECORD=11236,t.EVENT_ALL_MENU_SKILL_TAB=11237,t.EVENT_ALL_MENU_LOGIN_ENTER=11238,t.EVENT_ALL_MENU_REGISTER=11239,t.EVENT_ALL_MENU_PLAYER_TRY_PLAYER=11240,t.EVENT_ALL_MENU_CHAT_SAME_CHANNEL=11241,t.EVENT_ALL_MENU_CHAT_SET=11242,t.EVENT_ALL_MENU_COUNTRY_HONOR=11243,t.EVENT_ALL_MENU_PAY_INFO=11244,t.EVENT_ALL_MENU_ENTER_CAMERA=11245,t.EVENT_ALL_MENU_SEND_MAIL_BY_ID=11246,t.EVENT_ALL_MENU_GAME_CLOSE=11247,t.EVENT_ALL_MENU_RELATION_FLY=11248,t.EVENT_ALL_MENU_PLAYER_EVENT=11249,t.EVENT_ALL_MENU_CHAT_ITEM_SEE=11250,t.EVENT_ALL_MENU_CHAT_MISSION_SEE=11251,t.EVENT_ALL_MENU_ADD_MASTER=11252,t.EVENT_ALL_MENU_DEL_MASTER=11253,t.EVENT_ALL_MENU_MODIFY_ACTOR=11254,t.EVENT_ALL_MENU_MODIFY_PLAYER=11255,t.EVENT_ALL_MENU_PLAYER_SETTING=11256,t.EVENT_ALL_MENU_MAIN_SETTING=11257,t.EVENT_ALL_MENU_BIND_PHONE=11258,t.EVENT_ALL_MENU_USER_MANAGE=11259,t.EVENT_ALL_MENU_GAME_SETTING=11260,t.EVENT_ALL_MENU_GAME_HELP=11261,t.EVENT_ALL_MENU_VERSION_UPDATE=11262,t.EVENT_ALL_MENU_PET_EXPLAIN=11263,t.EVENT_ALL_MENU_RESET_PASSWORD=11264,t.EVENT_ALL_MENU_FIND_PASSWORD=11265,t.EVENT_ALL_MENU_CANCEL_BIND=11266,t.EVENT_ALL_MENU_LOCK_USER=11267,t.EVENT_ALL_MENU_UNLOCK_USER=11268,t.EVENT_ALL_MENU_USER_APPEAL=11269,t.EVENT_ALL_MENU_CHANGE_PASSWORD=11270,t.EVENT_ALL_MENU_MAIL_SEND_PLAYER=11271,t.EVENT_ALL_MENU_MAIL_SEND_GM=11272,t.EVENT_ALL_MENU_MAIL_RECEIVE_PLAYER=11273,t.EVENT_ALL_MENU_MAIL_RECEIVE_TASK=11274,t.EVENT_ALL_MENU_MAIL_RECEIVE_PAY=11275,t.EVENT_ALL_MENU_MAIL_RECEIVE_SYSTEM=11276,t.EVENT_ALL_MENU_MAIL_RECEIVE_SEND=11277,t.EVENT_ALL_MENU_MAIL_RECIEVE_BACK=11278,t.EVENT_ALL_MENU_PLATFORM_CENTER=11279,t.EVENT_ALL_MENU_VIEW_BATTLE=11280,t.EVENT_ALL_MENU_WORLD_MAP=11281,t.EVENT_ALL_MENU_WAR_RANKLIST=11282,t.EVENT_ALL_MENU_WAR_DECLARE=11283,t.EVENT_ALL_VIEW_WORLD_BUFF=11284,t.EVENT_ALL_MENU_KEY_RESOLVE=11285,t.EVENT_ALL_MENU_CHAT_COUNTRY_SEE=11286,t.EVENT_ALL_MENU_RANK=11287,t.EVENT_ALL_MENU_SAFELOCK=11288,t.EVENT_ACTOR_BUY_PLAYER=11289,t.EVENT_ALL_MENU_SEE_ACHIEVE=11290,t.EVENT_ALL_MENU_SEE_ACHIEVE_SHOP=11291,t.EVENT_ALL_MENU_SHOPPLAYER_INFO=11292,t.EVENT_ALL_MENU_SHOPPLAYER_BAG=11293,t.EVENT_ALL_MENU_SHOPPLAYER_PETLIST=11294,t.EVENT_ALL_MENU_SHOPPLAYER_STORE=11295,t.EVENT_ALL_MENU_SHOPPLAYER_CITY=11296,t.EVENT_ALL_MENU_SHOPPLAYER_COUNTRY=11297,t.EVENT_ALL_MENU_RECMAIL_REPORT=11298,t.EVENT_ALL_MENU_CANTACT_SELLER=11299,t.EVENT_ALL_MENU_PHOTO_COMMENT_DELETE=11300,t.EVENT_ALL_MENU_BIND_MAIL=11301,t.EVENT_ALL_MENU_VIP_ACTIVATE=11302,t.EVENT_ALL_MENU_VIP_PRIVILEGE=11303,t.EVENT_ALL_MENU_MASTER_ACCEPT_APPRENTICE=11304,t.EVENT_ALL_MENU_MASTER_LIST=11305,t.EVENT_ALL_MENU_LOTTERY_DRAW=11306,t.EVENT_ALL_MENU_LOTTERY_DRAW_PLAYER=11307,t.EVENT_ALL_MENU_PLAYERCARD_TO_PHOTO=11308,t.EVENT_ALL_MENU_MIX_SERVER_ACTOR_JOIN=11309,t.EVENT_ALL_MENU_MIX_SERVER_ACTOR_CAN=11310,t.EVENT_ALL_MENU_MIX_SERVER_COUNTRY_JOIN=11311,t.EVENT_ALL_MENU_MIX_SERVER_COUNTRY_CAN=11312,t.EVENT_ALL_MENU_ACTOR_LOGIN_GET_REWARD=11313,t.EVENT_ALL_MENU_NEW_ESCORT_LIST=11314,t.EVENT_ALL_MENU_SHOPPLAYER_STORE_VIP=11315,t.EVENT_ALL_MENU_SHOW_STAR=11316,t.EVENT_ALL_MENU_TITLE_DOING=11317,t.EVENT_ALL_VIEW_WORLD_SPRITE_GUIDE=11318,t.EVENT_ALL_VIEW_WORLD_DEL_AUTO_FIRE=11319,t.EVENT_ALL_PAY_ACHIEVE=11320,t.EVENT_ALL_ALL_VIEW_WORLD_SHOP=11321,t.EVENT_ALL_SKY_ARENA_MENU=11322,t.EVENT_ALL_PLAYER_LEVEL2_ICON=11323,t.EVENT_ALL_COUNTRY_BOSS=11324,t.EVENT_ALL_NINE_ONE_ICON=11325,t.EVENT_ALL_COUNTRY_BOSS_ACTIVATE=11326,t.EVENT_ALL_PETCOMPOSITE_IMMEDIATELY=11327,t.EVENT_ALL_PETCOMPOSITE_SELECT_DATA=11328,t.EVENT_ALL_PETRAIDERS_RAIDERS=11329,t.EVENT_ALL_PET_RAIDERS=11330,t.EVENT_ALL_MOUNT_RAIDERS=11331,t.EVENT_ALL_PLAYER_RAIDERS=11332,t.EVENT_ALL_PLAYER_RAIDERS_APPLY=11333,t.EVENT_ALL_GETREWARD_ITEM=11334,t.EVENT_ALL_RANDOM_NPC_AWARD=11335,t.EVENT_ALL_CHANGE_FRIEND_REMARD=11336,t.EVENT_ALL_MENU_BIND_IDCARD=11337,t.EVENT_ALL_SEE_COUNTRY_STORAGE_PET=11338,t.EVENT_ALL_TRADE_PLAT_SSO_URL_SHOP=11339,t.EVENT_ALL_INVITE_SHOP=11340,t.EVENT_ALL_DUIHUAN_SHOP=11341,t.EVENT_ALL_NINE_ONE_FEEDBACK=11342,t.EVENT_ALL_SINA_MUNE=11343,t.EVENT_ALL_LOGIN_LOTTERYDRAW_SHOP=11344,t.EVENT_ALL_LOGIN_LOTTERYDRAW_PLAY=11345,t.EVENT_ALL_CHAT_UP=11346,t.EVENT_ALL_SPRITE_GUIDE_GLINT=11347,t.EVENT_ALL_ONLINE_REWARD=11348,t.EVENT_ALL_ONLINE_REWARD_PROMPT=11349,t.EVENT_ALL_MARRY_CARD_SHOP=11350,t.EVENT_ALL_MARRY_ITEM_SHOP=11351,t.EVENT_ALL_ENTER_COPY_SHOP=11352,t.EVENT_ALL_CRARGE_SHOP=11353,t.EVENT_ALL_ENCHANTING=11354,t.EVENT_ALL_SEE_FORMATION=11355,t.EVENT_ALL_ENCHANT_SELL=11356,t.EVENT_ALL_ENCHANT_SELL_CON=11357,t.EVENT_ALL_WO_REWARD=11358,t.EVENT_ALL_ENTER_WO_ACTIVITY=11359,t.EVENT_ALL_ENTER_NEWARENA=11360,t.EVENT_ALL_ENTER_MO9_QUICK_PAY=11361,t.EVENT_ALL_PLAYER_IDENTIFY=11362,t.EVENT_ALL_ENTER_NEWARENA_SIGN=11363,t.EVENT_ALL_ENTER_CONTINUE_PAY=11364,t.EVENT_ALL_PET_SEAL=11365,t.EVENT_ALL_BATTLE_GLINT=11366,t.EVENT_ALL_CONSUMER_SHOP=11367,t.EVENT_ALL_MENU_END=11500,t}();__reflect(MenuEventHandler.prototype,"MenuEventHandler");var OnlineReward=function(){function t(){this._item=null,this._time=0,this._leftTime=0,this._tempTime=0,this._isCanReward=!1}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"item",{get:function(){return this._item},set:function(t){this._item=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t},enumerable:!0,configurable:!0}),t.prototype.getTime=function(){var t="",e=this._leftTime;if(e>0){var n=Math.floor(e/Tool.MILLIS_IN_HOUR);n>0&&(t+=Tool.manageString(GameText.STR_HOUR,n+""));var i=Math.floor((e-n*Tool.MILLIS_IN_HOUR)/Tool.MILLIS_IN_MINUTE);i>0&&(t+=Tool.manageString(GameText.STR_MINUTE,i+""));var o=Math.floor((e-n*Tool.MILLIS_IN_HOUR-i*Tool.MILLIS_IN_MINUTE)/Tool.MILLIS_IN_SECOND);o>0&&(t+=Tool.manageString(GameText2.STR_SECOND,o+""))}return t},t.prototype.getLeftTime=function(){return this._leftTime},t.doPushOnLineReWardInfo=function(e){if(null!=e){if(t.isShowIcon=e.getBoolean(),0==t.isShowIcon)return void PanelManager.updateWorldIconPoint();var n=e.getLong().value;if(t.instance._leftTime=n,t.instance.time=n+Tool.currentTime,e.getBoolean()?(t.instance.item=new ItemData,t.instance.item.quantity=e.getInt(),ItemData.fromBytesAtts2(t.instance.item,e),t.instance.item.durability=t.instance.item.durMax):t.instance.item=null,t.instance._leftTime<=0?t.instance._isCanReward=!0:t.instance._isCanReward=!1,PanelManager.isPanelShow(OnlineRewardPanel))PanelManager.getPanel(OnlineRewardPanel).update();PanelManager.updateWorldIconPoint()}},t.prototype.doGetReward=function(){var t=new nato.Message(ProtocolDefine.CG_ACTOR_RECEIVE_ONLINE_REWARD);nato.Network.sendCmd(t,this.doRewardCallback,this)},t.prototype.doRewardCallback=function(e){var n=e.getByte();if(0>n)AlertPanel.alertCommon(e.getString());else{var i="";if(1==n){var o=e.getLong().value;this.time=o+Tool.currentTime,this._leftTime=o,this._isCanReward=this._leftTime<=0}else{if(i="获得 "+MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD),e.getInt()>0){o=e.getLong().value;this.time=o+Tool.currentTime,this._leftTime=o,this._isCanReward=this._leftTime<=0,e.getBoolean()&&(null==this.item&&(this.item=new ItemData),this.item.quantity=e.getInt(),ItemData.fromBytesAtts2(this.item,e),this.item.durability=this.item.durMax)}else t.isShowIcon=!1,t.instance._isCanReward=!1}PanelManager.updateWorldIconPoint(),t.isShowIcon?PanelManager.isPanelShow(OnlineRewardPanel)&&PanelManager.getPanel(OnlineRewardPanel).update():PanelManager.closeOnlineRewardPanel(),WorldMessage.addTips(i)}},t.prototype.isCanReward=function(){return this._isCanReward},t.doPushChange=function(e){t.isShowIcon=e.getBoolean(),0==t.isShowIcon&&PanelManager.closeOnlineRewardPanel(),PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.hideOnlineReward()},t.prototype.onlineLogic=function(e){if(0!=t.isShowIcon&&(this._leftTime-=e,this._tempTime+=e,!(this._tempTime<1e3))){this._tempTime=0,this._leftTime<=0&&(this._leftTime=0,this._isCanReward=!0,PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.checkOnLineReward());var n=PanelManager.getPanel(OnlineRewardPanel,!1);n&&n.stage&&n.updateTime(),PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateOnlineRewardTime()}},t.isShowIcon=!1,t}();__reflect(OnlineReward.prototype,"OnlineReward");var PlayerEvent=function(){function t(t,e,n,i,o,a,r,s){this.eventID=t,this.sendID=e,this.type=n,this.time=i,this.title=o,this.info=a,this.left=r,this.right=s}return t.prototype.doPlayerEvent=function(){if(this.type==Define.PLAYER_EVENT_MAIL)MenuEventHandler.doMenuButton(MenuEventHandler.EVENT_ALL_MENU_WORLD_MAIL);else if(this.type==Define.PLAYER_EVENT_ACTIVITY_LIST)MenuEventHandler.doMenuButton(MenuEventHandler.EVENT_ALL_MENU_ACTIVITY_LIST);else{var t=this;AlertPanel.alert(this.title,this.info,(function(){var e=MsgHandler.createPlayerEvent(t.eventID,Define.PLAYER_EVENT_CHOOSE_YES);nato.Network.sendCmd(e,null,null)}),this,(function(){var e=MsgHandler.createPlayerEvent(t.eventID,Define.PLAYER_EVENT_CHOOSE_NO);nato.Network.sendCmd(e,null,null)}))}GameWorld.removePlayerEvent(this.eventID),PanelManager.isPanelShow(PlayerEventPanel)&&PanelManager.getPanel(PlayerEventPanel).update()},t}();__reflect(PlayerEvent.prototype,"PlayerEvent");var GameMap=function(){function t(){this._loaded=!1,this.leftCount=0,this.node=new egret.DisplayObjectContainer}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},set:function(t){this._loaded=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.node.x},set:function(t){this.node.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.node.y},set:function(t){this.node.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.node.scaleX},set:function(t){this.node.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.node.scaleY},set:function(t){this.node.scaleY=t},enumerable:!0,configurable:!0}),t.prototype.addChild=function(t){this.node.addChild(t)},t.prototype.removeChildren=function(){this.node.removeChildren()},t.prototype.globalToLocal=function(t,e){return this.node.globalToLocal(t,e)},t.prototype.create=function(t){this.setup=t,MapSetup.curMapSetup=t},t.prototype.setTag=function(t,e){e?this.tagValue|=t:this.tagValue&=~t},t.prototype.isTag=function(t){return 0!=(this.tagValue&t)},Object.defineProperty(t.prototype,"mapId",{get:function(){return this._mapId},set:function(t){this._mapId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orgMapId",{get:function(){return this._orgMapId},set:function(t){this._orgMapId=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){t%20==0&&this.smallMap&&this.smallMap.updateSmallMap(t),this.playerLayer&&this.playerLayer.update(t)},t.prototype.ontick=function(t){this.setup&&this.setCameraToPlayer()},t.prototype.setCameraToPlayer=function(){var t=xself;if(null!=t){var e=t.x,n=t.y,i=Tool.getOffsetValue(e,this.setup.mapWidth,nato.mapScreenWidth),o=Tool.getOffsetValue(n,this.setup.mapHeight,nato.mapScreenHeight);this.x=i*nato.mapRatio,this.y=o*nato.mapRatio}},t.prototype.init=function(){this.setTag(t.TAG_MAP_STAGE_INIT,!0)},t.prototype.load=function(){this.playerLayer&&this.playerLayer.recycle(),this.removeChildren();var t=this.node.parent;null!=t&&t.removeChild(this.node),this.node=new egret.DisplayObjectContainer,Main.instance.addMap(this.node),this.background=new egret.DisplayObjectContainer,this.background.name="background",this.background.cacheAsBitmap=!0,this.addChild(this.background);var e=this.setup;if(null==e||null==e.playerLayer)this.playerLayer=new PlayerLayer(null,this);else{var n=e.playerLayer;this.playerLayer=n.create(this)}this.addChild(this.playerLayer),this.foreground=new egret.DisplayObjectContainer,this.foreground.name="foreground",this.addChild(this.foreground),this.loadMap(this.orgMapId)},t.prototype.loadMap=function(e){if(null!=this.setup){nato.resetLoad(this.onLoad,this),e!=Define.MAP_ID_ESCORT&&nato.loadImage(t.backgroundName(e),this.onLoadBackground,this),this.setup.hasForeground&&nato.loadImage(t.foregroundName(e),this.onLoadForeground,this);for(var n,i=this.setup.mapImages,o=this.setup.preloadImagesIndex,a=0,r=o.length;r>a;a++)n=i[o[a]],nato.loadImage(t.toImageName(n.imageID,n.palID),this.onLoadImage,this)}else Main.instance.hideLoadingScene()},t.prototype.onLoad=function(){nato.resetLoad(),this.onLoadImages()},t.backgroundName=function(t){return"map/"+t+"-b.png"},t.foregroundName=function(t){return"map/"+t+"-f.png"},t.toImageName=function(t,e){var n="image/"+t.toString();return 0!=e&&(n+="_"+e),n+".png"},t.prototype.onLoadBackground=function(t,e){var n=t,i=new egret.Bitmap(n);this.background.addChild(i)},t.prototype.onLoadForeground=function(t,e){var n=t,i=new egret.Bitmap(n);i.cacheAsBitmap=!0,this.foreground.addChildAt(i,0)},t.prototype.addToForeground=function(t){null!=this.foreground&&this.foreground.addChild(t)},t.prototype.onLoadedImage=function(){this.leftCount--,this.leftCount<=0&&this.onLoad()},t.prototype.onLoadImage=function(t,e){},t.prototype.onLoadImages=function(){egret.getTimer(),this.setup,1!=nato.mapRatio&&(this.scaleX=nato.mapRatio,this.scaleY=nato.mapRatio),this.playerLayer.load();null==this.smallMap&&(this.smallMap=new SmallMap),Main.instance.hideLoadingScene(),this._loaded=!0,xworld.initNpcLoading()},t.prototype.updateSmallMapNpcIcon=function(){this.smallMap},t.prototype.updateSmallMapName=function(){this.smallMap},t.prototype.initBlockLayer=function(){null==this.blockLayer&&(this.blockLayer=new egret.Sprite,this.blockLayer.name="blockLayer",this.addChild(this.blockLayer)),this.blockLayer.visible=!1;for(var t=this.setup,e=0,n=0,i=t.mapRows;i>n;n++)for(var o=0,a=t.mapColumns;a>o;o++){if(!this.isCanPass(o,n)){var r=new egret.Sprite;r.name=o+"_"+n,r.graphics.beginFill(16711680,.6),r.graphics.drawRect(2,2,MapSetup.GRID_WIDTH-4,MapSetup.GRID_HEIGHT-4),r.graphics.endFill(),e+=1,r.graphics.lineStyle(2,0),r.graphics.moveTo(2,2),r.graphics.lineTo(MapSetup.GRID_WIDTH-2,MapSetup.GRID_HEIGHT-2),r.graphics.moveTo(MapSetup.GRID_WIDTH-2,2),r.graphics.lineTo(2,MapSetup.GRID_HEIGHT-2),r.graphics.endFill(),r.x=o*MapSetup.GRID_WIDTH,r.y=n*MapSetup.GRID_HEIGHT,this.blockLayer.addChild(r)}}return e},t.prototype.getTile=function(t){var e=this.setup,n=e.tileMapImgIndexs;if(t>=n.length)return null;var i=e.mapImages[n[t]],o=nato.findImageForMap(i.imageID,i.palID),a=new egret.SpriteSheet(o),r=e.tileCoordXs[t],s=e.tileCoordYs[t],l=a.createTexture("tile",r,s,MapSetup.GRID_WIDTH,MapSetup.GRID_HEIGHT,0,0,MapSetup.GRID_WIDTH,MapSetup.GRID_HEIGHT),_=e.tileTransforms[t],h=.5,u=.5,c=1,T=1,p=0;0==_||(1==_?T=-1:2==_?c=-1:3==_?p=180:4==_?(h=0,u=0,c=-1,p=270):7==_&&(h=1,u=1,c=-1,p=90));var d=new egret.Bitmap(l);return d.name="idx:"+t+"_imageID:"+i.imageID+"_palID:"+i.palID,d.anchorOffsetX=h*d.width,d.anchorOffsetY=u*d.height,d.scaleX=c,d.scaleY=T,d.rotation=p,d},t.prototype.getImage=function(t,e,n,i){var o=this.setup.mapImages[t];this.setup.tileTransforms[t];var a=nato.findImageForMap(o.imageID,o.palID),r=e,s=0,l=0,_=1,h=1,u=0;0==r||(1==r?(l=1,h=-1):2==r?(s=1,l=0,_=-1):3==r?(s=1,l=1,u=180):4==r?(s=0,l=0,_=-1,u=270):7==r&&(s=1,l=1,_=-1,u=90));var c=new egret.Bitmap(a);return c.rotation=u,c.scaleX=_,c.scaleY=h,c.x=n,c.y=i,c.anchorOffsetX=s*c.width,c.anchorOffsetY=l*c.height,c.name="idx:"+t+"_imageID:"+o.imageID+"_palID:"+o.palID+"_t:"+r,c},t.prototype.getItem=function(e,n){var i=this.setup.mapImages[e],o=t.toImageName(i.imageID,i.palID),a=nato.getRes(o),r=1,s=1,l=0;0==n||(1==n?s=-1:2==n?r=-1:3==n?l=180:4==n?(r=-1,l=90):7==n&&(r=-1,l=270));var _=new egret.Bitmap(a);return _.anchorOffsetX=.5*_.width,_.anchorOffsetY=_.height,_.scaleX=r,_.scaleY=s,_.rotation=l,_.cacheAsBitmap=!0,_},t.prototype.isCanPass=function(t,e){var n=this.setup.crossData,i=this.setup;if(null==n)return!0;if(0>t||0>e||t>=i.mapColumns||e>=i.mapRows)return!1;var o=i.mapColumns*e+t,a=o>>5,r=31&o;return 0>a||a>=n.length?(console.error("GameMap.isCanPass() ArrayOutOfBound: "+t+","+e),!0):0==(n[a]&1<<r)},t.getWayPoint=function(){return t.wayPointPool.length>0?t.wayPointPool.pop():new WayPoint},t.prototype.findPath=function(e,n,i,o,a){if(e==i&&n==o)return null;var r=e*MapSetup.GRID_WIDTH,s=n*MapSetup.GRID_HEIGHT,l=i*MapSetup.GRID_WIDTH,_=o*MapSetup.GRID_HEIGHT;this.setup.clearSearchTable();var h=[],u=[],c=t.getWayPoint();if(c.x=r,c.y=s,c.cost=this.getCost(r,s,l,_),c.dir=8,u.push(c),null==this.setup||null==this.setup.searchStep)return null;for(this.setup.searchStep[n][e]=1;;){if(this.findAndCalculate(c.x,c.y,r,s,l,_,i,o,h,u,a),null==(c=this.findLessCostPos(h)))return this.recycleWayPoints(h,u),null;var T=h.indexOf(c);if(-1!=T&&h.splice(T,1),u.push(c),this.setup.searchStep[c.y/MapSetup.GRID_HEIGHT][c.x/MapSetup.GRID_WIDTH]=1,c.x==l&&c.y==_){var p=this.getPath(u,c,r,s,a);return this.recycleWayPoints(h,u),p}}},t.prototype.recycleWayPoints=function(e,n){for(var i;e.length;)(i=e.pop()).recycle(),t.wayPointPool.push(i);for(;n.length;)(i=n.pop()).recycle(),t.wayPointPool.push(i)},t.prototype.getCost=function(t,e,n,i){return Math.abs(t-n)+Math.abs(e-i)},t.prototype.findAndCalculate=function(t,e,n,i,o,a,r,s,l,_,h){var u=t,c=e-h;this.calculateCost(u,c,n,i,o,a,r,s,l,_,2),u=t,c=e+h,this.calculateCost(u,c,n,i,o,a,r,s,l,_,3),u=t-h,c=e,this.calculateCost(u,c,n,i,o,a,r,s,l,_,0),u=t+h,c=e,this.calculateCost(u,c,n,i,o,a,r,s,l,_,1)},t.prototype.calculateCost=function(e,n,i,o,a,r,s,l,_,h,u){var c=Math.floor(e/MapSetup.GRID_WIDTH),T=Math.floor(n/MapSetup.GRID_HEIGHT),p=MapSetup.curMapSetup;if(!(0>c||c>=p.mapColumns||0>T||T>=p.mapRows)&&(this.isCanPass(c,T)&&!(this.setup.searchStep[T][c]>0))){var d=t.getWayPoint();d.x=e,d.y=n,d.cost=this.getCost(e,n,i,o)+this.getCost(e,n,a,r),d.dir=u,_.push(d),this.setup.searchStep[T][c]=1}},t.prototype.findLessCostPos=function(t){if(0==t.length)return null;for(var e=t[0],n=0,i=t;n<i.length;n++){var o=i[n];o.cost<e.cost&&(e=o)}return e},t.prototype.getPath=function(t,e,n,i,o){if(null==e||e.x==n&&e.y==i)return null;var a=[],r=Tool.setKeyXY(e.x+MapTool.getMoveXByDir(e.dir,o),e.y+MapTool.getMoveYByDir(e.dir,o)),s=MapTool.getReverseDir(e.dir);a.splice(0,0,s);for(var l,_,h=null;l=Tool.getXKey(r),_=Tool.getYKey(r),l!=n||_!=i;){if(null==(h=this.getPathInfoByPos(l,_,t)))return null;var u=t.indexOf(h);t.splice(u,1),r=Tool.setKeyXY(h.x+MapTool.getMoveXByDir(h.dir,o),h.y+MapTool.getMoveYByDir(h.dir,o)),a.splice(0,0,MapTool.getReverseDir(h.dir))}return a},t.prototype.getPathInfoByPos=function(t,e,n){for(var i=null,o=n.length-1;o>=0;o--)if((i=n[o]).x==t&&i.y==e)return i;return null},t.prototype.changeDirMoveVectorToPixelMove=function(t,e){var n=[];if(null==e)return n;var i=xworld.gameMap;if(null==i)return n;for(var o,a=xself.x,r=xself.y,s=Math.floor(a/MapSetup.GRID_WIDTH),l=Math.floor(r/MapSetup.GRID_HEIGHT),_=s*MapSetup.GRID_WIDTH,h=l*MapSetup.GRID_HEIGHT,u=Math.abs(a-_)+Math.abs(r-h),c=_,T=h,p=e.length,d=0;p>d;){var E=e[d];if(d++,8!=E){var g=8;p>d&&(g=e[d]);var S=!0;if((8==g||g==E)&&(S=!1),o=MapTool.getFaceXY(s,l,g),i.isCanPass(Tool.getXKey(o),Tool.getYKey(o))||(S=!1),0!=S){for(var m=MapSetup.GRID_WIDTH;m>0;){var f=Math.min(m,t),I=MapTool.getMoveXByDir(E,f),A=MapTool.getMoveYByDir(E,f),y=I+MapTool.getMoveXByDir(g,f),R=A+MapTool.getMoveYByDir(g,f);if(n.push(Tool.setKeyXY(y,R)),_+=y,h+=R,u>0)u>=(P=Math.abs(a-_)+Math.abs(r-h))&&(u=P,c=_,T=h,n=[]);m-=t}o=MapTool.getFaceXY(s,l,E),s=Tool.getXKey(o),l=Tool.getYKey(o),o=MapTool.getFaceXY(s,l,g),s=Tool.getXKey(o),l=Tool.getYKey(o),d++}else{for(m=MapSetup.GRID_WIDTH;m>0;){var P;f=Math.min(m,t),y=MapTool.getMoveXByDir(E,f),R=MapTool.getMoveYByDir(E,f);if(n.push(Tool.setKeyXY(y,R)),_+=y,h+=R,u>0)u>=(P=Math.abs(a-_)+Math.abs(r-h))&&(u=P,c=_,T=h,n=[]);m-=t}o=MapTool.getFaceXY(s,l,E),s=Tool.getXKey(o),l=Tool.getYKey(o)}}}var C=[];if(c!=a)if(c>a)for(var M=c-a;M>0;){var L=Tool.setKeyXY(Math.min(M,t),0);C.push(L),M-=t}else for(M=a-c;M>0;){L=Tool.setKeyXY(-Math.min(M,t),0);C.push(L),M-=t}if(T!=r)if(T>r)for(var v=T-r;v>0;){var O=Tool.setKeyXY(0,Math.min(v,t));C.push(O),v-=t}else for(v=r-T;v>0;){O=Tool.setKeyXY(0,-Math.min(v,t));C.push(O),v-=t}for(d=C.length-1;d>=0;d--)n.unshift(C[d]);return n},t.TAG_IS_INIT=1,t.TAG_FORCE_PAINT=2,t.TAG_MAP_IMG_OFF=4,t.TAG_MAP_STAGE_INIT=8,t.MAP_CAN_SUBMIT=0,t.MAP_CAN_ACCEPT=1,t.MAP_DIR=2,t.MAP_MONSTER=3,t.MAP_NPC=4,t.MAP_JUMP=5,t.MAP_NOT_CAN_SUB=6,t.MAP_RADAR=7,t.wayPointPool=[],t}();__reflect(GameMap.prototype,"GameMap");var WayPoint=function(){function t(){}return t.prototype.recycle=function(){this.x=0,this.y=0,this.cost=0,this.dir=0},t}();__reflect(WayPoint.prototype,"WayPoint");var LayerSetup=function(){function t(t){this.type=-1,this.type=t}return t.prototype.create=function(t){return null},t.prototype.load=function(t,e){return!0},t.LAYER_BLOCK=1,t.LAYER_TILE=2,t.LAYER_PIXEL=3,t.LAYER_PLAYER=4,t.LAYER_ANIM=5,t}();__reflect(LayerSetup.prototype,"LayerSetup");var TileLayerSetup=function(t){function e(){return t.call(this,LayerSetup.LAYER_TILE)||this}return __extends(e,t),e.prototype.create=function(t){return new TileLayer(this,t)},e.prototype.load=function(t,e){return t.position+=e.mapRows*e.mapColumns,!0},e}(LayerSetup);__reflect(TileLayerSetup.prototype,"TileLayerSetup");var PixelLayerSetup=function(t){function e(){var e=t.call(this,LayerSetup.LAYER_PIXEL)||this;return e.xs=null,e.ys=null,e.imagesIndex=null,e.transforms=null,e}return __extends(e,t),e.prototype.create=function(t){return new PixelLayer(this,t)},e.prototype.load=function(t,e){var n=t.readShort();return t.position+=6*n,!0},e}(LayerSetup);__reflect(PixelLayerSetup.prototype,"PixelLayerSetup");var PlayerLayerSetup=function(t){function e(){var e=t.call(this,LayerSetup.LAYER_PLAYER)||this;return e.centerXs=null,e.bottomYs=null,e.imagesIndex=null,e.transforms=null,e.mapSprites=null,e.mapSpriteIDList=null,e}return __extends(e,t),e.prototype.create=function(t){return new PlayerLayer(this,t)},e.prototype.load=function(t,e){var n=t.readUnsignedByte(),i=new Array(n),o=new Array(n);this.mapSprites=i,this.mapSpriteIDList=o;for(var a=0;n>a;a++){var r=t.readShort();o[a]=r,i[a]=SpriteHelper.createSprite(r,!1)}for(var s=t.readShort(),l=new Array(s),_=new Array(s),h=new Array(s),u=new Array(s),c=new Array,T=0;s>T;T++)l[T]=t.readShort(),_[T]=t.readShort(),h[T]=t.readUnsignedByte(),u[T]=t.readByte(),u[T]>=0&&c.push(h[T]);e.preloadImagesIndex=c;var p=e.mapRows;this.centerXs=new Array(p),this.bottomYs=new Array(p),this.imagesIndex=new Array(p),this.transforms=new Array(p);for(var d=0,E=0;p>E;E++){d=0;for(var g=0;s>g;g++)Math.floor(_[g]/MapSetup.GRID_HEIGHT)==E&&d++;this.centerXs[E]=new Array(d),this.bottomYs[E]=new Array(d),this.imagesIndex[E]=new Array(d),this.transforms[E]=new Array(d)}for(E=0;p>E;E++){d=0;for(g=0;s>g;g++)Math.floor(_[g]/MapSetup.GRID_HEIGHT)==E&&(this.centerXs[E][d]=l[g],this.bottomYs[E][d]=_[g],this.imagesIndex[E][d]=h[g],this.transforms[E][d]=u[g],d++)}return!0},e.MAP_SPRITE_ROTATE_YES=-1,e.MAP_SPRITE_ROTATE_NO=-2,e.DRAW_GRID_Y_OFFSET=5,e.MAX_PLAYER_SHOW=20,e.SHOW_SIMPLE_PLAYER_GRID=3*MapSetup.GRID_WIDTH,e}(LayerSetup);__reflect(PlayerLayerSetup.prototype,"PlayerLayerSetup");var MapLayer=function(t){function e(e,n){var i=t.call(this)||this;return i._map=null,i._setup=null,i._map=n,i._setup=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setup",{get:function(){return this._setup},enumerable:!0,configurable:!0}),e.prototype.load=function(){},e.prototype.getTile=function(t){return this._map.getTile(t)},e.prototype.getItem=function(t,e){return this._map.getItem(t,e)},e}(egret.DisplayObjectContainer);__reflect(MapLayer.prototype,"MapLayer");var TileLayer=function(t){function e(e,n){return t.call(this,e,n)||this}return __extends(e,t),e.prototype.load=function(){},e}(MapLayer);__reflect(TileLayer.prototype,"TileLayer");var PixelLayer=function(t){function e(e,n){return t.call(this,e,n)||this}return __extends(e,t),e.prototype.load=function(){},e}(MapLayer);__reflect(PixelLayer.prototype,"PixelLayer");var PlayerLayer=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.verticalContainers={},i.unitList=[],i}return __extends(e,t),e.prototype.setNPCNameVisible=function(t){this.npcNameContainer&&(this.npcNameContainer.visible=t),this.npcMissionIconContainer&&(this.npcMissionIconContainer.visible=t)},e.prototype.load=function(){var t=(this.map,this.setup),n=xworld.gameMap;if(this.npcNameContainer=e.getContainer(),this.npcNameContainer.name="npcNameContainer",this.npcNameContainer.cacheAsBitmap=!0,n.addToForeground(this.npcNameContainer),this.npcMissionIconContainer=e.getContainer(),this.npcMissionIconContainer.name="npcMissionIconContainer",this.npcMissionIconContainer.cacheAsBitmap=!0,n.addToForeground(this.npcMissionIconContainer),null!=t)for(var i=0,o=t.imagesIndex.length;o>i;i++)this.loadRowObject(t,i)},e.prototype.addNpcNameLabel=function(t){this.npcNameContainer.addChild(t)},e.prototype.addNpcMissionIcon=function(t,e){if(xself.getLevel()<16&&(Define.isCityMap(xworld.orgMapID)&&"日常任务列表"!=e.getName()))return;this.npcMissionIconContainer.addChild(t)},e.prototype.loadRowObject=function(t,n){for(var i=0,o=0,a=t.centerXs,r=t.bottomYs,s=t.imagesIndex[n],l=t.transforms[n],_=0;_<s.length;_++){var h=s[_],u=l[_];if(i=a[n][_],o=r[n][_],0>u){var c=t.mapSprites[h];if(null==c)continue;u==e.MAP_SPRITE_ROTATE_YES&&c.setRotate(!0),c.x=i,c.y=o,this.putObjectIntoContainer(c)}else{var T=this.getItem(h,u);null!=T&&(T.x=i,T.y=o,this.putObjectIntoContainer(T))}}},e.prototype.putObjectIntoContainer=function(t){if(null!=t){var n=Math.floor(t.y/e.VERTICAL_HEIGHT),i=this.verticalContainers[n];null==i&&(i=this.generateRowContainer(n)),i.addChild(t)}},e.prototype.generateRowContainer=function(t){var n=e.getContainer();return n.name="container_"+t*e.VERTICAL_HEIGHT,this.addChild(n),this.verticalContainers[t]=n,n},e.getContainer=function(){return e.containerPool.length?e.containerPool.pop():new egret.Sprite},e.getElementPosWeight=function(t){var e=t.y;return egret.is(t,"Model")?e=t.y+MapSetup.GRID_HEIGHT:-1!=t.name.indexOf("container")&&(e=parseInt(t.name.split("_")[1])),e},e.prototype.compareDepth=function(t,n){var i=e.getElementPosWeight(t),o=e.getElementPosWeight(n);return i>o?1:o>i?-1:t.hashCode>n.hashCode?1:t.hashCode<n.hashCode?-1:0},e.prototype.update=function(t){t%21==0&&this.sortElements()},e.prototype.sortElements=function(){if(null!=xself&&null!=xself.sprite){var t=this.numChildren,e=this.unitList;e.length!=t&&(e.length=t);for(var n=0;t>n;n++)e[n]=this.getChildAt(n);e.sort(this.compareDepth);for(n=0;t>n;n++){var i=e[n];this.getChildAt(n)!=i&&this.setChildIndex(i,n)}}},e.prototype.recycle=function(){for(var t in this.verticalContainers){var n=this.verticalContainers[t];n.removeChildren(),e.containerPool.push(n)}this.npcNameContainer&&(this.npcNameContainer.removeChildren(),e.containerPool.push(this.npcNameContainer)),this.npcMissionIconContainer&&(this.npcMissionIconContainer.removeChildren(),e.containerPool.push(this.npcMissionIconContainer))},e.MAP_SPRITE_ROTATE_YES=-1,e.MAP_SPRITE_ROTATE_NO=-2,e.DRAW_GRID_Y_OFFSET=5,e.MAX_PLAYER_SHOW=20,e.SHOW_SIMPLE_PLAYER_GRID=3*MapSetup.GRID_WIDTH,e.containerPool=[],e.VERTICAL_HEIGHT=50,e}(MapLayer);__reflect(PlayerLayer.prototype,"PlayerLayer");var MapTool,Statistic=function(){function t(){}return t.httpRequest=function(e,n){if(!xdebug){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,t.HTTPMETHOD_GET==n?i.open(e,egret.HttpMethod.GET):i.open(e,egret.HttpMethod.POST),i.send()}},t.login=function(e,n){if(null!=xstatistics){var i=xstatistics+"login?uid="+nato.getUid()+"&chan="+n;t.httpRequest(i,t.HTTPMETHOD_POST)}},t.register=function(e,n){if(null!=xstatistics){var i=xstatistics+"register?accid="+e+"&chan="+n;t.httpRequest(i,t.HTTPMETHOD_POST)}},t.selectRole=function(e,n,i){if(null!=xstatistics){var o=xstatistics+"select?accid="+e+"&chan="+n+"&zone="+i;t.httpRequest(o,t.HTTPMETHOD_POST)}},t.HTTPMETHOD_GET=1,t.HTTPMETHOD_POST=2,t}();__reflect(Statistic.prototype,"Statistic"),function(t){t.getMoveXByDir=function(t,e){switch(t){case 1:return-e;case 0:return e}return 0},t.getMoveYByDir=function(t,e){switch(t){case 3:return-e;case 2:return e}return 0},t.getReverseDir=function(t){switch(t){case 2:return 3;case 3:return 2;case 1:return 0;case 0:return 1}return 8},t.getFaceXY=function(t,e,n){var i=t,o=e;switch(n){case 3:o--;break;case 0:i++;break;case 2:o++;break;case 1:i--;break;case 4:i--,o--;break;case 5:i--,o++;break;case 6:i++,o--;break;case 7:i++,o++}return Tool.setKeyXY(i,o)},t.getDirByMovePixels=function(t,e,n){if(t>0){if(n){if(e>0)return 7;if(0>e)return 6}return 0}if(0>t){if(n){if(e>0)return 5;if(0>e)return 4}return 1}return e>0?2:0>e?3:8}}(MapTool||(MapTool={}));var SmallMap=function(t){function e(){var e=t.call(this)||this;return e.mapSpaceX=0,e.mapSpaceY=0,e.smallMapGridWidth=2,e.mapAreaWidth=0,e.mapAreaHeight=0,e.ratio=1,e.ratioW=0,e.ratioH=0,e.smallMapCtn=new egret.Sprite,e.smallMapCtn.name="smallMapCtn",e.addChild(e.smallMapCtn),e.gradientBG=new eui.Image,e.gradientBG.source="smallmap_bg",e.gradientBG.scale9Grid=new egret.Rectangle(6,10,8,142),e.gradientBG.name="gradientBG",e.bottomLayer=new egret.Shape,e.bottomLayer.cacheAsBitmap=!0,e.bottomLayer.name="bottomLayer",e.surfaceLayer=new egret.Shape,e.surfaceLayer.cacheAsBitmap=!0,e.surfaceLayer.name="surfaceLayer",e.contentLayer=new egret.Sprite,e.contentLayer.name="contentLayer",e.wayLayer=new egret.Sprite,e.wayLayer.name="wayLayer",e.wayLayer.cacheAsBitmap=!0,e.contentLayer.addChild(e.wayLayer),e.coordBottomLayer=new egret.Sprite,e.coordBottomLayer.name="coordBottomLayer",e.coordBottomLayer.graphics.beginFill(16777215,.8),e.coordBottomLayer.graphics.drawRect(0,0,42,12),e.coordBottomLayer.graphics.endFill(),e.coordBottomLayer.cacheAsBitmap=!0,e.coordBgLayer=new egret.Sprite,e.coordBgLayer.graphics.beginFill(0),e.coordBgLayer.graphics.drawRect(1,1,40,10),e.coordBgLayer.graphics.endFill(),e.coordBgLayer.name="coordBgLayer",e.coordBottomLayer.addChild(e.coordBgLayer),e.iconsLayer=new egret.Sprite,e.iconsLayer.name="iconsLayer",e.iconsLayer.cacheAsBitmap=!0,e.scaleLayer=new egret.Sprite,e.scaleLayer.name="scaleLayer",e.posText=new egret.TextField,e.posText.size=10,e.posText.textColor=16777215,e.mapNameText=new egret.TextField,e.mapNameText.size=12,e.mapNameText.stroke=1,e.mapNameText.textColor=16777215,e.mapNameText.strokeColor=0,e.smallMapArrow=new egret.Bitmap,e.smallMapArrow.texture=nato.findTextureForSheet(ImageSet.IMG_SET_SMALL_MAP,GameMap.MAP_DIR),e}return __extends(e,t),e.getSettingMap=function(){var t=xself;return null==t||t.isSettingBit(Define.SETTING_MINI_MAP_OFF)?e.MAP_OFF:t.isSettingBit(Define.SETTING_MINI_MAP_ALL)?e.MAP_ALL:e.MAP_SIMPLE},e.prototype.initSmallMap=function(){var t=0;if(this.smallMapCtn.removeChildren(),e.getSettingMap()!=e.MAP_OFF){var n=xworld.gameMap,i=n.setup;this.setup=i,this.mapSpaceX=1,this.mapSpaceY=1,this.contentLayer.x=0,this.contentLayer.y=0,this.ratioW=this.setup.mapColumns*this.smallMapGridWidth/this.setup.mapWidth,this.ratioH=this.setup.mapRows*this.smallMapGridWidth/this.setup.mapHeight;var o=!1,a=!1,r=i.mapColumns;i.mapColumns<=e.SMALL_SHOW_MAP_WIDTH?(this.mapSpaceX+=(e.SMALL_SHOW_MAP_WIDTH-r)/2,r=e.SMALL_SHOW_MAP_WIDTH):o=!0;var s=i.mapRows;i.mapRows<=e.SMALL_SHOW_MAP_WIDTH?(this.mapSpaceY+=(e.SMALL_SHOW_MAP_WIDTH-s)/2,s=e.SMALL_SHOW_MAP_WIDTH):a=!0,this.ratio=o||a?e.SMALL_SHOW_MAP_WIDTH/Math.max(i.mapColumns,i.mapRows):1;var l=this.smallMapGridWidth;this.smallMapWidth=r*l,this.smallMapHeight=s*l,this.smallMapCtn.addChild(this.scaleLayer),this.gradientBG.x=-5,this.gradientBG.y=-5,this.gradientBG.width=this.smallMapWidth+12,this.gradientBG.height=this.smallMapHeight+12,this.gradientBG.cacheAsBitmap=!0,this.scaleLayer.addChild(this.gradientBG),this.bottomLayer.graphics.clear(),this.bottomLayer.graphics.beginFill(0,.8),this.bottomLayer.graphics.drawRect(0,0,this.smallMapWidth+2,this.smallMapHeight+2),this.bottomLayer.graphics.endFill(),this.scaleLayer.addChild(this.bottomLayer),this.surfaceLayer.graphics.clear(),this.surfaceLayer.graphics.beginFill(6508872,1),this.surfaceLayer.graphics.drawRect(1,1,this.smallMapWidth,this.smallMapHeight),this.surfaceLayer.graphics.endFill(),this.scaleLayer.addChild(this.surfaceLayer),t+=2,this.scaleLayer.addChild(this.contentLayer),this.wayLayer.removeChildren();for(var _=0;_<i.mapRows;_++)for(var h=0;h<i.mapColumns;h++)if(n.isCanPass(h,_)){var u=new egret.Shape;u.graphics.beginFill(9997161,1),u.graphics.drawRect((this.mapSpaceX+h)*l,(this.mapSpaceY+_)*l,l,l),u.graphics.endFill(),this.wayLayer.addChild(u),t+=1}return this.scaleX=nato.mapRatio,this.scaleY=nato.mapRatio,this.mapAreaWidth=this.bottomLayer.width*this.ratio,this.mapAreaHeight=this.bottomLayer.height*this.ratio,this.scaleLayer.scaleX=this.ratio,this.scaleLayer.scaleY=this.ratio,this.x=Main.instance.stage.stageWidth-this.mapAreaWidth*this.scaleX-5,this.y=6,PanelManager.mainMenu&&PanelManager.mainMenu.addChild(this),this.coordBottomLayer.x=(this.mapAreaWidth-this.coordBgLayer.width)/2,this.smallMapCtn.addChild(this.coordBottomLayer),this.addChild(this.posText),this.updateMapName(),t}},e.prototype.updateNPCIcon=function(){this.contentLayer.addChild(this.iconsLayer),this.iconsLayer.removeChildren();var t=e.getSettingMap(),n=xworld.npcList,i=null;if(n&&n.length>0)for(var o=0;o<n.length;o++)if(null!=(i=n[o])&&0!=i.isVisible()){var a=this.smallMapGridWidth,r=this.mapSpaceX*a+i.x/this.setup.mapWidth*(this.setup.mapColumns*a),s=this.mapSpaceY*a+i.y/this.setup.mapHeight*(this.setup.mapRows*a);switch(i.npcType){case 1:t==e.MAP_ALL&&this.addIconIntoMap(GameMap.MAP_MONSTER,r,s);break;case 8:case 3:this.addIconIntoMap(GameMap.MAP_JUMP,r,s);break;default:switch(i.isJumpIcon()?this.addIconIntoMap(GameMap.MAP_JUMP,r,s):this.addIconIntoMap(GameMap.MAP_NPC,r,s),i.getSign()){case 1:this.addIconIntoMap(GameMap.MAP_CAN_SUBMIT,r,s);break;case 3:this.addIconIntoMap(GameMap.MAP_CAN_ACCEPT,r,s);break;case 2:this.addIconIntoMap(GameMap.MAP_NOT_CAN_SUB,r,s)}}}this.smallMapArrow.anchorOffsetX=.5*this.smallMapArrow.width,this.smallMapArrow.anchorOffsetY=.5*this.smallMapArrow.height,this.contentLayer.addChild(this.smallMapArrow)},e.prototype.addIconIntoMap=function(t,e,n){var i=new egret.Bitmap;i.texture=nato.findTextureForSheet(ImageSet.IMG_SET_SMALL_MAP,t),i.anchorOffsetX=.5*i.width,i.anchorOffsetY=.5*i.height,i.x=e,i.y=n,this.iconsLayer.addChild(i)},e.prototype.updateSmallMap=function(t){var e=xself;if(null!=e){switch(e.getDir()){case 3:this.smallMapArrow.rotation=180;break;case 1:this.smallMapArrow.rotation=90;break;case 2:this.smallMapArrow.rotation=0;break;case 0:this.smallMapArrow.rotation=270}var n=this.smallMapGridWidth;this.smallMapArrow.x=this.mapSpaceX*n+e.x*this.ratioW,this.smallMapArrow.y=this.mapSpaceY*n+e.y*this.ratioH;var i=Math.floor(e.x/MapSetup.GRID_WIDTH),o=Math.floor(e.y/MapSetup.GRID_HEIGHT);this.posText.x=(this.mapAreaWidth-this.posText.width)/2,this.posText.y=1,this.posText.text=i+"  "+o}},e.prototype.updateMapName=function(){this.mapNameText.text=xworld.gameMap.setup.name,this.mapNameText.x=this.mapAreaWidth-this.mapNameText.textWidth,this.mapNameText.y=this.mapAreaHeight+2,this.addChild(this.mapNameText)},e.MAP_SIMPLE=0,e.MAP_ALL=1,e.MAP_OFF=2,e.SMALL_SHOW_MAP_WIDTH=36,e}(egret.Sprite);__reflect(SmallMap.prototype,"SmallMap");var Condition=function(){function t(t){this.type=t}return t.prototype.getType=function(){return this.type},t.fromBytes=function(e){var n=new t(e.readByte());n.not=e.readByte();var i=255&e.readByte(),o=new egret.ByteArray;return i>0&&e.readBytes(o,o.position,i),n.data=o,n},t.prototype.isConditionOfSatisfy=function(t){return this.checkCondition(t,this.data)},t.prototype.checkCondition=function(t,e){if(null==t)return!1;e&&(e.position=0);var n,i=!0;switch(this.type){case 0:i=!0;break;case 1:var o=e.readByte();i=t.getLevel()>=o;break;case 2:var a=(e.readShort(),e.readUTF(),e.readByte());i=e.readByte()>=a;break;case 3:var r=e.readInt();i=t.get(ModelConst.MONEY1)>=r;break;case 4:var s=e.readInt();0==(i=t.get(ModelConst.MONEY2)>=s)&&(i=t.get(ModelConst.MONEY1)>=s);break;case 5:var l=e.readInt();i=t.get(ModelConst.MONEY3)>=l;break;case 6:var _=e.readShort();i=t.get(ModelConst.COUNTRY_HONOR)>=_;break;case 33:i=(h=e.readByte())==Define.RANK_SOLDIER?t.isStatusBit(ModelConst.STATUS_IS_SOLDIER):t.get(ModelConst.COUNTRY_RANK)==h;break;case 34:var h=e.readByte();i=t.get(ModelConst.COUNTRY_RANK)>=h;break;case 7:var u=e.readInt(),c=(e.readUTF(),e.readByte());i=xitem.getItemNumByIdInBag(u)>=c;break;case 8:var T=e.readInt();e.readUTF(),i=t.isEquipItemByIdInEquip(T);break;case 9:var p=e.readShort();e.readUTF(),i=Mission.isMissionFinish(t,p);break;case 10:p=e.readShort();i=null!=(e.readUTF(),t.getMissionById(p));break;case 11:var d=e.readByte();i=t.getRace()==d;break;case 32:var E=e.readByte();i=t.getJob()==E;break;case 12:var g=e.readShort();e.readUTF(),i=xworld.gameMap.mapId==g;break;case 13:case 14:e.readByte(),e.readByte();break;case 15:i=t.get(ModelConst.SEX)==Define.SEX_MALE;break;case 16:case 25:case 28:break;case 17:e.readByte();break;case 18:var S=e.readInt();i=t.get(ModelConst.HP)>=S;break;case 19:var m=e.readInt();i=t.get(ModelConst.MP)>=m;break;case 20:var f=e.readShort();i=t.get(ModelConst.CON)>=f;break;case 21:var I=e.readShort();i=t.get(ModelConst.STR)>=I;break;case 22:var A=e.readShort();i=t.get(ModelConst.ILT)>=A;break;case 23:var y=e.readShort();i=t.get(ModelConst.AGI)>=y;break;case 24:o=e.readByte();i=!!Tool.isVip(t)&&t.getVipLevel()>=o;break;case 26:n=e.readByte(),i=GameWorld.cityScale>=n;break;case 27:n=e.readByte(),i=GameWorld.cityLevel>=n;break;case 29:n=e.readInt(),i=GameWorld.cityDegree>=n;break;case 30:n=e.readInt(),i=GameWorld.cityArmy>=n;break;case 31:i=GameWorld.getPlayerID()==GameWorld.cityMasterId}return 0==this.not?i:!i},t.prototype.isShowTargetType=function(){return 2==this.type||7==this.type},t.prototype.getTargetData=function(){var t=this.data;t.position=0;var e=null;if(2==this.type){t.readShort();var n=t.readUTF(),i=t.readByte(),o=t.readByte();(e=new TaskTargetData).showName=n,e.currentCount=o,e.needCount=i}else if(7==this.type){var a=t.readInt(),r=t.readUTF();i=t.readByte(),o=xitem.getItemNumByIdInBag(a);(e=new TaskTargetData).showName=r,e.currentCount=o,e.needCount=i}return e},t.prototype.getConditionDesc=function(){if(null==this.data||this.data.length<=0)return null;var t=this.data;t.position=0;var e=new StringBuffer;if(1==this.not&&e.append("[不要]"),2==this.type){t.readShort();var n=t.readUTF(),i=t.readByte(),o=t.readByte();e.append(GameText.STR_CONDITION_KILL_MONSTER),e.append(PowerString.makeColorString(n,ColorUtils.COLOR_YELLOW)),e.append(PowerString.makeColorString((o>i?i:o)+"/"+i,o>=i?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED))}else if(7==this.type){var a=t.readInt(),r=t.readUTF();i=t.readByte(),o=xitem.getItemNumByIdInBag(a);e.append(GameText.STR_CONDITION_GET),e.append(PowerString.makeColorString(r,ColorUtils.COLOR_YELLOW)),e.append(PowerString.makeColorString((o>i?i:o)+"/"+i,o>=i?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED))}else if(9==this.type){a=t.readShort();var s=t.readUTF(),l=Mission.isMissionFinish(xself,a);l?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED,e.append(Tool.manageString(GameText.STR_CONDITION_MISSION_DONE,PowerString.makeColorString(s,l?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)))}else if(6==this.type){var _=t.readShort();e.append(Tool.manageString(GameText.STR_CONDITION_HONOR,PowerString.makeColorString(""+_,ColorUtils.COLOR_YELLOW_GOLD)))}else if(3==this.type){var h=t.readInt();e.append(Tool.manageString(GameText.STR_CONDITION_NEED,GameText.getMoneyText(ModelConst.MONEY1)+PowerString.makeColorString(""+h,ColorUtils.COLOR_YELLOW_GOLD)))}else if(4==this.type){var u=t.readInt();e.append(Tool.manageString(GameText.STR_CONDITION_NEED,GameText.getMoneyText(ModelConst.MONEY2)+PowerString.makeColorString(""+u,ColorUtils.COLOR_YELLOW_GOLD)))}else if(5==this.type){var c=t.readInt();e.append(Tool.manageString(GameText.STR_CONDITION_NEED,GameText.getMoneyText(ModelConst.MONEY3)+PowerString.makeColorString(""+c,ColorUtils.COLOR_YELLOW_GOLD)))}else if(29==this.type){var T=t.readInt();e.append(Tool.manageString(GameText.STR_CONDITION_NEED_CITY_DEGREE,PowerString.makeColorString(""+T,ColorUtils.COLOR_YELLOW_GOLD)))}else if(30==this.type){var p=t.readInt();e.append(Tool.manageString(GameText.STR_CONDITION_NEED_CITY_ARMY,PowerString.makeColorString(""+p,ColorUtils.COLOR_YELLOW_GOLD)))}else this.getAcceptConditionConst(e,t);return e.toString()},t.prototype.getAcceptConditionConst=function(t,e){if(1==this.type){var n=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_LEVEL,PowerString.makeColorString(""+n,ColorUtils.COLOR_YELLOW_GOLD)))}else if(8==this.type){e.readInt();var i=e.readUTF();t.append(Tool.manageString(GameText.STR_CONDITION_EQUIP_ITEM,PowerString.makeColorString(i,ColorUtils.COLOR_YELLOW_GOLD)))}else if(10==this.type){var o=e.readShort();i=e.readUTF();i+="("+o+")",t.append(Tool.manageString(GameText.STR_CONDITION_MISSION_DOING,PowerString.makeColorString(i,ColorUtils.COLOR_YELLOW_GOLD)))}else if(11==this.type){var a=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_SCHOOL,PowerString.makeColorString(Define.getRaceString(a),ColorUtils.COLOR_YELLOW_GOLD)))}else if(32==this.type){var r=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_JOB,PowerString.makeColorString(Define.getJobString(r),ColorUtils.COLOR_YELLOW_GOLD)))}else if(33==this.type){var s=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_COUNTRY_RANK,PowerString.makeColorString(Define.getRankString(s),ColorUtils.COLOR_YELLOW_GOLD)))}else if(34==this.type){s=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_COUNTRY_RANK2,PowerString.makeColorString(Define.getRankString(s),ColorUtils.COLOR_YELLOW_GOLD)))}else if(12==this.type){e.readShort();i=e.readUTF();t.append(Tool.manageString(GameText.STR_CONDITION_IN_MAP,PowerString.makeColorString(i,ColorUtils.COLOR_YELLOW_GOLD)))}else if(13==this.type){var l=e.readByte(),_=e.readByte(),h=Tool.manageString(GameText.STR_CONDITION_MONTH_DAY,l+"",!1);h=Tool.manageString(h,_+"",!1),h=PowerString.makeColorString(h,ColorUtils.COLOR_YELLOW_GOLD),t.append(Tool.manageString(GameText.STR_CONDITION_AFTER_DATE,h))}else if(14==this.type){var u=e.readByte(),c=e.readByte();h=Tool.manageString(GameText.STR_CONDITION_HOUR_MINUTE,u+"",!1);h=Tool.manageString(h,c+"",!1),h=PowerString.makeColorString(h,ColorUtils.COLOR_YELLOW_GOLD),t.append(Tool.manageString(GameText.STR_CONDITION_AFTER_DATE,h))}else if(15==this.type)t.append(GameText.STR_CONDITION_SEX);else if(16==this.type)t.append(GameText.STR_CONDITION_IN_GUILD);else if(17==this.type){o=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_HAVE_BUFF,o+""))}else if(18==this.type){var T=e.readInt();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_HP,PowerString.makeColorString(""+T,ColorUtils.COLOR_YELLOW_GOLD)))}else if(19==this.type){var p=e.readInt();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_MP,PowerString.makeColorString(""+p,ColorUtils.COLOR_YELLOW_GOLD)))}else if(20==this.type){var d=e.readShort();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_CON,PowerString.makeColorString(""+d,ColorUtils.COLOR_YELLOW_GOLD)))}else if(21==this.type){var E=e.readShort();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_STR,PowerString.makeColorString(""+E,ColorUtils.COLOR_YELLOW_GOLD)))}else if(22==this.type){var g=e.readShort();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_ITL,PowerString.makeColorString(""+g,ColorUtils.COLOR_YELLOW_GOLD)))}else if(23==this.type){var S=e.readShort();t.append(Tool.manageString(GameText.STR_CONDITION_PLAYER_AGI,PowerString.makeColorString(""+S,ColorUtils.COLOR_YELLOW_GOLD)))}else if(24==this.type){n=e.readByte();var m=GameText.STR_VIP;t.append(Tool.manageString(GameText.STR_CONDITION_LEVEL,m+PowerString.makeColorString(""+n,ColorUtils.COLOR_YELLOW_GOLD)))}else if(26==this.type){var f=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_CITY_SCALE,PowerString.makeColorString(""+f,ColorUtils.COLOR_YELLOW_GOLD)))}else if(27==this.type){var I=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_CITY_LEVEL,PowerString.makeColorString(""+I,ColorUtils.COLOR_YELLOW_GOLD)))}else if(28==this.type){var A=e.readByte();t.append(Tool.manageString(GameText.STR_CONDITION_CITY_BRANCH,PowerString.makeColorString(""+A,ColorUtils.COLOR_YELLOW_GOLD)))}else 31==this.type&&t.append(GameText.STR_CONDITION_CITY_ISMASTER)},Object.defineProperty(t.prototype,"isNestedMissionType",{get:function(){return 9==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isKillMonsterType",{get:function(){return 2==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollectItemType",{get:function(){return 7==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollectMonsterDropItemType",{get:function(){if(7!=this.type)return!1;this.data.position=0;var e=this.data.readInt();return this.data.readUTF(),this.data.readByte(),-1!=t.COLLECT_ITEM_DROP_FROM_MONSTER.indexOf(e)},enumerable:!0,configurable:!0}),t.prototype.getKillMonsterCondition=function(){return this.isKillMonsterType?new KillMonsterCondition(this.data):null},t.prototype.getCollectItemCondition=function(){return this.isCollectMonsterDropItemType?new CollectItemCondition(this.data):null},t.prototype.cleanKillMonster=function(){this.setKilledMonsterNum(0,0,!0,null)},t.prototype.updateKilledMonsterNum=function(t,e,n){this.setKilledMonsterNum(t,e,!1,n)},t.prototype.setKilledMonsterNum=function(t,e,n,i){if(2==this.type){var o=this.data;o.position=0;var a=o.readShort(),r=o.readUTF(),s=o.readByte(),l=o.readByte(),_=0;if(0==n){if(a!=t)return;var h=l+e;h>Tool.MAX_VALUE_byte&&(h=Tool.MAX_VALUE_byte),_=h,null!=i&&i.append(PowerString.makeColorString(GameText.STR_CONDITION_MISSION,ColorUtils.COLOR_YELLOW)+r+" "+PowerString.makeColorString(_+"",_>=s?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)+"/"+s+"\n")}var u=new egret.ByteArray;u.writeShort(a),u.writeUTF(r),u.writeByte(s),u.writeByte(_),this.data=u}},t.prototype.updateHaveItemNum=function(t,e){if(7==this.type&&null!=xself){var n=this.data;n.position=0;var i=n.readInt(),o=(n.readUTF(),n.readByte()),a=xitem.getItemNumByIdInBag(t);i==t&&e&&e.append("  ("+PowerString.makeColorString(a+"",a>=o?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_RED)+"/"+o+")")}},t.prototype.processConditionDeductItem=function(t){var e=this.data;switch(e.position=0,this.type){case 3:var n=e.readInt();t.addValue(ModelConst.MONEY1,-n);break;case 4:var i=e.readInt();t.addValue(ModelConst.MONEY2,-i);break;case 5:var o=e.readInt();t.addValue(ModelConst.MONEY3,-o);break;case 6:var a=e.readShort();t.addValue(ModelConst.COUNTRY_HONOR,-a);break;case 7:var r=e.readInt(),s=(e.readUTF(),e.readByte());null!=t.bag&&t.bag.removeBagItemByNum(r,s)}},t.COLLECT_ITEM_DROP_FROM_MONSTER=[1,2,3,4,5,6,8,9,10,60,61,75,89,105,303,304,306,501,502,503,504,505,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,600,700,701,702,703,710,715,730,751,824,35004,9038,9039,9040],t}();__reflect(Condition.prototype,"Condition");var KillMonsterCondition=function(){function t(t){t.position=0,this.id=t.readShort(),this.monsterName=t.readUTF(),this.total=t.readByte(),this.current=t.readByte()}return Object.defineProperty(t.prototype,"isComplete",{get:function(){return this.current>=this.total},enumerable:!0,configurable:!0}),t}();__reflect(KillMonsterCondition.prototype,"KillMonsterCondition");var CollectItemCondition=function(){function t(t){t.position=0,this.id=t.readInt(),this.name=t.readUTF(),this.total=t.readByte(),this.current=xitem.getItemNumByIdInBag(this.id)}return Object.defineProperty(t.prototype,"isComplete",{get:function(){return this.current>=this.total},enumerable:!0,configurable:!0}),t}();__reflect(CollectItemCondition.prototype,"CollectItemCondition");var MissionConst,Utility=function(){function t(){}return t.getTranslate=function(e){switch(e){case t.MIRROR:return t.TRANS_MIRROR;case t.MIRROR_180:return t.TRANS_MIRROR_ROT180;case t.ROTATE_90:return t.TRANS_ROT90;case t.ROTATE_180:return t.TRANS_ROT180;case t.ROTATE_270:return t.TRANS_ROT270;case t.MIRROR_270:return t.TRANS_MIRROR_ROT270;case t.MIRROR_90:return t.TRANS_MIRROR_ROT90}return t.TRANS_NONE},t.isRotate=function(e){return e==t.TRANS_ROT90||e==t.TRANS_ROT270},t.getPlanTime=function(t){return t-(new Date).getTime()},t.TRANS_NONE=0,t.TRANS_MIRROR_ROT180=1,t.TRANS_MIRROR=2,t.TRANS_ROT180=3,t.TRANS_MIRROR_ROT270=4,t.TRANS_ROT90=5,t.TRANS_ROT270=6,t.TRANS_MIRROR_ROT90=7,t.MIRROR_NO=0,t.MIRROR=1,t.MIRROR_180=2,t.ROTATE_90=3,t.ROTATE_180=4,t.ROTATE_270=5,t.MIRROR_270=6,t.MIRROR_90=7,t.PATH_LOGO="logo/",t.PATH_TITLE="title/",t.PATH_COMMON="common/",t.PATH_MAP="map/",t.PATH_ANI="ani/",t.PATH_UI="ui/",t.PATH_MISSION="mission/",t.NAME_SUFFIX_PAGE_DATA=".pd",t.NAME_SUFFIX_PAGE_NAME=".pn",t.NAME_SUFFIX_MAP=".mt",t.NAME_SUFFIX_MAP_MINI="_mini.m",t.NAME_SUFFIX_EVENT=".n",t.NAME_SUFFIX_PL=".pl",t.NAME_SUFFIX_FRAGMENT=".fr",t.NAME_SUFFIX_SPRITE=".spr",t.NAME_SUFFIX_PNG=".png",t.NAME_SUFFIX_FONT=".t",t.NAME_SUFFIX_UI=".ui",t.NAME_SUFFIX_MISSION=".mss",t.NAME_SUFFIX_MISSION_TEXT=".txt",t}();__reflect(Utility.prototype,"Utility"),function(t){t.CAN_SUBMIT=0,t.NOT_CAN_SUBMIT=1,t.CAN_ACCEPT=2,t.NOT_CAN_ACCEPT=3}(MissionConst||(MissionConst={}));var RandomMission=function(t){function e(e){var n=t.call(this,e)||this;return n.rmissionStatus=0,n.rmissionType=0,n.rneedCount=0,n.rhaveCount=0,n.rItemcount=0,n.moneyType=0,n.money=0,n.myCount=0,n.maxCount=0,n}return __extends(e,t),e.prototype.getDetails=function(t){var e=new StringBuffer;if(null==xself)return"";""!=this.desc&&(e.append(this.desc),e.append("\n"));var n=this.getConditionDesc(this.submitCondition);return 0==Tool.isNullText(n)&&(e.append(PowerString.makeColorString(GameText.STR_NPC_MISSION_DEST,16776960)+n),e.append("\n")),e.append(this.getMissionRewardString(!0,0)),e.toString()},e.prototype.fromRandomMission=function(t){if(this.rmissionStatus=t.getByte(),this.rmissionStatus!=e.STATUS_END_1&&this.rmissionStatus!=e.STATUS_END_2&&this.rmissionStatus!=e.STATUS_WAIT){this.desc=t.getString(),this.rmissionType=t.getByte(),this.objName=t.getString();var n;n=this.rmissionType==e.TYPE_MONSTER?GameText.STR_KILL:GameText.STR_COLLECT,this.name=n+this.objName,this.rneedCount=t.getShort(),this.rhaveCount=t.getShort(),this.exp=t.getInt(),this.money2=t.getInt(),this.money3=t.getInt();var i;if(i=t.getByte(),this.rItemcount=i,i>0){this.rewardItems=new Array(i);for(var o=0;i>o;o++){var a=new ItemData;a.name=t.getString(),a.quantity=t.getByte(),a.bagIcon=t.getByte(),a.grade=t.getByte(),this.rewardItems[o]=a}}}else this.rmissionStatus==e.STATUS_WAIT&&(this.rmissionTime=t.getLong())},e.doRandomMissionInfo=function(t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=new nato.Message(ProtocolDefine.CG_TASK_RANDOM_INFO);nato.Network.sendCmd(i,(function(i){PanelManager.closeWaitForServer();var o=new e(0);if(o.setting|=2097152,o.fromRandomMission(i),o.moneyType=i.getInt(),o.money=i.getInt(),o.myCount=i.getByte(),o.maxCount=i.getByte(),e.curRandomMission=o,null!=t&&null!=n)t.call(n);else if(PanelManager.isPanelShow(TaskScene)){PanelManager.getPanel(TaskScene).updateRandomMission(o)}}),this),PanelManager.openWaitForServer()},e.doRandomMissionAccept=function(t,e){var n=t;if(null!=n){var i=function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){var e=t.getInt(),i=t.getInt();if(xself.money1=e,xself.money2=i,n.fromRandomMission(t),PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).updateRandomMission(n);NPC.doMissionInfoView(xself,n,null,NPCConst.SUB_MISSION_VIEW)}},o=function(){var t=new nato.Message(ProtocolDefine.CG_TASK_RANDOM_GET);t.putBoolean(e),nato.Network.sendCmd(t,i,this),PanelManager.openWaitForServer()};if(e){if(0==SafeLock.doSafeLockVerify())return;var a=function(){o()};return void AlertPanel.alert(GameText.STR_REFRESH_RANDOM_MISSION,Tool.manageString(GameText.STR_REFRESH_RANDOM_MISSION_ASK,n.money+GameText.getMoneyText(n.moneyType)),(function(){Model.checkEnoughMoney(0,n.money,0,a,this)}),this)}o()}},e.doRandomMissionGiveUp=function(t){if(null!=t){var n=function(t){MsgHandler.isMessageHaveError(t)||e.doRandomMissionInfo()};AlertPanel.alert(GameText.getText(GameText.TI_DELECT_MISSION),GameText.STR_DEL_RANDOM_MISSION_ASK,(function(){var t=new nato.Message(ProtocolDefine.CG_TASK_RANDOM_CANCEL);nato.Network.sendCmd(t,n,this)}),this)}},e.doRandomMissionSumbit=function(){var t=new nato.Message(ProtocolDefine.CG_TASK_RANDOM_FINISH);nato.Network.sendCmd(t,(function(t){if(!MsgHandler.isMessageHaveError(t)){var e=xself;if(MsgHandler.processMissionReward(e,0,t),AlertPanel.alertCommon(GameText.STR_ALLODS_GOLD_SUCCESS),PanelManager.isPanelShow(TaskScene))PanelManager.getPanel(TaskScene).updateTab()}}),this)},e.getRandomMissionDoingDesc=function(t){if(null==t)return"";if(t.rmissionStatus==e.STATUS_END_1||t.rmissionStatus==e.STATUS_END_2||t.rmissionStatus==e.STATUS_WAIT)return"";var n,i=new StringBuffer;n=t.rmissionType==e.TYPE_MONSTER?GameText.STR_KILL:GameText.STR_COLLECT;var o=t.objName;0==Tool.isNullText(o)&&i.append(PowerString.makeColorString(GameText.STR_NPC_MISSION_DEST,16776960)+n+PowerString.makeColorString(o,16776960));var a=t.rneedCount+"",r=t.rhaveCount+"";return i.append(PowerString.makeColorString(r,ColorUtils.COLOR_RED)),i.append(PowerString.makeColorString("/"+a,ColorUtils.COLOR_RED)),i.append("\n"),i.toString()},e.prototype.getRandomMissionTime=function(){var t=GameText.STR_HAVE_NO_TIME,e=this.rmissionTime.value;if(e>0){var n=Math.floor(e/Tool.MILLIS_IN_MINUTE);e%Tool.MILLIS_IN_MINUTE!=0&&n++,t=Tool.getTimeStrByMin(n,!0)}return Tool.manageStringList(GameText.STR_GET_RANDOM_MISSION_INFO,[t,GameText.getMoneyText(this.moneyType)+this.money])},e.prototype.getRandomMissionCount=function(){return"("+this.myCount+"/"+this.maxCount+")"},e.doNPCDialogueAction=function(t,n){t==e.Action_accept?e.doRandomMissionAccept(n,!1):t==e.Action_giveUp?e.doRandomMissionGiveUp(n):t==e.Action_refresh?e.doRandomMissionAccept(n,!0):t==e.Action_sumbit&&e.doRandomMissionSumbit()},e.STATUS_START_1=0,e.STATUS_START_2=1,e.STATUS_WAIT=2,e.STATUS_END_1=3,e.STATUS_END_2=4,e.TYPE_MONSTER=0,e.TYPE_ITEM=1,e.Action_accept=1,e.Action_giveUp=2,e.Action_refresh=3,e.Action_sumbit=4,e}(Mission);__reflect(RandomMission.prototype,"RandomMission"),function(t){function e(t,e,i){void 0===i&&(i=null);var a=o;return a?this.head=a.next:a=new n,a.reset(t,e,i),a}var n=function(){function t(){}return Object.defineProperty(t.prototype,"value",{get:function(){return this.elicitation+this.practice},enumerable:!0,configurable:!0}),t.prototype.reset=function(t,e,n){this.x=t,this.y=e,this.elicitation=0,this.practice=0,this.parent=n,this.next=null},t.prototype.reclaim=function(){!function(t){t.next=o,o=t}(this)},t}();t.Node=n,__reflect(n.prototype,"nato.Node");var i=function(){function t(){this.list=new Array}return t.prototype.pop=function(){var t=this.list;if(t.length<=0)return null;this.popHeap();var e=t.length,n=t[e-1];return t.length=e-1,n},t.prototype.push=function(t){var e=this.list;e.push(t),this.pushHeap(0,e.length-1,0,t)},t.prototype.clear=function(){for(var t=this.list;t.length>0;)t.pop().reclaim()},t.compare=function(t,e){return t.value>e.value},t.prototype.pushHeap=function(e,n,i,o){for(var a=this.list,r=n-1>>1;n>i&&t.compare(a[e+r],o);)a[e+n]=a[e+r],r=(n=r)-1>>1;a[e+n]=o},t.prototype.adjustHeap=function(e,n,i){for(var o=this.list,a=e,r=2*e+2;n>r;)t.compare(o[0+r],o[r-1+0])&&r--,o[0+e]=o[0+r],e=r,r=2*(r+1);r==n&&(o[0+e]=o[r-1+0],e=r-1),this.pushHeap(0,e,a,i)},t.prototype.popHeap=function(){var t=this.list,e=t.length,n=t[e-1];t[e-1]=t[0],this.adjustHeap(0,t.length,n)},t}();__reflect(i.prototype,"OpenTable");var o,a=function(){function t(){this.open=new i,this.mark=new Array(60);for(var t=this.mark,e=0;60>e;e++){t[e]=Array(60);for(var n=0;60>n;n++)t[e][n]=0}}return t.prototype.reset=function(){for(var t=this.mark,e=0;60>e;e++)for(var n=0;60>n;n++)t[e][n]=0},t.fetchCost=function(t,e,n,i){return 10*(Math.abs(n-t)+Math.abs(i-e))},t.prototype.Generate=function(n,i,o,a,r){for(var s,l,_=n,h=this.open,u=this.mark,c=t.directionOffset,T=_.x,p=_.y,d=0;8>d;++d)if(s=T+c[d][0],l=p+c[d][1],a.call(r,s,l)&&!(0<u[l][s])){(n=e(s,l,_)).practice=_.practice+c[d][2],n.elicitation=t.fetchCost(s,l,i,o),h.push(n),u[l][s]=1}},t.prototype.findPath=function(n,i,o,a,r,s){if(n==o&&i==a)return null;var l=this.mark,_=this.open,h=e(n,i);h.elicitation=t.fetchCost(n,i,o,a),l[i][n]=1;for(var u=h;(this.Generate(u,o,a,r,s),u=_.pop())&&(u.x!=o||u.y!=a););for(var c=new Array,T=u;null!=T;T=T.parent)c.push(T);return c.reverse(),this.clear(),c},t.prototype.clear=function(){this.open.clear();for(var t=this.mark,e=0;60>e;e++)for(var n=0;60>n;n++)t[e][n]=0},t.directionOffset=[[0,-1,10],[0,1,10],[-1,0,10],[1,0,10],[-1,-1,14],[1,-1,14],[-1,1,14],[1,1,14]],t}();__reflect(a.prototype,"AStar");var r=new a;t.findPath=function(t,e,n,i,o,a){return r.findPath(t,e,n,i,o,a)}}(nato||(nato={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i},o.open(RES.$getVirtualUrl(t.Resource.findPath(e.url))),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n}(RES.BinAnalyzer);t.BinAnalyzer=e,__reflect(e.prototype,"nato.BinAnalyzer");var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getLoaderex();this.resItemDic[o.$hashCode]={item:e,func:n,thisObject:i},o.load(RES.$getVirtualUrl(t.Resource.findPath(e.url)))}},n.prototype.getLoaderex=function(){var t=this.recycler.pop();return t||((t=new egret.ImageLoader).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t},n}(RES.ImageAnalyzer);t.ImageAnalyzer=n,__reflect(n.prototype,"nato.ImageAnalyzer");var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i},o.open(RES.$getVirtualUrl(t.Resource.findPath(e.url))),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n.prototype.analyzeConfig=function(n,i){var o=e.prototype.analyzeConfig.call(this,n,i);return t.Resource.findPath(o)},n}(RES.FontAnalyzer);t.FontAnalyzer=i,__reflect(i.prototype,"nato.FontAnalyzer");var o=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i};var a=e.url;a.indexOf(".json")>0&&(a=t.Resource.findPath(a)),o.open(RES.$getVirtualUrl(a)),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n}(RES.JsonAnalyzer);t.JsonAnalyzer=o,__reflect(o.prototype,"nato.JsonAnalyzer");var a=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.recyclerIamgeex=[],t}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i},o.open(RES.$getVirtualUrl(t.Resource.findPath(e.url))),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n.prototype.onLoadFinish=function(t){var e=t.target,n=this.resItemDic[e.$hashCode];delete this.resItemDic[e.hashCode];var i=n.item,o=n.func;if(i.loaded=t.type==egret.Event.COMPLETE,i.loaded)if(e instanceof egret.HttpRequest){i.loaded=!1;var a=this.analyzeConfig(i,e.response);if(a)return this.loadImageex(a,n),void this.recycler.push(e)}else{var r=new egret.Texture;r._setBitmapData(e.data),this.analyzeBitmap(i,r)}e instanceof egret.HttpRequest?this.recycler.push(e):this.recyclerIamgeex.push(e),o.call(n.thisObject,i)},n.prototype.loadImageex=function(e,n){var i=this.getImageLoaderex();this.resItemDic[i.hashCode]=n,i.load(RES.$getVirtualUrl(t.Resource.findPath(e)))},n.prototype.getImageLoaderex=function(){var t=this.recyclerIamgeex.pop();return t||((t=new egret.ImageLoader).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t},n}(RES.SheetAnalyzer);t.SheetAnalyzer=a,__reflect(a.prototype,"nato.SheetAnalyzer");var r=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.soundDic[e.name])n.call(i,e);else{var o=new egret.Sound;o.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),this.resItemDic[o.$hashCode]={item:e,func:n,thisObject:i},o.load(RES.$getVirtualUrl(t.Resource.findPath(e.url))),e.data&&(o.type=e.data.soundType)}},n}(RES.SoundAnalyzer);t.SoundAnalyzer=r,__reflect(r.prototype,"nato.SoundAnalyzer");var s=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i},o.open(RES.$getVirtualUrl(t.Resource.findPath(e.url))),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n}(RES.TextAnalyzer);t.TextAnalyzer=s,__reflect(s.prototype,"nato.TextAnalyzer");var l=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.loadFile=function(e,n,i){if(this.fileDic[e.name])n.call(i,e);else{var o=this.getRequestex();this.resItemDic[o.hashCode]={item:e,func:n,thisObject:i},o.open(RES.$getVirtualUrl(t.Resource.findPath(e.url))),o.send()}},n.prototype.getRequestex=function(){var t=this.recycler.pop();return t||((t=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},n}(RES.XMLAnalyzer);t.XMLAnalyzer=l,__reflect(l.prototype,"nato.XMLAnalyzer")}(nato||(nato={})),function(t){function e(e,n){var i=t.readUint8(e,n);n+=t.xffset;var o=null;if(i==p.Ani)o=new E;else if(i==p.Spr)o=new g;else if(i==p.Map)o=new I;else if(i==p.Icon)o=new m;else if(i==p.Sheet)o=new f;else{if(i!=p.Image)return void console.error("unsupported binary type: "+i);o=new A}return n=o.load(e,n),i==p.Image?y.instance.insertImage(o.name,o):y.instance.insert(i,o),n}function n(t){P.push(t)}function i(t,e,n){var i=(t<<8)+e,o=y.instance.find(p.Map,i);if(null==o)return console.error("can not find map item: "+t+" "+e),!1;var a=o.texture;if(null==a){if(o.apply(n),!o.loading){if(null==o.data){var r=y.instance.find(p.Map,t<<8);if(null==r)return console.error("can not find map item: "+t+" "+e),void n(null);o.data=r.data,o.dataPos=r.dataPos,o.dataLen=r.dataLen,o.applyColor()}o.parse()}}else n(a);return!0}function o(t,e){var n=y.instance.find(p.Ani,t);if(null==n)return console.error("can not find ani item: "+t),!1;var i=n.loading;if(2!=i){if(n.apply(e),0==i){if(null==n.data){for(var o=null,a=t;a-- >0&&!(o=y.instance.find(p.Ani,a)).orign;);if(null==o)return null;n.data=o.data,n.dataPos=o.dataPos,n.dataLen=o.dataLen,n.applyColor(),n.bind(o.sheet)}n.parse()}}else e();return!0}function a(t,e){var n=y.instance.findImage(t);if(null==n)return console.error("can not find image item: "+t),null;var i=n.texture;i?e(i):(n.loading||n.parse(),n.apply(e))}function r(t,e,n){void 0===n&&(n="png"),C++;var i=new Image;i.onload=function(){L++;var t=new egret.Texture,n=new egret.BitmapData(i);t._setBitmapData(n),e(t)},i.onerror=function(){M++,console.error("image on error"),e(null)},i.src="data:image/"+n+";base64,"+t}function s(t,e,n,i,o){void 0===o&&(o="png"),r(_(t,e,n),i,o)}function l(t,e,n,i,o,a,r,s,l){void 0===a&&(a=0),void 0===r&&(r=0);var _=new egret.Texture;_.$bitmapData=t.$bitmapData;var h=t.$bitmapX-t.$offsetX,u=t.$bitmapY-t.$offsetY;return _.$initData(h+e,u+n,i,o,a,r,s,l,t.$sourceWidth,t.$sourceHeight),_}function _(t,e,n){for(var i=h(t,e,n),o=[],a=65535,r=(n=i.length,0);n>r*a;r++)o.push(String.fromCharCode.apply(null,i.slice(r*a,(r+1)*a)));var s=o.join("");return btoa(s)}function h(e,n,i){for(var o,a="0123456789abcdef",r=new Array(i),s=0;i>s;s++)o=t.readUint8(e,n+s),r[s]="0x"+a.charAt(o>>>4&15)+a.charAt(15&o);return r}function u(t,e,n,i,o,a,r){for(var s=c(t,e,n,i,o,a,r),l=[],_=65535,h=(n=s.length,0);n>h*_;h++)l.push(String.fromCharCode.apply(null,s.slice(h*_,(h+1)*_)));var u=l.join("");return btoa(u)}function c(e,n,i,o,a,r,s){for(var l,_="0123456789abcdef",h=s+r,u=new Array(i),c=0;i>c;c++)l=s>c||c>=h?t.readUint8(e,n+c):t.readUint8(o,a+c-s),u[c]="0x"+_.charAt(l>>>4&15)+_.charAt(15&l);return u}function T(t){if(null!=t.color){var e=function(t,e,n){for(var i=0,o=n-8,a=v;o>a;){i=t.getInt32(e+a,!1);var r=t.getInt8(e+a+4),s=t.getInt8(e+a+5),l=t.getInt8(e+a+6),_=t.getInt8(e+a+7);if(r=="P".charCodeAt(0)&&s=="L".charCodeAt(0)&&l=="T".charCodeAt(0)&&_=="E".charCodeAt(0))return a;a+=12,a+=i}return-1}(t.data,t.dataPos,t.dataLen);return 0>e?(console.error("can not find palette: "+t.id),t.color=null,t.colorPos=null,void(t.colorLen=null)):void function(t,e){var n=e+8;t.dataOffset=n;var i=t.data.getInt32(t.dataPos+e,!1)+4;i>t.colorLen&&(console.error("applyPalette() Error: pl out of size!! length = "+i),i=t.colorLen),t.colorLen=i}(t,e)}}var p;!function(t){t[t.Map=1]="Map",t[t.Ani=2]="Ani",t[t.Spr=3]="Spr",t[t.Icon=4]="Icon",t[t.Sheet=5]="Sheet",t[t.Image=6]="Image",t[t.Count=6]="Count"}(p||(p={}));var d=function(){};t.SheetUnit=d,__reflect(d.prototype,"nato.SheetUnit");var E=function(){function e(){this._orign=!1,this._loading=0,this._arr=[]}return Object.defineProperty(e.prototype,"key",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orign",{get:function(){return this._orign},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheet",{get:function(){return this._sheet||this.loadSheet(),this._sheet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),e.prototype.apply=function(t){this._arr.push(t)},e.prototype.bind=function(t){this._sheet=t},e.prototype.applyColor=function(){T(this)},e.prototype.parse=function(){this._loading=1,this.color?function(t,e,n,i,o,a,r,s,l){void 0===l&&(l=null);var _=new Image;_.onload=function(){s.call(l,_)},_.onerror=function(){console.error("image on error"),s.call(l,null)},_.src="data:image/png;base64,"+u(t,e,n,i,o,a,r)}(this.data,this.dataPos,this.dataLen,this.color,this.colorPos,this.colorLen,this.dataOffset,this.onload,this):function(t,e,n,i,o){void 0===o&&(o=null);var a=new Image;a.onload=function(){i.call(o,a)},a.onerror=function(){console.error("image on error"),i.call(o,null)},a.src="data:image/png;base64,"+_(t,e,n)}(this.data,this.dataPos,this.dataLen,this.onload,this)},e.prototype.onload=function(t){if(null!=t){this._image=t,this._loading=2;for(var e=this._arr;e.length>0;)e.pop()();this._arr=null}else console.error("ani onload error: ",this._id)},e.prototype.get=function(t){var e=this.sheet;if(!e)return null;for(var n,i=0,o=e.length;o>i;i++)if((n=e[i]).id==t)return n;return null},e.prototype.load=function(e,n){this._id=t.readUint16(e,n),n+=t.xffset;var i=t.readUint8(e,n);if(n+=t.xffset,1&i){var o=t.readUint32(e,n);n+=t.xffset,this.data=e,this.dataPos=n,this.dataLen=o,n+=o,this._orign=!0}if(2&i){o=t.readUint16(e,n);n+=t.xffset,this.sheetPos=n,this.sheetLen=o,n+=o}if(4&i){o=t.readUint16(e,n);n+=t.xffset,this.color=e,this.colorPos=n,this.colorLen=o,n+=o}return n},e.prototype.loadSheet=function(){if(this.sheetPos){var e=this.data,n=this.sheetPos,i=t.readUint8(e,n);n+=t.xffset;for(var o=new Array(i),a=0;i>a;a++){var r=new d;r.id=t.readUint8(e,n),n+=t.xffset,r.x=t.readUint8(e,n),n+=t.xffset,r.y=t.readUint8(e,n),n+=t.xffset,r.w=t.readUint8(e,n),n+=t.xffset,r.h=t.readUint8(e,n),n+=t.xffset,r.offX=0,r.offY=0,r.sourceW=r.w,r.sourceH=r.h,o[a]=r}this._sheet=o}},e}();__reflect(E.prototype,"AniItem");var g=function(){function e(){}return Object.defineProperty(e.prototype,"key",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setup",{get:function(){return null==this._setup&&(this._setup=new t.SpriteSetup,this._setup.load(this._data,this._dataPos,this._dataLen),this._data=null),this._setup},enumerable:!0,configurable:!0}),e.prototype.load=function(e,n){this._data=e,this._id=t.readUint16(e,n),n+=t.xffset;var i=t.readUint16(e,n);return n+=t.xffset,this._dataPos=n,this._dataLen=i,n+i},e}();__reflect(g.prototype,"SprItem");var S=function(){function e(){}return Object.defineProperty(e.prototype,"key",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),e.prototype.parse=function(){var t=this;s(this._data,this._dataPos,this._dataLen,(function(e){t._texture=e}))},e.prototype.load=function(e,n){this._data=e,this._id=t.readUint16(e,n),n+=t.xffset;var i=t.readUint16(e,n);return n+=t.xffset,this._dataPos=n,this._dataLen=i,this.parse(),n+i},e}();__reflect(S.prototype,"TextureIcon");var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(S);__reflect(m.prototype,"IconItem");var f=function(){function e(){}return Object.defineProperty(e.prototype,"key",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.create=function(){var t=this;s(this._data,this._dataPos,this._dataLen,(function(e){t._texture=e;var n=t.sheet;if(n){for(var i={},o=0,a=n.length;a>o;o++){var r=n[o];i[r.id]=l(e,r.x,r.y,r.w,r.h,r.offX,r.offY,r.sourceW,r.sourceH)}t._map=i}}))},Object.defineProperty(e.prototype,"sheet",{get:function(){return this._sheet||this.loadSheet(),this._sheet},enumerable:!0,configurable:!0}),e.prototype.find=function(t){return this._map?this._map[t]:this._texture},e.prototype.load=function(e,n){this._data=e,this._id=t.readUint16(e,n),n+=t.xffset;var i=t.readUint8(e,n);if(n+=t.xffset,1&i){var o=t.readUint32(e,n);n+=t.xffset,this._dataPos=n,this._dataLen=o,n+=o}if(2&i){o=t.readUint16(e,n);n+=t.xffset,this._sheetPos=n,this._sheetLen=o,n+=o}return this.create(),n},e.prototype.loadSheet=function(){if(this._sheetPos){var e=this._data,n=this._sheetPos,i=t.readUint8(e,n);n+=t.xffset;for(var o=new Array(i),a=0;i>a;a++){var r=new d;r.id=t.readUint8(e,n),n+=t.xffset,r.x=t.readUint16(e,n),n+=t.xffset,r.y=t.readUint16(e,n),n+=t.xffset,r.w=t.readUint16(e,n),n+=t.xffset,r.h=t.readUint16(e,n),n+=t.xffset,r.offX=0,r.offY=0,r.sourceW=r.w,r.sourceH=r.h,o[a]=r}this._sheet=o}},e}();__reflect(f.prototype,"SheetItem");var I=function(){function e(){this._arr=[]}return Object.defineProperty(e.prototype,"key",{get:function(){return(this._id<<8)+this._pid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pid",{get:function(){return this._pid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),e.prototype.apply=function(t){this._arr.push(t)},e.prototype.applyColor=function(){T(this)},e.prototype.parse=function(){var t=this;this.color?function(t,e,n,i,o,a,s,l,_){void 0===_&&(_="png"),r(u(t,e,n,i,o,a,s),l,_)}(this.data,this.dataPos,this.dataLen,this.color,this.colorPos,this.colorLen,this.dataOffset,(function(e){t.bind(e)})):s(this.data,this.dataPos,this.dataLen,(function(e){t.bind(e)}))},e.prototype.bind=function(t){this._texture=t;for(var e=this._arr;e.length>0;)e.pop()(t)},e.prototype.load=function(e,n){this._id=t.readUint16(e,n),n+=t.xffset;var i=t.readUint8(e,n);n+=t.xffset,this._pid=128&i?127&i:i;var o=t.readUint32(e,n);return n+=t.xffset,0==i||128&i?(this.data=e,this.dataPos=n,this.dataLen=o):(this.color=e,this.colorPos=n,this.colorLen=o),n+o},e}();__reflect(I.prototype,"MapItem");var A=function(){function e(){this._loading=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.set=function(t,e){this._name=t,this._texture=e},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),e.prototype.parse=function(){var t=this;this._loading=!0,s(this._data,this._dataPos,this._dataLen,(function(e){t.bind(e),t.onload()}))},e.prototype.apply=function(t){null==this._arr&&(this._arr=[]),this._arr.push(t)},e.prototype.onload=function(){if(this._loading=!1,null!=this._arr){for(var t=this._arr;t.length>0;)t.pop()(this._texture);this._arr=null}},e.prototype.bind=function(t){this._texture=t,this._data=null},e.prototype.load=function(e,n){this._data=e,this._name=t.readUTF(e,n),n+=t.xffset;var i=t.readUint32(e,n);return n+=t.xffset,this._dataPos=n,this._dataLen=i,n+i},e}();__reflect(A.prototype,"ImageItem");var y=function(){function t(){this._arr=new Array(p.Count),this._map={}}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.insert=function(t,e){var n=this._arr;null==n[t]&&(n[t]=new R),n[t].insert(e)},t.prototype.find=function(t,e){var n=this._arr;return null==n[t]?null:n[t].find(e)},t.prototype.insertImage=function(t,e){this._map[t]=e},t.prototype.findImage=function(t){return this._map[t]},t._instance=new t,t}();__reflect(y.prototype,"BinaryCache");var R=function(){function t(){this._map={}}return t.prototype.insert=function(t){this._map[t.key]=t},t.prototype.find=function(t){return this._map[t]},t}();__reflect(R.prototype,"BinaryManager"),t.loadXinary=function(t){for(var n=0,i=t.byteLength,o=new DataView(t);i>n;)n=e(o,n)},t.loadBinayItem=e,t.findImageForMap=function(t,e){var n=(t<<8)+e,i=y.instance.find(p.Map,n);return null==i?(console.error("can not find map item: "+t+" "+e),null):i.texture};var P=[];t.continueFindBinary=function(){for(;P.length>0;)P.pop()()},t.findTextureForMap=function(t,e,o){i(t,e,o)||n((function(){i(t,e,o)}))},t.findTextureForMapX=i,t.findSheetForAni=function(t,e){void 0===e&&(e=0);var n=y.instance.find(p.Ani,t);if(null==n)return console.error("can not find ani item: "+t),null;var i=n.image,o=n.sheet;if(o)for(var a=0,r=o.length;r>a;a++){if((s=o[a]).id==e)return s}else if(i){var s;return(s=new d).x=0,s.y=0,s.w=i.width,s.h=i.height,s.offX=0,s.offY=0,s.sourceW=s.w,s.sourceH=s.h,s}return null},t.loadImageDataForAni=function(t,e){o(t,e)||n((function(){o(t,e)}))},t.loadImageDataForAniX=o,t.findImageDataForAni=function(t,e,n){var i=y.instance.find(p.Ani,t);return null==i?(console.error("can not find ani item: "+t),null):(n.image=i.image,void(n.sheet=i.get(e)))},t.findSpriteSetup=function(e){if(xlocal){var n=y.instance.find(p.Spr,e);return null==n?(console.error("can not find sprite setup: "+e),null):n.setup}return t.getSpriteSetup(e)},t.findTextureForIcon=function(e){return t.getIcon(e+"")},t.findTextureForSheet=function(e,n){return null==n?t.getIcon(e+""):t.getIcon(e+"_"+n)},t.findTextureForUi=function(t,e){a(t,e)},t.findTextureForImage=a,t.insertTextureForUi=function(t,e){var n=new A;n.set(t,e),y.instance.insertImage(t,n)};var C=0,M=0,L=0;t.resetBinaryCount=function(){C=0,M=0,L=0},t.totalBinaryCount=function(){return C},t.errorBinaryCount=function(){return M},t.loadedBinaryCount=function(){return L},t.createImageFromBinary=function(t,e,n){void 0===n&&(n="png"),function(t,e,n){void 0===n&&(n="png");var i=new Image;i.onload=function(){e(i)},i.onerror=function(){M++,console.error("image on error"),e(null)},i.src="data:image/"+n+";base64,"+t}(_(t,0,t.byteLength),e,n)},t.createTexture=l,t.hexToBase64=_;var v=8}(nato||(nato={})),function(t){var e=function(){function t(t){this.value=t}return t.prototype.get=function(){return this.value},Object.defineProperty(t.prototype,"x",{get:function(){return this.value.x},set:function(t){this.value.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.value.y},set:function(t){this.value.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.scaleX},set:function(t){this.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.scaleY},set:function(t){this.scaleY=t},enumerable:!0,configurable:!0}),t}();t.Item=e,__reflect(e.prototype,"nato.Item");var n=function(){function n(t){this.map={},this.sheet=t}return n.prototype.get=function(n){var i=this.sheet.getTexture(n),o=new egret.Bitmap(i);o.anchorOffsetX=.5*o.width,o.anchorOffsetY=.5*o.height,o.name=n;var a=new e(o);return t.attachSkin(e),a},n.prototype.apply=function(t){var e,n=this.map[t];return null==n||n.length<=0?(e=this.get(t),this.map[t]=[]):e=n.pop(),e},n.prototype.reclaim=function(t,e){this.map[t].push(e)},n}();t.Group=n,__reflect(n.prototype,"nato.Group");var i=function(){function t(){this.map={}}return t.prototype.register=function(t,e){this.map[t]=new n(e)},t.prototype.apply=function(t,e){var n=this.map[t];return null==n?null:n.apply(e)},t.prototype.reclaim=function(t,e,n){var i=this.map[t];return null==i?null:void i.reclaim(e,n)},t.instance=new t,t}();t.Cache=i,__reflect(i.prototype,"nato.Cache")}(nato||(nato={}));var nato,Cookies=function(){function t(){}return t.getItem=function(t){return t&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},t.setItem=function(t,e,n,i,o,a){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var r="";if(n)switch(n.constructor){case Number:r=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:r="; expires="+n;break;case Date:r="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+r+(o?"; domain="+o:"")+(i?"; path="+i:"")+(a?"; secure":""),!0},t.removeItem=function(e,n,i){return!!t.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(n?"; path="+n:""),!0)},t.hasItem=function(t){return!!t&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},Object.defineProperty(t,"keys",{get:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=t.length,n=0;e>n;n++)t[n]=decodeURIComponent(t[n]);return t},enumerable:!0,configurable:!0}),t}();__reflect(Cookies.prototype,"Cookies"),function(t){var e=function(){function t(){this.table=[],this.poly=3988292384}return t.prototype.makeTable=function(){var t,e,n;for(e=0;256>e;e+=1){for(t=e,n=0;8>n;n+=1)1&t?t=this.poly^t>>>1:t>>>=1;this.table[e]=t>>>0}},t.prototype.strToArr=function(t){return Array.prototype.map.call(t,(function(t){return t.charCodeAt(0)}))},t.prototype.crcDirect=function(t){var e,n,i,o,a=-1;for(e=0,i=t.length;i>e;e+=1){for(o=255&(a^t[e]),n=0;8>n;n+=1)1==(1&o)?o=o>>>1^this.poly:o>>>=1;a=a>>>8^o}return-1^a},t.prototype.crc32=function(t){var e=0,n=this.strToArr(t);e=-1;for(var i=0,o=n.length;o>i;i+=1)e=e>>>8^this.table[255&(e^n[i])];return(e^=-1)>>>0},t}();t.Crc=e,__reflect(e.prototype,"nato.Crc")}(nato||(nato={})),function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"width",{get:function(){return this.image?this.sheet?Utility.isRotate(this.transformType)?this.sheet.h:this.sheet.w:Utility.isRotate(this.transformType)?this.image.height:this.image.width:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.image?this.sheet?Utility.isRotate(this.transformType)?this.sheet.w:this.sheet.h:Utility.isRotate(this.transformType)?this.image.width:this.image.height:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.image&&this.sheet?this.sheet.x:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.image&&this.sheet?this.sheet.y:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"owidth",{get:function(){return this.image?this.sheet?this.sheet.w:this.image.width:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oheight",{get:function(){return this.image?this.sheet?this.sheet.h:this.image.height:0},enumerable:!0,configurable:!0}),t}();t.FrameUnit=e,__reflect(e.prototype,"nato.FrameUnit");var n=function(){function t(){this._arr=[]}return t.prototype.add=function(t,n,i,o,a){var r=new e;r.fragmentName=t,r.fragmentId=n,r.centerX=i,r.centerY=o,r.transformType=a,this._arr.push(r)},Object.defineProperty(t.prototype,"key",{get:function(){return this._key||(this._key=JSON.stringify(this._arr)),this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"array",{get:function(){return this._arr},enumerable:!0,configurable:!0}),t}();t.Xramer=n,__reflect(n.prototype,"nato.Xramer");var i=function(){function e(){this._arr=[],this._map={},this._load={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"countForDrawPerFrame",{set:function(t){e._count=t},enumerable:!0,configurable:!0}),e.prototype.init=function(n,i){void 0===i&&(i=2),n.xratio=.5*n.$bitmapWidth,n.yratio=1*n.$bitmapHeight,this._default=n,e._count=i,t.WorldTicker.instance.startTick(this.onloop,this)},Object.defineProperty(e.prototype,"default",{get:function(){return this._default},enumerable:!0,configurable:!0}),e.prototype.find=function(t){return this._map[t]},e.prototype.loading=function(t){for(var e=this._arr,n=0,i=e.length;i>n;n++)if(e[n].key==t)return!0;return!1},e.prototype.apply=function(e,n){var i=e.key,o=this.find(i);if(!o){var a=this._load[i];return a?void a.add(n):((a=new t.ImageMerger(e)).add(n),a.apply(),this._arr.push(a),void(this._load[i]=a))}n(o)},e.prototype.onloop=function(t){var n=e._count,i=this._arr;for(this._map,this._load;i.length>0&&n-- >0;)i.pop().finish(e.onFinish);return!1},e.onFinish=function(t,n){var i=e.instance._map,o=e.instance._load;i[t.key]=n,delete o[t.key]},e._instance=new e,e._count=2,e}();t.FrameCache=i,__reflect(i.prototype,"nato.FrameCache")}(nato||(nato={})),function(t){function e(e,n){return t.xffset=2,e.getUint16(n,i==egret.Endian.LITTLE_ENDIAN)}function n(t,e,n){return t>=e&&n>=t}var i=egret.Endian.BIG_ENDIAN;t.littleEndian=i==egret.Endian.LITTLE_ENDIAN,t.xffset=0,t.readInt8=function(e,n){return t.xffset=1,e.getInt8(n)},t.readUint8=function(e,n){return t.xffset=1,e.getUint8(n)},t.readInt16=function(e,n){return t.xffset=2,e.getInt16(n,i==egret.Endian.LITTLE_ENDIAN)},t.readUint16=e,t.readInt32=function(e,n){return t.xffset=4,e.getInt32(n,i==egret.Endian.LITTLE_ENDIAN)},t.readUint32=function(e,n){return t.xffset=4,e.getUint32(n,i==egret.Endian.LITTLE_ENDIAN)},t.readFloat32=function(e,n){return t.xffset=4,e.getFloat32(n,i==egret.Endian.LITTLE_ENDIAN)},t.readFloat64=function(e,n){return t.xffset=8,e.getFloat64(n,i==egret.Endian.LITTLE_ENDIAN)},t.readUTF=function(i,o){var a=e(i,o);return o+=t.xffset,a>0?function(e,i,o){var a=new Uint8Array(e.buffer,e.byteOffset+i,o);return t.xffset+=o,function(t){for(var e,i=!1,o=0,a="",r=0,s=0,l=0,_=0;t.length>o;){var h=t[o++];if(h==this.EOF_byte)e=0!=s?this.decoderError(i):this.EOF_code_point;else if(0==s)n(h,0,127)?e=h:(n(h,194,223)?(s=1,_=128,r=h-192):n(h,224,239)?(s=2,_=2048,r=h-224):n(h,240,244)?(s=3,_=65536,r=h-240):this.decoderError(i),r*=Math.pow(64,s),e=null);else if(n(h,128,191))if(l+=1,r+=(h-128)*Math.pow(64,s-l),l!==s)e=null;else{var u=r,c=_;r=0,s=0,l=0,_=0,e=n(u,c,1114111)&&!n(u,55296,57343)?u:this.decoderError(i,h)}else r=0,s=0,l=0,_=0,o--,e=this.decoderError(i,h);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a}(a)}(i,o,a):""},t.getPlatform=function(){return navigator.userAgent,/android/i.test(navigator.userAgent)?"android":/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?"ios":/Linux/i.test(navigator.userAgent)||/Linux/i.test(navigator.platform)?"linux":/Win32/i.test(navigator.platform)?"windows":void 0},t.getBrowser=function(){var t=navigator.userAgent.toLowerCase();if(null!=(e=/.*(qqbrowser)\/([\w.]+).*/.exec(t)))return"qqbrowser";if(null!=(e=/.*(micromessenger)\/([\w.]+).*/.exec(t)))return"wechat";if(null!=(e=/.*(qq)\/([\w.]+).*/.exec(t)))return"qq";if(null!=(e=/.*(ucbrowser)\/([\w.]+).*/.exec(t)))return"ucbrowser";if(null!=(e=/.*(chrome)\/([\w.]+).*/.exec(t)))return"chrome";var e=/.*(msie) ([\w.]+).*/.exec(t);return null!=e?"ie":null!=(e=/.*(firefox)\/([\w.]+).*/.exec(t))?"firefox":null!=(e=/(opera).+version\/([\w.]+)/.exec(t))?"opera":null!=(e=/.*(lbbrowser); rv:([\w.]+).*/.exec(t))?"lbbrowser":null!=(e=/.*version\/([\w.]+).*(safari).*/.exec(t))?"safari":"unknown"},t.getAlias=function(t){return"accid:"+t},t.getTags=function(t,e,n){var i="chan:"+t;return n.push(i),i="zone:"+e,n.push(i),n.join(";")}}(nato||(nato={})),function(t){var e=function(){function e(t){this._arr=[],this.xratio=0,this.yratio=0,this._x=t}return Object.defineProperty(e.prototype,"key",{get:function(){return this._x.key},enumerable:!0,configurable:!0}),e.prototype.add=function(t){this._arr.push(t)},e.prototype.apply=function(){var e=this._x.array;this._count=e.length;for(var n=0,i=e.length;i>n;n++){var o=e[n];t.findImageDataForAni(o.fragmentName,o.fragmentId,o)}},e.prototype.finish=function(t){var n=e._cvs,i=e._ctx;this._func=t;var o=this.getFrameWidth(),a=this.getFrameHeight();n.width=o,n.height=a;for(var r=this.xratio,s=this.yratio,l=this._x.array,_=0,h=l.length;h>_;_++)this.drawImage(i,l[_],r,s);var u=n.toDataURL();i.restore(),e.createTextrueFromDataURL(u,this.onFinish,this)},e.prototype.drawImage=function(t,e,n,i){if(e.image){var o=e.owidth,a=e.oheight,r=n+e.centerX,s=i+e.centerY;t.translate(r,s);var l=e.transformType;l==Utility.TRANS_NONE||(l==Utility.TRANS_MIRROR_ROT180?t.scale(1,-1):l==Utility.TRANS_MIRROR?t.scale(-1,1):l==Utility.TRANS_ROT180?t.rotate(180*Math.PI/180):l==Utility.TRANS_ROT90?t.rotate(90*Math.PI/180):l==Utility.TRANS_ROT270&&t.rotate(270*Math.PI/180)),t.drawImage(e.image,e.x,e.y,o,a,-(o>>1),-(a>>1),o,a),l==Utility.TRANS_NONE||(l==Utility.TRANS_MIRROR_ROT180?t.scale(1,-1):l==Utility.TRANS_MIRROR?t.scale(-1,1):l==Utility.TRANS_ROT180?t.rotate(180*-Math.PI/180):l==Utility.TRANS_ROT90?t.rotate(90*-Math.PI/180):l==Utility.TRANS_ROT270&&t.rotate(270*-Math.PI/180)),t.translate(-r,-s)}},e.prototype.onFinish=function(t){t.xratio=this.xratio,t.yratio=this.yratio,this._func(this,t);for(var e=this._arr;e.length>0;)e.pop()(t);this._arr=null},e.prototype.getFrameWidth=function(){for(var t=this._x.array,e=0,n=0,i=0,o=t.length;o>i;i++){var a=t[i];if(-1!=a.fragmentName){var r=a.width/2;e=Math.min(a.centerX-r,e),n=Math.max(a.centerX+r,n)}}var s=Math.ceil(Math.abs(e-n));return this.xratio=Math.abs(e),s},e.prototype.getFrameHeight=function(){for(var t=this._x.array,e=0,n=0,i=0,o=t.length;o>i;i++){var a=t[i],r=a.height/2;e=Math.min(e,a.centerY-r),n=Math.max(n,a.centerY+r)}var s=Math.ceil(Math.abs(e-n));return this.yratio=Math.abs(e),s},e.createTextrueFromDataURL=function(t,e,n){void 0===n&&(n=null);var i=new Image;i.onload=function(){var t=new egret.Texture,o=new egret.BitmapData(i);t._setBitmapData(o),e.call(n,t)},i.onerror=function(){alert("image on error")},i.src=t},e._cvs=document.createElement("canvas"),e._ctx=e._cvs.getContext("2d"),e}();t.ImageMerger=e,__reflect(e.prototype,"nato.ImageMerger")}(nato||(nato={})),function(t){t.next=function(t){return t._next};var e=function(){function t(){this._headNode={},this._tailNode={};var t=this._headNode,e=this._tailNode;t._prev=null,t._next=e,e._prev=t,e._next=null,this._head=t,this._tail=e}return t.prototype.push=function(t){var e=t._prev,n=t._next;null==e&&null==n&&((e=this._tail._prev)._next=t,t._prev=e,t._next=this._tail,this._tail._prev=t)},t.prototype.remove=function(t){var e=t._prev,n=t._next;null!=e&&null!=n&&(e._next=n,n._prev=e,t._prev=null,t._next=null)},t.prototype.front=function(){return this._head._next},t.prototype.end=function(){return this._tail},t.prototype.loop=function(t,e){for(var n=this._tail,i=this._head;i!=n;i=i._next)t.call(e,i)},t.prototype.print=function(){console.log("================ print link list ======================");for(var t=this._tail,e=this._head;e!=t;e=e._next)console.log(e)},t}();t.LinkList=e,__reflect(e.prototype,"nato.LinkList")}(nato||(nato={})),function(t){var e=function(){function t(t,e){this.sign=1,this.h=t,this.l=e,0!=(2147483648&this.h)&&(this.h=4294967295-this.h,this.l=4294967296-this.l,this.sign=-1)}return Object.defineProperty(t.prototype,"string",{get:function(){return(1==this.sign?"":"-")+this.h.toString()+"-"+this.l.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.sign*(4294967296*this.h+this.l)},enumerable:!0,configurable:!0}),t}();t.long=e,__reflect(e.prototype,"nato.long"),t.tolong=function(t){var n=t.split("-"),i=parseInt(n[0]),o=parseInt(n[1]);return new e(i,o)};var n=function(){function t(t,e){this._size=e,this._data=t}return Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t}();t.Bytes=n,__reflect(n.prototype,"nato.Bytes");var i=function(){function i(t,e,n){this.type=0,this.init(t,e,n)}return i.prototype.init=function(t,e,n){this.type=t,this.data=e,null==this.data&&(this.data=new egret.ByteArray),0==n&&(this.data.position=0)},i.prototype.recycle=function(){t.Network.recycleMessage(this)},i.prototype.dataView=function(){return this.data.dataView},i.prototype.getData=function(){return this.data},i.prototype.reposition=function(){this.data.position=0},Object.defineProperty(i.prototype,"position",{get:function(){return this.data.position},set:function(t){this.data.position=t},enumerable:!0,configurable:!0}),i.prototype.putBoolean=function(t){this.data.writeBoolean(t)},i.prototype.getBoolean=function(){return this.data.readBoolean()},i.prototype.putByte=function(t){this.data.writeByte(t)},i.prototype.getByte=function(){return this.data.readByte()},i.prototype.getUnsignedByte=function(){return this.data.readUnsignedByte()},i.prototype.putBytes=function(t){if(null!=t){this.putLength(t.length),t.position=0;for(var e=0,n=t.length;n>e;e++)this.putByte(t.readByte())}else this.putShort(0)},i.prototype.getBytes=function(){for(var t=new egret.ByteArray,e=this.getLength(),n=0;e>n;n++)t.writeByte(this.getByte());return t.position=0,t},i.prototype.getXytes=function(){var t=this.getLength();return new n(this.data,t)},i.prototype.putLength=function(t){var e=t>>>8&255,n=255&t;this.data.writeByte(e),this.data.writeByte(n)},i.prototype.getLength=function(){return((255&this.data.readByte())<<8)+(255&this.data.readByte())},i.prototype.putShort=function(t){this.data.writeShort(t)},i.prototype.getShort=function(){return this.data.readShort()},i.prototype.getUnsignedShort=function(){return this.data.readUnsignedShort()},i.prototype.putInt=function(t){this.data.writeInt(t)},i.prototype.getInt=function(){return this.data.readInt()},i.prototype.getUnsignedInt=function(){return this.data.readUnsignedInt()},i.prototype.putLong=function(t){this.putInt(t.h),this.putInt(t.l)},i.prototype.getLong=function(){var t=this.getInt()>>>0,n=this.getInt()>>>0;return new e(t,n)},i.prototype.putLongInt=function(t){var e=t/4294967296>>>0,n=t%4294967296>>>0;this.putInt(e),this.putInt(n)},i.prototype.getLongInt=function(){return 4294967296*(this.getInt()>>>0)+(this.getInt()>>>0)},i.prototype.putFloat=function(t){},i.prototype.putString=function(t){null==t&&(t=""),this.data.writeUTF(t)},i.prototype.getString=function(){return this.data.readUTF()},i.prototype.getType=function(){return this.type},i.prototype.setType=function(t){this.type=t},i.prototype.getDataBytes=function(){var t=this.data.length+4,e=new egret.ByteArray;return t>65535||this.type>65535?null:(e.writeShort(t),e.writeShort(this.type),e.writeBytes(this.data),e)},i}();t.Message=i,__reflect(i.prototype,"nato.Message")}(nato||(nato={})),function(t){var e=function(){function t(){this._forceReconnect=!1}return t.prototype.create=function(t,e,n,i,o){void 0===o&&(o=!1),this._forceReconnect=o,this.closeFunc=n,this.connectFunc=e,this.receiveFunc=t,this.funcObj=i,this.cmd=new egret.ByteArray,this.buffer=new egret.ByteArray;var a=new egret.WebSocket;this.socket=a,a.type=egret.WebSocket.TYPE_BINARY,a.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceive,this),a.addEventListener(egret.Event.CONNECT,this.onConnected,this),a.addEventListener(egret.Event.CLOSE,this.onClose,this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this)},t.prototype.connect=function(t){this.socket.connectByUrl(t)},Object.defineProperty(t.prototype,"connected",{get:function(){return null!=this.socket&&this.socket.connected},enumerable:!0,configurable:!0}),t.prototype.send=function(t){return!!this.connected&&(t.position=0,this.socket.writeBytes(t),!0)},t.prototype.onConnected=function(){this.connectFunc&&this.connectFunc.call(this.funcObj)},t.prototype.close=function(t){void 0===t&&(t=!1),t&&(this.closeFunc=null),this.socket&&this.socket.connected&&this.socket.close()},t.prototype.onClose=function(){this.closeFunc&&this.closeFunc.call(this.funcObj)},t.prototype.onError=function(){this.closeFunc&&this.closeFunc()},t.prototype.onReceive=function(t){var e=this.buffer;this.socket.readBytes(e,e.length);for(var n=(this.cmd,this.receiveFunc),i=0,o=0;i=e.position,!(4>(o=e.bytesAvailable));){if(e.readShort()>o){e.position=i;break}var a=e.readShort();n&&n(a,e,o-4),e.position+=o-4}e.bytesAvailable<=0&&e.clear()},t}();t.Socket=e,__reflect(e.prototype,"nato.Socket"),__reflect(function(){}.prototype,"CmdCallback");var n=function(){};__reflect(n.prototype,"Callback");var i=function(){function i(){}return i.connect=function(t,n,o,a,r){void 0===r&&(r=!1),i.url=t,i.closeFunc=o,i.connectFunc=n,i.funcObj=a;var s=i.socket;s&&s.close(!0),s=new e,i.socket=s,s.create(i.onMessage,i.onConnect,i.onClose,a,r),i.timer=new egret.Timer(2e4),i.timer.addEventListener(egret.TimerEvent.TIMER,i.onTimer,null),i.timer.start(),i.connecting=!0,s.connect(t)},i.closeSocket=function(){i.connected&&i.socket.close()},i.onTimer=function(t){var e=PanelManager.getPanel(LoginPanel);e&&e.stage&&e.updateTips("服务器连接失败！"),alert("服务器连接失败！")},i.sendCmd=function(t,e,o,a){if(void 0===e&&(e=null),void 0===o&&(o=null),i.connecting)return i.list.push(t),!1;if(!i.send(t.getDataBytes()))return i.list.push(t),console.warn("send msg failed!"),!1;if(null!=e&&null!=o){var r=new n;r.type=t.getType(),r.obj=o,r.func=e,r.params=a,r.isPush=!1,i.addProtocolCallback(r.type,r)}return!0},i.addMsgHandler=function(t,e,o){var a=new n;a.type=t,a.obj=o,a.func=e,a.isPush=!0,i.addProtocolCallback(t,a)},i.removeMsgHandler=function(t,e,n){var o=i.callbacks[t];if(null!=o)for(var a=o.length,r=0;a>r;r++){var s=o[r];if(s.func==e&&s.obj==n){o.splice(r,1);break}}},i.addProtocolCallback=function(t,e){var n=i.callbacks[t];if(null==n)i.callbacks[t]=[e];else{var o=!1;n.map((function(t,n,i){t.func==e.func&&t.obj==e.obj&&(o=!0)}),this),0==o&&i.callbacks[t].push(e)}},i.send=function(t){return this.socket.send(t)},i.onClose=function(){i.timer.stop(),i.connecting=!1,i.closeFunc&&i.closeFunc.call(i.funcObj)},i.onConnect=function(){i.timer.stop(),i.connecting=!1;for(var t=i.list;t.length>0;){var e=t[0];if(!i.send(e.getDataBytes()))break;t.pop()}i.connectFunc&&(i.connectFunc.call(i.funcObj),i.connectFunc=null)},Object.defineProperty(i,"connected",{get:function(){return i.socket&&i.socket.connected},enumerable:!0,configurable:!0}),i.onMessage=function(t,e,n){var o=i.callbacks[t];if(null!=o)for(var a=o.length,r=0;a>r;){var s=o[r],l=i.getMessage(t,e,n);s.func&&s.func.call(s.obj,l,s.params),l.recycle(),s.isPush?r+=1:(o.splice(r,1),a-=1)}},i.recycleMessage=function(t){i.msgPool.push(t)},i.getMessage=function(e,n,o){var a;return i.msgPool.length>0?((a=i.msgPool.pop()).init(e,n,o),a):a=new t.Message(e,n,o)},i.connecting=!1,i.list=[],i.callbacks={},i.msgPool=[],i}();t.Network=i,__reflect(i.prototype,"nato.Network")}(nato||(nato={})),function(t){var e=function(){};__reflect(e.prototype,"Callback");var n=function(){};__reflect(n.prototype,"ResItem");var i=function(){};__reflect(i.prototype,"ResGroup");var o=function(){function t(){}return t.prototype.destroy=function(){(this.type==RES.ResourceItem.TYPE_IMAGE||this.type==RES.ResourceItem.TYPE_SHEET||this.type==RES.ResourceItem.TYPE_FONT)&&this.data.dispose()},t}();t.Res=o,__reflect(o.prototype,"nato.Res");var a=function(){function a(){}return a.init=function(e){a.path=e,a.count=0,a.total=0,a.crc=new t.Crc,a.crc.makeTable()},a.localPath=function(t){return null==a.setup?a.path+"/"+t:t},a.reset=function(t,e){a.total=0,a.count=0,a.func=t,a.obj=e,a.counting=null==t?null:{}},a.loadedCount=function(){return a.count},a.totalCount=function(){return a.total},a.finish=function(){return a.count==a.total},a.progress=function(t){a._progress=t},a.onDownloadItem=function(t){if(null!=a.counting){var e=a.counting[t];if(null!=e&&(0>=--e?delete a.counting[t]:a.counting[t]=e,a.count++,a._progress&&a._progress.call(a.obj,a.count,a.total),a.total<=a.count)){if(a._progress&&(a._progress=null),!a.loadingNull())return;null!=a.func&&a.func.call(a.obj)}}},a.loadingNull=function(){for(var t in a.loading)return!1;return!0},a.getRes=function(t){var e=a.loaded[t];return e?e.data:null},a.destroyRes=function(t){var e=a.loaded[t];e&&(e.destroy(),delete a.loaded[t])},a.onResourceLoadError=function(t){console.warn("File:"+t.resItem.name+" has failed to load")},a.getResByUrl=function(t,n,i,r,s){if(a.counting){a.total++;var l=a.counting[t];a.counting[t]=l?l+1:1}var _=a.loaded[t];if(_)return n.call(i,_.data,t),void a.onDownloadItem(t);var h=new e;return h.obj=i,h.func=n,(_=a.loading[t])?void _.funcs.push(h):((_=new o).name=t,_.type=s,_.group=r,_.funcs=new Array,_.funcs.push(h),a.loading[t]=_,void RES.getResByUrl(a.localPath(t),(function(e){_.data=e,a.loaded[t]=_,delete a.loading[t];for(var n,i=_.funcs;i.length>0;)(n=i.pop()).func&&n.func.call(n.obj,e,_.name),a.onDownloadItem(t);_.funcs=null}),null,s))},a.getTypeByUrl=function(t){var e,n=t.substr(t.lastIndexOf(".")+1);switch(n&&(n=n.toLowerCase()),n){case RES.ResourceItem.TYPE_XML:case RES.ResourceItem.TYPE_JSON:case RES.ResourceItem.TYPE_SHEET:e=n;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":e=RES.ResourceItem.TYPE_IMAGE;break;case"fnt":e=RES.ResourceItem.TYPE_FONT;break;case"txt":e=RES.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":e=RES.ResourceItem.TYPE_SOUND;break;default:e=RES.ResourceItem.TYPE_BIN}return e},a.getSetup=function(){return a.setup},a.setSetup=function(t){a.setup=t},a.setIndex=function(t){a.index=t},a.crc32=function(t){return a.crc.crc32(t)},a.findPath=function(t){var e=a.crc32(t),n=a.index;if(n.a.length<=0)return"";for(var i=0,o=n.a.length-1,r=-1;o>=i;){var s=Math.floor((i+o)/2),l=n.a[s].c;if(l==e){r=s;break}l>e?o=s-1:i=s+1}return 0>r?"":n.a[r].n},a.resetGroup=function(t,e){var n=new i;n.obj=e,n.func=t,a.groups.push(n)},a.destroyGroup=function(t){var e=[];for(var n in a.loaded){(r=n).group==t&&e.push(r)}for(var i=0,o=e.length;o>i;i++){var r;(r=e[i]).destroy(),delete a.loaded[r.name]}},a.pushGroup=function(t,e){var i=a.groups.length;if(!(0>=i)){var o=a.groups[i-1];if(null!=o){var r=new n;r.name=t,r.type=e,o.list.push(r)}}},a.loadGroup=function(t,e,o,r){var s=new i;s.obj=o,s.func=e,s.name=r,s.list=[];for(var l=0;l<t.length;l++){var _=new n;_.name=t[l],_.type=a.getTypeByUrl(t[l]),s.list.push(_)}a.groupDict[r]=s,a.groupLoaded[r]=0,a.groupTotal[r]=t.length,RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a.onResourceLoadError,this),a.loadNext(r)},a.loadNext=function(t){var e=a.groupLoaded[t],n=a.groupDict[t].list[e],i=n.name,o=n.type;RES.getResByUrl(a.localPath(i),a.oneComplete(t,i,o),null,o)},a.oneComplete=function(t,e,n){return function(i){var r=new o;r.type=n,r.name=e,r.group=t,r.data=i,a.groupLoaded[t]+=1,a.loaded[e]=r;var s=a.groupDict[t];return a._progress&&a._progress.call(s.obj,a.groupLoaded[t],a.groupTotal[t]),a.groupLoaded[t]==a.groupTotal[t]?(null!=s.func&&s.func.call(s.obj),a._progress&&(a._progress=null),void RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a.onResourceLoadError,this)):void a.loadNext(t)}},a.loaded={},a.loading={},a.counting=null,a.groups=[],a.groupDict={},a.groupLoaded={},a.groupTotal={},a}();t.Resource=a,__reflect(a.prototype,"nato.Resource"),t.crc32=function(t){return a.crc32(t)},t.persistentPath=function(t){a.init(t)},t.resetLoad=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),a.reset(t,e)},t.resetGroup=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),a.resetGroup(t,e)},t.loadedCount=function(){return a.loadedCount()},t.totalCount=function(){return a.totalCount()},t.finishLoaded=function(){return a.finish()},t.loadIndex=function(t,e,n){a.setSetup(t),null==t?e.call(n):RES.getResByUrl(t.version.index,(function(t){a.setIndex(t),e.call(n)}),null,RES.ResourceItem.TYPE_JSON)},t.getRes=function(t){return a.getRes(t)},t.destroyRes=function(t){a.destroyRes(t)},t.destroyGroup=function(t){void 0===t&&(t=""),a.destroyGroup(name)},t.loadGroup=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.loadGroup(t,e,n,i)},t.loadText=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_TEXT)},t.loadImage=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_IMAGE)},t.loadJson=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_JSON)},t.loadSheet=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_SHEET)},t.loadBinary=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_BIN)},t.loadXml=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_XML)},t.loadFont=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_FONT)},t.loadSound=function(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=""),a.getResByUrl(t,e,n,i,RES.ResourceItem.TYPE_SOUND)},t.attach=function(e,n,i,o,a){t.Updater.instance.attach(e,n,i,o,a)},t.inject=function(){RES.registerAnalyzer(RES.ResourceItem.TYPE_BIN,t.BinAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_IMAGE,t.ImageAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_TEXT,t.TextAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_JSON,t.JsonAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_SHEET,t.SheetAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_FONT,t.FontAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_SOUND,t.SoundAnalyzer),RES.registerAnalyzer(RES.ResourceItem.TYPE_XML,t.XMLAnalyzer)}}(nato||(nato={})),function(t){function e(){var e=t.stageWidth/t.MAP_VIEWPORT_WIDTH,n=t.stageHeight/t.MAP_VIEWPORT_HEIGHT,i=Math.min(e,n);t.mapRatio=i,t.mapScreenWidth=t.stageWidth/t.mapRatio,t.mapScreenHeight=t.stageHeight/t.mapRatio}var n;t.standardWidth=640,t.standardHeight=960,t.stageWidth=640,t.stageHeight=960,t.MAP_VIEWPORT_WIDTH=320,t.MAP_VIEWPORT_HEIGHT=480,t.standardRatio=t.standardWidth/t.standardHeight,t.uiNarrowRatio=1,t.uiEnlargeRatio=1,t.uiRatio=1,t.mapRatio=1,t.mapScreenWidth=0,t.mapScreenHeight=0,t.initialize=function(n,i,o){t.stageWidth=n,t.stageHeight=i,t.standardWidth=o?640:320,t.standardHeight=o?960:480;var a=t.stageWidth/t.standardWidth,r=t.stageHeight/t.standardHeight;t.uiNarrowRatio=Math.min(a,r),t.uiEnlargeRatio=Math.max(a,r),t.uiRatio=t.uiNarrowRatio,e(),BattleView.initializResolution()},t.initMapViewScale=e,t.adaptWithStage=function(e,n){e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.scaleX=t.uiEnlargeRatio,e.scaleY=t.uiEnlargeRatio,e.x=.5*t.stageWidth,e.y=.5*t.stageHeight,n.anchorOffsetX=.5*n.width,n.anchorOffsetY=.5*n.height,n.scaleX=t.uiNarrowRatio,n.scaleY=t.uiNarrowRatio,n.x=.5*t.stageWidth,n.y=.5*t.stageHeight},t.fitUI=function(e){e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.scaleX=t.uiNarrowRatio,e.scaleY=t.uiNarrowRatio,e.x=.5*t.stageWidth,e.y=.5*t.stageHeight},t.fitBG=function(e){e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.scaleX=t.uiEnlargeRatio,e.scaleY=t.uiEnlargeRatio,e.x=.5*t.stageWidth,e.y=.5*t.stageHeight},t.getUid=function(){return n||(DCAgent.init({appId:"xxxx",channel:"24"}),n=DCAgent.getUid())}}(nato||(nato={})),function(t){var e=function(){this.id=-1,this.checkid=-1};t.XnimationSetup=e,__reflect(e.prototype,"nato.XnimationSetup");var n=function(){function n(t){this.pos=t}return n.prototype.load=function(n){if(!this.files){var i=this.pos;this.count=t.readUint8(n,i),i+=t.xffset;var o=t.readUint8(n,i);i+=t.xffset;for(var a=new Array(o),r=0;o>r;r++)a[r]=t.readInt16(n,i),i+=t.xffset;this.files=a,o=t.readUint8(n,i),i+=t.xffset;var s,l,_=new Array(o);for(r=0;o>r;r++){(s=new e).id=t.readUint8(n,i),i+=t.xffset,s.checkid=t.readUint8(n,i),i+=t.xffset,_[r]=s,l=t.readUint8(n,i),i+=t.xffset,s.frames=new Array(l);for(var h,u=0;l>u;u++)(h=new t.AnimationFrame).id=t.readUint8(n,i),i+=t.xffset,h.xSpeed=t.readUint8(n,i)/50,i+=t.xffset,h.ySpeed=t.readUint8(n,i)/50,i+=t.xffset,h.duration=50*t.readUint8(n,i),i+=t.xffset,s.frames[u]=h}this.animations=_}},n}();t.XpriteSetup=n,__reflect(n.prototype,"nato.XpriteSetup");var i=function(){};t.Anchor=i,__reflect(i.prototype,"nato.Anchor");var o=function(){function e(){this.basic={},this.anchor={}}return e.prototype.setSpriteData=function(t){this.sprdata=new DataView(t)},e.prototype.loadSprite=function(){this.spr={};var e=0,i=this.sprdata,o=t.readUint16(i,e);e+=t.xffset;for(var a,r,s,l=this.spr,_=0;o>_;_++)r=t.readUint16(i,e),e+=t.xffset,a=t.readUint32(i,e),e+=t.xffset,s=new n(a),l[r]=s},e.prototype.getSpriteSetup=function(t){null==this.spr&&this.loadSprite();var e=this.spr[t];return e&&e.load(this.sprdata),e},e.prototype.loadBasic=function(){if(this.basicdata){this.basicpos={};var e=0,n=this.basicdata,i=t.readUint16(n,e);e+=t.xffset;for(var o,a,r=2+4*i,s=this.basicpos,l=0;i>l;l++)a=t.readUint16(n,e),e+=t.xffset,o=t.readUint16(n,e),e+=t.xffset,s[a]=r,r+=o}},e.prototype.setBasicData=function(t){null!=t&&(this.basicdata=new DataView(t))},e.prototype.loadAnchor=function(){if(this.anchordata){this.anchorpos={};var e=0,n=this.anchordata,i=t.readUint32(n,e);e+=t.xffset;for(var o,a,r=4+5*i,s=this.anchorpos,l=0;i>l;l++)a=t.readUint32(n,e),e+=t.xffset,o=t.readUint8(n,e),e+=t.xffset,s[a]=r,r+=o}},e.prototype.setAnchorData=function(t){this.anchordata=new DataView(t)},e.prototype.addAnchor=function(e,n){for(var o,a,r=n.length,s=new Array(r),l=0;r>l;l++)a=n[l],o=new i,0==a.x&&0==a.y?(o.x=-1,o.y=-1):(o.x=a.x,o.y=a.y),o.cx=a.cx,o.cy=a.cy,s[l]=o;if(e.indexOf("_")<0){var _=parseInt(e);this.basic[_]=s}else{_=t.crc32(e);this.anchor[_]=s}return s},e.prototype.findBasic=function(t){var e=this.basic[t];if(e)return e;if(this.basicpos||this.loadBasic(),!this.basicpos)return null;var n=this.basicpos[t];return n?(e=this.loadAnchors(this.basicdata,n),this.basic[t]=e,e):null},e.prototype.findAnchor=function(t){var e=this.anchor[t];if(e)return e;if(this.anchorpos||this.loadAnchor(),!this.anchorpos)return null;var n=this.anchorpos[t];return n?(this.anchordata,e=this.loadAnchors(this.anchordata,n),this.anchor[t]=e,e):null},e.prototype.loadAnchors=function(e,n){var o=t.readUint8(e,n);n+=t.xffset;for(var a,r,s,l=new Array(o),_=0;o>_;_++)a=new i,r=t.readUint8(e,n),n+=t.xffset,s=t.readUint8(e,n),n+=t.xffset,0==r&&0==s?(a.x=-1,a.y=-1):(a.x=r,a.y=s),a.cx=t.readInt8(e,n),n+=t.xffset,a.cy=t.readInt8(e,n),n+=t.xffset,l[_]=a;return l},e.prototype.getAnchor=function(e){return e.indexOf("_")<0?this.findBasic(parseInt(e)):this.findAnchor(t.crc32(e))},e}();t.SpriteParts=o,__reflect(o.prototype,"nato.SpriteParts");var a=new o;t.loadSprite=function(t){a.setSpriteData(t)},t.getSpriteSetup=function(t){return a.getSpriteSetup(t)},t.loadBasicData=function(t){a.setBasicData(t)},t.loadAnchorData=function(t){a.setAnchorData(t)},t.getAnchor=function(t){return a.getAnchor(t)},t.addAnchor=function(t,e){return a.addAnchor(t,e)}}(nato||(nato={})),function(t){var e=function(){};t.AnimationFrame=e,__reflect(e.prototype,"nato.AnimationFrame");var n=function(){function n(){this.animationID=-1,this.checkID=-1}return n.prototype.load=function(i,o,a){var r=t.readUint8(i,o);o+=t.xffset;var s=t.readInt8(i,o);o+=t.xffset,this.animationID=t.readInt8(i,o),o+=t.xffset,this.checkID=t.readInt8(i,o),o+=t.xffset;for(var l=new Array(r),_=new Array(r),h=0;r>h;h++){var u=new e;u.id=t.readInt8(i,o),o+=t.xffset,u.duration=50*t.readInt8(i,o),o+=t.xffset,s==n.MOVING&&(u.xSpeed=t.readInt8(i,o)/50,o+=t.xffset,u.ySpeed=t.readInt8(i,o)/50,o+=t.xffset),_[h]=u,l[h]=u.id}return this.frames=_,this.frameIds=l,o},n.MOVING=16,n.NOT_MOVING=4,n}();t.AnimationSetup=n,__reflect(n.prototype,"nato.AnimationSetup");var i=function(){};t.FrameItem=i,__reflect(i.prototype,"nato.FrameItem");var o=function(){function e(){}return e.prototype.load=function(e,n,o){var a=t.readUint8(e,n);if(n+=t.xffset,0>=a)return n;for(var r=new Array(a),s=0;a>s;s++){var l=new i;l.fragmentFileId=t.readInt8(e,n),n+=t.xffset,l.fragmentId=t.readInt8(e,n),n+=t.xffset,l.centerX=t.readInt8(e,n),n+=t.xffset,l.centerY=t.readInt8(e,n),n+=t.xffset,l.transformType=Utility.getTranslate(t.readInt8(e,n)),n+=t.xffset,r[s]=l}return this.array=r,n},e}();t.FrameSetup=o,__reflect(o.prototype,"nato.FrameSetup");var a=function(){function e(){}return e.prototype.load=function(t,e,n){e=this.loadFragmentFile(t,e,n),e=this.loadFrame(t,e,n),e=this.loadAnimation(t,e,n)},e.prototype.loadFragmentFile=function(e,n,i){var o=e.getUint8(n++);if(0>=o)return n;for(var a=new Array(o),r=new Array(o),s=0;o>s;s++)a[s]=t.readInt8(e,n),n+=t.xffset,r[s]=t.readInt16(e,n),n+=t.xffset;return this.fragmentIds=a,this.fragmentFiles=r,n},e.prototype.loadFrame=function(e,n,i){var a=t.readUint8(e,n);if(n+=t.xffset,0>=a)return n;for(var r=new Array(a),s=0;a>s;s++){var l=new o;n=l.load(e,n,i),r[s]=l}return this.frames=r,n},e.prototype.loadAnimation=function(e,i,o){var a=t.readUint8(e,i);if(i+=t.xffset,0>=a)return i;for(var r=new Array(a),s=0;a>s;s++){var l=new n;i=l.load(e,i,o),r[s]=l}return this.animations=r,i},e}();t.SpriteSetup=a,__reflect(a.prototype,"nato.SpriteSetup")}(nato||(nato={})),function(t){t.xexmls=null;var e=function(){};__reflect(e.prototype,"XSkin");var n=function(){function t(){this._map={}}return t.prototype.find=function(t){var e=this._map[t];return e?(e.clazz||(e.clazz=EXML.parse(e.data),e.data=null),e.clazz):null},t.prototype.add=function(t,n){var i=new e;i.data=n,this._map[t]=i},t}();__reflect(n.prototype,"XTheme");var i,o=function(){function e(t){this._local=!0,this._count=0,this._local=t,this._sd=new n,this._hd=new n}return e.prototype.find=function(t,e){return e?this._hd.find(t):this._sd.find(t)},e.prototype.add=function(t,e){var n=t.indexOf("/hd/"),i=n>=0;n=t.lastIndexOf("/");var o=t.substring(n+1);n=o.indexOf("Skin.exml"),o=o.substring(0,n),i?this._hd.add(o,e):this._sd.add(o,e)},e.prototype.load=function(e,n,i){this._obj=i,this._func=n,t.loadJson(e,this.onloadJson,this,"theme")},e.prototype.loadExmls=function(t,e,n){this._obj=n,this._func=e;for(var i,o=t.exmls,a=0,r=o.length;r>a;a++)i=o[a],this.add(i.path,i.content);this.onloaded()},e.prototype.onloadJson=function(e,n){if(this._local){this._count=e.exmls.length,t.Resource.setSetup(1);for(var i=0,o=e.exmls.length;o>i;i++)t.loadText(e.exmls[i],this.onloadExml,this);t.Resource.setSetup(null)}else{var a;for(i=0,o=e.exmls.length;o>i;i++)a=e.exmls[i],this.add(a.path,a.content);this.onloaded()}},e.prototype.onloadExml=function(t,e){this._count--,this.add(e,t),this._count<=0&&this.onloaded()},e.prototype.onloaded=function(){this._func&&this._func.call(this._obj)},e}();__reflect(o.prototype,"ThemeManager"),t.loadTheme=function(e,n,a){i=new o(null==t.xexmls),null==t.xexmls?i.load(e,n,a):i.loadExmls(t.xexmls,n,a)},t.attachSkin=function(t,e){t.skinName=i.find(egret.getQualifiedClassName(t),e||xhd),t.onCreate&&t.onCreate()},t.findSkinByName=function(t){var e=t.indexOf("Skin"),n=(t=t.substring(0,e)).substring(t.length-2);return t=t.substring(0,t.length-2),i.find(t,"HD"==n)}}(nato||(nato={})),function(t){t.xuis=null;var e=function(){function e(){this.textures={},this.pictures={}}return e.prototype.addUIData=function(e){this._uidata=e?e.frames:t.xuis.frames},e.prototype.addIcons=function(t){this.icons=t},Object.defineProperty(e.prototype,"uidata",{get:function(){return null==this._uidata&&(this._uidata=t.xuis?t.xuis.frames:{}),this._uidata},enumerable:!0,configurable:!0}),e.prototype.getIcon=function(e){var n=this.textures,i=this.icons,o=n[e];if(o)return o;if(null==i)return null;var a=this.uidata;for(var r in a){var s=a[r];if(s.file.indexOf("icons.png")>-1){var l=t.createTexture(i,s.x,s.y,s.w,s.h,s.offX,s.offY,s.sourceW,s.sourceH);n[r]=l}}return n[e]},e.prototype.getTextureFromUICache=function(e,n,i){function o(t){n.call(i,t)}var a=this.uidata[e];if(null!=a){var r=this,s=a.file;this.getUIPicture(s,(function(n){var i=t.createTexture(n,a.x,a.y,a.w,a.h,a.offX,a.offY,a.sourceW,a.sourceH);r.textures[e]=i,o(i)}),this)}},e.prototype.getUIPicture=function(e,n,i){function o(t){n.call(i,t)}var a=this,r=this.pictures[e];null==r?t.loadImage("ui/"+e,(function(t,e){a.addUIPicture(e,t),o(t)}),this):o(r)},e.prototype.addUIPicture=function(t,e){this.pictures[t]=e},e}();t.UICache=e,__reflect(e.prototype,"nato.UICache");var n=new e;t.addUIData=function(t){n.addUIData(t)},t.addIcons=function(t){n.addIcons(t)},t.getTextureFromUICache=function(t,e,i){n.getTextureFromUICache(t,e,i)},t.getIcon=function(t){return n.getIcon(t)}}(nato||(nato={})),function(t){function e(t){for(var e=[],n=0,i=t.a.length;i>n;n++){var o=t.a[n];e.push({crc:o.c,new:o.n,old:null})}return e}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(t,e){},e.exists=function(t){return!1},e}(egret.EventDispatcher);__reflect(n.prototype,"Html5ResourceLoader");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.apply=function(t){this.load(t,1e5)},e.exists=function(t){return!1},e}(n);t.FileLoader=i,__reflect(i.prototype,"nato.FileLoader"),t.toindex=e;var o=function(){function t(){var e=new i;e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.loadError,this),e.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),this.loader=e,this.total=1,t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.loadComplete=function(t){this.list.shift(),this.loadNext()},t.prototype.loadError=function(){this.errorFunc.call(this.obj)},t.prototype.loadNext=function(){var t=this.list,e=t.length;e>0?(this.loader.apply(t[0]),this.progressFunc.call(this.obj,this.total-e,this.total)):this.onComplete()},t.prototype.onComplete=function(){this.bindFunc(this.index),this.loader=null,this.local=null,this.latest=null,this.localIndex=null,this.latestIndex=null,this.completeFunc.call(this.obj)},t.prototype.complete=function(t){void 0===t&&(t=null),t&&(this.index=e(t)),this.onComplete()},t.prototype.loadLocalAsIndex=function(){this.index=e(this.local),this.bindFunc(this.index),this.onComplete()},t.prototype.onIndex=function(t){this.loadLatestIndex(),this.loader.addEventListener(egret.Event.COMPLETE,this.loadComplete,this)},t.prototype.loadLatestIndex=function(){RES.getResByUrl(this.latestName,(function(t){this.latest=t,this.latestIndex=e(t),this.bindFunc(this.latestIndex),this.updateFunc.call(this.obj),this.loadIndex()}),null,RES.ResourceItem.TYPE_JSON)},t.prototype.loadIndex=function(){for(var t=[],e=this.localIndex,n=this.latestIndex,o=e.length,a=n.length,r=0,s=0;o>r&&a>s;){var l=e[r],_=n[s];_.crc>l.crc?r++:_.crc==l.crc?(_.new!=l.new&&(_.old=l.new,i.exists(_.new)||t.push(_.new)),r++,s++):(s++,t.push(_.new))}for(;a>s;)n[s],i.exists(_.new)||t.push(_.new),s++;this.list=t,this.index=[],this.total=t.length,this.loadNext()},t.prototype.bind=function(t){this.bindFunc=t},t.prototype.load=function(t,e){this.localName=t,this.latestName=e,RES.getResByUrl(t,this.onLocal,this,RES.ResourceItem.TYPE_JSON)},t.prototype.onLocal=function(t){return this.local=t,this.localName==this.latestName?void this.loadLocalAsIndex():void(i.exists(this.latestName)?RES.getResByUrl(this.latestName,(function(t){this.latest=t,this.loadLatestIndex(),this.bindFunc(this.latestIndex),this.updateFunc.call(this.obj)}),null,RES.ResourceItem.TYPE_JSON):(this.bindFunc(this.localIndex),this.updateFunc.call(this.obj),this.loader.removeEventListener(egret.Event.COMPLETE,this.loadComplete,this),this.loader.addEventListener(egret.Event.COMPLETE,this.onIndex,this),this.loader.apply(this.latestName)))},t.prototype.attach=function(t,e,n,i,o){this.obj=t,this.errorFunc=i,this.updateFunc=e,this.completeFunc=n,this.progressFunc=o},t._instance=new t,t}();t.Updater=o,__reflect(o.prototype,"nato.Updater")}(nato||(nato={})),function(t){var e=function(){};__reflect(e.prototype,"Callback");var n=function(){function t(){this._last=0,this._paused=!1,this._list=new Array,this._oper=new Array,this._last=egret.getTimer()}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.startTick=function(t,e){egret.startTick(t,e)},t.prototype.stopTick=function(t,e){egret.stopTick(t,e)},t.prototype.pause=function(){this._paused=!0},t.prototype.resum=function(){this._paused=!1},t.prototype.register=function(n,i,o){if(void 0===o&&(o=0),null!=n){for(var a=this._oper,r=0,s=a.length;s>r;r++)if(0!=((l=a[r]).priority&t.INSERT_MASK)&&l.func==n&&l.obj==i)return void(l.priority<o&&(l.priority=o));var l;(l=new e).obj=i,l.func=n,l.priority=o|t.INSERT_MASK,a.push(l)}},t.prototype.unregister=function(n,i){for(var o=this._oper,a=0,r=o.length;r>a;a++)if(0!=((s=o[a]).priority&t.REMOVE_MASK)&&s.func==n&&s.obj==i)return;var s;(s=new e).obj=i,s.func=n,s.priority=t.REMOVE_MASK,o.push(s)},t.prototype.insert=function(t){for(var e,n=this._list,i=!1,o=0,a=n.length;a>o;o++)if((e=n[o]).func==t.func&&e.obj==t.obj){if(i=!0,e.priority>=t.priority)return!1;e.priority=t.priority;break}return i||n.push(t),t.priority>0},t.compareCallback=function(t,e){return t.priority>e.priority?-1:t.priority<e.priority?1:0},t.prototype.remove=function(t){for(var e,n=this._list,i=0,o=n.length;o>i;i++)if((e=n[i]).obj==t.obj&&e.func==t.func)return void n.splice(i,1)},t.prototype.check=function(){if(!(this._oper.length<=0)){for(var e,n=this._oper,i=!1,o=0,a=n.length;a>o;o++)0!=((e=n[o]).priority&t.INSERT_MASK)?this.insert(e)&&(i=!0):0!=(e.priority&t.REMOVE_MASK)?this.remove(e):console.error("error callback",e),e.priority&=t.VALUE_MASK;n.length=0,i&&this._list.sort(t.compareCallback)}},t.prototype.run=function(){var t=this._last,e=egret.getTimer();if(this._last=e,!this._paused){this.check();for(var n,i=e-t,o=this._list,a=0,r=o.length;r>a;a++)(n=o[a]).func.call(n.obj,i)}},t.INSERT_MASK=1<<22,t.REMOVE_MASK=1<<23,t.VALUE_MASK=1073741823,t._instance=new t,t}();t.WorldTicker=n,__reflect(n.prototype,"nato.WorldTicker")}(nato||(nato={}));var GZIP=function(){function t(){}return t.inflate=function(e){if(t.gzipIndex=t.gzipByte=t.gzipBit=0,35615!=t.readBits(e,16)||8!=t.readBits(e,8))throw new Error("Invalid GZIP format");var n=t.readBits(e,8);if(t.gzipIndex+=6,0!=(n&t.FEXTRA_MASK)&&(t.gzipIndex+=t.readBits(e,16)),0!=(n&t.FNAME_MASK))for(;0!=e[t.gzipIndex++];);if(0!=(n&t.FCOMMENT_MASK))for(;0!=e[t.gzipIndex++];);0!=(n&t.FHCRC_MASK)&&(t.gzipIndex+=2);var i=t.gzipIndex;t.gzipIndex=e.length-4;for(var o=t.readBits(e,16)|t.readBits(e,16)<<16,a=new Array(o),r=0;o>r;r++)a[r]=0;var s=0;t.gzipIndex=i;var l=0,_=0;do{if(l=t.readBits(e,1),(_=t.readBits(e,2))==t.BTYPE_NONE){t.gzipBit=0;var h=t.readBits(e,16);t.readBits(e,16),Tool.arraycopy(e,t.gzipIndex,a,s,h),t.gzipIndex+=h,s+=h}else{var u=void 0,c=void 0;if(_==t.BTYPE_DYNAMIC){var T=t.readBits(e,5)+257,p=t.readBits(e,5)+1,d=t.readBits(e,4)+4,E=new Array(t.MAX_CODE_LENGTHS+1);for(r=0,h=E.length;h>r;r++)E[r]=0;for(r=0;d>r;r++){var g=t.readBits(e,3),S=t.toByte(g);E[t.DYNAMIC_LENGTH_ORDER[r]]=S}var m=t.createHuffmanTree(E,t.MAX_CODE_LENGTHS);u=t.createHuffmanTree(t.decodeCodeLengths(e,m,T),T-1),c=t.createHuffmanTree(t.decodeCodeLengths(e,m,p),p-1)}else{var f=new Array(t.MAX_CODE_LITERALS+1);for(r=0,h=f.length;h>r;r++)f[r]=0;for(r=0;144>r;r++)f[r]=8;for(r=144;256>r;r++)f[r]=9;for(r=256;280>r;r++)f[r]=7;for(r=280;288>r;r++)f[r]=8;u=t.createHuffmanTree(f,t.MAX_CODE_LITERALS);var I=new Array(t.MAX_CODE_DISTANCES+1);for(r=0;r<I.length;r++)I[r]=5;c=t.createHuffmanTree(I,t.MAX_CODE_DISTANCES)}for(var A=0,y=0,R=0;(A=t.readCode(e,u))!=t.EOB_CODE;)if(A>t.EOB_CODE){A-=257;var P=t.LENGTH_VALUES[A];(y=t.LENGTH_EXTRA_BITS[A])>0&&(P+=t.readBits(e,y)),A=t.readCode(e,c);var C=t.DISTANCE_VALUES[A];(R=t.DISTANCE_EXTRA_BITS[A])>0&&(C+=t.readBits(e,R));for(var M=s-C;P>C;)Tool.arraycopy(a,M,a,s,C),s+=C,P-=C,C<<=1;Tool.arraycopy(a,M,a,s,P),s+=P}else a[s++]=t.toByte(A)}}while(0==l);var L=new egret.ByteArray;for(r=0;r<a.length;r++)L.writeByte(a[r]);return L.position=0,L},t.readBits=function(e,n){for(var i=0==t.gzipBit?t.gzipByte=255&e[t.gzipIndex++]:t.gzipByte>>t.gzipBit,o=8-t.gzipBit;n>o;o+=8)t.gzipByte=255&e[t.gzipIndex++],i|=t.gzipByte<<o;return t.gzipBit=t.gzipBit+n&7,i&(1<<n)-1},t.readCode=function(e,n){for(var i=n[0];i>=0;)0==t.gzipBit&&(t.gzipByte=255&e[t.gzipIndex++]),i=0==(t.gzipByte&1<<t.gzipBit)?n[i>>16]:n[65535&i],t.gzipBit=t.gzipBit+1&7;return 65535&i},t.decodeCodeLengths=function(e,n,i){for(var o=new Array(i),a=0,r=0,s=0;i>a;){if((r=t.readCode(e,n))>=16){var l=0;for(16==r?(l=3+t.readBits(e,2),r=s):(l=17==r?3+t.readBits(e,3):11+t.readBits(e,7),r=0);l-- >0;)o[a++]=t.toByte(r)}else o[a++]=t.toByte(r);s=r}return o},t.createHuffmanTree=function(e,n){for(var i=new Array(t.MAX_BITS+1),o=0,a=i.length;a>o;o++)i[o]=0;for(o=0;o<e.length;o++)i[e[o]]++;var r=0;i[0]=0;var s=new Array(t.MAX_BITS+1);s[0]=0;for(o=1;o<=t.MAX_BITS;o++)s[o]=r=r+i[o-1]<<1;var l=(n<<1)+t.MAX_BITS,_=new Array(l);for(o=0;l>o;o++)_[o]=0;var h=1;for(o=0;n>=o;o++){if(0!=(a=e[o])){r=s[a]++;for(var u=0,c=a-1;c>=0;c--){if(0==(r&1<<c)){var T=_[u]>>16;0==T?(_[u]|=h<<16,u=h++):u=T}else{var p=65535&_[u];0==p?(_[u]|=h,u=h++):u=p}}_[u]=2147483648|o}}return _},t.toByte=function(t){var e=255&t;return e>127?-(1+(255^e)):e},t.toShort=function(t){var e=65535&t;return e>Tool.MAX_VALUE_short?-(1+(65535^e)):e},t.toInteger=function(t){var e=4294967295&t;return e>Tool.MAX_VALUE_int?-(1+(4294967295^e)):e},t.FTEXT_MASK=1,t.FHCRC_MASK=2,t.FEXTRA_MASK=4,t.FNAME_MASK=8,t.FCOMMENT_MASK=16,t.BTYPE_NONE=0,t.BTYPE_FIXED=1,t.BTYPE_DYNAMIC=2,t.BTYPE_RESERVED=3,t.MAX_BITS=16,t.MAX_CODE_LITERALS=287,t.MAX_CODE_DISTANCES=31,t.MAX_CODE_LENGTHS=18,t.EOB_CODE=256,t.LENGTH_EXTRA_BITS=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],t.LENGTH_VALUES=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],t.DISTANCE_EXTRA_BITS=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],t.DISTANCE_VALUES=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],t.DYNAMIC_LENGTH_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],t}();__reflect(GZIP.prototype,"GZIP");var Login=function(){function t(){this.reLogin=!1,this.isLoginServerConnected=!1,this.isTouristLogin=!1,this.isRegister=!1,this.isModify=!1}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.openSelectRoleScene=function(){PopUpManager.closeAll(),PanelManager.closeWaitForServer(),PanelManager.waitForServerPanel=null,this.selectRoleScene=new SelectRoleScene,nato.attachSkin(this.selectRoleScene),LoadManager.instance.removeLoadingUI(),Main.instance.removeUI(this.createRoleScene),Main.instance.addUI(this.selectRoleScene)},t.prototype.openCreateRoleScene=function(){this.createRoleScene=new CreateRoleScene,nato.attachSkin(this.createRoleScene),LoadManager.instance.removeLoadingUI(),Main.instance.removeUI(this.selectRoleScene),Main.instance.addUI(this.createRoleScene)},t.prototype.doRelogin=function(){LoadManager.instance.returnLoginView(),this.reLogin=!0},t.prototype.connectLoginServer=function(t,e,n){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n=!1),nato.Network.connect(xserver,this.onConnect,this.onClose,this),PanelManager.openWaitForServer("连接服务器..."),this.isTouristLogin=t,this.isRegister=e,this.isModify=n},t.prototype.onClose=function(){this.isLoginServerConnected=!1,PanelManager.closeWaitForServer()},t.prototype.onConnect=function(){this.isLoginServerConnected=!0;var t=MsgHandler.createCheckEditionMsg(MsgHandler.CHECK_VERSION_NONE);nato.Network.sendCmd(t,this.onCheckVersion,this)},t.prototype.sendLogin=function(t){this.loginMsg=t,0==this.isLoginServerConnected?this.connectLoginServer():this.checkVersion()},t.prototype.checkVersion=function(){var t=MsgHandler.createCheckEditionMsg(MsgHandler.CHECK_VERSION_NONE);nato.Network.sendCmd(t,this.onCheckVersion,this)},t.prototype.onCheckVersion=function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(1==n)var i=(e.getString(),e.getString());else if(2==n)e.getString();else{if(e.getByte()==MsgHandler.CHECK_VERSION_LOW)if(e.getBoolean()){var o=e.getString(),a=e.getString();i=e.getString()}else e.getString();for(var r=e.getByte(),s=[],l=0;r>l;l++){o=e.getString(),a=e.getString(),i=e.getString();s.push([o,a,i])}var _=e.getString();Tool.isNullText(_),s.length>0?GameWorld.loginNoticeList=s:GameWorld.loginNoticeList=null}1==this.reLogin&&LoadManager.instance.returnLoginView(),this.isTouristLogin?(this.isTouristLogin=!1,GameWorld.doTourist(GameWorld.toursex,GameWorld.tourstyle)):this.isRegister?(this.isRegister=!1,t.instance.registerAccount(GameWorld.registerAccount,GameWorld.registerPasswd)):this.isModify?(this.isModify=!1,t.instance.sendModifyPassword(GameWorld.modifyAccount,GameWorld.modifyPwd,GameWorld.modifyNewPwd)):this.doSendLogin()},t.prototype.doSendLogin=function(){nato.Network.sendCmd(this.loginMsg,null,null),PanelManager.openWaitForServer("账号登录中..."),this.loginMsg=null},t.processGameServerErrorNotify=function(t){t.getByte(),t.getString(),PanelManager.closeWaitForServer();var e=PanelManager.getPanel(LoginPanel);e&&e.stage&&e.updateTips("账号或密码错误"),PanelManager.closeWaitForServer()},t.prototype.onLogin=function(t){var e=t.getByte();if(-22==e)return alert("平台登录出错,请重新登录！"),void document.execCommand("Refresh");if(0!=e){var n=t.getString(),i=PanelManager.getPanel(LoginPanel);return i&&i.stage&&i.updateTips(n),void PanelManager.closeWaitForServer()}(GameWorld.ukey=t.getLong(),GameWorld.sessionId=t.getUnsignedInt(),GameWorld.photoIp=t.getString(),GameWorld.loginSetting=t.getInt(),xchannel==Define.CHANNEL_WANBA)&&(t.getBoolean()?Sdk.xsdk.reportRegister():Sdk.xsdk.reportLogin());this.requestLastServerInfo(),this.requestAreaLines()},t.prototype.requestLastServerInfo=function(){ServerInfo.getLastServerInfo()},t.prototype.requestAreaLines=function(){var t=MsgHandler.createAreaLineListMsg();nato.Network.sendCmd(t,this.onAreaLineList,this),PanelManager.openWaitForServer("加载服务器列表...")},t.prototype.onAreaLineList=function(t){ServerInfo.gameAreaList=[],ServerInfo.loginedServerList=[];for(var e=t.getByte(),n=0;e>n;n++){for(var i=ServerInfo.fromAreaBytes(t),o=t.getByte(),a=0;o>a;a++)i.addLine(ServerInfo.fromLineBytes(t));(xchannel!=Define.CHANNEL_WANBA||1==i.id)&&(ServerInfo.gameAreaList.push(i),i.actorCount>0&&ServerInfo.loginedServerList.push(i))}PopUpManager.closeAll(),PanelManager.closeWaitForServer(),PanelManager.openAreaLineListPanel()},t.prototype.connectGameServer=function(){this.isLoginServerConnected=!1;var t=ServerInfo.getSelectServer().webSocketUrl;nato.Network.connect(t,this.onConnectGameServer,this.onCloseGameServer,this)},t.prototype.onConnectGameServer=function(){var t=MsgHandler.createFirstGameServerMsg();nato.Network.sendCmd(t,this.onFirstGameServerConnected,this)},t.prototype.onFirstGameServerConnected=function(t){0!=t.getByte()&&PanelManager.closeWaitForServer(),this.requestPlayerList()},t.prototype.requestPlayerList=function(){var t=MsgHandler.createPLayerListMsg();nato.Network.sendCmd(t,this.onPlayerListBack,this),PanelManager.openWaitForServer("加载角色列表...")},t.prototype.onPlayerListBack=function(e){var n=e.getByte();this.allPlayerList=[];for(var i=0;n>i;i++){var o=t.getMessagePlayer(e);this.allPlayerList.push(o)}xworld.actorCreatableCount=e.getInt(),Main.instance.clearAll(),0==n?this.openCreateRoleScene():this.openSelectRoleScene()},t.prototype.createPlayer=function(t){var e=MsgHandler.createAddPlayerMsg(t);nato.Network.sendCmd(e,this.onCreatePlayer,this)},t.prototype.onCreatePlayer=function(e){if(0==e.getByte()){this.createRoleScene.createRoleSuccess();var n=t.getMessagePlayer(e);xworld.createMyPlayer(n.getId(),n.getName()),this.doPlayerLogin();var i={server_id:ServerInfo.currentSelectServerInfo.id,server_name:ServerInfo.currentSelectServerInfo.name,role_id:n.getId(),role_name:n.name};Sdk.xsdk.createRoleStatistic(i),xchannel==Define.CHANNEL_YIJIE&&Sdk.xsdk.statistic("createrole")}else{var o=e.getString();this.createRoleScene.setTipsText(o)}},t.getMessagePlayer=function(t){var e=new ListPlayer;if(e.setId(t.getInt()),e.setName(t.getString()),e.setSex(t.getByte()),e.setRace(t.getByte()),e.setJob(t.getByte()),e.setLevel(t.getByte()),e.setVipLevel(t.getByte()),e.setMapName(t.getString()),e.setIcon1(t.getInt()),e.setIcon2(t.getInt()),e.setIcon3(t.getInt()),e.status=t.getInt(),e.isStatusBit(ModelConst.STATUS_TEMP_DEL)){var n=t.getShort();e.setTimes(Date.now()+n*Tool.MILLIS_IN_MINUTE)}if(e.isStatusBit(ModelConst.STATUS_OFFLINEMISSION)&&0==t.getBoolean()){e.setTabStatus(!0,Model.OFFLINE_DOING);n=t.getShort();e.setTimes(Date.now()+n*Tool.MILLIS_IN_MINUTE),e.setInfo(t.getString())}return e},t.prototype.doPlayerLogin=function(){var t=xself.getId(),e=MsgHandler.createPlayerEnterMsg(t,GameWorld.strImgCheck);nato.Network.sendCmd(e,this.onPlayerLogin,this),PanelManager.openWaitForServer()},t.prototype.onPlayerLogin=function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(0==n){var i,o,a;this.selectRoleScene&&this.selectRoleScene.parent&&this.selectRoleScene.parent.removeChild(this.selectRoleScene),GameWorld.loginSetting=e.getInt(),i=e.getByte(),o=e.getInt(),Skill.DELETE_SKILL_MONEY=[i,o],i=e.getByte(),o=e.getInt(),a=e.getInt(),RoleBasePanel.DEL_ARRTIBUTE=[i,o,a],i=e.getByte(),o=e.getInt(),i=e.getByte(),o=e.getShort(),i=e.getByte(),o=e.getInt(),MarryHandler.PARTNER_ADD_MONEY=[i,o],MsgHandler.instance.processDataBlockFlagMsg(e),PanelManager.openMainMenuScene(),xworld.startUpdate(),GameNotice.checkIsShowWhileLogin(),TodayEvent.initData(),ItemGet.initData(),SkillRecommend.initData(),ServerInfo.saveServerInfoToServer(),ActivityService.instance.initActivity();var r=Main.queryString("gift");r&&!Tool.isNullText(r)&&new PlatformGiftPanel(parseInt(r)).show();var s=Main.queryString("share_id");if(s&&!Tool.isNullText(s)){var l=new nato.Message(ProtocolDefine.CG_INVITATION_REPORT);l.putInt(parseInt(s)),PanelManager.openWaitForServer(),nato.Network.sendCmd(l,(function(t){PanelManager.closeWaitForServer(),0>t.getByte()&&AlertPanel.alertCommon("上报失败！")}),this)}if(xchannel==Define.CHANNEL_YIJIE)Sdk.xsdk.statistic("sendRole"),Sdk.xsdk.statistic("enterServer");else if(xchannel==Define.CHANNEL_MANBA){var _={isMabBa:!0,roleid:""+xself.getId(),rolename:xself.getName(),rolelevel:""+xself.getLevel(),zoneid:""+ServerInfo.currentSelectServerInfo.id,zonename:""+ServerInfo.currentSelectServerInfo.name,balance:""+xself.money1,vip:""+xself.vipLevel,partyname:Tool.isNullText(xself.getCountryName())?"无帮派":xself.getCountryName(),attach:""};Sdk.xsdk.statistic(_)}}else{var h=e.getString();if(n==t.ACTOR_LOGIN_NEED_IMAGE_CHECK){var u=e.getBytes();PanelManager.openImgCheckPanel(u,t.IMG_CHECK_TYPE_LOGIN,h),PanelManager.closeWaitForServer()}else AlertPanel.alertCommon(h)}},t.openLoginLottery=function(){xworld.inBattle||LoginLotteryDraw.LoginAlert()&&LoginLotteryDraw.doEnter()},t.prototype.sendModifyPassword=function(e,n,i){if(1!=Tool.isNullText(e)&&1!=Tool.isNullText(n)&&1!=Tool.isNullText(i)){var o=MsgHandler.createModifyPlayerName(e,n,"",i);nato.Network.sendCmd(o,(function(n){if(0>n.getByte()){var o=n.getString();AlertPanel.alertCommon(o)}else GameWorld.username=e,GameWorld.password=i,t.instance.saveAccountInStorage(e,i),AlertPanel.alertCommon("修改成功，您的新密码为【"+i+"】,请妥善保管"),PanelManager.closeModifyPasswordPanel(),PanelManager.openLoginPanel()}),this)}},t.prototype.registerAccount=function(t,e){var n=MsgHandler.createUserRegisterMsg(t,e,"","","",0);nato.Network.sendCmd(n,this.onAccountRegister,this)},t.prototype.onAccountRegister=function(e){var n=e.getByte();if(0==n){PanelManager.closeRegisterPanel();var i=null,o=null;PanelManager.getPanel(RegisterPanel)&&(i=PanelManager.getPanel(RegisterPanel).input_account.text,o=PanelManager.getPanel(RegisterPanel).input_password.text),GameWorld.username=i,GameWorld.password=o,PanelManager.openLoginPanel(i,o)}else{var a=e.getString();if(PanelManager.isPanelShow(RegisterPanel)&&PanelManager.getPanel(RegisterPanel).updateTips(a),n==t.CREATE_ERR_NEED_IMAGE_CHECK){var r=e.getBytes();PanelManager.openImgCheckPanel(r,t.IMG_CHECK_TYPE_REGISTER,a)}else t.CREATE_ERR_REGISTER}},t.doPlayerListMsg=function(e,n,i,o){function a(e){return 0!=e.getByte()?void PanelManager.closeWaitForServer():(i&&i.call(o),void(1==n&&t.instance.requestPlayerList()))}if(null==e)return AlertPanel.alertCommon(GameText.STR_SERVER_NULL),!1;if(e.state==ServerInfo.SERVER_STATE_STOP)return AlertPanel.alertCommon(GameText.STR_SERVER_STATE_STOP),!1;var r=e.getAreaServer();null!=r&&r.isNeedSpecialCode,t.instance.isLoginServerConnected=!1,nato.Network.connect(e.webSocketUrl,(function(){var t=MsgHandler.createFirstGameServerMsg();nato.Network.sendCmd(t,a,this)}),(function(){PanelManager.closeWaitForServer(),AlertPanel.alertNotify("提示","网络异常或者你的号被登录！",Sdk.xsdk.logout,this,PopUpManager.CloseType.NONE,!1),AlertPanel.instance.tag=AlertPanel.Tag_loginout}),this)},t.prototype.saveAccountInStorage=function(t,e){var n=new Account(t,e),i=JSON.stringify([n]);Interface.saveString("accountList",i),xaccountlist=i},t.prototype.onCloseGameServer=function(){PanelManager.closeWaitForServer(),0==xworld.kickBySelf&&AlertPanel.alertTips("提示","亲爱的玩家，你的网络连接到火星去了，请退出后重新登录游戏吧~"),AlertPanel.instance.tag=AlertPanel.Tag_loginout},t.prototype.reloadPage=function(){window.location.href=location.href},t.prototype.logout=function(){xworld.stopUpdate(),Main.instance.clearAll(),this.doRelogin()},t.CREATE_ERR_NEED_IMAGE_CHECK=-13,t.CREATE_ERR_REGISTER=-16,t.isChangeServer=!1,t.IMG_CHECK_TYPE_LOGIN=1,t.IMG_CHECK_TYPE_REGISTER=2,t.ACTOR_LOGIN_NEED_IMAGE_CHECK=-13,t}();__reflect(Login.prototype,"Login");var MsgHandler=function(){function t(){var e=nato.Network.addMsgHandler,n=ProtocolDefine;e(n.CG_ERROR_NOTIFY,Login.processGameServerErrorNotify,Login),e(n.LC_PLAYER_LOGIN,Login.instance.onLogin,Login.instance),e(n.CG_LOGIN_ACTORLEAVE,t.processPlayerLogoutMsg,t),e(n.CG_SCENE_ENTERMAP,this.onPlayerEnter,this),e(n.CG_SCENE_LEAVEMAP,this.onPlayerLeave,this),e(n.CG_SCENE_PLAYER_ICON,this.processIconChangeMessage,this),e(n.CG_SCENE_GET_OTHER_PLAYER_STATE,this.processOtherMoveTo,this),e(n.CG_SCENE_WORLDDATA,this.onSceneWorldData,this),e(n.CG_SCENE_GO_MAP,this.onJumpMap,this),e(n.CG_SCENE_UPDATE,t.processMapUpdateMsg,t),e(n.CG_ACTOR_LOGIN_ONLINE_REWARD,this.processPushOnlineRewardInfo,this),e(n.CG_TASK_NPC_STATUS,t.processMissionNPCStatus,this),e(n.CG_TASK_ACCEPT_TEAM,t.processMissionTeamMemberAccept,this),e(n.CG_TASK_DELIVER_TEAM,t.processMissionTeamDeliver,this),e(n.CG_SKILL_UPDATE,t.updatePlayerSkill,this),e(n.CG_MAIL_NOTIFY,t.processMailNotifyMsg,this),e(n.CG_SCENE_PLAYER_EVENT,t.processPlayerEventMsg,this),e(n.CG_SEND_IS_OPEN,GameWorld.doGetIsOpen,this),e(n.CG_SEND_ACCOST,ChatUp.doChatUpRefresh,this),e(n.CG_SEND_INITIATIVE_ACCOST,ChatUp.doChatUpRefresh,this),e(n.CG_BAG_CLEAN,this.processBagRefreshMsg,this),e(n.CG_EQUIP_TASK_GET_ITEM,t.doAutoEquipUpdatedata,this),e(n.CG_SCENE_GO_CITY,this.processJumpCityMsg,this),e(n.CG_SCENE_FINDPATH_AGAIN,t.processSceneFindPathAgain,this),e(n.CG_CITY_MAP_REFRESH,t.processCityCountryReflashMsg,this),e(n.CG_FIGHT_RUN_LOCALBATTLE,t.processLocalBattleReward,this),e(n.CG_FIGHT_ENTER_REMOTEBATTLE,t.processEnterRemoteBattle,this),e(n.CG_FIGHT_SEE_IN,t.processEnterRemoteBattle,this),e(n.CG_FIGHT_SEE_OUT,t.processBattleSeeExit,t),e(n.CG_FIGHT_ENTER_BATTLE_NOTIFY,t.processRemoteBattleNotify,this),e(n.CG_FIGHT_BATTLE_UPDATE,t.processBattleUpdate,this),e(n.CG_TEAM_JOIN,t.processJoinTeamMsg,this),e(n.CG_TEAM_DISBAND,t.processDismissTeamMsg,this),e(n.CG_TEAM_SET,t.processTeamSetMsg,this),e(n.CG_TEAM_CHANGE_CAPTAIN,t.processChangeLeaderMsg,this),e(n.CG_TEAM_LEAVE,t.processLeaveTeamMsg,this),e(n.CG_TEAM_INVITE,t.processReqAskMsg,t),e(n.CG_FIGHT_PK_ASK,t.processReqAskMsg,t),e(n.CG_COUNTRY_INVITE,t.processReqAskMsg,t),e(n.CG_CHAT_DOWN_SYSTEM,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_WORLD,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_MAP,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_COUNTRY,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_TEAM,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_PRIVATE,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_UNION,t.processChatMessageReceive,this),e(n.CG_CHAT_DOWN_SERVERS,t.processServerChatMessageReceive,this),e(n.CG_CHAT_SUBMIT,t.processChatSubmit,this),e(n.CG_SCENE_SHOW_TEXT,t.processShowTextMsg,this),e(n.CG_TASK_ESCORT_START,t.processEscortStartMsg,this),e(n.CG_ACTOR_LOGIN_LOTTERY_DRAW_NEW,LoginLotteryDraw.doPushIsOpen,this),e(n.CG_CHANGE_TURN_MONSTER,PlayerTurnMonster.doChangeTurnMonsterPush,PlayerTurnMonster),e(n.CG_TURN_MONSTER_NOTIFY,t.processPlayerTrunMonsterNotifyMsg,this),e(n.CG_PLAYERSHOP_SHOP_NOTIFY,t.processPlayerShopHasNotifyMsg,this),e(n.CG_PLAYERSHOP_STOP,SellHandler.processPlayerShopEndMsg,this),e(n.CG_PLAYERSHOP_SELL_NOTIFY,SellHandler.processPlayerShopNotifyMsg,this),e(n.CG_ENCHANTSHOP_STOP,SellHandler.processPlayerEnchantShopEndMsg,this),e(n.CG_ACTOR_ATTRIBUTE_UPDATE,t.processAttributeUpdateMsg,this),e(n.CG_ACTOR_ATTRIBUTE_UPDATE_STRING,t.processAttributeUpdateMsg2,this),e(n.CG_FIGHT_ENTER_PLAYER_NOTIFY,t.processSkyArenaRefresh,t),e(n.CG_FIGHT_ENTER_PLAYER_BATTLE_NOTIFY_LIST,t.processSkyArenaEnter,t),e(n.CG_TASK_ARENA_UPDATE,t.processArenaUpdate,t),e(n.CG_TASK_ARENA_START,t.processArenaStart,t),e(n.CG_TASK_ARENA_END,t.processArenaEnd,t),e(n.CG_TASK_COUNTRY_BOSS_JOIN_PUSH,CountryBoss.processCountryBoss,CountryBoss),e(n.CG_TASK_COUNTRY_BOSS_GET_SCORE,CountryBoss.doCountryBossGetScore,CountryBoss),e(n.CG_TASK_COUNTRY_BOSS_UPDATE,CountryBoss.doRefresh,CountryBoss),e(n.CG_COUNTRY_WAR_START,t.processCountryWarEnter,this),e(n.CG_COUNTRY_WAR_NOTICE,CountryWar.doRoundNotice,CountryWar),e(n.CG_COUNTRY_WAR_UPDATE,CountryWar.doRefresh,CountryWar),e(n.CG_TASK_TEAM_BOSS_JOIN,TeamBoss.processTeamBoss,TeamBoss),e(n.CG_TASK_TEAM_BOSS_UPDATE,TeamBoss.doRefresh,TeamBoss),e(n.CG_TASK_TEAM_BOSS_END,TeamBoss.doOverNotice,TeamBoss),e(n.CG_TASK_VITALITY_REMIND,Vitality.doGetPush,Vitality),e(n.CG_COUNTRY_JOIN_NOTIFY,t.processCountryNotify,this),e(n.CG_SEND_RED_PACKET_DATA,RedPaper.processRedPacketNotify,RedPaper),e(n.CG_ACTOR_DRAW_MICRO_REWARD,t.processDrawMicroReward,this),e(n.CG_ACTOR_VIP_LEVEL,VipInfo.processVIPLevel,VipInfo)}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.doSocketHeart=function(){if(!(Date.now()<t.nextHeartBeat)){t.lastHeartBeat=Date.now();var e=t.createSystemHeartMsg();nato.Network.sendCmd(e),t.nextHeartBeat=Date.now()+t.HEART_BEAT_TIME}},t.prototype.onPlayerEnter=function(e){var n=t.processDataPlayerListBase(e,new Model(3));xworld.addModel(n),n.refreshWorldSprite(),n.getPet()&&n.getPet().refreshWorldSprite();var i=xworld.gameMap;if(i&&i.playerLayer){var o=i.playerLayer;o.addChild(n),n.getPet()&&o.addChild(n.getPet())}},t.prototype.onPlayerLeave=function(t){var e=t.getInt(),n=xworld.getModel(e);if(null!=n){n.parent&&n.parent.removeChild(n);var i=n.getPet();i&&i.parent&&i.parent.removeChild(i),xworld.removeModel(e)}},t.prototype.processIconChangeMessage=function(t){var e=t.getInt(),n=xworld.getModel(e);if(null!=n){GameWorld.getPlayerID();var i=n.isTwoPeopleHouse();n.setIcon1(t.getInt()),n.setIcon2(t.getInt()),n.setIcon3(t.getInt()),i!=n.isTwoPeopleHouse()&&n.clearMemberHideStatus(),n.refreshWorldSprite()}},t.prototype.processOtherMoveTo=function(e){for(var n=e.getShort(),i=xself.getId(),o=0,a=0;n>a;a++){var r=e.getInt(),s=e.getByte(),l=e.getByte(),_=e.getByte();if(r!=i){var h=xworld.getModel(r);if(null!=h&&(h.setMode(_),1!=h.isMember()))if(o>=t.MAX_OTHER_MOVE_TO)h.setPosition(s,l);else if(xworld.inBattle)h.setPosition(s,l);else if(0==Model.isSameTeam(xself,h)&&(Math.abs(h.getGx()-s)>6||Math.abs(h.getGy()-l)>6))h.setPosition(s,l);else{o+=1;var u=Control.createMoveTo(r,s,l);h.addControl(u)}}}},t.prototype.onSceneWorldData=function(t){if(0==t.getByte()){if(GameWorld.isNewArenaStatus())return;this.processDataBlockFlagMsg(t)}GuideHandler.cityTaskGuide()},t.prototype.onJumpMap=function(t){var e=t.getByte();if(0>e)return AlertPanel.errorMessage(t.getString()),void(xworld.isJumpingMap=!1);if(0==e)this.processDataBlockFlagMsg(t),AutoGamer.switchAutoGaming(!1);else{xself&&xself.clearAutoMoveList()}},t.processMapUpdateMsg=function(e){var n=e.getInt(),i=e.getByte(),o=e.getByte();if(GameWorld.getCurMapID()==n){null!=xself&&xself.setPosition(i,o)}else{var a=t.createWorldDataMessage(Define.SIMPLE_FLASH_DATA_FLAG,!0);nato.Network.sendCmd(a)}},t.processLocalBattleReward=function(e){var n,i=e.getByte();if(0>i){window.__myEvent__.emit("battle:rate:error"),console.error("LOCAL BATTLE",o);var o=e.getString();return xself&&(o+=",hp="+xself.get(ModelConst.HP)),void t.createWorldDataReflashMsg()}(2==i&&(t.parseBattleNormalReward(e),t.processMissionNPCStatus(e)),e.getBoolean())||(n=xself)&&(n.power=-1);(t.processMyMercenaryCheck(e),e.getBoolean()&&(xworld.battleChangeMap=!0),e.getBoolean())||(n=xself)&&(n.countrypowerValue=0);xworld.handleMyPlayerDurability(!1,!1),n.checkHPMP(),PanelManager.mainMenu.headInfoView.update()},t.processEnterRemoteBattle=function(e){return 0>e.getByte()?(AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),e.getString()),void(GameWorld.isArenaStatus()&&Arena.doUpdateArenaNearActorList())):void t.processRemoteBattleNotify(e)},t.processBattleSeeExit=function(t){null!=t&&BattleView.instance.doExit()},t.parseBattleModel=function(e){var n=e.getInt(),i=e.getByte(),o=e.getString(),a=e.getByte(),r=e.getInt(),s=e.getInt(),l=e.getInt(),_=e.getInt(),h=e.getInt(),u=0,c=0,T=0;switch(i){case 2:case 1:case 4:u=e.getInt();break;default:u=e.getInt(),c=e.getInt(),T=e.getInt()}var p=-1,d=!1;5==i&&(p=e.getShort(),d=e.getBoolean());var E=e.getInt(),g=e.getInt(),S=null;e.getBoolean()&&(S=Skill.fromByteFormationSkill(e));var m=e.getShort(),f=xself;if(null!=f&&f.getId()==n){if(4==i){var I=f.getPet();return null==I?null:(t.debugBattleModel(I,r,s,l,_),I.position=a,I.bStatus=h,I.hp=r,I.mp=l,I)}if(5==i){var A=f.getMercenaryById(p);if(null==A)return null;if(0==d&&null==(A=A.getPet()))return null;var y=A.getClone();return y.worldMer=A,t.debugBattleModel(A,r,s,l,_),y.position=a,y.bStatus=h,y.hp=r,y.mp=l,y}return t.debugBattleModel(f,r,s,l,_),f.position=a,f.bStatus=h,f.hp=r,f.mp=l,f}var R=new Monster;return R.setType(i),R.setId(n),R.setName(o),R.position=a,R.hp=r,R.hpMax=s,R.mp=l,R.mpMax=_,R.bStatus=h,R.setIcon1(u),R.setIcon2(c),R.setIcon3(T),R.bornStatus=E,R.keepout_atk_time=g,R.formationSkill=S,R.setIconpet1(m),R},t.debugBattleModel=function(t,e,n,i,o){},t.processRemoteBattleNotify=function(e){var n=e.getInt(),i=e.getByte(),o=e.getByte(),a=e.getByte(),r=e.getInt(),s=e.getInt(),l=e.getInt(),_=e.getBoolean();i==Battle.LOCAL&&WorldMessage.addSystemChat("processRemoteBattleNotify() type = LOCAL, why????????????");for(var h=new Array(Battle.MAX_POS),u=e.getByte(),c=0;u>c;c++){var T=t.parseBattleModel(e);null!=T&&(h[T.position]=T)}var p=Battle.createRemoteBattle(0,h,null);p.type=i,p.setBattleResult(o),p.round=a,p.roundEndTime=Date.now()+r,p.waitStatus=s,p.nextBattleGroupID=l,p.inOneKeyDaily=_,p.battleSeq=n,p.setRemoteWaiting(!1),xworld.battle=p;var d=BattleView.instance;d.setBattle(p),Main.instance.addGame(d),_&&0==xself.isLeader()&&1==xself.isInTeam()&&d.setTag(BattleConst.TAG_IS_AUTO_FIGHT,!0),d.initBattle(),window.__myEvent__.emit("enter:battle:map")},t.processBattleUpdate=function(e){var n=e.getByte(),i=xworld.battle;if(null!=i){var o=BattleView.instance;if(null!=o){if(o.setTag(BattleConst.TAG_REMOTE_SEND_WAITING,!1),Player.recycleOKImage(),0>n)return void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),e.getString());if(0==n)if(e.getByte()!=Battle.BATTLE_STATUS_FINISH){var a=e.getInt();return void(i.waitStatus=a)}var r=e.getByte(),s=e.getByte(),l=e.getInt();a=e.getInt();i.setBattleResult(r),i.round=s,i.roundEndTime=Date.now()+l,i.waitStatus=a,i.setRemoteWaiting(!1);for(var _=e.getByte(),h=0;_>h;h++){var u=e.getByte(),c=e.getInt(),T=e.getInt(),p=e.getInt(),d=e.getInt(),E=e.getInt(),g=i.getPlayerByPos(u);null!=g&&(g.hp=c,g.mp=T,g.bStatus=p,g.setBattleIntValue(d),g.keepout_atk_time=E)}var S=e.getByte();for(h=0;S>h;h++){var m=Control.fromBytes(e.getBytes());i.addAniControl(m)}if(o.makeBattleAni(),PanelManager.battleUI.hideMenu(),o.isTag(BattleConst.TAG_IS_SKIP_BATTLE)&&o.closePlayerAnimation(),0==xself.isLeader()&&1==xself.isInTeam()&&1==i.inOneKeyDaily&&o.closePlayerAnimation(),0!=r){if(o.updateMercenaryHpMP(),e.getBoolean())if(e.getByte()==Battle.PK){var f,I=e.getInt(),A=e.getInt();null!=(f=xself)&&(f.Pkwincount=I,f.Pklosecount=A)}else t.parseBattleNormalReward(e,!0),t.processMissionNPCStatus(e);if(0==e.getBoolean())null!=(f=xself)&&(f.power=-1);if(0==e.getBoolean())null!=(f=xself)&&(f.countrypowerValue=0);t.processMyMercenaryCheck(e),xworld.handleMyPlayerDurability(!1,!0),f.checkHPMP(),PanelManager.mainMenu.headInfoView.update()}}}},t.processMissionNPCStatus=function(t){for(var e=t.getByte(),n=0;e>n;n++){var i=t.getByte(),o=t.getByte(),a=xworld.getNpcByID(i,!1);null!=a&&a.setSign(o)}GameWorld.checkNPCRelaMissions(!1)},t.parseBattleNormalReward=function(e,n){void 0===n&&(n=!1);var i=xself;if(null!=i){var o=new StringBuffer,a=e.getInt();n&&(xworld.remoteBattleMoney=a),PanelManager.battleResultPanel&&PanelManager.battleResultPanel.parent&&PanelManager.battleResultPanel.setMoneyReward(a),a>0&&(i.addValue(ModelConst.MONEY3,a),o.append(PowerString.makeColorString(GameText.STR_CU+" ",ColorUtils.COLOR_YELLOW)+a+"    ")),t.processUpLevelMsg(e,i,o,n);var r=e.getBoolean();e.getBoolean()&&t.parsePetReward(e,xself.getPet(),o);var s=e.getByte();if(s>0){for(var l=0,_=new Array(s),h=new Array(s),u=0;s>u;u++)_[u]=e.getShort(),h[u]=e.getByte(),l+=h[u];i.updateAllKillMission(_,h,null),l>0&&i.addValue(ModelConst.KILL_COUNT,l),PanelManager.updateWorldTaskTarget()}if(e.getBoolean()){var c=GameWorld.getEscort(),T=e.getByte();T==Escort.NEWESCORT?NewEscort.processEscrotRefreshPosMsg(e,c):T==Escort.OLDESCORT&&Escort.processEscrotRefreshPosMsg(e,c),t.processEscortEventReword(e)}var p=t.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_BATTLE_REWARD);o.append(p),t.processAfterBattlePoint(i,o,r),GameWorld.battleRewardMessage=o.toString()}},t.processAfterBattlePoint=function(t,e,n){if(null!=t&&null!=e){if(n){var i=PowerString.makeColorString("背包已满，无法获得物品",ColorUtils.COLOR_RED);WorldMessage.addPromptMsg(i),OneKeyDailyMission.isDoingOnekeyMission&&AutoSell.autoSell_onekeyDailyMission()}else if(t.bag.countFreePos()<6){i=PowerString.makeColorString("背包将满，请尽快清理",ColorUtils.COLOR_RED);WorldMessage.addPromptMsg(i)}var o=t.get(ModelConst.HP);if(0>=o||t.get(ModelConst.HPMAX)/o>4){i=PowerString.makeColorString(GameText.STR_HP_UNDER_QUARTER,ColorUtils.COLOR_RED);WorldMessage.addPromptMsg(i)}}},t.processEscortEventReword=function(e){var n=xself;if(null!=n){var i=n.bag;if(null!=i)if(e.getByte()>=0){var o=new StringBuffer,a=e.getString();0==Tool.isNullText(a)&&o.append(a+"\n");var r=e.getShort();if(r>=0){var s=e.getInt(),l=e.getByte(),_=i.getItem(r);null==_?WorldMessage.addSystemChat("押镖物品扣除错误： bagItem is null, pos = "+r):_.id!=s&&WorldMessage.addSystemChat("押镖物品扣除错误： "+s+"!="+_.id),i.removeBagItemByPos(r,l)}var h=e.getShort();if(h>0){var u=e.getShort();1==Define.processWorldPower(n,h,u)?o.append(Define.getPowerDesc(h,u)+"\n"):(n.addFightPower(h,u),o.append(Tool.manageString(GameText.STR_GET_BUFFER_INFO,Define.getPowerDesc(h,u))))}n.checkHPMP();var c=e.getInt(),T=e.getInt();if(n.hp=c,n.mp=T,n.setMoneyByType(ModelConst.MONEY1,e.getInt()),n.setMoneyByType(ModelConst.MONEY2,e.getInt()),n.setMoneyByType(ModelConst.MONEY3,e.getInt()),1==e.getBoolean()){var p=t.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_BATTLE_REWARD);o.append(p)}0==Tool.isNullText(o.toString())&&null!=GameWorld.getEscort()&&GameWorld.getEscort().setBattleMsg(o.toString())}}},t.processUpLevelMsg=function(t,e,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!1),null!=t&&null!=e){var o=new StringBuffer,a=t.getInt();i&&(xworld.remoteBattleExp=a),a>0&&(e.addValue(ModelConst.EXP,a),o.append(Tool.manageString(GameText.STR_UPDATE_LV_EXP,a+"")));var r=t.getByte();if(r>0){e.addValue(ModelConst.LEVEL,r);var s=t.getInt(),l=t.getInt();e.addValue(ModelConst.SET_EXP,s),e.addValue(ModelConst.SET_EXPMAX,l);var _=t.getShort();_>0&&e.addValue(ModelConst.SP,_);var h=t.getByte();h>0&&(e.addValue(ModelConst.CP,h),e.setTabStatus(!0,Model.ATTR_NEW_NOTICE)),xchannel==Define.CHANNEL_YIJIE&&Sdk.xsdk.statistic("levelup")}PanelManager.battleResultPanel&&PanelManager.battleResultPanel.parent&&PanelManager.battleResultPanel.setExpReward(a);var u=t.getInt();u>0&&(e.addValue(ModelConst.EXP2,u),o.append(Tool.manageString(GameText.STR_UPDATE_LV_EXP2,u+"")));var c=t.getByte();if(c>0){o.append(Tool.manageString(GameText.STR_CONG_UPDATE_LV2,c+"")),e.addValue(ModelConst.LEVEL2,c);var T=t.getInt(),p=t.getInt();e.addValue(ModelConst.SET_EXP2,T),e.addValue(ModelConst.SET_EXPMAX2,p)}if((r>0||c>0)&&(xworld.setLevelUPEffect(),e.resumeHPMP(),PanelManager.mainMenu.updateRoleProgress(),PanelManager.mainMenu.updateRoleLevel(),GameWorld.useGuide&&GuideHandler.checkRoleLevelGuide(),0==xmicro&&0==MicroPanel.openMicroPanelForwardly)){var d=xself.getLevel();(14==d||23==d||33==d)&&PanelManager.openMicroPanel()}return null!=n&&n.append(o.toString()),0!=a?a:u}},t.prototype.processJumpCityMsg=function(t){var e=t.getByte();return 0!=e?void(-2==e?PanelManager.closeScene(!0):AlertPanel.errorMessage(t.getString())):void this.processDataBlockFlagMsg(t)},t.prototype.processDataBlockFlagMsg=function(e){var n=e.getInt(),i=n;(Define.isAllocateMirrorMap(n)||Define.isAllocateCityMap(n)||Define.isAllocateCountryMap(n))&&(i=e.getShort()),xworld.orgMapID=i;var o=xself,a=e.getByte(),r=e.getByte(),s=e.getInt(),l=0!=(s&Define.DATA_PLAYER_DETAIL);0!=(s&Define.DATA_MAP_NORMAL)&&(xworld.isJumpingMap=!0,o.setPosition(a,r));for(var _=0;_<Define.DATA_END;_++){var h=s&1<<_;if(0!=h)switch(h){case Define.DATA_PLAYER_DETAIL:this.processDataPlayerDetail(e,o);break;case Define.DATA_PLAYER_MISSION_BYTE:var u=e.getXytes(),c=u.size,T=u.data;o.missionStatus=[];for(var p=0;c>p;p++)o.missionStatus[p]=T.readByte();break;case Define.DATA_PLAYER_MISSION:t.processDataPlayerMission(e,o);break;case Define.DATA_PLAYER_ITEM:var d=o.bag;null==d?(d=new PlayerBag(o),o.setBag(d)):d.clearEquipAndBagItem();var E=t.processDataPlayerItemMsg(e);d.initBagItem(E);break;case Define.DATA_PLAYER_SKILL:var g=t.processDataPlayerSkillMsg(e,!0);o.skillList=g;break;case Define.DATA_PLAYER_LIST_BASE:this.otherPlayersHandler(e);break;case Define.DATA_PLAYER_LIST_EXTRA:break;case Define.DATA_MAP_NORMAL:case Define.DATA_MAP_MINI:this.mapDataHandler(e,n,i,l);break;case Define.DATA_NPC_BASE:this.npcDataHandler(e);break;case Define.DATA_MONSTER_GROUP:t.processDataMonsterGroupMsg(e);break;case Define.DATA_MONSTER_MODEL:t.processDataMonsterMsg(e)&&t.processDataMonsterAIMsg(e);break;case Define.DATA_GUILD_MAP:var S=e.getString();null!=(m=xworld.gameMap)&&null!=S&&(m.setup.name=S,xworld.gameMap.updateSmallMapName()),GameWorld.cityDegree=e.getInt(),GameWorld.cityArmy=e.getInt();break;case Define.DATA_CITY:GameWorld.cityMasterId=e.getInt();var m,f=e.getString();GameWorld.cityDegree=e.getInt(),GameWorld.cityArmy=e.getInt(),GameWorld.cityScale=e.getByte(),GameWorld.cityLevel=e.getByte(),(m=xworld.gameMap)&&f&&(m.setup.name=f,xworld.gameMap.updateSmallMapName());break;case Define.DATA_NOTICE:var I=e.getString();GameNotice.serverNotice=I;break;case Define.DATA_FORMATION:var A=Skill.doGetFormation(e),y=e.getBoolean(),R=o.getPet();y?(o.formationSkill=Skill.fromByteFormationSkill(e),R&&(R.formationSkill=o.formationSkill)):(o.formationSkill=null,R&&(R.formationSkill=null)),o.formationList=A;break;case Define.DATA_MASTER_INFO:break;case Define.DATA_TURN_MONSTER:e.getBoolean()&&PlayerTurnMonster.doChangeTurnMonsterPush(e)}}},t.prototype.processDataPlayerDetail=function(t,e){null==e&&(e=new Player),e.clearData(),Player.fromBytes(t,e);var n=MyPet.fromBytesMyPlayer(t,e);e.setPet(n);for(var i=t.getByte(),o=0;i>o;o++){var a=Mercenary.fromBytesFull(t);e.addMercenary(a)}1==t.getBoolean()&&e.setTabStatus(!0,Model.MAIL_NEW_NOTICE),e.refreshPlayerAllSprite(),PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updateWorldIconPoint()},t.processDataPlayerMission=function(t,e){if(null!=e){e.missionList=[];for(var n,i=t.getByte(),o=0;i>o;o++)n=Mission.fromBytes(t.getBytes()),e.addMission(n)}},t.processDataPlayerItemMsg=function(e,n){return void 0===n&&(n=null),(n=null==n?xself:n).bag.bagEnd=e.getInt(),n.bag.nextTime=e.getLong().value,n.bag.countOfMoneyOpen=e.getInt(),n.bag.countOfTimeOpen=e.getInt(),n.bag.calculateBagCount(),t.processDataPlayerItemMsg2(e)},t.processDataPlayerItemMsg2=function(t){for(var e=t.getShort(),n=[],i=0;e>i;i++){var o=ItemData.fromBytes(t);n.push(o)}return n},t.processDataPlayerSkillMsg=function(t,e){for(var n=t.getShort(),i=[],o=0;n>o;o++){var a=Skill.fromBytes(t);e&&(a.addLevel=t.getByte()),i.push(a)}return i},t.processDataPlayerListBase=function(t,e){if(null==e)return null;Model.fromBytes(t,e);var n=MyPet.fromBytesOtherPlayer(t,e);e.setPet(n);for(var i=t.getByte(),o=0;i>o;o++){var a=Mercenary.fromBytesSimple(t);e.addMercenary(a)}return e.setRemark(t.getString()),e.setEnchantValue(t.getInt()),e.setIconpet1(t.getShort()),e},t.handlePlayerListBase=function(t){if(null!=t){for(var e={},n=0;n<t.length;n++){if(null!=(a=t[n])){var i=xworld.getModel(a.getId());if(i){a.sprite=i.sprite;var o=null;null!=i.getPet()&&null!=a.getPet()&&(null!=(o=i.getPet().getPlayerSprite())&&i.getPet().getIcon1()==a.getPet().getIcon1()&&(a.getPet().setPlayerSprite(o),a.getPet().setSpriteRotateByDir()))}e[a.getId()]=a}}xworld.otherModels=e;for(n=0;n<t.length;n++){var a;null!=(a=t[n])&&(null!=a.getPet()&&a.getPet().refreshWorldSprite(),a.refreshWorldSprite())}if(null!=xworld.gameMap&&null!=xworld.gameMap.playerLayer){var r=xworld.gameMap.playerLayer;for(var s in xworld.otherModels){var l=xworld.otherModels[s];r.addChild(l),l.getPet()&&r.addChild(l.getPet())}}}},t.processDataTeamMsg=function(t){for(var e=t.getShort(),n=xself.getId(),i=0;e>i;i++)for(var o=t.getInt(),a=xworld.getModel(o),r=t.getByte(),s=0;r>s;s++){var l=t.getInt(),_=xworld.getModel(l);a&&(a.addMember(_),(o==n||l==n)&&!0)}xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn()},t.processDataMonsterGroupMsg=function(t){for(var e=t.getByte(),n=0;e>n;n++){var i=MonsterGroup.fromBytes(t);null!=i&&xworld.addMonsterGroup(i)}},t.processDataMonsterMsg=function(t){var e=t.getByte();if(0>=e)return!1;for(var n=0;e>n;n++)xworld.addMonster(Monster.fromMonsterBytes(new Monster,t));return!0},t.processGetSuitInfoMsg=function(t){for(var e=t.getByte(),n=0;e>n;n++){for(var i=t.getUnsignedByte(),o=t.getByte(),a=new Array(4*o),r=0,s=0;o>s;s++)a[r++]=t.getByte(),a[r++]=t.getUnsignedByte(),a[r++]=t.getShort(),a[r++]=t.getByte();GameWorld.addSuit(i,a)}},t.processDataMonsterAIMsg=function(t){for(var e=t.getByte(),n=[],i=0;e>i;i++)n.push(Skill.fromBytes(t));var o=t.getByte();for(i=0;o>i;i++){var a=MonsterAI.fromBytes(t,n);if(null!=a){var r=xworld.getMonster(a.id);null!=r&&r.setAI(a)}}},t.prototype.otherPlayersHandler=function(e){for(var n=xself,i=e.getShort(),o=new Array(i),a=0;i>a;a++)o[a]=t.processDataPlayerListBase(e,new Model(3));t.handlePlayerListBase(o),n.clearMember(),t.processDataTeamMsg(e);var r=n.getLeaderID();if(r>0){var s=xworld.getModel(r);null!=s&&s.isTwoPeopleHouse()&&(s.getId(),GameWorld.getPlayerID(),s.refreshWorldSprite())}else n.isTwoPeopleHouse()&&n.refreshWorldSprite()},t.prototype.mapDataHandler=function(e,n,i,o){for(var a=e.getShort(),r=e.position,s=e.dataView(),l=new Array(a),_=0;a>_;_++)l[_]=s.getInt8(r++);e.position=r;var h=e.getString(),u=e.getString(),c=t.parseMapData(l,h,u,i);Main.instance.showLoadingScene(u),e.getByte(),null==xworld.gameMap&&(xworld.gameMap=new GameMap),xworld.gameMap.loaded=!1,xworld.clearNPC();var T=xworld.gameMap;T.mapId=n,T.orgMapId=i,T.create(c),T.load(),xworld.addMyPlayerToGameMap();var p=T.playerLayer;for(var d in xworld.otherModels){var E=xworld.otherModels[d];p.addChild(E),E.getPet()&&p.addChild(E.getPet())}xworld.initMyPlayerSyncPosition();var g=t.createWorldDataMessage(Define.NEW_SCENE_DATA_FLAG,o);nato.Network.sendCmd(g,null,null)},t.prototype.npcDataHandler=function(t){var e,n=t.getShort(),i=t.position,o=t.dataView();if(n>0){for(var a=new Array(n),r=0;n>r;r++)a[r]=o.getInt8(i++);t.position=i,e=GZIP.inflate(a)}xworld.setNPCData(e),TodayEvent.isWaitForCheckNPC?TodayEvent.doAutoFindNPC():AutoFindPath.isWaitForCheckNPC&&AutoFindPath.doAutoFindNPC()},t.parseMapData=function(t,e,n,i){if(0==t.length)return null;if(a=MapManager.instance.find(i))return a;egret.getTimer();var o=GZIP.inflate(t);egret.getTimer();egret.getTimer();var a=new MapSetup;return MapManager.instance.insert(i,a),a.load(o),a.name=e,egret.getTimer(),a},t.createSystemHeartMsg=function(){var t=new nato.Message(ProtocolDefine.CG_SYSTEM_HEART);return t.putShort(GameWorld.getCurMapID()),t},t.createCheckEditionMsg=function(t){var e=new nato.Message(ProtocolDefine.LC_CHECKEDITION);if(e.putShort(xgameid),e.putInt(GameWorld.VERSION),e.putShort(Sdk.channel),e.putByte(0),null!=navigator){var n=navigator.userAgent;e.putString(n)}else e.putString("h5");e.putByte(1);var i=Define.CLIENT_TYPE_JAR;return e.putByte(i),e},t.createUserLoginMsg=function(t,e){var n=new nato.Message(ProtocolDefine.LC_PLAYER_LOGIN);return n.putString(t),n.putString(e),n.putString(""),n.putString(""),n.putByte(0),n.putByte(0),n},t.createAreaLineListMsg=function(){return new nato.Message(ProtocolDefine.LC_GAME_GET_AREA_AND_LINE)},t.createFirstGameServerMsg=function(){var t=new nato.Message(ProtocolDefine.CG_LOGIN_PLAYERCHECK);return t.putLong(GameWorld.ukey),t.putInt(GameWorld.sessionId),t.putByte(Define.LANG_DEFAULT),t.putInt(GameWorld.VERSION),t.putByte(Define.CLIENT_TYPE_JAR),t},t.createPLayerListMsg=function(){return new nato.Message(ProtocolDefine.CG_LOGIN_ACTORLIST)},t.createAddPlayerMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_LOGIN_CREATEACTOR);return e.putByte(t.getSex()),e.putByte(t.getRace()),e.putByte(t.getJob()),e.putInt(t.getIcon1()),e.putInt(t.getIcon2()),e.putInt(t.getIcon3()),e.putString(t.getName()),e},t.createDelPlayerMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_LOGIN_DELETEACTOR);return e.putInt(t),e},t.createDeleteRoleByProtectCodeMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_LOGIN_DELETEACTOR_PASSWD);return n.putInt(t),n.putString(e),n},t.createCancelDelPlayerMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_LOGIN_RECOVERACTOR);return e.putInt(t),e},t.createPlayerEnterMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_LOGIN_ACTORENTER);n.putInt(t),n.putInt(Define.LOGIN_DATA_FLAG),n.putInt(0),n.putString(""),n.putByte(Define.CLIENT_TYPE_JAR),n.putString(e);return n.putString(""),n.putString(""),n},t.createUserRegisterMsg=function(t,e,n,i,o,a){var r=new nato.Message(ProtocolDefine.LC_PLAYER_CREATE);return r.putString(t),r.putString(e),r.putString(""),r.putString(GameWorld.strImgCreate),r.putString(""),r.putString("随机吧"),r.putString("440106198001018491"),r.putInt(0),r},t.createWorldDataReflashMsg=function(){var e=Define.REFRESH_DATA_FLAG;(null==xworld.npcList||0==xworld.npcList.length)&&(e|=Define.DATA_NPC_BASE);var n=t.createWorldDataMessage(e,!0);nato.Network.sendCmd(n,null,null)},t.createWorldDataMessage=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SCENE_WORLDDATA),i=xworld.getCurMapID();return n.putShort(i),n.putBoolean(e),n.putInt(t),n.putByte(0),n.putByte(0),n},t.createJumpCityMessage=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SCENE_GO_CITY);return n.putInt(t),n.putInt(e),n},t.createBrowseCityInfoMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_CITY_INFO);return e.putInt(t),e},t.createMoveMessage=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SCENE_PLAYER_MOVING);return n.putByte(t),n.putByte(e),n},t.createOtherMoveMessage=function(){return new nato.Message(ProtocolDefine.CG_SCENE_GET_OTHER_PLAYER_STATE)},t.createEnterLocalBattle=function(){return new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_LOCALBATTEL)},t.createEnterRemoteBattle=function(t){var e=new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_REMOTEBATTLE);return e.putShort(t),e},t.createFightSeeInterMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_FIGHT_SEE_IN);return e.putInt(t),e},t.createFightSeeQuitMsg=function(){return new nato.Message(ProtocolDefine.CG_FIGHT_SEE_OUT)},t.createBattlePlan=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_FIGHT_BATTLE_DOPLAN);return i.putByte(t),i.putBytes(e),null==n?i.putBoolean(!1):(i.putBoolean(!0),i.putBytes(n)),i},t.createBattleUpdate=function(t){var e=new nato.Message(ProtocolDefine.CG_FIGHT_BATTLE_UPDATE);return e.putByte(t),e},t.createAutoSkillMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_SKILL_AUTO_ACTIVE);0==n&&i.setType(ProtocolDefine.CG_SKILL_AUTO_INVALID);var o=Define.SKILL_TYPE_PLAYER;return null!=t&&4==t.getType()&&(o=Define.SKILL_TYPE_PET),i.putByte(o),i.putInt(e),i},t.createJumpMapMessage=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_SCENE_GO_MAP);return o.putShort(t),o.putByte(e),o.putByte(n),o.putInt(i),o},t.createPlayerBagMessage=function(t,e,n,i,o,a){if(void 0===o&&(o=!1),void 0===a&&(a=!1),null==n)return null;var r=new nato.Message(ProtocolDefine.CG_ACTOR_PLAYERBAG);return r.putByte(t),r.putByte(e),r.putShort(n.slotPos),e==ProtocolDefine.PLAYERBAG_EQUIP?r.putByte(i):e==ProtocolDefine.PLAYERBAG_LOSE?r.putInt(n.id):(e==ProtocolDefine.PLAYERBAG_ENCHASE||n.isPetCanUseItem())&&r.putShort(i),r.putBoolean(o),r.putBoolean(a),r},t.createIdentifyAsk=function(t,e,n,i,o,a){var r=new nato.Message(ProtocolDefine.CG_BAG_CHECKUP_ASK);return r.putByte(t),r.putShort(e),r.putInt(n),r.putBoolean(i),r.putBoolean(o),r.putInt(a),r},t.createBagRefreshMsg=function(){var t=new nato.Message(ProtocolDefine.CG_BAG_CLEAN);return t.putInt(Define.DATA_PLAYER_ITEM),t},t.prototype.processBagRefreshMsg=function(t){return PanelManager.closeWaitForServer(),0!=t.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString()):(this.processDataBlockFlagMsg(t),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),void(PanelManager.isPanelShow(StorePanel)&&PanelManager.getPanel(StorePanel).updateBag()))},t.createItemShopSell=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_ITEMSHOP_SELL);return o.putShort(t),o.putInt(e),o.putShort(n),o.putByte(i),o},t.doAutoEquipUpdatedata=function(e){if(null!=e){var n=xself;if(null!=n){var i=n.bag;null==i?(i=new PlayerBag(n),n.setBag(i)):i.clearEquipAndBagItem();var o;o=t.processDataPlayerItemMsg(e),i.initBagItem(o),n.skillList=t.processDataPlayerSkillMsg(e,!0),n.fromItemSetData(e),n.fromAutoEquipSkillData(e),n.setIcon1(e.getInt()),n.setIcon2(e.getInt()),n.setIcon3(e.getInt()),n.refreshWorldSprite(),n.checkHPMP(),PanelManager.mainMenu.headInfoView.update(),xself.checkPower()}}},t.prototype.processUpLevelMsg=function(t,e,n){if(null!=t&&null!=e){var i=t.getInt();i>0&&(e.addValue(ModelConst.EXP,i),n.append(Tool.manageString(GameText.STR_UPDATE_LV_EXP,i+"")));var o=t.getByte();if(o>0){n.append(Tool.manageString(GameText.STR_CONG_UPDATE_LV,o+"")),e.addValue(ModelConst.LEVEL,o);var a=t.getInt(),r=t.getInt();e.addValue(ModelConst.SET_EXP,a),e.addValue(ModelConst.SET_EXPMAX,r);var s=t.getShort();s>0&&(e.addValue(ModelConst.SP,s),null!=n&&n.append(PowerString.makeColorString(GameText.STR_SP_POINT,ColorUtils.COLOR_YELLOW)+s+"\n"));var l=t.getByte();l>0&&(e.addValue(ModelConst.CP,l),null!=n&&n.append(PowerString.makeColorString(GameText.STR_CP_POINT,ColorUtils.COLOR_YELLOW)+l+"\n"),e.setTabStatus(!0,Model.ATTR_NEW_NOTICE))}var _=t.getInt();_>0&&(e.addValue(ModelConst.EXP2,_),n.append(Tool.manageString(GameText.STR_UPDATE_LV_EXP2,_+"")));var h=t.getByte();if(h>0){n.append(Tool.manageString(GameText.STR_CONG_UPDATE_LV2,h+"")),e.addValue(ModelConst.LEVEL2,h);var u=t.getInt(),c=t.getInt();e.addValue(ModelConst.SET_EXP2,u),e.addValue(ModelConst.SET_EXPMAX2,c)}if(o>0||h>0){e.resumeHPMP();var T=PanelManager.getPanel(RoleScene,!1);T&&T.stage&&T.updateTab(),PanelManager.updateWorldIconPoint()}}},t.processAddItemMsg=function(t,e){void 0===e&&(e=-1);var n=xself;if(null==n)return"";var i=n.bag;if(null==i)return"";for(var o=t.getByte(),a=null,r=0,s=new StringBuffer,l=0;o>l;l++){var _=t.getByte();if(r=t.getByte(),1==_){var h=255&t.getByte();a=ItemData.fromBytes(t),n.bag.addItem(PlayerBag.TYPE_BAG_POS,a,r),a.slotPos}else if(2==_){t.getInt(),h=255&t.getByte();null!=(a=i.getItem(h))&&(a.quantity+=r),null==a||(a.quantity,a.stackNum,a.id)}r>0&&null!=a&&null!=s&&(s.append(a.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+r),e==ProtocolDefine.ADD_ITEM_BATTLE_REWARD&&(n.getMissionHaveItemDesc(a.id,s),PanelManager.battleResultPanel&&PanelManager.battleResultPanel.addItemReward(a,r),xself.isHaveCollectItemMission()&&PanelManager.updateWorldTaskTarget()),e==ProtocolDefine.ADD_ITEM_USE_REWARD&&a.isPetType()&&s.append("\n"+GameText.STR_CONG_GET_NEW_PET)),l!=o-1&&s.append("\n"),PlayerBag.checkServerEquip(a),xworld.addEquipChange(a)}return s.toString()},t.prototype.processPushOnlineRewardInfo=function(t){OnlineReward.doPushOnLineReWardInfo(t)},t.createGetMissionDataMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_GETMISSIONDATA);e.putShort(t);var n=new Array,i=0,o=xworld.monsterGroupList;for(var a in o)n[i]=parseInt(a),i++;e.putByte(n.length);for(var r=0;r<n.length;r++)e.putShort(n[r]);var s=new Array;i=0;var l=xworld.monsterList;for(var a in l)s[i]=parseInt(a),i++;e.putByte(s.length);for(r=0;r<s.length;r++)e.putShort(s[r]);return e},t.createGetNPCData=function(t){var e=new nato.Message(ProtocolDefine.CG_SCENE_GETNPC);if(null==t)e.putByte(0);else{e.putByte(t.length);for(var n=0;n<t.length;n++)e.putByte(t[n])}return e},t.createTaskAcceptMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TASK_ACCEPT);return n.putShort(t),n.putShort(e),n},t.createTaskDeliverMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_TASK_DELIVER);return i.putShort(t),i.putShort(e),i.putInt(n),i},t.createTaskAbandonMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_ABANDON);return e.putShort(t),e},t.processMissionTeamDeliver=function(e){var n=xself;if(null!=n){var i=e.getShort();if(!(0>i)){t.processMissionNPCStatus(e),t.processMissionReward(n,i,e);var o=n.getMissionById(i);if(null!=o){var a=Tool.manageString(GameText.STR_TEAM_MISSION_TO_MEM,o.name),r=Tool.manageString(a,o.dialogStartFinish);WorldMessage.addSystemChat(r),ChatMsg.addChatMsg(new ChatMsg(Define.CHAT_TYPE_SYSTEM,-1,"",r,0),!1),n.deleteMission(o)}GameWorld.checkNPCRelaMissions(!1),n.isMember()&&AlertPanel.alertCommon(GameText.STR_MEMBER_MAIL_TASK)}}},t.processMissionTeamMemberAccept=function(e){console.log("队员接受任务",e);var n=xself;if(null!=n){if(t.processMissionNPCStatus(e),1==e.getBoolean()){var i=e.getShort();if(0>i)return;t.processMissionReward(n,i,e)}else{var o=e.getBytes(),a=Mission.fromBytes(o);n.addMission(a);var r=Tool.manageString(GameText.STR_TEAM_ACCEPT_MISSION_TO_MEM,a.name);r=Tool.manageString(r,a.desc),WorldMessage.addSystemChat(r),ChatMsg.addChatMsg(new ChatMsg(Define.CHAT_TYPE_SYSTEM,-1,"",r,0),!1)}GameWorld.checkNPCRelaMissions(!1)}},t.processMissionReward=function(e,n,i,o){if(void 0===o&&(o=!0),null==e)return"";var a=e.bag;if(null==a)return"";1==i.getBoolean()&&Mission.finishMission(e,n);var r=i.getShort(),s=i.getInt(),l=i.getInt();r>0&&e.addValue(ModelConst.MONEY1,-r),s>0&&e.addValue(ModelConst.MONEY2,-s),l>0&&e.addValue(ModelConst.MONEY3,-l);var _=new StringBuffer,h=i.getInt();h>0&&(e.addValue(ModelConst.MONEY2,h),_.append(PowerString.makeColorString(GameText.getMoneyText(ModelConst.MONEY2)+" +"+h,ColorUtils.COLOR_YELLOW)+"\n"));var u=i.getInt();u>0&&(e.addValue(ModelConst.MONEY3,u),_.append(PowerString.makeColorString(GameText.getMoneyText(ModelConst.MONEY3)+" +"+u,ColorUtils.COLOR_YELLOW)+"\n")),this.processUpLevelMsg(i,e,_),1==i.getBoolean()&&this.parsePetReward(i,xself.getPet(),_);for(var c=i.getByte(),T=0;c>T;T++){var p=i.getInt(),d=i.getUnsignedByte(),E=i.getByte(),g=a.getItem(d);null==g?WorldMessage.addSystemChat("任务物品扣除错误： bagItem is null, pos = "+d):g.id!=p&&WorldMessage.addSystemChat("任务物品扣除错误： "+p+"!="+g.id),a.removeBagItemByPos(d,E)}if(1==(this.processAddItemMsg(i,ProtocolDefine.ADD_ITEM_MISSION_REWARD),i.getBoolean())&&e.getId()==GameWorld.cityMasterId){var S=t.createWorldDataMessage(Define.SIMPLE_FLASH_DATA_FLAG,!0);nato.Network.sendCmd(S)}if(i.getBoolean()){var m=i.getInt();m>0&&_.append(Tool.manageString(GameText.STR_MISSION_REWARD_HONOR2,m+""));var f=i.getShort();f>0&&(GameWorld.cityDegree+=f,_.append(Tool.manageString(GameText.STR_MISSION_REWARD_CITY_PRO,f+"")));var I=i.getShort();I>0&&(GameWorld.cityArmy+=I,_.append(Tool.manageString(GameText.STR_MISSION_REWARD_CITY_ARMY2,I+"")));var A=i.getShort();A>0&&_.append(Tool.manageString(GameText.STR_MISSION_REWARD_COUNTRY_LAND2,A+""));var y=i.getShort(),R=i.getShort();if(y>0){var P="";R>0&&(P=PowerString.makeColorString("+"+R,ColorUtils.COLOR_GREEN)),_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_PROSPERITY,y+P))}var C=i.getShort();C>0&&_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_PEOPLE,C+""));var M=i.getShort();M>0&&_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_WOOD,M+""));var L=i.getShort();L>0&&_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_STONE,L+""));var v=i.getShort();v>0&&_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_IRON,v+""));var O=i.getShort();O>0&&_.append(Tool.manageString(GameText.STR_MISSION_COUNTRY_ARMY,O+""))}var N=_.toString();o&&WorldMessage.addTips(N);var D=PanelManager.getPanel(RoleScene,!1);return D&&D.stage&&D.updateTab(),N},t.parsePetReward=function(t,e,n){var i=t.getInt();null!=n&&i>0&&n.append(PowerString.makeColorString(GameText.STR_PET_EXP_ADD+i,ColorUtils.COLOR_YELLOW)+"\n"),null!=e&&e.addValue(ModelConst.EXP,i);var o=t.getByte();if(o>0){var a=t.getShort(),r=t.getByte();null!=n&&r>0&&n.append(PowerString.makeColorString(GameText.STR_PET_GROW_LV,ColorUtils.COLOR_YELLOW)+" +"+r+"\n");var s=0,l=0,_=0,h=0,u=0;r>0&&(s=t.getShort(),l=t.getShort(),_=t.getShort(),h=t.getShort(),u=t.getShort());for(var c=t.getInt(),T=t.getInt(),p=t.getByte(),d=t.getByte(),E=[],g=0;d>g;g++)E.push(Skill.fromBytes(t));if(null!=e){e.addValue(ModelConst.LEVEL,o),e.addValue(ModelConst.SP,a),e.addValue(ModelConst.PET_GROW_LEVEL,r),e.addValue(ModelConst.STR,s),e.addValue(ModelConst.CON,l),e.addValue(ModelConst.AGI,_),e.addValue(ModelConst.ILT,h),e.addValue(ModelConst.WIS,u),e.addValue(ModelConst.SET_EXP,c),e.addValue(ModelConst.SET_EXPMAX,T),e.cp=p;for(g=0;g<E.length;g++){var S=E[g];null!=S&&e.learnSkill(S)}e.resumeHPMP()}}var m=PanelManager.getPanel(PetDetailScene,!1);m&&m.detailPanel&&m.detailPanel.update(e)},t.createAutoMoveMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SCENE_FINDPATH_MISSION);return n.putByte(1),n.putShort(t),n.putByte(e),n},t.createAutoMoveMsgByMisssion=function(t){GameWorld.curMissionID=t;var e=new nato.Message(ProtocolDefine.CG_SCENE_FINDPATH_MISSION);return e.putByte(2),e.putShort(t),e},t.createWorldMapMsg=function(){return new nato.Message(ProtocolDefine.CG_SCENE_WORLDMAP)},t.createWorldMapListMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SCENE_WORLDMAP_DATA);return e.putInt(t),e},t.createWorldMapEnterMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SCENE_WORLDMAP_ENTER);return e.putInt(t),e.putInt(Define.JUMP_MAP_DATA_FLAG),e},t.createWroldMapVIPEnterMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SCENE_GO_MAP_VIP);return e.putInt(t),e.putInt(Define.JUMP_MAP_DATA_FLAG),e},t.createAttrAddMessage=function(t){if(null==t)return null;var e=new nato.Message(ProtocolDefine.CG_ACTOR_ADDATTRIBUTE),n=t.length;e.putByte(n);for(var i=0;n>i;i++){var o=t[i];null!=o&&(e.putShort(o[0]),e.putInt(o[1]))}return e},t.createBrowseSkillShop=function(t){var e=new nato.Message(ProtocolDefine.CG_SKILL_SHOP_LIST);return e.putShort(t),e},t.createDropSkill=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SKILL_DELETE);return n.putInt(t),n.putByte(e),n},t.createDropSkillOneLevel=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SKILL_DELETE_BY_LEVEL);return n.putInt(t),n.putByte(e),n},t.createLearnSkill=function(t,e){if(null==e)return null;var n=Define.isCountrySkillShop(t),i=new nato.Message(ProtocolDefine.CG_SKILL_SHOP_LEARN);return i.putShort(t),i.putInt(e.id),i.putByte(e.level),i.putBoolean(n),1==n&&(i.putInt(e.money1),i.putInt(e.money2),i.putInt(e.money3)),i},t.updatePlayerSkill=function(t){Skill.updatePlayerSkill(t)},t.processChatMessageReceive=function(t){for(var e=255&t.getByte(),n=0;e>n;n++){var i=t.getInt(),o=t.getString(),a=0,r=t.getShort();(Tool.isBit(ChatMsg.FLAG_VIP,r)||Tool.isBit(ChatMsg.FLAG_VIP_CQ,r))&&(a=t.getByte());var s=t.getString(),l=t.getString(),_=Define.CHAT_TYPE_WORLD,h=t.getType(),u=null;switch(h){case ProtocolDefine.CG_CHAT_DOWN_WORLD:Tool.isBit(ChatMsg.FLAG_TITEL,r)?(_=Define.CHAT_TYPE_NOTHING,o=""):_=Define.CHAT_TYPE_WORLD;break;case ProtocolDefine.CG_CHAT_DOWN_MAP:_=Define.CHAT_TYPE_MAP,null!=(u=xworld.getModel(i))&&(o=u.getName());break;case ProtocolDefine.CG_CHAT_DOWN_COUNTRY:_=Define.CHAT_TYPE_COUNTRY;break;case ProtocolDefine.CG_CHAT_DOWN_SERVERS:_=Define.CHAT_TYPE_SERVER;break;case ProtocolDefine.CG_CHAT_DOWN_TEAM:_=Define.CHAT_TYPE_TEAM,null!=(u=xworld.getModel(i))&&(o=u.getName());break;case ProtocolDefine.CG_CHAT_DOWN_PRIVATE:if(_=Define.CHAT_TYPE_PRIVATE,i!=GameWorld.getPlayerID()){if(1!=i){var c=new Model(3);c.setId(i),c.setName(o),c.setVipLevel(a),c.setRemark(l),ChatMsg.addTempTalkModel(c)}if(0==Tool.isBit(ChatMsg.FLAG_PRIVATE_TARGET,r))if(null==(d=PanelManager.getPanel(ChatScene,!1))||0==d.isChannelShow(Define.CHAT_TYPE_PRIVATE)){xself&&xself.setTabStatus(!0,Model.CHAT_NEW_NOTICE),PanelManager.updateWorldIconPoint()}}break;case ProtocolDefine.CG_CHAT_DOWN_SYSTEM:_=Define.CHAT_TYPE_SYSTEM;break;case ProtocolDefine.CG_CHAT_DOWN_UNION:_=Define.CHAT_TYPE_UNION}var T=new ChatMsg(_,i,o,s,a,r,l);if(Tool.isBit(ChatMsg.FLAG_ITEM,r)){T.itemIDList=new Array(t.getByte());for(var p=0;p<T.itemIDList.length;p++)T.itemIDList[p]=t.getUnsignedByte()}if(Tool.isBit(ChatMsg.FLAG_MISSION,r)){T.missionIDList=new Array(t.getByte());for(p=0;p<T.missionIDList.length;p++)T.missionIDList[p]=t.getShort()}if(Tool.isBit(ChatMsg.FLAG_COUNTRY,r)&&(T.countryID=t.getInt()),_==Define.CHAT_TYPE_SYSTEM)if(-1!=s.indexOf("图鉴"))return;var d=PanelManager.getPanel(ChatScene,!1);Tool.isBit(ChatMsg.FLAG_WAR_END,r)?(WorldMessage.addNoticeMsg(T.getFullText()),ChatMsg.addChatMsg(T,!1)):h==ProtocolDefine.CG_CHAT_DOWN_TEAM?(d&&d.isChannelShow(Define.CHAT_TYPE_TEAM)||WorldMessage.addPromptMsg(T.getFullText()),ChatMsg.addChatMsg(T,!1)):h==ProtocolDefine.CG_CHAT_DOWN_PRIVATE?(d&&d.isChannelShow(Define.CHAT_TYPE_PRIVATE)||WorldMessage.addPromptMsg(T.getFullText()),ChatMsg.addChatMsg(T,!1)):ChatMsg.addChatMsg(T)}},t.processServerChatMessageReceive=function(t){for(var e=255&t.getByte(),n=0;e>n;n++){var i=t.getString(),o=t.getInt(),a=t.getString(),r=t.getString(),s=t.getString(),l=t.getShort(),_=0;(Tool.isBit(ChatMsg.FLAG_VIP,l)||Tool.isBit(ChatMsg.FLAG_VIP_CQ,l))&&(_=t.getByte());var h=new ChatMsg(Define.CHAT_TYPE_SERVER,o,a,r,_,l,s);h.serverName=i,ChatMsg.addChatMsg(h)}},t.createChatMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_CHAT_SUBMIT);return i.putByte(t),i.putString(e),t==Define.CHAT_TYPE_PRIVATE&&i.putInt(n),i},t.processChatSubmit=function(t){var e=t.getShort();if(null!=xself){var n=xself.bag;if(null!=n&&0!=n.isValidBagPos(e)){var i=n.getItem(e);null!=i&&i.id==Define.ITEM_ID_SPEAK&&n.removeBagItemByPos(e,1)}}},t.processShowTextMsg=function(t){var e=t.getByte(),n=t.getString();e==ProtocolDefine.SHOW_TEXT_OPEN?AlertPanel.alertCommon(n):e==ProtocolDefine.SHOW_TEXT_SCROLL?WorldMessage.addNoticeMsg(n):e==ProtocolDefine.SHOW_TEXT_PROMPT?ChatMsg.addChatSystemMsg(n,!0):ChatMsg.addChatSystemMsg(n)},t.createMailListMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_MAIL_LIST);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createMailDetailMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_MAIL_DETAIL);return e.putLong(t),e},t.processMailDetailMsg=function(t){return 0>t.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString()):void 0},t.createMailSendByID=function(e,n){return t.createMailSendMsg(e,ProtocolDefine.MAIL_SEND_ID,n,null,null)},t.createMailSendByName=function(e,n){return t.createMailSendMsg(e,ProtocolDefine.MAIL_SEND_NAME,-1,n,null)},t.createMailSendByUID=function(e,n){return t.createMailSendMsg(e,ProtocolDefine.MAIL_SEND_UID,-1,null,n)},t.createMailSendMsg=function(t,e,n,i,o){if(null==t)return null;var a=new nato.Message(ProtocolDefine.CG_MAIL_SEND);a.putString(t.getContent()),a.putInt(t.money1),a.putInt(t.money2),a.putInt(t.money3),a.putInt(t.reqMoney1),a.putInt(t.reqMoney2),a.putInt(t.reqMoney3);var r=0,s=t.attachItem;if(null!=s&&s.length>0)for(var l=0;l<s.length;l++)null!=s[l]&&r++;if(a.putByte(r),r>0)for(l=0;l<s.length;l++){var _=s[l];null!=_&&(a.putShort(_.slotPos),a.putInt(_.id),a.putByte(_.quantity))}switch(e==ProtocolDefine.MAIL_SEND_UID&&(n=Define.getIdByAreaID(o,xself.getId()),e=ProtocolDefine.MAIL_SEND_ID),a.putByte(e),e){case ProtocolDefine.MAIL_SEND_ID:a.putInt(n);break;case ProtocolDefine.MAIL_SEND_NAME:a.putString(i)}return a},t.processMailNotifyMsg=function(t){t.getLong().value,t.getString(),xself&&xself.setTabStatus(!0,Model.MAIL_NEW_NOTICE),PanelManager.mainMenu&&PanelManager.mainMenu.checkMail(),WorldMessage.addSystemChat("收到新邮件,请查收!")},t.createMailSendGMMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_MAIL_SEND_SERVICE);return n.putByte(t),n.putString(e),n},t.createMailAttachMsg=function(t,e){if(null==t)return null;var n=new nato.Message(ProtocolDefine.CG_MAIL_EXTRACT_ATTACHMENT);return n.putLong(t.id),n.putBoolean(t.isTypeBit(Mail.MAIL_TYPE_BACK)),n.putBoolean(!0),n.putInt(e),n},t.createMailBackMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_MAIL_TURNBACK);return e.putLong(t),e},t.createMailDeleteMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_MAIL_DELETE);return e.putLong(t),e},t.processMailDeleteMsg=function(t){return 0>t.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString()):void 0},t.createMailNewNotice=function(){return new nato.Message(ProtocolDefine.CG_MAIL_OPEN)},t.createMailSeeItem=function(t,e){var n=new nato.Message(ProtocolDefine.CG_MAIL_GETITEMDETAIL);return n.putLong(t),n.putByte(e),n},t.createPetSeeMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_PET_SEE);return e.putShort(t),e},t.createPetInfoMsg=function(e,n){if(null==n)return null;var i=new nato.Message(ProtocolDefine.CG_PET_INFO);i.putByte(e);var o=0,a=0,r=null;switch(e){case t.PET_INFO_PLAYER_SHOP:case t.PET_INFO_CHAT:o=n[0],i.putInt(o),a=n[1],i.putShort(a);break;case t.PET_INFO_GOODS:r=n[0],i.putLong(r);break;case t.PET_INFO_MAIL:r=n[0],i.putLong(r),a=n[1],i.putShort(a);break;case t.PET_INFO_SEE_PLAYER:o=n[0],i.putInt(o)}return i},t.createRelationList=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_RELATION_LIST);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createRelationAddById=function(t,e){return this.createRelationAdd(t,ProtocolDefine.MAIL_SEND_ID,e,null,null)},t.createRelationAddByName=function(t,e){return this.createRelationAdd(t,ProtocolDefine.MAIL_SEND_NAME,-1,e,null)},t.createRelationAddByUid=function(t,e){return this.createRelationAdd(t,ProtocolDefine.MAIL_SEND_UID,-1,null,e)},t.createRelationAdd=function(t,e,n,i,o){var a=new nato.Message(ProtocolDefine.CG_RELATION_ADD);switch(a.putByte(t),a.putByte(e),e){case ProtocolDefine.MAIL_SEND_ID:a.putInt(n);break;case ProtocolDefine.MAIL_SEND_NAME:a.putString(i);break;case ProtocolDefine.MAIL_SEND_UID:a.putString(o)}return a},t.createRelationAddMaster=function(t){var e=new nato.Message(ProtocolDefine.CG_RELATION_MASTER_ADD);return e.putInt(t),e},t.createRelationDelMaster=function(t){var e=new nato.Message(ProtocolDefine.CG_RELATION_MASTER_DELETE);return e.putInt(t),e},t.createPlayerSee=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_SEE);return e.putInt(t),e},t.createGetSuitInfoMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SUIT_GETINFO);if(null==t)e.putByte(0);else{e.putByte(t.length);for(var n=0;n<t.length;n++)e.putByte(t[n])}return e},t.createItemShopListMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_ITEMSHOP_LIST);return e.putShort(t),e},t.createItemShopBuy=function(t,e,n){var i=Define.isCountryShop(t),o=new nato.Message(ProtocolDefine.CG_ITEMSHOP_BUY);return o.putShort(t),o.putInt(e.id),o.putByte(n),o.putBoolean(i),i&&(o.putInt(e.money1),o.putInt(e.money2),o.putInt(e.money3)),o},t.createPlayerShopStartMsg=function(t,e){if(null==e||e.length<0)return null;var n=new nato.Message(ProtocolDefine.CG_PLAYERSHOP_START);n.putString(t);var i=e.length;n.putByte(i);for(var o=0;i>o;o++){var a=e[o];if(null==a)return null;n.putInt(a.id),n.putByte(a.quantity),n.putShort(a.slotPos),n.putInt(a.money1),n.putInt(a.money3)}return n},t.createPlayerEnchantShopStartMsg=function(t,e){if(null==e||e.length<0)return null;var n=xself;if(null==n)return null;for(var i=0,o=0;o<e.length;o++){var a=e[o];if(0==a instanceof ShopItem)return null;null!=(_=a)&&(i+=_.powerValue1*_.quantity)}if(i>n.getEnchantValue())return AlertPanel.alertCommon(GameText2.STR_ENCHANT_START_FAIL),null;var r=new nato.Message(ProtocolDefine.CG_ENCHANTSHOP_START);r.putString(t),r.putInt(n.getEnchantValue()-i);var s=e.length;r.putByte(s);for(var l=0;s>l;l++){var _;if(null==(_=e[l]))return null;r.putInt(_.id),r.putByte(_.quantity),r.putShort(_.slotPos),r.putInt(_.money1),r.putInt(_.money3)}return r},t.createPlayerShopEndMsg=function(){return new nato.Message(ProtocolDefine.CG_PLAYERSHOP_STOP)},t.createPlayerEnchantShopEndMsg=function(){return new nato.Message(ProtocolDefine.CG_ENCHANTSHOP_STOP)},t.createPlayerShopItemListMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_PLAYERSHOP_LIST_GOODS);return e.putInt(t),e},t.createPlayerEnchantShopItemListMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_ENCHANTSHOP_LIST);return e.putInt(t),e},t.createPlayerShopBuyMsg=function(t,e){if(null==e)return null;var n=new nato.Message(ProtocolDefine.CG_PLAYERSHOP_BUY);return n.putInt(t),n.putShort(e.slotPos),n.putByte(e.quantity),n.putInt(e.id),n},t.createPlayerShopRecordMsg=function(){return new nato.Message(ProtocolDefine.CG_PLAYERSHOP_SELLRECORD)},t.createPlayerEnchantShopRecordMsg=function(){return new nato.Message(ProtocolDefine.CG_ENCHANTSHOP_SELLRECORD)},t.createGoodsSellFind=function(t,e,n,i,o,a,r,s){var l=new nato.Message(ProtocolDefine.CG_EXCHANGE_FIND_SELLGOODS);return l.putByte(t),l.putByte(e),l.putByte(n),l.putByte(i),l.putByte(o),l.putString(a),l.putShort(r),l.putInt(s),l},t.createGoodsSellList=function(){return new nato.Message(ProtocolDefine.CG_EXCHANGE_MY_SELLGOODS)},t.createGoodsSellSubmit=function(t,e,n,i){if(null==t)return null;var o=new nato.Message(ProtocolDefine.CG_EXCHANGE_SUBMIT_SELLGOODS);return o.putShort(t.slotPos),o.putByte(e),o.putInt(t.id),o.putInt(n),o.putInt(i),o},t.createGoodsSellRetrieve=function(t){var e=new nato.Message(ProtocolDefine.CG_EXCHANGE_RETRIEVE_SELLGOODS);return e.putLong(t),e},t.createGoodsSellBuy=function(t){var e=new nato.Message(ProtocolDefine.CG_EXCHANGE_BUY_SELLGOODS);return e.putLong(t),e},t.createGoodsPurchaseList=function(t,e,n,i,o,a){var r=new nato.Message(ProtocolDefine.CG_EXCHANGE_FIND_PURCHASEGOODS);return r.putByte(t),r.putInt(e),r.putByte(n),r.putByte(i),r.putShort(o),r.putInt(a),r},t.createGoodsProvideMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_EXCHANGE_PROVIDE_PURCHASEGOODS);return n.putLong(t),n.putShort(e),n},t.createGoodsAutoProvide=function(t,e,n){if(null==t||null==n)return null;var i=new nato.Message(ProtocolDefine.CG_EXCHANGE_AUTOPROVIDE_PURCHASEGOODS);return i.putShort(t.slotPos),i.putByte(e),i.putInt(t.id),i.putInt(n[0]),i.putInt(n[1]),i},t.createGoodsPurchaseMyList=function(){return new nato.Message(ProtocolDefine.CG_EXCHANGE_MY_PURCHASEGOODS)},t.createGoodsPurchaseTypeList=function(t){var e=new nato.Message(ProtocolDefine.CG_EXCHANGE_PURCHASEGOODS_TYPELIST);return e.putByte(t),e},t.createGoodsPurchaseSubmit=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_EXCHANGE_SUBMIT_PURCHASEGOODS);return o.putInt(t),o.putShort(e),o.putInt(n),o.putInt(i),o},t.createGoodsPurchaseCancel=function(t){var e=new nato.Message(ProtocolDefine.CG_EXCHANGE_CANCEL_PURCHASEGOODS);return e.putLong(t),e},t.createGoodsPurchaseGet=function(t){var e=new nato.Message(ProtocolDefine.CG_EXCHANGE_EXTRACT_PURCHASEGOODS);return e.putLong(t),e},t.createPlayerEvent=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SCENE_PLAYER_EVENT);return n.putInt(t),n.putByte(e),n},t.processPlayerEventMsg=function(e){var n=e.getInt(),i=e.getByte(),o=e.getInt(),a=e.getString(),r=(e.getString(),e.getString(),(new Date).getTime(),e.getInt(),GameText.STR_TITLE),s=xworld.getModel(o);switch(i){case Define.PLAYER_EVENT_TEAM_INVITE:if(xself.isNovice)return;if(r=GameText.getText(GameText.TI_INVITE_TEAM),null==s)return;xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this));break;case Define.PLAYER_EVENT_TEAM_APPLY:if(r=GameText.getText(GameText.TI_JOIN_TEAM),null==s)return;xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this));break;case Define.PLAYER_EVENT_PKASK:if(r=GameText.getText(GameText.TI_PK),null==s)return;break;case Define.PLAYER_EVENT_JOINCOUNTRYASK:r=GameText.getText(GameText.TI_INVITE_COUNTRY);break;case Define.PLAYER_EVENT_ESCORT:if(window.autoEscortTools._isStarting)return void window.__escortEmitter__.emit("accept:escort",n);r=GameText.STR_ESCORT_MISSION;break;case Define.PLAYER_EVENT_MASTER:r=GameText.getText(GameText.TI_APPRENTICE);break;case Define.PLAYER_EVENT_JOINCOUNTRYHANDLE:r=GameText.STR_JOINCOUNTRYHANDLE;break;case Define.PLAYER_EVENT_MERRY:r=GameText.STR_PARTNER}i==Define.PLAYER_EVENT_JOINCOUNTRYHANDLE?xself&&(xself.setTabStatus(!0,Model.COUNTRY_APPLY),PanelManager.updateWorldIconPoint()):AlertPanel.alert(r,a,(function(){var e=t.createPlayerEvent(n,ProtocolDefine.PLAYER_EVENT_CHOOSE_YES);nato.Network.sendCmd(e)}),this,(function(){var e=t.createPlayerEvent(n,ProtocolDefine.PLAYER_EVENT_CHOOSE_NO);nato.Network.sendCmd(e)}),PopUpManager.CloseType.NONE)},t.processReqAskMsg=function(t){if(0==t.getByte());else{var e=t.getString();ChatMsg.addChatSystemMsg(e,!0)}},t.processJoinTeamMsg=function(t){var e=t.getInt(),n=t.getInt(),i=xworld.getModel(n);if(null!=i){var o=xworld.getModel(e);if(i.addMember(o)&&Model.isSameTeam(xself,i)){var a=GameWorld.getPlayerID();PanelManager.updateWorldIconPoint(),null!=o?e==a?GameText.getText(GameText.TI_YOU):PowerString.makeColorString(o.getName(),ColorUtils.COLOR_GREEN):GameText.STR_MEMBER,null!=i?n==a?GameText.getText(GameText.TI_YOU):PowerString.makeColorString(i.getName(),ColorUtils.COLOR_GREEN):GameText.STR_LEADER,xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn()}PanelManager.closeScene(!0)}},t.processSceneFindPathAgain=function(t){GameWorld.doAutoMove(t)},t.processCityCountryReflashMsg=function(e){var n=e.getInt();GameWorld.getCurMapID()==n&&(e=t.createWorldDataMessage(Define.SIMPLE_FLASH_DATA_FLAG,!0),nato.Network.sendCmd(e))},t.processDismissTeamMsg=function(t){var e=t.getInt();xworld.dismissTeam(e),xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn()},t.processTeamSetMsg=function(t){return 0!=t.getByte()?void AlertPanel.alertCommon(GameText.getText(GameText.TI_ERROR)+"!"+t.getString()):void 0},t.processChangeLeaderMsg=function(e){var n=e.getInt();xworld.dismissTeam(n),t.processDataTeamMsg(e)},t.processLeaveTeamMsg=function(t){var e=t.getInt(),n=t.getInt(),i=t.getByte(),o=t.getByte(),a=xworld.getModel(e),r=xworld.getModel(n),s=Model.isSameTeam(xself,a);if(null!=a&&a.removeMember(n,3),null!=r&&r.setPosition(i,o),s){var l=GameWorld.getPlayerID();PanelManager.updateWorldIconPoint(),null!=r?n==l?GameText.getText(GameText.TI_YOU):PowerString.makeColorString(r.getName(),ColorUtils.COLOR_GREEN):GameText.STR_MEMBER,null!=a?e==l?GameText.getText(GameText.TI_YOU):PowerString.makeColorString(a.getName(),ColorUtils.COLOR_GREEN):GameText.STR_LEADER,xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn()}},t.processPlayerTrunMonsterNotifyMsg=function(t){var e=t.getInt(),n=t.getShort(),i=xworld.getModel(e);null!=i&&(i.setIconpet1(n),i.refreshWorldSprite())},t.isMessageHaveError=function(t){return null==t||0>t.getByte()&&(AlertPanel.alertCommon(t.getString()),!0)},t.createGetCityMoneyMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_CITY_EXTRACT_MONEY);return e.putInt(t),e},t.createModifyCityNameMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_CITY_CHANGE_NAME);return n.putInt(t),n.putString(e),n},t.createModifyCitySignMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_CITY_CHANGE_SIGN);return n.putInt(t),n.putString(e),n},t.createSetRebornMapMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SCENE_SETREBORNMAP);return e.putShort(t),e},t.createSpecialCodeMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SYSTEM_SPECIALCODE);return e.putString(t),e},t.createStorageListMsg=function(){return new nato.Message(ProtocolDefine.CG_STORAGE_LIST)},t.createVIPStorageListMsg=function(){return new nato.Message(ProtocolDefine.CG_STORAGE_LIST_VIP)},t.createStorageOperateMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_STORAGE_OPER);return n.putByte(t),n.putShort(e),n},t.createVIPStorageOperateMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_STORAGE_OPER_VIP);return n.putByte(t),n.putShort(e),n},t.createTaskOffLineListMsg=function(){return new nato.Message(ProtocolDefine.CG_TASK_OFFLINE_LIST)},t.createTaskOffLineActivateMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_OFFLINE_ACTIVATE);return e.putShort(t),e},t.createItemInfoMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_ITEMTYPE_GETINFO);return e.putInt(t),e},t.createInviteTeamMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TEAM_INVITE);return n.putInt(e),n.putByte(t),n},t.createSetTeamMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TEAM_SET);switch(n.putByte(t),t){case ProtocolDefine.TEAM_SET_AUTO_JOIN:n.putByte(e);break;case ProtocolDefine.TEAM_SET_CHANGE_CAPTAIN:n.putInt(e);break;case ProtocolDefine.TEAM_SET_DISBAND:break;case ProtocolDefine.TEAM_SET_REMOVE_MEMBER:n.putInt(e)}return n},t.createSelfLeaveTeamMsg=function(){return new nato.Message(ProtocolDefine.CG_TEAM_LEAVE_SELF)},t.createCombinShop=function(t){var e=new nato.Message(ProtocolDefine.CG_COMPOSITE_SHOP);return e.putShort(t),e},t.createCombinItem=function(t,e,n,i){if(null==e)return null;var o=e.getPrice(),a=e.getMoneyType(),r=new nato.Message(ProtocolDefine.CG_COMPOSITE_DO);return r.putShort(t),r.putInt(e.id),r.putShort(n),r.putInt(i),r.putByte(a),r.putInt(o),r},t.createCombinConfirm=function(t){var e=new nato.Message(ProtocolDefine.CG_COMPOSITE_CONFIRM);return e.putByte(t),e},t.createIntegralShop=function(t){var e=new nato.Message(ProtocolDefine.CG_ITEMSHOP_LIST_SCORE);return e.putShort(t),e},t.createIntegralBuy=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_ITEMSHOP_BUY_SCORE);return i.putShort(t),i.putInt(e),i.putByte(n),i},t.createMercenaryListMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_SOLDIER_GROUP_LIST);return i.putShort(t),i.putByte(e),i.putShort(n),i},t.processMercenaryListMsg=function(t){},t.createMercenaryInfoMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SOLDIER_GROUP_INFO);return e.putShort(t),e},t.processMercenaryInfoMsg=function(t){return 0>t.getInt()?void AlertPanel.errorMessage(t.getString()):void 0},t.createMercenaryMyInfoMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_SOLDIER_GROUP_MY_INFO);return n.putInt(t),n.putShort(e),n},t.processMercenaryMyInfoMsg=function(t){var e=t.getByte();return 0>e&&AlertPanel.errorMessage(t.getString()),e},t.createMercenaryBuyMsg=function(t,e,n){var i=Define.isCountrySoldierShop(t),o=new nato.Message(ProtocolDefine.CG_SOLDIER_GROUP_BUY);return o.putShort(t),o.putShort(e.groupId),o.putBoolean(n),o.putBoolean(i),1==i&&(o.putInt(e.money1),o.putInt(e.money2),o.putInt(e.money3)),o},t.processMercenaryNotifyMsg=function(t){var e=t.getInt();if(e!=GameWorld.getPlayerID()){var n=xworld.getModel(e);if(null!=n){var i=t.getInt();if(t.getByte()==Mercenary.SOLDIER_STATE_FIGHT){var o=new Mercenary;o.groupId=i,Mercenary.fromBytesSimpleData(t,o),o.setPlayerSprite(o.createSprite(!1)),n.addMercenary(o)}else n.getMercenaryById(i),n.removeMercenary(o)}}},t.createMercenaryMyListMsg=function(){return new nato.Message(ProtocolDefine.CG_SOLDIER_GROUP_MY_LIST_SLEEP)},t.processMercenaryMyListMsg=function(e){t.processMyMercenaryCheck(e)},t.processMyMercenaryCheck=function(t){for(var e=xself,n=t.getByte(),i=0;n>i;i++){var o=(t.getBoolean(),t.getShort());if(t.getString(),e){var a=e.getMercenaryById(o);if(null==a)continue;e.removeMercenary(a)}}},t.createMercenarySetStatusMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_SOLDIER_STATE_SET);return i.putShort(t),i.putBoolean(e),i.putByte(n),i},t.processMercenarySetStatusMsg=function(t){var e=t.getByte();return 0>e&&AlertPanel.errorMessage(t.getString()),e},t.createMercenaryDelMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_SOLDIER_DELETE);return e.putShort(t),e},t.processMercenaryDelMsg=function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void 0},t.createChatSeeItem=function(t,e){var n=new nato.Message(ProtocolDefine.CG_CHAT_SEE_ITEM);if(n.putInt(t),null==e)n.putByte(0);else{n.putByte(e.length);for(var i=0;i<e.length;i++)n.putByte(e[i])}return n},t.createChatSeeMission=function(t,e){var n=new nato.Message(ProtocolDefine.CG_CHAT_SEN_MISSION);if(n.putInt(t),null==e)n.putByte(0);else{n.putByte(e.length);for(var i=0;i<e.length;i++)n.putShort(e[i])}return n},t.createPetChangeName=function(t,e){var n=new nato.Message(ProtocolDefine.CG_PET_CHANGE_NAME);return n.putShort(t),n.putString(e),n},t.processEscortStartMsg=function(t){var e=xself;if(null!=e){null==xworld.gameMap&&(xworld.gameMap=new GameMap),e.setMoneyByType(ModelConst.MONEY1,t.getInt()),e.setMoneyByType(ModelConst.MONEY2,t.getInt()),e.setMoneyByType(ModelConst.MONEY3,t.getInt());var n=t.getByte();Escort.escortType=n;var i=null;if(e.isInTeam()){var o=xworld.getModel(e.getLeaderID());null!=o&&(i=GameSprite.cloneSprite(o.getPlayerSprite()))}null==i&&(i=GameSprite.cloneSprite(e.getPlayerSprite()));var a=null;n==Escort.OLDESCORT?a=Escort.fromBytes(t,i):n==Escort.NEWESCORT&&(a=NewEscort.fromBytes(t,i)),GameWorld.createEscort(a,n)}},t.createEscortMoveMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_MOVE);return n.putByte(t),n.putByte(e),n},t.createEscortRefreshMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_REFURBISH);return e.putShort(t),e},t.createEscortEventMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_CHOICE_EVENT);return e.putShort(t),e},t.createEscortPostQuit=function(){return new nato.Message(ProtocolDefine.CG_TASK_ESCORT_CANCEL)},t.createEscortRobList=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_LIST);return n.putByte(t),n.putShort(e),n},t.createNewEscortRobList=function(t,e){var n=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_NEW_LIST);return n.putByte(t),n.putShort(e),n},t.createEscortRob=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_ESCORT_ROB);return e.putInt(t),e},t.createEscortListPlayer=function(){return new nato.Message(ProtocolDefine.CG_TASK_ESCORT_SEE)},t.createPayDescribe=function(){return new nato.Message(ProtocolDefine.CG_BILL_DESCRIBE)},t.createPayInfoList=function(){return new nato.Message(ProtocolDefine.CG_BILL_GETLIST)},t.createAchieveGetInfo=function(){return new nato.Message(ProtocolDefine.CG_ACHIEVEMENT_GETINFO)},t.processAchieveGetInfo=function(t){},t.createAchieveList=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_ACHIEVEMENT_GETLIST);return o.putByte(t),o.putByte(e),o.putInt(n),o.putShort(i),o},t.processAchieveList=function(t){return 0>t.getInt()?void AlertPanel.alertCommon(t.getString()):void 0},t.createAchieveGainReward=function(t,e){var n=new nato.Message(ProtocolDefine.CG_ACHIEVEMENT_GAINREWARD);return n.putShort(t),n.putByte(e),n},t.processPlayerShopHasNotifyMsg=function(t){var e=t.getInt(),n=t.getString(),i=t.getByte(),o=xworld.getModel(e);null!=o&&(o.shopName=n,o.setShoptype(i),o.setShopMode(!0))},t.processAchieveGainReward=function(e){var n=e.getByte();if(0>n)AlertPanel.alertCommon(e.getString());else{var i=xself;if(null!=i){var o=new StringBuffer,a=n;o.append(Tool.manageString(GameText.STR_ACHIEVE_GAIN_REWARD_NUM,a+""));var r=e.getInt();r>0&&(i.addValue(ModelConst.MONEY1,r),o.append(GameText.getMoneyText(ModelConst.MONEY1)+r+"\n"));var s=e.getInt();s>0&&(i.addValue(ModelConst.MONEY2,s),o.append(GameText.getMoneyText(ModelConst.MONEY2)+s+"\n"));var l=e.getInt();l>0&&(i.addValue(ModelConst.MONEY3,l),o.append(GameText.getMoneyText(ModelConst.MONEY3)+l+"\n")),t.processUpLevelMsg(e,i,o);var _=e.getInt();_>0&&o.append(Tool.manageString(GameText.STR_ACHIEVE_GAIN_REWARD_SP,_+"")),WorldMessage.addTips(Tool.manageString(GameText.STR_ACHIEVE_GAIN_REWARD_SP,_+"")),a=e.getByte();for(var h=0;a>h;h++){var u=e.getString();o.append(Tool.manageString(GameText.STR_ACHIEVE_GAIN_REWARD_TITLE,u)),WorldMessage.addTips(Tool.manageString(GameText.STR_ACHIEVE_GAIN_REWARD_TITLE,u))}e.getBoolean()&&o.append(GameText.STR_ACHIEVE_GAIN_REWARD_BAG_FULL),t.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_BATTLE_REWARD),AlertPanel.alertNotify(GameText.STR_ACHIEVE_GAIN_REWARD,o.toString())}}},t.createAchieveTitleList=function(){return new nato.Message(ProtocolDefine.CG_TITLE_GETLIST)},t.createAchieveUseTitle=function(t){var e=new nato.Message(ProtocolDefine.CG_TITLE_USE);return e.putShort(t),e},t.processAchieveUseTitle=function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void 0},t.createBindPhone=function(t,e,n,i){var o=ProtocolDefine.CG_BIND_PHONE;0==i&&(o=ProtocolDefine.CG_BIND_EMAIL);var a=new nato.Message(o);return a.putString(t),a.putString(e),a.putString(n),a},t.createPKAskMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_FIGHT_PK_ASK);return e.putInt(t),e},t.createChangeSettingMessgae=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_SETTING);return e.putInt(t),e},t.createRelationFly=function(t){var e=new nato.Message(ProtocolDefine.CG_RELATION_FLY);return e.putInt(t),e.putInt(Define.JUMP_MAP_DATA_FLAG),e},t.createAutoCreatePlayer=function(){var t=new nato.Message(ProtocolDefine.LC_PLAYER_CREATE_AUTO);return t.putString(""),t.putString(GameWorld.strImgAutoCheck),t.putString(""),t},t.createAutoCreateActor=function(t,e){var n=new nato.Message(ProtocolDefine.CG_LOGIN_CREATEACTOR_AUTO);return n.putByte(t),n.putByte(e),n},t.createModifyActorName=function(t){var e=new nato.Message(ProtocolDefine.CG_CHANGE_ACTOR);return e.putString(t),e},t.createModifyActorNameByItem=function(t,e){var n=new nato.Message(ProtocolDefine.CG_ACTOR_CHANGE_NAME);return n.putShort(e),n.putString(t),n},t.createModifyPlayerName=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_CHANGE_ACCOUNT);return o.putString(t),o.putString(e),o.putString(n),o.putString(i),o},t.createCountryApply=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_APPLY);return e.putInt(t),e},t.createCountryActiveMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_ACTIVATE);return e.putInt(t),e},t.createCountryCreateMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_CREATE);return e.putString(t),e},t.createJumpCountryMessage=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_COUNTRY_ENTER);return o.putInt(t),o.putInt(e),o.putInt(n),o.putInt(i),o},t.createCountryListMsg=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_LIST);return i.putByte(t),i.putShort(e),i.putInt(n),i},t.createBrowseCountryInfoMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_CHECK);return n.putInt(t),n.putByte(e),n},t.createCountryAfficheModifyMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_MODIFY_NOTICE);return e.putString(t),e},t.createCountryStorageList=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_GET_STORAGE_ITEM);return e.putBoolean(t),e},t.createCountryStoragePut=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_COUNTRY_DONATE_ITEM);return o.putShort(t),o.putByte(e),o.putInt(n),o.putInt(i),o},t.createCountryStorageDel=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_DELETE_STORAGE_ITEM);return e.putLong(t),e},t.createCountryStorageGet=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_EXCHAGE_STORAGE_ITEM);return n.putBoolean(t),n.putLong(e),n},t.createCountryValidMission=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_GET_VALID_MISSION)},t.createCountryGetAllMission=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_GET_ISSUE_MISSION)},t.createCountryAssingMission=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_GET_ASSIGN_MISSION)},t.createCountryAssignMem=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_COUNTRY_GET_ASSIGN_PEOPLE);return o.putShort(n),o.putShort(t),o.putInt(e),o.putBoolean(i),o},t.createPartnerFly=function(){var t=new nato.Message(ProtocolDefine.CG_PARTNER_FLY);return t.putInt(Define.JUMP_MAP_DATA_FLAG),t},t.createPartnerAdd=function(){return new nato.Message(ProtocolDefine.CG_RELATION_PARTNER_ADD)},t.createPartnerDel=function(){return new nato.Message(ProtocolDefine.CG_RELATION_PARTNER_DELETE)},t.processAttributeUpdateMsg=function(t){for(var e=t.getByte(),n=xself,i=0;e>i;i++){var o=t.getShort(),a=t.getInt();null!=n&&n.addValue(o,a)}},t.processAttributeUpdateMsg2=function(t){for(var e=t.getByte(),n=xself,i=0;e>i;i++){var o=t.getShort(),a=t.getString();null!=n&&n.addStringValue(o,a)}},t.createCampInfo=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_BUILD_CAMP)},t.createSoldierApply=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TO_ARMY)},t.createDeleteSoldier=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_DELETE_ARMY);return e.putInt(t),e},t.createSoldierList=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TO_ARMY_LIST);return o.putByte(n),o.putShort(i),o.putByte(t),o.putByte(e),o},t.createSoldierDealApply=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TO_ARMY_ANSWER);return i.putInt(t),i.putBoolean(e),i.putByte(n),i},t.createWarBuildList=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_BUILD_LIST)},t.createWarBuildLevel=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_BUILD_UPDATE);return e.putByte(t),e},t.createWarUnionCreate=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_CREATE);return e.putString(t),e},t.createWarUnionList=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_LIST);return n.putByte(t),n.putShort(e),n},t.createWarUnionMy=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MY)},t.createWarUnionDealApply=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MEMBER_APPLY_DEAL);return n.putInt(t),n.putBoolean(e),n},t.createWarUnionDelMember=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MEMBER_DELETE);return e.putInt(t),e},t.createWarUnionChange=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_HEAD_CHANGE);return e.putInt(t),e},t.createWarUnionApply=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MEMBER_APPLY);return e.putInt(t),e},t.createWarUnionApplyHelp=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TO_FOREIGN);return e.putInt(t),e},t.createWarUnionWarList=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MEMBER_APPLY_LIST);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createWarDeclare=function(t,e,n,i){var o=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_CREATE);return o.putInt(t),o.putInt(e),o.putInt(n),o.putBoolean(i),o},t.createWarAnswerInfo=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_ANSWER_GET_INFO)},t.createWarDeclareAsk=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_ANSWER);return e.putByte(t),e},t.createWarDeclareList=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_COUNTYR_LIST);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createCountryWarEnter=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_START);return e.putBoolean(t),e},t.createWinActionInfo=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_WIN_ACTION_INFO)},t.createWinActionDo=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_WIN_ACTION_DO);return i.putInt(t),i.putByte(e),i.putByte(n),i},t.processCountryWarEnter=function(t){if(!(0>t.getByte())){var e=new CountryWar;return 0==e.fromMsg(t)?void AlertPanel.errorMessage(GameText.STR_COUNTRY_WAR_ENTER_FAIL):(GameWorld.countryWar=e,void e.init())}AlertPanel.errorMessage(t.getString())},t.createCountryWarUpdate=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UPDATE)},t.createCountryWarOperArmy=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_GOTO_CELL);return n.putByte(t),n.putInt(e),n},t.createCountryWarArmyList=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_ARMY_LIST);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createCountryWarCommandList=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_COMMAND_LIST)},t.createCountryWarUseCommand=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_COMMAND_USE);return e.putShort(t),e},t.createWarTextInfo=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TEXT_LIST);return e.putByte(t),e},t.createWarBattleList=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_SEE_LIST)},t.createSkyArenaRefresh=function(){return new nato.Message(ProtocolDefine.CG_FIGHT_ENTER_PLAYER_NOTIFY)},t.processSkyArenaRefresh=function(t){SkyArena.doSkyArenaRefresh(t)},t.processSkyArenaEnter=function(t){SkyArena.doEnterSkyArena(t,!1)},t.createArenaRefresh=function(){return new nato.Message(ProtocolDefine.CG_TASK_ARENA_UPDATE)},t.createArenaExit=function(){return new nato.Message(ProtocolDefine.CG_TASK_ARENA_EXIT)},t.processArenaUpdate=function(t){Arena.doArenaRefresh(t)},t.processArenaStart=function(t){Arena.doprocessEnteryArena(t)},t.processArenaEnd=function(t){Arena.doOverNotice(t)},t.createCountryPeopleDonate=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_PEOPLE_DONATE);return n.putByte(t),n.putInt(e),n},t.createCountryLeaveMsg=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_PEOPLE_LEAVE)},t.createWarUnionQuit=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_UNION_MEMBER_EXIT)},t.createCountryMemberListMsg=function(t,e,n,i,o){var a=new nato.Message(ProtocolDefine.CG_COUNTRY_PEOPLE_LIST);return a.putInt(t),a.putByte(e),a.putShort(n),a.putInt(i),a.putByte(o),a},t.createCountryMemberAppleListMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_APPLY_LIST);return n.putShort(t),n.putInt(e),n},t.createCountryBuildingUpgradeMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_BUILDING_UPGRADE);return e.putByte(t),e},t.createCountryBuildingRemoveMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_BUILDING_REMOVE);return e.putByte(t),e},t.createCountryMainMenu=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_GET_MISSION_MAIN)},t.createCountryGetMission=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_GET_MISSION);return e.putByte(t),e},t.createCountryPublishMission=function(t,e){if(null==e)return null;var n=new nato.Message(ProtocolDefine.CG_COUNTRY_ISSUE_MISSION);n.putByte(t),n.putByte(e.length);for(var i=0;i<e.length;i++)n.putShort(e[i]);return n},t.createCountryRecruitMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_RECRUIT_CLOSE);return 1==e&&n.setType(ProtocolDefine.CG_COUNTRY_RECRUIT_OPEN),n.putInt(t),n},t.createCountrySetOnlineNotify=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_SET_ONLINE_NOTIFY);return n.putBoolean(e),n},t.createCountryTaxRate=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_SET_TAX);return n.putInt(t),n.putShort(e),n},t.createCountryBossRefresh=function(){return new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_UPDATE)},t.createTeamBossRefresh=function(){return new nato.Message(ProtocolDefine.CG_TASK_TEAM_BOSS_UPDATE)},t.createTeamBossStart=function(){return new nato.Message(ProtocolDefine.CG_TASK_TEAM_BOSS_JOIN)},t.createCountryBossQuit=function(){return new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_EXIT)},t.createCountryEnterRate=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_SET_ENTRYTAX);return i.putInt(t),i.putInt(e),i.putInt(n),i},t.createCountryInvite=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_INVITE);return e.putInt(t),e},t.createCountryBossFight=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_FIGHT);return e.putByte(t),e},t.createCountryBossNotFight=function(){return new nato.Message(ProtocolDefine.CG_TASK_COUNTRY_BOSS_LEAVE_GRID)},t.createTeamBossQuit=function(){return new nato.Message(ProtocolDefine.CG_TASK_TEAM_BOSS_EXIT)},t.createTeamBossFight=function(t){var e=new nato.Message(ProtocolDefine.CG_TASK_TEAM_BOSS_FIGHT);return e.putByte(t),e},t.createTeamBossNotFight=function(){return new nato.Message(ProtocolDefine.CG_TASK_TEAM_BOSS_LEAVE_GRID)},t.createCountryCreateWarCommand=function(e,n,i,o){var a=t.createCountryBookMsg(Define.COUNTRY_COMMAND_CREATE_WAR);return a.putInt(e),a.putInt(n),a.putInt(i),a.putBoolean(o),a},t.createCountryChangeResource=function(e,n,i){var o=t.createCountryBookMsg(Define.COUNTRY_COMMAND_TRANSFER_RESOURCE);return o.putInt(e),o.putInt(n),o.putShort(i),o},t.createCountryBookMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_COMMAND_EXCUTE);return e.putByte(t),e},t.createCountryBookMsgId=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_COMMAND_EXCUTE);return n.putByte(t),n.putByte(e),n},t.createCountryKingCommand=function(e){var n=t.createCountryBookMsg(Define.COUNTRY_COMMAND_KING_COMMAND);return n.putByte(e),n},t.createCountryChangeName=function(e){var n=t.createCountryBookMsg(Define.COUNTRY_COMMAND_CHANGE_NAME);return n.putString(e),n},t.createCountryApplyDealMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_APPLY_HANDLE);return n.putInt(t),n.putBoolean(e),n},t.createCountryExchargeData=function(){return new nato.Message(ProtocolDefine.CG_COUNTRY_GET_EXCHARGE_LIST)},t.createCountryAdjustJobMessage=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_APOINT_PEOPLE);return n.putInt(t),n.putByte(e),n},t.createCountryBecomeKingMessage=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_KING_TRANSFER);return e.putInt(t),e},t.createCountryDelMemMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_COUNTRY_PEOPLE_REMOVE);return e.putInt(t),e},t.createCommandCreateWarDeclareList=function(t,e,n){var i=new nato.Message(ProtocolDefine.CG_COUNTRY_GET_COMMAND_INFO_CREATE_WAR);return i.putByte(t),i.putByte(e),i.putShort(n),i},t.createWarTopPlayer=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TOP_PLAYER_LIST);return n.putByte(t),n.putShort(e),n},t.createWarTopCountryPlayer=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TOP_PEOPLE_COUNTRY_LIST);return n.putByte(t),n.putShort(e),n},t.createWarTopCountry=function(t,e){var n=new nato.Message(ProtocolDefine.CG_COUNTRY_WAR_TOP_COUNTRY_LIST);return n.putByte(t),n.putShort(e),n},t.processCountryNotify=function(t){var e=t.getInt(),n=t.getString(),i=t.getByte(),o=xself;o.setCountryId(e),o.setCountryName(n),o.setCountryRank(i);var a;a=e>0?PowerString.makeColorString(Tool.manageString(GameText.STR_COUNTRY_NOTIFY_ADD,n),ColorUtils.COLOR_GREEN):PowerString.makeColorString(GameText.STR_COUNTRY_NOTIFY_QUIT,ColorUtils.COLOR_RED),ChatMsg.addChatSystemMsg(a,!0),PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS)},t.createPlayerLoginOutMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_LOGIN_ACTORLEAVE);return e.putByte(t),e},t.processPlayerLogoutMsg=function(t){var e=t.getByte();return 0!=t.getByte()?void AlertPanel.alertTips(GameText.getText(GameText.TI_ERROR),t.getString()):void GameWorld.doLogOutMsg(e,!1)},t.createLevelRewardListMsg=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_LEVEL_REWARD_LIST)},t.createLevelRewardMsg=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_LEVEL_REWARD);return e.putByte(t),e},t.createDrawMicroReward=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_MICRO_REWARD)},t.processDrawMicroReward=function(e){if(0==e.getByte()){var n=new StringBuffer,i=e.getInt(),o=e.getInt(),a=e.getInt();xself.setMoneyByType(ModelConst.MONEY1,i,n),xself.setMoneyByType(ModelConst.MONEY2,o,n),xself.setMoneyByType(ModelConst.MONEY3,a,n);var r=t.processAddItemMsg(e,ProtocolDefine.CG_ACTOR_DRAW_MICRO_REWARD);n.append(r),WorldMessage.addTips(n.toString()),PanelManager.closeMicroPanel(),PanelManager.mainMenu.micro_btn.visible=!1}else AlertPanel.alertTips(GameText.getText(GameText.TI_ERROR),e.getString())},t.createSevenDayReward=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_SEVEN_DAY_LOGIN_REWARD);return e.putByte(t),e},t.createSpringReward=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_SPRING_LOGIN_REWARD);return e.putByte(t),e},t.createExpandPackage=function(t,e){var n=new nato.Message(ProtocolDefine.CG_ACTOR_EXPAND_PACKAGE);return n.putByte(t),n.putInt(e),n},t.createExchangeMoneyMsg=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_LIANJIN)},t.createFiveDayActivityList=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_DAY_ACTITY_LIST)},t.createFiveDayActivityReward=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_DAY_ACTITY);return e.putByte(t),e},t.createSingleChargeActivityData=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_EACH_CHARGE)},t.createAccumulatedChargeActivityData=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_TOTAL_CHARGE)},t.createAccumulatedChargeActivityReward=function(t){var e=new nato.Message(ProtocolDefine.CG_ACTOR_DRAW_TOTAL_CHARGE);return e.putByte(t),e},t.createFoundationData=function(){return new nato.Message(ProtocolDefine.CG_ACTIVITY_FUND_PAGE)},t.createFoundationReward=function(t,e){var n=new nato.Message(ProtocolDefine.CG_ACTIVITY_FUND_REWARD);return n.putInt(t),n.putInt(e),n},t.createFoundationBuy=function(){return new nato.Message(ProtocolDefine.CG_ACTIVITY_FUND_BUY)},t.createHotShopList=function(){return new nato.Message(ProtocolDefine.CG_HOT_SHOP_LIST)},t.createRefreshHotShop=function(){return new nato.Message(ProtocolDefine.CG_REFRESH_HOT_SHOP)},t.createBuyHotShopItem=function(t){var e=new nato.Message(ProtocolDefine.CG_BUY_HOT_SHOP_ITEM);return e.putInt(t),e},t.createChannelShareMsg=function(t,e){var n=new nato.Message(ProtocolDefine.CG_CHANNEL_SHARE),i=JSON.stringify({access_token:t,status:e});n.putString(i),nato.Network.sendCmd(n,(function(t){if(0!=t.getInt())AlertPanel.alertCommon(t.getString());else{var e=(t.getString(),t.getInt()),n=e-xself.money2;xself.money2=e,AlertPanel.alertCommon(GameText.SHARE_SHARE_SUCCESS+n+GameText.STR_MONEY2),xworld.isShare=!1,PanelManager.updateWorldTopMenu()}}),this),PanelManager.closeSharePanel()},t.saveToDesktop=function(){return new nato.Message(ProtocolDefine.CG_SAVE_TO_DESKTOP)},t.createFollow=function(){return new nato.Message(ProtocolDefine.CG_FOLLOW_STATUS)},t.createNationalDay=function(){return new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_NATIONAL_DAY_CHARGE_RANK)},t.HEART_BEAT_TIME=15e3,t.lastHeartBeat=0,t.nextHeartBeat=0,t.MAX_OTHER_MOVE_TO=5,t.CHECK_VERSION_NONE=0,t.CHECK_VERSION_LOW=1,t.PET_INFO_PLAYER_SHOP=1,t.PET_INFO_GOODS=2,t.PET_INFO_MAIL=3,t.PET_INFO_SEE_PLAYER=4,t.PET_INFO_CHAT=5,t}();__reflect(MsgHandler.prototype,"MsgHandler");var ProtocolDefine=function(){function t(){}return t.LC_CHECKEDITION=5e3,t.LC_PLAYER_CREATE=5001,t.LC_PLAYER_LOGIN=5002,t.LC_PLAYER_CREATE_AUTO=5003,t.LC_GAME_GET_AREA_AND_LINE=5007,t.CG_LOGIN_PLAYERCHECK=1,t.CG_LOGIN_ACTORENTER=2,t.CG_LOGIN_ACTORLEAVE=3,t.CG_ERROR_NOTIFY=5,t.CG_LOGIN_ACTORLIST=10001,t.CG_LOGIN_CREATEACTOR=10002,t.CG_LOGIN_DELETEACTOR=10003,t.CG_LOGIN_RECOVERACTOR=10004,t.CG_LOGIN_CREATEACTOR_AUTO=10005,t.CG_CHANGE_ACCOUNT=10006,t.CG_CHANGE_ACTOR=10007,t.CG_LOGIN_DELETEACTOR_PASSWD=10017,t.CG_ACTOR_ATTRIBUTE_UPDATE_STRING=11037,t.CG_ACTOR_CHANGE_NAME=11038,t.CG_ACTOR_IS_TOURIST=11097,t.CG_BIND_PHONE=10008,t.CG_BIND_EMAIL=10010,t.CG_BIND_SETTING=10011,t.CG_PET_CHANGE_NOTIFY=15501,t.CG_PET_SEE=15502,t.CG_SOLDIER_GROUP_LIST=15503,t.CG_SOLDIER_GROUP_INFO=15504,t.CG_SOLDIER_GROUP_BUY=15505,t.CG_SOLDIER_GROUP_MY_LIST_SLEEP=15506,t.CG_SOLDIER_GROUP_MY_INFO=15507,t.CG_SOLDIER_STATE_SET=15508,t.CG_SOLDIER_STATE_NOTIFY=15509,t.CG_SOLDIER_DELETE=15510,t.CG_PET_CHANGE_NAME=15511,t.CG_PET_INFO=15512,t.CG_SOLDIER_GROUP_MY_LIST_CHANGE_CAPTAIN=15513,t.CG_PET_INFO_BYID=15514,t.CG_PET_EVOLVE=15515,t.CG_GET_SEAL_PET_SKILL=15516,t.GC_SEAL_PET_TYPE=15517,t.CG_SYSTEM_HEART=16001,t.CG_SYSTEM_TEST_OPER=16002,t.CG_SCENE_ENTERMAP=10501,t.CG_SCENE_LEAVEMAP=10502,t.CG_SCENE_WORLDDATA=10503,t.CG_SCENE_PLAYER_MOVING=10504,t.CG_SCENE_GET_OTHER_PLAYER_STATE=10505,t.CG_SCENE_GO_MAP=10506,t.CG_SCENE_PLAYER_ICON=10507,t.CG_SCENE_SHOW_TEXT=10509,t.SHOW_TEXT_ERROR=1,t.SHOW_TEXT_INFO=2,t.SHOW_TEXT_OPEN=3,t.SHOW_TEXT_SCROLL=4,t.SHOW_TEXT_PROMPT=5,t.CG_SCENE_GO_CITY=10510,t.CG_CITY_INFO=10511,t.CG_CITY_EXTRACT_MONEY=10512,t.CG_CITY_CHANGE_NAME=10513,t.CG_CITY_CHANGE_SIGN=10514,t.CG_CITY_MAP_REFRESH=10515,t.CG_SCENE_UPDATE=10516,t.CG_SCENE_SETREBORNMAP=10517,t.CG_SCENE_FINDPATH_MISSION=10518,t.CG_SCENE_GETNPC=10519,t.CG_SCENE_WORLDMAP=10521,t.CG_SCENE_WORLDMAP_DATA=10522,t.CG_SCENE_WORLDMAP_ENTER=10523,t.CG_SCENE_GO_MAP_VIP=10524,t.CG_SCENE_GO_MAP_UPGRADE=10525,t.CG_SCENE_FINDPATH_AGAIN=10527,t.CG_FIGHT_ENTER_LOCALBATTEL=12501,t.CG_FIGHT_RUN_LOCALBATTLE=12502,t.CG_FIGHT_ENTER_REMOTEBATTLE=12503,t.CG_FIGHT_ENTER_BATTLE_NOTIFY=12504,t.CG_FIGHT_BATTLE_DOPLAN=12505,t.CG_FIGHT_BATTLE_UPDATE=12506,t.CG_FIGHT_PK_ASK=12507,t.CG_FIGHT_SEE_IN=12508,t.CG_FIGHT_SEE_OUT=12509,t.ADD_ITEM_BATTLE_REWARD=0,t.ADD_ITEM_MISSION_REWARD=1,t.ADD_ITEM_USE_REWARD=2,t.ADD_ITEM_MAIL_REWARD=3,t.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE=12510,t.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE_LIST=12511,t.CG_FIGHT_ENTER_PLAYER_BATTLE_NOTIFY_LIST=12512,t.CG_FIGHT_ENTER_PLAYER_DATA=12513,t.CG_FIGHT_ENTER_PLAYER_REMOTEBATTLE_EXIT=12514,t.CG_FIGHT_ENTER_PLAYER_EXIT_NOTIFY=12515,t.CG_FIGHT_ENTER_PLAYER_NOTIFY=12516,t.CG_FIGHT_ENTER_COMPTITION=12517,t.CG_FIGHT_EXIT_COMPTITION=12518,t.CG_FIGHT_SAVE_ADJUST=12519,t.CG_FIGHT_SHOW_RANK=12520,t.CG_FIGHT_ADD_FIGHT_COUNT=12521,t.CG_FIGHT_CREATE_COMPITION=12522,t.CG_FIGHT_CLEAR_INTERVAL=12523,t.CG_FIGHT_REFRESH_COMPITION=12524,t.CG_FIGHT_ACTIVE_COMPITION=12525,t.GC_SYNC_NOTICE_COMPTITION=12526,t.GC_SYNC_MY_COMPITION_RANK=12527,t.GC_SYNC_MY_SCORE_REWARD=12528,t.GC_SYNC_MY_COMPITION_REWARD=12529,t.GC_SYNC_MY_COMPITION_RANKLIST=12530,t.GC_SYNC_REFRESH_COMPITION=12531,t.GC_SYNC_INFO_COMPITION=12532,t.CG_TASK_ARENA_JOIN=14525,t.CG_TASK_ARENA_UPDATE=14526,t.CG_TASK_ARENA_FIGHT=14527,t.CG_TASK_ARENA_EXIT=14528,t.CG_TASK_ARENA_END=14529,t.CG_TASK_ARENA_JOIN_NEW=14536,t.CG_TASK_ARENA_ACTOR_LIST=14537,t.CG_TASK_ARENA_PK=14538,t.CG_TASK_ARENA_SEE_RANDOM=14539,t.CG_TASK_ARENA_START=14540,t.CG_ACTOR_PLAYERBAG=12001,t.PLAYERBAG_EQUIP=1,t.PLAYERBAG_UN_EQUIP=2,t.PLAYERBAG_USE=3,t.PLAYERBAG_LOSE=4,t.PLAYERBAG_CHECKUP=5,t.PLAYERBAG_ENCHASE=6,t.PLAYERBAG_BIND=7,t.BAG_NO_WAIT=0,t.BAG_USE_PET_EGG=1,t.BAG_EQUIP_PET=2,t.BAG_UN_EQUIP_PET=3,t.BAG_USE_CHEST=4,t.BAG_CHECKUP=5,t.BAG_ENCHASE=6,t.BAG_BIND=7,t.BAG_COMMAND_BOOK=8,t.BAG_EQUIP=9,t.BAG_ADD_STORE_NUM=10,t.BAG_ADD_EXP=11,t.BAG_ADD_PET_EXP=12,t.BAG_PET_RESET=13,t.BAG_PET_AGE=14,t.BAG_REPAIR=15,t.BAG_GET_TITLE=16,t.BAG_UN_EQUIP=17,t.BAG_CHANGE_JOB=18,t.BAG_PET_ITEM_ADD_SKILLS=19,t.BAG_WAIT=20,t.BAG_ALERT_SEX=21,t.BAG_ADD_CP=22,t.BAG_ADD_SP=23,t.BAG_ADD_PROSPERITY_DEGREE=24,t.BAG_SKILL_SLOT_PALYER=25,t.BAG_SKILL_SLOT_PET=26,t.CG_BAG_CLEAN=12003,t.CG_ITEMSHOP_LIST=12004,t.CG_ITEMSHOP_BUY=12005,t.CG_ITEMSHOP_SELL=12006,t.CG_PLAYERSHOP_START=12007,t.CG_PLAYERSHOP_STOP=12008,t.CG_PLAYERSHOP_LIST_GOODS=12010,t.CG_PLAYERSHOP_BUY=12011,t.CG_PLAYERSHOP_SELLRECORD=12012,t.CG_PLAYERSHOP_SELL_NOTIFY=12013,t.CG_PLAYERSHOP_SHOP_NOTIFY=12014,t.CG_BAG_CHECKUP_ASK=12015,t.CG_ITEMTYPE_GETINFO=12016,t.CG_STORAGE_LIST=12017,t.CG_STORAGE_OPER=12018,t.CG_BAG_REPAIR=12019,t.CG_ITEMSHOP_LIST_SCORE=12020,t.CG_ITEMSHOP_BUY_SCORE=12021,t.CG_ITEM_PET_ADD_SKILL=12022,t.CG_BAG_REPAIR_BY_TEAM=12023,t.CG_STORAGE_LIST_VIP=12024,t.CG_STORAGE_OPER_VIP=12025,t.CG_STORAGE_CLEAN=12026,t.CG_EQUIP_TASK_GET_ITEM=12027,t.CG_GET_AWARD_ITEM=12029,t.CG_GET_RANDOM_NPC_AWARD=12030,t.CG_USE_TASK_GET_PET=12031,t.CG_USE_NEW_GET_PET=12032,t.CG_USE_NEW_GET_RIDE=12033,t.CG_GET_PET=12034,t.CG_GET_RIDE=12035,t.CG_GET_AUTO_SELL_LIST=12036,t.CG_AUTO_SELL=12037,t.CG_CHEST_USE_HIGH_KEY=12039,t.CG_IDENTIFY_USE_HIGH_KEY=12040,t.CG_IDENTIFY_GET_LIST=12041,t.CG_TURN_MONSTER_CARD=12042,t.CG_TURN_MONSTER_NOTIFY=12043,t.CG_CHANGE_TURN_MONSTER=11142,t.CG_SUIT_GETINFO=11501,t.CG_ITEM_DECOM=11502,t.CG_ASCENSION_STAR=11506,t.CG_ADVANCE_STAR=11528,t.CG_EQUIPMENT_UPGRADE=11527,t.CG_REPLACE_INLAY_GEM=11507,t.CG_REPLACE_INLAY_GEM_ASK=11508,t.CG_COMPOSITE_PET_SHOP=11509,t.CG_COMPOSITE_PET_GRADE=11510,t.CG_COMPOSITE_PET_DO=11511,t.CG_COMPOSITE_PET_CONFIRM=11512,t.CG_COMPOSITE_PET_PROMPTLY=11513,t.CG_COMPOSITE_SHOP=11503,t.CG_COMPOSITE_DO=11504,t.CG_COMPOSITE_CONFIRM=11505,t.CG_FURNACE_OPEN_SHOP=11514,t.CG_FURNACE_REFINE=11515,t.CG_FURNACE_INC_TOTAL_REFINE_NUM=11516,t.CG_FURNACE_BUY_CRAFTSMAN=11517,t.CG_FURNACE_LIST_ITEMINFO=11518,t.CG_ENCHANTS_ADD=11519,t.CG_ENCHANTS_EQUAL_SELF=11520,t.CG_ENCHANTS_GETLIST=11521,t.CG_ENCHANTSHOP_START=11522,t.CG_ENCHANTSHOP_STOP=11523,t.CG_ENCHANTSHOP_BUY=11524,t.CG_ENCHANTSHOP_LIST=11525,t.CG_ENCHANTSHOP_SELLRECORD=11526,t.CG_EXCHANGE_FIND_SELLGOODS=13516,t.CG_EXCHANGE_BUY_SELLGOODS=13517,t.CG_EXCHANGE_SUBMIT_SELLGOODS=13518,t.CG_EXCHANGE_RETRIEVE_SELLGOODS=13519,t.CG_EXCHANGE_MY_SELLGOODS=13520,t.CG_EXCHANGE_SUBMIT_PURCHASEGOODS=13521,t.CG_EXCHANGE_CANCEL_PURCHASEGOODS=13522,t.CG_EXCHANGE_EXTRACT_PURCHASEGOODS=13523,t.CG_EXCHANGE_MY_PURCHASEGOODS=13524,t.CG_EXCHANGE_FIND_PURCHASEGOODS=13525,t.CG_EXCHANGE_PROVIDE_PURCHASEGOODS=13526,t.CG_EXCHANGE_AUTOPROVIDE_PURCHASEGOODS=13527,t.CG_EXCHANGE_PURCHASEGOODS_TYPELIST=13528,t.CG_ACTOR_LOGIN_ONLINE_REWARD=11108,t.CG_ACTOR_RECEIVE_ONLINE_REWARD=11109,t.CG_SEND_IS_OPEN=11116,t.CG_CHARGE_ACTIVITY_LIST=11120,t.CG_CHARGE_ACTIVITY_GET_GIFT=11121,t.CG_TASK_GETMISSIONDATA=14501,t.CG_TASK_ACCEPT=14502,t.CG_TASK_DELIVER=14503,t.CG_TASK_ABANDON=14504,t.CG_TASK_NPC_STATUS=14505,t.CG_TASK_ACCEPT_TEAM=14506,t.CG_TASK_DELIVER_TEAM=14507,t.CG_TASK_OFFLINE_LIST=14512,t.CG_TASK_OFFLINE_ACTIVATE=14513,t.CG_TASK_RANDOM_GET=14531,t.CG_TASK_RANDOM_FINISH=14532,t.CG_TASK_RANDOM_CANCEL=14533,t.CG_TASK_RANDOM_INFO=14534,t.CG_TASK_VITALITY_FIRST_OPEN=14551,t.CG_TASK_VITALITY_SHOW_REWARD=14553,t.CG_TASK_VITALITY_GET_REWARD=14554,t.CG_TASK_VITALITY_REMIND=14555,t.CG_TASK_MILESTONE_OPEN=14556,t.CG_TASK_MILESTONE_SHOW_TYPE=14557,t.CG_TASK_MILESTONE_GET_PART=14558,t.CG_TASK_MILESTONE_GET_REWARD=14559,t.CG_TASK_MILESTONE_ON=14560,t.CG_TASK_MILESTONE_AB=14561,t.CG_ACTOR_ADDATTRIBUTE=11003,t.CG_ACTOR_ATTRIBUTE_UPDATE=11004,t.CG_ACTOR_SETTING=11006,t.CG_SKILL_SHOP_LIST=14001,t.CG_SKILL_SHOP_LEARN=14002,t.CG_SKILL_DELETE=14003,t.CG_SKILL_AUTO_ACTIVE=14004,t.CG_SKILL_AUTO_INVALID=14005,t.CG_SKILL_DELETE_BY_LEVEL=14006,t.CG_SKILL_SCROLL_LEARN=14007,t.CG_SKILL_SCROLL_LEARN_ASK=14008,t.CG_SKILL_INITIATIVE_SET=14009,t.CG_SKILL_INITIATIVE_CLEAN=14010,t.CG_SKILL_UPDATE=14011,t.CG_FORMATION_LEARN=14012,t.CG_FORMATION_FORGET=14013,t.CG_FORMATION=14014,t.CG_FORMATION_CHANGE_DEFAULT=14015,t.CG_SKILL_BOOK_LEARN=14016,t.CG_SKILL_BOOK_LEARN_ASK=14017,t.CG_ACTOR_PROTECT_LOCK_SET=11043,t.CG_ACTOR_PROTECT_LOCK_MODIFY=11044,t.CG_ACTOR_PROTECT_LOCK_CHANCLE=11045,t.CG_ACTOR_PROTECT_LOCK_OPEN=10009,t.CG_ACTOR_PROTECT_LOCK_RESET=11047,t.CG_MAIL_LIST=11007,t.CG_MAIL_DETAIL=11008,t.CG_MAIL_REPORT=11051,t.CG_MAIL_SEND=11009,t.CG_MAIL_SEND_SERVICE=11010,t.CG_MAIL_EXTRACT_ATTACHMENT=11011,t.CG_MAIL_TURNBACK=11012,t.CG_MAIL_DELETE=11013,t.CG_MAIL_NOTIFY=11014,t.CG_MAIL_OPEN=11031,t.CG_MAIL_GETITEMDETAIL=11034,t.MAIL_SEND_ID=1,t.MAIL_SEND_NAME=2,t.MAIL_SEND_UID=3,t.CG_RELATION_LIST=13529,t.CG_RELATION_ADD=13530,t.CG_RELATION_DELETE=13531,t.CG_ACTOR_SEE=13532,t.CG_RELATION_FLY=13533,t.CG_RELATION_MASTER_ADD=13536,t.CG_RELATION_MASTER_DELETE=13537,t.CG_RELATION_ADD_REMARKS=13548,t.CG_PARTNER_FLY=13538,t.CG_RELATION_PARTNER_ADD=13539,t.CG_RELATION_PARTNER_DELETE=13540,t.CG_SCENE_PLAYER_EVENT=10508,t.PLAYER_EVENT_CHOOSE_YES=1,t.PLAYER_EVENT_CHOOSE_NO=2,t.CG_SYSTEM_GET_RAIDERS=16005,t.CG_SYSTEM_SPECIALCODE=16006,t.CG_SYSTEM_GET_PET_RAIDERS=16009,t.CG_SYSTEM_GET_MOUNT_RAIDERS=16010,t.CG_SYSTEM_GET_VOCATION_RAIDERS=16011,t.CG_SYSTEM_ASK_VOCATION_RAIDERS=16012,t.CG_SYSTEM_VOCATION_RAIDERS_WORD=16013,t.CG_SYSTEM_GET_VOCATION_RAIDERS_WORD=16014,t.CG_SYSTEM_GET_RAIDERS_PLAYER=16015,t.CG_SYSTEM_GET_RAIDERS_PLAYER_PET=16016,t.CG_TEAM_INVITE=13501,t.TEAM_CREATE_TYPE_INVITE=1,t.TEAM_CREATE_TYPE_JOIN=2,t.CG_TEAM_JOIN=13502,t.CG_TEAM_LEAVE=13503,t.CG_TEAM_CHANGE_CAPTAIN=13504,t.CG_TEAM_DISBAND=13505,t.CG_TEAM_SET=13506,t.TEAM_SET_AUTO_JOIN=1,t.TEAM_SET_CHANGE_CAPTAIN=2,t.TEAM_SET_DISBAND=3,t.TEAM_SET_REMOVE_MEMBER=4,t.CG_TEAM_LEAVE_SELF=13507,t.CG_TEAM_NEW=13508,t.CG_CHAT_SUBMIT=13509,t.CG_CHAT_DOWN_WORLD=13510,t.CG_CHAT_DOWN_MAP=13511,t.CG_CHAT_DOWN_COUNTRY=13512,t.CG_CHAT_DOWN_TEAM=13513,t.CG_CHAT_DOWN_PRIVATE=13514,t.CG_CHAT_DOWN_SYSTEM=13515,t.CG_CHAT_DOWN_UNION=13550,t.CG_CHAT_DOWN_BATTLE=13553,t.CG_CHAT_DOWN_SERVERS=13558,t.CG_CHAT_SEE_ITEM=13534,t.CG_CHAT_SEN_MISSION=13535,t.CG_WEDDING_CARD_CONSULT=13551,t.CG_WEDDING_CARD_SEND=13552,t.CG_SYSTEM_GUIDE=11077,t.CG_SEND_ACCOST=11110,t.CG_INITIATIVE_ACCOST=11111,t.CG_SEND_INITIATIVE_ACCOST=11112,t.CG_GET_ACCOST_MY_LIST=11113,t.CG_SYSTEM_GET_ACTIVITY=16004,t.CG_SYSTEM_BALLOT=16007,t.CG_SYSTEM_UPGRADE=16008,t.CG_MIX_SERVER_ACTIVITY_ACTOR_JOIN=13544,t.CG_MIX_SERVER_ACTIVITY_ACTOR_CANCEL=13545,t.CG_MIX_SERVER_ACTIVITY_COUNTRY_JOIN=13546,t.CG_MIX_SERVER_ACTIVITY_COUNTRY_CANCEL=13547,t.CG_TASK_ESCORT_START=14508,t.CG_TASK_ESCORT_CANCEL=14509,t.CG_TASK_ESCORT_MOVE=14510,t.CG_TASK_ESCORT_REFURBISH=14511,t.CG_TASK_ESCORT_CHOICE_EVENT=14514,t.CG_TASK_ESCORT_LIST=14515,t.CG_TASK_ESCORT_ROB=14516,t.CG_TASK_ESCORT_SEE=14517,t.CG_TASK_ESCORT_NEW_LIST=14535,t.CG_ACTOR_LOTTERY_DRAW=11063,t.CG_ACTOR_LOTTERY_DRAW_LIST=11064,t.CG_ACTOR_LOTTERY_DRAW_WINNING_LIST=11065,t.CG_ACTOR_LOTTERY_DRAW_LIST_NEW=11106,t.CG_ACTOR_LOTTERY_DRAW_START_NEW=11107,t.CG_ACTOR_LOGIN_LOTTERY_DRAW_NEW=11115,t.CG_ACHIEVEMENT_GETINFO=11023,t.CG_ACHIEVEMENT_GETLIST=11024,t.CG_ACHIEVEMENT_GAINREWARD=11025,t.CG_TITLE_GETLIST=11026,t.CG_TITLE_USE=11027,t.CG_ACTOR_SEE_ACHIEVEMENT=11050,t.CG_BILL_ACHIEVEMENT_GETLIST=11083,t.CG_BILL_GETLIST=11028,t.CG_BILL_DESCRIBE=11078,t.CG_NEWBILL_LIST=17001,t.CG_NEWBILL_BILL=17002,t.CG_BILL_MO9=17006,t.ISOPEN_MO9_POP=17007,t.EXTRACTIONGOLD_TENCENT=17008,t.CG_TENCENT_QUERY_BALANCE=17009,t.CG_CHANNEL_SHARE=17010,t.CG_DRAW_WANBA_GIFT=17601,t.CG_WANBA_VIP_GIFT=17602,t.CG_OPEN_WANBA_PLAT_GIFT=17603,t.CG_DRAW_WANBA_PLAT_GIFT=17604,t.CG_GET_INVITATION_INFO=17605,t.CG_INVITATION_REPORT=17606,t.CG_SAHRE_INVITATION=17607,t.CG_DRAW_INVITATION_AWARD=17608,t.CG_DAILY_CAHRGE=17609,t.CG_POWER_CHARGE=17610,t.CG_ACTOR_FETCH_BS_DATA=11301,t.CG_ACTOR_PUSH_BS_CHANGE=11302,t.CG_ACTOR_DRAW_BS_AWARD=11303,t.CG_INVITE_SYS_DATA=17701,t.CG_INVITE_BINDING=17702,t.CG_INVITE_DRAW_REBATE=17703,t.CG_TOP_TYPE_LIST=13541,t.CG_TOP_DATA_LIST=13542,t.CG_TOP_ME=13543,t.CG_ACTOR_OPEN_RANK_REWARD=11210,t.CG_ACTOR_ACCEPTDISCIPLE_START=11060,t.CG_ACTOR_ACCEPTDISCIPLE_CANCEL=11061,t.CG_ACTOR_ACCEPTDISCIPLE_LIST=11062,t.CG_COUNTRY_CREATE=15001,t.CG_COUNTRY_CHECK=15002,t.CG_COUNTRY_ACTIVATE=15003,t.CG_COUNTRY_LIST=15004,t.CG_COUNTRY_RECRUIT_OPEN=15005,t.CG_COUNTRY_RECRUIT_CLOSE=15006,t.CG_COUNTRY_SET_TAX=15007,t.CG_COUNTRY_SET_ENTRYTAX=15008,t.CG_COUNTRY_ENTER=15009,t.CG_COUNTRY_INVITE=15010,t.CG_COUNTRY_APPLY=15011,t.CG_COUNTRY_APPLY_LIST=15012,t.CG_COUNTRY_APPLY_HANDLE=15013,t.CG_COUNTRY_PEOPLE_REMOVE=15014,t.CG_COUNTRY_PEOPLE_LEAVE=15015,t.CG_COUNTRY_PEOPLE_LIST=15016,t.CG_COUNTRY_MAP_CHANGE=15017,t.CG_COUNTRY_APOINT_PEOPLE=15018,t.CG_COUNTRY_KING_TRANSFER=15019,t.CG_COUNTRY_BUILDING_UPGRADE=15020,t.CG_COUNTRY_BUILDING_REMOVE=15021,t.CG_COUNTRY_COMMAND_EXCUTE=15022,t.CG_COUNTRY_PEOPLE_DONATE=15023,t.CG_COUNTRY_DONATE_ITEM=15024,t.CG_COUNTRY_DELETE_STORAGE_ITEM=15025,t.CG_COUNTRY_GET_STORAGE_ITEM=15026,t.CG_COUNTRY_EXCHAGE_STORAGE_ITEM=15027,t.CG_COUNTRY_GET_MISSION=15028,t.CG_COUNTRY_ISSUE_MISSION=15029,t.CG_COUNTRY_GET_ASSIGN_MISSION=15030,t.CG_COUNTRY_GET_ASSIGN_PEOPLE=15031,t.CG_COUNTRY_ASSIGN_MISSION=15032,t.CG_COUNTRY_GET_VALID_MISSION=15033,t.CG_COUNTRY_MODIFY_NOTICE=15034,t.CG_COUNTRY_JOIN_NOTIFY=15035,t.CG_COUNTRY_GET_ISSUE_MISSION=15036,t.CG_COUNTRY_GET_MISSION_MAIN=15037,t.CG_COUNTRY_GET_EXCHARGE_LIST=15038,t.CG_COUNTRY_WAR_START=15039,t.CG_COUNTRY_WAR_UPDATE=15040,t.CG_COUNTRY_WAR_ARMY_LIST=15041,t.CG_COUNTRY_WAR_GOTO_CELL=15042,t.CG_COUNTRY_WAR_NOTICE=15043,t.CG_COUNTRY_WAR_COMMAND_LIST=15044,t.CG_COUNTRY_WAR_COMMAND_USE=15045,t.CG_COUNTRY_WAR_COUNTYR_LIST=15046,t.CG_COUNTRY_WAR_CREATE=15047,t.CG_COUNTRY_WAR_ANSWER=15048,t.CG_COUNTRY_WAR_BUILD_LIST=15049,t.CG_COUNTRY_WAR_BUILD_UPDATE=15050,t.CG_COUNTRY_WAR_ANSWER_GET_INFO=15051,t.CG_COUNTRY_WAR_SEE_LIST=15052,t.CG_COUNTRY_WAR_TEXT_LIST=15053,t.CG_COUNTRY_WAR_TO_ARMY=15054,t.CG_COUNTRY_WAR_TO_ARMY_LIST=15055,t.CG_COUNTRY_WAR_TO_ARMY_ANSWER=15056,t.CG_COUNTRY_BUILD_CAMP=15057,t.CG_COUNTRY_WAR_TO_FOREIGN=15058,t.CG_COUNTRY_WAR_DELETE_ARMY=15059,t.CG_COUNTRY_WAR_WIN_ACTION_INFO=15060,t.CG_COUNTRY_WAR_WIN_ACTION_DO=15061,t.CG_COUNTRY_WAR_UNION_CREATE=15062,t.CG_COUNTRY_WAR_UNION_LIST=15063,t.CG_COUNTRY_WAR_UNION_MY=15064,t.CG_COUNTRY_WAR_UNION_MEMBER_APPLY=15065,t.CG_COUNTRY_WAR_UNION_MEMBER_APPLY_LIST=15066,t.CG_COUNTRY_WAR_UNION_MEMBER_APPLY_DEAL=15067,t.CG_COUNTRY_WAR_UNION_MEMBER_DELETE=15068,t.CG_COUNTRY_WAR_UNION_MEMBER_EXIT=15069,t.CG_COUNTRY_WAR_UNION_HEAD_CHANGE=15070,t.CG_COUNTRY_WAR_TOP_PLAYER_LIST=15071,t.CG_COUNTRY_WAR_TOP_COUNTRY_LIST=15072,t.CG_COUNTRY_WAR_TOP_PEOPLE_COUNTRY_LIST=15073,t.CG_COUNTRY_GET_VIP_ITEM=15074,t.CG_COUNTRY_GET_STORAGE_PET=15075,t.CG_COUNTRY_GET_COMMAND_INFO_CREATE_WAR=15076,t.CG_COUNTRY_SET_ONLINE_NOTIFY=15077,t.CG_TASK_TEAM_BOSS_JOIN=14518,t.CG_TASK_TEAM_BOSS_UPDATE=14519,t.CG_TASK_TEAM_BOSS_FIGHT=14520,t.CG_TASK_TEAM_BOSS_EXIT=14522,t.CG_TASK_TEAM_BOSS_END=14523,t.CG_TASK_TEAM_BOSS_LEAVE_GRID=14524,t.CG_TASK_COUNTRY_BOSS_JOIN=14541,t.CG_TASK_COUNTRY_BOSS_UPDATE=14542,t.CG_TASK_COUNTRY_BOSS_FIGHT=14543,t.CG_TASK_COUNTRY_BOSS_EXIT=14544,t.CG_TASK_COUNTRY_BOSS_END=14545,t.CG_TASK_COUNTRY_BOSS_LEAVE_GRID=14546,t.CG_TASK_COUNTRY_BOSS_JOIN_PUSH=14547,t.CG_TASK_COUNTRY_BOSS_GET_SCORE=14548,t.CG_TASK_COUNTRY_BOSS_ACTIVATE=14549,t.CG_TASK_COUNTRY_BOSS_ACTIVATE_DATA=14550,t.CG_VIP_LIST=11053,t.CG_VIP_BUY=11054,t.CG_VIP_INFO=11055,t.CG_VIP_QUESTION_GET=11056,t.CG_VIP_QUESTION_SUB=11057,t.CG_ACTOR_LEVEL_REWARD_LIST=11160,t.CG_ACTOR_DRAW_LEVEL_REWARD=11161,t.CG_ACTOR_DRAW_MICRO_REWARD=11162,t.CG_ACTOR_DRAW_SEVEN_DAY_LOGIN_REWARD=11163,t.CG_ACTOR_EXPAND_PACKAGE=11164,t.CG_ACTOR_LIANJIN=11165,t.CG_ACTOR_DRAW_SPRING_LOGIN_REWARD=11166,t.CG_ACTOR_OFFLINE_EXP_OPEN=11170,t.CG_ACTOR_OFFLINE_EXP_GET=11171,t.CG_ACTOR_OFFLINE_UPGRADE=11172,t.CG_ACTOR_OFFLINE_EXP_PRAY=11173,t.CG_ACTOR_OPEN_WISHING_WELL=11180,t.CG_ACTOR_WISHING=11181,t.CG_ACTOR_DAY_ACTITY_LIST=11066,t.CG_ACTOR_DRAW_DAY_ACTITY=11067,t.CG_ACTOR_OPEN_EACH_CHARGE=11190,t.CG_ACTOR_OPEN_TOTAL_CHARGE=11200,t.CG_ACTOR_DRAW_TOTAL_CHARGE=11201,t.CG_ACTOR_VIP_LEVEL=11300,t.CG_VIP_LEVEL_INFO=11032,t.CG_ACTIVITY_FUND_PAGE=14593,t.CG_ACTIVITY_FUND_REWARD=14594,t.CG_ACTIVITY_FUND_BUY=14595,t.CG_ACTOR_OPEN_NATIONAL_DAY_CHARGE_RANK=11211,t.CG_HOT_SHOP_LIST=11091,t.CG_REFRESH_HOT_SHOP=11092,t.CG_BUY_HOT_SHOP_ITEM=11093,t.CG_SAVE_TO_DESKTOP=17011,t.CG_FOLLOW_STATUS=11100,t.CG_TRADE_MONEY1_EVERYDAY=11094,t.CG_HAND_OUT_RED_ENVELOPES=13553,t.CG_RECEIVE_RED_ENVELOPES=13554,t.CG_RED_ENVELOPES_LIST=13555,t.CG_MY_ENVELOPES_RECORD=13556,t.CG_RECEIVE_ENVELOPES_RECORD=13557,t.CG_SEND_RED_PACKET_DATA=11088,t.CG_ACTOR_SELL_MY_LIST=11039,t.CG_ACTOR_SELL_START=11040,t.CG_ACTOR_SELL_CANCEL=11041,t.CG_ACTOR_SELL_LIST=11042,t.CG_ACTOR_SELL_BUY=11048,t.CG_ACTOR_SELL_SEE=11049,t.CG_ACTOR_OPEN_ONEKEY_DAILY_MISSION=11400,t.CG_ACTOR_EXEC_ONEKEY_DAILY_MISSION=11401,t.CG_ACTOR_STOP_ONEKEY_DAILY_MISSION=11402,t.CG_COST_REWARD_LIST=11150,t.CG_COST_REWARD_GET_REWARD=11151,t}();__reflect(ProtocolDefine.prototype,"ProtocolDefine");var ServerInfo=function(){function t(t){this.type=0,this.id=-1,this.name="",this.state=0,this.stateStr="",this.isNeedSpecialCode=!1,this.actorCount=0,this.tag="",this.lineList=[],this.webSocketUrl="",this.wapSocketUrl="",this.httpSocketUrl="",this.type=t}return t.prototype.addLine=function(e){null!=e&&this.type==t.TYPE_SERVER_AREA&&(e.areaServer=this,this.lineList.push(e))},t.prototype.getAreaServer=function(){return this.type==t.TYPE_SERVER_AREA?this:this.areaServer},t.prototype.isSingleLineArea=function(){return null==this.lineList||this.lineList.length<=1},t.prototype.doSelectLineMenu=function(){var e,n=[];e=new MenuActionData(GameText.getText(GameText.TI_BACK),1),n.push(e);for(var i=0;i<this.lineList.length;i++){var o=this.lineList[i];null!=o&&(e=new MenuActionData(o.name+" ("+o.getStatus()+")",2,o),n.push(e))}PanelManager.openFilterMenuPanel(n,(function(e,n){1==e?PanelManager.closeFilterMenuPanel():2==e&&(n.state==t.SERVER_STATE_STOP?AlertPanel.alertCommon("服务器维护中"):t.onSelectLineServer(n))}),this,!1,PopUpManager.CloseType.NONE)},t.prototype.getStatus=function(){return 0==Tool.isNullText(this.stateStr)?this.stateStr:""},t.prototype.getTag=function(){return 0==Tool.isNullText(this.tag)?"【"+this.tag+"】":""},t.prototype.doSelectServer=function(){return this.state==t.SERVER_STATE_STOP?void AlertPanel.alertCommon("服务器维护中"):void(this.isSingleLineArea()?t.onSelectLineServer(this.lineList[0]):this.doSelectLineMenu())},t.onSelectLineServer=function(e){t.currentSelectServerInfo=e,PanelManager.openWaitForServer("登录服务器..."),Login.instance.connectGameServer()},t.getFirstServer=function(){var e=t.gameAreaList;return null==e||0==e.length?null:t.gameAreaList[0].lineList[0]},t.getSelectServer=function(){return null==t.currentSelectServerInfo?t.getFirstServer():t.currentSelectServerInfo},t.createAreaInfo=function(){return new t(t.TYPE_SERVER_AREA)},t.createLineInfo=function(){return new t(t.TYPE_SERVER_LINE)},t.fromTouristBytes=function(e){var n=t.fromAreaBytes(e),i=t.fromLineBytes(e);return n.addLine(i),n},t.fromAreaBytes=function(e){var n=t.createAreaInfo();return n.id=e.getShort(),n.name=e.getString(),n.actorCount=e.getByte(),n.state=e.getByte(),n.stateStr=e.getString(),n.tag=e.getString(),n.isNeedSpecialCode=e.getBoolean(),n},t.fromLineBytes=function(e){var n=t.createLineInfo();return n.id=e.getShort(),n.name=e.getString(),n.webSocketUrl=e.getString(),n.wapSocketUrl=e.getString(),n.httpSocketUrl=e.getString(),n.state=e.getByte(),n.stateStr=e.getString(),n},t.prototype.toString=function(){var e="";if(this.type==t.TYPE_SERVER_AREA){e+=" id = "+this.id,e+=", 区名 = "+this.name+"("+this.tag+")",e+=", 状态 = "+this.stateStr+"("+this.state+")",e+=", 角色数量 = "+this.actorCount,e+="\n 区下分线： --\x3e";for(var n=0;n<this.lineList.length;n++){var i=this.lineList[n];null!=i&&i.type!=t.TYPE_SERVER_AREA&&(e+=i.toString())}}else this.type==t.TYPE_SERVER_LINE&&(e+=" id = "+this.id,e+=", 线名 = "+this.name+"("+this.tag+")",e+=", 状态 = "+this.stateStr+"("+this.state+")",e+=", webSocketUrl = "+this.webSocketUrl);return e},t.saveServerInfoToServer=function(){var e=t.getSelectServer();if(null!=e){GameWorld.lastServerID=e.areaServer.id,GameWorld.lastServerName=e.areaServer.name,GameWorld.lastPlayerID=xself.getId();var n=new ServerData;n.id=GameWorld.lastServerID,n.name=GameWorld.lastServerName,n.playerID=GameWorld.lastPlayerID;var i=xcacheurl+"save_data?id="+GameWorld.ukey.value+"&value="+encodeURI(JSON.stringify(n)),o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(i,egret.HttpMethod.GET),o.addEventListener(egret.IOErrorEvent.IO_ERROR,(function(t){}),this),o.send()}},t.getLastServerInfo=function(){var t=xcacheurl+"apply_data?id="+GameWorld.ukey.value,e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.open(t,egret.HttpMethod.GET),e.addEventListener(egret.Event.COMPLETE,(function(t){var e=t.currentTarget.response;if(0==Tool.isNullText(e)){e=decodeURI(e);t=JSON.parse(e);if(GameWorld.lastServerID=t.id,GameWorld.lastServerName=t.name,GameWorld.lastPlayerID=t.playerID,PanelManager.isPanelShow(AreaLineListPanel))PanelManager.getPanel(AreaLineListPanel).updateLaseServer()}}),this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,(function(){}),this),e.send()},t.SERVER_STATE_FREE=0,t.SERVER_STATE_BUSYNESS=1,t.SERVER_STATE_HOT=2,t.SERVER_STATE_FULL=3,t.SERVER_STATE_STOP=4,t.SERVER_STATE_TEST=5,t.SERVER_STATE_CLOSE=6,t.SERVER_STATE_MIX=7,t.SERVER_STATE_NEW=8,t.TYPE_SERVER_AREA=0,t.TYPE_SERVER_LINE=1,t.gameAreaList=[],t.loginedServerList=[],t}();__reflect(ServerInfo.prototype,"ServerInfo");var ServerData=function(){this.id=0,this.playerID=0};__reflect(ServerData.prototype,"ServerData");var AutoFindPath=function(){function t(){}return t.findPath=function(e,n){void 0===n&&(n=t.JUST_FIND_MAP_NPCID),n==t.JUST_FIND_MAP_NPCID?(t.isWaitForCheckNPC=!0,t.isJustFindMap=!0,n=0):(t.isWaitForCheckNPC=!1,t.isJustFindMap=!1),t.targetMapID=e,t.targetNPCID=n;var i=xworld.orgMapID;if(-1==e)if(Define.isCityMap(i))t.doAutoFindNPC();else{if(null==xself||xself.cityId<=0)return void AlertPanel.alertCommon("个人城市尚未开启！");PanelManager.closeScene(!0),PopUpManager.closeAll(),City.doEnterCity(xself.getId()),t.isWaitForCheckNPC=!0}else{0>n&&(0,t.isWaitForCheckNPC=!0),t.doAutoFindPath(e,n)}},t.doAutoFindNPC=function(){var e=t.targetMapID,n=xworld.orgMapID;if(-1==e){if(0==Define.isCityMap(n))return}else if(n!=e)return;if(t.isWaitForCheckNPC=!1,t.isJustFindMap)return t.isJustFindMap=!1,void xself.clearAutoMoveList();Define.isCityMap(n)&&(e=n);var i=t.targetNPCID;if(i==t.NPCID_achieve){var o=xworld.getAchieveNPC();o&&(i=o.getId())}else i==t.NPCID_cityTask?i=6:i==t.NPCID_senior_cityTask?i=8:i==t.NPCID_repaire?i=this.findRepairNPC():i==t.NPCID_skill?i=this.findSkillNPC():i==t.NPCID_shop&&(i=this.findCityShopNPC());this.doAutoFindPath(e,i)},t.doAutoFindPath=function(t,e){if(PanelManager.closeScene(!0),PopUpManager.closeAll(),!(0>t||0>e)){var n=MsgHandler.createAutoMoveMsg(t,e);nato.Network.sendCmd(n,(function(t){var e=t.getByte();if(0>e){var n=t.getString();e!=Mission.AUTO_MOVE_ERROR26&&e!=Mission.AUTO_MOVE_ERROR27&&AlertPanel.alertCommon(n)}else xself.fromBytesByAutoMove(t),xworld.setAutoMissionFindPath(!0)}),this)}},t.findRepairNPC=function(){var t=xworld.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n&&n.isVisible()&&n.isRepairNPC())return n.getId()}return-1},t.findSkillNPC=function(){var t=xworld.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n&&n.isVisible()&&n.isPlayerSkillTeacher())return n.getId()}return-1},t.findCityShopNPC=function(){var t=xworld.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n&&null!=n.shopID&&n.shopID.length>0&&-1!=n.getName().indexOf("神秘商人"))return n.getId()}return-1},t.findTask=function(t){PanelManager.closeScene(!0),PopUpManager.closeAll(),Mission.doMissionAutoPathMsgByID(t)},t.MAPID_city=-1,t.JUST_FIND_MAP_NPCID=1e4,t.NPCID_cityTask=-1,t.NPCID_repaire=-2,t.NPCID_skill=-3,t.NPCID_achieve=-4,t.NPCID_shop=-5,t.NPCID_senior_cityTask=-6,t.isWaitForCheckNPC=!1,t.targetMapID=0,t.targetNPCID=0,t.isJustFindMap=!1,t}();__reflect(AutoFindPath.prototype,"AutoFindPath");var guide,AutoGamer=function(){function t(){}return t.checkAcceptedMissions=function(){var e;return(e=xself.missionList.filter(t.filterAcceptedMission)).length>0?e:[]},t.checkCurMapAcceptMissions=function(){var t=[],e=xworld.orgMapID,n=xself.missionList,i=OneKeyDailyMission.curSelect_idList,o=OneKeyDailyMission.curCityTask_idList;if(n&&n.length>0)for(var a=0;a<n.length;a++){var r=n[a],s=r.getId();819!=s&&387!=s?(r.radarMapID==e||r.mapId==e||null!=i&&-1!=i.indexOf(r.getId())||null!=o&&-1!=o.indexOf(r.getId()))&&t.push(r):r.isComplete()&&t.push(r)}return t},t.filterAcceptedMission=function(t,e,n){return!!t.isComplete()||(!!t.isKillMonsterMission()||!!t.isCityBulltinMission())},t.filterAcceptableMission=function(t,e,n){var i=t.getId();return null==xself.getMissionById(i)&&(1!=Mission.isMissionFinish(xself,i)&&(t.getMissionStatus(xself)!=MissionConst.NOT_CAN_ACCEPT&&(!!t.isKillMonsterMission()||(!!t.isOneKeyMission()||(!!t.isDailyMission()||(!!t.isShowGuide()||(!!t.isDirectSubmit()||(!!t.isNestedMission()||!!t.isHaveSpecailExecute()))))))))},t.checkAcceptableMissions=function(e,n){function i(t,e){0==t.isTabStatus(Model.NPC_MISSION_LOAD)?t.doGetMissionData(e,this):e.call(this,t)}for(var o,a=xworld.npcList,r=[],s=0,l=a.length;l>s;s++)(o=a[s]).isEnable()&&o.isVisible()&&(o.isMonster||r.push(o));var _=r.length,h=0,u=[];_>0?(t.isLoadingNPCMissions=!0,i(r[h],(function o(a){h+=1;var s=a.missions;if(null!=s&&(s.map((function(t,e,n){t.npc=a})),u=u.concat(s)),h==_){t.isLoadingNPCMissions=!1;var l;(l=u.filter(t.filterAcceptableMission)).length>0?e.call(n,l):e.call(n,[])}else i(r[h],o)}))):e.call(n,[])},t.sortBySetting=function(t,e){var n=xworld.getCurMapID(),i=Math.abs(n-t.mapId),o=Math.abs(n-e.mapId);if(i>o)return 1;if(o>i)return-1;var a=1<<20,r=t.setting|(t.isCityBulltinMission()?a:0),s=e.setting|(e.isCityBulltinMission()?a:0),l=1<<19,_=null!=xself.getMissionById(t.getId()),h=null!=xself.getMissionById(e.getId());r|=t.isCityBulltinMission()&&_?l:0,s|=e.isCityBulltinMission()&&h?l:0;var u=1<<18;r|=_?u:0,s|=h?u:0;var c=1<<17;r|=t.isDirectSubmit()?c:0,s|=e.isDirectSubmit()?c:0;return r|=t.isHaveSpecailExecute()?65536:0,s|=e.isHaveSpecailExecute()?65536:0,window.DISABLE_AUTO_FIND_MISSION?r<s?-1:s>r?1:0:r>s?-1:s>r?1:0},t.moveToNPC=function(t){if(null!=t){var e=Control.createMoveTo(xself.getId(),t.getGx(),t.getGy());xself.addControl(e),(e=Control.createMoveTo(xself.getId(),t.getGx(),t.getGy())).setAutoMoveEndStep(),xself.addControl(e)}},t.requestAutoFindPath=function(e,n){var i=MsgHandler.createAutoMoveMsg(e,n);nato.Network.sendCmd(i,t.onAutoFindPath,t)},t.onAutoFindPath=function(t){var e=t.getByte();if(0>e){var n=t.getString();e!=Mission.AUTO_MOVE_ERROR26&&e!=Mission.AUTO_MOVE_ERROR27&&AlertPanel.alertCommon(n)}else xself.fromBytesByAutoMove(t),xworld.setAutoMissionFindPath(!0)},t.autoFindMission=function(e,n){function i(n){if(null!=n)if(null!=xself.getMissionById(n.getId()))if(n.isComplete())e&&(n.isCityBulltinMission()?Mission.doMissionAutoPathMsg(n):t.requestAutoFindPath(n.mapId,n.npcId));else if(n.isCityBulltinMission()){var i=Mission.cityBulltinMissions[n.getId()];t.requestAutoFindPath(i.mapid,i.npcid)}else t.checkAutoMoveToMonster(n);else{var o=n.npc;e&&t.moveToNPC(o)}}var o;if(void 0===e&&(e=!0),void 0===n&&(n=!1),OneKeyDailyMission.isDoingOnekeyMission){if(o=this.checkCurMapAcceptMissions(),OneKeyDailyMission.isIgnoreAccepted){for(var a=[],r=0;r<o.length;r++){var s=o[r];(s.isCollectItemType||s.isKillMonsterMission())&&a.push(s)}o=a,OneKeyDailyMission.isIgnoreAccepted=!1}}else o=this.checkAcceptedMissions();this.checkAcceptableMissions((function(e){(o=o.concat(e)).sort(t.sortBySetting),o.length>0?i(o.shift()):n&&xself.getLevel()>15&&PanelManager.openTodayEventPanel()}),this)},t.checkAutoMoveToMonster=function(e){if(GameWorld.curMissionID=e.getId(),1!=xself.get(ModelConst.HP)){var n,i;if(n=e.getUnCompleteKillMonsterCondition()){if(window.OneKeyDailyMission._isStarting&&!xworld.inBattle){const t=[439];if(n.acceptBattleID)return void xworld.toBattle(n.acceptBattleID);if(n.submitBattleID)return void xworld.toBattle(n.submitBattleID);const e=Object.values(xworld.monsterGroupList).filter((e=>!t.includes(e.groupId))).filter((t=>t.monsters.includes(n.id)));let i=e.map((t=>{let e=0;if(t&&t.monsters)for(let i of t.monsters)i&&i===n.id&&e++;return e})),o=-1,a=0;for(let t=0;t<i.length;t++){const e=i[t];e>=o&&(o=e,a=t)}if(e[a])return void xworld.toBattle(e[a].groupId)}return 0==xworld.autoMoveToMonster(n.id)&&Mission.doMissionAutoPathMsg(e),void t.switchAutoGaming(!0)}if(i=e.getUnCompleteCollectionCondition()){if(window.OneKeyDailyMission._isStarting&&!xworld.inBattle&&xself.controlList.length<=0){let t=window.COLLECTION_ITEM_FROM_MONSTER_GROUP_MAP[i.id]?{id:window.COLLECTION_ITEM_FROM_MONSTER_GROUP_MAP[i.id]}:void 0;if(t){const e=Object.values(xworld.monsterGroupList).find((e=>e.monsters.includes(t.id)));return void(e?xworld.toBattle(e.groupId):xworld.toBattle(t.id))}t||(t=Object.values(xworld.monsterList).find((t=>i.name.includes(t.playerName))));const e=GameWorld.findNearestMonster();if(!t&&e&&(t=e,t.battleID[0]))return void xworld.toBattle(t.battleID[0]);if(t){const e=Object.values(xworld.monsterGroupList).find((e=>e.monsters.includes(t.id)));if(e)return void xworld.toBattle(e.groupId)}}var o=GameWorld.findNearestMonster();if(null==o)return;xworld.currentTargetMonster=o;var a=Control.createMoveTo(xself.getId(),o.getGx(),o.getGy());xself.addControl(a)}t.switchAutoGaming(!0)}},t.checkAutoGameEnable=function(){return!(PanelManager.isOpeningFullScene||Main.instance.hasPopupUI||Main.instance.hasDialogueUI||t.isLoadingNPCMissions||xself.isAutoMove()||0==xself.isFree()||xself.isMember()||GameWorld.isHaveGuide()||xworld.inBattle||xworld.isJumpingMap)&&!(0==t.autoGaming&&xself.getLevel()>=t.AUTO_GAME_LEVEL_UPPER_LIMIT)},t.logic=function(e){if(!(0==t.autoGaming&&xself.getLevel()>t.AUTO_GAME_LEVEL_UPPER_LIMIT)){if(0==t.checkAutoGameEnable())return void(t.lastIdleTime=-1);if(-1==t.lastIdleTime)t.lastIdleTime=Date.now();else if(Date.now()-t.lastIdleTime>1e3){this.autoGamerCounter+=1,this.autoGamerCounter>=1e3&&(this.autoGamerCounter=0);var n=!1;this.autoGamerCounter%t.MISSION_DELAY_COUNT==0&&(n=!0),xself.isNovice?(1==t.autoGaming&&GameWorld.guideType==GameWorld.GUIDE_NONE&&t.switchAutoGaming(!1),GuideHandler.checkAutopathGuide(),1==n&&t.switchAutoGaming(!0),t.autoFindMission(n)):0==guide.isStatusFlag(guide.IS_GUIDE_SPRITE_GUIDE)&&t.autoFindMission(!0),t.lastIdleTime=-1}}},Object.defineProperty(t,"autoGaming",{get:function(){return t._autoGaming},set:function(e){t._autoGaming=e},enumerable:!0,configurable:!0}),t.switchAutoGaming=function(e){e!=t.autoGaming&&(e?(t.autoGaming=!0,PanelManager.mainMenu.autogame_btn.visible=!1,PanelManager.mainMenu.autogame_cancel_btn.visible=!0,GameWorld.guideType==GameWorld.GUIDE_AUTO_PATH_UI&&GameWorld.cleanGuide()):(t.autoGaming=!1,PanelManager.mainMenu.autogame_btn.visible=!0,PanelManager.mainMenu.autogame_cancel_btn.visible=!1),GuideHandler.checkAutopathGuide())},t.isLoadingNPCMissions=!1,t.AUTO_GAME_LEVEL_UPPER_LIMIT=15,t.lastIdleTime=-1,t.MISSION_DELAY_COUNT=7,t.autoGamerCounter=0,t._autoGaming=!1,t}();__reflect(AutoGamer.prototype,"AutoGamer"),function(t){function e(e){null!=t.arrow&&((s+=1)>=1e3&&(s=0),t.arrow_direction==t.GUIDE_ARROW_DOWN?(t.arrow.y+=1,t.arrow.y-r>=25&&(t.arrow.y=r)):(t.arrow.y-=1,r-t.arrow.y>=25&&(t.arrow.y=r)))}t.rectBoxGuiding=!1,t.arrowGuiding=!1,t.battleFailFirse=!1;var n=[1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,1121,42,2544,3060],i=[],o=[];t.isGuideMission=function(t,e){if(3060==t&&PlayerDataManager.playerData.isSpriteOpen)return!1;var a=function(t,e){var a;switch(e){case 1:a=n;break;case 2:a=i;break;case 3:a=o}return-1!=a.indexOf(t)}(t,e);return a},t.isNpcMissionMaster=function(t){return null!=t&&(2==t.getId()&&905==xworld.gameMap.mapId&&xself.getLevel()<=0)},t.isNpcMissionList=function(t){return null!=t&&(6==t.getId()&&Define.isCityMap(xworld.orgMapID)&&xself.getLevel()<=0)},t.MISSION_THAT_TRIGGERS_BATTLE_SKILL_GUIDE=2207,t.MISSION_THAT_OPEN_AUTO_FIGHT=2214,t.MISSION_THAT_TRIGGERS_SKIP_BATTLE=2214,t.MISSION_THAT_TRIGGERS_SELECT_AUTO_SKILL=2214,t.isSkipRoundUnlocked=function(){return 0==xself.isNovice},t.isSkipBattleUnlocked=function(){return 0==xself.isNovice||(null!=xself.getMissionById(t.MISSION_THAT_TRIGGERS_SKIP_BATTLE)||Mission.isMissionFinish(xself,t.MISSION_THAT_TRIGGERS_SKIP_BATTLE))},t.isAutoFightUnlocked=function(){return 0==xself.isNovice||(null!=xself.getMissionById(t.MISSION_THAT_OPEN_AUTO_FIGHT)||Mission.isMissionFinish(xself,t.MISSION_THAT_OPEN_AUTO_FIGHT))},t.startRectBoxGuide=function(e,n,i,o,a){if(void 0===a&&(a=!1),t.rectBoxGuiding=!0,null==t.rectBox){t.rectBox=new egret.Bitmap,t.rectBox.name="rectBox";var r=xhd?"select_square_hd":"select_square_sd";t.rectBox.texture=nato.getIcon(r),t.rectBox.scale9Grid=xhd?new egret.Rectangle(16,16,36,36):new egret.Rectangle(8,8,18,18)}t.rectBox.width=i,t.rectBox.height=o,t.rectBox.x=e,t.rectBox.y=n,a&&(GameWorld.bigGuideType==GameWorld.NAN_FORCE_GUIDE_TYPE?UILayer.instance.guideLayer.addChild(t.rectBox):UILayer.instance.forceGuideLayer.addChild(t.rectBox))},t.touchOutsideTheRect=function(e,n){return!Tool.rectIn(t.rectBox.x,t.rectBox.y,t.rectBox.width,t.rectBox.height,e,n)},t.finishRectBoxGuide=function(){t.rectBoxGuiding=!1,GameWorld.bigGuideType==GameWorld.NAN_FORCE_GUIDE_TYPE?t.rectBox&&UILayer.instance.guideLayer.contains(t.rectBox)&&UILayer.instance.guideLayer.removeChild(t.rectBox):t.rectBox&&UILayer.instance.forceGuideLayer.contains(t.rectBox)&&UILayer.instance.forceGuideLayer.removeChild(t.rectBox)};var a=function(t,e,n,i){this.x=t,this.y=e,this.w=n,this.h=i};t.Rect=a,__reflect(a.prototype,"guide.Rect"),t.ARROW_WIDTH=27,t.ARROW_HEIGHT=37,t.GUIDE_ARROW_UP=1,t.GUIDE_ARROW_DOWN=2,t.arrow_direction=t.GUIDE_ARROW_DOWN;var r=0;t.startArrowGuide=function(n,i,o,a){t.arrowGuiding&&nato.WorldTicker.instance.unregister(e,t),t.arrowGuiding=!0,null==t.arrow&&(t.arrow=new egret.Bitmap,t.arrow.texture=nato.findTextureForSheet(ImageSet.IMG_ARROW),t.arrow.anchorOffsetX=.5*t.ARROW_WIDTH,t.arrow.anchorOffsetY=0),t.arrow_direction==t.GUIDE_ARROW_DOWN?(t.arrow.scaleX=nato.mapRatio,t.arrow.scaleY=nato.mapRatio,r=i-t.ARROW_HEIGHT*xhdRatio):(t.arrow.scaleX=nato.mapRatio,t.arrow.scaleY=-nato.mapRatio,r=i+a+t.ARROW_HEIGHT*xhdRatio),t.arrow.x=n+o/2,t.arrow.y=r,GameWorld.bigGuideType==GameWorld.NAN_FORCE_GUIDE_TYPE?UILayer.instance.guideLayer.addChild(t.arrow):(t.arrow.visible=!0,UILayer.instance.forceGuideLayer.addChild(t.arrow)),nato.WorldTicker.instance.register(e,t)};var s=0;t.finishArrowGuide=function(){t.arrowGuiding=!1,GameWorld.bigGuideType==GameWorld.NAN_FORCE_GUIDE_TYPE?t.arrow&&UILayer.instance.guideLayer.contains(t.arrow)&&UILayer.instance.guideLayer.removeChild(t.arrow):t.arrow&&UILayer.instance.forceGuideLayer.contains(t.arrow)&&UILayer.instance.forceGuideLayer.removeChild(t.arrow),nato.WorldTicker.instance.unregister(e,t)},t.cleanGuideArrow=function(){t.arrow=null},t.ballGuiding=!1;var l=223,_=221,h=112,u=111,c=10;t.startSpriteBall=function(e,n){t.ballGuiding&&t.ball&&t.ball.setDone(),t.ballGuiding=!0,null==t.ball&&(t.ball=new MovieClip(xhd?"sprite_hd":"sprite_sd",-1),t.ball.anchorOffsetX=.5*(xhd?l:h),t.ball.anchorOffsetY=.5*(xhd?_:u)),t.ball.load();var i=UILayer.instance.forceGuideLayer;t.ball.x=i.width/2,t.ball.y=i.height/2,i.addChild(t.ball),egret.setTimeout((function(){egret.Tween.get(t.ball).to({x:e+c,y:n},1e3,egret.Ease.circOut).call((function(){PanelManager.mainMenu.setGuideSpriteShow(!0)}),this).to({alpha:0},1e3).call(t.finishBallGuide,this)}),this,1300)},t.finishBallGuide=function(){t.ballGuiding=!1,t.ball&&t.ball.setDone(),t.ball=null,GameWorld.setGuide(GameWorld.GUIDE_SPRITEGUIDE_BUTTON)};var T=0;t.IS_GUIDE_BAG_PARTNER_OPEN_UI=1,t.IS_GUIDE_BAG_PARTNER_SELECT=2,t.IS_GUIDE_BAG_PARTNER_USE=4,t.IS_GUIDE_BAG_PARTNER_GET=8,t.IS_GUIDE_PET_OPEN_UI=16,t.IS_GUIDE_CITY_OPEN_UI=32,t.IS_GUIDE_TASK_OPEN_UI=64,t.IS_GUIDE_TASK_CLOSE_UI=128,t.IS_GUIDE_TASK_LIST_GET=256,t.IS_GUIDE_SPRITE_GUIDE=512,t.IS_GUIDE_SPRITE_UI=1024,t.IS_GUIDE_BATTLE_FAIL=2048,t.IS_GUIDE_BATTLE_FAIL_2=4096,t.isStatusFlag=function(t){return 0!=(T&t)},t.setStatusFlag=function(t,e){T=Tool.setBit(t,e,T)}}(guide||(guide={}));var XiaoQiSDK=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.openLogin=function(){this.hgame=new xqhGame;var t={game_key:this.queryString("game_key"),stime:this.queryString("stime"),ticket:this.queryString("ticket"),sign:this.queryString("sign")};Sdk.channelLogin(t)},e.prototype.logout=function(){location.reload(),console.log("小7 sdk logout...")},e.prototype.order=function(t,e){var n={serverid:Sdk.getServer()};Sdk.order(t,e,n)},e.prototype.pay=function(t,e,n,i,o,a){var r={description:a.description,game_area:a.game_area,game_group:a.game_group,game_key:a.game_key,game_level:a.game_level,game_orderid:a.ext,game_price:a.game_price,game_role_id:a.game_role_id,stime:a.stime,subject:a.subject,user_id:a.user_id,sign:a.sign},s=JSON.stringify(r);this.hgame.pay(s,(function(){}),"")},e}(NoneSdk);__reflect(XiaoQiSDK.prototype,"XiaoQiSDK");var PanelManager,PopUpManager,ShopItem=function(t){function e(){var e=t.call(this)||this;return e.money1=0,e.money2=0,e.money3=0,e.integral=0,e.arenaPoint=0,e.skyarenaPoint=0,e.maxBuy=-1,e.allCount=-1,e.hotTypeOrNewItem=0,e.petComsiteInfo=null,e.combinItemID=0,e.isSystemShopItem=!1,e.power=0,e.combinCount=0,e}return __extends(e,t),e.prototype.setMoney=function(t,e){switch(t){case ModelConst.MONEY1:this.money1=e;break;case ModelConst.MONEY2:this.money2=e;break;case ModelConst.MONEY3:this.money3=e}},e.prototype.isCombin_AtoA=function(){return this.combinItemID==this.id},e.prototype.getPrice=function(){return this.money1>0?this.money1:this.money2>0?this.money2:this.money3>0?this.money3:this.integral>0?this.integral:this.arenaPoint>0?this.arenaPoint:this.skyarenaPoint>0?this.skyarenaPoint:0},e.prototype.getMoneyType=function(){return this.money1>0?ModelConst.MONEY1:this.money2>0?ModelConst.MONEY2:this.money3>0?ModelConst.MONEY3:this.integral>0?ModelConst.INTEGRAL:2},e.prototype.getMoneyString=function(t){void 0===t&&(t=1);var e=new StringBuffer;return this.money1>0&&e.append(PowerString.makeColorString(GameText.STR_MONEY1+this.money1*t,ColorUtils.COLOR_YELLOW)),this.money2>0&&e.append(PowerString.makeColorString(GameText.STR_MONEY2+this.money2*t,ColorUtils.COLOR_MONEY2)),this.money3>0&&e.append(PowerString.makeColorString(GameText.STR_MONEY3+this.money3*t,ColorUtils.COLOR_MONEY3)),e.toString()},e.fromBytesCountryStoreItem=function(t){var n=new e;return n.uid=t.getLong(),n.honor=t.getInt(),ItemData.fromBytesAtts1(n,t),ItemData.fromBytesAtts2(n,t),n.slotPos=-1,n},e.prototype.getTimeStr=function(){return 1==this.isSystemShopItem?Tool.getTimeStrByMin(this.ownTime,!0):t.prototype.getTimeStr.call(this)},e.prototype.getPowerDescInShopItem=function(t,e){return Define.getPowerDesc(t,e)},e.fromBytesShopItem=function(t,n){var i=new e;return i.isSystemShopItem=!0,ItemData.fromBytesAtts2(i,t),i.money1=t.getInt(),i.money2=t.getInt(),i.money3=t.getInt(),i.status=t.getByte(),i.maxBuy=t.getShort(),i.allCount=t.getShort(),i.hotTypeOrNewItem=t.getByte(),i.durability=i.durMax,i},e.fromBytesPlayerShopItem=function(t){var n=new e;return ItemData.fromBytesAtts1(n,t),ItemData.fromBytesAtts2(n,t),n.quantity=t.getByte(),n.money1=t.getInt(),n.money3=t.getInt(),n},e.fromBytesGoodsItem=function(t){var n=new e;return ItemData.fromBytesAtts1(n,t),ItemData.fromBytesAtts2(n,t),n.goodId=t.getLong(),n.quantity=t.getByte(),n.money1=t.getInt(),n.money3=t.getInt(),n.expireTime=t.getLong().value,n},e.fromBytesGoodsPurchaseItem=function(t,n){var i=new e;return ItemData.fromBytesAtts2(i,t),i.goodId=t.getLong(),i.quantity=t.getShort(),n&&(i.goodPurchaseCount=t.getShort(),i.quantity+=i.goodPurchaseCount),i.money1=t.getInt(),i.money3=t.getInt(),i.expireTime=t.getShort(),i},e.prototype.getDesc=function(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var o="";return this.money1>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY1)+this.money1,ColorUtils.COLOR_YELLOW)),this.money2>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY2)+this.money2,ColorUtils.COLOR_MONEY2)),this.money3>0&&(o+=PowerString.makeColorString(" "+GameText.getMoneyText(ModelConst.MONEY3)+this.money3,ColorUtils.COLOR_MONEY3)),0==Tool.isNullText(o)&&(o=Tool.manageString(GameText.STR_SHOP_ITEM_PRICE,o+"\n")),this.maxBuy>=0&&(o+=Tool.manageString(GameText.STR_ITEM_MAXBUY_INFO,PowerString.makeColorString(this.maxBuy+"",0==this.maxBuy?ColorUtils.COLOR_RED:ColorUtils.COLOR_GREEN))+"  "),this.allCount>=0&&(o+=Tool.manageString(GameText.STR_ITEM_ALLCOUNT_INFO,PowerString.makeColorString(this.allCount+"",0==this.allCount?ColorUtils.COLOR_RED:ColorUtils.COLOR_GREEN))+"\n"),this.power>0&&(o+=GameText.STR_POWER+" "+PowerString.makeColorString(this.power+"",ColorUtils.COLOR_YELLOW)+"\n"),o+t.prototype.getDesc.call(this,e,n,i)},e.prototype.getItemDesc=function(e){return t.prototype.getDesc.call(this,e,!1)},e.prototype.getCombinDesc=function(t,e,n){if(void 0===n&&(n=!1),null==t||null==t.bag)return"";var i=ItemManager.combin_countTotal>0?ItemManager.combin_countTotal:1,o=GameText.STR_SHOP_ITEM_COMBIN_MATERIAL+"\n",a=this.getMoneyString(i);if(0==Tool.isNullText(a)&&(o+=a+"\n"),null!=this.extraList&&this.extraList.length>0){for(var r=0,s=0;s<this.extraList.length;s++){var l=this.extraList[s];if(null!=l){var _=t.bag.getItemNumByID(l.id);o+=PowerString.makeColorString(l.name+" x "+l.quantity*i,Define.getGradeColor(l.grade)),l.quantity*i>_?(o+=PowerString.makeColorString(" "+Tool.manageString(GameText.STR_SHOP_ITEM_COMBIN_NOW_HAVA,_+""),ColorUtils.COLOR_RED),r=-1):(o+=" "+Tool.manageString(GameText.STR_SHOP_ITEM_COMBIN_NOW_HAVA,_+""),r>=0&&_>r&&(r=_)),o+="\n"}}this.combinCount=r}if(1==e){var h=GameText.STR_SHOP_ITEM_COMBIN_ALL;n&&(h=GameText2.STR_EQ_UPGRADE_ITEM_COMBIN_ALL),o+="\n"+h,o+="\n"+this.getNameInfo(),n&&(o+="\n"+GameText2.STR_EQ_UPGRADE_ITEM_COMBIN_ALL_INFO)}return o},e.prototype.checkCombinEnough=function(){if(null!=this.extraList&&this.extraList.length>0)for(var t=0;t<this.extraList.length;t++){var e=this.extraList[t];if(null!=e){var n=xself.bag.getItemNumByID(e.id);if(e.quantity>n){var i=e.getNameInfo()+PowerString.makeColorString(" 不足",ColorUtils.COLOR_RED);return AlertPanel.alertMaterialLessByItem(i,e),!1}}}return!0},e.prototype.getDescSimple=function(){var t="【"+name+"】";return this.money1>0&&(t+=" 金:"+this.money1),this.money2>0&&(t+=" 银:"+this.money2),this.money3>0&&(t+=" 铜:"+this.money3),t},e.reduceMoney=function(t,e,n,i){null!=t&&(t.addValue(ModelConst.MONEY1,e),t.addValue(ModelConst.MONEY2,n),t.addValue(ModelConst.MONEY3,i))},e.removeShopListItem=function(t,e,n){if(null==t)return!1;for(var i=0;i<t.length;i++){var o=t[i];if(null!=o&&o.slotPos==e)return!(o.quantity<n)&&(o.quantity-=n,o.quantity<=0&&t.splice(i,1),!0)}return!1},e.openItemShop=function(t,n,i,o,a){void 0===n&&(n=-1),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=-1);e.getShopItemList(t,(function(e){xworld.shopID=t,GameWorld.doGetItemSuit(e,(function(){o?PanelManager.openTimeLimitShopPanel(t,e,a):i?HotShop.getHotShopData((function(){PanelManager.openShopScene(t,e,n,i)}),this):PanelManager.openShopScene(t,e,n,i)}),this)}),this)},e.getShopItemList=function(t,n,i){var o=MsgHandler.createItemShopListMsg(t);nato.Network.sendCmd(o,(function(o){if(PanelManager.closeWaitForServer(),0==o.getByte()){var a=255&o.getByte();if(0>=a)return null;for(var r=[],s=0;a>s;s++){var l=e.fromBytesShopItem(o,t);r.push(l)}null!=n&&null!=i&&n.call(i,r)}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString())}),this),PanelManager.openWaitForServer()},e.doItemShopBuyMsg=function(t,n,i){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t||null==n||null==t.bag)return!1;if(!(n instanceof e))return!1;var o=xworld.shopID,a=i*n.money1,r=i*n.money2,s=i*n.money3,l=new StringBuffer,_=t.bag,h=function(e){PanelManager.closeWaitForServer();var o=e.getByte();if(0>o){var a=e.getString();if(-14==o){var r=GameText.STR_VIP,s=Tool.manageStringList(GameText.STR_VIP_SHOP_NOT_VIP,[r,r,r]);if(null==t.bag)return;if(null==t.bag.getItem(PlayerBag.SPIRIT_POS))return;AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),s,(function(){}),this)}else AlertPanel.errorMessage(a)}else{if(1==o)return xworld.doBrowseShop(xworld.shopID,null),void AlertPanel.alertCommon(GameText.STR_COUNTRY_PRICE_ADUST);if(2==o){Define.isHairItem(n.id)?(t.updateHair(n),t.refreshWorldSprite()):Define.isFaceItem(n.id)&&(t.updateFace(n),t.refreshWorldSprite()),l=new StringBuffer,t.setPlayerMoney(e.getInt(),e.getInt(),e.getInt(),l),n.maxBuy=e.getShort(),n.allCount=e.getShort();var h=GameText.STR_SHOPITEM_BUY_SUCCESS+n.getNameInfo()+"\n"+l.toString();return void AlertPanel.alertCommon(h)}if(0==o){var u=e.getInt(),c=e.getShort(),T=e.getByte(),p=e.getInt(),d=e.getInt(),E=e.getInt();if(n.maxBuy=e.getShort(),n.allCount=e.getShort(),u!=n.id||T!=i)return void WorldMessage.addSystemChat("购买返回的服务器数据物品ID和数量错误");var g=n.clone();g.status=n.status,g.setExpireTime(g.ownTime),_.addItem(PlayerBag.TYPE_BAG_POS,g,i)!=c&&WorldMessage.addSystemChat("购买返回的服务器数据物品位置错误"),l=new StringBuffer,t.setPlayerMoney(p,d,E,l);h=GameText.STR_SHOPITEM_BUY_SUCCESS+n.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+i+"\n"+l.toString();AlertPanel.alertCommon(h);var S=PanelManager.getPanel(ShopScene,!1);S&&S.stage&&S.updateMoney(),PanelManager.closeShopItemBuyPanel()}}},u=function(){var t=MsgHandler.createItemShopBuy(o,n,i);nato.Network.sendCmd(t,h,this),PanelManager.openWaitForServer()};return function(){-1!=n.maxBuy&&i>n.maxBuy?AlertPanel.alertCommon("您不能一下子购买这么多这个物品\n当前限购剩余：/cffcc00"+n.maxBuy+"/p个"):Model.checkEnoughMoney(a,r,s,u,this)}(),!0},e.doItemshopSellMsg=function(t,e,n,i){if(void 0===i&&(i=!1),0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var o=t.bag;if(null==o)return!1;var a=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString());else{var i=t.getInt();if(null!=xself){xself.setMoneyByType(ModelConst.MONEY3,i),o.removeBagItemByPos(e.slotPos,n);var a=PanelManager.getPanel(ShopScene,!1);a&&a.stage&&a.update()}}},r=function(){var t=MsgHandler.createItemShopSell(xworld.shopID,e.id,e.slotPos,n);nato.Network.sendCmd(t,a,this),PanelManager.openWaitForServer()};return i?AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),"是否确定出售所有"+e.getNameInfo(),r,this):e.grade>=Define.GRADE_3?AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_SHOP_ITEM_SELL_ASK,e.getNameInfo()),r,this):r(),!0},e.doGoodsSellFindMsg=function(t,n,i,o,a){if(null==t)return null;if(6!=t.length)return null;var r=t[0];r=Define.getGoodsType(r);var s=t[1],l=t[2],_=t[3],h=t[4],u=t[5],c=function(){};PanelManager.openWaitForServer();var T=MsgHandler.createGoodsSellFind(r,s,l,_,h,u,n,i);nato.Network.sendCmd(T,(function(t){PanelManager.closeWaitForServer();for(var n=t.getInt(),i=[],r=t.getShort(),s=0;r>s;s++){var l=e.fromBytesGoodsItem(t);i.push(l),t.getBoolean()&&(l.power=t.getInt())}GameWorld.doGetItemSuit(i,c,this),o.call(a,i,n)}),this)},e.doGoodsSellListMsg=function(t,n){var i=MsgHandler.createGoodsSellList();nato.Network.sendCmd(i,(function(i){for(var o=[],a=i.getByte(),r=0;a>r;r++)o.push(e.fromBytesGoodsItem(i)),i.getBoolean()&&(o[r].power=i.getInt());GameWorld.doGetItemSuit(o),t.call(n,o)}),this)},e.doGoodsSellSubmitMsg=function(t,e,n,i,o){if(null==t)return!1;var a=t.bag;if(null==a)return!1;if(null==e)return!1;var r=MsgHandler.createGoodsSellSubmit(e,n,i,o);return nato.Network.sendCmd(r,(function(t){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{a.removeBagItemByPos(e.slotPos,n);Define.SUCCESS,AlertPanel.alertCommon(GameText.STR_GOODS_SELL_SUCCESS),xevent.dispatchEvent(new WorldEvent(WorldEvent.HANG_SELL_SUCCESS,null))}}),this),!0},e.doGoodsSellRetrieveMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;var n=t.goodId;if(n.value<=0)return!1;var i=MsgHandler.createGoodsSellRetrieve(n);return nato.Network.sendCmd(i,(function(n){if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{MsgHandler.processAddItemMsg(n);var i=e.shopList;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=i[o];if(a&&a.goodId.value==t.goodId.value){i.splice(o,1);break}}AlertPanel.alertCommon(GameText.STR_GOODS_CANCEL_SELL_SUCCESS),xevent.dispatchEvent(new WorldEvent(WorldEvent.CANCEL_HANG_SELL_SUCCESS,null))}}),this),!0},e.doGoodsSellBuyMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;var n=t.goodId;if(n.value<=0)return!1;var i=function(t){if(0>t.getByte())AlertPanel.alertCommon(t.getString());else{var e=xself;null!=e&&(MsgHandler.processAddItemMsg(t),e.setMoneyByType(ModelConst.MONEY1,t.getInt()),e.setMoneyByType(ModelConst.MONEY3,t.getInt()),xevent.dispatchEvent(new WorldEvent(WorldEvent.HANG_SELL_BUY_SUCCESS,null)))}},o=function(){var t=MsgHandler.createGoodsSellBuy(n);nato.Network.sendCmd(t,i,this)},a=t.money1,r=t.money2,s=t.money3;return Model.checkEnoughMoney(a,r,s,(function(){var t=new StringBuffer;1==e.checkTwiceMoney(a,r,s,t)&&AlertPanel.alert(GameText.STR_SHOP_ITEM_GOODS_SELL_BUY,t.toString(),o,this)}),this),!0},e.checkTwiceMoney=function(t,e,n,i){var o="";return t>0&&(o+=PowerString.makeColorString(GameText.STR_MONEY1+t,ColorUtils.COLOR_YELLOW)+"\n"),e>0&&(o+=PowerString.makeColorString(GameText.STR_MONEY2+e,ColorUtils.COLOR_MONEY2)+"\n"),n>0&&(o+=PowerString.makeColorString(GameText.STR_MONEY3+n,ColorUtils.COLOR_MONEY3)+"\n"),0==Tool.isNullText(o)&&(i.append(Tool.manageString(GameText.STR_SHOP_ITEM_GOODS_SELL_BUY_ASK,o)),!0)},e.doGoodsPurchaseListMsg=function(t,n,i,o,a,r){var s=null!=n?n.id:0,l=function(){};PanelManager.openWaitForServer();var _=MsgHandler.createGoodsPurchaseList(t,s,Define.SEARCH_SORT_OBJ_PRICE,Define.SEARCH_SORT_TYPE_ASC,i,o);return nato.Network.sendCmd(_,(function(t){var n=t.getInt();if(0>n)AlertPanel.errorMessage(t.getString());else{for(var i=[],o=n,s=t.getShort(),_=0;s>_;_++)i.push(e.fromBytesGoodsPurchaseItem(t,!1));GameWorld.doGetItemSuit(i,l,this),a.call(r,i,o),PanelManager.closeWaitForServer()}}),this),null},e.getGoodsProvideInfo=function(t,n,i){if(void 0===n&&(n=0),void 0===i&&(i=null),null!=t&&null!=i){e.doGoodsAutoProvideMsg(t,n,i,(function(o){var a=Tool.manageStringList(GameText.STR_SHOP_ITEM_GOODS_PROVIDE_INFO,[t.name+GameText.getText(GameText.TI_ITEM_X)+i[2]+"\n",i[0]+GameText.getMoneyText(ModelConst.MONEY1)+","+i[1]+GameText.getMoneyText(ModelConst.MONEY3)+"\n"]);1==o?a+=GameText.STR_SHOP_ITEM_GOOD_PROVIDE_INFO2:2==o&&(a+=GameText.STR_SHOP_ITEM_GOOD_PROVIDE_INFO3);var r,s=function(t,e){xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_SEE_ORDER,t))},l=[];r=new MenuActionData(GameText.getText(GameText.TI_OK),1),l.push(r),r=new MenuActionData(GameText.getText(GameText.TI_SEE_ORDER),2),l.push(r),r=new MenuActionData(GameText.getText(GameText.TI_BACK),3),l.push(r),PanelManager.openSelectMenuPanel(a,l,(function(o){1==o?e.doGoodsAutoProvideMsg(t,n,i):2==o&&e.doGoodsPurchaseListMsg(t.type,t,1,1,s,this),PanelManager.closeSelectMenuPanel()}),this)}),this)}},e.doGoodsProvideMsg=function(t,e){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;0>=e&&(e=1);var n=MsgHandler.createGoodsProvideMsg(t.goodId,e);return nato.Network.sendCmd(n,(function(e){if(0>e.getByte())AlertPanel.errorMessage(e.getString());else{var n=xself;if(null!=n){var i=n.bag;if(null!=i){for(var o=0,a=e.getByte(),r=0;a>r;r++){var s=e.getShort(),l=e.getByte(),_=e.getInt(),h=i.getItem(s);null!=h&&h.id==_&&(o+=l,i.removeBagItemByPos(s,l))}var u=e.getInt(),c=e.getInt();n.addValue(ModelConst.MONEY1,u),n.addValue(ModelConst.MONEY3,c),AlertPanel.alertCommon(Tool.manageStringList(GameText.STR_GOOD_PROVIDE_SUCCESS_INFO,[o+"",(u>0?GameText.getMoneyText(ModelConst.MONEY1)+u+" ":"")+(c>0?GameText.getMoneyText(ModelConst.MONEY3)+c+" ":"")])),t.quantity<=l?(t.setStatusBit(!0,512),t.quantity=0):t.quantity-=l,xevent.dispatchEvent(new WorldEvent(WorldEvent.SUPPLY_SUCCESS))}}}}),this),!0},e.doGoodsAutoProvideMsg=function(t,e,n,i,o){if(null==t)return-1;var a=MsgHandler.createGoodsAutoProvide(t,e,n);return nato.Network.sendCmd(a,(function(e){var a=e.getByte();if(0>a)AlertPanel.errorMessage(e.getString());else{var r=e.getShort(),s=e.getInt(),l=e.getInt();if(0==a){var _=xself;if(null==_)return;var h=_.bag;if(null==h)return;if(h.removeBagItemByPos(t.slotPos,r)!=Define.SUCCESS)return;_.addValue(ModelConst.MONEY1,s),_.addValue(ModelConst.MONEY3,l);var u=(s>0?GameText.getMoneyText(ModelConst.MONEY1)+s+" ":"")+(l>0?GameText.getMoneyText(ModelConst.MONEY3)+l+" ":"");AlertPanel.alertCommon(Tool.manageStringList(GameText.STR_SHOP_ITEM_AUTO_PROVIDE_INFO,[r+"",u]))}else(1==a||2==a)&&(n[0]=s,n[1]=l,n[2]=r,i&&i.call(o,a))}}),this),-1},e.doGoodsPurchaseMyListMsg=function(t,n){var i=function(){},o=MsgHandler.createGoodsPurchaseMyList();nato.Network.sendCmd(o,(function(o){for(var a=[],r=o.getByte(),s=0;r>s;s++)a.push(e.fromBytesGoodsPurchaseItem(o,!0));GameWorld.doGetItemSuit(a,i,this),t.call(n,a)}),this)},e.doGoodsPurchaseTypeListMsg=function(t,n,i){PanelManager.openWaitForServer();var o=MsgHandler.createGoodsPurchaseTypeList(t);nato.Network.sendCmd(o,(function(t){for(var o=t.getShort(),a=[],r=0;o>r;r++){var s=new e;ItemData.fromBytesAtts2(s,t),a.push(s)}n.call(i,a),PanelManager.closeWaitForServer()}),this)},e.doGoodsPurchaseSubmitMsg=function(t,e,n,i){if(null!=t&&!(0>=e&&0>=n||0>=i)){var o=xself;if(null!=o){var a=MsgHandler.createGoodsPurchaseSubmit(t.id,i,e,n);nato.Network.sendCmd(a,(function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):(o.addValue(ModelConst.MONEY1,-e*i),o.addValue(ModelConst.MONEY3,-n*i),void AlertPanel.alertCommon(GameText.STR_SHOP_ITEM_GOOD_PUBLISH_ORDER))}),this)}}},e.doGoodsPurchaseCancelMsg=function(t,n,i){if(0!=SafeLock.doSafeLockVerify()){if(null==t)return void AlertPanel.alertCommon(GameText.STR_SHOPITEM_NO_SELETE_ITEM);var o=MsgHandler.createGoodsPurchaseCancel(t.goodId);nato.Network.sendCmd(o,(function(o){if(0>o.getByte())AlertPanel.errorMessage(o.getString());else{if(e.shopList&&e.shopList.length>0)for(var a=0;a<e.shopList.length;a++){var r=e.shopList[a];if(r&&r.uid==t.uid){e.shopList.splice(a,1);break}}n.call(i)}}),this)}},e.doGoodsPurchaseGetMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return AlertPanel.alertCommon(GameText.STR_SHOPITEM_NO_SELETE_ITEM),!1;var n=MsgHandler.createGoodsPurchaseGet(t.goodId);return nato.Network.sendCmd(n,(function(n){var i=n.getShort();if(0>i)AlertPanel.errorMessage(n.getString());else if(MsgHandler.processAddItemMsg(n),AlertPanel.alertCommon(Tool.manageString(GameText.STR_GOOD_PURCHASE_GET_INFO,i+"")),t.goodPurchaseCount>=t.quantity){if(e.shopList&&e.shopList.length>0)for(var o=0;o<e.shopList.length;o++){var a=e.shopList[o];if(a&&a.uid==t.uid){e.shopList.splice(o,1);break}}}else t.goodPurchaseCount=0,t.quantity=t.quantity-t.goodPurchaseCount}),this),!0},e.doGoodMenuButton=function(t,e){return!0},e.doGoodPublishOrder=function(t){return!1},e.isEnterAutoSell=!1,e}(ItemData);__reflect(ShopItem.prototype,"ShopItem"),function(t){function e(e){null!=t._panelList[e]&&delete t._panelList[e]}t.PANEL_INDEX=0,t.PANEL_INDEX_DEFAULT=0,t._panelList={},t.openMainMenuScene=function(){null==t.mainMenu&&(t.mainMenu=new MainMenuScene,nato.attachSkin(t.mainMenu)),UILayer.instance.uiLayer.removeChildren(),UILayer.instance.uiLayer.addChild(t.mainMenu),t.mainMenu.left=0,t.mainMenu.right=0,t.mainMenu.top=0,t.mainMenu.bottom=0,t.isOpeningFullScene=!1,t.isCanShowMessage=!0;var e=xworld.gameMap.smallMap;e&&!t.mainMenu.contains(e)&&t.mainMenu.addChild(xworld.gameMap.smallMap),t.sceneList.length=0,WorldMessage.checkToShowNextMsg()},t.updateWorldIconPoint=function(){t.mainMenu&&t.mainMenu.stage&&t.mainMenu.updateWorldIconPoint()},t.updateWorldTopMenu=function(){t.mainMenu&&t.mainMenu.stage&&t.mainMenu.updateTopMenu()},t.updateWorldTaskTarget=function(){t.mainMenu&&t.mainMenu.updateTaskTarget()},t.showMessagePanelList=["WorldMapScene","LoginLotteryPanel","EscortScene","NewEscortScene","CountryBossScene","TeamBossScene","CountryWarScene"],t.isCanShowMessage=!1,t.sceneList=[],t.isOpeningFullScene=!1,t.openScene=function(e,n){if(void 0===n&&(n=!0),t.currentScene!=e||!e.stage){var i=egret.getQualifiedClassName(e);-1==t.showMessagePanelList.indexOf(i)?(t.isCanShowMessage=!1,WorldMessage.hideWorldMsg()):t.isCanShowMessage=!0,t._sceneBg||(t._sceneBg=new egret.Shape,t._sceneBg.cacheAsBitmap=!0),(t._sceneBg.width!=nato.stageWidth||t._sceneBg.height!=nato.stageHeight)&&(t._sceneBg.graphics.clear(),t._sceneBg.graphics.beginFill(0,.9),t._sceneBg.graphics.drawRect(0,0,nato.stageWidth,nato.stageHeight),t._sceneBg.graphics.endFill()),e&&(e==t.mainMenu?t.isOpeningFullScene=!1:t.isOpeningFullScene=!0,e.scaleX=e.scaleY=nato.uiRatio,e.x=(nato.stageWidth-e.scaleX*nato.standardWidth)/2,e.y=(nato.stageHeight-e.scaleY*nato.standardHeight)/2,n&&t.sceneList.push(e),t.currentScene=e,UILayer.instance.uiLayer.removeChildren(),UILayer.instance.uiLayer.addChild(t._sceneBg),UILayer.instance.uiLayer.addChild(e),GuideHandler.setGuideWidgetVisible(!1))}},t.closeScene=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var i=t.sceneList[t.sceneList.length-1];if(null!=i&&null!=t.currentScene&&i==t.currentScene&&t.sceneList.pop(),t.PANEL_INDEX=n,!e&&t.sceneList.length>0){var o=t.sceneList.pop();t.openScene(o),t.PANEL_INDEX=t.PANEL_INDEX_DEFAULT}else 0==xworld.inBattle?t.openMainMenuScene():(UILayer.instance.uiLayer.removeChildren(),xworld.inBattleResult?UILayer.instance.uiLayer.addChild(t.battleResultPanel):t.openBattleUI());GuideHandler.setGuideWidgetVisible(!0)},t.clearSceneList=function(){t.sceneList.length=0},t.closeScenePanel=function(t){t&&t.removePanel()},t.isPanelShow=function(e){var n=egret.getQualifiedClassName(e),i=t._panelList[n];return null!=i&&null!=i.stage},t.getPanel=function(e,n){void 0===n&&(n=!0);var i=egret.getQualifiedClassName(e),o=t._panelList[i];return null!=o?o:n?(o=new e,nato.attachSkin(o),t._panelList[i]=o,o):null},t.updatePanel=function(e){var n=t.getPanel(e,!1);n&&n.stage&&null!=n.update&&n.update()},t.logic=function(n){if(n%30==0){for(var i in t._panelList){var o=t._panelList[i];if(egret.is(o,"ComponentBase")){var a=o;if(a.stage)continue;if(a.isNotClear)continue;a.clear_time-=1e3,a.clear_time<=0&&e(i)}}ObjectPool.chcek(1e3)}},t.clearPanel=e,t.openLoginPanel=function(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=t.getPanel(LoginPanel);i.setAccount(e,n),Main.instance.addUI(i)},t.closeLoginPanel=function(){var e=t.getPanel(LoginPanel);Main.instance.removeUI(e),t.clearPanel("LoginPanel")},t.openRegisterPanel=function(){var e=t.getPanel(RegisterPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!1,PopUpManager.CloseType.NONE)},t.closeRegisterPanel=function(){PopUpManager.removePopUp(t.getPanel(RegisterPanel,!1),PopUpManager.EffectType.NONE)},t.openModifyPasswordPanel=function(){var e=t.getPanel(ModifyPasswordPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!1,PopUpManager.CloseType.NONE)},t.closeModifyPasswordPanel=function(){PopUpManager.removePopUp(t.getPanel(ModifyPasswordPanel,!1),PopUpManager.EffectType.NONE)},t.openTouristPanel=function(){var e=t.getPanel(Tourist);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!1,PopUpManager.CloseType.NONE)},t.closeTouristPanel=function(){PopUpManager.removePopUp(t.getPanel(Tourist,!1),PopUpManager.EffectType.NONE)},t.openModifyNamePanel=function(e,n){null==t.modifyNamePanel&&(t.modifyNamePanel=new ModifyName,nato.attachSkin(t.modifyNamePanel)),t.modifyNamePanel.setData(e,n),PopUpManager.addPopUp(t.modifyNamePanel,PopUpManager.EffectType.SCALE_CENTER,!0)},t.closeModifyNamePanel=function(){PopUpManager.removePopUp(t.modifyNamePanel,PopUpManager.EffectType.NONE)},t.openProtectCodePanel=function(e,n){null==t.protectCodePanel&&(t.protectCodePanel=new SafeLockPassword,nato.attachSkin(t.protectCodePanel)),t.protectCodePanel.setData(e,n),PopUpManager.addPopUp(t.protectCodePanel,PopUpManager.EffectType.SCALE_CENTER,!0)},t.closeProtectCodePanel=function(){PopUpManager.removePopUp(t.protectCodePanel,PopUpManager.EffectType.NONE)},t.openModifyAccountPanel=function(e,n){null==t.modifyAccountPanel&&(t.modifyAccountPanel=new ModifyAccount,nato.attachSkin(t.modifyAccountPanel)),t.modifyAccountPanel.setData(e,n),PopUpManager.addPopUp(t.modifyAccountPanel,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeModifyAccountPanel=function(){PopUpManager.removePopUp(t.modifyAccountPanel,PopUpManager.EffectType.NONE)},t.openImgCheckPanel=function(e,n,i){var o=t.getPanel(ImgCheckPanel);o.setImgCheck(e,n,i),PopUpManager.addPopUp(o,PopUpManager.EffectType.SCALE_CENTER,!1,PopUpManager.CloseType.NONE)},t.closeImgCheckPanel=function(){PopUpManager.removePopUp(t.getPanel(ImgCheckPanel,!1))},t.openAreaLineListPanel=function(){Sdk.noneSdk&&t.closeLoginPanel();var e=t.getPanel(AreaLineListPanel);Main.instance.addUI(e)},t.closeAreaLineListPanel=function(){var e=t.getPanel(AreaLineListPanel);Main.instance.removeUI(e)},t.openBattleUI=function(){null==t.battleUI&&(t.battleUI=new BattleMenu,nato.attachSkin(t.battleUI)),UILayer.instance.uiLayer.removeChildren(),UILayer.instance.uiLayer.addChild(t.battleUI),PopUpManager.closeAll(),t.battleUI.left=0,t.battleUI.right=0,t.battleUI.top=0,t.battleUI.bottom=0},t.openBattleSkillPanel=function(e,n,i){null==t.battleSkillPanel&&(t.battleSkillPanel=new BattleSkillPanel,nato.attachSkin(t.battleSkillPanel)),t.battleSkillPanel.setData(e,n,i),t.battleUI.addChild(t.battleSkillPanel)},t.openBattleItemPanel=function(e,n,i){null==t.battleItemPanel&&(t.battleItemPanel=new BattleItemPanel,nato.attachSkin(t.battleItemPanel)),t.battleItemPanel.setData(e,n,i),t.battleUI.addChild(t.battleItemPanel)},t.openBattleResult=function(e){null==t.battleResultPanel&&(t.battleResultPanel=new BattleResult,nato.attachSkin(t.battleResultPanel)),xworld.inBattleResult=!0,t.battleResultPanel.setResult(e),UILayer.instance.uiLayer.addChild(t.battleResultPanel)},t.closeBattleResult=function(){null!=t.battleResultPanel&&UILayer.instance.uiLayer.contains(t.battleResultPanel)&&UILayer.instance.uiLayer.removeChild(t.battleResultPanel)},t.openNPCDialogue=function(e,n,i,o,a,r){if(!guide.isStatusFlag(guide.IS_GUIDE_SPRITE_GUIDE)){guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL_2)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_BATTLE_FAIL_2),guide.battleFailFirse=!1),t.npcDialogue||(t.npcDialogue=new NPCDialoguePanel,nato.attachSkin(t.npcDialogue)),t.npcDialogue.show(e,n,i,o,a,r),UILayer.instance.uiLayer.addChild(t.npcDialogue);var s=Main.instance.stage.stageWidth,l=Main.instance.stage.stageHeight,_=t.npcDialogue.width,h=t.npcDialogue.height;t.npcDialogue.x=s/2-_/2,t.npcDialogue.y=l/2-h/2;egret.callLater((function(){GuideHandler.npcDialogueGuide(t.npcDialogue)}),this)}},t.closeNPCDialogue=function(){PopUpManager.removePopUp(t.npcDialogue,PopUpManager.EffectType.NONE)},t.openBag=function(e,n){void 0===e&&(e=0),void 0===n&&(n=null),t.bagScene||(t.bagScene=new BagScene,nato.attachSkin(t.bagScene)),t.bagScene.tabIndex=e,t.bagScene.setData(null==n?xself:n),t.openScene(t.bagScene)},t.updateBag=function(){t.bagScene&&t.bagScene.stage&&t.bagScene.updatePanel()},t.openItemView=function(e,n,i,o){void 0===o&&(o=null),t.itemView||(t.itemView=new ItemView,nato.attachSkin(t.itemView)),t.itemView.show(e,n,i,o),PopUpManager.addPopUp(t.itemView,PopUpManager.EffectType.NONE,!0)},t.closeItemView=function(){PopUpManager.removePopUp(t.itemView)},t.openBattleItemView=function(e){t.battleItemView||(t.battleItemView=new BattleItemView,nato.attachSkin(t.battleItemView)),t.battleItemView.show(e),PopUpManager.addPopUp(t.battleItemView,PopUpManager.EffectType.NONE,!0)},t.closeBattleItemView=function(){PopUpManager.removePopUp(t.battleItemView)},t.openWorldMap=function(e){void 0===e&&(e=!0);var n=t.getPanel(WorldMapScene);t.openScene(n),e&&WorldMap.instance.doEnterWorldMap(),n.update()},t.openWorldMapListPanel=function(e,n){var i=t.getPanel(WorldMapListPanel);i.setData(e,n),t.openScene(i)},t.openTaskScene=function(e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.getPanel(TaskScene);i.openTab(e,n),t.openScene(i)},t.openRoleScene=function(e){var n=t.getPanel(RoleScene);n.setData(null==e?xself:e),t.openScene(n)},t.openAroundScene=function(){var e=t.getPanel(AroundScene);t.openScene(e)},t.openPlayerMenuPanel=function(e,n){var i=t.getPanel(PlayerMenuPanel);i.data=e,i.type=n,PopUpManager.addPopUp(i)},t.closeAroundCheckPlayerPanel=function(){PopUpManager.removePopUp(t.getPanel(PlayerMenuPanel))},t.openManorScene=function(e,n,i){void 0===e&&(e=0),void 0===n&&(n=ManorScene.FROM_NORMAL),void 0===i&&(i=null);var o=t.getPanel(ManorScene);ManorScene.from=n,o.setTab(e),i&&o.setCityData(i),t.openScene(o)},t.openManorManagerScene=function(e,n){var i=t.getPanel(ManorManageScene);i.setCountryData(e,n),i.tabIndex=ManorManageScene.TAB_INDEX_COUNTY,t.openScene(i)},t.openSocietyScene=function(e){void 0===e&&(e=SocietyScene.OPEN_FROM_NORMAL);var n=t.getPanel(SocietyScene);SocietyScene.from=e,t.openScene(n)},t.openDrugPanel=function(e,n,i){void 0===n&&(n=1),void 0===i&&(i=0);var o=t.getPanel(DrugPanel);o.setData(e,n,i),PopUpManager.addPopUp(o)},t.closeDrugPanel=function(){PopUpManager.removePopUp(t.getPanel(DrugPanel,!1))},t.openMailScene=function(e){void 0===e&&(e=!0);var n=t.getPanel(MailScene);t.openScene(n),e&&Mail.newMailNoticeAction()},t.openMailWritePanel=function(e,n,i){void 0===n&&(n=-1),void 0===i&&(i=null);var o=t.getPanel(MailWritePanel);o.setData(e,n,i),t.openScene(o)},t.openMailReadPanel=function(e,n){var i=t.getPanel(MailReadPanel);i.setData(e,n),t.openScene(i)},t.openMailListPanel=function(e,n){void 0===n&&(n=!0),n?Mail.doMailListMsg(e):function(){var n=t.getPanel(MailListPanel);n.setData(e),t.openScene(n)}()},t.openMailWriteToGMPanel=function(){var e=t.getPanel(MailWriteToGMPanel);t.openScene(e)},t.openMailReadFromGMPanel=function(e,n){var i=t.getPanel(MailReadFromGMPanel);i.setData(e,n),t.openScene(i)},t.openMailSelectItemPanel=function(e,n,i,o){void 0===o&&(o=!1);var a=t.getPanel(MailSelectItemPanel);a.setCallback(e,n,i,o),t.openScene(a)},t.openSystemScene=function(){var e=t.getPanel(SystemScene);t.openScene(e)},t.openSystemSettingScene=function(){var e=t.getPanel(SystemGameSettingPanel);t.openScene(e)},t.openPetScene=function(e,n){void 0===e&&(e=null),void 0===n&&(n=0);var i=t.getPanel(PetScene);i.setData(null==e?xself:e,n),t.openScene(i)},t.openPetDetailScene=function(e,n){void 0===e&&(e=null),void 0===n&&(n=0);var i=t.getPanel(PetDetailScene);if(null==e){var o=xself;o&&((e=o.getPet()).petItem=o.bag.getItem(PlayerBag.PET_POS))}i.setData(e,n),t.openScene(i)},t.openShopScene=function(e,n,i,o){void 0===i&&(i=-1),void 0===o&&(o=!1);var a=t.getPanel(ShopScene);a.setData(e,n,i,o),t.openScene(a)},t.openShopItemBuyPanel=function(e,n){void 0===n&&(n=1);var i=t.getPanel(ShopItemBuyPanel);i.setData(e,n),PopUpManager.addPopUp(i,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeShopItemBuyPanel=function(){PopUpManager.removePopUp(t.getPanel(ShopItemBuyPanel,!1))},t.openItemExchangePanel=function(e,n,i){var o=t.getPanel(ItemExchange);o.setData(e,n,i),PopUpManager.addPopUp(o,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeItemExchangePanel=function(){PopUpManager.removePopUp(t.getPanel(ItemExchange,!1))},t.openAutoSellPanel=function(e){var n=t.getPanel(AutoSellPanel);n.setData(e),PopUpManager.addPopUp(n,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeAutoSellPanel=function(){PopUpManager.removePopUp(t.getPanel(AutoSellPanel,!1))},t.openWaitForServer=function(e){void 0===e&&(e=null),t.waitForServerPanel||(t.waitForServerPanel=new WaitForServerPanel),t.waitForServerPanel.show(e),PopUpManager.addPopUp(t.waitForServerPanel,PopUpManager.EffectType.NONE,!1)},t.closeWaitForServer=function(){PopUpManager.removePopUp(t.waitForServerPanel,PopUpManager.EffectType.NONE)},t.openOnlineRewardPanel=function(){var e=t.getPanel(OnlineRewardPanel);PopUpManager.addPopUp(e)},t.closeOnlineRewardPanel=function(){PopUpManager.removePopUp(t.getPanel(OnlineRewardPanel,!1))},t.openSkillShopPanel=function(e,n){var i=t.getPanel(SkillShopPanel);i.show(e,n),t.openScene(i)},t.openSkillShopPanel_showAll=function(e){var n=t.getPanel(SkillShopPanel);n.showAll(e),t.openScene(n)},t.openSkillLearnPanel=function(e,n){var i=t.getPanel(SkillLearnPanel);i.setData(e,n),PopUpManager.addPopUp(i)},t.closeSkillLearnPanel=function(){PopUpManager.removePopUp(t.getPanel(SkillLearnPanel,!1))},t.openOtherPlayerPanel=function(e){void 0===e&&(e=!1);var n=t.getPanel(OtherPlayerPanel);t.openScene(n,!e)},t.closeOtherPlayerPanel=function(){var e=t.getPanel(SocietyScene);e&&e.friendPanel&&e.friendPanel.stage&&(e.friendPanel.currSeeItem=null),t.closeScenePanel(t.getPanel(OtherPlayerPanel))},t.openSelectMenuPanel=function(e,n,i,o,a){void 0===a&&(a=PopUpManager.CloseType.OUTSIDE);var r=t.getPanel(SelectMenuPanel);r.setData(e,n,i,o),PopUpManager.addPopUp(r,PopUpManager.EffectType.NONE,!0,a)},t.closeSelectMenuPanel=function(){PopUpManager.removePopUp(t.getPanel(SelectMenuPanel,!1),PopUpManager.EffectType.NONE)},t.openEditNameView=function(e,n,i,o,a,r,s,l){void 0===s&&(s=30),void 0===l&&(l=-1);var _=t.getPanel(EditNameView);_.setData(e,n,i,o,a,r,s,l),PopUpManager.addPopUp(_)},t.closeEditNameView=function(){PopUpManager.removePopUp(t.getPanel(EditNameView,!1))},t.openFilterMenuPanel=function(e,n,i,o,a){void 0===o&&(o=!0),void 0===a&&(a=PopUpManager.CloseType.OUTSIDE);var r=t.getPanel(FilterMenuPanel);r.setData(e,n,i,o),PopUpManager.addPopUp(r,PopUpManager.EffectType.SCALE_CENTER,!0,a)},t.closeFilterMenuPanel=function(){PopUpManager.removePopUp(t.getPanel(FilterMenuPanel,!1))},t.openStorePanel=function(e,n,i,o){if(void 0===i&&(i=!0),void 0===o&&(o=null),i)e==StorePanel.Type_person?ItemManager.doStorageListAction(n):e==StorePanel.Type_person_vip?ItemManager.doVIPStorageListAction(n):e==StorePanel.Type_country?(null==Country.myCountryStore&&(Country.myCountryStore=new Country(xself.getCountryId())),Country.myCountryStore.doCountryStorageList(!1)):e==StorePanel.Type_country_system&&(null==Country.myCountryStore&&(Country.myCountryStore=new Country(xself.getCountryId())),Country.myCountryStore.doCountryStorageList(!0));else{var a=t.getPanel(StorePanel);a.setData(e,n,o),t.openScene(a)}},t.openTradeScene=function(){var e=t.getPanel(TradeScene);t.openScene(e)},t.openActorBuyPanel=function(){var e=t.getPanel(ActorBuyScene);t.openScene(e)},t.openOtherShopPanel=function(e,n,i){var o=t.getPanel(OtherShopPanel);o.setData(e,n,i),t.openScene(o)},t.openPetCompositeSelectPanel=function(e){var n=t.getPanel(PetCompositeSelectPanel);n.setData(e),t.openScene(n)},t.openPlayerEventPanel=function(){var e=t.getPanel(PlayerEventPanel);t.openScene(e)},t.openWelcomePanel=function(){var e=t.getPanel(WelcomePanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeWelcomePanel=function(){PopUpManager.removePopUp(t.getPanel(WelcomePanel,!1))},t.openMicroPanel=function(){if(0!=showMicro&&"ios"!=nato.getPlatform()&&1==Sdk.xsdk.param.isOpenMicro){var e=t.getPanel(MicroPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)}},t.closeMicroPanel=function(){PopUpManager.removePopUp(t.getPanel(MicroPanel,!1))},t.openTradeOrderPanel=function(){var e=t.getPanel(TradeOrderPanel),n=t.getPanel(TradeScene,!1);n&&n.showSubPanel(e)},t.closeTradeOrderPanel=function(e){var n=t.getPanel(TradeScene,!1),i=t.getPanel(TradeOrderPanel,!1);n&&i&&n.closeOrderPanel(i,e)},t.openTradeSupplyBagPanel=function(){var e=t.getPanel(TradeSupplyBagPanel),n=t.getPanel(TradeScene,!1);n&&n.showSubPanel(e)},t.closeTradeSupplyBagPanel=function(e){var n=t.getPanel(TradeScene),i=t.getPanel(TradeSupplyBagPanel);n&&i&&n.closeOrderPanel(i,e)},t.openMercenaryShop=function(e){var n=t.getPanel(MercenaryShop);n.setData(e),t.openScene(n)},t.openMercenaryDetailScene=function(e,n){var i=t.getPanel(MercenaryDetailScene);i.setData(e,n),t.openScene(i)},t.openSkyArenaScene=function(e,n){var i=t.getPanel(SkyArenaScene);i.setData(e,n),t.openScene(i)},t.openArenaScene=function(e){var n=t.getPanel(ArenaScene);n.setData(e),t.openScene(n)},t.openNewArenaScene=function(e){var n=t.getPanel(NewArenaScene);n.setData(e),t.openScene(n)},t.openNewArenaRankScene=function(e){var n=t.getPanel(NewArenaRankScene);n.setData(e),t.openScene(n)},t.openNewArenaReward=function(e){var n=t.getPanel(NewArenaRewardScene);n.setData(e),t.openScene(n)},t.openEscortScene=function(e){var n=t.getPanel(EscortScene);n.setData(e),t.openScene(n)},t.openEscortRobListPanel=function(e){var n=t.getPanel(EscortRobListPanel);n.setData(e),t.openScene(n)},t.openNewEscortScene=function(e){var n=t.getPanel(NewEscortScene);n.setData(e),t.openScene(n)},t.openPetSealPanel=function(e,n,i){var o=t.getPanel(PetSeal);o.setData(e,n,i),PopUpManager.addPopUp(o,PopUpManager.EffectType.SCALE_CENTER,!0)},t.closePetSealPanel=function(){PopUpManager.removePopUp(t.getPanel(PetSeal,!1))},t.openPetNamePanel=function(e,n){var i=t.getPanel(PetName);i.setData(e,n),PopUpManager.addPopUp(i,PopUpManager.EffectType.SCALE_CENTER,!0)},t.openPetEquipDes=function(e,n){var i=t.getPanel(PetEquipDes);i.setData(e,n),PopUpManager.addPopUp(i,PopUpManager.EffectType.SCALE_CENTER,!0)},t.closePetEquipDes=function(){PopUpManager.removePopUp(t.getPanel(PetEquipDes,!1))},t.openPetSkillComparePanel=function(e,n,i,o,a,r){var s=t.getPanel(PetSkillCompare);s.setData(e,n,i,o,a,r),PopUpManager.addPopUp(s,PopUpManager.EffectType.SCALE_CENTER,!0)},t.openLoginLotteryPanel=function(){var e=t.getPanel(LoginLotteryPanel);t.openScene(e)},t.openForgeScene=function(e,n){void 0===e&&(e=0),void 0===n&&(n=null);var i=t.getPanel(ForgeScene);i.openTab(e,n),t.openScene(i)},t.openForgeMultiPanel=function(e,n,i,o){var a=t.getPanel(ForgeMultiPanel);a.setData(e,n,i,o),t.openScene(a)},t.openFurnacePanel=function(e){var n=t.getPanel(FurnacePanel);n.setData(e),t.openScene(n)},t.openFurnaceHelpPanel=function(e){var n=t.getPanel(FurnaceHelpPanel);n.setData(e),t.openScene(n)},t.openItemSelectView=function(e,n,i,o){var a=t.getPanel(ItemSelectView);a.setData(e,n,i,o),PopUpManager.addPopUp(a)},t.closeItemSelectView=function(){PopUpManager.removePopUp(t.getPanel(ItemSelectView,!1))},t.openRaidersPanel=function(e,n,i){void 0===i&&(i=0);var o=t.getPanel(RaidersPanel);o.setData(e,n,i),o.stage?o.update():t.openScene(o)},t.openPetRaidersPanel=function(e,n){var i=t.getPanel(PetRaidersPanel);i.setData(e,n),t.openScene(i)},t.openAchieveScene=function(e){var n=t.getPanel(AchieveScene);n.setData(e),t.openScene(n)},t.openAchieveTitleList=function(e,n,i,o){void 0===o&&(o=null);var a=t.getPanel(AchieveTitleList);PopUpManager.addPopUp(a),a.setData(e,n,i,o)},t.closeAchieveTitleList=function(){PopUpManager.removePopUp(t.getPanel(AchieveTitleList,!1),PopUpManager.EffectType.NONE)},t.openNewAchievePanel=function(e,n){var i=t.getPanel(NewAchievePanel);i.setData(e,n),PopUpManager.addPopUp(i)},t.openRankPanel=function(){var e=t.getPanel(RankPanel);t.openScene(e)},t.openRankRewardPanel=function(){var e=t.getPanel(RankRewardPanel);t.openScene(e)},t.openSafeLockPanel=function(e,n,i,o){void 0===o&&(o=null);var a=t.getPanel(SafeLockPanel);a.setData(e,n,i,o),t.openScene(a)},t.openSafeLockQuestionPanel=function(e){var n=t.getPanel(SafeLockQuestionPanel);t.openScene(n)},t.openChargePanel=function(e,n){void 0===n&&(n=!1);var i=t.getPanel(ChargePanel);i.setData(e),i.isBackDirect=n,t.openScene(i)},t.openChargePanelForWanba=function(e,n){void 0===n&&(n=!1);var i=t.getPanel(ChargePanelForWanba);i.setData(e),i.isBackDirect=n,t.openScene(i)},t.openTestChargePanel=function(e){var n=t.getPanel(TestChargePanel);n.setData(e),PopUpManager.addPopUp(n,PopUpManager.EffectType.NONE,!0,PopUpManager.EffectType.NONE)},t.closeTestChargePanel=function(){PopUpManager.removePopUp(t.getPanel(TestChargePanel,!1),PopUpManager.EffectType.NONE)},t.openChatUpPanel=function(e){var n=t.getPanel(ChatUpPanel);n.setData(e),t.openScene(n)},t.openChatScene=function(e,n){void 0===e&&(e=-1),void 0===n&&(n=!1);var i=t.getPanel(ChatScene);e>=0&&i.setTabChannel(e,n),t.openScene(i)},t.openFaceIconPanel=function(e,n){var i=t.getPanel(FaceIconPanel);i.setData(e,n),t.openScene(i)},t.openMasterPanel=function(){var e=t.getPanel(MasterPanel);t.openScene(e)},t.openOtherAchievePanel=function(e,n){var i=t.getPanel(AchieveOtherPanel);i.setData(e,n),t.openScene(i)},t.openDailyLotteryScene=function(){var e=t.getPanel(DailyLotteryPanel);t.openScene(e)},t.openPetSelectPanel=function(e,n){var i=t.getPanel(PetSelectPanel);i.setData(e,n),t.openScene(i)},t.openCountryArmyScene=function(){t.openScene(t.getPanel(CountryArmyScene))},t.openCountryWarScene=function(){var e=t.getPanel(CountryWarScene);t.openScene(e)},t.openCountryWarWinActionPanel=function(e){var n=t.getPanel(CountryWarWinActionPanel);n.data=e,t.openScene(n)},t.openCountryTaskListPanel=function(e,n){void 0===n&&(n=null);var i=t.getPanel(CountryTaskListPanel);i.setData(e,n),t.openScene(i)},t.openManorManageTaskReleasePanel=function(e,n,i){var o=t.getPanel(ManorManageTaskRelease);o.setData(e,n,i),PopUpManager.addPopUp(o)},t.closeManorManageTaskReleasePanel=function(){PopUpManager.removePopUp(t.getPanel(ManorManageTaskRelease,!1),PopUpManager.EffectType.NONE)},t.openCountryBossScene=function(e){var n=t.getPanel(CountryBossScene);n.setData(e),t.openScene(n)},t.openTeamBossScene=function(e){var n=t.getPanel(TeamBossScene);n.setData(e),t.openScene(n)},t.openManorManageDonate=function(e){var n=t.getPanel(ManorManageDonate);n.setData(e),t.openScene(n)},t.openManorManageResourse=function(e,n,i){var o=t.getPanel(ManorManageResourse);t.openScene(o),o.setData(e,n,i)},t.openCountryWarMyArmyListPanel=function(){var e=t.getPanel(CountryWarMyArmyListPanel);t.openScene(e)},t.openCountryWarInfoScene=function(e){void 0===e&&(e=0);var n=t.getPanel(CountryWarInfoScene);n.openTab(e),t.openScene(n)},t.openCountryWarTopScene=function(e){void 0===e&&(e=0);var n=t.getPanel(CountryWarTopScene);n.setTab(e),t.openScene(n)},t.openQuestionPanel=function(e,n,i){var o=t.getPanel(QuestionPanel);o.setData(e,n,i),PopUpManager.addPopUp(o)},t.closeQuestionPanel=function(){PopUpManager.removePopUp(t.getPanel(QuestionPanel,!1),PopUpManager.EffectType.NONE)},t.openSevenDayPanel=function(){},t.openRewardPanel=function(){var e=t.getPanel(RewardScene);t.openScene(e)},t.openTodayEventPanel=function(){var e=t.getPanel(TodayEventPanel);t.openScene(e)},t.openItemGetPanel=function(e){var n=t.getPanel(ItemGetPanel);n.setData(e),null==n.stage?PopUpManager.addPopUp(n):(n.setData(e),n.update())},t.closeItemGetPanel=function(){PopUpManager.removePopUp(t.getPanel(ItemGetPanel,!1))},t.openSpriteGuidePanel=function(e,n){void 0===n&&(n=null);var i=t.getPanel(SpriteGuidePanel);PopUpManager.addPopUp(i,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE),i.setData(e,n)},t.openFoundationPanel=function(e,n,i,o,a){var r=t.getPanel(OpenServerFoundationPanel);r.setData(e,n,i,o,a),t.openScene(r)},t.openExchangeMoneyPanel=function(){var e=t.getPanel(ExchangeMoneyPanel);t.openScene(e)},t.openOffLineExpScene=function(){var e=t.getPanel(OffLineExpScene);t.openScene(e)},t.openOffLineExpUpgradePanel=function(){var e=t.getPanel(OffLineExpUpgradePanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeOffLineExpUpgradePanel=function(){PopUpManager.removePopUp(t.getPanel(OffLineExpUpgradePanel,!1))},t.openSpringRewardPanel=function(){var e=t.getPanel(SpringRewardPanel);t.openScene(e)},t.openActivityListScene=function(){var e=t.getPanel(ActivityListScene);t.openScene(e)},t.openWishPoolScene=function(e){var n=t.getPanel(WishPoolScene);n.setInfo(e),t.openScene(n)},t.openQQBrowserLoginPanel=function(e,n){var i=t.getPanel(QQBrowserLogin);i.setData(e,n),Main.instance.stage.addChild(i)},t.closeQQBroswerLoginPanel=function(){var e=t.getPanel(QQBrowserLogin);e&&Main.instance.stage.removeChild(e)},t.openSingleChargePanel=function(e){var n=t.getPanel(SingleChargePanel);n.setData(e),t.openScene(n)},t.openAccumulatedChargePanel=function(e,n,i){var o=t.getPanel(AccumulatedChargePanel);o.setData(e,n,i),t.openScene(o)},t.openChargeActivityPanel=function(e,n,i){var o=t.getPanel(AccumulatedChargePanel);o.setChargeActivityData(e,n,i),t.openScene(o)},t.updateChargeActivityPanel=function(e,n){t.getPanel(AccumulatedChargePanel).setChargeActivityData(e,n)},t.openRedPaperScene=function(){var e=t.getPanel(RedPaperScene);PopUpManager.addPopUp(e,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeRedPaperScene=function(){PopUpManager.removePopUp(t.getPanel(RedPaperScene,!1))},t.openRedPaperDetailView=function(e){var n=t.getPanel(RedPaperDetailView);n.setData(e),PopUpManager.addPopUp(n,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},t.closeRedPaperDetailView=function(){PopUpManager.removePopUp(t.getPanel(RedPaperDetailView,!1))},t.openRedPaperRecordView=function(e,n,i){var o=t.getPanel(RedPaperRecordView);o.setData(e,n,i),PopUpManager.addPopUp(o,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},t.closeRedPaperRecordView=function(){PopUpManager.removePopUp(t.getPanel(RedPaperRecordView,!1))},t.openVIPScene=function(e){void 0===e&&(e=!1);var n=t.getPanel(VipScene);n.isBackDirect=e,t.openScene(n)},t.openFiveDayScene=function(){var e=t.getPanel(FiveDayScene);t.openScene(e)},t.openFiveDayDetailScene=function(e,n){var i=t.getPanel(FiveDayDetailScene);i.setdata(e,n),t.openScene(i)},t.openSharePanel=function(){if(xchannel!=Define.CHANNEL_WANBA){var e=t.getPanel(SinaSharePanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)}else(new WanBaSharePanel).show(PopUpManager.EffectType.NONE,PopUpManager.CloseType.OUTSIDE,!0)},t.closeSharePanel=function(){PopUpManager.removePopUp(t.getPanel(SinaSharePanel,!1))},t.openSavePanel=function(){var e=t.getPanel(SaveToDesktopPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},t.closeSavePanel=function(){PopUpManager.removePopUp(t.getPanel(SaveToDesktopPanel,!1))},t.openFollowPanel=function(){var e=t.getPanel(FollowPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},t.closeFollowPanel=function(){PopUpManager.removePopUp(t.getPanel(FollowPanel,!1))},t.openFiveDayRewardView=function(e,n){var i=t.getPanel(FiveDayRewardView);i.setData(e,n),PopUpManager.addPopUp(i,PopUpManager.EffectType.SCALE_CENTER,!0,PopUpManager.CloseType.NONE)},t.closeFiveDayRewardView=function(){PopUpManager.removePopUp(t.getPanel(FiveDayRewardView,!1))},t.openFirstChargeScene=function(){var e=t.getPanel(FirstChargeScene);t.openScene(e)},t.openItemDescView=function(e){var n=t.getPanel(ItemDescView);n.setData(e),PopUpManager.addPopUp(n)},t.closeItemDescView=function(){PopUpManager.removePopUp(t.getPanel(ItemDescView,!1))},t.openTradeEntryPanel=function(){var e=t.getPanel(TradeEntryPanel);t.openScene(e)},t.closeTradeEntryPanel=function(){PopUpManager.removePopUp(t.getPanel(TradeEntryPanel,!1))},t.openTimeLimitShopPanel=function(e,n,i){var o=t.getPanel(TimeLimitShopPanel);o.setData(e,n,i),t.openScene(o)},t.openTimeLimitExchangePanel=function(e,n,i){var o=t.getPanel(TimeLimitExchangePanel);o.setData(e,n,i),t.openScene(o)},t.openNationalDayPanel=function(e){var n=t.getPanel(NationalDayPanel);n.setData(e),t.openScene(n)},t.openThanksGivingDayExchangePanel=function(e,n,i){var o=t.getPanel(ThanksGivingDayExchangePanel);o.setData(e,n,i),t.openScene(o)},t.openOnekeyDailyMissionPanel=function(){var e=t.getPanel(OneKeyDailyMissionPanel);PopUpManager.addPopUp(e,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},t.closeOnekeyDailyMissionPanel=function(){PopUpManager.removePopUp(t.getPanel(OneKeyDailyMissionPanel,!1))},t.openInviteNewPanel=function(){(new InviteNewMainPanel).show()},t.FLAG_CATCH_INPUT=1,t.FLAG_IS_COLSE=2,t.FLAG_IS_PRESSS_CROLLBAR=4,t.FLAG_IS_DRAG_RELEASE=8,t.FLAG_IS_OUT_CLOSE=16,t.FLAG_IS_MOUSE_REPEATED=32,t.FLAG_IS_DRAW_INNER_UI=64,t.FLAG_IS_ADD_POINT_GUIDE=128,t.FLAG_IS_ADD_POINT_SURE=256,t.FLAG_IS_EVENTMSG_VERIFY=512,t.FLAG_IS_NEW_TRADE=1024,t.FLAG_IS_DELETE_PHOTO_SAY=2048,t.FLAG_IS_VIP_SHOW_MES_SHOW=4096,t.FLAG_IS_SHOW_STAR=8192,t.FLAG_IS_SHOW_SPRITE_GUIDE=16384,t.FLAG_IS_SUPERQQ_SHOW_MES=32768;var n=0;t.setStatusFlag=function(t,e){t?n|=e:n&=~e},t.isStatusFlag=function(t){return 0!=(n&t)},t.clearAllUI=function(){t.mainMenu=null,t.npcDialogue=null,t.battleUI=null,t.battleSkillPanel=null,t.battleItemPanel=null,t.battleResultPanel=null,t.bagScene=null,t.itemView=null,t.waitForServerPanel=null,t._sceneBg=null,t._panelList={},ObjectPool.clean(),PopUpManager.clearBlackBG(),FaceIcon.clearPool(),Item2.clearPool()}}(PanelManager||(PanelManager={})),function(t){function e(e){if(!guide.rectBoxGuiding){var n=(e.target,!1),o=r[r.length-1];if(o.type==u.ALL)n=!0;else if(o.type==u.OUTSIDE){var a;((a=o.panel.globalToLocal(e.stageX,e.stageY)).x<0||a.x>o.panel.width||a.y<0||a.y>o.panel.height)&&(n=!0)}n&&(e.stopImmediatePropagation(),egret.is(o.panel,"IWindowPanel")||"closePanel"in o.panel?o.panel.closePanel():t.removePopUp(o.panel),r.pop(),i())}}function n(e){e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,n,t);for(var o=r.length-1;o>=0;o--)if(r[o].panel==e.currentTarget){r.splice(o,1);break}i()}function i(){r.length<=0&&Main.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,t,!0)}var o,a,r,s=150,l=150,_=function(){};t.TouchClosePanelStruct=_,__reflect(_.prototype,"PopUpManager.TouchClosePanelStruct");var h=function(){function t(){}return t.NONE="NONE",t.SCALE_CENTER="SCALE_CENTER",t}();t.EffectType=h,__reflect(h.prototype,"PopUpManager.EffectType");var u=function(){function t(){}return t.NONE="NONE",t.OUTSIDE="OUTSIDE",t.ALL="ALL",t}();t.CloseType=u,__reflect(u.prototype,"PopUpManager.CloseType"),t.addPopUp=function(i,l,c,T,p,d){var E;if(void 0===l&&(l=h.SCALE_CENTER),void 0===c&&(c=!0),void 0===T&&(T=u.OUTSIDE),null==i||i.parent&&(egret.Tween.removeTweens(i),t.removePopUp(i,t.EffectType.NONE)),i instanceof WindowPanelBase&&(i.effectType=l),c&&(o||(o=[]),a||(a={}),o.length<=0?((E=new egret.Shape).graphics.clear(),E.graphics.beginFill(0,.5),E.graphics.drawRect(0,0,egret.MainContext.instance.stage.stageWidth,egret.MainContext.instance.stage.stageHeight),E.graphics.endFill(),E.cacheAsBitmap=!0,E.touchEnabled=!0):E=o.pop(),a[i.hashCode]=E,UILayer.instance.popupLayer.addChild(E)),T!=u.NONE){r||(r=[]);var g=new _;g.panel=i,g.type=T,Main.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,e,t,!0,1e3),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,n,t),r.push(g)}if(UILayer.instance.popupLayer.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=.5*egret.MainContext.instance.stage.stageWidth,i.y=.5*egret.MainContext.instance.stage.stageHeight,l==h.SCALE_CENTER){i.scaleX=0,i.scaleY=0;var S=egret.Tween.get(i).to({scaleX:nato.uiRatio,scaleY:nato.uiRatio},s);p&&S.call(p,d)}else i.scaleX=1,i.scaleY=1},t.removePopUp=function(t,e){if(void 0===e&&(e="SCALE_CENTER"),null!=t&&null!=t.parent){var n=function(){if(t&&t.parent&&t.parent.removeChild(t),a){var e=a[t.hashCode];e&&(e.parent&&e.parent.removeChild(e),o.push(e),delete a[t.hashCode])}};e==h.SCALE_CENTER?egret.Tween.get(t).to({scaleX:0,scaleY:0},l).call(n,this):n()}},t.closeAll=function(){for(var t in a){var e=a[t];e&&o.push(e)}UILayer.instance.clearPopupLayer(),a={}},t.clearBlackBG=function(){o=null,a=null}}(PopUpManager||(PopUpManager={}));var Tourist=function(t){function e(){var e=t.call(this)||this;return e.selectedIndex=0,e.playerList=[],e.lastLoginClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLeft,this),this.bg2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRight,this),this.btn_enterGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnterGame,this),this.player1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLeft,this),this.player2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRight,this);var n=new ListPlayer;n.setSex(Define.SEX_MALE),n.setRace(Tool.rand(0,1)),n.setModel(Tool.rand(0,2)),n.setJob(Define.JOB_RANGER),n.setName(GameText.STR_SEX_MALE);var i=new ListPlayer;i.setSex(Define.SEX_FEMALE),i.setRace(Tool.rand(0,1)),i.setModel(Tool.rand(0,2)),i.setJob(Define.JOB_WIZARD),i.setName(GameText.STR_SEX_FEMALE),this.playerList.push(n),this.playerList.push(i),n.setStyleDataToIcon(),n.refreshWorldSprite(),i.setStyleDataToIcon(),i.refreshWorldSprite(),this.sprite1=n.sprite,this.sprite2=i.sprite,this.sprite1.setScale(2.5),this.sprite2.setScale(2.5),this.player1.contains(this.sprite1)||this.player1.addChild(this.sprite1),this.player2.contains(this.sprite2)||this.player2.addChild(this.sprite2),ButtonUtils.addTouchEvent(this.btnClose,this.onClose,this)},e.prototype.onClose=function(){this.player1.removeChildren(),this.player2.removeChildren(),PanelManager.closeTouristPanel(),PanelManager.openLoginPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.bg1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLeft,this),this.bg2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRight,this),this.player1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLeft,this),this.player2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRight,this)},e.prototype.onSelectLeft=function(t){this.selected1.visible=!0,this.selected2.visible=!1,this.selectedIndex=0},e.prototype.onSelectRight=function(t){this.selected1.visible=!1,this.selected2.visible=!0,this.selectedIndex=1},e.prototype.onEnterGame=function(t){if(!(egret.getTimer()-this.lastLoginClickTime<500)){this.lastLoginClickTime=egret.getTimer();var e=this.playerList[this.selectedIndex],n=e.getSex(),i=e.getModel();GameWorld.toursex=n,GameWorld.tourstyle=i,Login.instance.isLoginServerConnected?GameWorld.doTourist(n,i):Login.instance.connectLoginServer(!0)}},e}(ComponentBase);__reflect(Tourist.prototype,"Tourist");var UILayer=function(t){function e(){var n=t.call(this)||this;return n.uiLayer=new eui.Group,n.guideLayer=new eui.Group,n.popupLayer=new eui.Group,n.broadcastLayer=new eui.Group,n.forceGuideLayer=new eui.Group,n.topLayer=new eui.Group,e.instance=n,n.init(),n}return __extends(e,t),e.prototype.init=function(){this.uiLayer.name="uiLayer",this.popupLayer.name="popupLayer",this.guideLayer.name="guideLayer",this.broadcastLayer.name="broadcastLayer",this.topLayer.name="topLayer",this.forceGuideLayer.name="forceGuideLayer",this.broadcastLayer.touchEnabled=this.broadcastLayer.touchChildren=!1,this.guideLayer.touchEnabled=!1,this.forceGuideLayer.touchEnabled=!1,this.addChild(this.uiLayer),this.addChild(this.guideLayer),this.addChild(this.popupLayer),this.addChild(this.broadcastLayer),this.addChild(this.forceGuideLayer),this.addChild(this.topLayer),this.uiLayer.left=0,this.uiLayer.right=0,this.uiLayer.top=0,this.uiLayer.bottom=0,this.broadcastLayer.left=0,this.broadcastLayer.right=0,this.broadcastLayer.top=0,this.broadcastLayer.bottom=0,this.guideLayer.left=0,this.guideLayer.right=0,this.guideLayer.top=0,this.guideLayer.bottom=0},e.prototype.clearUILayer=function(){this.uiLayer.removeChildren()},e.prototype.clearPopupLayer=function(){this.popupLayer.removeChildren()},e.prototype.clearBroadcastLayer=function(){this.broadcastLayer.removeChildren()},e.prototype.clearTopLayer=function(){this.topLayer.removeChildren()},e.prototype.clearAll=function(){this.clearUILayer(),this.clearPopupLayer(),this.clearBroadcastLayer(),this.clearTopLayer()},e}(eui.UILayer);__reflect(UILayer.prototype,"UILayer");var AchieveScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_show_titles,this.onConboBox,this),xevent.addEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.update,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_show_titles),xevent.removeEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.update,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onConboBox=function(){Achieve.doAchieveChangeTitle()},e.prototype.setData=function(t){this._achieve=t},e.prototype.updateNowTitle=function(t){this.lab_nowTitle.text=Achieve.instance.getNowTitle()},e.prototype.update=function(){if(0!=this.init&&null!=this._achieve){this.lab_dot.text=this._achieve.getNowPoint().toString(),this.lab_rank.text=this._achieve.getNowRankStr(),this.lab_had_title.text=this._achieve.getNowCount().toString(),this.lab_nowTitle.text=this._achieve.getNowTitle(),this.container.reset();for(var t=0;t<Achieve.ACHIEVE_TYPE.length;t++)if(1!=t){var e=new AchieveTypeItem;nato.attachSkin(e),e.setData(this._achieve.getTypeObjData(t),Achieve.ACHIEVE_TYPE[t],Achieve.getAchieveTypeText(t)),this.container.add(e)}this.container.update()}},e}(ComponentBase);__reflect(AchieveScene.prototype,"AchieveScene");var AchieveTitleItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onObjTouch,this),this.update()},e.prototype.onObjTouch=function(){this._type==AchieveTitleList.TYPE_ACHIEVE?Achieve.doAchieveUseTitleMsg(this._titleObjData):-1==this._id?PanelManager.closeAchieveTitleList():Country.doCountryAdjustJob2(this._model,this._id)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n,i,o){void 0===o&&(o=null),this._menueStr=t,this._id=e,this._titleObjData=n,this._model=o,this._type=i},e.prototype.update=function(){this.lab_title.text=this._menueStr},e}(ComponentBase);__reflect(AchieveTitleItem.prototype,"AchieveTitleItem");var AchieveTitleList=function(t){function e(){var e=t.call(this)||this;return e._AchieveTitleItemList=new Array,e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n,i){this._menueList=t,this._idList=e,this._type=n,this._mode=i,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(!(null==this.init||this._idList.length<0)){this.reset();for(var t=0;t<this._idList.length;t++){var n=this.getItem(),i=0,o=[];this._type==e.TYPE_ACHIEVE?(0==t?o.push(Achieve.ACHIEVE_CANCEL_TITLE):o=Achieve.instance.getTitleObjData(t-1),n.setData(this._menueList[t],this._idList[t],o,this._type)):this._type==e.TYPE_COUNTRY&&n.setData(this._menueList[t],this._idList[t],o,this._type,this._mode),i=n.height,this.container.add(n)}this.container.updateAutoSize(i*this._idList.length+10,8*i+10),this.container.update();var a=i*this._idList.length+18*xhdRatio;this.bg1.height=a>=560?560:a,this.bg2.height=this.bg1.height-20,this.bg1.touchEnabled=!1}},e.prototype.getItem=function(){if(null==(t=this._AchieveTitleItemList[this._index])){var t=new AchieveTitleItem;nato.attachSkin(t)}return this._index++,t},e.TYPE_ACHIEVE=1,e.TYPE_COUNTRY=2,e}(ComponentBase);__reflect(AchieveTitleList.prototype,"AchieveTitleList");var AchieveTypeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_newAchieve.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNewAchieve,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_newAchieve.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNewAchieve,this),RedPoint.removeRedPoint(this.btn_newAchieve)},e.prototype.onNewAchieve=function(){Achieve.instance.setBigType(this._type),Achieve.doAchieveListMsg(Achieve.instance,Achieve.ACHIEVE_TAB_TYPE_2,NewAchievePanel.pageCount,0)},e.prototype.setData=function(t,e,n){this._itemData=t,this._type=e,this._titleName=n,this.update()},e.prototype.update=function(){this.lab_dacheng.text=this._itemData[1]+"/"+this._itemData[2],this.lab_achieve.text=this._titleName,this._itemData[0]>0?RedPoint.addRedPoint(this.btn_newAchieve):RedPoint.removeRedPoint(this.btn_newAchieve)},e}(ComponentBase);__reflect(AchieveTypeItem.prototype,"AchieveTypeItem");var NewAchieveItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_click,this.onClick,this),this.group_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),xevent.addEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.update,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_click),this.group_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),xevent.removeEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.update,this)},e.prototype.setData=function(t,e,n){void 0===n&&(n=!1),this._achieveData=t,this._isNew=n,this._achieveType=e},e.prototype.onGroupTouch=function(){AlertPanel.alertTips(GameText.STR_ACHIEVE_LIST_TITLE,this._achieveData.getAchieveDesc(),"left",null,this)},e.prototype.onClick=function(){this._achieveType!=Achieve.ACHIEVE_TAB_TYPE_1||this._achieveData.getisGetReward()?this.onGroupTouch():Achieve.doAchieveGainRewardMsg(this._achieveData,this._achieveType)},e.prototype.update=function(){0!=this.init&&null!=this._achieveData&&(this.lab_title.text=this._achieveData.getName(),this.lab_value.text=this._achieveData.getSimpleDesc(),this._achieveType==Achieve.ACHIEVE_TAB_TYPE_2?this.btn_click.label=GameText.STR_MISSION_REWARD:this._achieveType==Achieve.ACHIEVE_TAB_TYPE_3||this._achieveData.getisGetReward()?(this.btn_click.label=GameText.STR_ACTOR_LOGIN_REWARD_HAS_GET,this.lab_value.text=GameText.STR_ACHIEVE_POINT+this._achieveData.getPoint()):this._achieveType==Achieve.ACHIEVE_TAB_TYPE_1&&(this.btn_click.label=GameText.STR_ACHIEVE_GET))},e}(ComponentBase);__reflect(NewAchieveItem.prototype,"NewAchieveItem");var NewAchievePanel=function(t){function e(){var e=t.call(this)||this;return e._lastAchieveBigType=-1,e._currentAchieveBigType=-1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_0,this.tabBtn_1];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}this._tabIndex=0,ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),xevent.removeEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.updateCache,this),this.update()},e.prototype.onClose=function(){PopUpManager.removePopUp(PanelManager.getPanel(e,!1))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}xevent.removeEventListener(WorldEvent.ACHIEVE_GET_AWARD,this.update,this),ButtonUtils.removeTouchEvent(this.closeBtn),RedPoint.removeRedPoint(this.tabBtn_1),this._lastAchieveBigType=this._currentAchieveBigType,this._currentAchieveBigType=-1},e.prototype.onTabBtnTouch=function(t){var n=t.target,i=this._tabBtnList.indexOf(n);i>=0&&i!=this._tabIndex&&(this._tabIndex=i,this._tabIndex==e.TAB_INDEX_2?Achieve.doAchieveListMsg(Achieve.instance,Achieve.ACHIEVE_TAB_TYPE_3,e.pageCount,0):this.update())},e.prototype.setData=function(t,n){if(this._currentAchieveBigType=Achieve.instance.getBigType(),n==Achieve.ACHIEVE_TAB_TYPE_2)this._achieveList_1=t,this.update();else if(n==Achieve.ACHIEVE_TAB_TYPE_3){for(var i in this._currentAchieveBigType!=this._lastAchieveBigType&&(this._achieveList_2=[]),t)this._achieveList_2.push(t[i]);Achieve.doAchieveListMsg(Achieve.instance,Achieve.ACHIEVE_TAB_TYPE_1,e.pageCount,0)}else if(n==Achieve.ACHIEVE_TAB_TYPE_1){for(var i in this._achieveList_3=[],t)this._achieveList_3.push(t[i]);this.update()}},e.prototype.updateCache=function(t){},e.prototype.reset=function(){this.container.reset()},e.prototype.update=function(){if(0!=this.init){if(ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.reset(),this._tabIndex==e.TAB_INDEX_1){if(this._achieveList_1)for(var t=0;t<this._achieveList_1.length;t++){var n=new NewAchieveItem;nato.attachSkin(n),n.setData(this._achieveList_1[t],Achieve.ACHIEVE_TAB_TYPE_2),this.container.add(n)}}else{if(this._achieveList_2)for(t=0;t<this._achieveList_2.length;t++){n=new NewAchieveItem;nato.attachSkin(n),n.setData(this._achieveList_2[t],Achieve.ACHIEVE_TAB_TYPE_3),this.container.add(n)}if(this._achieveList_3)for(t=0;t<this._achieveList_3.length;t++){n=new NewAchieveItem;nato.attachSkin(n),n.setData(this._achieveList_3[t],Achieve.ACHIEVE_TAB_TYPE_1,!0),this.container.add(n)}}this.container.update()}},e.TAB_INDEX_1=0,e.TAB_INDEX_2=1,e.pageCount=100,e}(ComponentBase);__reflect(NewAchievePanel.prototype,"NewAchievePanel");var AchieveOtherItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onTouch=function(){AlertPanel.alertTips(GameText.STR_ACHIEVE_LIST_TITLE,this._achieveData.getSimpleDesc(),"center",null,this)},e.prototype.setData=function(t){this._achieveData=t},e.prototype.update=function(){0!=this.init&&null!=this._achieveData&&(this.lab_title.text=this._achieveData.getName(),this.lab_dot.text=this._achieveData.getPoint().toString(),this.cacheAsBitmap=!0)},e}(ComponentBase);__reflect(AchieveOtherItem.prototype,"AchieveOtherItem");var AchieveOtherPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_achieve,this.onAchieve,this),ButtonUtils.addTouchEvent(this.btn_compare,this.onCompare,this),ButtonUtils.addTouchEvent(this.btn_explain,this.onExplain,this),this.update()},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onAchieve=function(){this._achieve.getCheckType()!=Achieve.SEARCH_ALL&&(null==this._seechieveList1?Achieve.seeOtherAchieve(this._mode,this._achieve.getPlayType()==Achieve.PLAYER_TYPE_SHOP,Achieve.SEARCH_ALL):(this._achieve.setCheckType(Achieve.SEARCH_ALL),this.update()))},e.prototype.onCompare=function(){this._achieve.getCheckType()!=Achieve.SEARCH_COMPOSE&&(null==this._seechieveList2?(Achieve.seeOtherAchieve(this._mode,this._achieve.getPlayType()==Achieve.PLAYER_TYPE_SHOP,Achieve.SEARCH_COMPOSE),AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_SEE_ACHIEVE_EXPLAIN,"center",null,this)):(this._achieve.setCheckType(Achieve.SEARCH_COMPOSE),this.update()))},e.prototype.onExplain=function(){AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_SEE_ACHIEVE_EXPLAIN,"center",null,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_compare),ButtonUtils.removeTouchEvent(this.btn_achieve),ButtonUtils.removeTouchEvent(this.btn_explain)},e.prototype.setData=function(t,e){this._mode=t,this._achieve=e,e.getCheckType()==Achieve.SEARCH_ALL?this._seechieveList1=e.getSeeAchieveList():this._seechieveList2=e.getSeeAchieveList(),this.update()},e.prototype.reset=function(){this.container.reset()},e.prototype.update=function(){if(0!=this.init&&null!=this._mode&&null!=this._achieve){if(this.container.reset(),this.lab_player_name.text=this._mode.getName(),this._achieve.getCheckType()==Achieve.SEARCH_ALL){if(null==this._seechieveList1)return;for(var t=0;t<this._seechieveList1.length;t++){var e=new AchieveOtherItem;nato.attachSkin(e),e.setData(this._seechieveList1[t]),this.container.add(e)}}else{if(null==this._seechieveList2)return;for(t=0;t<this._seechieveList2.length;t++){e=new AchieveOtherItem;nato.attachSkin(e),e.setData(this._seechieveList2[t]),this.container.add(e)}}this.container.update()}},e}(ComponentBase);__reflect(AchieveOtherPanel.prototype,"AchieveOtherPanel");var QuestionBtn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(){return this._id==NPCConst.EVENT_ALL_BACK?void PanelManager.closeQuestionPanel():void ListPlayer.answerSelect(this._id)},e.prototype.setData=function(t,e){this._label_text=t,this._id=e,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_answer.text=this._label_text)},e}(ComponentBase);__reflect(QuestionBtn.prototype,"QuestionBtn");var QuestionPanel=function(t){function e(){var e=t.call(this)||this;return e._QuestionBtnList=new Array,e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.return_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReturn,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.return_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReturn,this)},e.prototype.onBtnReturn=function(t){PanelManager.closeQuestionPanel()},e.prototype.setData=function(t,e,n){this._info=t,this._answerList=e,this._eventList=n,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),this.title_label.text="趣味答题";var t=Tool.convertDescToTextFlow(this._info);this.content_label.textFlow=t;var e=this.content_label.textHeight;e<this.content_label.size&&(e=this.content_label.size),e+=10*xhdRatio,this.content_label.height=e;var n=e+8*xhdRatio;this.bg2.height=n,this.container.y=this.bg2.y+this.bg2.height+8*xhdRatio;for(var i,o=this._answerList.length,a=0;o>a;a++){var r=this.getQuestionBtn();this.container.add(r),r.setData(this._answerList[a],this._eventList[a]),i=r.height}this.container.height=i*o,this.container.update(),this.height=this.container.y+this.container.height+10*xhdRatio}},e.prototype.getQuestionBtn=function(){var t=this._QuestionBtnList[this._index];return t||(t=new QuestionBtn,nato.attachSkin(t),this._QuestionBtnList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(QuestionPanel.prototype,"QuestionPanel");var AccumulatedChargeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._item3List&&(this._item3List=new Array),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.update()},e.prototype.onRemoveFromStage=function(e){for(var n in t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.Nummoeny),this.Nummoeny=null,this.btn_get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this._item3List)this._item3List[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onGet=function(){ActivityHandler.getAccumulatedChargeReward(this._data)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e){this._data=t,this.accuMoney=e,this.update()},e.prototype.getData=function(){return this._data},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),null==this.Nummoeny&&(this.Nummoeny=ImageNum.create(2008),this.Nummoeny.scaleX=this.Nummoeny.scaleY=1,this.img_ctn.addChild(this.Nummoeny)),this.Nummoeny.num=this._data.chargeMoney;var t=this._data.chargeMoney,e=this.accuMoney>=this._data.chargeMoney?this._data.chargeMoney:this.accuMoney;this.accuMoney-this._data.chargeMoney>=0&&this._data.isDrawed?this.btn_get.visible=!1:this.accuMoney-this._data.chargeMoney>=0&&!this._data.isDrawed?(this.btn_get.enabled=!0,this.btn_get.label="领取"):this.btn_get.enabled=!1,this.lab_progress.text=e+"/"+t;for(var n=0;n<this._data.rewardList.length;n++){var i=this.getItem();i.itemData=this._data.rewardList[n],this.container.add(i,n*(i.width-30),13)}for(var o in this.container.update(),this._item3List)this._item3List[o].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.getItem=function(){var t=this._item3List[this._index];return t||(t=new Item4,nato.attachSkin(t),this._item3List[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(AccumulatedChargeItem.prototype,"AccumulatedChargeItem");var AccumulatedChargePanel=function(t){function e(){var e=t.call(this)||this;return e.activityID=ActivityList.ID_accumulatedCharge,e._showTimeActivityId=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._accumulatedChargeItemList=[],this._chargeActivityItemList=[],this._index=0;var n=ActivityList.getDataByID(this._showTimeActivityId);this.lable_time.text=ActivityList.getTimeStr(n),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.accumulatedMoney),this.accumulatedMoney=null},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e,n){this.activityID=ActivityList.ID_accumulatedCharge,this.dataList=e,this.accuMoney=t,this._showTimeActivityId=n,this.update()},e.prototype.setChargeActivityData=function(t,e,n){void 0===n&&(n=0),this.activityID=ActivityList.ID_guanggun_charge,this.accuMoney=t,this.dataList=ChargeActivity.convertChargeActivityToChargeActivityData(e),n>0&&(this._showTimeActivityId=n),this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.updateItem=function(t){var e;this.activityID==ActivityList.ID_accumulatedCharge?e=this._accumulatedChargeItemList:this.activityID==ActivityList.ID_guanggun_charge&&(e=this._chargeActivityItemList);for(var n=0;n<e.length;n++){var i=this._accumulatedChargeItemList[n];if(null!=i){var o=i.getData();if(o.chargeId==t)return o.isDrawed=!0,i.setData(o,this.accuMoney),void this.container.updateToShowItem(this._accumulatedChargeItemList[n+1],!0)}}},e.prototype.update=function(){if(0!=this.init){this.reset(),null==this.accumulatedMoney&&(this.accumulatedMoney=ImageNum.create(2008),this.accumulatedMoney.scaleX=this.accumulatedMoney.scaleY=.6*xhdRatio,this.group_ctn.addChild(this.accumulatedMoney)),this.accumulatedMoney.num=this.accuMoney;for(var t=0;t<this.dataList.length;t++){var e=null;this.activityID==ActivityList.ID_accumulatedCharge?e=this.getAccumulatedChargeItem():this.activityID==ActivityList.ID_guanggun_charge&&(e=this.getChargeActivityItem()),e.setData(this.dataList[t],this.accuMoney),this.container.add(e),0==this.dataList[t].isDrawed&&this.dataList[t-1]&&1==this.dataList[t-1].isDrawed&&this.container.updateToShowItem(e,!0)}this.container.update()}},e.prototype.getAccumulatedChargeItem=function(){var t=this._accumulatedChargeItemList[this._index];return t||(t=new AccumulatedChargeItem,nato.attachSkin(t),this._accumulatedChargeItemList[this._index]=t),this._index++,t},e.prototype.getChargeActivityItem=function(){var t=this._chargeActivityItemList[this._index];return t||(t=new ChargeActivityItem,nato.attachSkin(t),this._chargeActivityItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(AccumulatedChargePanel.prototype,"AccumulatedChargePanel");var ActivityHandler=function(){function t(){}return t.getSingleChargeData=function(){var t=MsgHandler.createSingleChargeActivityData();PanelManager.openWaitForServer(),nato.Network.sendCmd(t,(function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){for(var e=t.getByte(),n=[],i=0;e>i;i++){var o={};o.chargeMoney=t.getInt();var a=t.getByte();o.rewardList=[];for(var r=0;a>r;r++){var s=new ItemData;s.isMoney=t.getBoolean(),s.isMoney?(s.moneyType=this.toMoneyType(t.getInt()),s.quantity=t.getInt()):(ItemData.fromBytesAtts2(s,t),s.quantity=t.getInt(),s.durMax>0&&(s.durability=s.durMax)),o.rewardList.push(s)}n.push(o)}PanelManager.openSingleChargePanel(n)}}),this)},t.getAccumulatedChargeData=function(e){void 0===e&&(e=0);var n=MsgHandler.createAccumulatedChargeActivityData();PanelManager.openWaitForServer(),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){for(var i=n.getInt(),o=n.getByte(),a=[],r=0;o>r;r++){var s={};s.chargeId=n.getInt(),s.chargeMoney=n.getInt(),s.isDrawed=n.getBoolean();var l=n.getByte();s.rewardList=[];for(var _=0;l>_;_++){var h=new ItemData;h.isMoney=n.getBoolean(),h.isMoney?(h.moneyType=t.toMoneyType(n.getInt()),h.quantity=n.getInt()):(ItemData.fromBytesAtts2(h,n),h.quantity=n.getInt(),h.durMax>0&&(h.durability=h.durMax)),s.rewardList.push(h)}a.push(s)}PanelManager.openAccumulatedChargePanel(i,a,e)}}),this)},t.getAccumulatedChargeReward=function(t){var e=MsgHandler.createAccumulatedChargeActivityReward(t.chargeId);PanelManager.openWaitForServer(),nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(e)){var n=new StringBuffer,i=e.getInt(),o=e.getInt(),a=e.getInt();xself.setMoneyByType(ModelConst.MONEY1,i,n),xself.setMoneyByType(ModelConst.MONEY2,o,n),xself.setMoneyByType(ModelConst.MONEY3,a,n);var r=MsgHandler.processAddItemMsg(e,ProtocolDefine.CG_ACTOR_DRAW_SEVEN_DAY_LOGIN_REWARD);n.append(r),WorldMessage.addTips(n.toString()),PanelManager.getPanel(AccumulatedChargePanel,!1).updateItem(t.chargeId)}}),this)},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.getFoundationData=function(){var t=MsgHandler.createFoundationData();PanelManager.openWaitForServer(),nato.Network.sendCmd(t,(function(t){if(PanelManager.closeWaitForServer(),0!=t.getBoolean()){for(var e=t.getInt(),n=[],i=0;e>i;i++){for(var o=t.getInt(),a=t.getInt(),r=[],s=0;a>s;s++){var l=new FoundationData;if(l.needTarget=t.getInt(),l.isFinish=t.getInt(),l.rewardList=[],1==o)l.rewardGold=t.getInt();else{for(var _=(t.getByte(),t.getByte()),h=0;_>h;h++){var u=new ItemData;ItemData.fromBytesAtts2(u,t),u.quantity=t.getByte(),l.rewardList.push(u)}var c,T=t.getShort(),p=t.getShort(),d=t.getShort();T>0&&((c=new ItemData).isMoney=!0,c.moneyType=ItemData.ITEM_MONEY_TYPE_1,c.quantity=T,l.rewardList.push(c)),p>0&&((c=new ItemData).isMoney=!0,c.moneyType=ItemData.ITEM_MONEY_TYPE_2,c.quantity=p,l.rewardList.push(c)),d>0&&((c=new ItemData).isMoney=!0,c.moneyType=ItemData.ITEM_MONEY_TYPE_3,c.quantity=d,l.rewardList.push(c))}r.push(l)}n.push(r)}var E=t.getLong(),g=t.getLong(),S=t.getInt(),m=t.getInt(),f=PanelManager.getPanel(OpenServerFoundationPanel,!1);f?(f.setData(E.value,g.value,S,m,n),PanelManager.openScene(f)):PanelManager.openFoundationPanel(E.value,g.value,S,m,n)}else AlertPanel.alertCommon("活动尚未开启！")}),this)},t.getFoundationReward=function(t,e){var n=MsgHandler.createFoundationReward(t,e);PanelManager.openWaitForServer(),nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){if(n.getByte()>0){if(n.getByte()>0){var i=MsgHandler.processAddItemMsg(n);WorldMessage.addTips(i)}var o=n.getInt(),a=n.getInt(),r=n.getInt();xself.setPlayerMoneyValue(o,a,r)}var s=PanelManager.getPanel(OpenServerFoundationPanel,!1);s&&s.updateItem(t,e)}}),this)},t.BuyFoundataion=function(){var e=MsgHandler.createFoundationBuy();PanelManager.openWaitForServer(),nato.Network.sendCmd(e,(function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(0>n){var i=e.getString();AlertPanel.alertCommon(i)}else if(0==n){t.getFoundationData();var o=e.getInt(),a=e.getInt(),r=e.getInt();xself.setPlayerMoneyValue(o,a,r),WorldMessage.addTips("购买成功！")}}),this)},t.getNationalDayData=function(){var e=MsgHandler.createNationalDay();PanelManager.openWaitForServer(),nato.Network.sendCmd(e,(function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(0>=n)AlertPanel.alertCommon("当前无排行数据！");else{for(var i=[],o=0;n>o;o++){var a={};a.actorId=e.getInt(),a.actorName=e.getString(),a.chargeMoney=e.getInt();var r=e.getByte();a.rewardList=[];for(var s=0;r>s;s++){var l=new ItemData;l.isMoney=e.getBoolean(),l.isMoney?(l.moneyType=t.toMoneyType(e.getInt()),l.quantity=e.getInt()):(ItemData.fromBytesAtts2(l,e),l.quantity=e.getInt(),l.durMax>0&&(l.durability=l.durMax)),a.rewardList.push(l)}i.push(a)}PanelManager.openNationalDayPanel(i)}}),this)},t}();__reflect(ActivityHandler.prototype,"ActivityHandler");var ActivityList=function(){function t(){}return t.fromBytes=function(e){t.dataList=null;for(var n=[],i=e.getShort(),o=0;i>o;o++){var a=new ActivityListData;a.id=e.getInt(),a.title=e.getString(),a.detailInfo=e.getString(),a.startTime=e.getInt(),a.endTime=e.getInt(),a.startDate=new Date(1e3*a.startTime),a.endDate=new Date(1e3*a.endTime),n.push(a)}t.dataList=n},t.getDataByID=function(t){if(this.dataList)for(var e=0;e<this.dataList.length;e++){var n=this.dataList[e];if(n.id==t)return n}return null},t.getTimeStr=function(t,e){if(void 0===e&&(e=!1),null==t)return"";var n="";if(t.endDate.getFullYear()-t.startDate.getFullYear()>=3)return"永久";if(e){var i=Tool.currentTime;if(t.endDate.getTime()<=i)return"已结束"}n=t.startDate.getMonth()+1+"月"+t.startDate.getDate()+"日";var o=t.startDate.getHours();10>o&&(n+="0"),n+=o+":";var a=t.startDate.getMinutes();return 10>a&&(n+="0"),n+=a+"",n+=" - ",n+=t.endDate.getMonth()+1+"月"+t.endDate.getDate()+"日",10>(o=t.endDate.getHours())&&(n+="0"),n+=o+":",10>(a=t.endDate.getMinutes())&&(n+="0"),n+(a+"")},t.isOpen=!1,t.ID_foundation=1003,t.ID_singleCharge=1e3,t.ID_accumulatedCharge=1001,t.ID_wishPool=1002,t.ID_guoqing_charge=1004,t.ID_guoqing_shop=1005,t.ID_guoqing_exchange=1006,t.ID_limit_time_shop_doubel_11=1007,t.ID_guanggun_charge=1008,t.ID_ganenjie_shop=1009,t.ID_ganenjie_exchange=1010,t.ID_ganenjie_charge=1011,t.ID_shengdan_shop=1012,t.ID_shengdan_charge=1013,t.ID_yuandan_shop=1015,t.ID_yuandan_charge=1014,t.ID_chunjieyure_charge=1016,t.ID_chunjie_charge=1017,t.ID_chunjie_shop=1018,t.ID_chunjie_exchange=1019,t.ID_yuanxiao_charge=1021,t.ID_yuanxiao_shop=1022,t.ID_time_limit_charge=1023,t.ID_time_limit_shop=1024,t.ID_38_time_limit_shop=1025,t.ID_38_time_limit_charge=1026,t.ID_qingming_time_limit_shop=1028,t.ID_qingming_time_limit_charge=1027,t.ID_laodong_time_limit_shop=1030,t.ID_laodong_exchange=1029,t.ID_laodong_time_limit_charge=1031,t.ID_mothers_day_limit_shop=1032,t.ID_mothers_day_limit_charge=1033,t.ID_duanwu_limit_charge=1034,t.ID_duanwu_limit_shop=1035,t.ID_xinqu_limit_charge=1046,t.ID_xinqu_limit_shop=1047,t.ID_mj_limit_charge=1038,t.ID_mj_limit_shop=1039,t.ID_znq_limit_charge=1040,t.ID_znq_limit_shop=1041,t.ID_znq_exchange=1042,t.ID_zqgq_limit_charge=1043,t.ID_zqgq_limit_shop=1045,t.ID_zqgq_exchange=1044,t.ID_yqhy_rebate=1048,t.ID_ljxf_consume=2e3,t}();__reflect(ActivityList.prototype,"ActivityList");var ActivityListData=function(){this.id=0,this.startTime=0,this.endTime=0,this.startDate=null,this.endDate=null};__reflect(ActivityListData.prototype,"ActivityListData");var ActivityListScene=function(t){function e(){var e=t.call(this)||this;return e._itemList={},e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.reset=function(){this.init},e.prototype.update=function(){var t,e;this.init&&(this.container.reset(),(t=ActivityList.getDataByID(ActivityList.ID_zqgq_limit_charge))&&(e=this.getItem(ActivityList.ID_zqgq_limit_charge,"gqhd_img2","ljcz_img3","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_zqgq_limit_shop))&&(e=this.getItem(ActivityList.ID_zqgq_limit_shop,"gqhd_img2","gqhd_img4","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_zqgq_exchange))&&(e=this.getItem(ActivityList.ID_zqgq_exchange,"gqhd_img2","gqhd_img4","gqhd_img7",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_znq_limit_charge))&&(e=this.getItem(ActivityList.ID_znq_limit_charge,"znq_img2","znq_img4","",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_znq_limit_shop))&&(e=this.getItem(ActivityList.ID_znq_limit_shop,"znq_img2","znq_img5","",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_znq_exchange))&&(e=this.getItem(ActivityList.ID_znq_exchange,"znq_img2","znq_img3","",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_mj_limit_charge))&&(e=this.getItem(t.id,"mj_img4","ljcz_img","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_mj_limit_shop))&&(e=this.getItem(t.id,"mj_img4","xssd_img","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_xinqu_limit_charge))&&(e=this.getItem(t.id,"kfjj_img3","ljcz_img3","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_ljxf_consume))&&(e=this.getItem(t.id,"ljxf_img2","ljxf_img1","ljxf_img3",ActivityList.getTimeStr(t),-30),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_xinqu_limit_shop))&&(e=this.getItem(t.id,"kfjj_img3","dbcz_img3","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_duanwu_limit_charge))&&(e=this.getItem(t.id,"duanwu_img2","duanwu_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_duanwu_limit_shop))&&(e=this.getItem(t.id,"duanwu_img2","duanwu_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_mothers_day_limit_charge))&&(e=this.getItem(t.id,"51_img4","mothers_day_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_mothers_day_limit_shop))&&(e=this.getItem(t.id,"51_img4","mothers_day_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_laodong_time_limit_charge))&&(e=this.getItem(ActivityList.ID_laodong_time_limit_charge,"51_img4","51_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_laodong_time_limit_shop))&&(e=this.getItem(ActivityList.ID_laodong_time_limit_shop,"51_img4","51_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_laodong_exchange))&&(e=this.getItem(ActivityList.ID_laodong_exchange,"51_img4","51_img1","ganenjie_img4",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_qingming_time_limit_charge))&&(e=this.getItem(ActivityList.ID_qingming_time_limit_charge,"38_img2","38_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_qingming_time_limit_shop))&&(e=this.getItem(ActivityList.ID_qingming_time_limit_shop,"38_img2","38_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_38_time_limit_charge))&&(e=this.getItem(ActivityList.ID_38_time_limit_charge,"38_img2","38_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_38_time_limit_shop))&&(e=this.getItem(ActivityList.ID_38_time_limit_shop,"38_img2","38_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_time_limit_charge))&&(e=this.getItem(ActivityList.ID_time_limit_charge,"yuanxiao_img2","yuanxiao_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_time_limit_shop))&&(e=this.getItem(ActivityList.ID_time_limit_shop,"yuanxiao_img2","yuanxiao_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_yuanxiao_charge))&&(e=this.getItem(ActivityList.ID_yuanxiao_charge,"yuanxiao_img2","yuanxiao_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_yuanxiao_shop))&&(e=this.getItem(ActivityList.ID_yuanxiao_shop,"yuanxiao_img2","yuanxiao_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_chunjie_charge))&&(e=this.getItem(ActivityList.ID_chunjie_charge,"chunjie_img4","chunjie_img5","chunjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_chunjie_shop))&&(e=this.getItem(ActivityList.ID_chunjie_shop,"chunjie_img4","chunjie_img5","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_chunjie_exchange))&&(e=this.getItem(ActivityList.ID_chunjie_exchange,"chunjie_img4","chunjie_img5","ganenjie_img4",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_chunjieyure_charge))&&(e=this.getItem(ActivityList.ID_chunjieyure_charge,"chunjie_img2","chunjie_img1","chunjie_img3",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_yuandan_shop))&&(e=this.getItem(ActivityList.ID_yuandan_shop,"yuandanjie_img2","yuandanjie_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_yuandan_charge))&&(e=this.getItem(ActivityList.ID_yuandan_charge,"yuandanjie_img2","yuandanjie_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_shengdan_shop))&&(e=this.getItem(ActivityList.ID_shengdan_shop,"shengdanjie_img2","shengdanjie_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_shengdan_charge))&&(e=this.getItem(ActivityList.ID_shengdan_charge,"shengdanjie_img2","shengdanjie_img1","shengdanjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_ganenjie_shop))&&(e=this.getItem(ActivityList.ID_ganenjie_shop,"ganenjie_img2","ganenjie_img1","gqhd_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_ganenjie_exchange))&&(e=this.getItem(ActivityList.ID_ganenjie_exchange,"ganenjie_img2","ganenjie_img1","ganenjie_img4",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_ganenjie_charge))&&(e=this.getItem(ActivityList.ID_ganenjie_charge,"ganenjie_img2","ganenjie_img1","ganenjie_img6",ActivityList.getTimeStr(t),-7*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_guoqing_charge))&&(e=this.getItem(ActivityList.ID_guoqing_charge,"gqhd_img2","gqhd_img4","gqhd_img3",ActivityList.getTimeStr(t),-10*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_guoqing_shop))&&(e=this.getItem(ActivityList.ID_guoqing_shop,"gqhd_img2","gqhd_img4","gqhd_img6",ActivityList.getTimeStr(t),-10*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_guoqing_exchange))&&(e=this.getItem(ActivityList.ID_guoqing_exchange,"gqhd_img2","gqhd_img4","gqhd_img7",ActivityList.getTimeStr(t),-10*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_limit_time_shop_doubel_11))&&(e=this.getItem(ActivityList.ID_limit_time_shop_doubel_11,"gqhd_img2","ggj_img1","gqhd_img6",ActivityList.getTimeStr(t),-10*xhdRatio),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_guanggun_charge))&&((e=this.getItem(t.id,"ljcz_img4","ljcz_img3","ljcz_img5",ActivityList.getTimeStr(t))).img_pic3.x=120,e.img_pic3.y=100,e.addImage("ggj_img1",210,60),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_foundation))&&(e=this.getItem(t.id,"kfjj_img4","kfjj_img5","kfjj_img2",ActivityList.getTimeStr(t)),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_singleCharge))&&(e=this.getItem(t.id,"dbcz_img4","dbcz_img1","dbcz_img3",ActivityList.getTimeStr(t)),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_accumulatedCharge))&&(e=this.getItem(t.id,"ljcz_img4","ljcz_img3","ljcz_img5",ActivityList.getTimeStr(t)),this.container.add(e)),(t=ActivityList.getDataByID(ActivityList.ID_wishPool))&&(e=this.getItem(t.id,"xyc_img2","xyc_img1","xyc_img3",ActivityList.getTimeStr(t)),this.container.add(e)),e=this.getItem(ActivityList.ID_yqhy_rebate,"yqhy_img2","yqhy_img1","yqhy_img3","永久",-20),this.container.add(e),InviteNewDataModel.instance.checkReward((function(t){e.imgRedTips.visible=t}),this),this.container.update())},e.prototype.getItem=function(t,e,n,i,o,a){if(void 0===a&&(a=0),null!=this._itemList[""+t])return this._itemList[""+t];var r=new ActivityListSceneItem;return nato.attachSkin(r),r.initData(t,e,n,i,o,a),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListItemTouch,this),this._itemList[""+t]=r,"znq_img2"==e?(r.img_pic1.x=25,r.img_pic1.y=15):(r.img_pic1.x=106,r.img_pic1.y=10),r},e.prototype.onListItemTouch=function(t){var e=t.target;if(e&&null!=e.activityID&&e.activityID>0){var n=e.activityID;n==ActivityList.ID_accumulatedCharge?ActivityHandler.getAccumulatedChargeData():n==ActivityList.ID_foundation?ActivityHandler.getFoundationData():n==ActivityList.ID_singleCharge?ActivityHandler.getSingleChargeData():n==ActivityList.ID_wishPool&&WishPool.doOpenWishPool(),n==ActivityList.ID_guoqing_charge?ActivityHandler.getNationalDayData():n==ActivityList.ID_guoqing_shop?ShopItem.openItemShop(2155,-1,!1,!0):n==ActivityList.ID_guoqing_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10089,!0):n==ActivityList.ID_limit_time_shop_doubel_11?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_guanggun_charge||n==ActivityList.ID_ganenjie_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_ganenjie_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_ganenjie_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10200,!0):n==ActivityList.ID_shengdan_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_shengdan_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_yuandan_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_yuandan_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_chunjieyure_charge||n==ActivityList.ID_chunjie_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_chunjie_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_chunjie_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10201,!0):n==ActivityList.ID_yuanxiao_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_yuanxiao_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_time_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0):n==ActivityList.ID_time_limit_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_38_time_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,ActivityList.ID_38_time_limit_shop):n==ActivityList.ID_38_time_limit_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_qingming_time_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,ActivityList.ID_qingming_time_limit_shop):n==ActivityList.ID_qingming_time_limit_charge?ChargeActivity.doGetChargeActivityLists():n==ActivityList.ID_laodong_time_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_laodong_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10201,!0):n==ActivityList.ID_laodong_time_limit_shop||n==ActivityList.ID_mothers_day_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_mothers_day_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_duanwu_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_duanwu_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_xinqu_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_xinqu_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_mj_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_mj_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_znq_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_znq_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_znq_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10201,!0):n==ActivityList.ID_zqgq_limit_shop?ShopItem.openItemShop(2001,-1,!1,!0,n):n==ActivityList.ID_zqgq_limit_charge?ChargeActivity.doGetChargeActivityLists(n):n==ActivityList.ID_zqgq_exchange?GameWorld.doEnterCombinShop(ShopType.SUB_SHOP_COMBIN,10201,!0):n==ActivityList.ID_yqhy_rebate?PanelManager.openInviteNewPanel():n==ActivityList.ID_ljxf_consume&&ActivityService.instance.openActivity("ConsumeActivity")}},e}(ComponentBase);__reflect(ActivityListScene.prototype,"ActivityListScene");var ActivityListSceneItem=function(t){function e(){var e=t.call(this)||this;return e._activityID=0,e._pic3PosY=0,e._isInitSource=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initItem()},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this._otherImgList&&this._otherImgList.length>0){for(var n=0;n<this._otherImgList.length;n++){var i=this._otherImgList[n];i&&i.parent&&i.parent.removeChild(i)}this._otherImgList.length=0}},e.prototype.initData=function(t,e,n,i,o,a){void 0===a&&(a=0),this._activityID=t,this._pic1=e,this._pic2=n,this._pic3=i,this._timeStr=o,this._pic3PosY=a,this.initItem()},e.prototype.addImage=function(t,e,n){var i=new eui.Image;i.source=t+(xhd?"_hd":"_sd"),i.x=e,i.y=n,this.addChild(i),null==this._otherImgList&&(this._otherImgList=[]),this._otherImgList.push(i)},e.prototype.initItem=function(){this.init&&0==this._isInitSource&&(this.img_pic1.source=this._pic1+(xhd?"_hd":"_sd"),this.img_pic2.source=this._pic2+(xhd?"_hd":"_sd"),this.img_pic3.source=this._pic3+(xhd?"_hd":"_sd"),this.label_time.text=this._timeStr,this.img_pic3.y+=this._pic3PosY,this._isInitSource=!0)},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(ActivityListSceneItem.prototype,"ActivityListSceneItem");var ChargeActivityData=function(){function t(){this._chargeActivityIndex=0}return Object.defineProperty(t.prototype,"chargeId",{get:function(){return this._chargeId},set:function(t){this._chargeId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeMoney",{get:function(){return this._chargeMoney},set:function(t){this._chargeMoney=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDrawed",{get:function(){return this._isDrawed},set:function(t){this._isDrawed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardList",{get:function(){return this._rewardList},set:function(t){this._rewardList=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeActivitySrc",{get:function(){return this._chargeActivitySrc},set:function(t){this._chargeActivitySrc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeActivityIndex",{get:function(){return this._chargeActivityIndex},set:function(t){this._chargeActivityIndex=t},enumerable:!0,configurable:!0}),t}();__reflect(ChargeActivityData.prototype,"ChargeActivityData");var ChargeActivityItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._item3List&&(this._item3List=new Array),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.update()},e.prototype.onRemoveFromStage=function(e){for(var n in t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.Nummoeny),this.Nummoeny=null,this.btn_get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this._item3List)this._item3List[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onGet=function(){var t=this._data.chargeActivitySrc;null!=t&&t.doGetChargeActivityItem(t.item.id,this._data.chargeActivityIndex)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e){this._data=t,this.accuMoney=e,this.update()},e.prototype.getData=function(){return this._data},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),null==this.Nummoeny&&(this.Nummoeny=ImageNum.create(2008),this.Nummoeny.scaleX=this.Nummoeny.scaleY=1,this.img_ctn.addChild(this.Nummoeny)),this.Nummoeny.num=this._data.chargeMoney;var t=this._data.chargeMoney,e=this.accuMoney>=this._data.chargeMoney?this._data.chargeMoney:this.accuMoney;this.accuMoney-this._data.chargeMoney>=0&&this._data.isDrawed?this.btn_get.visible=!1:this.accuMoney-this._data.chargeMoney>=0&&!this._data.isDrawed?(this.btn_get.enabled=!0,this.btn_get.label="领取"):this.btn_get.enabled=!1,this.lab_progress.text=e+"/"+t;for(var n=0;n<this._data.rewardList.length;n++){var i=this.getItem();i.label_name.horizontalCenter=xhd?100:50,i.label_name.y=xhd?18:9,i.itemData=this._data.rewardList[n],this.container.add(i,n*(i.width-30),13)}for(var o in this.container.update(),this._item3List)this._item3List[o].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.getItem=function(){var t=this._item3List[this._index];return t||(t=new Item4,nato.attachSkin(t),this._item3List[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ChargeActivityItem.prototype,"ChargeActivityItem");var FirstCharge=function(){function t(){}return t.fromBytes=function(e){for(var n=[],i=e.getByte(),o=0;i>o;o++){var a=new ItemData;e.getBoolean()?(a.isMoney=!0,a.moneyType=this.toMoneyType(e.getInt()),a.quantity=e.getInt()):(a.isMoney=!1,ItemData.fromBytesAtts2(a,e),a.quantity=e.getInt(),a.durMax>0&&(a.durability=a.durMax)),n.push(a)}this.dataList=n.sort(t.sortByGrade)},t.sortByGrade=function(t,e){if(t&&e){if(13590==t.id)return-1;if(13590==e.id)return 1;if(t.grade>e.grade)return-1;if(t.grade<e.grade)return 1}return 0},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.isOpen=!1,t}();__reflect(FirstCharge.prototype,"FirstCharge");var FirstChargeScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.group_charge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChargeBtnTouch,this),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5]);for(var n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}if(null==this.rechangeAnim){this.rechangeAnim=new MovieClip("rechange",-1);var i=xhd?1.3:.65,o=xhd?1.3:.65;this.rechangeAnim.setScaleXY(i,o),this.rechangeAnim.setRate(3),this.rechangeAnim.load(),this.group_charge.addChild(this.rechangeAnim)}if(null==this.wingAnim){this.wingAnim=new MovieClip("wing",-1);i=xhd?1:.5,o=xhd?1:.5;this.wingAnim.setScaleXY(i,o),this.wingAnim.setRate(3),this.wingAnim.load(),this.group_wing.addChild(this.wingAnim)}this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this.group_charge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChargeBtnTouch,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onChargeBtnTouch=function(t){PayInfo.getPayList(!0)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&PanelManager.openItemDescView(e.itemData)},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){var t=FirstCharge.dataList;if(null!=t&&0!=t.length)for(var e=0;e<this._itemList.length;e++){var n=this._itemList[e],i=t[e];i?(n.visible=!0,n.itemData=i,n.update()):n.visible=!1}}},e}(ComponentBase);__reflect(FirstChargeScene.prototype,"FirstChargeScene");var FiveDayActityData=function(){function t(){this.targetID=0,this.targetPoint=0,this.startTime=0,this.endTime=0,this.status=0,this.finish=0}return t.openFiveDayActivity=function(){var e=MsgHandler.createFiveDayActivityList();nato.Network.sendCmd(e,(function(e){PanelManager.closeWaitForServer(),t.canDrawTargetID=-1,t.isCanDraw=!1;for(var n=[],i=e.getByte(),o=0;i>o;o++){var a=new t;if(a.targetID=e.getInt(),a.startTime=e.getLong().value,a.endTime=e.getLong().value,a.targetPoint=e.getInt(),a.targetReward=t.getRewardInfo(e),a.firstReward=t.getRewardInfo(e),a.otherReward=t.getRewardInfo(e),a.status=e.getByte(),a.status!=t.ACTIVITY_DAY_STATUS_NOT_OPEN){a.finish=e.getInt(),a.topDataList=[];for(var r=e.getByte(),s=0;r>s;s++){var l=new TopData;l.playerName=e.getString(),l.playerId=e.getInt(),l.icon1=e.getInt(),l.count=e.getInt(),l.vipLevel=e.getInt(),l.level=e.getInt(),a.topDataList.push(l)}}n.push(a)}t._dataList=n,PanelManager.openFiveDayScene()}),this),PanelManager.openWaitForServer()},t.getRewardInfo=function(t){if(0==t.getBoolean())return null;var e=new FiveDayActivityRewardData;e.money1=t.getInt(),e.money2=t.getInt(),e.money3=t.getInt(),e.rewardList=[];for(var n=t.getByte(),i=0;n>i;i++){var o=new ItemData;ItemData.fromBytesAtts2(o,t),o.quantity=t.getShort(),o.durability=o.durMax,e.rewardList.push(o)}e.money1>0&&((o=new ItemData).isMoney=!0,o.moneyType=ItemData.ITEM_MONEY_TYPE_1,o.quantity=e.money1,e.rewardList.push(o));e.money2>0&&((o=new ItemData).isMoney=!0,o.moneyType=ItemData.ITEM_MONEY_TYPE_2,o.quantity=e.money2,e.rewardList.push(o));e.money3>0&&((o=new ItemData).isMoney=!0,o.moneyType=ItemData.ITEM_MONEY_TYPE_3,o.quantity=e.money3,e.rewardList.push(o));return e},t.getDataList=function(){return this._dataList},t.getFiveDayActivityData=function(t){return this._dataList?this._dataList[t]:null},t.getFiveDayReward=function(e){if(null!=e){if(e.status==t.ACTIVITY_DAY_STATUS_NOT_OPEN)return void AlertPanel.alertCommon("活动未开启");var n=MsgHandler.createFiveDayActivityReward(e.targetID);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=n.getInt(),o=n.getInt(),a=n.getInt();xself.setPlayerMoneyValue(i,o,a);var r=MsgHandler.processAddItemMsg(n);WorldMessage.addTips(r),e.finish=t.ACTIVITY_REWARD_GOT,PanelManager.isPanelShow(FiveDayDetailScene)&&PanelManager.getPanel(FiveDayDetailScene).updateBtnStatus()}}),this),PanelManager.openWaitForServer()}},t.getStatusDesc=function(e){return e==t.ACTIVITY_DAY_STATUS_NOT_OPEN?"/cffffff未开启/p":e==t.ACTIVITY_DAY_STATUS_OPEN?"/c00ff00进行中/p":e==t.ACTIVITY_DAY_STATUS_CLOSE?"/cB0A67A已结束/p":""},t.getFinishDesc=function(e,n){return e==t.ACTIVITY_DAY_STATUS_NOT_OPEN?"未开启":n==t.ACTIVITY_REWARD_NOT_GET?"领取":n==t.ACTIVITY_REWARD_GOT?"已领取":""},t.getTargetName=function(t){switch(t){case 0:return"等级";case 1:return"战力";case 2:return"宠物战力";case 3:return"国家繁荣";case 4:return"充值额度"}return""},t.getTargetDesc=function(t,e){if(null!=e){switch(t){case 0:return"等级达到/cffcc00"+e.targetPoint+"/p级";case 1:return"战力达到/cffcc00"+e.targetPoint+"/p";case 2:return"宠物战力达到/cffcc00"+e.targetPoint+"/p";case 3:return"国家繁荣度达到/cffcc00"+e.targetPoint+"/p点";case 4:return"充值额度达到/cffcc00"+e.targetPoint+"/p元"}return""}},t.getDateString=function(t){if(null==t)return"";var e=new Date(t.startTime),n=new Date(t.endTime);return e.getMonth()+1+"月"+e.getDate()+"日"+this.getTimeStr(e)+"-"+(n.getMonth()+1)+"月"+n.getDate()+"日"+this.getTimeStr(n)},t.getTimeStr=function(t){if(null==t)return"";var e="",n=t.getHours(),i=t.getMinutes();return e=10>n?"0"+n:""+n,(e+=":")+(10>i?"0"+i:""+i)},t.getTopData=function(t,e){return t&&t.topDataList&&t.topDataList.length>0?t.topDataList[e]:null},t.ACTIVITY_DAY_STATUS_NOT_OPEN=0,t.ACTIVITY_DAY_STATUS_OPEN=1,t.ACTIVITY_DAY_STATUS_CLOSE=2,t.ACTIVITY_REWARD_NOT_GET=0,t.ACTIVITY_REWARD_GOT=1,t.isOpen=!1,t.isCanDraw=!1,t.canDrawTargetID=-1,t}();__reflect(FiveDayActityData.prototype,"FiveDayActityData");var FiveDayActivityRewardData=function(){this.money1=0,this.money2=0,this.money3=0};__reflect(FiveDayActivityRewardData.prototype,"FiveDayActivityRewardData");var TopData=function(){this.playerId=0,this.icon1=0,this.count=0,this.vipLevel=0,this.level=0};__reflect(TopData.prototype,"TopData");var FiveDayDetailScene=function(t){function e(){var e=t.call(this)||this;return e._day=0,e._isEnable=!1,e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_1_reward,this.onBtnFirstReward,this),ButtonUtils.addTouchEvent(this.btn_2_reward,this.onBtnOtherReward,this),ButtonUtils.addTouchEvent(this.btn_getReward,this.onBtnGetReward,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_1_reward),ButtonUtils.removeTouchEvent(this.btn_2_reward),ButtonUtils.removeTouchEvent(this.btn_getReward),Tool.removeObjSafe(this.vipNum),this.vipNum=null},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnFirstReward=function(){if(this._data&&this._data.firstReward){var t=this._data.firstReward,e="";if(this._data.topDataList&&this._data.topDataList.length>0)e="/cFFCC00当前第一名的玩家为：/p",e+="\n"+this._data.topDataList[0].playerName;PanelManager.openFiveDayRewardView(t.rewardList,e)}},e.prototype.onBtnOtherReward=function(){if(this._data&&this._data.otherReward){var t=this._data.otherReward,e="";if(this._data.topDataList&&this._data.topDataList.length>1)for(var n=1;5>n;n++){var i=this._data.topDataList[n];i&&(e+="/cffcc00当前第"+Tool.getChangeChar2(n+1)+"名的玩家为：/p\n",e+=i.playerName+"\n")}PanelManager.openFiveDayRewardView(t.rewardList,e)}},e.prototype.onBtnGetReward=function(){this._data&&FiveDayActityData.getFiveDayReward(this._data)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&AlertPanel.alertItem(e.itemData)},e.prototype.setdata=function(t,e){this._day=t,this._data=e},e.prototype.reset=function(){if(this.init){this.label_1_name.text="  --",this.label_1_level.text="",this.group_vipNum.removeChildren(),this.headSpr&&this.headSpr.parent&&this.headSpr.parent.removeChild(this.headSpr),this.headSpr=null;for(var t=2;5>=t;t++)this["label_"+t+"_name"].text=" -- ",this["label_"+t+"_level"].text=" -- "}},e.prototype.update=function(){if(this.init){if(this.img_day.source="fiveday_day_"+(this._day+1)+(xhd?"_hd":"_sd"),this.img_name.source="fiveday_title_"+(this._day+1)+(xhd?"_hd":"_sd"),this.img_desc.source="fiveday_desc_"+(this._day+1)+(xhd?"_hd":"_sd"),null==this._data)return void this.reset();var t,e;this.img_status0.source="fiveday_status_"+(this._data.status+1)+(xhd?"_hd":"_sd"),this.label_time.text=FiveDayActityData.getDateString(this._data),this.hContainer.reset(),this._index=0;var n=this._data.targetReward;if(n&&n.rewardList&&n.rewardList.length>0)for(var i=0;i<n.rewardList.length;i++)t=n.rewardList[i],(e=this.getItem()).itemData=t,this.hContainer.add(e);this.hContainer.update(),this.label_rankTitle.text=FiveDayActityData.getTargetName(this._day)+"排行奖励";var o=FiveDayActityData.getTopData(this._data,0);if(o){this.label_1_name.text=o.playerName,this.label_1_level.text=FiveDayActityData.getTargetName(this._day)+":"+o.count;var a=o.icon1;this.headSpr&&this.headSpr.parent&&this.headSpr.parent.removeChild(this.headSpr);var r=a>>Model.OFFSET_SEX&Model.LEN_SEX,s=r==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(s),this.headSpr.setScale(xhd?2:1),this.headSpr.y=15*xhdRatio,this.group_head.addChild(this.headSpr);var l=new ChangeSpriteInfo(a,0,0,r,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(l),this.group_vipNum.removeChildren(),this.vipNum=ImageNum.create(2006),this.vipNum.scaleX=this.vipNum.scaleY=.6*xhdRatio,this.group_vipNum.addChild(this.vipNum),this.vipNum.num=o.vipLevel}else this.label_1_name.text="  --",this.label_1_level.text="",this.group_vipNum.removeChildren(),this.headSpr&&this.headSpr.parent&&this.headSpr.parent.removeChild(this.headSpr),this.headSpr=null,this.group_vipNum.removeChildren();for(i=2;5>=i;i++){var _=i-1;(o=FiveDayActityData.getTopData(this._data,_))?(this["label_"+i+"_name"].text=o.playerName,this["label_"+i+"_level"].text=FiveDayActityData.getTargetName(this._day)+":"+o.count):(this["label_"+i+"_name"].text=" -- ",this["label_"+i+"_level"].text=" -- ")}this.label_target.textFlow=Tool.convertDescToTextFlow(FiveDayActityData.getTargetDesc(this._day,this._data)),this.updateBtnStatus()}},e.prototype.updateBtnStatus=function(){this._isEnable=!1,this._drawBtnDesc="",this._data&&(this._data.status==FiveDayActityData.ACTIVITY_DAY_STATUS_NOT_OPEN?(this._isEnable=!1,this._drawBtnDesc="未开启"):this._data.status==FiveDayActityData.ACTIVITY_DAY_STATUS_CLOSE?(this._isEnable=!1,this._drawBtnDesc="已结束"):this._data.finish==FiveDayActityData.ACTIVITY_REWARD_GOT?(this._isEnable=!1,this._drawBtnDesc="已领取"):this.checkDrawStatus()),this.btn_getReward.enabled=this._isEnable,this.btn_getReward.label=this._drawBtnDesc},e.prototype.checkDrawStatus=function(){if(null!=this._data){var t=0;if(0==this._day)t=xself.getLevel();else if(1==this._day)t=xself.powerX;else if(2==this._day){var e=xself.getPet();null!=e&&(t=e.getPower())}else 3==this._day?t=xself.getCountryId()>0&&xself.getCountryRank()==Define.RANK_KING?-1:0:4==this._day&&(t=-2);-1==t?(this._isEnable=!1,this._drawBtnDesc="",this.checkCountry()):-2==t?(this._isEnable=!1,this._drawBtnDesc="",this.checkVipGainMoney()):t>=this._data.targetPoint?(this._isEnable=!0,this._drawBtnDesc="领取"):(this._isEnable=!1,this._drawBtnDesc="未达成")}},e.prototype.checkCountry=function(){var t=new Country(xself.getCountryId()),e=this;Country.getCountryInfo(t,Country.INFO_NORMAL,!1,(function(){t.prosperity>=e._data.targetPoint?(e._isEnable=!0,e._drawBtnDesc="领取"):(e._isEnable=!1,e._drawBtnDesc="未达成"),e.btn_getReward.enabled=e._isEnable,e.btn_getReward.label=e._drawBtnDesc}),this)},e.prototype.checkVipGainMoney=function(){var t=this;VipInfo.doGetVipInfo((function(){Math.floor(VipInfo.curGainMoney/50)>=t._data.targetPoint?(t._isEnable=!0,t._drawBtnDesc="领取"):(t._isEnable=!1,t._drawBtnDesc="未达成"),t.btn_getReward.enabled=t._isEnable,t.btn_getReward.label=t._drawBtnDesc}),this)},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new Item,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(FiveDayDetailScene.prototype,"FiveDayDetailScene");var FiveDayRewardView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5,this.item6,this.item7]);for(var n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.btn_close),ButtonUtils.addTouchEvent(this.btn_ok)},e.prototype.onClose=function(){PanelManager.closeFiveDayRewardView()},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&AlertPanel.alertItem(e.itemData)},e.prototype.setData=function(t,e){this._rewardList=t,this._content=e},e.prototype.update=function(){if(this.init&&null!=this._rewardList&&null!=this._content){this.container.reset(!0),this._showRewardGroupList=[],this.updateDayRewardList(0,this._rewardList),this.updateDayRewardList(1,this._rewardList);for(var t=5*xhdRatio,e=0;e<this._showRewardGroupList.length;e++){var n=this._showRewardGroupList[e];this.container.add(n,-1,t),t+=n.height+5*xhdRatio}var i=Tool.convertDescToTextFlow("\n"+this._content);this.label_content.textFlow=i,this.label_content.height=this.label_content.textHeight+5*xhdRatio,this.container.add(this.label_content,-1,t);var o=this.container.totalHeight;this.container.updateAutoSize(o,250*xhdRatio),this.bg2.height=this.container.height+5*xhdRatio,this.btn_ok.y=this.bg2.y+this.bg2.height+2*xhdRatio,this.height=this.btn_ok.y+this.btn_ok.height+10*xhdRatio}},e.prototype.updateDayRewardList=function(t,e){for(var n,i,o=this["group_rewardList"+t],a=[this["item"+(4*t+0)],this["item"+(4*t+1)],this["item"+(4*t+2)],this["item"+(4*t+3)]],r=[],s=0;s<a.length;s++)n=a[s],e&&null!=e[4*t+s]?(i=e[4*t+s],n.itemData=i,n.update(),n.visible=!0,r.push(n)):n.visible=!1;if(r.length>0){o.visible=!0,this._showRewardGroupList.push(o);var l=60*xhdRatio,_=Math.floor((o.width-l*r.length)/2)-10*xhdRatio;for(s=0;s<r.length;s++)(n=r[s]).x=_+l*s}else o.visible=!1},e}(ComponentBase);__reflect(FiveDayRewardView.prototype,"FiveDayRewardView");var FiveDayScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._dayGroups&&(this._dayGroups=[this.group_day0,this.group_day1,this.group_day2,this.group_day3,this.group_day4]);for(var n=0;n<this._dayGroups.length;n++){this._dayGroups[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDayGroupTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onDayGroupTouch=function(t){var e=this._dayGroups.indexOf(t.target);if(e>=0){var n=FiveDayActityData.getFiveDayActivityData(e);PanelManager.openFiveDayDetailScene(e,n)}},e.prototype.reset=function(){this.init&&(this.label_time0.text="",this.label_time1.text="",this.label_time2.text="",this.label_time3.text="",this.label_time4.text="")},e.prototype.update=function(){if(this.init){var t=FiveDayActityData.getDataList();if(null==t)return void this.reset();for(var e=0;e<t.length;e++){var n=t[e];this.updateData(e,n)}}},e.prototype.updateData=function(t,e){0>t||t>=5||null==e||(this["img_status"+t].source="fiveday_status_"+(e.status+1)+(xhd?"_hd":"_sd"),this["label_time"+t].text=FiveDayActityData.getDateString(e))},e}(ComponentBase);__reflect(FiveDayScene.prototype,"FiveDayScene");var FoundationData=function(){function t(){}return Object.defineProperty(t.prototype,"needTarget",{get:function(){return this._needTarget},set:function(t){this._needTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFinish",{get:function(){return this._isFinish},set:function(t){this._isFinish=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardGold",{get:function(){return this._rewardGold},set:function(t){this._rewardGold=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardList",{get:function(){return this._rewardList},set:function(t){this._rewardList=t},enumerable:!0,configurable:!0}),t}();__reflect(FoundationData.prototype,"FoundationData");var FoundationGetItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this)},e.prototype.onGet=function(){ActivityHandler.getFoundationReward(1,this._data.needTarget)},e.prototype.setData=function(t,e){this._data=e,this.idx=t,this.update()},e.prototype.getData=function(){return this._data},e.prototype.update=function(){if(0!=this.init){var t,e=new ItemData;e.isMoney=!0,this.idx>=7?(e.moneyType=ItemData.ITEM_MONEY_TYPE_1,this.label_text.text="黄金"):(e.moneyType=ItemData.ITEM_MONEY_TYPE_2,this.label_text.text="金叶"),e.quantity=1,this.item.itemData=e,this.lable_gold.text=this._data.rewardGold.toString(),this.lable_levle.text=this._data.needTarget.toString(),0==this._data.isFinish?(this.btn_get.enabled=!1,t="不可领取"):1==this._data.isFinish?(this.btn_get.enabled=!0,t="可领取"):2==this._data.isFinish&&(this.btn_get.enabled=!1,t="已领取"),this.btn_get.label=t}},e}(ComponentBase);__reflect(FoundationGetItem.prototype,"FoundationGetItem");var FoundationWelfareGetItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._itemList=new Array,this._index=0,ButtonUtils.addTouchEvent(this.btn_get,this.onGet,this),this.update()},e.prototype.onRemoveFromStage=function(e){for(var n in t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeMenuBtnTouchEvent(this.btn_get),this._itemList)this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onGet=function(){ActivityHandler.getFoundationReward(2,this._data.needTarget)},e.prototype.setData=function(t,e){this._data=e,this.update()},e.prototype.getData=function(){return this._data},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){var t;this.reset(),this.lable_num.text=this._data.needTarget.toString(),0==this._data.isFinish?(this.btn_get.enabled=!1,t="不可领取"):1==this._data.isFinish?(t="可领取",this.btn_get.enabled=!0):2==this._data.isFinish&&(this.btn_get.enabled=!1,t="已领取"),this.btn_get.label=t;for(var e=0;e<this._data.rewardList.length;e++){var n=this.getItem();n.itemData=this._data.rewardList[e],this.container.add(n,(n.width+30)*e)}for(var i in this.container.update(),this._itemList)this._itemList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new Item,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(FoundationWelfareGetItem.prototype,"FoundationWelfareGetItem");var ItemModelView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ComponentBase);__reflect(ItemModelView.prototype,"ItemModelView");var NationalDayData=function(){function t(){}return Object.defineProperty(t.prototype,"actorName",{get:function(){return this._actorName},set:function(t){this._actorName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actorId",{get:function(){return this._actorId},set:function(t){this._actorId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeMoney",{get:function(){return this._chargeMoney},set:function(t){this._chargeMoney=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardList",{get:function(){return this._rewardList},set:function(t){this._rewardList=t},enumerable:!0,configurable:!0}),t}();__reflect(NationalDayData.prototype,"NationalDayData");var NationalDayPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._NationalDayRewardItemList=new Array,this._index=0;var n=ActivityList.getDataByID(ActivityList.ID_guoqing_charge);this.lable_time.text=ActivityList.getTimeStr(n),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t){this.dataList=t,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset();for(var t=0;t<this.dataList.length;t++){var e=this.getItem();e.setData(t,this.dataList[t]),this.container.add(e,3)}this.container.update()}},e.prototype.getItem=function(){var t=this._NationalDayRewardItemList[this._index];return t||(t=new NationalDayRewardItem,nato.attachSkin(t),this._NationalDayRewardItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(NationalDayPanel.prototype,"NationalDayPanel");var NationalDayRewardItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._item4List&&(this._item4List=new Array),this.update()},e.prototype.onRemoveFromStage=function(e){for(var n in t.prototype.onRemoveFromStage.call(this,e),this._item4List)this._item4List[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e){this._data=e,this._rank=t,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),this.label_name.text=this._data.actorName,this.label_money.text=this._data.chargeMoney.toString();var t=this,e=xhd?"hd":"sd";this._rank<=2?(this.label_rank.visible=!1,nato.getTextureFromUICache("rank_"+(this._rank+1)+"_"+e,(function(e){e&&(t.img_lv.texture=e)}),this)):(this.label_rank.visible=!0,t.img_lv.visible=!1,this.label_rank.text=(this._rank+1).toString());for(var n=this._data.rewardList.length,i=0;n>i;i++){var o=this.getItem();o.itemData=this._data.rewardList[i],this.container.add(o,(o.width-60)*i,13)}for(var a in this.container.update(),this._item4List)this._item4List[a].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.getItem=function(){var t=this._item4List[this._index];return t||(t=new Item4,nato.attachSkin(t),this._item4List[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(NationalDayRewardItem.prototype,"NationalDayRewardItem");var OpenServerFoundationPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabIndex=0,this._welfareItemList=new Array,this._itemList=new Array,this._welfareItem_index=0,this._index=0,this.btn_table=[this.btn_1,this.btn_2];for(var n=0;n<this.btn_table.length;n++)this.btn_table[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTableTouch,this);this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.Numimg),this.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn_buy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this);for(var n=0;n<this.btn_table.length;n++)this.btn_table[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTableTouch,this);this.Numimg=null},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBuy=function(){return xself.getVipLevel()<1?void AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),"需要VIP1才可以购买!"):void ActivityHandler.BuyFoundataion()},e.prototype.onTableTouch=function(t){var e=t.target,n=this.btn_table.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setData=function(t,e,n,i,o){this._pageDataList=o,this._startTime=t,this._endTime=e,this._allNum=n,this._canBuy=i,this.updateTab()},e.prototype.reset=function(){this.container.reset(),this._index=0,this._welfareItem_index=0},e.prototype.updateTab=function(){if(0!=this.init){if(ButtonUtils.selectTabBtnList(this.btn_table,this._tabIndex),this.reset(),this._tabIndex==e.TABEL_INDEX_0){this.group_1.visible=!0,this.group_2.visible=!1,1==this._canBuy&&(this.btn_buy.touchEnabled=!1,this.btn_buy.label="已购买"),this.lable_time.text="永久",this._pageData=this._pageDataList[0];for(var t=0;t<this._pageData.length;t++){(n=this.getItem()).setData(t,this._pageData[t]),1==this._pageData[t].isFinish&&this._pageData[t-1]&&2==this._pageData[t-1].isFinish&&this.container.updateToShowItem(n,!0),this.container.add(n)}}else{this.group_1.visible=!1,this.group_2.visible=!0,this._pageData=this._pageDataList[1];for(t=0;t<this._pageData.length;t++){var n;(n=this.getWelfareItem()).setData(t,this._pageData[t]),this.container.add(n),1==this._pageData[t].isFinish&&this._pageData[t-1]&&2==this._pageData[t-1].isFinish&&this.container.updateToShowItem(n,!0)}null==this.Numimg&&(this.Numimg=ImageNum.create(2008),this.Numimg.scaleX=this.Numimg.scaleY=1.5,this.number_ctn.addChild(this.Numimg)),this.Numimg.num=this._allNum}this.container.update()}},e.prototype.updateItem=function(t,e){var n,i;for(var o in 1==t?n=this._itemList:2==t&&(n=this._welfareItemList),n)n[o]&&((i=n[o].getData()).needTarget==e&&(i.isFinish=2,n[o].setData(o,i),this.container.updateToShowItem(n[o+1],!0)))},e.prototype.getWelfareItem=function(){var t=this._welfareItemList[this._welfareItem_index];return t||(t=new FoundationWelfareGetItem,nato.attachSkin(t),this._welfareItemList[this._welfareItem_index]=t),this._welfareItem_index++,t},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new FoundationGetItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e.TABEL_INDEX_0=0,e.TABEL_INDEX_1=1,e}(ComponentBase);__reflect(OpenServerFoundationPanel.prototype,"OpenServerFoundationPanel");var SingleChargeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._item3List&&(this._item3List=new Array),this._index=0,this.update()},e.prototype.onRemoveFromStage=function(e){for(var n in t.prototype.onRemoveFromStage.call(this,e),this.Nummoeny=null,this._item3List)this._item3List[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t){this._data=t,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),null==this.Nummoeny&&(this.Nummoeny=ImageNum.create(2008),this.Nummoeny.scaleX=this.Nummoeny.scaleY=1,this.img_ctn.addChild(this.Nummoeny)),this.Nummoeny.num=this._data.chargeMoney;for(var t=0;t<this._data.rewardList.length;t++){var e=this.getItem();e.label_name.multiline=!0,e.label_name.size=10*xhdRatio,e.itemData=this._data.rewardList[t],this.container.add(e,t*(e.width-20),3)}for(var n in this.container.update(),this._item3List)this._item3List[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.getItem=function(){var t=this._item3List[this._index];return t||(t=new Item4,nato.attachSkin(t),this._item3List[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(SingleChargeItem.prototype,"SingleChargeItem");var SingleChargePanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._index=0,null==this._singleChargeItemList&&(this._singleChargeItemList=new Array),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this);var n=ActivityList.getDataByID(ActivityList.ID_singleCharge);this.lable_time.text=ActivityList.getTimeStr(n),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t){this.dataList=t,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset();for(var t=0;t<this.dataList.length;t++){var e=this.getItem();e.setData(this.dataList[t]),this.container.add(e)}this.container.update()}},e.prototype.getItem=function(){var t=this._singleChargeItemList[this._index];return t||(t=new SingleChargeItem,nato.attachSkin(t)),this._index++,t},e}(ComponentBase);__reflect(SingleChargePanel.prototype,"SingleChargePanel");var SpringRewardItem=function(t){function e(e){var n=t.call(this)||this;return n.day=0,n.day=e+1,ButtonUtils.addTouchEvent(n.btn_get,n.onGetReward,n),n}return __extends(e,t),e.prototype.onCreate=function(){var t=new eui.Image;t.source="spring"+this.day,this.day_container.addChild(t)},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_get,this.onGetReward,this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this),ButtonUtils.removeTouchEvent(this.btn_get)},e.prototype.onTouchItem=function(t){null!=this.item&&AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),this.item.itemData.getDesc(null))},e.prototype.update=function(){var t=this.day-1,e=SpringReward.rewardList[t],n=e.rewardList[0];if(this.item.itemData=n,this.item_name.text=n.name,this.label_leaf.text=e.money2.toString(),SpringReward.hasExtraReward){var i=SpringReward.advancedRewardList[t];this.label_gold.text="黄金:"+i.money1}else this.label_gold.text="未参与";var o=SpringReward.isRewardDrawed(this.day);this.img_got.visible=o,this.btn_get.visible=!o,0==o&&this.day<SpringReward.curDay&&(this.btn_get.label="无法领取")},e.prototype.onGetReward=function(){SpringReward.doGetReward(this.day)},e}(ComponentBase);__reflect(SpringRewardItem.prototype,"SpringRewardItem");var SpringRewardPanel=function(t){function e(){var e=t.call(this)||this;return e.dayRewards=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this.updateContainer(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.updateContainer=function(){this.container.reset();for(var t=0;7>t;t++){var e=new SpringRewardItem(t);nato.attachSkin(e),this.dayRewards.push(e),this.container.add(e)}},e.prototype.update=function(){for(var t=0;7>t;t++)this.dayRewards[t].update()},e}(ComponentBase);__reflect(SpringRewardPanel.prototype,"SpringRewardPanel");var WishPoolScene=function(t){function e(){var e=t.call(this)||this;return e._result=null,e._isWaiting=!1,e.lastWishType=0,e}return __extends(e,t),e.prototype.setInfo=function(t){this.wishPoolInfo=t},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_coinWish,this.onBtnCoinWish,this),ButtonUtils.addTouchEvent(this.btn_goldWish,this.onBtnGoldWish,this),nato.WorldTicker.instance.register(this.logic,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_coinWish),ButtonUtils.removeTouchEvent(this.btn_goldWish),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onClose=function(){this._isWaiting||PanelManager.closeScene()},e.prototype.onBtnCoinWish=function(){this.doWish(WishPool.TYPE_WISHING_COIN)},e.prototype.onBtnGoldWish=function(){this.doWish(WishPool.TYPE_WISHING_GOLD)},e.prototype.doWish=function(t){if(!this._isWaiting){this.lastWishType=t;var e=new nato.Message(ProtocolDefine.CG_ACTOR_WISHING);e.putByte(t),nato.Network.sendCmd(e,this.onWishHandler,this),PanelManager.openWaitForServer()}},e.prototype.onWishHandler=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertCommon(t.getString());else{xself.setMoneyByType(ModelConst.MONEY1,t.getInt(),null,!1),xself.setMoneyByType(ModelConst.MONEY2,t.getInt(),null,!1),xself.setMoneyByType(ModelConst.MONEY3,t.getInt(),null,!1);for(var e=t.getShort(),n=0;e>n;n++){var i=t.getInt(),o=t.getShort(),a=t.getByte(),r=xself.bag.getItem(o);null==r?WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 删除的物品不存在"):r.id!=i&&WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 删除的物品ID错误. id1="+r.id+" id2="+i);var s=xself.bag.removeBagItemByPos(o,a);0>s&&WorldMessage.addPromptMsg("OfflineExpScene.onUpgrade() 背包移出物品错误. rs="+s)}var l=t.getInt(),_=this.lastWishType==WishPool.TYPE_WISHING_COIN?"铜币":"黄金";this._result="你获得"+l+_,this.playEff(),this.updateMyCount()}},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){var t=this.wishPoolInfo;if(null!=t){var e=ActivityList.getDataByID(ActivityList.ID_wishPool);this.label_time.text=e?ActivityList.getTimeStr(e,!1):"",this.label_coinCost.text=t.costMoney1+"",this.label_coinCostItem.text=t.costItemCount1+"",this.label_goldCost.text=t.costMoney2+"",this.label_goldCostItem.text=t.costItemCount2+"",this.updateMyCount(),this.moneyView.update()}}},e.prototype.updateMyCount=function(){var t=xself.bag.getItemNumByID(126);this.label_myCount.textFlow=Tool.convertDescToTextFlow("剩余许愿券：/cffffff"+t+"/p")},e.prototype.playEff=function(){null==this._eff&&(this._eff=new MovieClip("levelup",1,this.onMCLoadOver,this),this._eff.scaleX=this._eff.scaleY=1.2*xhdRatio,this._eff.setRate(3),this._eff.load())},e.prototype.onMCLoadOver=function(){this._eff.x=this.img_money.x-10*xhdRatio,this._eff.y=this.img_money.y-62*xhdRatio,this.addChild(this._eff),this._eff.play(),this._isWaiting=!0},e.prototype.playEffEnd=function(){this._isWaiting=!1,null!=this._result&&(AlertPanel.alertCommon(this._result),this._result=null),Tool.removeObjSafe(this._eff),this._eff=null},e.prototype.logic=function(t){this.stage&&this._isWaiting&&null!=this._eff&&0!=this._eff.loaded&&this._eff.done&&(this._isWaiting=!1,this.playEffEnd())},e}(ComponentBase);__reflect(WishPoolScene.prototype,"WishPoolScene");var ActivityConfig=function(){function t(){}return Object.defineProperty(t,"actList",{get:function(){return t._actList},enumerable:!0,configurable:!0}),t._actList=[{actName:"QuickPowerAct",actDesc:"快速升战",enterInit:!0},{actName:"DailyChargeAct",actDesc:"每日充值",enterInit:!0},{actName:"StrengthenAct",actDesc:"变强系统",enterInit:!0},{actName:"ConsumeActivity",actDesc:"累计消费",enterInit:!0}],t}();__reflect(ActivityConfig.prototype,"ActivityConfig");var ActivityService=function(t){function e(){var e=t.call(this)||this;return e._activitys={},e._firstInit=!0,e}return __extends(e,t),e.prototype.init=function(){},Object.defineProperty(e,"instance",{get:function(){return this._instance=this._instance||new e},enumerable:!0,configurable:!0}),e.prototype.initActivity=function(){var t=this;this._firstInit&&(this._firstInit=!1,ActivityConfig.actList.forEach((function(e){var n=egret.getDefinitionByName(e.actName);if(n){var i=new n;t._activitys[e.actName]=i,e.enterInit&&i.init()}}),this))},e.prototype.getActivity=function(t){return this._activitys[t]?this._activitys[t]:null},e.prototype.openActivity=function(t,e){var n=this._activitys[t];null!=n&&n.openActivity(e)},e}(egret.EventDispatcher);__reflect(ActivityService.prototype,"ActivityService",["IActivityService","IService","egret.IEventDispatcher"]);var ConsumeActivity=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.dispose=function(){},e.prototype.openActivity=function(t){ConsumeModel.instance.getInfo((function(){(new ConsumeMainPanel).show()}),this)},e}(egret.EventDispatcher);__reflect(ConsumeActivity.prototype,"ConsumeActivity",["IActivity","egret.IEventDispatcher"]);var ConsumeAward=function(){function t(){}return t.parseData=function(e,n){var i=new t;i.id=e.getInt(),i.type=e.getByte(),i.count=e.getInt();var o=e.getInt(),a=new ItemData;return 0>o?(a.isMoney=!0,a.moneyType=InteractUtil.toMoneyType(o),a.quantity=e.getInt()):(a.isMoney=!1,ItemData.fromBytesAtts2(a,e),a.quantity=e.getInt(),a.durMax>0&&(a.durability=a.durMax)),i.award=a,i.getType=e.getInt(),i.status=e.getByte(),n>=i.count&&1==i.status&&(i.status=2),i},t}();__reflect(ConsumeAward.prototype,"ConsumeAward");var ConsumeAwardItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),nato.loadFont("assert/font/number1.fnt",(function(t,n){t&&(e.txtConsume.font=t)}),this),this.once(egret.Event.REMOVED_FROM_STAGE,this.onRemoveStage,this),this.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAward,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.txtConsume.text=e.count.toString(),this.imgStatus.visible=0!=e.status,this.btnGetAward.visible=0==e.status,this.imgStatus.source=["bq_bklq","get_reward_hd"][e.status-1],this.listAward.itemRenderer=ItemRender3,this.listAward.dataProvider=new eui.ArrayCollection([e.award])},e.prototype.onGetAward=function(t){xevent.dispatchEventWith("ConsumeGetAward",!1,this.data.id)},e.prototype.onRemoveStage=function(t){this.btnGetAward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAward,this)},e}(eui.ItemRenderer);__reflect(ConsumeAwardItem.prototype,"ConsumeAwardItem");var ConsumeMainPanel=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this),this._model=ConsumeModel.instance,this.txtConsume.text=this._model.goldTotal.toString();var e=ActivityList.getDataByID(ActivityList.ID_ljxf_consume);this.txtTime.text=ActivityList.getTimeStr(e),this.listConsume.itemRenderer=ConsumeAwardItem,InteractUtil.sortObjectOn(this._model.awardList,"status"),this.listConsume.dataProvider=new eui.ArrayCollection(this._model.awardList)},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),xevent.addEventListener("ConsumeGetAward",this.onGetAward,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),xevent.removeEventListener("ConsumeGetAward",this.onGetAward,this)},e.prototype.onGetAward=function(t){var e=this,n=t.data;this._model.getAward(n,(function(){InteractUtil.sortObjectOn(e._model.awardList,"status"),e.listConsume.dataProvider=new eui.ArrayCollection(e._model.awardList)}),this)},e}(PanelBase);__reflect(ConsumeMainPanel.prototype,"ConsumeMainPanel");var ConsumeModel=function(){function t(){}return Object.defineProperty(t.prototype,"goldTotal",{get:function(){return this._goldTotal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"awardList",{get:function(){return this._awardList},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.getInfo=function(t,e){var n=this;InteractUtil.sendMessage(ProtocolDefine.CG_COST_REWARD_LIST,(function(i){n._goldTotal=i.getInt(),n._weafTotal=i.getInt(),n._coinTotal=i.getInt();var o=(i.getString(),i.getString(),i.getByte());n._awardList=new Array;for(var a=0;o>a;a++)n._awardList[a]=ConsumeAward.parseData(i,n.goldTotal);InteractUtil.applyFunc(t,e)}),this)},t.prototype.getAward=function(t,e,n){var i=this,o=new egret.ByteArray;o.writeInt(t),InteractUtil.sendMessage(ProtocolDefine.CG_COST_REWARD_GET_REWARD,(function(o){var a=o.getInt(),r=new StringBuffer;if(0>a){var s=void 0,l=o.getInt();switch(a){case-1:s=ModelConst.MONEY1;break;case-2:s=ModelConst.MONEY2;break;case-3:s=ModelConst.MONEY3}xself.setMoneyByType(s,l,r)}else{var _=MsgHandler.processAddItemMsg(o,ProtocolDefine.CG_COST_REWARD_GET_REWARD);r.append(_)}WorldMessage.addTips(r.toString());for(var h=0;h<i._awardList.length;h++)i._awardList[h].id==t&&(i._awardList[h].status=2);InteractUtil.applyFunc(e,n)}),this,o)},t}();__reflect(ConsumeModel.prototype,"ConsumeModel");var DailyChargeAct=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=this;this._model=new DailyChargeModel,nato.Network.addMsgHandler(ProtocolDefine.CG_DAILY_CAHRGE,(function(e){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(e)||t._model.parseData(e)}),this),PanelManager.openWaitForServer(),nato.Network.sendCmd(new nato.Message(ProtocolDefine.CG_DAILY_CAHRGE))},e.prototype.dispose=function(){},e.prototype.getActData=function(t){return this._model.charge},e.prototype.openActivity=function(t){new DailyChargePanel(this._model).show()},e}(egret.EventDispatcher);__reflect(DailyChargeAct.prototype,"DailyChargeAct",["IActivity","egret.IEventDispatcher"]);var DailyChargeModel=function(){function t(){this._charge=0}return Object.defineProperty(t.prototype,"charge",{get:function(){return this._charge},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"billId",{get:function(){return this._billId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeType",{get:function(){return this._chargeType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"awardList",{get:function(){return this._awardList},enumerable:!0,configurable:!0}),t.prototype.parseData=function(t){this._awardList=[],this._charge=t.getInt(),this._billId=t.getInt(),this._chargeType=t.getInt();for(var e=t.getByte(),n=0;e>n;n++){var i=new ItemData;t.getBoolean()?(i.isMoney=!0,i.moneyType=InteractUtil.toMoneyType(t.getInt()),i.quantity=t.getInt()):(i.isMoney=!1,ItemData.fromBytesAtts2(i,t),i.quantity=t.getInt(),i.durMax>0&&(i.durability=i.durMax)),this._awardList[n]=i}PanelManager.mainMenu&&PanelManager.mainMenu.updateDailyCharge()},t}();__reflect(DailyChargeModel.prototype,"DailyChargeModel");var DailyChargePanel=function(t){function e(e){var n=t.call(this)||this;return n._model=e,nato.attachSkin(n),n}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this);var e=this._model.charge;this.imgTitle.source="dc_title"+(0==e?12:e)+"_hd",this.listAward.itemRenderer=ItemRender3,this.listAward.dataProvider=new eui.ArrayCollection(this._model.awardList)},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnCharge",this.onBtnCharge,this)},e.prototype.afterShowFunc=function(){GameWorld.cleanGuide()},e.prototype.onBtnCharge=function(){return this._model.billId?void Sdk.xsdk.order(this._model.chargeType,this._model.billId):void AlertPanel.alertTips("","充值ID错误")},e}(PanelBase);__reflect(DailyChargePanel.prototype,"DailyChargePanel");var InviteNewConfig=function(){function t(){}return t.EVT_GetAward="evt_getaward",t.EVT_UpdateRed="evt_updatered",t.RebateAward=[{id:0,charge:6,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:50},{id:ItemData.ITEM_MONEY_TYPE_2,count:50}]},{id:1,charge:50,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:150},{id:ItemData.ITEM_MONEY_TYPE_2,count:200}]},{id:2,charge:300,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:900},{id:ItemData.ITEM_MONEY_TYPE_2,count:900}]},{id:3,charge:1e3,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:3e3},{id:ItemData.ITEM_MONEY_TYPE_2,count:3e3}]},{id:4,charge:2500,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:7500},{id:ItemData.ITEM_MONEY_TYPE_2,count:7500}]},{id:5,charge:6e3,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:18e3},{id:ItemData.ITEM_MONEY_TYPE_2,count:18e3}]},{id:6,charge:1e4,list:[{id:ItemData.ITEM_MONEY_TYPE_1,count:3e4},{id:ItemData.ITEM_MONEY_TYPE_2,count:3e4}]}],t}();__reflect(InviteNewConfig.prototype,"InviteNewConfig");var InviteNewDataModel=function(){function t(){this._isAply=!1,this._inited=!1,this._bindNameList=[],this._inviteList=[]}return Object.defineProperty(t.prototype,"selfCode",{get:function(){return this._selfCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindNameList",{get:function(){return this._bindNameList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inviteList",{get:function(){return this._inviteList},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.checkReward=function(t,e){var n=this;this._isAply||(this._inited?this.addRedPoint(t,e):(this._isAply=!0,this.getInfo((function(){n._inited=!0,n._isAply=!1,n.addRedPoint(t,e)}),this)))},t.prototype.addRedPoint=function(t,e){for(var n=!1,i=0,o=this.inviteList;i<o.length;i++){if(o[i].hasRebateAward){n=!0;break}}InteractUtil.applyFunc(t,e,[n])},t.prototype.getInfo=function(t,e){var n=this;PanelManager.openWaitForServer();var i=new nato.Message(ProtocolDefine.CG_INVITE_SYS_DATA);nato.Network.sendCmd(i,(function(i){PanelManager.closeWaitForServer(),n.readData(i),InteractUtil.applyFunc(t,e)}),this)},t.prototype.bindInvite=function(t,e,n){var i=this,o=new egret.ByteArray;o.writeInt(t),InteractUtil.sendMessage(ProtocolDefine.CG_INVITE_BINDING,(function(t){i._bindNameList=[];for(var o=t.getByte(),a=0;o>a;a++)i._bindNameList[a]=t.getString();InteractUtil.applyFunc(e,n)}),this,o)},t.prototype.getAward=function(t,e,n,i){var o=new egret.ByteArray;o.writeInt(t.h),o.writeInt(t.l),o.writeByte(e),InteractUtil.sendMessage(ProtocolDefine.CG_INVITE_DRAW_REBATE,(function(t){var e=new StringBuffer,o=t.getInt(),a=t.getInt();xself.setMoneyByType(ModelConst.MONEY1,o,e),xself.setMoneyByType(ModelConst.MONEY2,a,e),WorldMessage.addTips(e.toString()),InteractUtil.applyFunc(n,i)}),this,o)},t.prototype.readData=function(t){if(this._bindNameList=[],this._selfCode=t.getInt(),t.getBoolean())for(var e=t.getByte(),n=0;e>n;n++)this._bindNameList[n]=t.getString();this._inviteList=[];var i=t.getUnsignedByte();for(n=0;i>n;n++)this._inviteList[n]=InviteNewPlayerData.parse(t)},t}();__reflect(InviteNewDataModel.prototype,"InviteNewDataModel");var InviteNewMainPanel=function(t){function e(){var e=t.call(this)||this;return e.SortMoney=0,e.SortTime=1,nato.attachSkin(e),e}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this),this.txtInput.maxChars=10,this.txtInput.restrict="0-9",this._model=InviteNewDataModel.instance,this.txtTime.text="永久",this.txtSelfCode.text=this._model.selfCode.toString();var e=[];e.push({value:this.SortMoney,label:"按充值金额"}),e.push({value:this.SortTime,label:"按邀请时间"}),this.comboSort.data=e,this.comboSort.select=0,this.comboSort.visible=!1,this.updateMyBind(),this.onSortChange()},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnBind",this.onBind,this),this._clickHelper.regClickFunc("btnCopy",this.onCopy,this),this.comboSort.addEventListener(egret.Event.CHANGE,this.onSortChange,this),this.listInvite.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onPlayer,this),xevent.addEventListener(InviteNewConfig.EVT_UpdateRed,this.onUpdateRed,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.comboSort.removeEventListener(egret.Event.CHANGE,this.onSortChange,this),this.listInvite.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onPlayer,this),xevent.removeEventListener(InviteNewConfig.EVT_UpdateRed,this.onUpdateRed,this)},e.prototype.showHelper=function(){var e=this;InviteNewDataModel.instance.getInfo((function(){t.prototype.showHelper.call(e)}),this)},e.prototype.updateMyBind=function(){if(this._model.bindNameList.length<=0)this.groupInput.visible=!0,this.groupInvite.visible=!1,this.txtInput.prompt="输入好友的邀请码";else{this.groupInvite.visible=!0,this.groupInput.visible=!1;for(var t=0;3>t;t++){var e=this["txtRole"+t];t<this._model.bindNameList.length?(e.visible=!0,e.includeInLayout=!0,e.text=this._model.bindNameList[t]):(e.visible=!1,e.includeInLayout=!1)}}},e.prototype.onSortChange=function(){InteractUtil.sortObjectOn(this._model.inviteList,"chargeNum",!1),InteractUtil.sortObjectOn(this._model.inviteList,"hasRebateAward",!1),this.listInvite.itemRenderer=InviteNewPlayerItem,this.listInvite.dataProvider=new eui.ArrayCollection(this._model.inviteList)},e.prototype.onCopy=function(){Tool.copy(this._model.selfCode),WorldMessage.addTips("复制成功")},e.prototype.onBind=function(){var t=this,e=parseInt(this.txtInput.text);return e==this._model.selfCode?void WorldMessage.addTips("不能绑定自己的邀请码"):void this._model.bindInvite(e,(function(){t.updateMyBind(),t.onSortChange()}),this)},e.prototype.onPlayer=function(t){new InviteNewRebatePanel(t.item).show()},e.prototype.onUpdateRed=function(t){var e=t.data;this.listInvite.dataProvider.itemUpdated(e),this.onSortChange()},e}(SceneBase);__reflect(InviteNewMainPanel.prototype,"InviteNewMainPanel");var InviteNewPlayerData=function(){function t(){this._roleList=[],this._roleIcon=[],this._rebateStatus=[]}return Object.defineProperty(t.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chargeNum",{get:function(){return this._chargeNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inviteTime",{get:function(){return this._inviteTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roleList",{get:function(){return this._roleList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roleIcon",{get:function(){return this._roleIcon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rebateStatus",{get:function(){return this._rebateStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRebateAward",{get:function(){return-1!=this._rebateStatus.indexOf(1)},enumerable:!0,configurable:!0}),t.parse=function(e){var n=new t;n._playerId=e.getLong();var i=e.getByte();n._roleList=[],n._roleIcon=[];for(var o=0;i>o;o++)n._roleList[o]=e.getString(),n._roleIcon[o]=e.getInt();n._chargeNum=e.getInt(),n._rebateStatus=[];for(var a=e.getInt(),r=0;r<InviteNewConfig.RebateAward.length;r++){var s=InviteNewConfig.RebateAward[r];n._rebateStatus[r]=a>>r&1?0:n.chargeNum>=s.charge?1:2}return n},t}();__reflect(InviteNewPlayerData.prototype,"InviteNewPlayerData");var InviteNewPlayerItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),nato.loadFont("assert/font/number1.fnt",(function(t,n){t&&(e.txtCharge.font=t)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);for(var e=this.data,n=0;3>n;n++){var i=this["txtRole"+n];n<e.roleList.length?(i.visible=!0,i.includeInLayout=!0,i.text=e.roleList[n]):(i.visible=!1,i.includeInLayout=!1)}this.txtCharge.text=e.chargeNum.toString(),this.imgHasAward.visible=e.hasRebateAward},e}(eui.ItemRenderer);__reflect(InviteNewPlayerItem.prototype,"InviteNewPlayerItem");var InviteNewRebateItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAward,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(t){e.btnGetAward.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onGetAward,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);for(var e=this.data,n=0;2>n;n++){var i=e.award.list[n],o=this["txtAward"+n];i?(o.visible=!0,o.includeInLayout=!0,o.text="可免费领取"+i.count+InteractUtil.toMoneyName(i.id)):(o.visible=!1,o.includeInLayout=!1)}switch(e.status){case 0:this.imgHasGain.visible=!0,this.btnGetAward.visible=!1;break;case 1:this.imgHasGain.visible=!1,this.btnGetAward.visible=!0,this.btnGetAward.touchEnabled=!0,DisplayUtil.clearFilter(this.btnGetAward);break;case 2:this.imgHasGain.visible=!1,this.btnGetAward.visible=!0,this.btnGetAward.touchEnabled=!1,DisplayUtil.applyGray(this.btnGetAward)}this.txtCharge.text="好友充值满"+e.award.charge+"元："},e.prototype.onGetAward=function(t){xevent.dispatchEventWith(InviteNewConfig.EVT_GetAward,!1,this.data)},e}(eui.ItemRenderer);__reflect(InviteNewRebateItem.prototype,"InviteNewRebateItem");var InviteNewRebatePanel=function(t){function e(e){var n=t.call(this)||this;return n._data=e,nato.attachSkin(n),n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),nato.loadFont("assert/font/number1.fnt",(function(t,n){t&&(e.txtCharge.font=t)}),this)},e.prototype.initComponent=function(){t.prototype.initComponent.call(this);for(var e=0;3>e;e++){var n=this["txtRole"+e];e<this._data.roleList.length?(n.visible=!0,n.includeInLayout=!0,n.text=this._data.roleList[e]):(n.visible=!1,n.includeInLayout=!1)}this.txtCharge.text=this._data.chargeNum.toString();var i=[];for(e=0;e<InviteNewConfig.RebateAward.length;e++)i[e]={status:this._data.rebateStatus[e],award:InviteNewConfig.RebateAward[e]};this.listAward.itemRenderer=InviteNewRebateItem,this.listAward.dataProvider=new eui.ArrayCollection(i)},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),xevent.addEventListener(InviteNewConfig.EVT_GetAward,this.onGetAward,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),xevent.dispatchEventWith(InviteNewConfig.EVT_UpdateRed,!1,this._data),xevent.removeEventListener(InviteNewConfig.EVT_GetAward,this.onGetAward,this)},e.prototype.onGetAward=function(t){var e=this,n=t.data,i=n.award.id;InviteNewDataModel.instance.getAward(this._data.playerId,i,(function(){n.status=0,e._data.rebateStatus[i]=0,e.listAward.dataProvider.itemUpdated(n)}),this)},e}(PanelBase);__reflect(InviteNewRebatePanel.prototype,"InviteNewRebatePanel");var QuickPowerAct=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=this;this._model=new QuickPowerModel,nato.Network.addMsgHandler(ProtocolDefine.CG_POWER_CHARGE,(function(e){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(e)||t._model.parseData(e)}),this),PanelManager.openWaitForServer(),nato.Network.sendCmd(new nato.Message(ProtocolDefine.CG_POWER_CHARGE))},e.prototype.dispose=function(){},e.prototype.getActData=function(t){return this._model.hasCharge()},e.prototype.openActivity=function(t){new QuickPowerPanel(this._model,t).show()},e}(egret.EventDispatcher);__reflect(QuickPowerAct.prototype,"QuickPowerAct",["IActivity","egret.IEventDispatcher"]);var QuickPowerModel=function(){function t(){this._leftCharge=0,this._chargeList=[],this.QPConfig={1:{1:2160,2:2159,3:2160,4:2161},18:{1:54,2:54,3:54,4:54},58:{1:55,2:55,3:55,4:55},128:{1:309,2:311,3:309,4:308}}}return t.prototype.hasCharge=function(){return this._leftCharge>0},Object.defineProperty(t.prototype,"chargeList",{get:function(){return this._chargeList},enumerable:!0,configurable:!0}),t.prototype.parseData=function(t){this._leftCharge=0;for(var e=t.getByte(),n=xself.getJob(),i=0;e>i;i++){var o=t.getInt(),a=t.getInt(),r=t.getInt(),s=t.getBoolean();this._leftCharge+=s?0:1;for(var l=t.getByte(),_=-1,h=[],u=[],c=this.QPConfig[o][n],T=0;l>T;T++){var p=this.getItemData(t);p.isMoney&&p.moneyType==c&&-1==u.indexOf(p.moneyType)&&(_=T,h.push(p),u.push(p.moneyType)),p.isMoney||p.id!=c||-1!=u.indexOf(p.id)||(_=T,h.push(p),u.push(p.id))}h.push(this.getItemData(t)),this._chargeList[i]={money:o,billId:a,chargeType:r,hasBuy:s,awardList:h,tabName:o+"元礼包",awardIndex:_}}PanelManager.mainMenu&&PanelManager.mainMenu.updateQuickPower()},t.prototype.getItemData=function(t){var e=new ItemData;return t.getBoolean()?(e.isMoney=!0,e.moneyType=InteractUtil.toMoneyType(t.getInt()),e.quantity=t.getInt()):(e.isMoney=!1,ItemData.fromBytesAtts2(e,t),e.quantity=t.getInt(),e.durMax>0&&(e.durability=e.durMax)),e},t}();__reflect(QuickPowerModel.prototype,"QuickPowerModel");var QuickPowerPanel=function(t){function e(e,n){var i=t.call(this)||this;return i._chargeMoney=[0,1,18,58,128],i._model=e,i._params=n,nato.attachSkin(i),i}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this);var e=[];this._model.chargeList.forEach((function(t){t.hasBuy||e.push(t)}),this);var n=0;this._params&&this._params>0&&(n=this._chargeMoney.indexOf(this._params)-1),0>n&&(n=0),this.tabCharge.itemRendererSkinName="TabButton2HDSkin",this.tabCharge.dataProvider=new eui.ArrayCollection(e),this.tabCharge.selectedIndex=n,this._selectCharge=e[n],this.updatePanel()},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnCharge",this.onBtnCharge,this),this.tabCharge.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabClick,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.tabCharge.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabClick,this)},e.prototype.updatePanel=function(){var t=this,e=this._chargeMoney.indexOf(this._selectCharge.money);this.imgTitle.source="qp_imgtext"+e+"_hd",this.imgEffect.source="qp_formation"+e+"_hd";var n=new MovieClip("qpmov"+e,-1,(function(){t.spEffMov.removeChildren(),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,t.spEffMov.addChild(n),3==e&&(n.x-=90,n.y-=50),n.play()}),this);n.load(),this.listAward.itemRenderer=ItemRender3,this.listAward.dataProvider=new eui.ArrayCollection(this._selectCharge.awardList)},e.prototype.onBtnCharge=function(){var t=this._selectCharge.billId,e=this._selectCharge.chargeType,n={option:this._selectCharge.awardIndex};Sdk.order(e,t,n)},e.prototype.onTabClick=function(t){var e=t.item;e.money!=this._selectCharge.money&&(this._selectCharge=e,this.updatePanel())},e}(SceneBase);__reflect(QuickPowerPanel.prototype,"QuickPowerPanel");var StrengthenAct=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this._control=new StrengthenControl,this._control.initAct()},e.prototype.dispose=function(){},e.prototype.getActData=function(t){return"task"==t?this._control.getTask():"hasAward"==t?this._control.hasAward():"init"==t?this._control.allTask.length>0:void 0},e.prototype.openActivity=function(t){this._control.openStrengthenPanel(t)},e}(egret.EventDispatcher);__reflect(StrengthenAct.prototype,"StrengthenAct",["IActivity","egret.IEventDispatcher"]);var StrengthenConfig=function(){function t(){}return t.T_OpenPet=1,t.T_OpenCountry=2,t.T_OpenEquipForge=3,t.T_ManorScene=4,t.T_Friend=5,t.T_FirstCharge=6,t.T_PersonAttribute=7,t.T_OpenVipPanel=8,t}();__reflect(StrengthenConfig.prototype,"StrengthenConfig");var StrengthenControl=function(){function t(){this._taskTab=0,this._allTask=[],this._taskMap={},t._instance=this}return Object.defineProperty(t.prototype,"taskTab",{get:function(){return this._taskTab},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allTask",{get:function(){return this._allTask},enumerable:!0,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.prototype.initAct=function(){var t=this;nato.Network.addMsgHandler(ProtocolDefine.CG_ACTOR_PUSH_BS_CHANGE,(function(e){var n=e.getInt(),i=e.getInt();null!=t._taskMap[n]&&(t._taskMap[n].progress=i),PanelManager.mainMenu&&PanelManager.mainMenu.updateStrengthen()}),this),PanelManager.openWaitForServer();var e=new nato.Message(ProtocolDefine.CG_ACTOR_FETCH_BS_DATA);nato.Network.sendCmd(e,(function(e){PanelManager.closeWaitForServer(),t.initTask(e),PanelManager.mainMenu&&PanelManager.mainMenu.updateStrengthen()}),this)},t.prototype.initTask=function(t){for(var e=t.getByte(),n=0;e>n;n++){for(var i=t.getString(),o=t.getInt(),a=t.getInt(),r=t.getByte(),s=[],l=0;r>l;l++){for(var _=t.getInt(),h=t.getString(),u=t.getInt(),c=t.getInt(),T=t.getString(),p=t.getBoolean(),d=t.getString(),E=t.getByte(),g=t.getInt(),S=t.getBoolean(),m=t.getByte(),f=[],I=0;m>I;I++){var A=new ItemData;t.getBoolean()?(A.isMoney=!1,ItemData.fromBytesAtts2(A,t),A.quantity=t.getInt(),A.durMax>0&&(A.durability=A.durMax)):(A.isMoney=!0,A.moneyType=InteractUtil.toMoneyType(t.getInt()),A.quantity=t.getInt()),f.push(A)}var y={id:_,condType:h,condValue:u,condValue2:c,taskParam:T,recommend:p,taskText:d,priority:E,progress:g,isDraw:S,awardList:f};this._taskMap[_]=y,s.push(y)}s.sort(this.sortTask);var R={title:i,sLevel:o,eLevel:a,tasks:s};this._allTask.push(R),InteractUtil.sortObjectOn(this._allTask,"sLevel")}},t.prototype.sortTask=function(t,e){return t.isDraw?e.isDraw?-1:1:e.isDraw||t.progress>=t.condValue2?-1:e.progress>=e.condValue2?1:-1},t.prototype.openStrengthenPanel=function(t){return this._allTask.length<=0?void AlertPanel.alertCommon("任务数据为空"):void new StrengthenPanel(t?this._taskTab:-1).show()},t.prototype.getTask=function(){this._taskTab=0;for(var t=xself.getLevel(),e=this._allTask.length-1;e>=0;e--){if(!(t<this._allTask[e].sLevel))for(var n=this._allTask[e].tasks,i=0;i<n.length;i++){var o=n[i];if(o.progress<o.condValue2)return this._taskTab=e,o.taskText}}return""},t.prototype.hasAward=function(){for(var t in this._taskMap){var e=this._taskMap[t];if(e.progress>=e.condValue2&&!e.isDraw)return!0}return!1},t.prototype.doTask=function(t){var e=Tool.parseStringToArray(t.taskParam,",");if(2==e.length)AutoFindPath.findPath(e[0],e[1]);else switch(e[0]){case StrengthenConfig.T_OpenPet:PanelManager.openPetScene();break;case StrengthenConfig.T_OpenCountry:PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS);break;case StrengthenConfig.T_OpenEquipForge:PanelManager.openForgeScene();break;case StrengthenConfig.T_ManorScene:PanelManager.openManorScene(ManorScene.TAB_INDEX_CITY);break;case StrengthenConfig.T_Friend:PanelManager.openSocietyScene();break;case StrengthenConfig.T_FirstCharge:FirstCharge.isOpen?PanelManager.openFirstChargeScene():AlertPanel.alertCommon("首冲活动已完成");break;case StrengthenConfig.T_OpenVipPanel:PanelManager.openVIPScene();break;case StrengthenConfig.T_PersonAttribute:PanelManager.openRoleScene();break;default:AlertPanel.alertCommon("未知界面ID:"+e[0])}},t.prototype.getAward=function(t,e,n){var i=new egret.ByteArray;i.writeInt(t.id),InteractUtil.sendMessage(ProtocolDefine.CG_ACTOR_DRAW_BS_AWARD,(function(i){t.isDraw=!0;var o=new StringBuffer,a=i.getInt(),r=i.getInt(),s=i.getInt();xself.setMoneyByType(ModelConst.MONEY1,a,o),xself.setMoneyByType(ModelConst.MONEY2,r,o),xself.setMoneyByType(ModelConst.MONEY3,s,o);var l=MsgHandler.processAddItemMsg(i,ProtocolDefine.CG_DRAW_WANBA_GIFT);o.append(l),WorldMessage.addTips(o.toString()),InteractUtil.applyFunc(e,n),xevent.dispatchEventWith("STGetAward"),PanelManager.mainMenu&&PanelManager.mainMenu.updateStrengthen()}),this,i)},t}();__reflect(StrengthenControl.prototype,"StrengthenControl");var StrengthenItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.btnTask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTask,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(){e.btnTask.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onTask,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,n=[{text:this.getTaskCondition(e.condType,e.condValue),style:{textColor:16042109,strokeColor:76586,stroke:3}}];e.recommend&&n.push({text:"（推荐）",style:{textColor:3407616,strokeColor:76586,stroke:3}}),this.txtTaskDesc.textFlow=n,this.btnTask.touchEnabled=!0,this.btnTask.touchChildren=!0,DisplayUtil.clearFilter(this.btnTask),e.progress>=e.condValue2?(this.imgComplete.visible=!0,this.spProgress.visible=!1,this.btnTask.label=e.isDraw?"已领取":"领取",e.isDraw&&(this.btnTask.touchEnabled=!1,this.btnTask.touchChildren=!1,DisplayUtil.applyGray(this.btnTask))):(this.spProgress.visible=!0,this.imgComplete.visible=!1,this.btnTask.label="前往"),this.txtProgress.text=e.progress+"/"+e.condValue2,this.listAward.itemRenderer=ItemRender1,this.listAward.dataProvider=new eui.ArrayCollection(e.awardList)},e.prototype.onTask=function(t){var e=this,n=this.data;n.progress>=n.condValue2?StrengthenControl.instance.getAward(n,(function(){e.btnTask.label="已领取",e.btnTask.touchEnabled=!1,e.btnTask.touchChildren=!1,DisplayUtil.applyGray(e.btnTask)}),this):StrengthenControl.instance.doTask(n)},e.prototype.getTaskCondition=function(t,e){var n="";switch(t){case"player_skill":n="任意1个主动、1个自动、4个被动技能到"+e+"级";break;case"pet_level":n="宠物等级提升到"+e+"级";break;case"have_country":n="加入或创建国家";break;case"city_level":n="领地提升至"+e+"级";break;case"equip_identify":n="身上有"+e+"件装备有进行鉴定";break;case"equip_gem":n="身上所有装备共有"+e+"颗宝石";break;case"equip_stars":n="身上所有装备的升星总数为"+e+"星";break;case"mission_jlzs":n="完成1次任务“精灵之森-初级”";break;case"add_friends":n="加一位好友";break;case"first_charge":n="进行首冲";break;case"fight_power":n="战力到达"+e;break;case"mercenary":n="雇佣一次佣兵";break;case"team_battle":n="完成一次组队战斗";break;case"vip_level":n="vip等级到达"+e+"级以上";break;case"pet_skill_1":n="宠物学习任意1个主动技能、1个自动技能、3个被动技能";break;case"pet_skill_2":n="宠物将任意1个主动技能、自动技能、5个被动技能学习至"+e+"级";break;case"pet_skill_3":n="宠物将任意技能学习到"+e+"级";break;case"country_skill":n="在国家的技能所中将任意技能学习至"+e+"级";break;case"hero_battle_1":n="通关1次英雄挑战赛-初级";break;case"hero_battle_2":n="通关1次英雄挑战赛-高级"}return n},e}(eui.ItemRenderer);__reflect(StrengthenItem.prototype,"StrengthenItem");var StrengthenPanel=function(t){function e(e){var n=t.call(this)||this;return n._selectTab=0,n._selectTab=e,nato.attachSkin(n),n}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this);var e=-1,n=[];this._control=StrengthenControl.instance;for(var i=this._control.allTask,o=0;o<i.length;o++){var a=i[o];if(-1==e)for(var r=0;r<a.tasks.length;r++){var s=a.tasks[r];if(s.progress>=s.condValue2&&!s.isDraw){e=o;break}}n.push({tabName:a.sLevel+"-"+a.eLevel+"级"})}this.tabLevel.itemRendererSkinName="TabButton2HDSkin",this.tabLevel.dataProvider=new eui.ArrayCollection(n),this.tabLevel.selectedIndex=-1==this._selectTab?-1==e?0:e:this._selectTab,this.updatePanel()},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),xevent.addEventListener("STGetAward",this.updatePanel,this),this.tabLevel.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTab,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),xevent.removeEventListener("STGetAward",this.updatePanel,this),this.tabLevel.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTab,this)},e.prototype.updatePanel=function(){this._selectTab=this.tabLevel.selectedIndex;var t=this._control.allTask[this._selectTab];t.tasks.sort(this.sortTask),this.listTask.itemRenderer=StrengthenItem,this.listTask.dataProvider=new eui.ArrayCollection(t.tasks),this.validateNow();for(var e=0;e<this.tabLevel.numElements;e++){for(var n=!1,i=this._control.allTask[e].tasks,o=0;o<i.length;o++)if(i[o].progress>=i[o].condValue2&&!i[o].isDraw){n=!0;break}var a=this.tabLevel.getElementAt(e);n?RedPoint.addRedPoint(a):RedPoint.removeRedPoint(a)}},e.prototype.sortTask=function(t,e){return t.isDraw?e.isDraw?-1:1:e.isDraw||t.progress>=t.condValue2?-1:e.progress>=e.condValue2?1:-1},e.prototype.onTab=function(t){this._selectTab!=t.itemIndex&&this.updatePanel()},e}(SceneBase);__reflect(StrengthenPanel.prototype,"StrengthenPanel");var ActorBuyHandler=function(){function t(){}return t.doActorSellList=function(){PanelManager.openWaitForServer();var e=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_MY_LIST);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),null!=e){if(0>e.getByte())return void AlertPanel.alertCommon(e.getString());for(var n=e.getByte(),i=[],o=0;n>o;o++){var a=t.fromBytesToActorSellList(e);null!=a&&(a.setPlayerSprite(a.createSprite(!1)),i.push(a))}var r={minPrice:e.getInt(),maxPrice:e.getInt(),playerList:i};xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_SELL_LIST,r))}}),this)},t.fromBytesToActorSellList=function(t){if(null==t)return null;var e=new ListPlayer;return e.setId(t.getInt()),e.setName(t.getString()),e.setSex(t.getByte()),e.setRace(t.getByte()),e.setJob(t.getByte()),e.setLevel(t.getByte()),e.setIcon1(t.getInt()),e.setIcon2(t.getInt()),e.setIcon3(t.getInt()),t.getBoolean()&&(e.setStatusBit(ModelConst.STATUS_SELL),e.sellPrice=t.getInt()),e.setVipLevel(t.getByte()),e},t.doActorSell=function(e,n){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var i=e,o=function(t){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(t)||(i.sellPrice=n,i.setStatusBit(ModelConst.STATUS_SELL),AlertPanel.alertCommon(GameText.STR_ACTOR_HAND_SELL_SUCCESS),xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_SELL_PANEL_UPDATE)))};AlertPanel.alert(GameText.STR_ACTOR_SELL,Tool.manageString(GameText.STR_ACTOR_SELL_ASK_UP,n+GameText.STR_MONEY1),(function(){PanelManager.openWaitForServer();var e=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_START);e.putInt(i.getId()),e.putInt(n),nato.Network.sendCmd(e,o,t)}),this)},t.doCancelActorSell=function(e){if(0!=SafeLock.doSafeLockVerify()&&null!=e){var n=function(t){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(t)||(e.clearStatusBit(ModelConst.STATUS_SELL),AlertPanel.alertCommon(GameText.STR_ACTOR_SELL_CANCEL_SUCCESS),xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_SELL_PANEL_UPDATE)))};AlertPanel.alert(GameText.STR_ACTOR_SELL_CANCEL,GameText.STR_ACTOR_SELL_ASK_DOWN,(function(){PanelManager.openWaitForServer();var i=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_CANCEL);i.putInt(e.getId()),nato.Network.sendCmd(i,n,t)}),this)}},t.doActorBuy=function(e,n,i){void 0===i&&(i=6);var o=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_LIST);switch(o.putByte(e[0]),e[0]){case t.ACTOR_SELL_FIND_TYPE_NAME:o.putString(e[1]);break;case t.ACTOR_SELL_FIND_TYPE_ID:o.putInt(e[1]);break;default:o.putByte(e[1]),o.putByte(e[2]),o.putByte(e[3])}o.putByte(i),o.putShort(n);PanelManager.openWaitForServer(),nato.Network.sendCmd(o,(function(e){if(PanelManager.closeWaitForServer(),null!=e){for(var n=e.getShort(),o=e.getByte(),a=[],r=0;o>r;r++){var s=t.fromBytesToActorBuyList(e);null!=s&&a.push(s)}xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_BUY_LIST,{list:a,totalPage:Math.ceil(n/i)}))}}),this)},t.fromBytesToActorBuyList=function(t){if(null==t)return null;var e=new ListPlayer;return e.setId(t.getInt()),e.setName(t.getString()),e.setSex(t.getByte()),e.setRace(t.getByte()),e.setJob(t.getByte()),e.setLevel(t.getByte()),e.setIcon1(t.getInt()),e.setIcon2(t.getInt()),e.setIcon3(t.getInt()),e.sellPrice=t.getInt(),e.ownerId=t.getInt(),e.setVipLevel(t.getByte()),e.setPlayerSprite(e.createSprite(!1)),e.sellSprite=e.getPlayerSprite(),e.setStatusBit(ModelConst.STATUS_SELL),e},t.doActorSellBuy=function(e){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var n=function(t){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(t)){var e=t.getInt();xself.money1=e,AlertPanel.alertCommon(GameText.STR_ACTOR_BUY_PLAYER_SUCCESS),xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_BUY_PANEL_UPDATE))}},i=function(){PayInfo.getPayList(!0)},o=function(){if(xself.getVipLevel()<1)AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_ACTOR_DESC_NO_VIP,i,t);else{var o=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_BUY);o.putInt(e.getId()),PanelManager.openWaitForServer(),nato.Network.sendCmd(o,n,t)}};AlertPanel.alert(GameText.STR_ACTOR_SELL_BUY,Tool.manageString(GameText.STR_ACTOR_SELL_BUY_ASK,e.sellPrice+GameText.STR_MONEY1),(function(){Model.checkEnoughMoney(e.sellPrice,0,0,o,t)}),this)},t.doSeeSellActorInfo=function(e,n,i){if(void 0===i&&(i=null),null!=e&&e instanceof ListPlayer!=0){var o=e,a=!0;if(n==t.ACTOR_SELL_INFO_TYPE_DETAIL||n==t.ACTOR_SELL_INFO_TYPE_ITEM||n==t.ACTOR_SELL_INFO_TYPE_SKILL||n==t.ACTOR_SELL_INFO_TYPE_PET_LIST?o.isTabStatus(Model.SELL_PLAYER_INFO_LOAD)&&(a=!1):n==t.ACTOR_SELL_INFO_TYPE_STORAGE?o.isTabStatus(Model.SELL_PLAYER_STORE_LOAD)&&(a=!1):n==t.ACTOR_SELL_INFO_TYPE_STORAGE_VIP&&o.isTabStatus(Model.SELL_PLAYER_STORE_VIP_LOAD)&&(a=!1),1==a){var r=new nato.Message(ProtocolDefine.CG_ACTOR_SELL_SEE);if(r.putInt(o.getId()),r.putByte(n),n==t.ACTOR_SELL_INFO_TYPE_PET_DATA){var s=-1;null!=i&&null!=i.petItem&&(s=i.petItem.slotPos),r.putShort(s)}PanelManager.openWaitForServer(),nato.Network.sendCmd(r,(function(a){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(a)&&null!=a){switch(n){case t.ACTOR_SELL_INFO_TYPE_DETAIL:case t.ACTOR_SELL_INFO_TYPE_ITEM:case t.ACTOR_SELL_INFO_TYPE_SKILL:case t.ACTOR_SELL_INFO_TYPE_PET_LIST:null==o.bag&&(o.bag=new PlayerBag(o)),MsgHandler.instance.processDataPlayerDetail(a,o);var r=MsgHandler.processDataPlayerItemMsg(a,o);o.bag.initBagItem(r),o.skillList=MsgHandler.processDataPlayerSkillMsg(a,!0),o.formationList=Skill.doGetFormation(a),o.setTabStatus(!0,Model.SELL_PLAYER_INFO_LOAD);break;case t.ACTOR_SELL_INFO_TYPE_PET_DATA:0==i.isTabStatus(Model.PET_INFO)&&(i.setTabStatus(!0,Model.PET_INFO),MyPet.fromBytesDetail(a,i),null!=i&&i.refreshWorldSprite()),PanelManager.openPetDetailScene(i,PetDetailScene.FromType_trade);break;case t.ACTOR_SELL_INFO_TYPE_STORAGE:null==o.bag&&(o.bag=new PlayerBag(o)),o.numStroe=a.getByte(),r=MsgHandler.processDataPlayerItemMsg2(a),o.bag.initBagItem(r),o.setTabStatus(!0,Model.SELL_PLAYER_STORE_LOAD);break;case t.ACTOR_SELL_INFO_TYPE_STORAGE_VIP:null==o.bag&&(o.bag=new PlayerBag(o)),a.getByte(),r=MsgHandler.processDataPlayerItemMsg2(a),o.bag.initBagItem(r),o.setTabStatus(!0,Model.SELL_PLAYER_STORE_VIP_LOAD);break;case t.ACTOR_SELL_INFO_TYPE_CITY:City.fromBytes(a).isOtherPlayer=!0,City.doViewCityInfo(e.getId(),ManorScene.ACTOR_SELL_CITY);break;case t.ACTOR_SELL_INFO_TYPE_COUNTRY:o.countryHonor=a.getInt(),o.setCountryRank(a.getByte()),o.status=a.getInt();var s=new Country(-1);Country.fromBytes(s,a),s.sellPlayer=o,PanelManager.getPanel(ManorScene).updateCountryStatus(s),PanelManager.openManorScene(ManorScene.TAB_INDEX_STATUS,ManorScene.ACTOR_SELL_COUNTRY)}t.openSellActorInfoPanel(o,n)}}),this)}else this.openSellActorInfoPanel(o,n)}},t.openSellActorInfoPanel=function(e,n){switch(n){case t.ACTOR_SELL_INFO_TYPE_DETAIL:case t.ACTOR_SELL_INFO_TYPE_SKILL:PanelManager.openRoleScene(e);break;case t.ACTOR_SELL_INFO_TYPE_ITEM:PanelManager.openBag(0,e);break;case t.ACTOR_SELL_INFO_TYPE_PET_LIST:PanelManager.openPetScene(e,PetScene.FromType_sell);break;case t.ACTOR_SELL_INFO_TYPE_STORAGE:PanelManager.openStorePanel(StorePanel.Type_person_other,e,!1);break;case t.ACTOR_SELL_INFO_TYPE_STORAGE_VIP:PanelManager.openStorePanel(StorePanel.Type_person_vip_other,e,!1)}},t.ACTOR_SELL_FIND_TYPE_DF=1,t.ACTOR_SELL_FIND_TYPE_NAME=2,t.ACTOR_SELL_FIND_TYPE_ID=3,t.ACTOR_SELL_FIND_ORDER_BY_DF=-1,t.ACTOR_SELL_FIND_ORDER_BY_LEVEL_ASC=1,t.ACTOR_SELL_FIND_ORDER_BY_LEVEL_DESC=2,t.ACTOR_SELL_FIND_ORDER_BY_MONEY_ASC=3,t.ACTOR_SELL_FIND_ORDER_BY_MONEY_DESC=4,t.ACTOR_SELL_FIND_ORDER_BY_VIP_LEVEL_ASC=5,t.ACTOR_SELL_FIND_ORDER_BY_VIP_LEVEL_DESC=6,t.ACTOR_SELL_INFO_TYPE_DETAIL=1,t.ACTOR_SELL_INFO_TYPE_ITEM=2,t.ACTOR_SELL_INFO_TYPE_SKILL=3,t.ACTOR_SELL_INFO_TYPE_PET_LIST=4,t.ACTOR_SELL_INFO_TYPE_PET_DATA=5,t.ACTOR_SELL_INFO_TYPE_STORAGE=6,t.ACTOR_SELL_INFO_TYPE_CITY=7,t.ACTOR_SELL_INFO_TYPE_COUNTRY=8,t.ACTOR_SELL_INFO_TYPE_STORAGE_VIP=9,t}();__reflect(ActorBuyHandler.prototype,"ActorBuyHandler");var ActorBuyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._data=null,ButtonUtils.removeTouchEvent(this.btn_buy),ButtonUtils.removeTouchEvent(this.btn_look),this._vipItem&&(Tool.removeObjSafe(this._vipItem),ObjectPool.getPool("VipNumberItem").returnObject(this._vipItem),this._vipItem=null)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.initPanel=function(){this._data&&(ButtonUtils.addTouchEvent(this.btn_buy,this.onBuy,this),ButtonUtils.addTouchEvent(this.btn_look,this.onLook,this),this.btn_buy.label=GameText.STR_BUY,this.btn_look.label=GameText.STR_SEE,this.label_name.text=this._data.getName(),this.label_level.text="("+this._data.getLevel()+GameText.STR_STEP+Define.getJobString(this._data.getJob())+")",this.label_price.text=this._data.sellPrice+"",this._vipItem||(this._vipItem=ObjectPool.getPool("VipNumberItem").createObject(),this._vipItem.x=15*xhdRatio,this._vipItem.y=27*xhdRatio,this.addChild(this._vipItem)),this._vipItem.num=this._data.getVipLevel())},e.prototype.onBuy=function(){ActorBuyHandler.doActorSellBuy(this._data)},e.prototype.onLook=function(){var t=PanelManager.getPanel(ActorBuyMenuPanel);t.setPlayer(this._data),PopUpManager.addPopUp(t,PopUpManager.EffectType.NONE,!0,PopUpManager.CloseType.NONE)},e}(ComponentBase);__reflect(ActorBuyItem.prototype,"ActorBuyItem");var ActorBuyMenuPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_name.text=this._player.getName(),this.label_id.text=this._player.getClientUid(!0),Menu.setData(this,this._player,Menu.UI_INTO_ACTOR_SELL_LIST,!0)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._player=null},e.prototype.setPlayer=function(t){this._player=t},e}(WindowPanelBase);__reflect(ActorBuyMenuPanel.prototype,"ActorBuyMenuPanel");var ActorBuyPanel=function(t){function e(){var e=t.call(this)||this;return e.typeTable=["等级","价格","VIP等级"],e.searchType=ActorBuyHandler.ACTOR_SELL_FIND_TYPE_DF,e._currComboBoxJob=0,e._currComboBoxType=0,e._currSort=ActorBuyHandler.ACTOR_SELL_FIND_ORDER_BY_LEVEL_DESC,e._currPage=1,e._radioDefault=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e);for(var n=ListPlayer.getSortJobMenuList(),i=[],o=0,a=n.length;a>o;o++)i.push({value:o,label:n[o]});for(this.job_comboBox.data=i,this.job_comboBox.select=this._currComboBoxJob,i=[],o=0,a=this.typeTable.length;a>o;o++)i.push({value:o+1,label:this.typeTable[o]});this.type_comboBox.data=i,this.type_comboBox.select=this._currComboBoxType,this.type_comboBox.addEventListener(egret.Event.CHANGE,this.onComboBoxSearchType,this),this.job_comboBox.addEventListener(egret.Event.CHANGE,this.onComboBoxSearchJob,this),ButtonUtils.addTouchEvent(this.btn_search,this.onSearch,this),ButtonUtils.addTouchEvent(this.btn_sort,this.onSort,this),this.turnPage.pageCount=6,this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),xevent.addEventListener(WorldEvent.ACTOR_BUY_LIST,this.returnList,this),xevent.addEventListener(WorldEvent.ACTOR_BUY_PANEL_UPDATE,this.onUpdate,this),Tool.removeObjSafe(this.searchView),this.setBtnSortDir(),this.getList()},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this.type_comboBox.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearchType,this),this.job_comboBox.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearchJob,this),ButtonUtils.removeTouchEvent(this.btn_search),ButtonUtils.removeTouchEvent(this.btn_sort),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),xevent.removeEventListener(WorldEvent.ACTOR_BUY_LIST,this.returnList,this),xevent.removeEventListener(WorldEvent.ACTOR_BUY_PANEL_UPDATE,this.onUpdate,this),this._buyItemList){for(var n=0,i=this._buyItemList.length;i>n;n++)Tool.removeObjSafe(this._buyItemList[n]),ObjectPool.getPool("ActorBuyItem").returnObject(this._buyItemList[n]);this._buyItemList.length=0}this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this.removePlayerSprite()},e.prototype.cleanData=function(){this._currComboBoxJob=0,this._currComboBoxType=0,this._currSort=ActorBuyHandler.ACTOR_SELL_FIND_ORDER_BY_LEVEL_DESC,this._currPage=1,this._radioDefault=0,this.searchType=ActorBuyHandler.ACTOR_SELL_FIND_TYPE_DF},e.prototype.removePlayerSprite=function(){this._playerSprite&&(Tool.removeObjSafe(this._playerSprite),this._playerSprite=null)},e.prototype.onComboBoxSearchType=function(){this.searchType=ActorBuyHandler.ACTOR_SELL_FIND_TYPE_DF,this._currComboBoxType=this.type_comboBox.selectData.value;var t=this.type_comboBox.selectData.value;this._currSort%2==0?this._currSort=2*this._currComboBoxType:this._currSort=2*t-1,this.getList()},e.prototype.onComboBoxSearchJob=function(){this.searchType=ActorBuyHandler.ACTOR_SELL_FIND_TYPE_DF,this._currComboBoxJob=this.job_comboBox.selectData.value,this.getList()},e.prototype.onSearch=function(){CommonFormPanel.actorBuySearch(this.searchCallback,this)},e.prototype.searchCallback=function(t,e,n){if(!Tool.isNullText(t[0]))if(this.searchType=n,n===ActorBuyHandler.ACTOR_SELL_FIND_TYPE_NAME)this.searchValueName=t[0];else this.searchValueID=parseInt(t[0])},e.prototype.onSort=function(){this.searchType=ActorBuyHandler.ACTOR_SELL_FIND_TYPE_DF;var t=this.type_comboBox.selectData.value;this._currSort%2==0?this._currSort=2*t-1:this._currSort=2*t,this.setBtnSortDir(),this.getList()},e.prototype.setBtnSortDir=function(){this._currSort%2!=0?this.btn_sort.source="shengxu_hd":this.btn_sort.source="jiangxu_hd"},e.prototype.onTurnPage=function(){this._currPage=this.turnPage.currentPage,this.getList()},e.prototype.getList=function(){var t=[this.searchType];switch(this.searchType){case ActorBuyHandler.ACTOR_SELL_FIND_TYPE_NAME:t.push(this.searchValueName);break;case ActorBuyHandler.ACTOR_SELL_FIND_TYPE_ID:t.push(this.searchValueID);break;default:0==this._currComboBoxJob?t.push(-1):t.push(ListPlayer.getJobEvent(this._currComboBoxJob)),t.push(-1),t.push(this._currSort)}ActorBuyHandler.doActorBuy(t,this._currPage)},e.prototype.returnList=function(t){this.turnPage.setPage(this._currPage,t.param.totalPage),this.showItem(t.param.list)},e.prototype.showItem=function(t){if(this.removePlayerSprite(),t)for(var e=0,n=t.length;n>e;e++){var i;this._buyItemList||(this._buyItemList=[]),e<this._buyItemList.length?i=this._buyItemList[e]:(i=ObjectPool.getPool("ActorBuyItem").createObject(),nato.attachSkin(i),this._buyItemList.push(i)),i.x=8*xhdRatio,i.y=60*xhdRatio+(i.height+1)*e,i.data=t[e],i.parent||this.addChild(i)}if(this.addChild(this.bg),t&&t.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._radioDefault>t.length-1&&(this._radioDefault=0),this._radioBtns.add(this._buyItemList,this._radioDefault,!0,!0),this.showPlayerSprite(this._buyItemList[this._radioDefault].data)),this._buyItemList)for(n=this._buyItemList.length;n>e;e++)ObjectPool.getPool("ActorBuyItem").returnObject(this._buyItemList[e]),Tool.removeObjSafe(this._buyItemList[e]),this._buyItemList.splice(e,1),e--,n--;this._currPage=this.turnPage.currentPage},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurentSelectItem().data;this.showPlayerSprite(e),this._radioDefault=this._radioBtns.getCurrentIndex()},e.prototype.showPlayerSprite=function(t){if(this.removePlayerSprite(),t){var e=t.sellSprite;null==e&&(e=t.createSprite(!1)),this._playerSprite=GameSprite.cloneSprite(e),this._playerSprite.setScale(xhd?1.5:1),this._playerSprite.x=xhd?100:45,this._playerSprite.y=xhd?130:65,this.addChild(this._playerSprite)}},e.prototype.onUpdate=function(){this._radioDefault=0,this.getList()},e}(ComponentBase);__reflect(ActorBuyPanel.prototype,"ActorBuyPanel");var ActorBuyScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){this.tabPanelList=[this.buy_panel,this.sell_panel],t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.updateTab=function(){t.prototype.updateTab.call(this);var e=this.getCurrentPanel();this.buy_panel&&e!=this.buy_panel&&this.buy_panel.cleanData()},e.prototype.closePanel=function(){this.buy_panel.cleanData(),t.prototype.closePanel.call(this)},e}(TabPanelBase);__reflect(ActorBuyScene.prototype,"ActorBuyScene");var ActorSellItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this._playerSprite),this._playerSprite=null,this._data=null,this._vipItem&&(Tool.removeObjSafe(this._vipItem),ObjectPool.getPool("VipNumberItem").returnObject(this._vipItem),this._vipItem=null),ButtonUtils.removeTouchEvent(this.btn_action)},e.prototype.setData=function(t){this._data=t,this.stage&&this.initPanel()},e.prototype.initPanel=function(){this._data&&(ButtonUtils.addTouchEvent(this.btn_action,this.onAction,this),this.label_name.text=this._data.getName(),this.label_level.text="("+this._data.getLevel()+GameText.STR_STEP+Define.getJobString(this._data.getJob())+")",this._data.isStatusBit(ModelConst.STATUS_SELL)?(this.label_status.text=GameText.STR_STATUS_SELL,this.btn_action.label=GameText.STR_ACTOR_SELL_CANCEL):(this.label_status.text=GameText.STR_STATUS_NUSELL,this.btn_action.label=GameText.STR_ACTOR_HAND_SELL),this._vipItem||(this._vipItem=ObjectPool.getPool("VipNumberItem").createObject(),this._vipItem.x=95*xhdRatio,this._vipItem.y=47*xhdRatio,this.addChild(this._vipItem)),this._vipItem.num=this._data.getVipLevel(),this.createPlayerSprite())},e.prototype.createPlayerSprite=function(){if(!this._playerSprite){var t=this._data.sprite;null==t&&(t=this._data.createSprite(!1)),this._playerSprite=GameSprite.cloneSprite(t),this._playerSprite.setScale(xhd?1.5:1),this._playerSprite.touchEnabled=!1,this._playerSprite.touchChildren=!1;var e=PanelManager.getPanel(ActorBuyScene);this._playerSprite.x=(xhd?110:55)+e.x+this.x,this._playerSprite.y=(xhd?150:75)+e.y+this.y,e.sell_panel.addChild(this._playerSprite)}},e.prototype.onAction=function(){this._data.isStatusBit(ModelConst.STATUS_SELL)?xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_CANCEL_SELL,this._data)):xevent.dispatchEvent(new WorldEvent(WorldEvent.ACTOR_SELL_READY,this._data))},e}(ComponentBase);__reflect(ActorSellItem.prototype,"ActorSellItem");var ActorSellPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.ACTOR_SELL_LIST,this.getSellList,this),xevent.addEventListener(WorldEvent.ACTOR_SELL_READY,this.onReadyToSell,this),xevent.addEventListener(WorldEvent.ACTOR_CANCEL_SELL,this.onCancelSell,this),xevent.addEventListener(WorldEvent.ACTOR_SELL_PANEL_UPDATE,this.onUpdate,this),ButtonUtils.addTouchEvent(this.btn_sell,this.onSell,this),ActorBuyHandler.doActorSellList(),Tool.removeObjSafe(this.group_sell),this.input_txt.text="",this.input_txt.prompt=GameText.ACTOR_BUY_INPUT_PROMPT,this.input_txt.restrict="0-9",this.input_txt.maxChars=8,this.btn_sell.label=GameText.STR_HANG_SELL,this.touchEnabled=!1},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.ACTOR_SELL_LIST,this.getSellList,this),xevent.removeEventListener(WorldEvent.ACTOR_SELL_READY,this.onReadyToSell,this),xevent.removeEventListener(WorldEvent.ACTOR_SELL_PANEL_UPDATE,this.onUpdate,this),xevent.removeEventListener(WorldEvent.ACTOR_CANCEL_SELL,this.onCancelSell,this),ButtonUtils.removeTouchEvent(this.btn_sell),this.itemList){for(var n=this.itemList.length-1;n>=0;n--)Tool.removeObjSafe(this.itemList[n]),ObjectPool.getPool("ActorSellItem").returnObject(this.itemList[n]);this.itemList=null}this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this._data=null,this._playerToSell=null},e.prototype.getSellList=function(t){this._data=t.param,this.initPanel()},e.prototype.initPanel=function(){for(var t=0,e=this._data.playerList.length;e>t;t++){var n=ObjectPool.getPool("ActorSellItem").createObject();nato.attachSkin(n),this.itemList||(this.itemList=[]),n.setData(this._data.playerList[t]),this.itemList.push(n),n.y=t*n.height,this.group_item.addChild(n)}e>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._radioBtns.add(this.itemList,-1)),this.label_money.text="("+GameText.STR_MONEY1+this._data.minPrice+"~"+this._data.maxPrice+")"},e.prototype.selectItem=function(){},e.prototype.onReadyToSell=function(t){this.group_sell.stage||(this.group_sell.x=0,this.group_item.addChild(this.group_sell)),this._playerToSell=t.param},e.prototype.onCancelSell=function(t){Tool.removeObjSafe(this.group_sell),ActorBuyHandler.doCancelActorSell(t.param)},e.prototype.onSell=function(t){this._playerToSell&&ActorBuyHandler.doActorSell(this._playerToSell,parseInt(this.input_txt.text))},e.prototype.onUpdate=function(){Tool.removeObjSafe(this.group_sell);for(var t=0,e=this._data.playerList.length;e>t;t++)this.itemList[t].setData(this._data.playerList[t])},e}(ComponentBase);__reflect(ActorSellPanel.prototype,"ActorSellPanel");var ArenaItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_watch,this.onWatchPlayer,this),ButtonUtils.addTouchEvent(this.btn_fight,this.onFightPlayer,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_watch),ButtonUtils.removeTouchEvent(this.btn_fight)},e.prototype.setEmpty=function(){this.content.visible=!1,this.avatar&&this.roleCtn.contains(this.avatar)&&this.roleCtn.removeChild(this.avatar)},e.prototype.update=function(t){return this.playerdata=t,null==t?void this.setEmpty():(this.content.visible=!0,this.avatar&&this.roleCtn.contains(this.avatar)&&this.roleCtn.removeChild(this.avatar),this.avatar=SpriteHelper.createOtherHeadSpriteByIcon(t.getIcon1()),this.avatar.setScale(nato.mapRatio),this.roleCtn.addChild(this.avatar),this.level.text=t.getLevel()+"",this.job.text=Define.getJobString(t.getJob()),this.point.text=t.arenaPoint+"",this.win_rate.text=t.Pkwincount+"%",void(this.playerdata.arenaStutas==Arena.STATUS_PK?this.btn_fight.label="观战":this.btn_fight.label="挑战"))},e.prototype.onWatchPlayer=function(t){null!=this.playerdata&&PanelManager.openPlayerMenuPanel(this.playerdata,Menu.UI_INTO_ARENA_SEE_OTHER)},e.prototype.onFightPlayer=function(t){null!=this.playerdata&&(this.playerdata.arenaStutas==Arena.STATUS_NONE?Arena.doArenaPK(this.playerdata,this.playerdata.getId()):this.playerdata.arenaStutas==Arena.STATUS_PK&&GameWorld.doBattleSeeInter(this.playerdata.getId()))},e}(ComponentBase);__reflect(ArenaItem.prototype,"ArenaItem");var ArenaScene=function(t){function e(){var e=t.call(this)||this;return e._tabBtnList=[],e._tabIndex=0,e._arenaItemList=[],e.arenaItemPool=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.selectTabBtnList([this.tab_btn_fight,this.tab_btn_see],0),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_close,this.onExit,this),ButtonUtils.addTouchEvent(this.btn_see_rand,this.onSeeRandomly,this),ButtonUtils.addTouchEvent(this.btn_fight_rand,this.onFightRandomly,this),this._tabBtnList.length=0,this._tabBtnList.push(this.tab_btn_fight),this._tabBtnList.push(this.tab_btn_see),this.tab_btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this),this.tab_btn_see.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this),this.player_info.setData(xself),this._tabIndex=0,this.updateTab(!0)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_fight_rand),ButtonUtils.removeTouchEvent(this.btn_see_rand)},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.openTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.updateTab=function(t){void 0===t&&(t=!1),ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),t||(this._tabIndex==e.TAB_INDEX_FIGHT?Arena.doArenaNearActorList(this.arena,Arena.STATUS_PK):this._tabIndex==e.TAB_INDEX_SEE&&Arena.doArenaNearActorList(this.arena,Arena.STATUS_NONE))},e.prototype.setData=function(t){this.arena=t},e.prototype.updateFightCountAndScore=function(){var t=this.arena.scoreSum;this.now_score.text=t+"";var e=this.arena.fightCount;this.fight_count.text=e+""},e.prototype.update=function(){this.cleanContainer(),this.arena.isTimeOut()?this.time.text="结束":this.time.text=Tool.getPlanTimeString(this.arena.endTime,!0),this.point.text=this.arena.scoreSum+"";for(var t=this.arena.playerList,e=t.length>5?t.length:5,n=0;e>n;n++){var i=this.arena.getPlayerfromIndex(n),o=this.getArenaItem();o.update(i),this.container.add(o),this._arenaItemList.push(o)}this.container.update()},e.prototype.cleanContainer=function(){for(;this._arenaItemList.length;)this.arenaItemPool.push(this._arenaItemList.pop());this._arenaItemList.length=0,this.container.reset()},e.prototype.getArenaItem=function(){if(this.arenaItemPool.length>0)return this.arenaItemPool.pop();var t=new ArenaItem;return nato.attachSkin(t),t},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onSearch=function(t){Arena.doPointMenu(this.arena)},e.prototype.onFightRandomly=function(t){Arena.doArenaPK(null,-1)},e.prototype.onSeeRandomly=function(t){Arena.doArenaWatch()},e.prototype.onExit=function(t){Arena.doArenaExit()},e.prototype.onRefresh=function(t){Arena.doUpdateArenaNearActorList()},e.TAB_INDEX_SEE=0,e.TAB_INDEX_FIGHT=1,e}(ComponentBase);__reflect(ArenaScene.prototype,"ArenaScene");var AroundPanel=function(t){function e(){var e=t.call(this)||this;return e._selectType=Define.NEAR_ALL,e._index=0,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_filter,this.onBtnFilter,this),this.bg.touchEnabled=!1,this.touchEnabled=!1,this.btn_hiding.addEventListener(egret.Event.CHANGE,this.onHidingChange,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_filter),this.btn_hiding.removeEventListener(egret.Event.CHANGE,this.onHidingChange,this),this._selectType=Define.NEAR_ALL,this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),xevent.removeEventListener(WorldEvent.AROUND_LOOK_PLAYER_INFO,this.lookPlayerInfo,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this._playerSprite&&(Tool.removeObjSafe(this._playerSprite.cloakSprite),Tool.removeObjSafe(this._playerSprite),this._playerSprite=null),Tool.removeObjSafe(this._con),this._con=null},e.prototype.onHidingChange=function(t){this.btn_hiding.selected?xworld.hidingOtherPlayers=!0:xworld.hidingOtherPlayers=!1},e.prototype.onBtnFilter=function(){for(var t,e=[],n=0,i=Define.NEARSTR.length;i>n;n++)n!=Define.NEAR_PHOTO&&(t=new MenuActionData(Define.NEARSTR[n],n),e.push(t));PanelManager.openFilterMenuPanel(e,this.selectFilter,this)},e.prototype.selectFilter=function(t){this._selectType=t,this.update()},e.prototype.reset=function(){this._index=0,this.container.reset()},e.prototype.update=function(){if(this.btn_filter.label=Define.NEARSTR[this._selectType],this.init){this.reset();var t=xworld.getTypeModel(this._selectType),e=[];for(var n in t){var i=ObjectPool.getPool("AroundPlayerItem").createObject();nato.attachSkin(i),i.setData(t[n]),e.push(i),this.container.add(i,0)}this.container.update(),this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this),xevent.addEventListener(WorldEvent.AROUND_LOOK_PLAYER_INFO,this.lookPlayerInfo,this)),this._radioBtns.add(e,0,!0,!0),this.showPlayerSprite()}},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurentSelectItem().getData();PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_NEAR_LIST),this.showPlayerSprite(e)},e.prototype.showPlayerSprite=function(t){var e;if(t)e=t;else{if(null==this._radioBtns.getCurentSelectItem())return void(this._playerSprite&&(Tool.removeObjSafe(this._playerSprite.cloakSprite),Tool.removeObjSafe(this._playerSprite)));e=this._radioBtns.getCurentSelectItem().getData()}var n=e.sprite;null==n&&(n=e.createSprite(!1)),(null==this._playerSprite||this._playerSprite.nameID!=n.nameID)&&(this._playerSprite&&Tool.removeObjSafe(this._playerSprite.cloakSprite),Tool.removeObjSafe(this._playerSprite),this._playerSprite=GameSprite.cloneSprite(n),this._playerSprite.setScale(nato.mapRatio)),this._playerSprite&&!this._playerSprite.parent&&(this._con||(this._con=new egret.DisplayObjectContainer,this.addChild(this._con),this._con.touchEnabled=!1,this._con.touchChildren=!1,this._con.x=40*xhdRatio,this._con.y=60*xhdRatio,this._con.scaleX=-1),this._con.addChild(this._playerSprite))},e.prototype.lookPlayerInfo=function(t){this._radioBtns.selectItem(t.param)},e}(ComponentBase);__reflect(AroundPanel.prototype,"AroundPanel");var AroundPlayerItem=function(t){function e(){var e=t.call(this)||this;return e._isUpdate=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_look.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lookPlayerInfo,this),OtherPlayerPanel.menuType=Menu.UI_INTO_NEAR_LIST,this._model&&(this._model.isStatusBit(ModelConst.STATUS_VIP)||this._model.vipLevel>0)?this.icon_vip.source=xitem.getItemIcon(39):this.icon_vip.source=xitem.getItemIcon(50),this._isUpdate||(this._isUpdate=!0,this.update())},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._model&&this._model.removeEventListener(WorldEvent.MODE_SHOP_CHANGE,this.update,this),this.btn_look.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.lookPlayerInfo,this),this._isUpdate=!1,ObjectPool.getPool("AroundPlayerItem").returnObject(this)},e.prototype.lookPlayerInfo=function(t){xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND_LOOK_PLAYER_INFO,this)),ListPlayer.doSeePlayerMsg(this._model),t.stopImmediatePropagation()},e.prototype.setData=function(t){this._model&&t&&this._model.getId()!=t.getId()&&this._model.removeEventListener(WorldEvent.MODE_SHOP_CHANGE,this.update,this),this._model=t,this.update()},e.prototype.getData=function(){return this._model},e.prototype.reset=function(){this._id=0,this._name=null,this._status=null},e.prototype.update=function(){if(this.init){var t="";if(null!=this._model)if(this._model.hasEventListener(WorldEvent.MODE_SHOP_CHANGE)||this._model.addEventListener(WorldEvent.MODE_SHOP_CHANGE,this.update,this),this._model.isStatusBit(ModelConst.STATUS_IS_TEACHER)||this._model.isStatusBit(ModelConst.STATUS_IS_GM),this._model.isHasPhoto(),this._model.isShopMode())t=this._model.shopName;else{var e=this._model.getName();0==Tool.isNullText(this._model.getRemark())&&(e=this._model.getRemark()),t=e,t+="("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._model.getLevel()+"")+Define.getJobString(this._model.getJob())+")"}this.label_name.text=t,this.label_status.text=null!=this._model?this._model.getModelString():""}},e}(ComponentBase);__reflect(AroundPlayerItem.prototype,"AroundPlayerItem");var AroundScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e);var n=!1;for(var i in xworld.otherModels){n=!0;break}if(!n)return this.closePanel(),void AlertPanel.alertNotify(GameText.STR_NEAR_PLAYER,GameText.STR_NEAR_NO_PLAYER);this._tabBtnList=[this.tabBtn_around,this.tabBtn_team];for(var o=0;o<this._tabBtnList.length;o++){this._tabBtnList[o].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}this._tabIndex=0,this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_AROUND?(this.addChild(this.aroundPanel),this.aroundPanel.update()):this._tabIndex==e.TAB_INDEX_TEAM&&this.addChild(this.teamPanel)},e.prototype.removeAllPanel=function(){this.aroundPanel&&this.aroundPanel.parent&&this.aroundPanel.parent.removeChild(this.aroundPanel),this.teamPanel&&this.teamPanel.parent&&this.teamPanel.parent.removeChild(this.teamPanel)},e.TAB_INDEX_AROUND=0,e.TAB_INDEX_TEAM=1,e}(ScenePanelBase);__reflect(AroundScene.prototype,"AroundScene");var AroundTeamItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_duizhang,this.promoteCaptain,this),ButtonUtils.addTouchEvent(this.btn_tiren,this.kickMember,this),ButtonUtils.addTouchEvent(this.btn_xiangxi,this.detailMsg,this),this.group_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this),this.init=!0},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_duizhang),ButtonUtils.removeTouchEvent(this.btn_tiren),ButtonUtils.removeTouchEvent(this.btn_xiangxi),this.group_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this)},e.prototype.promoteCaptain=function(t){ListPlayer.doChangeLeaderMsg(xself,this._model)},e.prototype.kickMember=function(t){ListPlayer.doKickTeamerMsg(xself,this._model)},e.prototype.detailMsg=function(t){ListPlayer.doSeePlayerMsg(this._model)},e.prototype.onSelectItem=function(t){PanelManager.openPlayerMenuPanel(this._model,Menu.UI_INTO_NEAR_LIST)},e.prototype.reset=function(){},e.prototype.setData=function(t){this._model=t,this.update()},e.prototype.getData=function(){return this._model},e.prototype.createMemberShow=function(){var t=null==this._model.sprite?this._model.createSprite(!1):this._model.sprite;this.playerSprite=GameSprite.cloneSprite(t),this.playerSprite.scaleX=this.playerSprite.scaleY=xhd?2:1,this.group_head.addChild(this.playerSprite)},e.prototype.update=function(){this.createMemberShow(),this.lab_lv.text=Tool.manageString(GameText2.MEMBER_LV,this._model.getLevel().toString()),this.lab_pro.text=this._model.getName().toString(),this.lab_duiyuan.text=this._model.isLeader()?GameText2.CAPTAIN:GameText2.MEMBER;var t=xself.isLeader();this.btn_tiren.visible=t,this.btn_duizhang.visible=t},e}(ComponentBase);__reflect(AroundTeamItem.prototype,"AroundTeamItem");var AroundTeamPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),this.bg.touchEnabled=!1,this._itemList=[this.teamItem1,this.teamItem2,this.teamItem3,this.teamItem4];for(var i=0;i<e.teamLen;i++)this._itemList[i].visible=!1;this.update(),ButtonUtils.addTouchEvent(this.btn_jiesan,this.onDissolve,this),xevent.addEventListener(WorldEvent.AROUND__REFRESH_TEAM_INFO,this.onResetTeamList,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_jiesan)},e.prototype.onDissolve=function(t){xself.isLeader()?ListPlayer.doDelTeamMsg(xself):ListPlayer.doLeaveTeamMsg(xself)},e.prototype.reset=function(){this._index=0},e.prototype.onResetTeamList=function(t){this.update()},e.prototype.update=function(){if(this.teamGroup.removeChildren(),this.init){this.reset();for(var t=xworld.getTypeModel(Define.NEAR_MY_TEAM),e=0,n=t.length;n>e;e++)this._itemList[e]=new AroundTeamItem,nato.attachSkin(this._itemList[e]),this._itemList[e].setData(t[e]),this.teamGroup.addChild(this._itemList[e]),this._itemList[e].y=this._itemList[e].height*e;var i=xself.isLeader();this.btn_jiesan.label=i?"解散":"退出组队"}},e.teamLen=4,e}(ComponentBase);__reflect(AroundTeamPanel.prototype,"AroundTeamPanel");var BagDecomposeView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(BagDecomposeView.prototype,"BagDecomposeView");var BagEnchantView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(BagEnchantView.prototype,"BagEnchantView");var BagEquipItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.vipLevel=0,e.touchChildren=!1,e.cacheAsBitmap=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.updateBg(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"posType",{get:function(){return this._posType},set:function(t){this._posType=t,this.updateBg()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.source=this.getSelectSource())},enumerable:!0,configurable:!0}),e.prototype.getSelectSource=function(){return this._select?"bag_common_grid_select"+(xhd?"_hd":"_sd"):null},e.prototype.updateBg=function(){if(this.type_img&&this.circleBg){var t=xhd?"_hd":"_sd";this.circleBg.alpha=1,this._posType==PlayerBag.ARMOR_NECKLACE_POS?this.type_img.source="bag_lian"+t:this._posType==PlayerBag.PET_POS?this.type_img.source="bag_chong"+t:this._posType==PlayerBag.ARMOR_RING_LEFT_POS||this._posType==PlayerBag.ARMOR_RING_RIGHT_POS?this.type_img.source="bag_jie"+t:this._posType==PlayerBag.ARMOR_FASHION_POS?this.type_img.source="bag_shi"+t:this._posType==PlayerBag.ARMOR_BACK_POS||this._posType==PlayerBag.ARMOR_CLOTHES_POS||this._posType==PlayerBag.ARMOR_HAND_POS||this._posType==PlayerBag.ARMOR_HEAD_POS||this._posType==PlayerBag.ARMOR_SHOES_POS||this._posType==PlayerBag.ARMOR_WAIST_POS||this._posType==PlayerBag.ARMOR_TROUSERS_POS||this._posType==PlayerBag.ARMOR_SHOULDER_POS?(this.type_img.visible=!1,this.circleBg.alpha=0):this._posType==PlayerBag.WEAPON_LEFT_POS||this._posType==PlayerBag.WEAPON_RIGHT_POS?this.type_img.source="bag_wu"+t:this._posType==PlayerBag.ARMOR_AMULET_POS?this.type_img.source="bag_fu"+t:this._posType==PlayerBag.ARMOR_TRANSPORT_POS?this.type_img.source="bag_qi"+t:this._posType==PlayerBag.SPIRIT_POS&&(this.type_img.visible=!1,this.circleBg.source="bag_vipGrid"+t)}},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this.parent&&this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){return this._itemData?(this.img_select.source=this.getSelectSource(),this.itemColor_bg.source=xitem.getItemColorTexture2(this._itemData.grade),this._posType==PlayerBag.SPIRIT_POS&&this.vipLevel<=0?this.icon_img.source=xitem.getItemIcon(50):this.icon_img.source=xitem.getItemIcon(this._itemData.bagIcon),void this.updateStarIcon()):void this.resetView()},e.prototype.reset=function(){this._itemData=null,this.resetView()},e.prototype.resetView=function(){this.icon_img.source="",this.itemColor_bg.source="",this.select=!1,this.clearStarIcon()},e.prototype.clearStarIcon=function(){if(this._starIconList&&this._starIconList.length>0)for(var t=0;t<this._starIconList.length;t++){var e=this._starIconList[t];e.parent&&e.parent.removeChild(e),ItemStarIcon.returnIcon(e)}this._starIconList=null},e.prototype.updateStarIcon=function(){this.clearStarIcon(),GameWorld.isShowStarAndGem&&null!=this._itemData&&(this._starIconList=[],this._itemData.ascensionStar>0&&this._itemData.star>0&&this._starIconList.push(ItemStarIcon.getIcon(ItemStarIcon.Type_Star,this._itemData.star)),this._itemData.attachDone>0&&this._starIconList.push(ItemStarIcon.getIcon(ItemStarIcon.Type_Gem,this._itemData.attachDone)),1==this._starIconList.length?(this._starIconList[0].x=16*xhdRatio,this._starIconList[0].y=33*xhdRatio,this.addChild(this._starIconList[0])):2==this._starIconList.length&&(this._starIconList[0].x=23*xhdRatio,this._starIconList[0].y=33*xhdRatio,this._starIconList[1].x=8*xhdRatio,this._starIconList[1].y=33*xhdRatio,this.addChild(this._starIconList[0]),this.addChild(this._starIconList[1])))},e}(ComponentBase);__reflect(BagEquipItem.prototype,"BagEquipItem");var BagRoleEquipView=function(t){function e(){var e=t.call(this)||this;return e._isInit=!1,e._bagEquipList=[],e.isUpdate=!1,e.action_back=1,e.action_equip=2,e.action_itemGet=3,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initEquipPart();for(var n=0;n<this._bagEquipList.length;n++){this._bagEquipList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipTouch,this)}this.isUpdate||this.update(this._player),xevent.addEventListener(WorldEvent.BAG_SHOW_CHECK_STAR,this.onBagShowCheckStar,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._bagEquipList.length;n++){this._bagEquipList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipTouch,this)}Tool.removeObjSafe(this.vipLevel),this.vipLevel=null,xevent.removeEventListener(WorldEvent.BAG_SHOW_CHECK_STAR,this.onBagShowCheckStar,this),this.isUpdate=!1},e.prototype.onBagShowCheckStar=function(t){this.updateItemStarIcon()},e.prototype.initEquipPart=function(){this._isInit||(this._isInit=!0,this.equip0.posType=PlayerBag.ARMOR_NECKLACE_POS,this.equip1.posType=PlayerBag.PET_POS,this.equip2.posType=PlayerBag.ARMOR_RING_LEFT_POS,this.equip3.posType=PlayerBag.ARMOR_FASHION_POS,this.equip4.posType=PlayerBag.ARMOR_AMULET_POS,this.equip5.posType=PlayerBag.ARMOR_TRANSPORT_POS,this.equip6.posType=PlayerBag.ARMOR_RING_RIGHT_POS,this.equip7.posType=PlayerBag.SPIRIT_POS,this.equip8.posType=PlayerBag.WEAPON_LEFT_POS,this.equip9.posType=PlayerBag.WEAPON_RIGHT_POS,this.equip10.posType=PlayerBag.ARMOR_HEAD_POS,this.equip11.posType=PlayerBag.ARMOR_BACK_POS,this.equip12.posType=PlayerBag.ARMOR_CLOTHES_POS,this.equip13.posType=PlayerBag.ARMOR_HAND_POS,this.equip14.posType=PlayerBag.ARMOR_SHOES_POS,this.equip15.posType=PlayerBag.ARMOR_WAIST_POS,this.equip16.posType=PlayerBag.ARMOR_TROUSERS_POS,this.equip17.posType=PlayerBag.ARMOR_SHOULDER_POS,this._bagEquipList=[this.equip0,this.equip1,this.equip2,this.equip3,this.equip11,this.equip12,this.equip13,this.equip10,this.equip8,this.equip14,this.equip9,this.equip15,this.equip16,this.equip17,this.equip4,this.equip5,this.equip6,this.equip7])},e.prototype.onSelectEquip=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelect.select=!0)},e.prototype.onEquipTouch=function(t){var e=t.target;if(e)if(this.onSelectEquip(e),e.itemData)if(e.posType!=PlayerBag.PET_POS||this._player.isStatusBit(ModelConst.STATUS_SELL)){var n=this;e.itemData.getItemSetID()>0&&""==e.itemData.getItemSetDesc(this._player)?(GameWorld.doGetItemSuit([e.itemData],(function(){PanelManager.closeWaitForServer(),PanelManager.openItemView(e.itemData,2,n._player)}),this),PanelManager.openWaitForServer()):PanelManager.openItemView(e.itemData,2,n._player)}else if(xself.getId()==this._player.getId())PanelManager.openPetDetailScene();else{var i=new MyPet(null);i.petItem=e.itemData;MyPet.doPetInfoMsg(i,MsgHandler.PET_INFO_SEE_PLAYER,[this._player.getId()],(function(){PanelManager.openPetDetailScene(i,PetDetailScene.FromType_other)}),this)}else if(xself.getId()==this._player.getId()){var o,a=[];if(e.posType!=PlayerBag.SPIRIT_POS){var r=ItemGet.getItemGetDataByEquipPos(e.posType);if(r){var s=ItemGet.getNameByEquipPos(e.posType)+"获取途径";o=new MenuActionData(s,this.action_itemGet,r),a.push(o)}}var l=ItemManager.getCanEquipListByPos(e.posType);if(l&&l.length>0)for(var _=0;_<l.length;_++){var h=l[_];o=new MenuActionData(h.getNameInfo(),this.action_equip,h),a.push(o)}PanelManager.openFilterMenuPanel(a,this.onMenuSelect,this)}},e.prototype.onMenuSelect=function(t,e){void 0===e&&(e=null),t==this.action_equip?null!=e&&ItemManager.doEquipAction(xself,e):t==this.action_itemGet&&null!=e&&PanelManager.openItemGetPanel(e)},e.prototype.update=function(t){if(void 0===t&&(t=null),null==t?(n=xself.bag,this._player=xself):(n=t.bag,this._player=t),this.init){if(this.isUpdate=!0,null!=this._player&&null!=this._player.bag&&null!=this._player.bag.store&&0!=this._player.bag.store.length){var e=this._player.getVipLevel();null==this.vipLevel&&(this.vipLevel=ImageNum.create(2008),this.vipLevel.scaleX=this.vipLevel.scaleY=.35*xhdRatio,this.group_vip.addChild(this.vipLevel)),this.vipLevel.num=e;for(var n=this._player.bag,i=0;i<this._bagEquipList.length;i++){var o=this._bagEquipList[i];o.vipLevel=this._player.vipLevel;var a=n.store[o.posType];o.itemData=a}var r=this._player.sprite;null==r&&(r=this._player.createSprite(!1)),this.roleCtn.removeChildren(),this._playerSprite=GameSprite.cloneSprite(r),this._playerSprite.setScale(xhd?1.5:1),this.roleCtn.addChild(this._playerSprite)}}else this.isUpdate=!1},e.prototype.updateItemStarIcon=function(){for(var t=0;t<this._bagEquipList.length;t++){this._bagEquipList[t].updateStarIcon()}},e}(ComponentBase);__reflect(BagRoleEquipView.prototype,"BagRoleEquipView");var BagScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.tabPanelList=[this.roleEquipView,this.sellView],this.bagView.isCheckNew=!0,this.bagView.isCheckStronger=xself.getId()==this._player.getId()&&xself.getLevel()<45,this.bagView.isInBagScene=!0,this.bagView.setData(this._player),this.updatePanel(),1==GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_BAG_PARTNER_SELECT)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_BAG_PARTNER_SELECT),GameWorld.setGuide(GameWorld.GUIDE_BAG_PET_PARTNER_SELECT)),xworld.addBagEquipChange(),xworld.checkBagEquipChange(),xself.getId()==this._player.getId()&&nato.WorldTicker.instance.register(this.onUpdate,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.SELL_VIEW_UPDATE,this.updateUI,this),xevent.removeEventListener(WorldEvent.ITEM_SELL_END,this.updateUI,this),xevent.removeEventListener(WorldEvent.SELL_TYPE_CHANGE,this.onSellTypeChange,this),this._player&&this._player.bag&&this._player.bag.clearNewItemList(),nato.WorldTicker.instance.unregister(this.onUpdate,this)},e.prototype.setData=function(t){this._player=t,this._player.isStatusBit(ModelConst.STATUS_SELL)?this.tabBtn_1.visible=!1:this.tabBtn_1.visible=!0},e.prototype.onUpdate=function(t){this.bagView.updateLeftTime()},e.prototype.closePanel=function(){if(!this._player.isShopMode()){if(null!=ShopItem.shopList){for(var e=this._player;ShopItem.shopList.length;)if(null!=e&&null!=e.bag){var n=e.bag.getItem(ShopItem.shopList.pop().slotPos);null!=n&&n.setSelling(!1)}ShopItem.shopList=null}this.sellView.currSelectType=0}this.bagView.clearSelected(),t.prototype.closePanel.call(this)},e.prototype.onBtnTidy=function(){ItemManager.doBagRefresh()},e.prototype.onItemSelect=function(){var t=this.bagView.selectItem;t&&t.itemData&&(t.itemData.getItemSetID()>0&&""==t.itemData.getItemSetDesc(this._player)?(GameWorld.doGetItemSuit([t.itemData],(function(){PanelManager.closeWaitForServer(),PanelManager.openItemView(t.itemData,this.getBagFrom(t.itemData),this._player)}),this),PanelManager.openWaitForServer()):PanelManager.openItemView(t.itemData,this.getBagFrom(t.itemData),this._player))},e.prototype.getBagFrom=function(t){return t.isNotOperate()?0:this.getCurrentPanel()==this.sellView?this._player.isShopMode()?0:6:1},e.prototype.updatePanel=function(){this.updateTab(),this.bagView.update()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel();var t=this.getCurrentPanel();t&&(this.addChild(t),t==this.sellView?(this.sellView.update(),xevent.addEventListener(WorldEvent.SELL_VIEW_UPDATE,this.updateUI,this),xevent.addEventListener(WorldEvent.ITEM_SELL_END,this.updateUI,this),xevent.addEventListener(WorldEvent.SELL_TYPE_CHANGE,this.onSellTypeChange,this),this.bagView.clearAction(),this.bagView.setAction(GameText.getText(GameText.TI_PLAYER_SHOP_RECORD),this.onSellRecord,this.onItemSelect,this),0==this.sellView.currSelectType?this.bagView.sortType(BagView.SORT_TYPE_ALL,0,-1):this.bagView.sortType("power1",Define.POWER_ENCHANT_ITEM,-1)):(this.roleEquipView.update(this._player),xevent.removeEventListener(WorldEvent.SELL_VIEW_UPDATE,this.updateUI,this),xevent.removeEventListener(WorldEvent.ITEM_SELL_END,this.updateUI,this),xevent.removeEventListener(WorldEvent.SELL_TYPE_CHANGE,this.onSellTypeChange,this),this.bagView.clearAction(),this._player.isStatusBit(ModelConst.STATUS_SELL)?this.bagView.setAction("",null,this.onItemSelect,this):(this.bagView.setAction(GameText.getText(GameText.TI_EQUIP_REFRESH),this.onBtnTidy,this.onItemSelect,this),this.bagView.setAction2("出售",this.onAutoSell,this)),this.bagView.currentViewList=null))},e.prototype.updateUI=function(){this.bagView.update(),this.sellView.update()},e.prototype.onSellRecord=function(){SellHandler.doStallRecord()},e.prototype.onSellTypeChange=function(t){t.param==Define.PLAYER_SHOP_TYPE_NORMAL?this.bagView.sortType(BagView.SORT_TYPE_ALL):this.bagView.sortType("power1",Define.POWER_ENCHANT_ITEM)},e.prototype.onAutoSell=function(){AutoSell.openAutoSell()},e}(TabPanelBase);__reflect(BagScene.prototype,"BagScene");var BagSellView=function(t){function e(){var e=t.call(this)||this;return e._currSelectType=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"currSelectType",{get:function(){return this._currSelectType},set:function(t){this._currSelectType=t},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_currEnChat_title.text=GameText.STR_TYPE_PLAYER_SHOP_CURR_ENCHAT,this.label_needEnChat_title.text=GameText.STR_TYPE_PLAYER_SHOP_NEED_ENCHAT,this.label_currEnChat.text="0",this.label_needEnChat.text="0",this.setEnchatInfoGroup();var n=[];n.push({value:Define.PLAYER_SHOP_TYPE_NORMAL,label:GameText2.STR_COMMON_SELL}),n.push({value:Define.PLAYER_SHOP_TYPE_ENCHANT,label:GameText2.STR_ENCHANT_SELL}),this.sell_type_comboBox.data=n,this.sell_type_comboBox.select=this._currSelectType,this.sell_type_comboBox.addEventListener(egret.Event.CHANGE,this.changeSellType,this),this.setBtnSellText(),ButtonUtils.addTouchEvent(this.btn_sell,this.onBtnSell,this),xevent.addEventListener(WorldEvent.ITEM_SELL_START_SUCCESS,this.sellSuccess,this),xevent.addEventListener(WorldEvent.BAG_SHOW_CHECK_STAR,this.onBagShowCheckStar,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.sell_type_comboBox.removeEventListener(egret.Event.CHANGE,this.changeSellType,this),ButtonUtils.removeTouchEvent(this.btn_sell),xevent.removeEventListener(WorldEvent.ITEM_SELL_START_SUCCESS,this.sellSuccess,this),xevent.removeEventListener(WorldEvent.BAG_SHOW_CHECK_STAR,this.onBagShowCheckStar,this);for(var n=0;this["item"+n];)this["item"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sellItemOnTouch,this),this["item"+n].itemData=null,n++},e.prototype.onBagShowCheckStar=function(t){},e.prototype.setEnchatInfoGroup=function(){this.isEnchat()?this.addChild(this.group_enchat_info):Tool.removeObjSafe(this.group_enchat_info)},e.prototype.setBtnSellText=function(){xself.isShopMode()?this.btn_sell.label=GameText.getText(GameText.TI_SHOP_END):this.btn_sell.label=GameText.getText(GameText.TI_SHOP_START)},e.prototype.reset=function(){},e.prototype.update=function(){if(this.init){for(var t=0,e=ShopItem.shopList,n=0;this["item"+n];)e&&e[n]?(this["item"+n].itemData=e[n],this["item"+n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.sellItemOnTouch,this),this._currSelectType==Define.PLAYER_SHOP_TYPE_ENCHANT&&(t+=e[n].powerValue1*e[n].quantity)):(this["item"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sellItemOnTouch,this),this["item"+n].itemData=null),n++;this.label_needEnChat.text=t+"",this.label_currEnChat.text=xself.getEnchantValue()+"",this.setBtnSellText()}},e.prototype.sellItemOnTouch=function(t){var e,n=t.currentTarget;n&&n.itemData&&(this._currSelectItem&&(this._currSelectItem.select=!1),this._currSelectItem=n,this._currSelectItem.select=!0,e=xself.isShopMode()?0:7,PanelManager.openItemView(n.itemData,e,xself))},e.prototype.onBtnSell=function(){return!ShopItem.shopList||ShopItem.shopList.length<=0?void AlertPanel.alertTips(GameText.getText(GameText.TI_SHOP_START),GameText.STR_START_SHOP_NO_ITEM):void(xself.isShopMode()?SellHandler.doSellEnd():CommonFormPanel.sellName(Tool.manageString(GameText.STR_STALL_PLACE,xself.getName()),this,this.inputNameCallBack))},e.prototype.inputNameCallBack=function(t){Tool.isNullText(t[0])?AlertPanel.alertCommon(GameText.STR_TYPE_PLAYER_SHOP_NAME_NULL):SellHandler.doPlayerShopStartMsg(t[0],xself,this.isEnchat())},e.prototype.sellSuccess=function(){this.setBtnSellText()},e.prototype.changeSellType=function(t){xself.isShopMode()?(this.isEnchat()?this.sell_type_comboBox.select=Define.PLAYER_SHOP_TYPE_ENCHANT:this.sell_type_comboBox.select=Define.PLAYER_SHOP_TYPE_NORMAL,AlertPanel.alertCommon(GameText2.STR_CHANGE_SELL_FAIL)):ShopItem.shopList&&ShopItem.shopList.length>0?AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText2.STR_CHANGE_SELL_ASK,this.confirmChangeType,this):this.confirmChangeType()},e.prototype.confirmChangeType=function(){if(ShopItem.shopList&&ShopItem.shopList.length>0){for(var t=xself,e=0,n=ShopItem.shopList.length;n>e;e++)if(null!=t&&null!=t.bag){var i=t.bag.getItem(ShopItem.shopList[e].slotPos);null!=i&&i.setSelling(!1)}ShopItem.shopList=null,this.update()}this.currSelectType=this.sell_type_comboBox.selectData.value,this.setEnchatInfoGroup(),xevent.dispatchEvent(new WorldEvent(WorldEvent.SELL_TYPE_CHANGE,this.sell_type_comboBox.selectData.value))},e.prototype.isEnchat=function(){return this.currSelectType!=Define.PLAYER_SHOP_TYPE_NORMAL},e}(ComponentBase);__reflect(BagSellView.prototype,"BagSellView");var BagView=function(t){function e(){var e=t.call(this)||this;return e._selectedSlotList=null,e._curPage=1,e._maxCount=100,e._isCheckNew=!1,e._isCheckStronger=!1,e._isInBagScene=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._itemList){this._itemList=new Array;for(var n=0;this["item"+n];)this._itemList.push(this["item"+n]),n++}for(n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.btn_action,this.onBtnAction,this),ButtonUtils.addTouchEvent(this.btn_action2,this.onBtnAction2,this),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.group_time.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTimeTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.btn_action),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.group_time.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTimeTouch,this),this.clearAction(),GameWorld.isShowStarAndGem=!1},e.prototype.clearSelected=function(){this._curPage=1,this._curSelectItem&&(this._curSelectItem.select=!1,this._curSelectItem=null),this._curSelectItemData=null},e.prototype.onTurnPage=function(){this._curPage=this.turnPage.currentPage,this.update()},e.prototype.onGroupTimeTouch=function(t){var e=Math.floor(Tool.currentTime/1e3);xself.bag.nextTime>0&&e>xself.bag.nextTime?xself.bag.expandPackageByTime():xself.bag.expandPackageByMoney(xself.bag.bagEnd+1)},e.prototype.onItemTouch=function(t){var e=t.target;if(e)if(e.itemData)this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=e,this._curSelectItemData=e.itemData,this._curSelectItem.select=!0,null!=this._itemSelectCallbackFunc&&this._itemSelectCallbackFunc.call(this._thisObj);else if(e.isLock&&this._isInBagScene&&this._player.getId()==xself.getId()){var n=this._itemList.indexOf(e);if(-1!=n){var i=(this._curPage-1)*this._itemList.length+n+PlayerBag.BAG_START;xself.bag.expandPackageByMoney(i)}}},e.prototype.onBtnAction=function(){null!=this._actionCallbackFunc&&null!=this._thisObj&&this._actionCallbackFunc.call(this._thisObj)},e.prototype.onBtnAction2=function(){null!=this._actionCallbackFunc2&&null!=this._thisObj2&&this._actionCallbackFunc2.call(this._thisObj2)},e.prototype.setData=function(t,e){void 0===e&&(e=null),this._player=t,this._selectedSlotList=e,this.update()},Object.defineProperty(e.prototype,"currentViewList",{set:function(t){this._currentViewList=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.setAction=function(t,e,n,i){this._btnName=t,this._actionCallbackFunc=e,this._itemSelectCallbackFunc=n,this._thisObj=i},e.prototype.setAction2=function(t,e,n){this._btnName2=t,this._actionCallbackFunc2=e,this._thisObj2=n},e.prototype.clearAction=function(){this._actionCallbackFunc=null,this._itemSelectCallbackFunc=null,this._thisObj=null,this._btnName=null,this._actionCallbackFunc2=null,this._thisObj2=null,this._btnName2=null},Object.defineProperty(e.prototype,"selectItem",{get:function(){return this._curSelectItem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCheckNew",{get:function(){return this._isCheckNew},set:function(t){this._isCheckNew=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCheckStronger",{get:function(){return this._isCheckStronger},set:function(t){this._isCheckStronger=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInBagScene",{get:function(){return this._isInBagScene},set:function(t){this._isInBagScene=t},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t=0;t<this._itemList.length;t++){this._itemList[t].reset()}},e.prototype.updatePage=function(){this.turnPage.isAlertOver=!1,this._maxCount=PlayerBag.BAG_NUM*PlayerBag.EACH_BAG_SIZE+this._player.bag.countOfVipOpen;var t=Math.ceil(this._maxCount/this._itemList.length);this.turnPage.setPage(this._curPage,t)},e.prototype.update=function(){if(this.init){if(null==this._player||null==this._player.bag||null==this._player.bag.store)return void this.reset();this.moneyView.setData(this._player),this.moneyView.update(),this.updatePage(),this._player.isStatusBit(ModelConst.STATUS_SELL)?(this.btn_action.visible=!1,this.btn_action2.visible=!1):(this.btn_action.visible=!0,this.btn_action2.visible=!0),0==Tool.isNullText(this._btnName)?(this.btn_action.visible=!0,this.btn_action.label=this._btnName):this.btn_action.visible=!1,0==Tool.isNullText(this._btnName2)?(this.btn_action2.visible=!0,this.btn_action2.label=this._btnName2):this.btn_action2.visible=!1;var t=0;null==this._currentViewList&&(this._currentViewList=this._player.bag.store),this._currentViewList==this._player.bag.store&&(t=PlayerBag.BAG_START);for(var e=this._player.bag,n=this._maxCount,i=this._itemList.length*(this._curPage-1),o=(this._itemList.length,this._player.bag.bagEnd-PlayerBag.BAG_START+1),a=0;a<this._itemList.length;a++){var r=this._itemList[a];if(a+i>=n)r.visible=!1;else if(a+i>=o)r.visible=!0,r.itemData=null,r.isLock=!0;else{r.visible=!0,r.isLock=!1;var s=this._currentViewList[i+t+a];r.itemData=s;var l=!1;null!=this._selectedSlotList&&this._selectedSlotList.length>0&&s&&-1!=this._selectedSlotList.indexOf(s.slotPos)&&(l=!0),s&&s.isNotOperate()?r.isMask=!0:r.isMask=!!l,this._curSelectItemData&&this._curSelectItemData==s?r.select=!0:r.select=!1,this._isCheckNew&&e.checkIsNewItem(s)?r.isNew=!0:r.isNew=!1,this._isCheckStronger&&e.checkIsStrongerItem(s)?r.isStronger=!0:r.isStronger=!1}}this.updateOpenGridStatus()}},e.prototype.updateOpenGridStatus=function(){if(this._isInBagScene&&xself.getId()==this._player.getId()&&xself.bag.nextTime>0&&xself.bag.bagEnd<xself.bag.bagEnd_maxIndex){var t=(this._curPage-1)*this._itemList.length+PlayerBag.BAG_START,e=this._curPage*this._itemList.length+PlayerBag.BAG_START,n=xself.bag.bagEnd+1;if(e>n&&n>=t){var i=n-t,o=this._itemList[i];o&&(this.group_items.addChild(this.group_time),this.group_time.x=o.x,this.group_time.y=o.y)}else this.group_time.parent&&this.group_time.parent.removeChild(this.group_time)}else this.group_time.parent&&this.group_time.parent.removeChild(this.group_time)},e.prototype.updateLeftTime=function(){if(this._isInBagScene&&this.group_time.parent&&xself.bag.nextTime>0){var t=Math.floor(Tool.currentTime/1e3);if(t>=xself.bag.nextTime)65280!=this.label_time.textColor&&(this.label_time.textColor=65280,this.label_time.size=12*xhdRatio,this.label_time.text="解锁");else{16763904!=this.label_time.textColor&&(this.label_time.textColor=16763904);var e=!1,n="",i=xself.bag.nextTime-t;if(i>0){var o=Math.floor(i/3600),a=Math.floor(i%3600/60),r=i%60;o>0&&(e=!0,n+=10>o?"0"+o:o,n+=":"),n+=10>a?"0"+a:""+a,n+=":",n+=10>r?"0"+r:""+r}this.label_time.size=e?9*xhdRatio:12*xhdRatio,this.label_time.text=n}}},e.prototype.sortType=function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=-1),this._player&&this._player.bag&&(i>=0&&(this._curPage=i),t==e.SORT_TYPE_ALL?this.currentViewList=null:this.currentViewList=this._player.bag.getItemListByType(n,t))},e.SORT_TYPE_ALL="all",e}(ComponentBase);__reflect(BagView.prototype,"BagView");var EquipChangePanel=function(t){function e(){var e=t.call(this)||this;return e.counter=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose),this.label_change.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),this.label_change.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.visible=!1},e.prototype.onClose=function(){xworld.isEquipChangePanelShow=!1,PanelManager.mainMenu.equipChangePanel.visible=!1,this._startTime=0,xworld.equipChangeList.shift(),GameWorld.guideType==GameWorld.GUIDE_AUTO_EQUIP_CHANGE&&GameWorld.cleanGuide(),xworld.checkEquipChange()},e.prototype.onChange=function(){ItemManager.doEquipAction(xself,this._item),this.onClose()},e.prototype.timeFly=function(t){0!=this.visible&&(this.counter+=1,this.counter%100==0&&(this.counter=0,egret.getTimer()-this._startTime>1e4&&this.onClose()))},e.prototype.setData=function(t){PanelManager.mainMenu.equipChangePanel.visible=!0,xworld.isEquipChangePanelShow=!0,this._item=t,this.update()},e.prototype.update=function(){0!=this.init&&(this._startTime=egret.getTimer(),this.itemIcon.setData(this._item.bagIcon,this._item.grade),this.label_name.textColor=ColorUtils.getGradeColor(this._item.grade),this.label_name.text=this._item.name,GameWorld.setGuide(GameWorld.GUIDE_AUTO_EQUIP_CHANGE,null,GameWorld.NAN_FORCE_GUIDE_TYPE))},e}(ComponentBase);__reflect(EquipChangePanel.prototype,"EquipChangePanel");var SellHandler=function(){function t(){}return t.upItem=function(e){if(0!=SafeLock.doSafeLockVerify()){if(null!=e){var n=xself;if(null!=n){if(GameWorld.isEscortStatus())return void AlertPanel.alertCommon(GameText.STR_ESCORT_NO_SHOP);if(e.isBinded())return void AlertPanel.alertCommon(GameText.STR_BINDING_NO_SHOP);if(null!=ShopItem.shopList&&ShopItem.shopList.length>=t.sellCountMax)return void AlertPanel.alertCommon(GameText.STR_STALL_UPITEM_FULL);var i=0!=PanelManager.bagScene.sellView.currSelectType;PanelManager.closeItemView(),CommonFormPanel.sellForm(e.price>0?e.price:1,t.money1Max,t.money3Max,e.quantity,i,e.powerValue1,this,(function(t,o,a){for(var r=0,s=t.length;s>r;r++)if(Tool.isNullText(t[r])||0==parseInt(t[r]))return;var l=a,_=parseInt(t[0]),h=t.length>1?parseInt(t[1]):1;if(h>e.quantity&&(h=e.quantity),i){var u=1;h>u&&(u=h);var c=0;if(null!=ShopItem.shopList)for(r=0,s=ShopItem.shopList.length;s>r;r++){var T=ShopItem.shopList[r];if(null!=T){var p=1;p<T.quantity&&(p=T.quantity),c=p*T.powerValue1}}if(n.getEnchantValue()<u*e.powerValue1+c)return void AlertPanel.alertCommon(GameText2.STR_ENCHANT_SELL_UP_FAIL)}null==ShopItem.shopList&&(ShopItem.shopList=[]);var d=new ShopItem;e.setItemDataTo(d),e.setVarItemDataTo(d),d.quantity=h,l==ModelConst.MONEY1?d.money1=_:l==ModelConst.MONEY3&&(d.money3=_),ShopItem.shopList.push(d),e.setSelling(!0),xevent.dispatchEvent(new WorldEvent(WorldEvent.SELL_VIEW_UPDATE))}))}}}else PanelManager.closeItemView()},t.doStallDownItem=function(t){if(null!=t){if(null!=ShopItem.shopList){var e=ShopItem.shopList.indexOf(t);e>=0&&ShopItem.shopList.splice(e,1)}var n=xself;if(null!=n&&null!=n.bag){var i=n.bag.getItem(t.slotPos);null!=i&&i.setSelling(!1)}PanelManager.closeItemView(),xevent.dispatchEvent(new WorldEvent(WorldEvent.SELL_VIEW_UPDATE))}},t.doStallChangePrice=function(e){if(null==e)return!1;if(e instanceof ShopItem){CommonFormPanel.sellPriceForm(e.money1>0?0:1,e.money1>0?e.money1:e.money3,t.money1Max,t.money3Max,this,(function(t,n,i){if(!Tool.isNullText(t[0])&&parseInt(t[0])>0)switch(e.money1=0,e.money2=0,e.money3=0,i){case ModelConst.MONEY1:e.money1=parseInt(t[0]);break;case ModelConst.MONEY2:e.money2=parseInt(t[0]);break;case ModelConst.MONEY3:e.money3=parseInt(t[0])}}))}},t.doPlayerShopStartMsg=function(t,e,n){var i=ShopItem.shopList;if(null==i||i.length<=0)return!1;if(null==e)return!1;var o=e.bag;if(null==o)return!1;var a;if(null==(a=n?MsgHandler.createPlayerEnchantShopStartMsg(t,i):MsgHandler.createPlayerShopStartMsg(t,i)))return!1;return nato.Network.sendCmd(a,(function(a){if(0>a.getByte())AlertPanel.errorMessage(a.getString());else{e.setShopMode(!0),e.shopName=t;for(var r=0;r<i.length;r++){var s=i[r];if(null!=s){var l=o.getItem(s.slotPos);null!=l&&l.setShopLocked(!0)}}n?(e.setShoptype(Define.PLAYER_SHOP_TYPE_ENCHANT),AlertPanel.alertCommon(GameText2.STR_ENCHANT_START_SUCCESS)):(e.setShoptype(Define.PLAYER_SHOP_TYPE_NORMAL),AlertPanel.alertNotify(GameText.getText(GameText.TI_SHOP_START),GameText.STR_SHOP_ITEM_SHOP_INFO)),xevent.dispatchEvent(new WorldEvent(WorldEvent.ITEM_SELL_START_SUCCESS))}}),this),!0},t.doSellEnd=function(){var t=null,e=xself;Define.PLAYER_SHOP_TYPE_NORMAL==e.getShoptype()?t=MsgHandler.createPlayerShopEndMsg():Define.PLAYER_SHOP_TYPE_ENCHANT==e.getShoptype()&&(t=MsgHandler.createPlayerEnchantShopEndMsg()),nato.Network.sendCmd(t)},t.processPlayerShopEndMsg=function(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var n=xself;if(null!=n){n.setMoneyByType(ModelConst.MONEY1,e.getInt()),n.setMoneyByType(ModelConst.MONEY3,e.getInt());var i=new StringBuffer,o=t.showPlayerShopRecordMsg(e);1==Tool.isNullText(o)?i.append(GameText.STR_PLAYER_SHOP_SELL_NULL):i.append(o),n.setShopMode(!1),PlayerBag.clearBagAllItemStatus(n,PlayerBag.CLEAR_BAG_SHOP_LOCKED),PlayerBag.clearBagAllItemStatus(n,PlayerBag.CLEAR_BAG_SELLING_STATUS),ShopItem.shopList=null,AlertPanel.alertNotify(GameText.STR_PLAYER_SHOP_OVER,i.toString()),xevent.dispatchEvent(new WorldEvent(WorldEvent.ITEM_SELL_END))}}},t.processPlayerEnchantShopEndMsg=function(e){if(0>e.getByte())AlertPanel.alertCommon(e.getString());else{var n=xself;if(null!=n){n.setMoneyByType(ModelConst.MONEY1,e.getInt()),n.setMoneyByType(ModelConst.MONEY3,e.getInt());var i=new StringBuffer,o=t.showPlayerShopRecordMsg(e),a=e.getInt();1==Tool.isNullText(o)?i.append(GameText.STR_PLAYER_SHOP_SELL_NULL):i.append(o),a>0&&i.append(Tool.manageString(GameText2.STR_ENCHANT_SHOP_USE_ENCNANT,a+"")),n.setShopMode(!1),PlayerBag.clearBagAllItemStatus(n,PlayerBag.CLEAR_BAG_SHOP_LOCKED),PlayerBag.clearBagAllItemStatus(n,PlayerBag.CLEAR_BAG_SELLING_STATUS),ShopItem.shopList=null,AlertPanel.alertNotify(GameText.STR_PLAYER_SHOP_OVER,i.toString()),xevent.dispatchEvent(new WorldEvent(WorldEvent.ITEM_SELL_END))}}},t.processPlayerShopNotifyMsg=function(t){var e=t.getShort(),n=t.getInt(),i=t.getByte(),o=t.getInt(),a=t.getInt(),r=t.getBoolean(),s=0;r&&(s=t.getInt());var l=xself;if(null!=l){var _=l.bag;if(null!=_){var h=_.getItem(e);if(null!=h&&h.id!=n)return void WorldMessage.addSystemChat("[ERROR] 物品ID不相同,客户端ID="+h.id+" 服务器ID="+n);_.removeBagItemByPos(e,i)!=Define.SUCCESS&&WorldMessage.addSystemChat("[ERROR] 删除摊位物品失败!!!!!!!!!"),0==ShopItem.removeShopListItem(ShopItem.shopList,e,i)&&WorldMessage.addSystemChat("[ERROR] 删除缓冲摊位数据失败!!!!!!!!!"),l.addValue(ModelConst.MONEY1,o),l.addValue(ModelConst.MONEY3,a),r&&l.setEnchantValue(l.getEnchantValue()-s),WorldMessage.addSystemChat(GameText.STR_PLAYER_SHOP_REPLACE)}}},t.showPlayerShopRecordMsg=function(e){t.stallRecordAlert&&t.stallRecordAlert.closePanel();for(var n=e.getShort(),i=new StringBuffer,o=0,a=0,r=0;n>r;r++){var s=e.getString(),l=e.getByte(),_=e.getInt();o+=_;var h=e.getInt();a+=h;var u=e.getString(),c=e.getString();i.append(Tool.manageStringList(GameText.STR_PLAYER_SHOP_COST,[u+"",c,(_>0?PowerString.makeColorString(GameText.STR_MONEY1+_,ColorUtils.COLOR_YELLOW):"")+(h>0?PowerString.makeColorString(GameText.STR_MONEY3+h,ColorUtils.COLOR_MONEY3):""),s+" x "+l]))}return(o>0||a>0)&&i.append(Tool.manageString(GameText.STR_PLAYER_SHOP_ALL,(o>0?PowerString.makeColorString(GameText.STR_MONEY1+o,ColorUtils.COLOR_YELLOW)+" ":"")+(a>0?PowerString.makeColorString(GameText.STR_MONEY3+a,ColorUtils.COLOR_MONEY3)+" ":""))),i.toString()},t.doPlayerShopListMsg=function(e){if(null==e)return!1;var n=null;if(Define.PLAYER_SHOP_TYPE_NORMAL==e.getShoptype()?n=MsgHandler.createPlayerShopItemListMsg(e.getId()):Define.PLAYER_SHOP_TYPE_ENCHANT==e.getShoptype()&&(n=MsgHandler.createPlayerEnchantShopItemListMsg(e.getId())),null==n)return!1;return nato.Network.sendCmd(n,(function(n){t.shopName=n.getString(),t.model=e;var i=n.getByte();if(!(0>=i)){for(var o=[],a=0;i>a;a++){var r=ShopItem.fromBytesPlayerShopItem(n);r.setShopLocked(!1),o.push(r)}if(null==o||o.length<=0)return void AlertPanel.alertCommon(GameText.STR_SHOP_ITEM_SHOP_NULL);GameWorld.doGetItemSuit(o,(function(){}),this),Define.PLAYER_SHOP_TYPE_NORMAL==e.getShoptype()?PanelManager.openOtherShopPanel(ShopType.SUB_SHOP_SELL,0,o):PanelManager.openOtherShopPanel(ShopType.SUB_SHOP_ENCHAT_SELL,0,o)}}),this),!0},t.doStallBuy=function(e){if(null!=e){var n=function(){if(e instanceof ShopItem){var n=i*e.money1,o=i*e.money2,a=i*e.money3;Model.checkEnoughMoney(n,o,a,(function(){if(n>=40){var r=new StringBuffer;n>0&&r.append(GameText.STR_MONEY1+n),o>0&&r.append(" "+GameText.STR_MONEY2+o),a>0&&r.append(" "+GameText.STR_MONEY3+a);AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageStringList(GameText.STR_SHOP_ITEM_USE_MONEY_BUY_ASK,[e.name+" "+i,r.toString()]),(function(){t.doPlayerShopBuyMsg(t.model,e,i)}),this)}else t.doPlayerShopBuyMsg(t.model,e,i)}),this)}},i=1;if(e.quantity>1){return void CommonFormPanel.createPlayerShopBuyForm(e.name,e.quantity,this,(function(t){(i=parseInt(t[0]))>0&&n()}))}n()}},t.doPlayerShopBuyMsg=function(t,e,n){if(null==t||null==e)return!1;if(null==xself)return!1;var i=xself.bag;if(null==i)return!1;var o=e.clone();e.setVarItemDataTo(o),o.setShopLocked(!1),o.quantity=n;var a=MsgHandler.createPlayerShopBuyMsg(t.getId(),o);return nato.Network.sendCmd(a,(function(t){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{var a=xself;if(null!=a){a.setMoneyByType(ModelConst.MONEY1,t.getInt()),a.setMoneyByType(ModelConst.MONEY3,t.getInt()),i.addItem(PlayerBag.TYPE_BAG_POS,o);var r=n*e.money1,s=n*e.money3,l=Tool.manageString(GameText.STR_SKILL_GETD_DESC_COST,(r>0?PowerString.makeColorString(GameText.STR_MONEY1+r,ColorUtils.COLOR_YELLOW)+" ":"")+(s>0?PowerString.makeColorString(GameText.STR_MONEY3+s,ColorUtils.COLOR_MONEY3)+" ":"")),_=Tool.convertDescToTextFlow(Tool.manageString(GameText.STR_STALL_BUY,e.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+n)+"\n"+l);AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),_),e.quantity-=n,PanelManager.getPanel(OtherShopPanel).updateByItem(e)}}}),this),!0},t.doStallRecord=function(){var e=xself;if(null!=e){if(0==e.isShopMode())return void AlertPanel.alertCommon(GameText.STR_STALL_NOT_IN);var n=null;if(Define.PLAYER_SHOP_TYPE_NORMAL==e.getShoptype()?n=MsgHandler.createPlayerShopRecordMsg():Define.PLAYER_SHOP_TYPE_ENCHANT==e.getShoptype()&&(n=MsgHandler.createPlayerEnchantShopRecordMsg()),null!=n){nato.Network.sendCmd(n,(function(n){if(null!=n){var i=t.showPlayerShopRecordMsg(n);if(Define.PLAYER_SHOP_TYPE_ENCHANT==e.getShoptype()){var o=n.getInt();o>0&&(i+=Tool.manageString(GameText2.STR_ENCHANT_SHOP_USE_ENCNANT,o+""))}Tool.isNullText(i)&&(i=GameText.STR_STALL_SELL_NULL),t.stallRecordAlert=AlertPanel.alertNotify(GameText.getText(GameText.TI_PLAYER_SHOP_RECORD),i),t.stallRecordAlert.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.recordAlertRemove,t)}}),this)}}},t.recordAlertRemove=function(e){t.stallRecordAlert.removeEventListener(egret.Event.REMOVED_FROM_STAGE,t.recordAlertRemove,t),t.stallRecordAlert=null},t.money1Max=1e4,t.money3Max=1e6,t.sellCountMax=21,t}();__reflect(SellHandler.prototype,"SellHandler");var StorePanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._type=0,e.menuList=null,e.action_back=1,e.action_refresh_bag=2,e.action_refresh_store=3,e._itemList=[],e._storeItemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this._type==e.Type_person_other||this._type==e.Type_person_vip_other?this.bagView.setAction("整理",null,this.onBagItemSelect,this):(this.bagView.setAction("整理",this.onBtnTidy_bag,this.onBagItemSelect,this),(this._type==e.Type_person||this._type==e.Type_person_vip)&&this.bagView.setAction2("整理仓库",this.onBtnTidy_store,this)),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){this.bagView.clearSelected(),PanelManager.closeScene()},e.prototype.onItemTouch=function(t){var n=t.target;n&&(this.onStoreItemSelect(n),n.itemData&&(this._type==e.Type_country?PanelManager.openItemView(n.itemData,8,this._player,this._country):this._type==e.Type_country_system?PanelManager.openItemView(n.itemData,10,this._player,this._country):PanelManager.openItemView(n.itemData,3,this._player)))},e.prototype.onStoreItemSelect=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.onBtnTidy=function(){if(this._type==e.Type_country||this._type==e.Type_country_system)ItemManager.doBagRefresh();else{if(null==this.menuList){this.menuList=[];var t=new MenuActionData(GameText.getText(GameText.TI_BACK),this.action_back);this.menuList.push(t),t=new MenuActionData(GameText.STR_REFRESH_BAG,this.action_refresh_bag),this.menuList.push(t),t=new MenuActionData(GameText.STR_REFRESH_STORAGE,this.action_refresh_store),this.menuList.push(t)}PanelManager.openFilterMenuPanel(this.menuList,this.onMenuSelect,this)}},e.prototype.onBtnTidy_bag=function(){this.onMenuSelect(this.action_refresh_bag)},e.prototype.onBtnTidy_store=function(){this.onMenuSelect(this.action_refresh_store)},e.prototype.onMenuSelect=function(t){t==this.action_refresh_bag?ItemManager.doBagRefresh():t==this.action_refresh_store?this._type==e.Type_person?ItemManager.doStorageRefresh(ItemManager.STORAGETYPE1):this._type==e.Type_person_vip?ItemManager.doStorageRefresh(ItemManager.STORAGETYPE2):AlertPanel.alertCommon("不能整理该仓库"):this.action_back},e.prototype.onBagItemSelect=function(){var t=this.bagView.selectItem;t&&t.itemData&&(this._type==e.Type_country?PanelManager.openItemView(t.itemData,9,this._player,this._country):this._type==e.Type_country_system?PanelManager.openItemView(t.itemData,11,this._player,this._country):PanelManager.openItemView(t.itemData,4,this._player))},e.prototype.setData=function(t,e,n){void 0===n&&(n=null),this._type=t,this._player=e,this._country=n},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"country",{get:function(){return this._country},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(this.init){this.reset();var t,n=60;this._type==e.Type_person||this._type==e.Type_person_other?(t=GameText.STR_STORAGE_PLAYER,n=PlayerBag.MAX_STORE_SIZE):this._type==e.Type_person_vip||this._type==e.Type_person_vip_other?(t=GameText.STR_VIP_STORAGE,n=PlayerBag.MAX_VIPSTORE_SIZE):this._type==e.Type_country?t=GameText.STR_STORAGE_COUNTRY:this._type==e.Type_country_system&&(t=GameText.STR_STORAGE_COUNTRY_SYSTEM),this.label_title.text=t;var i=0,o=0;this._storeItemList=[];var a=0,r=null;for(a=0;n>a;a++)i=a%7*((r=this.getItem()).width+2*xhdRatio)+6*xhdRatio,o=Math.floor(a/7)*r.width+6*xhdRatio,this.container.add(r,i,o),this._storeItemList.push(r);if(this._type==e.Type_country||this._type==e.Type_country_system){if(this._country){var s=!1,l=null;for(a=0;a<this._storeItemList.length;a++)r=this._storeItemList[a],s=this._country.isValidStoragePos(a),l=this._country.getStoreItem(a),r.alpha=s?1:.3,r.itemData=l}}else if(this._player&&this._player.bag){s=!1,l=null;for(a=0;a<this._storeItemList.length;a++){if(r=this._storeItemList[a],s=!1,l=null,this._type==e.Type_person||this._type==e.Type_person_other){var _=PlayerBag.STORE_START+a;s=this._player.bag.isValidStoragePos(_),l=this._player.bag.getItem(_)}else if(this._type==e.Type_person_vip||this._type==e.Type_person_vip_other){_=PlayerBag.VIPSTORE_START+a;s=this._player.bag.isValidVipStoragePos(_),l=this._player.bag.getItem(_)}r.alpha=s?1:.3,r.itemData=l}}this.container.update(),this.bagView.setData(this._player)}},e.prototype.updateBag=function(){this.bagView&&this.bagView.update()},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new Item,nato.attachSkin(t),t.touchChildren=!1,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.Type_person=1,e.Type_person_vip=2,e.Type_person_other=3,e.Type_person_vip_other=4,e.Type_country=5,e.Type_country_system=6,e}(ComponentBase);__reflect(StorePanel.prototype,"StorePanel");var GameLayer=function(t){function e(){var n=t.call(this)||this;return e.instance=n,n}return __extends(e,t),e.prototype.update=function(t){},e}(egret.DisplayObjectContainer);__reflect(GameLayer.prototype,"GameLayer");var ListPlayer=function(t){function e(){var e=t.call(this)||this;return e.manifesto="",e.gridX=0,e.gridY=0,e.countryBookNum=0,e}return __extends(e,t),e.prototype.isFlag=function(t){return 0!=(this.flag&t)},e.prototype.setSex=function(n){t.prototype.setSex.call(this,n),this.icon1&=~(e.LEN_SEX<<e.OFFSET_SEX),this.icon1|=(n&e.LEN_SEX)<<e.OFFSET_SEX},e.prototype.setRace=function(n){t.prototype.setRace.call(this,n),this.icon1&=~(e.LEN_RACE<<e.OFFSET_RACE),this.icon1|=(n&e.LEN_RACE)<<e.OFFSET_RACE},e.prototype.setJob=function(n){t.prototype.setJob.call(this,n),this.icon1&=~(e.LEN_JOB<<e.OFFSET_JOB),this.icon1|=(n&e.LEN_JOB)<<e.OFFSET_JOB},e.prototype.getOnlineDesc=function(){if(this.isStatusBit(ModelConst.STATUS_ONLINE))return GameText.getText(GameText.TI_ON_LINE);var t=Tool.getTimeStrByMin(this.times,!1);return 1==Tool.isNullText(t)?GameText.getText(GameText.TI_UNKNOWN_STATUS):t+GameText.getText(GameText.TI_BEFORE)},e.prototype.getMapName=function(){return this.mapName},e.prototype.setMapName=function(t){this.mapName=t},e.prototype.getTimes=function(){return this.times},e.prototype.getLongLeaveTime=function(){return Utility.getPlanTime(this.times)},e.prototype.getLeaveTime=function(){var t=this.getTimes()-Date.now();if(0>=t)return"";var e=t/Tool.MILLIS_IN_MINUTE;return t%Tool.MILLIS_IN_MINUTE>0&&(e+=1),Tool.getTimeStrByMin(e,!0)},e.prototype.setTimes=function(t){this.times=t},e.prototype.getModel=function(){return this.model},e.prototype.setModel=function(t){this.model=t},e.getRandomCreatePlayer=function(){var t=new e;return t.setSex(Tool.rand(Define.SEX_MALE,Define.SEX_FEMALE)),t.setRace(Tool.rand(Define.RACE_EAST,Define.RACE_WEST)),t.initJobByRace(0),t.model=Tool.randByRange(e.MAX_MODEL),t},e.prototype.initJobByRace=function(t){this.jobSelectIndex=t,this.setJob(Define.getJobByRace(this.race,t))},e.prototype.setStyleDataToIcon=function(){var t=0;t|=(this.getSex()&Model.LEN_SEX)<<Model.OFFSET_SEX,t|=(this.getRace()&Model.LEN_RACE)<<Model.OFFSET_RACE,t|=(this.getJob()&Model.LEN_JOB)<<Model.OFFSET_JOB,t=Model.setHandAndFeet(t);var e=1,n=0,i=1;switch(this.model){case 0:e=1,n=0,i=1;break;case 1:e=2,n=0,i=1;break;case 2:e=3,n=0,i=2}t|=(e&Model.LEN_HAIR_STYLE)<<Model.OFFSET_HAIR_STYLE,t|=(n&Model.LEN_HAIR_COLOR)<<Model.OFFSET_HAIR_COLOR,t|=(i&Model.LEN_FACE_STYLE)<<Model.OFFSET_FACE_STYLE,this.setIcon1(t)},e.doSeePlayerMsg=function(t,e){if(void 0===e&&(e=!1),null==t)return!1;PanelManager.openWaitForServer();var n=MsgHandler.createPlayerSee(t.getId());nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),null!=n){var i=OtherPlayerPanel.getPlayer();if(!n.getBoolean())return i.clearStatusBit(ModelConst.STATUS_ONLINE),void AlertPanel.alertCommon(GameText.STR_DO_SEE_PLAYER_NOT_ONLINE);i.setStatusBit(ModelConst.STATUS_ONLINE),i.setId(n.getInt()),i.setName(n.getString()),i.setLevel(n.getByte()),i.setLevel2(n.getByte()),i.setJob(n.getByte()),i.setIcon1(n.getInt()),i.setIcon2(n.getInt()),i.setIcon3(n.getInt()),i.partnerName=n.getString(),i.disciple=n.getString(),i.killCount=n.getInt(),i.Pkwincount=n.getInt(),i.Pklosecount=n.getInt(),i.countryName=n.getString();var o=n.getString();i.setVipLevel(n.getByte()),i.fromItemSetData(n);var a=n.getByte();if(a>0){var r=new PlayerBag(i);i.setBag(r)}for(var s=0;a>s;s++){var l=ItemData.fromBytes(n);null!=l&&i.bag.setItem(l)}i.setEnchantValue(n.getInt()),i.setIconpet1(n.getShort()),i.powerX=n.getInt(),Tool.isNullText(o)?i.setTitle(t.getTitle()):i.setTitle(o),i.setMode(t.getMode()),i.setLeaderID(t.getLeaderID()),i.members=t.members,i.setPlayerSprite(i.createSprite(!1)),PanelManager.openOtherPlayerPanel(e)}}),this)},e.getPlayerListInfo=function(t){var e="";e=t.getName()+"("+Define.getSexString(t.getSex())+") "+t.getLevel()+"级\n",e+=Define.getRaceString(t.getRace())+" "+Define.getJobString(t.getJob())+" VIP"+t.getVipLevel()+"\n",e+="地图:"+t.getMapName()+"\n";var n="";if(t.isStatusBit(ModelConst.STATUS_TEMP_DEL)){var i=t.getLeaveTime();0==Tool.isNullText(i)&&(n+="临时删除剩余"+i)}if(t.isStatusBit(ModelConst.STATUS_FROST)&&(n+=GameText.STR_PLAYER_LIST_STATUS_FROST),t.isStatusBit(ModelConst.STATUS_SELL)&&(n+=GameText.STR_PLAYER_LIST_STATUS_SELL),t.isStatusBit(ModelConst.STATUS_ENGAGE)&&(n+=GameText.STR_PLAYER_LIST_STATUS_ENGAGE),t.isStatusBit(ModelConst.STATUS_CLOSE)&&(n+=GameText.STR_PLAYER_LIST_STATUS_CLOSE),t.isStatusBit(ModelConst.STATUS_MOUTH)&&(n+=GameText.STR_PLAYER_LIST_STATUS_MOUTH),t.isTabStatus(Model.OFFLINE_DOING)){i=t.getLeaveTime();0==Tool.isNullText(i)&&(n+="执行离线任务"+t.getInfo(),n+=",剩余"+i)}return t.isStatusBit(ModelConst.STATUS_COMMENTS)&&(n+=GameText.STR_PLAYER_LIST_STATUS_COMMENTS),0==Tool.isNullText(n)&&(e+=Tool.manageString(GameText.STR_PLAYER_LIST_STATUS,n)),e},e.prototype.getListDesc=function(t){var e=new StringBuffer,n=this.getName();return 1!=Tool.isNullText(this.remark)&&t&&(n=this.remark),e.append(n),e.append("("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.level+"")),1==this.isStatusBit(ModelConst.STATUS_ONLINE)?e.append(" "+GameText.getText(GameText.TI_ON_LINE)):e.append(" "+GameText.STR_LIST_DESC_NOT_ONLINE),null!=xself&&xself.partnerId==this.id&&e.append(" "+GameText.STR_LIST_DESC_PARTNER),this.model==Define.RELATION_MASTER?e.append(" "+GameText.STR_LIST_DESC_RELATION_MASTER):this.model==Define.RELATION_PRENTICE&&e.append(" "+GameText.STR_LIST_DESC_RELATION_PRENTICE),e.append(")"),e.toString()},e.doInviteTeamMsg=function(t,e){if(!xself.isNovice){if(null==t||null==e)return!1;if(e.isPlayerTeam())return AlertPanel.alertCommon(GameText.STR_INIVITE_TEAM_OTHER_PLAYER),!1;if(t.isMember())return AlertPanel.alertCommon(GameText.STR_INIVITE_TEAM_IS_MEMBER),!1;var n=MsgHandler.createInviteTeamMsg(ProtocolDefine.TEAM_CREATE_TYPE_INVITE,e.getId());return nato.Network.sendCmd(n,(function(t){AlertPanel.alertCommon(Tool.manageString(GameText.STR_INIVITE_TEAM,e.getName()))}),this),!0}AlertPanel.alertCommon("新手阶段无法组队！")},e.doDelTeamMsg=function(t){if(null==t)return!1;if(0==t.isLeader())return AlertPanel.alertCommon(GameText.STR_DEL_Team_IS_MEMBER),!1;var e=MsgHandler.createSetTeamMsg(ProtocolDefine.TEAM_SET_DISBAND,0);return nato.Network.sendCmd(e,(function(){936!=xworld.gameMap.mapId&&(xworld.dismissTeam(t.getLeaderID()),AlertPanel.alertCommon(GameText.STR_DEL_TEAM_SUCCEE),xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn())}),this),!0},e.doChangeLeaderMsg=function(t,e){if(null==t||null==e)return!1;if(0==xself.isPlayerLeader())return AlertPanel.alertCommon(GameText.STR_CHANGE_LEADER_IS_MEMBER),!1;var n=MsgHandler.createSetTeamMsg(ProtocolDefine.TEAM_SET_CHANGE_CAPTAIN,e.getId());return nato.Network.sendCmd(n,(function(){}),this),!0},e.doLeaveTeamMsg=function(t){if(null==t)return!1;if(0==t.isPlayerTeam())return AlertPanel.alertCommon(GameText.STR_LEAVE_TEAM_NOT_ON_TEAM),!1;var e=MsgHandler.createSelfLeaveTeamMsg();return nato.Network.sendCmd(e,(function(){var e=xworld.getModel(t.getLeaderID());null!=e&&e.removeMember(t.getId(),3),AlertPanel.alertCommon(GameText.STR_LEAVE_TEAM_SUCCEE),xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn()}),this),!0},e.doKickTeamerMsg=function(t,e){if(null==t||null==e)return!1;if(0==t.isPlayerLeader())return AlertPanel.alertCommon(GameText.STR_KICK_TEAM_IS_MEMBER),!1;var n=MsgHandler.createSetTeamMsg(ProtocolDefine.TEAM_SET_REMOVE_MEMBER,e.getId());return nato.Network.sendCmd(n,(function(){936==xworld.gameMap.mapId||GameWorld.isCountryWarStatus()||(xself.removeMember(e.getId(),3),AlertPanel.alertCommon(GameText.STR_KICK_TEAM_MEMBER_SUCCEE),xevent.dispatchEvent(new WorldEvent(WorldEvent.AROUND__REFRESH_TEAM_INFO,this)),xworld.checkTeamBtn())}),this),!0},e.doJoinTeamMsg=function(t,e){if(!xself.isNovice){if(null==t||null==e)return!1;if(t.isPlayerTeam())return AlertPanel.alertCommon(GameText.STR_JOINTEAM_IS_PLAYER_TEAM),!1;var n=MsgHandler.createInviteTeamMsg(ProtocolDefine.TEAM_CREATE_TYPE_JOIN,e.getId());return nato.Network.sendCmd(n,(function(){AlertPanel.alertCommon(Tool.manageString(GameText.STR_JOINTEAM,e.getName()))}),this),!0}AlertPanel.alertCommon("新手阶段无法申请入队！")},e.prototype.setGridXY=function(t,e){this.gridX=t,this.gridY=e},e.prototype.getGridX=function(){return this.gridX},e.prototype.getGridY=function(){return this.gridY},e.fromBytesToEscortTeam=function(t){if(null==t)return null;var e=t.getInt(),n=t.getByte(),i=null;return 3==n?i=new Player:5==n&&((i=new Mercenary).groupId=t.getShort()),i.setId(e),i.setIcon1(t.getInt()),i.setIcon2(t.getInt()),i.setIcon3(t.getInt()),i.name=t.getString(),i.setLevel(t.getByte()),i.setJob(t.getByte()),i.hp=t.getInt(),i.hpMax=t.getInt(),i.setPlayerSprite(i.createSprite(!1)),i},e.fromBytesToCountryAssingMem=function(t){if(null==t)return null;var n=new e;n.setId(t.getInt()),n.setName(t.getString()),n.setLevel(t.getByte()),n.setJob(t.getByte()),n.setSex(t.getByte()),n.setCountryRank(t.getByte()),n.countryHonor=t.getInt(),n.countryBookNum=t.getShort(),0==t.getBoolean()?n.times=t.getInt():n.setStatusBit(ModelConst.STATUS_ONLINE);var i=t.getByte();if(Tool.isBit(ModelConst.COUNTRY_MEMBER_IS_VIP,i)||Tool.isBit(ModelConst.COUNTRY_MEMBER_IS_VIP_CQ,i)){var o=t.getByte();n.setVipLevel(o)}return n},e.prototype.setPlayerSprite=function(e){t.prototype.setPlayerSprite.call(this,e),null!=e&&this.addChild(e)},e.getStatusEvent=function(t){return Tool.isArrayIndexOutOfBounds(t,e.statusIDTable)?-1:e.statusIDTable[t]},e.getJobEvent=function(t){return Tool.isArrayIndexOutOfBounds(t,e.jobSortIDTable)?-1:e.jobSortIDTable[t]},e.getSortJobMenuList=function(){for(var t=[],n=0;n<e.jobSortIDTable.length;n++){var i=this.jobSortIDTable[n];0>i?t.push(GameText.STR_LIST_ALL):t.push(Define.getJobString(i))}return t},e.doMasterList=function(t,n,i,o){void 0===i&&(i=50),void 0===o&&(o=1);PanelManager.openWaitForServer();var a=new nato.Message(ProtocolDefine.CG_ACTOR_ACCEPTDISCIPLE_LIST),r=e.getStatusEvent(t),s=e.getJobEvent(n);a.putByte(r),a.putByte(s),a.putByte(i),a.putShort(o),nato.Network.sendCmd(a,(function(t){if(PanelManager.closeWaitForServer(),null==t)return null;if(0>t.getShort())return AlertPanel.alertCommon(t.getString()),null;for(var n=t.getByte(),i=[],o=0;n>o;o++){var a=e.fromBytesToMasterList(t);null!=a&&i.push(a)}xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_MASTER_LIST,i))}),this)},e.fromBytesToMasterList=function(t){if(null==t)return null;var n=new e;return n.id=t.getInt(),n.setName(t.getString()),n.flag=t.getByte(),n.job=t.getByte(),n.manifesto=t.getString(),n.level=t.getByte(),n.vipLevel=t.getByte(),t.getBoolean()&&n.setStatusBit(ModelConst.STATUS_ONLINE),n},e.prototype.getWarTopNameInfo=function(){return this.getName()+" ("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this.getLevel()+"")+Define.getJobString(this.getJob())+")"},e.doOpenQuestion=function(t,n){e.isVipType=t,e.isSuperType=n;var i=xself;if(null!=i){if(t){if(null==i.bag)return;if(null==i.bag.getItem(PlayerBag.SPIRIT_POS))return;var o=GameText.STR_VIP,a=Tool.manageStringList(GameText.STR_OPEN_QUESTION_NOT_VIP,[o,o,o]);if(i.getVipLevel()<1)return void AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),a,(function(){PayInfo.getPayList()}),this)}var r=new nato.Message(ProtocolDefine.CG_VIP_QUESTION_GET);r.putBoolean(t),r.putBoolean(n);nato.Network.sendCmd(r,(function(t){if(null!=t){if(0>t.getByte())return void AlertPanel.errorMessage(t.getString());var n=t.getByte();if(0>=n)return void AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_VIP_QUESTION_FINISH);var i=new StringBuffer;i.append(GameText.STR_VIP_QUESTION_TITLE),e.questionId=t.getShort();var o=t.getString();i.append(o+"\n");var a=t.getByte(),r=new Array,s=new Array;if(a>0)for(var l=0;a>l;l++){var _=t.getByte(),h=t.getString();i.append(_+""),i.append("、"),i.append(h),i.append("\n"),r.push(h),s.push(_)}if(r.push(GameText.getText(GameText.TI_BACK)),s.push(NPCConst.EVENT_ALL_BACK),i.append(Tool.manageString(GameText.STR_VIP_QUESTION_MY_COUNT,n+"")),PanelManager.isPanelShow(QuestionPanel))PanelManager.getPanel(QuestionPanel).setData(i.toString(),r,s);else PanelManager.openQuestionPanel(i.toString(),r,s)}}),this)}},e.answerSelect=function(t){var n=xself;if(null!=n){var i=new nato.Message(ProtocolDefine.CG_VIP_QUESTION_SUB);i.putShort(e.questionId),i.putByte(t),i.putBoolean(e.isVipType),i.putBoolean(e.isSuperType);nato.Network.sendCmd(i,(function(t){if(null!=t){if(0>t.getByte())return void AlertPanel.errorMessage(t.getString());var i=t.getByte(),o=t.getBoolean(),a=t.getShort(),r=!1,s=new StringBuffer;if(1==o){r=t.getBoolean();var l=MsgHandler.processMissionReward(n,0,t,!1);s.append(Tool.manageString(GameText.STR_VIP_QUESTION_RIGHT,l))}else s.append(GameText.STR_VIP_QUESTION_ERROR);a>0&&s.append(Tool.manageString(GameText.STR_VIP_QUESTION_ANSWER_RIGHT,a+"")+"\n"),i>0?s.append(Tool.manageString(GameText.STR_VIP_QUESTION_MY_COUNT,i+"")):s.append(GameText.STR_VIP_QUESTION_FINISH),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(s.toString())),r&&AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_VIP_QUESTION_PASS_ALL),e.doOpenQuestion(e.isVipType,e.isSuperType)}}),this)}},e.doOpenVIP=function(t){},e.MAX_MODEL=3,e.FRIEND_FLAG_IS_VIP=1,e.FRIEND_FLAG_IS_GM=2,e.FRIEND_FLAG_IS_TEACHER=4,e.FRIEND_FLAG_IS_VIP_CQ=8,e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_ONLINE=1,e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_OFFLINE=2,e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_ALL=3,e.statusIDTable=[e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_ONLINE,e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_OFFLINE,e.ACTOR_ACCEPTDISCIPLE_FIND_TYPE_ALL],e.jobSortIDTable=[-1,Define.JOB_RANGER,Define.JOB_XIUZHEN,Define.JOB_WARRIOR,Define.JOB_WIZARD,Define.JOB_NEW,Define.JOB_BACKUP2],e.statusText=[GameText.getText(GameText.TI_ON_LINE),GameText.STR_LIST_DESC_NOT_ONLINE,GameText.STR_LIST_ALL],e.questionId=0,e.isVipType=!1,e.isSuperType=!1,e}(Player);__reflect(ListPlayer.prototype,"ListPlayer");var Mercenary=function(t){function e(){var e=t.call(this)||this;return e.setType(5),e}return __extends(e,t),e.prototype.refreshWorldMercenaryData=function(){null!=this.worldMer&&(this.worldMer.hp=this.hp,this.worldMer.mp=this.mp)},e.fromBytesFull=function(t){var n=new e;n.groupId=t.getShort(),n.expireTime1=(new Date).getTime()+t.getInt(),e.fromBytesMercenary(n,t);var i=e.fromBytesMercenary(new e,t);return n.setPet(i),n},e.fromBytesSimple=function(t){var n=new e;n.groupId=t.getShort(),e.fromBytesSimpleData(t,n);var i=e.fromBytesSimpleData(t,new e);return n.setPet(i),n},e.fromBytesSimpleData=function(t,e){if(null==e)return null;var n=t.getInt();return 0>n?null:(e.id=n,e.icon1=t.getInt(),e.icon2=t.getInt(),e.icon3=t.getInt(),e)},e.fromBytesMercenary=function(t,e){if(null==t)return null;if(null==Monster.fromMonsterBytes(t,e))return null;if(t.info=e.getString(),t.job=e.getByte(),t.strength=e.getByte(),t.hp=e.getInt(),t.mp=e.getInt(),t.icon2=e.getInt(),t.icon3=e.getInt(),e.getBoolean()){for(var n=e.getByte(),i=[],o=0;n>o;o++)i.push(Skill.fromBytes(e));var a=MonsterAI.fromBytes(e,i);t.setAI(a)}return t},e.doMercenaryMyListMsg=function(t,n){if(null==t)return null;var i=MsgHandler.createMercenaryMyListMsg();nato.Network.sendCmd(i,(function(i){if(null==i)return null;var o=[],a=t.getMerList();if(null!=a&&a.length>0)for(var r=0;r<a.length;r++)null!=a[r]&&o.push(a[r]);MsgHandler.processMyMercenaryCheck(i);var s=i.getByte();for(r=0;s>r;r++)o.push(e.fromBytesList(i,!1));n(o)}),this)},e.fromBytesList=function(t,n){var i=new e;return i.groupId=t.getShort(),n&&(i.money1=t.getInt(),i.money2=t.getInt(),i.money3=t.getInt()),i.level=t.getByte(),i.job=t.getByte(),i.icon1=t.getInt(),i.icon2=t.getInt(),i.icon3=t.getInt(),i.strength=t.getByte(),i.setName(t.getString()),i.monstertype=t.getByte(),i.expireTime1=n?t.getShort():(new Date).getTime()+t.getInt(),i.sprite=i.createSprite(!1),i},e.doMercenarySetStatus=function(t,n){if(null==t)return!1;var i=0==t.isTabStatus(Model.MERCENARY_INFO),o=MsgHandler.createMercenarySetStatusMsg(t.groupId,i,n);return nato.Network.sendCmd(o,(function(o){if(null==o)return!1;if(!(MsgHandler.processMercenarySetStatusMsg(o)<0)){var a=xself;if(null==a)return!1;n==e.SOLDIER_STATE_FIGHT?(1==i&&(t=e.fromBytesMercenary(t,o)).setPet(e.fromBytesMercenary(new e,o)),a.addMercenary(t)):a.removeMercenary(t),xevent.dispatchEvent(new WorldEvent(WorldEvent.MERCENARY_REFRESH_INFO,this))}}),this),!0},e.doMercenaryDelMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;var e=MsgHandler.createMercenaryDelMsg(t.groupId);return nato.Network.sendCmd(e,(function(){var e=xself;if(null==e)return!1;var n=e.getMercenaryById(t.groupId);null!=n&&e.removeMercenary(n),xevent.dispatchEvent(new WorldEvent(WorldEvent.MERCENARY_REFRESH_INFO,this)),PanelManager.getPanel(MercenaryDetailScene,!1)&&PanelManager.isPanelShow(MercenaryDetailScene)&&PanelManager.closeScene(!1,PetScene.TAB_INDEX_MERCENARY),AlertPanel.alertCommon("解雇佣兵成功！")}),this),!0},e.doMercenaryBuyMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;if(t.money1>0||t.money2>0||t.money3>0){var n=PowerString.makeColorString(t.money1>0?GameText.STR_MONEY1+t.money1+"\n":"",ColorUtils.COLOR_YELLOW)+PowerString.makeColorString(t.money2>0?GameText.STR_MONEY2+t.money2+"\n":"",ColorUtils.COLOR_MONEY2)+PowerString.makeColorString(t.money3>0?GameText.STR_MONEY3+t.money3+"\n":"",ColorUtils.COLOR_MONEY3),i=function(){var n=t.isTabStatus(Model.MERCENARY_INFO),i=MsgHandler.createMercenaryBuyMsg(xworld.shopID,t,!n);nato.Network.sendCmd(i,(function(i){if(null==i)return!1;var o=i.getByte();if(0>o)return AlertPanel.errorMessage(i.getString()),!1;if(1==o)return!1;if(0!=o)return!1;t.groupId=i.getShort(),t.expireTime1=(new Date).getTime()+i.getInt();var a=i.getByte(),r=i.getInt(),s=i.getInt(),l=i.getInt(),_=xself;if(null==_)return!1;_.setPlayerMoney(r,s,l,null),a==e.SOLDIER_STATE_FIGHT&&(0==n&&(t=e.fromBytesMercenary(t,i)).setPet(e.fromBytesMercenary(new e,i)),t.money1=0,t.money2=0,t.money3=0,_.addMercenary(t));var h=PanelManager.getPanel(MercenaryShop);h&&h.opMercenary(t),AlertPanel.alertCommon(GameText.STR_MERCENARY_BUY_SUCCESS)}),this)};AlertPanel.alert(GameText.STR_MERCENARY_BUY,Tool.manageStringList(GameText.STR_MERCENARY_BUY_ASK,[t.name,n]),(function(){Model.checkEnoughMoney(t.money1,t.money2,t.money3,i,this)}),this)}return!0},e.prototype.getCoolDownTime=function(t){if(this.expireTime1<0)return GameText.STR_HAVE_NO_TIME;if(1==t)return Tool.getTimeStrByMin(this.expireTime1,!0);var e=(this.expireTime1-(new Date).getTime())/Tool.MILLIS_IN_MINUTE;return Tool.getTimeStrByMin(e,!0)},e.doMercenaryInfoMsg=function(t,n,i,o){if(null==t)return!1;if(0==i){if(null!=xself&&null!=xself.getMercenaryById(t.groupId))return PanelManager.openMercenaryDetailScene(t,o),!0}if(1==t.isTabStatus(Model.MERCENARY_INFO))return!0;var a;return a=i?MsgHandler.createMercenaryInfoMsg(t.groupId):MsgHandler.createMercenaryMyInfoMsg(n,t.groupId),nato.Network.sendCmd(a,(function(n){if(null==n)return!1;if(0==i){if(MsgHandler.processMercenaryMyInfoMsg(n)<0)return;t.groupId=n.getShort(),t.expireTime1=(new Date).getTime()+n.getInt()}t=e.fromBytesMercenary(t,n);var a=e.fromBytesMercenary(new e,n);null!=a&&null==a.getPlayerSprite()&&a.setPlayerSprite(a.createSprite(!1)),t.setPet(a),PanelManager.openMercenaryDetailScene(t,o)}),this),!0},e.doMercenaryListMsg=function(t,n,i){var o=MsgHandler.createMercenaryListMsg(xworld.shopID,t,n);nato.Network.sendCmd(o,(function(t){if(null==t)return null;var n=new Array;if(t.getShort()>0)for(var o=t.getByte(),a=0;o>a;a++)n.push(e.fromBytesList(t,!0));i(n)}),this)},e.prototype.getClone=function(){var n=new e;return t.prototype.setMonsterData.call(this,n),n.groupId=this.groupId,n.strength=this.strength,n.hp=this.hp,n.mp=this.mp,n.expireTime1=this.expireTime1,n.job=this.job,n.info=this.info,n},e.SOLDIER_STATE_SLEEP=1,e.SOLDIER_STATE_FIGHT=2,e.SOLDIER_STATE_SACK=3,e.PANEL_MERCENARY_SHOP_TYPE=1,e.PANEL_MERCENARY_OTHER_TYPE=2,e}(Monster);__reflect(Mercenary.prototype,"Mercenary");var downloadFile,xaccountlist,xclearLoading,xlocal=!0,xrelease=!1,xstatistics=null,xcacheurl="http://192.168.1.120:9908/",xprefix="http://192.168.1.120:5008/res?",xserver="ws://123.59.14.170:30000/websocket",xgameid=1e3,xchannel=1100,xhd=!0,xhdRatio=2,xdebug=!0,xmicro=!1,apkLink="http://worldh5.gamehz.cn/version/world/micro.apk",showMicro=!0,xshowdemo=!1,xself=null,xworld=null,xitem=null,xevent=null,isWanyiWan=void 0!==window.OPEN_DATA&&"wanba_ts.105"==window.OPEN_DATA.pf,Main=function(t){function e(){var n=t.call(this)||this;return n.mainInterval=0,n.lastTickTime=0,n.lastFrame=0,n.lastCollectTime=0,n.maxFPS=0,n.collectSum=0,n.collectCount=0,e.instance=n,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),egret.ImageLoader.crossOrigin="anonymous",xworld=new GameWorld,xevent=new WorldEventDispatcher,xitem=new ItemManager,window.addEventListener("resize",n.onResize),native.setNativeInterface(),egret.ExternalInterface.call("JSReady","JS has registered loginToJS function"),n}return __extends(e,t),e.prototype.onResize=function(){(nato.stageWidth!=e.instance.stage.stageWidth||nato.stageHeight!=e.instance.stage.stageHeight)&&egret.setTimeout((function(){var t=e.instance.stage.stageWidth,n=e.instance.stage.stageHeight;e.instance.stage.setContentSize(t,n),nato.initialize(t,n,xhd)}),this,3e3)},e.queryString=function(t){var e=window.location.href;if(null!=(e=decodeURIComponent(e))){var n=e.replace(/\?/g,"&"),i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=n.substr(1).match(i);return null!=o?o[2]:null}},e.prototype.onInterval=function(){e.instance.ontick(egret.getTimer()),e.instance.onFrame(null)},e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.mainInterval=window.setInterval(this.onInterval,20),"micro"==e.queryString("from")&&(xmicro=!0);var n=e.queryString("xameid");n&&(xgameid=parseInt(n));var i=e.queryString("xhannel");i&&(xchannel=parseInt(i)),xchannel==Define.CHANNEL_SINA&&"android"==nato.getPlatform()&&(xmicro=!0),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter);var o=!1;(xchannel==Define.CHANNEL_9G&&(o=!0),egret.Capabilities.isMobile||o)?this.stage.stageWidth/this.stage.stageHeight>=nato.standardRatio?this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:this.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL;xchannel==Define.CHANNEL_SINA&&"android"==nato.getPlatform()&&(this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL);var a=Param.get();nato.FrameCache.countForDrawPerFrame=a.countForDrawPerFrame,nato.persistentPath("resource"),nato.initialize(this.stage.stageWidth,this.stage.stageHeight,xhd),this.gameLayer=new GameLayer,this.addChild(this.gameLayer),this.uiLayer=new UILayer,this.addChild(this.uiLayer),MsgHandler.instance,xdebug?nato.loadTheme("default.thm.json",this.onTheme,this):nato.loadTheme("default.thm.json",this.start,this),Interface.loadString("accountList",(function(t){xaccountlist=t}))},e.prototype.start=function(){return xchannel==Define.CHANNEL_YIJIE?(Sdk.channel=xchannel,Sdk.xsdk=new SdkYijie,void this.createScene()):void Sdk.start(xgameid,xchannel,this.createScene,this)},e.prototype.onTheme=function(){this.createScene()},e.prototype.ontick=function(t){return this.lastTickTime,this.lastTickTime=t,xworld.onTick(t)},e.prototype.onFrame=function(t){window.TICKER_RATE||(window.TICKER_RATE=2),window.MOVE_SPEED||(window.MOVE_SPEED=12),Control.DEFAULT_MOVE_SPEED!==window.MOVE_SPEED&&(Control.DEFAULT_MOVE_SPEED=window.MOVE_SPEED);for(let t=0;t<window.TICKER_RATE;t++)nato.WorldTicker.instance.run()},e.prototype.hdStage=function(){xhd||(xhd=!0,xhdRatio=2,this.stage.setContentSize(640,960),nato.initialize(this.stage.stageWidth,this.stage.stageHeight,xhd))},e.prototype.sdStage=function(){xhd&&(xhd=!1,xhdRatio=1,this.stage.setContentSize(320,480),nato.initialize(this.stage.stageWidth,this.stage.stageHeight,xhd))},e.prototype.createScene=function(){this.stage.addEventListener("jsKeyDown",this.onJsKeyDown,this),this.stage.addEventListener("jsKeyUp",this.onJsKeyUp,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFindWay,this,!0,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this,!0,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0,1e3),LoadManager.instance.load()},e.prototype.onFindWay=function(t){if(Sdk.xsdk.closeNode(),guide.ballGuiding||guide.battleFailFirse)t.stopPropagation();else if(!this.checkIsOutSide(t)){if(!egret.is(t.target,"eui.Group")||PanelManager.isOpeningFullScene)return void(PanelManager.isOpeningFullScene||this.checkQuickAddHP(t.stageX,t.stageY));var e=xself;if(null!=e&&!xworld.inBattle&&0!=e.isCanMove()){if(e.isAutoMove())return AutoGamer.switchAutoGaming(!1),void xself.clearAutoMoveList();AutoGamer.autoGaming&&(AutoGamer.switchAutoGaming(!1),xself.clearAutoMoveList()),OneKeyDailyMission.isDoingOnekeyMission&&(OneKeyDailyMission.waitSearchMissionIDList=null,OneKeyDailyMission.isDoingOnekeyMission=!1),xworld.onFindWay(t.stageX,t.stageY)}}},e.prototype.checkQuickAddHP=function(t,e){var n=PanelManager.mainMenu;if(null!=n&&null!=n.headInfoView){var i=n.headInfoView.getPlayerIconHPMPRect();if(null!=i)if(Tool.rectIn(i.x,i.y,i.width,i.height,t,e))return void ItemManager.doQuickAddHP(xself);var o=n.headInfoView.getPetIconHPMPRect();if(null!=o)Tool.rectIn(o.x,o.y,o.width,o.height,t,e)&&ItemManager.doQuickAddHP(xself.getPet())}},e.prototype.doAskCancelAutoMove=function(){AlertPanel.alert(GameText.STR_GIVE_UP_PATHFINDING,GameText.STR_GIVE_UP_PATHFINDING_ASK,this.onGiveUpPathFinding,this,null)},e.prototype.onGiveUpPathFinding=function(){AutoGamer.switchAutoGaming(!1),xself.clearAutoMoveList()},e.prototype.onTouchBegin=function(t){var n=t.stageX,i=t.stageY;e.pointPressedFlag=n|i<<15,this.checkIsOutSide(t)},e.prototype.onTouchEnd=function(t){var n=t.stageX,i=t.stageY;e.pointReleasedFlag=n|i<<15,this.checkIsOutSide(t)},e.prototype.checkIsOutSide=function(t){return!(!guide.rectBoxGuiding||GameWorld.bigGuideType!=GameWorld.FORCE_GUIDE_TYPE||!guide.touchOutsideTheRect(t.stageX,t.stageY))&&(t.stopPropagation(),!0)},e.getXFromPointer=function(t){return t==e.POINTER_NO?-1:32767&t},e.getYFromPointer=function(t){return t==e.POINTER_NO?-1:t>>15&32767},e.cleanPointerKey=function(){e.pointPressedFlag=e.POINTER_NO,e.pointReleasedFlag=e.POINTER_NO},e.prototype.onJsKeyDown=function(t){t.data},e.prototype.onJsKeyUp=function(t){},e.prototype.addUI=function(t){this.uiLayer&&this.uiLayer.uiLayer&&(nato.fitUI(t),this.uiLayer.uiLayer.addChild(t))},e.prototype.removeUI=function(t){t&&t.parent&&t.parent.removeChild(t)},e.prototype.removeBattleItemView=function(){for(var t=UILayer.instance.popupLayer,e=t.numChildren,n=!1,i=0;e>i;i++)if(egret.is(t.getChildAt(i),"BattleItemView")){n=!0;break}n&&t.removeChildren()},Object.defineProperty(e.prototype,"hasPopupUI",{get:function(){return this.uiLayer.popupLayer.numChildren>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDialogueUI",{get:function(){return e.instance.uiLayer.uiLayer.numChildren>1},enumerable:!0,configurable:!0}),e.prototype.addMap=function(t){this.gameLayer.addChildAt(t,0)},e.prototype.addGame=function(t){this.gameLayer.addChild(t)},e.prototype.hideUILayer=function(){this.uiLayer.visible=!1},e.prototype.showUILayer=function(){this.uiLayer.visible=!0},e.prototype.showLoadingScene=function(t){null==this.loadingScene&&(this.loadingScene=new LoadingScene,nato.attachSkin(this.loadingScene)),this.loadingScene.updateJumpTips(t),this.uiLayer&&this.uiLayer.topLayer&&(nato.fitBG(this.loadingScene),this.uiLayer.topLayer.addChild(this.loadingScene))},e.prototype.hideLoadingScene=function(){var t=this.uiLayer.topLayer;this.loadingScene&&t.contains(this.loadingScene)&&t.removeChild(this.loadingScene),xworld.isJumpingMap=!1},e.prototype.clearAll=function(){this.gameLayer&&this.gameLayer.removeChildren(),this.uiLayer&&this.uiLayer.clearAll(),GameWorld.cleanGuide(),xworld.isDrawMicroReward=!1,xworld.inBattle=!1,xworld.readyToBattle=!1,xworld.isJumpingMap=!1,GameWorld.skyarena=null,xworld.clearNPC(),xworld.gameMap=null,GameWorld.guideFrame=null,this.loadingScene=null,PanelManager.clearAllUI(),BattleView.clean(),BattleInputHandler.clean(),guide.cleanGuideArrow(),WorldMessage.clean(),LoginLotteryDraw.clean(),TodayEvent.clean(),PlayerDataManager.clean(),GameWorld.loginLotteryDraw=null,GameWorld.playerEventList=[],ChatMsg.cleanAllMsg(),VipInfo.clean(),OfflineExp.clean(),HotShop.clean()},e.prototype.collectFPS=function(){this.lastCollectTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.onCollect,this)},e.prototype.stopCollect=function(){return this.removeEventListener(egret.Event.ENTER_FRAME,this.onCollect,this),this.collectSum/this.collectCount>10?(this.hdStage(),!0):(this.sdStage(),!1)},e.prototype.onCollect=function(t){var e=egret.getTimer(),n=1e3/(e-this.lastCollectTime);n>this.maxFPS&&(this.maxFPS=n),this.collectSum+=n,this.collectCount+=1,this.lastCollectTime=e},e.prototype.switchStage=function(){xhd?this.sdStage():this.hdStage(),PanelManager.waitForServerPanel=null},e.POINTER_NO=2147483648,e.pointPressedFlag=e.POINTER_NO,e.pointReleasedFlag=e.POINTER_NO,e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var BattleBtn=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(ComponentBase);__reflect(BattleBtn.prototype,"BattleBtn");var BattleItemPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e.prototype.setData=function(t,e,n){this.itemBtnContainer.removeChildren(),this.itemBtnList=[],this.updateDesc(t);for(var i=e.length,o=20*xhdRatio,a=0;i>a;a++){var r=new BattleBtn;nato.attachSkin(r),r.label.text=e[a],r.y=o*a,r.obj=n[a],this.itemBtnContainer.addChild(r),this.itemBtnList.push(r),0==a&&(this.selectedBtn=r)}this.bg1.height=this.topBg.y+this.topBg.height+i*o-7*xhdRatio,this.bg2.height=this.bg1.height+18*xhdRatio},e.prototype.updateDesc=function(t){var e=Tool.convertDescToTextFlow(t);this.desc.textFlow=e},e.prototype.searchPressWidget=function(t,e){var n;if(this.visible)for(var i=this.itemBtnList.length,o=0;i>o;o++){var a=this.itemBtnList[o];if(0!=a.visible){var r=a.parent.localToGlobal(a.x,a.y);if(Tool.rectIn(r.x,r.y,a.width,a.height,t,e)){n=a;break}}}return n},e}(eui.Component);__reflect(BattleItemPanel.prototype,"BattleItemPanel");var BattleItemReward=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCreate=function(){this.touchEnabled=!0,this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckItem,this)},e.prototype.onCheckItem=function(t){null!=this.item&&PanelManager.openBattleItemView(this.item)},e.prototype.update=function(t,e){this.item=t,this.itemColorBg.source=xitem.getItemColorTexture(t.grade),this.itemIcon.source=xitem.getItemIcon(t.bagIcon),this.itemName.textFlow=Tool.convertDescToTextFlow(t.getNameInfo()),this.itemCount.text=1==e?"":e+""},e}(ComponentBase);__reflect(BattleItemReward.prototype,"BattleItemReward");var BattleLostRecommend=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCreate=function(){this.touchEnabled=!0,this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeadToUpgrade,this)},e.prototype.onLeadToUpgrade=function(t){if(null!=this.strongerRecommender){var n=this.strongerRecommender;if(n.linkType==e.RECOMMEND_TYPE_ADD_POINT)PanelManager.openRoleScene();else if(n.linkType==e.RECOMMEND_TYPE_SKILL){var i=MsgHandler.createAutoMoveMsg(906,6);nato.Network.sendCmd(i,this.onAutoFindPath,this),BattleView.instance.doExit()}else if(n.linkType==e.RECOMMEND_TYPE_EQUIP)PanelManager.openBag();else if(n.linkType==e.RECOMMEND_TYPE_TEAM)PanelManager.openSocietyScene();else if(n.linkType==e.RECOMMEND_TYPE_MERCENARY){i=MsgHandler.createAutoMoveMsg(906,5);nato.Network.sendCmd(i,this.onAutoFindPath,this),BattleView.instance.doExit()}else n.linkType==e.RECOMMEND_TYPE_GEM?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_GEM):n.linkType==e.RECOMMEND_TYPE_IDENTIFY?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_IDENTIFY):n.linkType==e.RECOMMEND_TYPE_UPGRADE_STAR?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_UPSTAR):n.linkType==e.RECOMMEND_TYPE_PET?null==xself.getPet()?PanelManager.openPetScene():PanelManager.openPetDetailScene():n.linkType==e.RECOMMEND_TYPE_REWARD&&PanelManager.openRewardPanel()}},e.prototype.onAutoFindPath=function(t){var e=t.getByte();if(0>e){var n=t.getString();e!=Mission.AUTO_MOVE_ERROR26&&e!=Mission.AUTO_MOVE_ERROR27&&AlertPanel.alertCommon(n)}else xself.fromBytesByAutoMove(t)},e.prototype.update=function(t){this.strongerRecommender=t,this.itemColorBg.source=t.bgColor,this.itemIcon.source=t.icon,t.isRecommend?(this.recommended.visible=!0,this.itemName.textFlow=Tool.convertDescToTextFlow(PowerString.makeColorString(t.name+"(推荐)",ColorUtils.COLOR_GREEN))):(this.recommended.visible=!1,this.itemName.textFlow=Tool.convertDescToTextFlow(PowerString.makeColorString(t.name,ColorUtils.COLOR_ORANGE)))},e.RECOMMEND_TYPE_ADD_POINT="addpoint",e.RECOMMEND_TYPE_SKILL="skill",e.RECOMMEND_TYPE_EQUIP="equip",e.RECOMMEND_TYPE_TEAM="team",e.RECOMMEND_TYPE_MERCENARY="mercenary",e.RECOMMEND_TYPE_GEM="gem",e.RECOMMEND_TYPE_IDENTIFY="identify",e.RECOMMEND_TYPE_UPGRADE_STAR="upgradestar",e.RECOMMEND_TYPE_PET="pet",e.RECOMMEND_TYPE_REWARD="reward",e}(ComponentBase);__reflect(BattleLostRecommend.prototype,"BattleLostRecommend");var BattleMenu=function(t){function e(){var e=t.call(this)||this;return e.btnList=[],e.btnEvent={},e.event2btn={},e}return __extends(e,t),e.prototype.onCreate=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.group_menu.visible=!0,this.btn_attack.name="btnAttack",this.btn_skill.name="btnSkill",this.btn_drug.name="btnDrug",this.btn_auto.name="btnAuto",this.btn_auto_disabled.name="btnAutoDisabled",this.btn_status.name="btnStatus",this.btn_escape.name="btnEscape",this.btn_info.name="btnInfo",this.btn_quit_see.name="btnQuitSee",this.btn_cancel_auto.name="btnCancelAuto",this.btn_skip_anime.name="btnSkipAnime",this.btn_pet_auto.name="btnPetAuto",this.btn_pet_cancel_auto.name="btnPetCancelAuto"},e.prototype.onAddToStage=function(t){this.btnList.push(this.btn_attack),this.btnList.push(this.btn_skill),this.btnList.push(this.btn_drug),this.btnList.push(this.btn_auto),this.btnList.push(this.btn_status),this.btnList.push(this.btn_escape),this.btnList.push(this.btn_quit_see),this.btnList.push(this.btn_cancel_auto),this.btnList.push(this.btn_skip_anime),this.btnList.push(this.btn_pet_auto),this.btnList.push(this.btn_pet_cancel_auto),this.btnList.push(this.btn_info),this.event2btn[e.EVENT_BATTLE_ORDER_ATTACK]=this.btn_attack,this.event2btn[e.EVENT_BATTLE_ORDER_SKILL]=this.btn_skill,this.event2btn[e.EVENT_BATTLE_ORDER_ITEM]=this.btn_drug,this.event2btn[e.EVENT_BATTLE_ORDER_AUTO]=this.btn_auto,this.event2btn[e.EVENT_BATTLE_ORDER_INFO]=this.btn_status,this.event2btn[e.EVENT_BATTLE_ORDER_ESCAPE]=this.btn_escape,this.event2btn[e.EVENT_BATTLE_ORDER_QUIT_SEE]=this.btn_quit_see,this.event2btn[e.EVENT_BATTLE_ORDER_CANCEL_AUTO]=this.btn_cancel_auto,this.event2btn[e.EVENT_BATTLE_ORDER_SKIP_ANI]=this.btn_skip_anime,this.event2btn[e.EVENT_BATTLE_ORDER_PET_AUTO]=this.btn_pet_auto,this.event2btn[e.EVENT_BATTLE_ORDER_PET_CANCEL_AUTO]=this.btn_pet_cancel_auto,this.event2btn[e.EVENT_BATTLE_ORDER_INFO_SEE]=this.btn_info,this.btnEvent[this.btn_attack.name]=e.EVENT_BATTLE_ORDER_ATTACK,this.btnEvent[this.btn_skill.name]=e.EVENT_BATTLE_ORDER_SKILL,this.btnEvent[this.btn_drug.name]=e.EVENT_BATTLE_ORDER_ITEM,this.btnEvent[this.btn_auto.name]=e.EVENT_BATTLE_ORDER_AUTO,this.btnEvent[this.btn_status.name]=e.EVENT_BATTLE_ORDER_INFO,this.btnEvent[this.btn_escape.name]=e.EVENT_BATTLE_ORDER_ESCAPE,this.btnEvent[this.btn_quit_see.name]=e.EVENT_BATTLE_ORDER_QUIT_SEE,this.btnEvent[this.btn_cancel_auto.name]=e.EVENT_BATTLE_ORDER_CANCEL_AUTO,this.btnEvent[this.btn_skip_anime.name]=e.EVENT_BATTLE_ORDER_SKIP_ANI,this.btnEvent[this.btn_pet_auto.name]=e.EVENT_BATTLE_ORDER_PET_AUTO,this.btnEvent[this.btn_pet_cancel_auto.name]=e.EVENT_BATTLE_ORDER_PET_CANCEL_AUTO,this.btnEvent[this.btn_info.name]=e.EVENT_BATTLE_ORDER_INFO_SEE,ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),this.headInfoView.setData(xself)},e.prototype.onRemoveFromStage=function(t){ButtonUtils.removeTouchEvent(this.btn_chat)},e.prototype.hideHeadInfoView=function(){this.headInfoView.visible=!1},e.prototype.showHeadInfoView=function(){this.headInfoView.visible=!0},e.prototype.hideMenu=function(){this.group_menu.visible=!1},e.prototype.showMenu=function(){this.group_menu.visible=!0,0==guide.isAutoFightUnlocked()&&0==xworld.noviceQuickBattle?(this.btn_auto.visible=!1,this.btn_auto_disabled.visible=!0):(this.btn_auto.visible=!0,this.btn_auto_disabled.visible=!1)},e.prototype.closeListPanel=function(){PanelManager.battleSkillPanel&&this.contains(PanelManager.battleSkillPanel)&&this.removeChild(PanelManager.battleSkillPanel),PanelManager.battleItemPanel&&this.contains(PanelManager.battleItemPanel)&&this.removeChild(PanelManager.battleItemPanel)},e.prototype.updateMenuShow=function(t){this.btn_drug.visible=t,this.btn_auto.visible=t,this.btn_escape.visible=t,0==t&&(this.btn_auto_disabled.visible=!1)},e.prototype.updateRound=function(t){this.round.text="回合:"+t+"/30"},e.prototype.updatePetAutoStatus=function(t,e){this.btn_pet_auto.visible=!(!t||0!=e),this.btn_pet_cancel_auto.visible=!(!t||!e)},e.prototype.searchPressWidget=function(t,e){var n;if(null==n)for(var i=0;i<this.btnList.length;i++){var o=this.btnList[i];if(null!=o.parent&&(o.parent!=this.group_menu||0!=this.group_menu.visible)&&0!=o.visible){var a=o.parent.localToGlobal(o.x,o.y);if(Tool.rectIn(a.x,a.y,o.width,o.height,t,e)){n=o;break}}}return n==this.btn_auto&&0==guide.isAutoFightUnlocked()&&0==xworld.noviceQuickBattle?null:n},e.prototype.onBtnChat=function(){PanelManager.openChatScene(),this.btn_chat.hasNewMessage=!1},e.prototype.setOrderInfoVisible=function(t){this.btn_info.visible=t,this.layoutBtns()},e.prototype.setSkipAnimeVisible=function(t){this.btn_skip_anime.visible=t,this.updateSkipText(),this.layoutBtns()},e.prototype.updateSkipText=function(){var t=BattleView.instance.isSkipBattleAvaliable();this.skip_text.text=t?"跳过战斗":"跳过回合"},e.prototype.setCancelAutoVisible=function(t){this.btn_cancel_auto.visible=t,this.updateSkipText(),this.layoutBtns()},e.prototype.layoutBtns=function(){var t=40*xhdRatio,e=[];this.btn_info.visible&&e.push(this.btn_info),this.btn_quit_see.visible&&e.push(this.btn_quit_see),this.btn_cancel_auto.visible&&e.push(this.btn_cancel_auto),this.btn_skip_anime.visible&&e.push(this.btn_skip_anime);for(var n=30*xhdRatio;e.length>0;){e.shift().bottom=n,n+=t}},e.prototype.setQuitSeeVisible=function(t){this.btn_quit_see.visible=t},e.prototype.setActionWidget=function(t){this.actionWidget=t},e.prototype.getActionWidget=function(){return this.actionWidget},e.prototype.getActionWidgetEvent=function(){return null==this.actionWidget?-1:this.btnEvent[this.actionWidget.name]},e.prototype.getWidgetByEventType=function(t){return this.event2btn[t]},e.EVENT_BATTLE_ORDER_ATTACK=1,e.EVENT_BATTLE_ORDER_SKILL=2,e.EVENT_BATTLE_ORDER_ITEM=3,e.EVENT_BATTLE_ORDER_AUTO=4,e.EVENT_BATTLE_ORDER_INFO=5,e.EVENT_BATTLE_ORDER_ESCAPE=6,e.EVENT_BATTLE_ORDER_QUIT_SEE=7,e.EVENT_BATTLE_ORDER_CANCEL_AUTO=8,e.EVENT_BATTLE_ORDER_SKIP_ANI=9,e.EVENT_BATTLE_ORDER_PET_AUTO=10,e.EVENT_BATTLE_ORDER_PET_CANCEL_AUTO=11,e.EVENT_BATTLE_ORDER_INFO_SEE=12,e.BTN_WIDTH=58,e.BTN_HEIGHT=62,e.BOTTOM_BTN_WIDTH=97,e.BOTTOM_BTN_HEIGHT=35,e}(eui.Component);__reflect(BattleMenu.prototype,"BattleMenu");var BattleResult=function(t){function e(){var e=t.call(this)||this;return e.protectedTime=0,e.itemRewardBottomY=0,e.lostRecommendBottomY=0,e}return __extends(e,t),e.prototype.onCreate=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this)},e.prototype.onLeave=function(t){Date.now()<this.protectedTime||egret.is(t.target,"BattleItemReward")||egret.is(t.target,"BattleLostRecommend")||BattleView.instance.doExit()},e.prototype.updateCountDown=function(t){this.countdown.text="返回 ("+Math.floor(t/1e3)+")"},e.prototype.setResult=function(t){this.clearAll(),this.winImg.visible=t,this.lostImg.visible=!t,this.protectedTime=Date.now()+500,this.moneyText.visible=t,this.expText.visible=t,this.countdownBtn.visible=t,this.lostText.visible=!t,0==t&&(this.checkLostRecommendation(),xself.getLevel()<=23&&xself.getLevel()>=15&&(xself.getMerList()&&xself.getMerList().length>0&&xworld.isBattleFailFirst_mer?(xworld.isBattleFailFirst_mer=!1,guide.setStatusFlag(!0,guide.IS_GUIDE_BATTLE_FAIL_2),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_8)):xworld.isBattleFailFirst&&(xworld.isBattleFailFirst=!1,Mercenary.doMercenaryMyListMsg(xself,(function(t){(null==t||0==t.length)&&(guide.setStatusFlag(!0,guide.IS_GUIDE_BATTLE_FAIL),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_7))}))))),this.bg.width=nato.stageWidth,this.bg.height=nato.stageHeight,-1!=xworld.remoteBattleMoney&&(this.setMoneyReward(xworld.remoteBattleMoney),xworld.remoteBattleMoney=-1),-1!=xworld.remoteBattleExp&&(this.setExpReward(xworld.remoteBattleExp),xworld.remoteBattleExp=-1)},e.prototype.getStrongRecommenderListByType=function(t){if(null==this.strongerRecommenderList){this.strongerRecommenderList={};var e=BattleLostRecommend.RECOMMEND_TYPE_ADD_POINT,n=BattleLostRecommend.RECOMMEND_TYPE_SKILL,i=BattleLostRecommend.RECOMMEND_TYPE_EQUIP,o=BattleLostRecommend.RECOMMEND_TYPE_TEAM,a=BattleLostRecommend.RECOMMEND_TYPE_MERCENARY,r=BattleLostRecommend.RECOMMEND_TYPE_GEM,s=BattleLostRecommend.RECOMMEND_TYPE_IDENTIFY,l=BattleLostRecommend.RECOMMEND_TYPE_UPGRADE_STAR,_=BattleLostRecommend.RECOMMEND_TYPE_PET,h=BattleLostRecommend.RECOMMEND_TYPE_REWARD;this.strongerRecommenderList[e]={name:"属性加点",priority:1,linkType:e,icon:"40",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[n]={name:"学习技能",priority:2,linkType:n,icon:"40",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[i]={name:"更换装备",priority:3,linkType:i,icon:"23",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[o]={name:"组队战斗",priority:4,linkType:o,icon:"3005",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[a]={name:"雇佣佣兵",priority:5,linkType:a,icon:"country_war_sd",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[r]={name:"镶嵌宝石",priority:6,linkType:r,icon:"34",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[s]={name:"鉴定装备",priority:7,linkType:s,icon:"26",bgColor:"102",isRecommend:!1},this.strongerRecommenderList[l]={name:"装备升星",priority:8,linkType:l,icon:"26",bgColor:"104",isRecommend:!1},this.strongerRecommenderList[_]={name:"宠物洗髓",priority:9,linkType:_,icon:"25",bgColor:"100",isRecommend:!1},this.strongerRecommenderList[h]={name:"未领奖励",priority:10,linkType:h,icon:"3015",bgColor:"102",isRecommend:!1}}var u=this.strongerRecommenderList[t];return u.isRecommend=!1,u},e.prototype.checkLostRecommendation=function(){var t=[];xself.cp>6&&t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_ADD_POINT)),(xself.getLevel()>15&&xself.isNeverLearntSkill()||xself.sp>3e3)&&t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_SKILL)),xself.bag.getStrongerEquipCount()>0&&xself.getLevel()>15&&xself.getLevel()<45&&t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_EQUIP));var e=xworld.getTypeModel(Define.NEAR_MY_TEAM).length>0;xself.getLevel()>20&&0==e&&t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_TEAM));var n=xself.getLevel()>20&&(null==xself.merList||0==xself.merList.length);if(n&&t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_MERCENARY)),xself.getLevel()>15&&(t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_GEM)),t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_IDENTIFY)),t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_UPGRADE_STAR)),t.push(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_PET))),n&&xself.getLevel()<30){var i=t.indexOf(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_MERCENARY));t.splice(i,1),t.unshift(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_MERCENARY))}if(xself.getLevel()<=25){var o=SevenDayReward.checkIsCanDraw(),a=RewardHandler.canGetLevelReward;(o||a)&&t.unshift(this.getStrongRecommenderListByType(BattleLostRecommend.RECOMMEND_TYPE_REWARD))}t.length>5&&(t=t.slice(0,5)),t.length>=1&&(t[0].isRecommend=!0),t.length>=2&&(t[1].isRecommend=!0);for(var r=t.length,s=0;r>s;s++){var l=t[s];this.addLostRecommender(l)}},e.prototype.clearAll=function(){for(this.itemRewardBottomY=0,this.lostRecommendBottomY=0,this.expText.text="",this.moneyText.text="";this.itemCtn.numChildren>0;){var t=this.itemCtn.getChildAt(0);egret.is(t,"BattleItemReward")?e.itemRewardPool.push(t):egret.is(t,"BattleLostRecommend")&&e.lostRecommendPool.push(t),this.itemCtn.removeChild(t)}},e.prototype.setMoneyReward=function(t){var e=PowerString.makeColorString("铜币",ColorUtils.COLOR_ORANGE);this.moneyText.textFlow=Tool.convertDescToTextFlow(e+PowerString.makeColorString("+"+t,ColorUtils.COLOR_GREEN))},e.prototype.setExpReward=function(t){var e=PowerString.makeColorString("经验",ColorUtils.COLOR_ORANGE);this.expText.textFlow=Tool.convertDescToTextFlow(e+PowerString.makeColorString("+"+t,ColorUtils.COLOR_GREEN))},e.prototype.addItemReward=function(t,e){var n=this.getItemReward();n.update(t,e),n.y=this.itemRewardBottomY+10,this.itemRewardBottomY=n.y+n.height,this.itemCtn.addChild(n)},e.prototype.addLostRecommender=function(t){var e=this.getLostRecommend();e.update(t),e.y=this.lostRecommendBottomY+10,this.lostRecommendBottomY=e.y+e.height,this.itemCtn.addChild(e)},e.prototype.getItemReward=function(){if(e.itemRewardPool.length>0)return e.itemRewardPool.pop();var t=new BattleItemReward;return nato.attachSkin(t),t},e.prototype.getLostRecommend=function(){if(e.lostRecommendPool.length>0)return e.lostRecommendPool.pop();var t=new BattleLostRecommend;return nato.attachSkin(t),t},e.itemRewardPool=[],e.lostRecommendPool=[],e}(ComponentBase);__reflect(BattleResult.prototype,"BattleResult");var BattleSkillPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.callLater(this.checkGuide,this)},e.prototype.checkGuide=function(){GameWorld.useGuide&&1==BattleView.instance.isTag(BattleConst.TAG_IS_GUIDE_SELECT_SKILL)&&this.setSelectSkillGuide()},e.prototype.setData=function(t,e,n){this.skillBtnContainer.removeChildren(),this.skillBtnList=[],this.desc.textFlow=t;for(var i=e.length,o=20*xhdRatio,a=0;i>a;a++){var r=new BattleBtn;nato.attachSkin(r),r.label.text=e[a],r.y=o*a,r.obj=n[a],this.skillBtnContainer.addChild(r),this.skillBtnList.push(r),0==a&&(this.selectedBtn=r)}this.bg1.height=this.topBg.y+this.topBg.height+i*o-7*xhdRatio,this.bg2.height=this.bg1.height+18*xhdRatio},e.prototype.setSelectSkillGuide=function(){var t=this.skillBtnList[0];if(null!=t&&null!=t.parent){var e=GameText.STR_BATTLE_ATTACK_HERE+GameText.STR_BATTLE_SKILL_CHOICE,n=t.parent.localToGlobal(t.x,t.y);GameWorld.setGuide(GameWorld.GUIDE_BATTLE_SELECT_SKILL);var i=232*xhdRatio,o=20*xhdRatio;GameWorld.getGuideFrame(e).show(n.x+i/2,n.y+5),GameWorld.setGuideRect(n.x,n.y,i,o,!0)}},e.prototype.updateDesc=function(t){this.desc.textFlow=t},e.prototype.searchPressWidget=function(t,e){var n;if(this.visible)for(var i=this.skillBtnList.length,o=0;i>o;o++){var a=this.skillBtnList[o];if(0!=a.visible){var r=a.parent.localToGlobal(a.x,a.y);if(Tool.rectIn(r.x,r.y,a.width,a.height,t,e)){n=a;break}}}return n},e}(eui.Component);__reflect(BattleSkillPanel.prototype,"BattleSkillPanel");var ChargeDesItem=function(t){function e(){var e=t.call(this)||this;return e.itemIconMap={35028:35028,35029:35029,35030:35030,35031:35028,35032:35029,35033:35029,35034:35030},e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_1,this.onBtn1,this),ButtonUtils.addTouchEvent(this.btn_2,this.onBtn2,this),this.img_yd_1.visible=!1,this.img_yd_2.visible=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.update()},e.prototype.onBtn1=function(){return xshowdemo?void PanelManager.openTestChargePanel(this.payInfo1):void(this.payInfo1&&Sdk.xsdk.order(this.payInfo1.getOpeType(),this.payInfo1.getGoodsId()))},e.prototype.onBtn2=function(){return xshowdemo?void PanelManager.openTestChargePanel(this.payInfo2):void(this.payInfo2&&Sdk.xsdk.order(this.payInfo2.getOpeType(),this.payInfo2.getGoodsId()))},e.prototype.setData=function(t,e){this.dataArr=t,this.orderPayinfoList=e,this.dataArr[0]&&(this.payInfo1=this.dataArr[0]),this.dataArr[1]&&(this.payInfo2=this.dataArr[1]),this.update()},e.prototype.update=function(){0==this.init||this.dataArr.length<=0||(1==this.dataArr.length&&(this.group_2.visible=!1),this.payInfo1&&(this.updateItemIcon(this.payInfo1,this.img_1),this.updateView(this.payInfo1,this.img_tuijian_1,this.lab_all_1,this.lab_ext_1,this.btn_1,this.img_yd_1,this.money_group1,this.gift_group1,this.lab_gift_1)),this.payInfo2&&(this.updateItemIcon(this.payInfo2,this.img_2),this.updateView(this.payInfo2,this.img_tuijian_2,this.lab_all_2,this.lab_ext_2,this.btn_2,this.img_yd_2,this.money_group2,this.gift_group2,this.lab_gift_2)))},e.prototype.updateItemIcon=function(t,e){var n=xhd?"_hd":"_sd",i=t.getGoodsId()%10+n;t.getAwardId()>0&&(i=this.itemIconMap[t.getAwardId()]+n),nato.getTextureFromUICache(i,(function(t){e.texture=t}),this)},e.prototype.updateView=function(t,e,n,i,o,a,r,s,l){e.visible=t.getIsRecommend(),n.text=t.getGainmoney1()+"",i.text=t.getGainmoney2()+"";var _=52==t.getGoodsId()?t.getMoney()/10:t.getMoney();o.label=_+"元";var h={35028:"云邮局专属6元礼包",35029:"云邮局专属12元礼包",35030:"云邮局专属30元礼包",35031:"云邮局专属0.1元礼包",35032:"云邮局专属2元礼包",35033:"云邮局专属5元礼包",35034:"云邮局专属10元礼包"},u=t.getAwardId(),c=null!=h[u];c&&(a.visible=!0,l.text=h[u]),r.visible=!c,s.visible=c},e}(ComponentBase);__reflect(ChargeDesItem.prototype,"ChargeDesItem");var ChargeGift=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e}(ComponentBase);__reflect(ChargeGift.prototype,"ChargeGift");var ChargePanel=function(t){function e(){var e=t.call(this)||this;return e._isBackDirect=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ItemList=new Array,this._index=0,ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.group_vip_btn,this.onBtnVip,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),Tool.removeObjSafe(this.vipLevel),this.vipLevel=null,this._isBackDirect=!1},e.prototype.onClose=function(){PanelManager.closeScene(this._isBackDirect)},Object.defineProperty(e.prototype,"isBackDirect",{get:function(){return this._isBackDirect},set:function(t){this._isBackDirect=t},enumerable:!0,configurable:!0}),e.prototype.onBtnVip=function(){PanelManager.openVIPScene(!0)},e.prototype.setData=function(t){for(var n in this._payinfoList=t.billList,this._orderpayinfoList=[],this._payinfoList)this._orderpayinfoList.push(this._payinfoList[n]);this._orderpayinfoList=this._orderpayinfoList.sort(e.sortByOrder),this.update()},e.sortByOrder=function(t,e){return t.getOrderNum()<e.getOrderNum()?-1:t.getOrderNum()>e.getOrderNum()?1:0},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),this.updateVip();for(var t=0;t<this._payinfoList.length;){var e=this.getItem(),n=[];this._payinfoList[t]&&n.push(this._payinfoList[t]),this._payinfoList[t+1]&&n.push(this._payinfoList[t+1]),e.setData(n,this._orderpayinfoList),this.container.add(e),t+=t+2>this._payinfoList.length?1:2}this.container.update()}},e.prototype.getItem=function(){var t=this._ItemList[this._index];return t||(t=new ChargeDesItem,nato.attachSkin(t),this._ItemList[this._index]=t),this._index++,t},e.prototype.updateVip=function(){var t=0;xself&&(t=xself.getVipLevel()),null==this.vipLevel&&(this.vipLevel=ImageNum.create(2006),this.vipLevel.scaleX=this.vipLevel.scaleY=.6*xhdRatio,this.group_vip.addChild(this.vipLevel)),this.vipLevel.num=t,this.lab_next_vip.text="VIP"+ ++t,this.lab_money.text="",VipInfo.doGetVipInfo(this.getVipInfoBack,this)},e.prototype.getVipInfoBack=function(){var t=VipInfo.getVipInfo(xself.getVipLevel()+1);if(null!=t){this.bar_exp.maximum=t.money,this.bar_exp.value=VipInfo.curGainMoney;var e=t.money-VipInfo.curGainMoney;this.lab_money.text=e+"黄金",this.group_vipInfo.visible=!0}else{this.group_vipInfo.visible=!1;var n=VipInfo.getVipInfo(xself.getVipLevel());if(n){this.bar_exp.maximum=n.money;var i=VipInfo.curGainMoney;i>n.money&&(i=n.money),this.bar_exp.value=i}else this.bar_exp.maximum=100,this.bar_exp.value=0}},e}(ComponentBase);__reflect(ChargePanel.prototype,"ChargePanel");var ChargePanelForWanba=function(t){function e(){var e=t.call(this)||this;return e._isBackDirect=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ItemList=new Array,this._index=0,ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.group_vip_btn,this.onBtnVip,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),Tool.removeObjSafe(this.vipLevel),this.vipLevel=null,this._isBackDirect=!1},e.prototype.onClose=function(){PanelManager.closeScene(this._isBackDirect)},Object.defineProperty(e.prototype,"isBackDirect",{get:function(){return this._isBackDirect},set:function(t){this._isBackDirect=t},enumerable:!0,configurable:!0}),e.prototype.onBtnVip=function(){PanelManager.openVIPScene(!0)},e.prototype.setData=function(t){for(var n in this._payinfoList=t.billList,this._orderpayinfoList=[],this._payinfoList)this._orderpayinfoList.push(this._payinfoList[n]);this._orderpayinfoList=this._orderpayinfoList.sort(e.sortByOrder),this.update()},e.sortByOrder=function(t,e){return t.getMoney()<e.getMoney()?-1:t.getMoney()>e.getMoney()?1:0},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),this.updateVip();for(var t=0;t<this._payinfoList.length;){var e=this.getItem(),n=[];this._payinfoList[t]&&n.push(this._payinfoList[t]),this._payinfoList[t+1]&&n.push(this._payinfoList[t+1]),e.setData(n,this._orderpayinfoList),this.container.add(e),t+=t+2>this._payinfoList.length?1:2}this.container.update()}},e.prototype.updateWanba=function(){var t=Sdk.param&&Sdk.param.wb_score,e=Sdk.param&&Sdk.param.wb_vip_level;t&&e?(this.label_star.text=t.toString(),this.label_wabba_lv.text=e.toString()):(this.label_star.text="-1",this.label_wabba_lv.text="-1")},e.prototype.getItem=function(){var t=this._ItemList[this._index];return t||(t=new ChargeDesItem,nato.attachSkin(t),this._ItemList[this._index]=t),this._index++,t},e.prototype.updateVip=function(){var t=0;xself&&(t=xself.getVipLevel()),null==this.vipLevel&&(this.vipLevel=ImageNum.create(2006),this.vipLevel.scaleX=this.vipLevel.scaleY=.6*xhdRatio,this.group_vip.addChild(this.vipLevel)),this.vipLevel.num=t,this.lab_next_vip.text="VIP"+ ++t,this.lab_money.text="",VipInfo.doGetVipInfo(this.getVipInfoBack,this)},e.prototype.getVipInfoBack=function(){var t=VipInfo.getVipInfo(xself.getVipLevel()+1);if(null!=t){this.bar_exp.maximum=t.money,this.bar_exp.value=VipInfo.curGainMoney;var e=t.money-VipInfo.curGainMoney;this.lab_money.text=e+"黄金",this.group_vipInfo.visible=!0}else{this.group_vipInfo.visible=!1;var n=VipInfo.getVipInfo(xself.getVipLevel());if(n){this.bar_exp.maximum=n.money;var i=VipInfo.curGainMoney;i>n.money&&(i=n.money),this.bar_exp.value=i}else this.bar_exp.maximum=100,this.bar_exp.value=0}},e}(ComponentBase);__reflect(ChargePanelForWanba.prototype,"ChargePanelForWanba");var TestChargePanel=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_closeSelect,this.onBtnCloseSelect,this),ButtonUtils.addTouchEvent(this.btn_del,this.onBtnDel,this),ButtonUtils.addTouchEvent(this.btn_pay,this.onBtnPay,this),ButtonUtils.addTouchEvent(this.btn_change,this.onBtnChangePayWay,this),ButtonUtils.addTouchEvent(this.btn_forget,this.onBtnForget,this),ButtonUtils.addTouchEvent(this.label_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_select_0,this.onBtnSelect0,this),ButtonUtils.addTouchEvent(this.btn_select_1,this.onBtnSelect1,this),ButtonUtils.addTouchEvent(this.btn_select_2,this.onBtnSelect2,this),ButtonUtils.addTouchEvent(this.btn_way_0,this.onBtnWaySelect0,this),ButtonUtils.addTouchEvent(this.btn_way_1,this.onBtnWaySelect1,this),this.group_info.visible=!0,this.group_select.visible=!1,this.group_info2.visible=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_closeSelect),ButtonUtils.removeTouchEvent(this.btn_del),ButtonUtils.removeTouchEvent(this.btn_pay),ButtonUtils.removeTouchEvent(this.btn_change),ButtonUtils.removeTouchEvent(this.btn_forget),ButtonUtils.removeTouchEvent(this.label_close),ButtonUtils.removeTouchEvent(this.btn_select_0),ButtonUtils.removeTouchEvent(this.btn_select_1),ButtonUtils.removeTouchEvent(this.btn_select_2),ButtonUtils.removeTouchEvent(this.btn_way_0),ButtonUtils.removeTouchEvent(this.btn_way_1)},e.prototype.onClose=function(){PanelManager.closeTestChargePanel()},e.prototype.onBtnPay=function(){this.onClose()},e.prototype.onBtnDel=function(){this.input_account.text="",this.input_password.text=""},e.prototype.onBtnForget=function(){},e.prototype.onBtnCloseSelect=function(){this.group_info.visible=!0,this.group_select.visible=!1},e.prototype.onBtnChangePayWay=function(){function t(){e.btn_change.alpha=0,e.showSelect()}var e=this;this.btn_change.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.onBtnSelect0=function(){function t(){e.btn_select_0.alpha=0,e.backToInfo(0)}var e=this;e.btn_select_0.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.onBtnSelect1=function(){function t(){e.btn_select_1.alpha=0,e.backToInfo(1)}var e=this;e.btn_select_1.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.onBtnSelect2=function(){function t(){e.btn_select_2.alpha=0,e.backToInfo(2)}var e=this;e.btn_select_2.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.onBtnWaySelect0=function(){function t(){e.btn_way_0.alpha=0,e.onClose()}var e=this;e.btn_way_0.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.onBtnWaySelect1=function(){function t(){e.btn_way_1.alpha=0,e.onClose()}var e=this;e.btn_way_1.alpha=.3,egret.callLater((function(){egret.callLater(t,this)}),this)},e.prototype.setData=function(t){this._payInfo=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._payInfo){this.label_name2.text=this.label_goodsName.text=this._payInfo.getInfo();var t=this._payInfo.getMoney();this.label_money2.text=this.label_money.text="¥ "+t+".0",this.group_select.visible=!1,t>30?(this.group_info.visible=!1,this.group_info2.visible=!0):(this.group_info2.visible=!1,this.group_info.visible=!0,this._selectIndex=0,this.updateSelect()),this.input_password.prompt="请输入验证码",this.input_password.displayAsPassword=!1,this.input_password.text=""}},e.prototype.updateSelectWay=function(){this.btn_select_0.alpha=0,this.btn_select_1.alpha=0,this.btn_select_2.alpha=0},e.prototype.updateSelect=function(){this.img_wx.visible=1==this._selectIndex,this.img_zfb.visible=2==this._selectIndex},e.prototype.backToInfo=function(t){this.group_info.visible=!0,this.group_select.visible=!1,this._selectIndex=t,this.updateSelect()},e.prototype.showSelect=function(){this.group_info.visible=!1,this.group_select.visible=!0,this.updateSelectWay();var t=[this.btn_select_0,this.btn_select_1,this.btn_select_2][this._selectIndex];this.img_select.y=t.y+30},e}(ComponentBase);__reflect(TestChargePanel.prototype,"TestChargePanel");var ChatListItem=function(t){function e(){var e=t.call(this)||this;return e._isSelect=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_name.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelNameTouch,this),this.label_content.addEventListener(egret.TextEvent.LINK,this.onLabelContentLink,this),null==this._vipItem&&(this._vipItem=new VipNumberItem,this._vipItem.x=29*xhdRatio,this._vipItem.y=2*xhdRatio,this.addChild(this._vipItem)),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.label_name.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelNameTouch,this),this.label_content.removeEventListener(egret.TextEvent.LINK,this.onLabelContentLink,this),this.clearFaceIcon(),this.clearItem2()},e.prototype.onLabelNameTouch=function(t){this._chatMsg&&this._chatMsg.doSeePlayer()},e.prototype.onLabelContentLink=function(t){this._chatMsg&&this._chatMsg.doLinkEvent(t.text)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemSimpleData&&this._chatMsg&&this._chatMsg.doViewChatItem(e.itemSimpleData)},e.prototype.setData=function(t){this._chatMsg=t,this._isSelect=!1,this.clearFaceIcon(),this.clearItem2(),this.parseData(),this.update()},Object.defineProperty(e.prototype,"chatMsg",{get:function(){return this._chatMsg},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._isSelect},set:function(t){this._isSelect=t,this.img_select&&(this.img_select.visible=this._isSelect)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.label_channel.text="",this.label_name.text="",this.label_content.text="",this._vipItem.visible=!1,this.select=!1)},e.prototype.clearFaceIcon=function(){if(this._faceIconList&&this._faceIconList.length>0){for(;this._faceIconList.length>0;){var t=this._faceIconList.pop();t.parent&&t.parent.removeChild(t),FaceIcon.returnFaceIcon(t)}this._faceIconList=null}},e.prototype.clearItem2=function(){if(this._showItemList&&this._showItemList.length>0){for(;this._showItemList.length>0;){var t=this._showItemList.pop();t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),t.parent&&t.parent.removeChild(t),Item2.returnItem2(t)}this._showItemList=null}},e.prototype.update=function(){if(this.init){if(!this._chatMsg)return void this.reset();this.label_channel.textColor=ChatMsg.getChannelColor(this._chatMsg.getChannel()),this.label_channel.text=ChatMsg.getChannalTagText(this._chatMsg.getChannel()),this.img_select.visible=this._isSelect,this._vipItem.visible=this._chatMsg.isVIP(),this._vipItem.num=this._chatMsg.getVipLevel(),this.label_name.textFlow=this._chatMsg.nameTextFlow,this.label_content.textFlow=this._chatMsg.contentTextFlow,this.label_content.height=this.label_content.textHeight+2;var t=this._chatMsg.faceIconDataList;if(t&&t.length>0){this.clearFaceIcon(),this._faceIconList=[];for(var e=0;e<t.length;e++){var n=t[e],i=FaceIcon.getFaceIcon(n.index,this.label_content.size);i.x=n.x+this.label_content.x,i.y=n.y+this.label_content.y,this.addChild(i),this._faceIconList.push(i)}}if(this._showItemList&&this._showItemList.length>0){var o,a=0,r=TextFieldUtils.getTextHeightByTextFlow(this._chatMsg.contentTextFlow,267*xhdRatio,13*xhdRatio,"黑体");o=this.label_content.x,a=r+5*xhdRatio;for(e=0;e<this._showItemList.length;e++){var s=this._showItemList[e];s.x=o,s.y=a,a+=s.height+2*xhdRatio,this.addChild(s)}}}},e.prototype.parseData=function(){if(this._chatMsg){this._chatMsg.parse();var t=TextFieldUtils.getTextHeightByTextFlow(this._chatMsg.contentTextFlow,267*xhdRatio,13*xhdRatio,"黑体")+5*xhdRatio;15*xhdRatio>t&&(t=15*xhdRatio);var e=this._chatMsg.showItemList;if(e&&e.length>0){this._showItemList=[];for(var n=0;n<e.length;n++){var i=e[n],o=Item2.getItem2();o.itemSimpleData=i,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._showItemList.push(o),t+=o.height+2*xhdRatio}}this.height=t}},e}(ComponentBase);__reflect(ChatListItem.prototype,"ChatListItem");var ChatMsg=function(){function t(e,n,i,o,a,r,s){void 0===r&&(r=0),void 0===s&&(s=null),this._flag=0,this._channel=0,this._senderID=0,this._vipLevel=0,this._sex=-1,this.countryID=0,this._spaceStr="",this._isParse=!1,this._channel=e,this._senderID=n,null!=i&&i.trim().length>0?this._name=i:this._name="",this._text=o,this._vipLevel=a,this._flag=r,this._remark=s,Tool.isBit(t.FLAG_SEX_FAMALE,this._flag)?this._sex=Define.SEX_FEMALE:this._sex=Define.SEX_MALE}return t.prototype.isHaveItem=function(){return null!=this.itemIDList&&this.itemIDList.length>0},t.prototype.isHaveMission=function(){return null!=this.missionIDList&&this.missionIDList.length>0},t.prototype.isCountry=function(){return this.countryID>0},t.prototype.isVIP=function(){return this._vipLevel>0},t.prototype.getFlag=function(){return this._flag},t.prototype.getChannel=function(){return this._channel},t.prototype.getText=function(){return this._text},t.prototype.getSenderId=function(){return this._senderID},t.prototype.getName=function(){return this._name},t.prototype.getVipLevel=function(){return this._vipLevel},t.prototype.getRemark=function(){return this._remark},t.prototype.setRemark=function(t){this._remark=t},t.prototype.isMySpeak=function(){return Tool.isBit(t.FLAG_PRIVATE_TARGET,this._flag)},t.prototype.getNameInfo=function(){var e=this._name;return this._channel==Define.CHAT_TYPE_PRIVATE&&Tool.isBit(t.FLAG_PRIVATE_TARGET,this._flag)&&(e=xself.getName()),PowerString.makeColorString(e,t.getSexColor(this._sex))},t.prototype.getFullText=function(e){void 0===e&&(e=!1);var n="";if(!e){var i=t.getChannalTagText(this._channel);n+=PowerString.makeColorString(i,t.getChannelColor(this._channel))}this._channel==Define.CHAT_TYPE_SERVER&&(n=n+"【"+this.serverName+"】"),Tool.isBit(t.FLAG_IS_TEACHER,this._flag)?n+="[指导员]":Tool.isBit(t.FLAG_IS_GM,this._flag)&&(n+="[客服]");var o=Define.SEX_MALE;Tool.isBit(t.FLAG_SEX_FAMALE,this._flag)&&(o=Define.SEX_FEMALE);var a=this._name;return 0==Tool.isNullText(this._remark)&&(a=this._remark),Tool.isBit(t.FLAG_PRIVATE_TARGET,this._flag)&&(a=Tool.manageString(GameText2.STR_YOU_SPEAK_TO,PowerString.makeColorString(a,ColorUtils.COLOR_YELLOW))),0==Tool.isNullText(a)&&(n+=PowerString.makeColorString(a+":",t.getSexColor(o))),n+this._text},Object.defineProperty(t.prototype,"nameTextFlow",{get:function(){return this._nameTextFlow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentTextFlow",{get:function(){return this._contentTextFlow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"faceIconDataList",{get:function(){return this._faceIconDataList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showItemList",{get:function(){return this._showItemList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spaceStr",{get:function(){return this._spaceStr},enumerable:!0,configurable:!0}),t.prototype.parse=function(){if(!this._isParse){if(this.isRedPaper())return this._contentTextFlow=this.getRedPaperDescArr(!0),this._nameTextFlow=[],this._faceIconDataList=[],this._showItemList=[],void(this._isParse=!0);var t="黑体",e=13*xhdRatio,n=267*xhdRatio,i=TextFieldUtils.getSpaceByWidth(e,e,t),o="";this.isVIP()&&(o=TextFieldUtils.getSpaceByWidth(30*xhdRatio,e,t));var a=this.getNameInfo();this._channel!=Define.CHAT_TYPE_SYSTEM&&(a+="："),a=o+a,this._nameTextFlow=Tool.convertDescToTextFlow(a);var r=TextFieldUtils.getTextWidth(a,e,"黑体");o=TextFieldUtils.getSpaceByWidth(r,e,t),this._spaceStr=o;var s=-1,l=-1,_=this._text,h=o;if(this.itemIDList&&this.itemIDList.length>0){this._showItemList=[];var u=0;for(s=_.indexOf("/i");-1!=s;){l=_.indexOf("/p",s);var c=_.substring(s,l+2),T=c.substring(4,6),p=c.substring(6,7),d=c.substring(7),E=(d=d.replace("{}","")).substring(8,d.length-2),g=!1,S=_.indexOf("/p",l+2);if(-1!=S){var m=_.substring(l+2,S+2);-1==m.indexOf("/i")&&-1!=m.indexOf("{}(进阶)")&&(d+=m=m.replace("{}",""),l=S,g=!0)}var f=new ItemSimpleData;f.name=E,f.nameInfo=d,f.bagIcon=Number(T),f.grade=Number(p)-1,f.index=u,f.isUpgrade=g,f.nameIndex=this.getSameNameIndex(f,this._showItemList),this._showItemList.push(f),u++,h+=_.substring(0,s),s=(_=_.substring(l+2)).indexOf("/i")}}h+=_,this._faceIconDataList=[],this._contentTextFlow=[];for(var I="",A=0,y="",R=PowerString.getNextPowerSign(h);-1!=R;){A+=1;var P=h.substring(R+1,R+2);if(I=h.substring(0,R),this._contentTextFlow.push(TextFieldUtils.getTextFlowElement(I)),y+=I,"n"==P)I="/n",this._contentTextFlow.push(TextFieldUtils.getTextFlowElement(I)),h=h.substring(R+2),y+=I;else if("c"==P){l=h.indexOf("/p");var C=h.substring(R+2,R+8);if(-1!=(I=h.substring(R+8,l)).indexOf("{}")){var M=I.substring(2);this._contentTextFlow.push(TextFieldUtils.getTextFlowElement(M,16768512,-1,null,-1,-1,M)),y+="["+M+"]"}else this._contentTextFlow.push(TextFieldUtils.getTextFlowElement(I,Number("0x"+C))),y+=I;h=h.substring(l+2)}else if("f"==P){var L=h.substring(R+2,R+4),v=Number(L);if(isNaN(v))this._contentTextFlow.push(TextFieldUtils.getTextFlowElement("/f"+L)),h=h.substring(R+4);else{var O,N=PowerString.calculateEndCharPosition(y,n,e,t);O=N.x+e/2>=n?new FaceIconData(0,N.y+e,L):new FaceIconData(N.x,N.y,L),this._faceIconDataList.push(O),h=i+h.substring(R+4)}}if(R=PowerString.getNextPowerSign(h),A>=500)break}this._contentTextFlow.push(TextFieldUtils.getTextFlowElement(h));for(var D=0;D<this._contentTextFlow.length;D++)""==this._contentTextFlow[D].text&&(this._contentTextFlow.splice(D,1),D--);this._isParse=!0}},t.prototype.getSameNameIndex=function(t,e){for(var n=0,i=0;i<e.length;i++){var o=e[i];o.name==t.name&&o.isUpgrade==t.isUpgrade&&n++}return n},t.setTabStatus=function(t,e){t?this.intValue1|=1<<e:this.intValue1&=~(1<<e),this.intValue1!=this.lastIntValue1&&(this.lastIntValue1=this.intValue1)},t.isTabStatus=function(t){return 0!=(this.intValue1&1<<t)},t.getChatStr=function(e,n){null!=e&&null!=n&&(e.push(GameText.STR_CIMPOSITE),n.push(Define.CHAT_TYPE_ALL),e.push(GameText.STR_WORLD),n.push(Define.CHAT_TYPE_WORLD),t.isTabStatus(Define.CHAT_TYPE_MAP)&&(e.push(GameText.STR_AREA),n.push(Define.CHAT_TYPE_MAP)),t.isTabStatus(Define.CHAT_TYPE_COUNTRY)&&(e.push(GameText.STR_COUNTRY),n.push(Define.CHAT_TYPE_COUNTRY)),t.isTabStatus(Define.CHAT_TYPE_TEAM)&&(e.push(GameText.STR_TEAM),n.push(Define.CHAT_TYPE_TEAM)),t.isTabStatus(Define.CHAT_TYPE_PRIVATE)&&(e.push(GameText.STR_CHAT_PRIVATE),n.push(Define.CHAT_TYPE_PRIVATE)),t.isTabStatus(Define.CHAT_TYPE_UNION)&&(e.push(GameText2.STR_UNION),n.push(Define.CHAT_TYPE_UNION)),e.push(GameText.STR_SYSTEM),n.push(Define.CHAT_TYPE_SYSTEM))},t.getChatMsgVector=function(e){return e==Define.CHAT_TYPE_COUNTRY?t.countryChatMsg:e==Define.CHAT_TYPE_PRIVATE?t.personalChatMsg:e==Define.CHAT_TYPE_WORLD?t.worldChatMsg:e==Define.CHAT_TYPE_UNION?t.unionChatMsg:e==Define.CHAT_TYPE_SERVER?t.serverChatMsg:t.allChatMsg},t.getChatMstList=function(e){return e==ChatScene.Tab_channel_world?t.worldChatMsg:e==ChatScene.Tab_channel_area?t.areaChatMsg:e==ChatScene.Tab_channel_country?t.countryChatMsg:e==ChatScene.Tab_channel_union?t.unionChatMsg:e==ChatScene.Tab_channel_team?t.teamChatMsg:e==ChatScene.Tab_channel_personal?t.personalChatMsg:e==ChatScene.Tab_channel_server?t.serverChatMsg:null},t.addChatSystemMsg=function(e,n){void 0===n&&(n=!1),n?(WorldMessage.addPromptMsg(e),this.addChatMsg(new t(Define.CHAT_TYPE_SYSTEM,-1,"",e,0),!1)):this.addChatMsg(new t(Define.CHAT_TYPE_SYSTEM,-1,"",e,0))},t.addChatMsg=function(e,n){if(void 0===n&&(n=!0),null!=e){1==n&&WorldMessage.addMsg(e);var i=t.MAX_OTHER_CHAT;e._channel==Define.CHAT_TYPE_WORLD?(i=t.MAX_WORLD_CHAT,t.addChatMsgVector(t.worldChatMsg,i,e)):e._channel==Define.CHAT_TYPE_MAP?(i=t.MAX_OTHER_CHAT,t.addChatMsgVector(t.areaChatMsg,i,e)):e._channel==Define.CHAT_TYPE_COUNTRY?(i=t.MAX_OTHER_CHAT,t.addChatMsgVector(t.countryChatMsg,i,e)):e._channel==Define.CHAT_TYPE_TEAM?(i=t.MAX_OTHER_CHAT,t.addChatMsgVector(t.teamChatMsg,i,e)):e._channel==Define.CHAT_TYPE_PRIVATE?(i=t.MAX_OTHER_CHAT,t.addChatMsgVector(t.personalChatMsg,i,e)):e._channel==Define.CHAT_TYPE_UNION?(i=t.MAX_OTHER_CHAT,t.addChatMsgVector(t.unionChatMsg,i,e)):e._channel==Define.CHAT_TYPE_SYSTEM?(i=t.MAX_WORLD_CHAT,t.addChatMsgVector(t.worldChatMsg,i,e)):e._channel==Define.CHAT_TYPE_SERVER&&(i=t.MAX_WORLD_CHAT,t.addChatMsgVector(t.serverChatMsg,i,e)),t.setTabStatus(!0,e._channel);var o=PanelManager.getPanel(ChatScene,!1);o&&o.stage&&o.addNewChatMsg(e,i)}},t.addChatMsgVector=function(t,e,n){for(null==t&&(t=[]);t.length>e;)t.shift();t.push(n)},t.cleanAllMsg=function(){this.allChatMsg=[],this.worldChatMsg=[],this.areaChatMsg=[],this.countryChatMsg=[],this.unionChatMsg=[],this.teamChatMsg=[],this.personalChatMsg=[]},t.addTempTalkModel=function(t){if(null!=t){null==this.tempTalkMsgList&&(this.tempTalkMsgList=[]);for(var e=!1,n=0;n<this.tempTalkMsgList.length;n++){var i=this.tempTalkMsgList[n];if(null!=i&&i.getId()==t.getId()){e=!0;break}}e||this.tempTalkMsgList.push(t);var o=PanelManager.getPanel(o,!1);o&&o.isChannelShow(Define.CHAT_TYPE_PRIVATE)&&o.updatePersonal(),o&&o.stage?this.lastTalkModel=null:this.lastTalkModel=t}},t.checkLastTalkIndex=function(){if(null!=this.lastTalkModel)for(var t=0;t<this.tempTalkMsgList.length;t++){var e=this.tempTalkMsgList[t];if(null!=e&&e.getId()==this.lastTalkModel.getId())return this.curTalkIndex=t,void(this.lastTalkModel=null)}},t.chatPrivateList=function(t){if(null==t)return null;for(var e=[],n=!1,i=0;null!=this.tempTalkMsgList&&i<this.tempTalkMsgList.length;i++){null!=(o=this.tempTalkMsgList[i])&&o.getId()==t.getId()&&(this.tempTalkMsgList.splice(i,1),this.tempTalkMsgList.splice(i,0,t),n=!0)}0==n&&e.push(t);for(i=0;null!=this.tempTalkMsgList&&i<this.tempTalkMsgList.length;i++){var o;null!=(o=this.tempTalkMsgList[i])&&e.push(o)}return e},t.chatPrivateSelect=function(t,e){if(null==t||null==e)return 0;for(var n=0,i=0;i<e.length;i++){var o=this.chatPrivateList[i];if(null!=o&&o.getId()==t.getId()){n=i;break}}return n},t.chatPrivateModel=function(t,e){var n=t.getName();if(0==Tool.isNullText(t.getRemark())&&(n=t.getRemark()+"("+t.getName()+")"),null!=t&&n==e)return t;for(var i=0;null!=this.tempTalkMsgList&&i<this.tempTalkMsgList.length;i++){var o=this.tempTalkMsgList[i];if(null!=o){var a=o.getName();if(0==Tool.isNullText(o.getRemark())&&(a=o.getRemark()+"("+o.getName()+")"),a.indexOf(e))return o}}return null},t.openPersonalChat=function(e){null!=e&&(t.addTempTalkModel(e),t.curTalkIndex=0,PanelManager.openChatScene(ChatScene.Tab_channel_personal,!0))},t.getChannalTagText=function(t){switch(t){case Define.CHAT_TYPE_WORLD:return"["+GameText.STR_WORLD_SIM+"]";case Define.CHAT_TYPE_COUNTRY:return"["+GameText.STR_COUNTRY_SIM+"]";case Define.CHAT_TYPE_TEAM:return"["+GameText.STR_TEAM_SIM+"]";case Define.CHAT_TYPE_MAP:return"["+GameText.STR_AREA_SIM+"]";case Define.CHAT_TYPE_SERVER:return"["+GameText2.STR_SERVER_SIM+"]";case Define.CHAT_TYPE_PRIVATE:return"["+GameText.STR_SECRET+"]";case Define.CHAT_TYPE_SYSTEM:return"["+GameText.STR_SYSTEM_SIM+"]";case Define.CHAT_TYPE_UNION:return"["+GameText2.STR_UNION_SIM+"]";case Define.CHAT_TYPE_NOTHING:return""}return"["+GameText.STR_WORLD_SIM+"]"},t.getSexColor=function(e){return e==Define.SEX_FEMALE?t.COLOR_SEX_FEMALE:t.COLOR_SEX_MALE},t.getChannelColor=function(e){var n=ColorUtils.COLOR_BLACK;switch(e){case Define.CHAT_TYPE_WORLD:n=t.MSG_COLOR_WORLD;break;case Define.CHAT_TYPE_COUNTRY:n=t.MSG_COLOR_COUNTRY;break;case Define.CHAT_TYPE_PRIVATE:n=t.MSG_COLOR_PRIVATE;break;case Define.CHAT_TYPE_TEAM:n=t.MSG_COLOR_TEAM;break;case Define.CHAT_TYPE_MAP:n=t.MSG_COLOR_MAP;break;case Define.CHAT_TYPE_SYSTEM:n=t.MSG_COLOR_SYSTEM;break;case Define.CHAT_TYPE_UNION:n=t.MSG_COLOR_UNION}return n},t.prototype.doViewChatItem=function(t){if(null!=this.itemList&&this.itemList.length>0)this.showItemDetail(t);else{var e=this,n=MsgHandler.createChatSeeItem(this._senderID,this.itemIDList);nato.Network.sendCmd(n,(function(n){var i=n.getByte();if(0>i)AlertPanel.alertCommon(n.getString());else{var o=i;e.itemList=[];for(var a=0;o>a;a++)e.itemList.push(ItemData.fromBytes(n));MsgHandler.processGetSuitInfoMsg(n),e.showItemDetail(t)}}),this)}},t.prototype.showItemDetail=function(t){var e=[];if(this.itemList&&this.itemList.length>0)for(var n=0;n<this.itemList.length;n++){var i=this.itemList[n];t.name==i.name&&t.isUpgrade==i.isUpgradeItem&&e.push(i)}if(0==e.length)AlertPanel.alertCommon("物品已不在玩家背包中");else if(1==e.length)this.showItemDetailPanel(e[0]);else{var o=e[t.nameIndex];o?this.showItemDetailPanel(o):AlertPanel.alertCommon("对方的物品已不可查看")}},t.prototype.showItemDetailPanel=function(t){if(t.isPetType()){var e=this;PanelManager.openItemSelectView(t,"查看宠物详情",(function(){e.doPetSee(t)}),this)}else PanelManager.openItemSelectView(t,"确定",null,null)},t.prototype.doLinkEvent=function(e){function n(){i._country.name==e?PanelManager.openManorManagerScene(i._country,!0):i.doViewChatMission(e)}if(e!=t.LinkEvent_redpaper_rob){var i=this;if(this.isCountry()){if(null==this._country)return this._country=new Country(this.countryID),void Country.getCountryInfo(this._country,Country.INFO_NORMAL,!0,n,this);n()}else this.doViewChatMission(e)}else this.redPaperData&&RedPaper.receiveRedPaper(this.redPaperData)},t.prototype.doViewChatMission=function(t){var e=this;if(null==this.missionList){var n=MsgHandler.createChatSeeMission(this._senderID,this.missionIDList);nato.Network.sendCmd(n,(function(n){var i=n.getByte();if(0>i)AlertPanel.alertCommon(n.getString());else{var o=i;e.missionList=[];for(var a=0;o>a;a++){var r=n.getBytes();null==r||r.length<=0||e.missionList.push(Mission.fromBytes(r))}e.showMissionDetail(t)}}),this)}else this.showMissionDetail(t)},t.prototype.showMissionDetail=function(t){for(var e=0;e<this.missionList.length;e++){var n=this.missionList[e];if(n.name==t){var i=[];o=new NPCActionData(n.name,-1),i.push(o);var o=new NPCActionData(GameText.getText(GameText.TI_BACK),7,null);i.push(o),PanelManager.openNPCDialogue(n.name,n.desc,i,n.rewardItems,n.selectItems,null);break}}},t.prototype.doPetSee=function(t){if(null!=t&&t.isPetType()){var e=new MyPet(null);e.petItem=t;MyPet.doPetInfoMsg(e,MsgHandler.PET_INFO_CHAT,[this._senderID,t.slotPos],(function(){PanelManager.openPetDetailScene(e,PetDetailScene.FromType_see)}),this)}},t.prototype.doSeePlayer=function(){if(1!=this._senderID&&4!=this._senderID&&!this.isMySpeak()&&this._senderID!=GameWorld.getPlayerID()){var t=new Model(3);t.setId(this._senderID),OtherPlayerPanel.menuType=Menu.UI_INTO_TYPE_CHAT,OtherPlayerPanel.channel=this._channel,ListPlayer.doSeePlayerMsg(t)}},t.prototype.isRedPaper=function(){return null!=this.redPaperData},t.prototype.getRedPaperDescArr=function(e){void 0===e&&(e=!1);var n=[];return e||n.push(TextFieldUtils.getTextFlowElement(t.getChannalTagText(this._channel)+" ",t.getChannelColor(this._channel))),n.push(TextFieldUtils.getTextFlowElement("玩家")),n.push(TextFieldUtils.getTextFlowElement(this.redPaperData.actorName,16763904)),n.push(TextFieldUtils.getTextFlowElement("发了")),n.push(TextFieldUtils.getTextFlowElement(RedPaper.getTypeDesc2(this.redPaperData.type),16763904)),n.push(TextFieldUtils.getTextFlowElement("红包")),n.push(TextFieldUtils.getTextFlowElement("快来抢啊",65280,-1,null,-1,-1,"red_paper_rob")),n},t.FLAG_IS_PHOTO=1,t.FLAG_PRIVATE_TARGET=2,t.FLAG_ITEM=4,t.FLAG_MISSION=8,t.FLAG_SEX_FAMALE=16,t.FLAG_BIND_PHONE=32,t.FLAG_WAR_END=64,t.FLAG_COUNTRY=128,t.FLAG_VIP=256,t.FLAG_VIP_TIME_OUT=512,t.FLAG_IS_GM=1024,t.FLAG_IS_TEACHER=2048,t.FLAG_VIP_CQ=4096,t.FLAG_TITEL=8192,t.intValue1=0,t.lastIntValue1=0,t.MAX_CHAT=20,t.MAX_OTHER_CHAT=20,t.MAX_WORLD_CHAT=30,t.allChatMsg=[],t.worldChatMsg=[],t.areaChatMsg=[],t.countryChatMsg=[],t.unionChatMsg=[],t.teamChatMsg=[],t.personalChatMsg=[],t.serverChatMsg=[],t.MAX_TEMP_TALK_NUM=4,t.tempTalkMsgList=[],t.curTalkIndex=0,t.COLOR_SEX_FEMALE=16670559,t.COLOR_SEX_MALE=57595,t.MSG_COLOR_CS=65535,t.MSG_COLOR_SYSTEM=16711680,t.MSG_COLOR_MAP=16185078,t.MSG_COLOR_TEAM=65280,t.MSG_COLOR_PRIVATE=16751103,t.MSG_COLOR_COUNTRY=16768550,t.MSG_COLOR_WORLD=16750848,t.MSG_COLOR_SPEAKER=16776960,t.MSG_COLOR_UNION=16385680,t.LinkEvent_redpaper_rob="red_paper_rob",t}();__reflect(ChatMsg.prototype,"ChatMsg");var ChatScene=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._tabIndex=0,e._isGotoInputStatus=!1,e._inputDefalutY=225*xhdRatio,e._inputDefaultTxt="输入信息",e._isInputStatus=!1,e._isInputFocusIn=!1,e._isScrollToNew=!0,e._saveLastIsInputStatus=!1,e._insertItemSlotList=[],e._lastInputHeight=0,e._personalIndex=0,e._personalItemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._tabBtnList&&(this._tabBtnList=[this.tabbtn_world,this.tabbtn_area,this.tabbtn_country,this.tabbtn_union,this.tabbtn_team,this.tabbtn_personal,this.tabbtn_server],this.label_selectTarget.parent&&this.label_selectTarget.parent.removeChild(this.label_selectTarget));for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_send,this.onBtnSend,this),ButtonUtils.addTouchEvent(this.btn_insertFaceIcon,this.onBtnInsertFaceIcon,this),ButtonUtils.addTouchEvent(this.btn_insertTask,this.onBtnInsertTask,this),ButtonUtils.addTouchEvent(this.btn_insertItem,this.onBtnInsertItem,this),ButtonUtils.addTouchEvent(this.btn_insertCountry,this.onBtnInsertCountry,this),this.input_txt.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputTxtGetFocus,this),this.input_txt.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputTxtLoseFocus,this),this.input_txt.addEventListener(egret.Event.CHANGE,this.onInputTxtChange,this),this.img_inputBg2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onInputBgTouch,this),this.input_txt.maxChars=100,this.input_txt.restrict="^\n\r",this.updateTab(),this.updateRedPoint(),null!=ChatMsg.lastTalkModel&&ChatMsg.checkLastTalkIndex(),this._saveLastIsInputStatus||this._isGotoInputStatus?(this.gotoInputStatus(),this._isGotoInputStatus=!1,this._saveLastIsInputStatus=!1):this.resetInput()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_send),ButtonUtils.removeTouchEvent(this.btn_insertFaceIcon),ButtonUtils.removeTouchEvent(this.btn_insertTask),ButtonUtils.removeTouchEvent(this.btn_insertItem),ButtonUtils.removeTouchEvent(this.btn_insertCountry),this.input_txt.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputTxtGetFocus,this),this.input_txt.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputTxtLoseFocus,this),this.input_txt.removeEventListener(egret.Event.CHANGE,this.onInputTxtChange,this),this.img_inputBg2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onInputBgTouch,this),this._saveLastIsInputStatus=this._isInputStatus,this._isInputStatus&&this.outOfInputStatus()},e.prototype.onClose=function(){return xworld.inBattle?void PanelManager.closeScene(!0):void(GameWorld.isEscortStatus()?GameWorld.openEscort():GameWorld.isCountryWarStatus()?PanelManager.openCountryWarScene():GameWorld.isCountryBossStatus()?PanelManager.openCountryBossScene(GameWorld.countryBoss):GameWorld.isTeamBossStatus()?PanelManager.openTeamBossScene(GameWorld.teamBoss):PanelManager.closeScene())},e.prototype.onInputBgTouch=function(t){t.stopImmediatePropagation(),this.gotoInputStatus(),this.img_inputBg2.touchEnabled=!1,this.input_txt.touchEnabled=!0},e.prototype.onInputTxtGetFocus=function(t){this._isInputFocusIn=!0,this.updateInputColor()},e.prototype.onInputTxtLoseFocus=function(t){this._isInputFocusIn=!1,this.updateInputColor(),this.input_txt.y=12*xhdRatio},e.prototype.onInputTxtChange=function(t){this.updateInputHeight()},e.prototype.onBtnSend=function(){var t=this.input_txt.text;if(!Tool.isNullText(t)&&t!=this._inputDefaultTxt){if(this.parseInsertItem(),this._insertItemSlotList.length>5)return void AlertPanel.alertCommon("最多只能插入5个物品");var e=this.getServerChannel(),n=-1;if(e==Define.CHAT_TYPE_PRIVATE){var i=ChatMsg.tempTalkMsgList[ChatMsg.curTalkIndex];i&&(n=i.getId())}var o=MsgHandler.createChatMsg(e,t,n);nato.Network.sendCmd(o,null,null),this.input_txt.text="",this._insertItemSlotList.length=0,this.updateInputHeight(),this.updateInputColor()}},e.prototype.onBtnInsertFaceIcon=function(){PanelManager.openFaceIconPanel(this.onSelectFaceIcon,this)},e.prototype.onSelectFaceIcon=function(t){var e=this.input_txt.text;e==this._inputDefaultTxt?e="/f"+t:e+="/f"+t,this.input_txt.text=e,this.updateInputColor()},e.prototype.onBtnInsertTask=function(){PanelManager.openTaskScene(0,TaskScene.FromType_chat),PanelManager.getPanel(TaskScene).taskPanel.setSelectCallback(this.onSelectMission,this)},e.prototype.onSelectMission=function(t){if(null!=t){for(var e=t.getId().toString();e.length<4;)e="0"+e;var n=this.input_txt.text;n==this._inputDefaultTxt?n="/m"+e:n+="/m"+e,this.input_txt.text=n,this.updateInputColor()}},e.prototype.onBtnInsertItem=function(){this.parseInsertItem(),PanelManager.openMailSelectItemPanel(this._insertItemSlotList,this.onSelectItem,this)},e.prototype.parseInsertItem=function(){this._insertItemSlotList.length=0;var t=this.input_txt.text;if(!Tool.isNullText(t))for(var e=t.indexOf("/b");-1!=e;){var n=Number(t.substring(e+2,e+5));n>=PlayerBag.BAG_START&&this._insertItemSlotList.push(n),e=(t=t.substring(e+5)).indexOf("/b")}},e.prototype.onSelectItem=function(t){if(null!=t){if(this._insertItemSlotList&&this._insertItemSlotList.length>=5)return void AlertPanel.alertCommon("最多可插入5个物品");for(var e=t.slotPos.toString();e.length<3;)e="0"+e;var n=this.input_txt.text;n==this._inputDefaultTxt?n="/b"+e:n+="/b"+e,this.input_txt.text=n,this.updateInputColor()}},e.prototype.onBtnInsertCountry=function(){var t=this.input_txt.text;t==this._inputDefaultTxt?t="<c>":t+="<c>",this.input_txt.text=t,this.updateInputColor()},e.prototype.onChatListItemTouch=function(t){egret.is(t.target,"ChatListItem")?this.onSelectChatListItem(t.target):egret.is(t.target.parent,"ChatListItem")&&this.onSelectChatListItem(t.target.parent)},e.prototype.onSelectChatListItem=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelectChatMsg=t.chatMsg,this._curSelect.select=!0)},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTabChannel=function(t,e){void 0===e&&(e=!1),this._tabIndex=t,this._isGotoInputStatus=e},e.prototype.updateTab=function(){this.init&&(this._curSelect&&(this._curSelect.select=!1,this._curSelect=null,this._curSelectChatMsg=null),ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.update())},e.prototype.getTabChannelByDefineChannel=function(t){return t==Define.CHAT_TYPE_WORLD||t==Define.CHAT_TYPE_SYSTEM||t==Define.CHAT_TYPE_ALL?e.Tab_channel_world:t==Define.CHAT_TYPE_MAP?e.Tab_channel_area:t==Define.CHAT_TYPE_COUNTRY?e.Tab_channel_country:t==Define.CHAT_TYPE_TEAM?e.Tab_channel_team:t==Define.CHAT_TYPE_PRIVATE?e.Tab_channel_personal:t==Define.CHAT_TYPE_UNION?e.Tab_channel_union:t==Define.CHAT_TYPE_SERVER?e.Tab_channel_server:0},e.prototype.getServerChannel=function(){var t=this._tabIndex;return t==e.Tab_channel_world?Define.CHAT_TYPE_WORLD:t==e.Tab_channel_area?Define.CHAT_TYPE_MAP:t==e.Tab_channel_country?Define.CHAT_TYPE_COUNTRY:t==e.Tab_channel_union?Define.CHAT_TYPE_UNION:t==e.Tab_channel_team?Define.CHAT_TYPE_TEAM:t==e.Tab_channel_personal?Define.CHAT_TYPE_PRIVATE:t==e.Tab_channel_server?Define.CHAT_TYPE_SERVER:0},e.prototype.resetInput=function(){this.updateInputColor(),this.updateInputHeight(),this.group_insertBtns.visible=!1,this.personalListView.visible=!1,this.group_input.y=435*xhdRatio,this.input_txt.height=this.input_txt.size,this.input_txt.touchEnabled=!1,this.img_inputBg2.touchEnabled=!0,this._lastInputHeight=0,this.updateContainerSize(!0)},e.prototype.gotoInputStatus=function(){this._isInputStatus||(this._isInputStatus=!0,this.getServerChannel()==Define.CHAT_TYPE_PRIVATE&&(this.personalListView.visible=!0,this.updatePersonalTalkList()),this.group_insertBtns.visible=!0,xself&&xself.getCountryId()>0?this.btn_insertCountry.parent||this.group_insertBtns.addChild(this.btn_insertCountry):this.btn_insertCountry.parent&&this.btn_insertCountry.parent.removeChild(this.btn_insertCountry),this.group_input.y=this._inputDefalutY,this.updateInputHeight(),this.updateInputStatus(),this.updateContainerSize(!0),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this))},e.prototype.outOfInputStatus=function(){this._isInputStatus&&(this._isInputStatus=!1,this.resetInput(),this.updateContainerSize(!0),this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this))},e.prototype.onStageTouch=function(t){var e=this.group_input.globalToLocal(t.stageX,t.stageY);(e.x<0||e.x>303*xhdRatio||e.y<0||e.y>250*xhdRatio)&&this.outOfInputStatus()},e.prototype.updateInputStatus=function(){var t=this._inputDefalutY+this.group_input.height;this.personalListView.visible&&(this.personalListView.y=t,t+=this.personalListView.height,this.personalListView.height<25*xhdRatio&&(t+=25*xhdRatio)),this.group_insertBtns.y=t+5*xhdRatio},e.prototype.updateInputHeight=function(){var t=this.input_txt.textHeight;t<this.input_txt.size&&(t=this.input_txt.size),t!=this._lastInputHeight&&(this._lastInputHeight=t,this.input_txt.height=t+5*xhdRatio,this._isInputFocusIn?this.input_txt.y=25*xhdRatio-t:this.input_txt.y=12*xhdRatio,this.group_input.height=t+25*xhdRatio,this.updateInputStatus())},e.prototype.updateContainerSize=function(t){var e=this.group_input.y-this.container.y;this.container.updateAutoSize(this.container.totalHeight,e),t&&this.container.updateToBottom()},e.prototype.updateInputColor=function(){this._isInputFocusIn?(this.input_txt.textColor=16777215,this.input_txt.text==this._inputDefaultTxt&&(this.input_txt.text="")):""==this.input_txt.text||null==this.input_txt.text||this.input_txt.text==this._inputDefaultTxt?(this.input_txt.textColor=481368,this.input_txt.text=this._inputDefaultTxt):this.input_txt.textColor=16777215},e.prototype.addNewChatMsg=function(t,e){if(null!=t){if(t.getChannel()!=Define.CHAT_TYPE_SYSTEM){var n=this.getServerChannel();if(t.getChannel()!=n)return;this.container.list.length>e&&this.container.list.shift()}var i=this.getItem();i.setData(t),this.container.add(i),this.updateContainerSize(this._isInputStatus||this._isScrollToNew)}},e.prototype.update=function(){this.container.reset(!0),this._index=0;var t=ChatMsg.getChatMstList(this._tabIndex);if(null!=t&&0!=t.length){for(var n=0;n<t.length;n++){var i=t[n];(a=this.getItem()).setData(i),this.container.add(a)}if(this.updateContainerSize(!0),this._curSelectChatMsg){var o=this.container.list;for(n=0;n<o.length;n++){var a;(a=o[n])&&a.chatMsg&&(a.chatMsg,this._curSelectChatMsg)}}this._tabIndex==e.Tab_channel_personal&&(xself&&xself.setTabStatus(!1,Model.CHAT_NEW_NOTICE),this.updateRedPoint())}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new ChatListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatListItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.prototype.getPersionalItem=function(){var t=this._personalItemList[this._personalIndex];return null==t&&((t=new eui.CheckBox).skinName=xhd?"CheckBox4HDSkin":"CheckBox4SDSkin",t.height=27*xhdRatio),this._personalIndex++,t},e.prototype.updatePersonalTalkList=function(){this._personalIndex=0,this.personalListView.reset(!0),null==this._personalCheckBoxGroup&&(this._personalCheckBoxGroup=new CheckBoxGroup,this._personalCheckBoxGroup.addEventListener(egret.Event.CHANGE,this.onPersonalTalkChange,this)),this._personalCheckBoxGroup.reset(),this.personalListView.add(this.label_selectTarget,25*xhdRatio,5*xhdRatio);var t=ChatMsg.tempTalkMsgList;if(t&&t.length>0){for(var e=ChatMsg.curTalkIndex,n=0;n<t.length;n++){var i=t[n],o=this.getPersionalItem();o.label=i.getName(),this.personalListView.add(o,25*xhdRatio),this._personalCheckBoxGroup.addCheckBtn(o)}this._personalCheckBoxGroup.select=e}this.personalListView.updateAutoSize(this.personalListView.totalHeight,125*xhdRatio)},e.prototype.onPersonalTalkChange=function(t){ChatMsg.curTalkIndex=this._personalCheckBoxGroup.select,this.updatePersonalTalkList()},e.prototype.updatePersonal=function(){this.updatePersonalTalkList(),this.updateInputStatus()},e.prototype.isChannelShow=function(t){return!!this.stage&&t==this.getServerChannel()},e.prototype.updateRedPoint=function(){xself&&xself.isTabStatus(Model.CHAT_NEW_NOTICE)?RedPoint.addRedPoint(this.tabbtn_personal):RedPoint.removeRedPoint(this.tabbtn_personal)},e.Tab_channel_world=0,e.Tab_channel_area=1,e.Tab_channel_country=2,e.Tab_channel_union=3,e.Tab_channel_team=4,e.Tab_channel_personal=5,e.Tab_channel_server=6,e}(ComponentBase);__reflect(ChatScene.prototype,"ChatScene");var FaceIcon=function(t){function e(){var e=t.call(this)||this;return e.icon=new eui.Image,e.addChild(e.icon),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e,!1),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e.prototype.onRemoveFromStage=function(t){},e.prototype.setData=function(t,e){this.icon.source="faceicon_"+t,this.icon.width=e,this.icon.height=e},e.prototype.setSize=function(t){this.icon.width=this.icon.height=t},e.getFaceIcon=function(t,n){var i;return(i=e._pool.length>0?e._pool.shift():new e).setData(t,n),i},e.returnFaceIcon=function(t){t&&e._pool.push(t)},e.clearPool=function(){e._pool=[],e._replaceSpaceList={}},e.getFaceReplaceSpace=function(t){if(null==(n=e._replaceSpaceList[""+t])){var n=TextFieldUtils.getSpaceByWidth(t,t,"黑体");e._replaceSpaceList[""+t]=n}return n},e._replaceSpaceList={},e._pool=[],e}(egret.DisplayObjectContainer);__reflect(FaceIcon.prototype,"FaceIcon");var FaceIconData=function(t,e,n){this.x=0,this.y=0,this.x=t,this.y=e,this.index=n};__reflect(FaceIconData.prototype,"FaceIconData");var FaceIconListItem=function(t){function e(){var e=t.call(this)||this;return e._faceID="",e._faceSize=32*xhdRatio,e.width=60*xhdRatio,e.height=47*xhdRatio,e.touchChildren=!1,e.touchEnabled=!0,e.bg=new eui.Image,e.bg.source="TY_bj_d2"+(xhd?"_hd":"_sd"),e.bg.width=60*xhdRatio,e.bg.height=45*xhdRatio,e.bg.x=1*xhdRatio,e.bg.y=1*xhdRatio,e.addChild(e.bg),e.faceIcon=new FaceIcon,e.faceIcon.x=(e.width-e._faceSize)/2,e.faceIcon.y=(e.height-e._faceSize)/2,e.addChild(e.faceIcon),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){var e=this.getIndexString(t);this._faceID!=e&&(this._faceID=e,this.faceIcon.setData(e,this._faceSize))},Object.defineProperty(e.prototype,"faceID",{get:function(){return this._faceID},enumerable:!0,configurable:!0}),e.prototype.getIndexString=function(t){var e=t.toString();return 1==e.length&&(e="0"+e),e},e}(ComponentBase);__reflect(FaceIconListItem.prototype,"FaceIconListItem");var FaceIconPanel=function(t){function e(){var e=t.call(this)||this;return e._faceIconList=null,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._faceIconList&&this.createFaceIcon();for(var n=0;n<this._faceIconList.length;n++){this._faceIconList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceIconTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._faceIconList.length;n++){this._faceIconList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceIconTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this._callbackFunc=null,this._thisObj=null},e.prototype.createFaceIcon=function(){this._faceIconList=[];for(var t=0;45>t;t++){var e=new FaceIconListItem;nato.attachSkin(e),e.setData(t),e.x=t%5*e.width+7*xhdRatio,e.y=Math.floor(t/5)*e.height+50*xhdRatio,this.addChild(e),this._faceIconList.push(e)}},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onFaceIconTouch=function(t){var e=t.target;e&&""!=e.faceID&&null!=this._callbackFunc&&null!=this._thisObj&&(this._callbackFunc.call(this._thisObj,e.faceID),this.onClose())},e.prototype.setData=function(t,e){this._callbackFunc=t,this._thisObj=e},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(FaceIconPanel.prototype,"FaceIconPanel");var NoticeItem=function(t){function e(){var e=t.call(this)||this;return e._isShowing=!1,e._showCount=0,e._isHaveTickerEvent=!1,e._tickerCount=0,e.touchChildren=e.touchEnabled=!1,e.y=70*xhdRatio,e.width=nato.standardWidth,e.drawBg(),e._container=new egret.DisplayObjectContainer,e._container.width=e.width-20*xhdRatio,e._container.height=15*xhdRatio,e._container.scrollRect=new egret.Rectangle(0,0,e._container.width,e._container.height),e._container.x=10*xhdRatio,e._container.y=2*xhdRatio,e.addChild(e._container),e._txt=new egret.TextField,e._txt.textColor=65280,e._txt.size=15*xhdRatio,e._txt.fontFamily="黑体",e._txt.wordWrap=!1,e._txt.multiline=!1,e._container.addChild(e._txt),e}return __extends(e,t),Object.defineProperty(e.prototype,"isShowing",{get:function(){return this._isShowing},enumerable:!0,configurable:!0}),e.prototype.show=function(t){this._txt.textFlow=Tool.convertDescToTextFlow(t),this._txt.width=this._txt.textWidth,this._txt.x=this._container.width,this._isShowing=!0,this._showCount=0,this.addTicker(),null==this.parent&&UILayer.instance.broadcastLayer.addChild(this)},e.prototype.hide=function(t){void 0===t&&(t=!0),this.parent&&this.parent.removeChild(this),this._isShowing=!1,this.removeTicker(),t&&this.dispatchEventWith(WorldMessage.EVENT_SHOW_OVER)},e.prototype.drawBg=function(){this.graphics.clear(),this.graphics.beginFill(0,.7),this.graphics.lineStyle(2,16777215,1),this.graphics.drawRoundRect(5,0,this.width-5*xhdRatio,20*xhdRatio,10*xhdRatio,10*xhdRatio),this.graphics.endFill()},e.prototype.addTicker=function(){this._isHaveTickerEvent||(nato.WorldTicker.instance.register(this.onTicker,this),this._isHaveTickerEvent=!0,this._tickerCount=0)},e.prototype.removeTicker=function(){this._isHaveTickerEvent&&(nato.WorldTicker.instance.unregister(this.onTicker,this),this._isHaveTickerEvent=!1)},e.prototype.onTicker=function(t){this._isShowing&&(this._tickerCount+=t,this._tickerCount>30&&(this._tickerCount-=30,this._txt.x-=2,this._txt.x+this._txt.width<0&&this.hide()))},e}(egret.Sprite);__reflect(NoticeItem.prototype,"NoticeItem");var PointMessageItem=function(t){function e(){var e=t.call(this)||this;return e._bg=new egret.Shape,e.addChild(e._bg),e._txt=new egret.TextField,e._txt.textColor=16776960,e._txt.size=15*xhdRatio,e._txt.fontFamily="黑体",e.addChild(e._txt),e}return __extends(e,t),e.prototype.setText=function(t){if(!Tool.isNullText(t)){this._txt.width=150*xhdRatio;var e=Tool.convertDescToTextFlow(t);this._txt.textFlow=e,this._txt.width=this._txt.textWidth,this._txt.height=this._txt.textHeight,this.width=this._txt.width,this.height=this._txt.height,this._bg.graphics.clear(),this._bg.graphics.beginFill(0,.5),this._bg.graphics.drawRect(0,0,this.width,this.height),this._bg.graphics.endFill()}},e}(egret.DisplayObjectContainer);__reflect(PointMessageItem.prototype,"PointMessageItem");var PointMessagePanel=function(t){function e(){var e=t.call(this)||this;e._showItemList=[],e._showingItemList=[],e._lastItem=null,e._messageList=[],e._hideCount=0,e._updateCount=0,e._isShowing=!1,e._isHaveTickerEvent=!1,e.touchChildren=e.touchEnabled=!1;for(var n=0;3>n;n++){var i=new PointMessageItem;e._showItemList.push(i)}return e.x=0,e.y=100*xhdRatio,UILayer.instance.broadcastLayer.addChild(e),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.clean=function(){e._instance&&(e._instance.hide(),e._instance._showItemList=[]),e._instance=null},e.prototype.addPointMsg=function(t){this.stage&&this._showItemList.length>0?this.showMsg(t):this._messageList.push(t)},e.prototype.addTicker=function(){this._isHaveTickerEvent||(nato.WorldTicker.instance.register(this.onTicker,this),this._isHaveTickerEvent=!0)},e.prototype.removeTicker=function(){this._isHaveTickerEvent&&(nato.WorldTicker.instance.unregister(this.onTicker,this),this._isHaveTickerEvent=!1)},e.prototype.onTicker=function(t){this._isShowing&&(this._hideCount+=t,this._hideCount>4e3&&this.hide()),this._messageList.length>0&&(this._updateCount+=t,this._updateCount>500&&this.showMsg(this._messageList.shift()))},e.prototype.hide=function(){for(this._isShowing=!1,this._hideCount=0,this.removeChildren(),this.removeTicker();this._showingItemList.length>0;)this._showItemList.push(this._showingItemList.shift())},e.prototype.showMsg=function(t){var e=this.getItem();e.setText(t),this._showingItemList.push(e),this._hideCount=0,this._isShowing=!0,this.addTicker(),this.update()},e.prototype.update=function(){for(var t=0,e=0;e<this._showingItemList.length;e++){var n=this._showingItemList[e];n.y=t,t+=n.height+3*xhdRatio,this.addChild(n)}},e.prototype.getItem=function(){return this._showItemList.length>0?this._showItemList.pop():this._showingItemList.shift()},e}(egret.DisplayObjectContainer);__reflect(PointMessagePanel.prototype,"PointMessagePanel");var PromptPanel=function(t){function e(){var e=t.call(this)||this;return e._msgList=[],e._isShowing=!1,e._showCount=0,e._showTime=0,e._isHaveTickerEvent=!1,e._faceIconList=[],e._itemIconList=[],e.touchChildren=e.touchEnabled=!1,e._txt=new egret.TextField,e._txt.textColor=16776960,e._txt.x=5*xhdRatio,e._txt.y=5*xhdRatio,e._txt.size=15*xhdRatio,e._txt.fontFamily="黑体",e._txt.textAlign="center",e._txt.width=nato.standardWidth-10*xhdRatio,e.addChild(e._txt),e.width=nato.standardWidth,e.y=60*xhdRatio,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.clean=function(){e._instance&&e._instance.clearAllPrompt(),e.clearPool(),e._instance=null},e.prototype.addPromptMsg=function(t){this._isShowing?(this._msgList.push(t),this._showTime=2e3):this.show(t)},e.prototype.onTicker=function(t){this._showCount+=t,this._isShowing&&this._showCount>this._showTime&&(this.hide(),this.checkNext())},e.prototype.checkNext=function(){0==this._msgList.length?this.removeTicker():this.showNext()},e.prototype.showNext=function(){this._msgList.length>0?this.show(this._msgList.shift()):(this.hide(),this.removeTicker())},e.prototype.hide=function(){if(this._faceIconList&&this._faceIconList.length>0)for(;this._faceIconList.length>0;){var t=this._faceIconList.pop();t&&t.parent&&t.parent.removeChild(t),FaceIcon.returnFaceIcon(t)}if(this._itemIconList&&this._itemIconList.length>0)for(;this._itemIconList.length>0;){var n=this._itemIconList.pop();n&&n.parent&&n.parent.removeChild(n),e.returnItemIcon(n)}this.parent&&this.parent.removeChild(this),this._isShowing=!1},e.prototype.show=function(t){var e=this.parse(t),n=Tool.convertDescToTextFlow(e,-1,!1);this._txt.textFlow=n,this._isShowing=!0,this._showCount=0,this._faceIconList.length>0||this._itemIconList.length>0?this._txt.textAlign="left":this._txt.textAlign="center",this._txt.height=this._txt.textHeight,this.height=this._txt.height+10*xhdRatio,this.drawBg(),this._msgList&&this._msgList.length>0?this._showTime=2e3:this._showTime=3e3,this.addTicker(),null==this.parent&&UILayer.instance.broadcastLayer.addChild(this)},e.prototype.parse=function(t){this._faceIconList.length=0,this._itemIconList.length=0;for(var n="",i=PowerString.getNextPowerSign(t);-1!=i;){n+=t.substring(0,i);var o=t.substring(i+1,i+2);if("f"==o){var a=t.substring(i+2,i+4),r=PowerString.calculateEndCharPosition(n,this._txt.width,this._txt.size,this._txt.fontFamily),s=FaceIcon.getFaceIcon(a,this._txt.size);s.x=this._txt.x+r.x,s.y=this._txt.y+r.y,s.x+s.width/2>this._txt.width&&(s.x=this._txt.x,s.y+=this._txt.size),this._faceIconList.push(s),this.addChild(s),t=FaceIcon.getFaceReplaceSpace(this._txt.size)+t.substring(i+4)}else if("i"==o){r=PowerString.calculateEndCharPosition(n,this._txt.width,this._txt.size,this._txt.fontFamily);var l=t.substring(i+4,i+6),_=t.substring(i+6,i+7),h=e.getItemIcon();h.scaleX=h.scaleY=.5,h.setData(Number(l),Number(_)-1),h.x=this._txt.x+r.x+7,h.y=this._txt.y+r.y,h.x+h.width/2>this._txt.width&&(h.x=this._txt.x,h.y+=this._txt.size),this._itemIconList.push(h),this.addChild(h),t=(t=(t="   "+t.substring(i+7)).replace("{}","")).replace("{}(进阶)","(进阶)")}else if("c"==o){var u=t.indexOf("/p",i),c=t.substring(i,u);-1!=c.indexOf("{}")?n+=(c=c.replace("{}","["))+"]/p":n+=c+"/p",t=t.substring(u+2)}else n+="/",t=t.substring(i+1);i=PowerString.getNextPowerSign(t)}return n+t},e.getItemIcon=function(){var t;return this._pool.length>0?t=this._pool.pop():(t=new ItemIcon,nato.attachSkin(t)),t},e.returnItemIcon=function(t){null!=t&&this._pool.push(t)},e.clearPool=function(){this._pool=[]},e.prototype.drawBg=function(){this.graphics.clear(),this.graphics.beginFill(0,.8),this.graphics.lineStyle(2,16777215,1),this.graphics.drawRoundRect(5,0,this.width-10,this.height,20,20),this.graphics.endFill()},e.prototype.addTicker=function(){this._isHaveTickerEvent||(nato.WorldTicker.instance.register(this.onTicker,this),this._isHaveTickerEvent=!0)},e.prototype.removeTicker=function(){this._isHaveTickerEvent&&(nato.WorldTicker.instance.unregister(this.onTicker,this),this._isHaveTickerEvent=!1)},e.prototype.clearAllPrompt=function(){this._msgList.length=0,this.hide(),this.removeTicker(),this._showCount=0},e._pool=[],e}(egret.Sprite);__reflect(PromptPanel.prototype,"PromptPanel");var TipsItem=function(t){function e(){var e=t.call(this)||this;return e._isHaveTickerEvent=!1,e._isShowing=!1,e._defaultSize=0,e.startY=350,e.startAlphaY=250,e.hideY=200,e.rate=-1,e._logicTime=0,e.multiline=!1,e.touchEnabled=!1,e.textColor=65280,e.fontFamily="黑体",e._defaultSize=16*xhdRatio,e.size=e._defaultSize,e.width=320*xhdRatio,e.textAlign="center",e.stroke=1*xhdRatio,e.horizontalCenter=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e.prototype.onRemoveFromStage=function(t){},Object.defineProperty(e.prototype,"isShowing",{get:function(){return this._isShowing},enumerable:!0,configurable:!0}),e.prototype.show=function(t){this._isShowing=!0,t.size>0?this.size=t.size:this.size=this._defaultSize,this.textFlow=Tool.convertDescToTextFlow(t.content),t.isDown?(this.startY=175*xhdRatio,this.startAlphaY=225*xhdRatio,this.hideY=250*xhdRatio,this.rate=2*xhdRatio):(this.startY=175*xhdRatio,this.startAlphaY=125*xhdRatio,this.hideY=100*xhdRatio,this.rate=-2*xhdRatio),this.y=this.startY,this.alpha=1,null==this.parent&&UILayer.instance.broadcastLayer.addChild(this)},e.prototype.logic=function(t){this._logicTime+=t,this._logicTime<20||(this._logicTime-=20,this.y+=this.rate,this.rate>0?this.y>this.startAlphaY&&(this.alpha=2*(this.hideY-this.y)/100,this.alpha<=0&&this.hide()):this.y<this.startAlphaY&&(this.alpha=2*(this.y-this.hideY)/100,this.alpha<=0&&this.hide()))},e.prototype.hide=function(){this._isShowing=!1,this.parent&&this.parent.removeChild(this),e.returnItem(this)},e.getItem=function(){return ObjectPool.getPool("TipsItem").createObject()},e.returnItem=function(t){ObjectPool.getPool("TipsItem").returnObject(t)},e}(eui.Label);__reflect(TipsItem.prototype,"TipsItem");var TipsData=function(){this.isDown=!1,this.size=-1};__reflect(TipsData.prototype,"TipsData");var VipNumberItem=function(t){function e(){var e=t.call(this)||this;return e._num=0,e.width=29*xhdRatio,e.height=14*xhdRatio,e._bg=new eui.Image,e._bg.source="vip_num_bg2"+(xhd?"_hd":"_sd"),e.addChild(e._bg),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._numImg=ImageNum.create(2008),this._numImg.x=20*xhdRatio,this._numImg.y=7*xhdRatio,this._numImg.scaleX=this._numImg.scaleY=.35*xhdRatio,this._numImg.numSpace=-4,this.addChild(this._numImg),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this._numImg),this._numImg=null},Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._numImg.num=this._num)},e}(ComponentBase);__reflect(VipNumberItem.prototype,"VipNumberItem");var WorldChatMsgItem=function(t){function e(){var e=t.call(this)||this;return e._isShowing=!1,e._showCount=0,e._isHaveTickerEvent=!1,e._iconSpaceStr=null,e._faceIconList=[],e._itemIconList=[],e.touchChildren=e.touchEnabled=!1,e._txt=new egret.TextField,e._txt.textColor=16709814,e._txt.x=10*xhdRatio,e._txt.y=5*xhdRatio,e._txt.size=15*xhdRatio,e._txt.fontFamily="黑体",e._txt.textAlign="left",e._txt.width=nato.standardWidth-20*xhdRatio,e._txt.addEventListener(egret.TextEvent.LINK,e.onTxtLink,e),e._txt.touchEnabled=!0,e.addChild(e._txt),e._vipItem=new VipNumberItem,e._vipItem.x=39*xhdRatio,e._vipItem.y=5*xhdRatio,e.addChild(e._vipItem),e.width=nato.standardWidth,e.y=70*xhdRatio,e}return __extends(e,t),e.prototype.show=function(t){var e;if(this._cm=t,null==this._iconSpaceStr&&(this._iconSpaceStr=TextFieldUtils.getSpaceByWidth(18*xhdRatio,this._txt.size,"黑体")),t.isRedPaper())e=t.getRedPaperDescArr();else{var n=this.parse(t);e=Tool.convertDescToTextFlow(n,-1,!1)}this._txt.textFlow=e,this._txt.height=this._txt.textHeight,this.height=this._txt.height+10*xhdRatio,this.drawBg(),this._isShowing=!0,this._showCount=0,this.addTicker(),null==this.parent&&(UILayer.instance.broadcastLayer.addChildAt(this,0),t.isRedPaper()?(UILayer.instance.broadcastLayer.touchChildren=!0,UILayer.instance.broadcastLayer.touchEnabled=!0,this.touchChildren=this.touchEnabled=!0):(UILayer.instance.broadcastLayer.touchChildren=!1,UILayer.instance.broadcastLayer.touchEnabled=!1,this.touchChildren=this.touchEnabled=!1))},Object.defineProperty(e.prototype,"isShowing",{get:function(){return this._isShowing},enumerable:!0,configurable:!0}),e.prototype.parse=function(t){this._faceIconList.length=0,this._itemIconList.length=0;var e="",n=ChatMsg.getChannalTagText(t.getChannel());(e+=n=PowerString.makeColorString(n,ChatMsg.getChannelColor(t.getChannel())),t.isVIP())?(this._vipItem.visible=!0,this._vipItem.num=t.getVipLevel(),e+=TextFieldUtils.getSpaceByWidth(30*xhdRatio,this._txt.size,this._txt.fontFamily)):this._vipItem.visible=!1;for(var i=t.getFullText(!0),o=PowerString.getNextPowerSign(i);-1!=o;){e+=i.substring(0,o);var a=i.substring(o+1,o+2);if("f"==a){var r=i.substring(o+2,o+4),s=Number(r);if(isNaN(s))e+="/f",i=i.substring(o+2);else{var l=PowerString.calculateEndCharPosition(e,this._txt.width,this._txt.size,this._txt.fontFamily),_=FaceIcon.getFaceIcon(r,this._txt.size);_.x=this._txt.x+l.x,_.y=this._txt.y+l.y,this._faceIconList.push(_),this.addChild(_),i=FaceIcon.getFaceReplaceSpace(this._txt.size)+i.substring(o+4)}}else if("i"==a){var h=new StringBuffer,u=(l=PowerString.calculateEndCharPosition(e,this._txt.width,this._txt.size,this._txt.fontFamily,32*xhdRatio,h),i.substring(o+4,o+6)),c=i.substring(o+6,o+7),T=this.getItemIcon();T.scaleX=T.scaleY=.5,T.setData(Number(u),Number(c)-1),T.x=this._txt.x+l.x+7,T.y=this._txt.y+l.y,this._itemIconList.push(T),this.addChild(T),i=(i=(i=h.toString()+this._iconSpaceStr+i.substring(o+7)).replace("{}","")).replace("{}(进阶)","(进阶)")}else if("c"==a){var p=i.indexOf("/p",o),d=i.substring(o,p);-1!=d.indexOf("{}")?e+=(d=d.replace("{}","["))+"]/p":e+=d+"/p",i=i.substring(p+2)}else e+="/",i=i.substring(o+1);o=PowerString.getNextPowerSign(i)}return e+i},e.prototype.getItemIcon=function(){var t=ObjectPool.getPool("ItemIcon").createObject();return nato.attachSkin(t),t},e.prototype.returnItemIcon=function(t){null!=t&&ObjectPool.getPool("ItemIcon").returnObject(t)},e.prototype.drawBg=function(){this.graphics.clear(),this.graphics.beginFill(1193046,.7),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill()},e.prototype.addTicker=function(){this._isHaveTickerEvent||(nato.WorldTicker.instance.register(this.onTicker,this),this._isHaveTickerEvent=!0)},e.prototype.removeTicker=function(){this._isHaveTickerEvent&&(nato.WorldTicker.instance.unregister(this.onTicker,this),this._isHaveTickerEvent=!1)},e.prototype.onTicker=function(t){this._isShowing&&(this._showCount+=t,this._showCount>3e3&&this.hide())},e.prototype.hide=function(t){if(void 0===t&&(t=!0),this._faceIconList&&this._faceIconList.length>0)for(;this._faceIconList.length>0;){var e=this._faceIconList.pop();e&&e.parent&&e.parent.removeChild(e),FaceIcon.returnFaceIcon(e)}if(this._itemIconList&&this._itemIconList.length>0)for(;this._itemIconList.length>0;){var n=this._itemIconList.pop();n&&n.parent&&n.parent.removeChild(n),this.returnItemIcon(n)}this.parent&&this.parent.removeChild(this),this._isShowing=!1,this.removeTicker(),t&&this.dispatchEventWith(WorldMessage.EVENT_SHOW_OVER),UILayer.instance.broadcastLayer.touchChildren=!1,UILayer.instance.broadcastLayer.touchEnabled=!1},e.prototype.onTxtLink=function(t){console.log("聊天 -- 点击 link 事件："+t.text),t.text==ChatMsg.LinkEvent_redpaper_rob&&this._cm&&this._cm.redPaperData&&RedPaper.receiveRedPaper(this._cm.redPaperData)},e}(egret.Sprite);__reflect(WorldChatMsgItem.prototype,"WorldChatMsgItem");var WorldMessage=function(){function t(){}return t.initWorldMessage=function(){this._worldChatMsgItem=new WorldChatMsgItem,this._noticeItem=new NoticeItem,this._worldChatMsgItem.addEventListener(t.EVENT_SHOW_OVER,this.onMsgShowOver,this),this._noticeItem.addEventListener(t.EVENT_SHOW_OVER,this.onMsgShowOver,this)},t.isWorldMessageClose=function(){var t=xself.getSetting();return SettingHandler.getSettingIndex(t,SettingHandler.EVENT_ALL_SETTING_SHOW_CHAT_OFF)},t.addMsg=function(t){this.isWorldMessageClose()||(null==this._worldChatMsgItem&&this.initWorldMessage(),t.isRedPaper()?this._redPaperMsgList.push(t):(this._chatMsgList.length>20&&this._chatMsgList.shift(),this._chatMsgList.push(t)),this.checkToShowNextMsg())},t.addSystemChat=function(t,e){void 0===e&&(e=-1),-1==e&&(e=Define.CHAT_TYPE_SYSTEM);var n=new ChatMsg(e,-1,"",t,0);this.addMsg(n)},t.addNoticeMsg=function(t){Tool.isNullText(t)||(null==this._noticeItem&&this.initWorldMessage(),this._noticeMsgList.push(t),this.checkToShowNextMsg(),ChatMsg.addChatMsg(new ChatMsg(Define.CHAT_TYPE_SYSTEM,-1,"",t,0),!1))},t.checkToShowNextMsg=function(){return this._isShowing?void 0:this._noticeMsgList&&this._noticeMsgList.length>0?void this.showNotice(this._noticeMsgList.shift()):void(0!=PanelManager.isCanShowMessage&&(this._redPaperMsgList&&this._redPaperMsgList.length>0?this.showWorldChatMsg(this._redPaperMsgList.shift()):this._chatMsgList&&this._chatMsgList.length>0&&this.showWorldChatMsg(this._chatMsgList.shift())))},t.showWorldChatMsg=function(t){this._isShowing=!0,this._worldChatMsgItem.show(t)},t.showNotice=function(t){this._isShowing=!0,this._noticeItem.show(t)},t.onMsgShowOver=function(t){var e=t.target;e&&e.parent&&e.parent.removeChild(e),this._isShowing=!1,this.checkToShowNextMsg()},t.hideWorldMsg=function(){this._isShowing&&this._worldChatMsgItem.isShowing&&this._worldChatMsgItem.hide()},t.addPromptMsg=function(t){PromptPanel.instance.addPromptMsg(t)},t.addPointMsg=function(t){},t.addTips=function(t,e,n){if(void 0===e&&(e=-1),void 0===n&&(n=!1),!Tool.isNullText(t)){var i=t.split("\n");if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=i[o];if(!Tool.isNullText(a)){var r=new TipsData;r.content=a,r.size=e,r.isDown=n,this._tipsMsgList.push(r),this.checkToShowNextTips()}}}},t.checkToShowNextTips=function(){if(this._tipsMsgList&&this._tipsMsgList.length>0)if(this._tipsShowList.length<=0){var t=this._tipsMsgList.shift();this.showTips(t)}else{var e=this._tipsShowList[this._tipsShowList.length-1];if(Math.abs(e.startY-e.y)>e.size+3*xhdRatio){t=this._tipsMsgList.shift();this.showTips(t)}}else 0==this._tipsShowList.length&&this.removeTipsTicker()},t.showTips=function(t){if(null!=t){var e=TipsItem.getItem();e.show(t),this._tipsShowList.push(e),this._isAddTipsTicker||(this._isAddTipsTicker=!0,nato.WorldTicker.instance.register(this.tipsLogic,this))}},t.tipsLogic=function(t){for(var e=0;e<this._tipsShowList.length;e++){var n=this._tipsShowList[e];n.logic(t),n.isShowing||(this._tipsShowList.splice(e,1),e--)}this.checkToShowNextTips()},t.removeTipsTicker=function(){this._isAddTipsTicker&&(this._isAddTipsTicker=!1,nato.WorldTicker.instance.unregister(this.tipsLogic,this))},t.clearAllTips=function(){for(var t=0;t<this._tipsShowList.length;t++)this._tipsShowList[t].hide();this._tipsShowList=[],this._tipsMsgList=[],this.removeTipsTicker()},t.clean=function(){this.clearAllTips(),this._noticeMsgList=[],this._chatMsgList=[],this._isShowing=!1,this._noticeItem&&(this._noticeItem.hide(!1),this._noticeItem=null),this._worldChatMsgItem&&(this._worldChatMsgItem.hide(!1),this._worldChatMsgItem=null),PointMessagePanel.clean(),PromptPanel.clean()},t.EVENT_SHOW_OVER="event_show_over",t._noticeMsgList=[],t._chatMsgList=[],t._redPaperMsgList=[],t._worldChatMsgItem=null,t._noticeItem=null,t._isShowing=!1,t._tipsMsgList=[],t._tipsShowList=[],t._isAddTipsTicker=!1,t}();__reflect(WorldMessage.prototype,"WorldMessage");var ChatUpItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_chatup,this.onBtnChatUp,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chatup)},e.prototype.onBtnChatUp=function(){this._data&&ChatMsg.openPersonalChat(this._data.player)},e.prototype.setData=function(t){this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._data?(this.img_new.visible=this._data.isNew,this.label_desc.textFlow=Tool.convertDescToTextFlow(this._data.getDesc())):(this.img_new.visible=!1,this.label_desc.text=""))},e}(ComponentBase);__reflect(ChatUpItem.prototype,"ChatUpItem");var ChatUpPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.setData=function(t){this._dataList=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._dataList&&0!=this._dataList.length)){for(var t=0;t<this._dataList.length;t++){var e=this._dataList[t],n=this.getItem();n.setData(e),this.container.add(n)}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new ChatUpItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ChatUpPanel.prototype,"ChatUpPanel");var AlertPanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._align="center",nato.attachSkin(e),e}return __extends(e,t),Object.defineProperty(e.prototype,"tag",{get:function(){return this._tag},set:function(t){this._tag=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"params",{set:function(t){this._params=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return!e._instanceList||e._instanceList.length<=0?null:e._instanceList[e._instanceList.length-1]},enumerable:!0,configurable:!0}),e.createAlertPanel=function(){e._instanceList||(e._instanceList=[]);var t=ObjectPool.getPool("AlertPanel").createObject();return e._instanceList.push(t),t},e.isTouchClose=function(t,n){if(null==e._instanceList||0==e._instanceList.length)return!1;var i=e._instanceList[0],o=i.btn_close;if(1==o.visible&&null!=o.parent){var a=o.parent.localToGlobal(o.x,o.y);if(Tool.rectIn(a.x,a.y,o.width,o.height,t,n))return!0}var r=i.btn_ok;if(1==r.visible&&null!=r.parent){a=r.parent.localToGlobal(r.x,r.y);if(Tool.rectIn(a.x,a.y,r.width,r.height,t,n))return!0}var s=i.parent.localToGlobal(i.x-i.anchorOffsetX,i.y-i.anchorOffsetY);return 0==Tool.rectIn(s.x,s.y,i.width,i.height,t,n)},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.closePanel,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOkTouch,this),ButtonUtils.addTouchEvent(this.btn_cancel,this.onBtnCancel,this),this.update(),egret.setTimeout((function(){guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL)&&GameWorld.setGuide(GameWorld.GUIDE_MERCENARY_HIRE)}),this,200)},e.prototype.onRemoveFromStage=function(n){t.prototype.onRemoveFromStage.call(this,n),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_cancel),this.btn_close.visible=!0,egret.Tween.removeTweens(this),ObjectPool.getPool("AlertPanel").returnObject(this);var i=e._instanceList.indexOf(this);i>=0&&e._instanceList.splice(i,1)},e.prototype.reset=function(){this._type=0,this._title="",this._content="",this._textFlow=null,this._cancelCallbackFunc=null,this._okCallbackFunc=null,this._closeCallbackFunc=null,this._checkBoxCallbackFunc=null,this._thisObj=null,this._align="center",this.btn_close.visible=!0,this._okBtnName=e.Default_ok_btn_name,this._cancelBtnName=e.Default_cancel_btn_name,this._tag=""},e.showPanel=function(t,e,n,i,o){void 0===n&&(n=!0),void 0===i&&(i=null),void 0===o&&(o=null),PopUpManager.addPopUp(t,PopUpManager.EffectType.SCALE_CENTER,n,e,i,o)},e.prototype.closePanel=function(){e.closeAlertPanel(this)},e.closeAlertPanel=function(t){null!=t._closeCallbackFunc&&null!=t._thisObj&&t._closeCallbackFunc.call(t._thisObj),t.reset(),PopUpManager.removePopUp(t)},e.closeAll=function(){for(;e._instanceList&&e._instanceList.length;){var t=e._instanceList.pop();ObjectPool.getPool("AlertPanel").returnObject(t),PopUpManager.removePopUp(t)}},e.prototype.onBtnOkTouch=function(){var t=!0;null!=this._okCallbackFunc&&(t=this._okCallbackFunc.call(this._thisObj,this._params)),null!=this._checkBoxCallbackFunc&&null!=this._thisObj&&this._checkBoxCallbackFunc.call(this._thisObj,this.checkBox_noNotify.selected),0!=t&&this.closePanel()},e.prototype.onBtnCancel=function(){null!=this._cancelCallbackFunc&&this._cancelCallbackFunc.call(this._thisObj,this._params),this.closePanel()},e.prototype.update=function(){this.label_title.textFlow=Tool.convertDescToTextFlow(this._title),this.label_content.textAlign=this._align,this._textFlow?this.label_content.textFlow=this._textFlow:this.label_content.text=this._content;var t=75*xhdRatio,n=45*xhdRatio;this.label_content.height=this.label_content.textHeight+5*xhdRatio,this.label_content.height<50*xhdRatio&&this._type!=e.TYPE_CHECKBOX?(this.label_content.height=50*xhdRatio,this.label_content.verticalAlign="middle"):this.label_content.verticalAlign="top";var i=this.label_content.height+12*xhdRatio;if(this.container.reset(!0),this.container.add(this.label_content,5*xhdRatio,7*xhdRatio),this._type==e.TYPE_CHECKBOX?(this.checkBox_noNotify.selected=!1,this.container.add(this.checkBox_noNotify,-1,i),i+=this.checkBox_noNotify.height+3*xhdRatio):this.checkBox_noNotify.parent&&this.checkBox_noNotify.parent.removeChild(this.checkBox_noNotify),this.container.updateAutoSize(i,250*xhdRatio),this.bg2.height=this.container.height+5*xhdRatio,this._type==e.TYPE_TIPS)this.btn_ok.visible=!1,this.btn_cancel.visible=!1,this.height=this.bg2.y+this.bg2.height+10*xhdRatio;else if(this._type==e.TYPE_NOTIFY){if(this.btn_ok.visible=!0,this.btn_cancel.visible=!1,this._okBtnName.length>4)(o=this.btn_ok.labelDisplay).size=TextFieldUtils.getSizeByMaxWidth(this._okBtnName,60*xhdRatio,o.fontFamily);else this.btn_ok.labelDisplay.size=15*xhdRatio;this.btn_ok.label=this._okBtnName,this.btn_ok.x=Math.floor((this.width-t)/2),this.btn_ok.y=this.bg2.y+this.bg2.height+2*xhdRatio,this.height=this.btn_ok.y+n+2*xhdRatio}else if(this._type==e.TYPE_SELECT||this._type==e.TYPE_CHECKBOX){var o;if(this.btn_ok.visible=!0,this.btn_cancel.visible=!0,this._okBtnName.length>4)(o=this.btn_ok.labelDisplay).size=TextFieldUtils.getSizeByMaxWidth(this._okBtnName,60*xhdRatio,o.fontFamily);else this.btn_ok.labelDisplay.size=15*xhdRatio;if(this.btn_ok.label=this._okBtnName,this._cancelBtnName.length>4)(o=this.btn_cancel.labelDisplay).size=TextFieldUtils.getSizeByMaxWidth(this._cancelBtnName,60*xhdRatio,o.fontFamily);else this.btn_cancel.labelDisplay.size=15*xhdRatio;this.btn_cancel.label=this._cancelBtnName;var a=(this.width-2*t)/3;this.btn_ok.x=Math.floor(a),this.btn_ok.y=this.bg2.y+this.bg2.height+2*xhdRatio,this.btn_cancel.x=2*a+t,this.btn_cancel.y=this.btn_ok.y,this.height=this.btn_ok.y+n+2*xhdRatio}},e.alert=function(t,n,i,o,a,r){void 0===a&&(a=null),void 0===r&&(r=PopUpManager.CloseType.OUTSIDE);var s=e.createAlertPanel();s.reset(),s._title=t,s._okCallbackFunc=i,s._cancelCallbackFunc=a,s._thisObj=o,s._type=e.TYPE_SELECT;var l=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(n));return s._textFlow=l,e.showPanel(s,r),s},e.alertCommon=function(t,n){void 0===n&&(n=PopUpManager.CloseType.OUTSIDE);var i=Tool.convertLastLinefeed(t);e.alertNotify(GameText.getText(GameText.TI_WARM_SHOW),i,null,null,n)},e.errorMessage=function(t){e.alertNotify(GameText.getText(GameText.TI_ERROR),t)},e.warnMessage=function(t){e.alertNotify(GameText.getText(GameText.TI_WARN),t)},e.alertTextFlow=function(t,n,i,o,a,r){void 0===r&&(r=null);var s=e.createAlertPanel();s.reset(),s._title=t,s._textFlow=n,s._okCallbackFunc=i,s._cancelCallbackFunc=o,s._thisObj=a,s._type=e.TYPE_SELECT,e.showPanel(s,PopUpManager.CloseType.OUTSIDE,!0,r,a)},e.alertTips=function(t,n,i,o,a){void 0===i&&(i="center"),void 0===o&&(o=null),void 0===a&&(a=null);var r=e.createAlertPanel(),s=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(n));r.reset(),r._title=t,r._textFlow=s,r._type=e.TYPE_TIPS,r._align=i,r._closeCallbackFunc=o,r._thisObj=a,e.showPanel(r,PopUpManager.CloseType.ALL)},e.alertTipsCommon=function(t,n,i){void 0===n&&(n=!0),void 0===i&&(i="center");var o=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(t)),a=e.createAlertPanel();a.reset(),a._title=GameText.getText(GameText.TI_WARM_SHOW),a._textFlow=o,a._type=e.TYPE_TIPS,a._align=i,e.showPanel(a,PopUpManager.CloseType.ALL,n)},e.alertTipsTextFlow=function(t,n,i,o,a,r){void 0===i&&(i="center"),void 0===o&&(o=null),void 0===a&&(a=null),void 0===r&&(r=PopUpManager.CloseType.ALL);var s=e.createAlertPanel();s.reset(),s._title=t,s._textFlow=n,s._type=e.TYPE_TIPS,s._align=i,s._closeCallbackFunc=o,s._thisObj=a,e.showPanel(s,r)},e.alertNotify=function(t,n,i,o,a,r){void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=PopUpManager.CloseType.OUTSIDE),void 0===r&&(r=!0);var s=e.createAlertPanel();s.reset(),s._title=t,s._okCallbackFunc=i,s._thisObj=o,s._type=e.TYPE_NOTIFY,s.btn_close.visible=r;var l=Tool.convertLastLinefeed(n),_=Tool.convertDescToTextFlow(l);return s._textFlow=_,e.showPanel(s,a),s},e.alertNotifyTextFlow=function(t,n,i,o,a,r){void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null);var s=e.createAlertPanel();return s.reset(),s._title=t,s._textFlow=n,s._okCallbackFunc=i,s._closeCallbackFunc=o,s._thisObj=a,s._type=e.TYPE_NOTIFY,e.showPanel(s,PopUpManager.CloseType.OUTSIDE,!1,r),s},e.alertMaterialLess=function(t,n,i){void 0===i&&(i=0);var o=e.createAlertPanel();return o.reset(),o._title=GameText.getText(GameText.TI_WARM_SHOW),o._textFlow=Tool.convertDescToTextFlow(t),o._cancelCallbackFunc=function(){ItemGet.openItemGet(n,i)},o._thisObj=this,o._type=e.TYPE_SELECT,o._cancelBtnName=ItemGet.getAlertBtnName(n),e.showPanel(o,PopUpManager.CloseType.OUTSIDE),o},e.alertMaterialLessByItem=function(t,n){var i=e.createAlertPanel();return i.reset(),i._title=GameText.getText(GameText.TI_WARM_SHOW),i._textFlow=Tool.convertDescToTextFlow(t),i._cancelCallbackFunc=function(){ItemGet.openMaterialLessByItem(n)},i._thisObj=this,i._type=e.TYPE_SELECT,i._cancelBtnName=ItemGet.getAlertBtnName(ItemGet.getItemType1(n)),e.showPanel(i,PopUpManager.CloseType.OUTSIDE),i},e.alertRepair=function(t){var n=e.createAlertPanel();return n.reset(),n._title=GameText.getText(GameText.TI_WARM_SHOW),n._textFlow=Tool.convertDescToTextFlow(t),n._okBtnName="前往修理",n._okCallbackFunc=function(){TodayEvent.doRepair()},n._cancelBtnName="使用修理券",n._cancelCallbackFunc=function(){xself&&xself.bag&&xself.bag.useRepaireItem()},n._thisObj=this,n._type=e.TYPE_SELECT,e.showPanel(n,PopUpManager.CloseType.OUTSIDE),n},e.alertWithCheckBox=function(t,n,i,o,a,r,s,l){void 0===l&&(l=PopUpManager.CloseType.OUTSIDE);var _=e.createAlertPanel();_.reset(),_._title=t,_._okCallbackFunc=o,_._cancelCallbackFunc=a,_._checkBoxCallbackFunc=r,_._thisObj=s,_._type=e.TYPE_CHECKBOX;var h=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(n));return _._textFlow=h,e.showPanel(_,l),_},e.alertVIPUPgrade=function(t){var n=e.createAlertPanel();n.reset(),n._title=GameText.getText(GameText.TI_WARM_SHOW),n._okCallbackFunc=function(){PanelManager.openVIPScene()},n._thisObj=this,n._type=e.TYPE_SELECT,n._okBtnName="提升VIP";var i=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(t));return n._textFlow=i,e.showPanel(n,PopUpManager.CloseType.NONE),n},e.alertItem=function(t,e){if(void 0===e&&(e="center"),null!=t){var n=t.getNameInfo();this.alertTips(n,t.getDesc(xself),e)}},e.TYPE_TIPS=0,e.TYPE_NOTIFY=1,e.TYPE_SELECT=2,e.TYPE_CHECKBOX=3,e.AlignType_Left="left",e.AlignType_Center="center",e.AlignType_Right="right",e.Tag_loginout="Tag_loginout",e.Default_ok_btn_name="确定",e.Default_cancel_btn_name="取消",e}(WindowPanelBase);__reflect(AlertPanel.prototype,"AlertPanel");var BaseObj=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);__reflect(BaseObj.prototype,"BaseObj");var CheckBoxGroup=function(t){function e(){var e=t.call(this)||this;return e._select=0,e._btnList=[],e}return __extends(e,t),e.prototype.addCheckBtn=function(t){null!=t&&(t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),this._btnList.push(t))},e.prototype.setCheckBtnList=function(t){if(null!=t&&0!=t.length){this._btnList=t;for(var e=0;e<this._btnList.length;e++){var n=this._btnList[e];n&&n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this)}}},e.prototype.onBtnTouch=function(t){var e=t.target,n=this._btnList.indexOf(e);-1!=n&&n!=this._select&&this.onSelect(n)},e.prototype.onSelect=function(t){this._select=t,this.updateSelect(),this.dispatchEventWith(egret.Event.CHANGE)},e.prototype.updateSelect=function(){for(var t=0;t<this._btnList.length;t++){var e=this._btnList[t];e&&(t==this._select?(e.selected=!0,e.touchEnabled=!1):(e.selected=!1,e.touchEnabled=!0))}},e.prototype.reset=function(){if(null!=this._btnList&&0!=this._btnList.length){for(;this._btnList.length>0;){var t=this._btnList.pop();t&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this)}this._select=0}},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.updateSelect()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectBtn",{get:function(){return this._btnList[this._select]},enumerable:!0,configurable:!0}),e}(egret.EventDispatcher);__reflect(CheckBoxGroup.prototype,"CheckBoxGroup");var CheckButton=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.update=function(){this.init&&(this.select_sign.visible=this._select)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.update()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CheckButton.prototype,"CheckButton");var CommonBtn5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);__reflect(CommonBtn5.prototype,"CommonBtn5");var CommonBtn6=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);__reflect(CommonBtn6.prototype,"CommonBtn6");var CommonBtnOrder=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);__reflect(CommonBtnOrder.prototype,"CommonBtnOrder");var CommonFormPanel=function(t){function e(){var e=t.call(this)||this;return e._subInfo="",e._radioIndex=1,e._radioDefaultSelect=0,e._inputCount=3,e._defaultInputLen=8,e}return __extends(e,t),Object.defineProperty(e.prototype,"defaultArr",{set:function(t){this._defaultArr=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"okCallBack",{set:function(t){this._okCallBack=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelCallBack",{set:function(t){this._cancelCallBack=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"okParams",{set:function(t){this._okParams=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelParams",{set:function(t){this._cancelParams=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thisobj",{set:function(t){this._thisobj=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return PanelManager.getPanel(e)},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel(),ButtonUtils.addTouchEvent(this.btn_ok,this.onOK,this),ButtonUtils.addTouchEvent(this.btn_cancel,this.onCancel,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_cancel),this._radioLabelArr=null,this._radioGroup=null,this._radioBtnArr){for(;this._radioBtnArr.length;){var n=this._radioBtnArr.pop();n.selected=!1,Tool.removeObjSafe(n),ObjectPool.getPool("RadioButton").returnObject(n)}this._radioBtnArr=null}for(var i=0;i<this._inputCount;i++)this["input_content_"+i].removeEventListener(egret.TextEvent.CHANGE,this.inputContentChange,this);this._radioDefaultSelect=0,this._okCallBack=null,this._cancelCallBack=null,this._okParams=null,this._cancelParams=null,this._maxCharsArr=null,this._subInfo=""},e.prototype.initPanel=function(){if(this._inputDataArr){var t=2*xhdRatio,n=20*xhdRatio;this.label_title.text=this._title;for(var i=this._inputDataArr.length,o=this.group_0.y,a=0;3>a;a++)if(i>a){this["label_title_"+a].text=this._inputDataArr[a][0],this._inputDataArr[a].length>1?this["input_content_"+a].text=this._inputDataArr[a][1]+"":this["input_content_"+a].text="",this._inputDataArr[a].length>2?this["input_content_"+a].maxChars=this._inputDataArr[a][2]:this["input_content_"+a].maxChars=this._defaultInputLen;var r=!0;this._inputDataArr[a].length>3?(this["input_content_"+a].restrict=this._inputDataArr[a][3],this._inputDataArr[a][3]!=e.NUMBER&&(r=!1)):this["input_content_"+a].restrict=e.NUMBER,r&&this["input_content_"+a].addEventListener(egret.TextEvent.CHANGE,this.inputContentChange,this),this["group_input_"+a].y=this["label_title_"+a].y+this["label_title_"+a].height+t,a>0&&(this["group_"+a].y=o),o+=this["group_"+a].height+n,this._radioLabelArr&&this._radioLabelArr.length>0&&a==this._radioIndex-1&&(o=this.createRadioBtn(o,this["group_"+a].x)),this.addChild(this["group_"+a])}else this["label_title_"+a].text="",Tool.removeObjSafe(this["group_"+a]);""!=this._subInfo?(this.label_sub.y=o,this.addChild(this.label_sub),this.label_sub.textFlow=Tool.convertDescToTextFlow(this._subInfo),o+=this.label_sub.textHeight+n):Tool.removeObjSafe(this.label_sub),this["group_"+(i-1)]&&(this.group_btns.y=o)}},e.prototype.createRadioBtn=function(t,e){if(this._radioLabelArr)for(var n=0,i=this._radioLabelArr.length;i>n;n++){this._radioGroup||(this._radioGroup=new eui.RadioButtonGroup);var o=ObjectPool.getPool("RadioButton").createObject();nato.attachSkin(o),o.label=this._radioLabelArr[n],o.value=this._radioValueArr[n],this.addChild(o),o.x=e,o.y=t-10*xhdRatio,t+=o.height,this._radioBtnArr||(this._radioBtnArr=[]),o.group=this._radioGroup,n==this._radioDefaultSelect&&(o.selected=!0),this._radioBtnArr.push(o)}return t},e.prototype.onOK=function(){var t=-1;if(this._radioGroup&&(t=this._radioGroup.selectedValue),this._okCallBack){var e=this._inputDataArr.length,n=[];if(this._inputDataArr&&e>0)for(var i=0;e>i;i++)n.push(this["input_content_"+i].text);this._okCallBack.call(this._thisobj,n,this._okParams,t)}this.onCancel()},e.prototype.inputContentChange=function(t){var e=t.currentTarget;""!=e.text&&(e.text=parseInt(e.text)+"")},e.prototype.onCancel=function(){PanelManager.closeScene()},e.handSell=function(t,n,i,o){e.instance._title=GameText.STR_TYPE_GOODS_HAND_SELL,e.instance._inputDataArr=[[GameText.getMoneyText(ModelConst.MONEY1)+Tool.manageString(GameText.STR_TYPE_GOODS_HAND_SELL_PRICE,Tool.getMoneyText(2e5,Tool.DIVIDE_TEN_THOUSAND)),"",Define.MAX_OTHER_PRICE_MAX],[GameText.getMoneyText(ModelConst.MONEY3)+Tool.manageString(GameText.STR_TYPE_GOODS_HAND_SELL_PRICE,Tool.getMoneyText(1e7,Tool.DIVIDE_TEN_THOUSAND)),"",Define.MAX_OTHER_PRICE_MAX]],t.quantity>1&&e.instance._inputDataArr.push([Tool.manageString(GameText.STR_TYPE_GOODS_HAND_SELL_NUM,t.quantity+""),1,Define.MAX_OTHER_PRICE_MAX]),e.instance._thisobj=n,e.instance._okCallBack=i,e.instance._okParams=o,PanelManager.openScene(e.instance)},e.publicOrder=function(t,n){e.instance._title=GameText.STR_TYPE_GOODS_PURCHASE,e.instance._inputDataArr=[[GameText.getMoneyText(ModelConst.MONEY1)+":","",Define.MAX_OTHER_PRICE_MAX],[GameText.getMoneyText(ModelConst.MONEY3)+":","",Define.MAX_OTHER_PRICE_MAX],[GameText.STR_TYPE_GOODS_PURCHASE_NUM,1,3]],e.instance._thisobj=t,e.instance._okCallBack=n,PanelManager.openScene(e.instance)},e.supply=function(t,n,i,o){e.instance._title=GameText.STR_TYPE_GOODS_PROVIDE,e.instance._inputDataArr=[[GameText.STR_TYPE_GOODS_PROVIDE_SEAR_NAME,t,4]],e.instance._thisobj=n,e.instance._okCallBack=i,e.instance._okParams=o,PanelManager.openScene(e.instance)},e.sellForm=function(t,n,i,o,a,r,s,l,_){e.instance._radioLabelArr=[GameText.STR_MONEY1,GameText.STR_MONEY3],e.instance._radioValueArr=[ModelConst.MONEY1,ModelConst.MONEY3],e.instance._radioIndex=1,e.instance._title=GameText.STR_TYPE_PLAYER_SHOP_SELL,e.instance._inputDataArr=[[Tool.manageStringList(GameText.STR_TYPE_PLAYER_SHOP_SELL_PRICE,[Tool.getMoneyText(n,Tool.DIVIDE_TEN_THOUSAND),Tool.getMoneyText(i,Tool.DIVIDE_TEN_THOUSAND)]),t,Define.MAX_OTHER_PRICE_MAX]],o>1&&e.instance._inputDataArr.push([Tool.manageString(GameText.STR_TYPE_PLAYER_SHOP_SELL_NUM,o+""),o]);var h="";a&&(h=Tool.manageString(GameText2.STR_ENCHANT_SHOP_ONE_NEED,r+"")),e.instance._subInfo=h,e.instance._thisobj=s,e.instance._okCallBack=l,e.instance._okParams=_,PanelManager.openScene(e.instance)},e.sellPriceForm=function(t,n,i,o,a,r,s){e.instance._radioLabelArr=[GameText.STR_MONEY1,GameText.STR_MONEY3],e.instance._radioValueArr=[ModelConst.MONEY1,ModelConst.MONEY3],e.instance._radioIndex=1,e.instance._radioDefaultSelect=t,e.instance._title=GameText.STR_TYPE_PLAYER_SHOP_PRICE,e.instance._inputDataArr=[[Tool.manageStringList(GameText.STR_TYPE_PLAYER_SHOP_SELL_PRICE,[Tool.getMoneyText(i,Tool.DIVIDE_TEN_THOUSAND),Tool.getMoneyText(o,Tool.DIVIDE_TEN_THOUSAND)]),n,Define.MAX_OTHER_PRICE_MAX]],e.instance._thisobj=a,e.instance._okCallBack=r,e.instance._okParams=s,PanelManager.openScene(e.instance)},e.sellName=function(t,n,i){e.instance._title=GameText.STR_TYPE_PLAYER_SHOP_NAME,e.instance._inputDataArr=[[GameText.STR_TYPE_PLAYER_SHOP_NAME_ENTER,t,Define.MAX_SELL_NAME,e.ANY]],e.instance._thisobj=n,e.instance._okCallBack=i,e.instance._maxCharsArr=[],PanelManager.openScene(e.instance)},e.createPlayerShopBuyForm=function(t,n,i,o){e.instance._title=GameText.STR_TYPE_PLAYER_SHOP_BUY,e.instance._inputDataArr=[[Tool.manageStringList(GameText.STR_TYPE_PLAYER_SHOP_BUY_NAME,[t,n]),n,2]],e.instance._thisobj=i,e.instance._okCallBack=o,PanelManager.openScene(e.instance)},e.masterAccept=function(t,n){e.instance._title=GameText.STR_MASTER_ACCEPT,e.instance._inputDataArr=[[GameText.STR_MASTER_ACCEPT_MANIFESTO,"",Define.MAX_MASTER_MANIFESTO,e.ANY]],e.instance._thisobj=t,e.instance._okCallBack=n,PanelManager.openScene(e.instance)},e.createFriendsRemards=function(t,n,i){e.instance._title=GameText2.STR_FRIEND_REMARDS,e.instance._inputDataArr=[[GameText2.STR_FRIEND_REMARDS_INFO,"",Define.MAX_FRIEND_REMARDS,e.ANY]],e.instance._subInfo=GameText2.STR_CHANGE_REMARDS_INFO,e.instance._okParams=i,e.instance._thisobj=t,e.instance._okCallBack=n,PanelManager.openScene(e.instance)},e.createPutInCountryStore=function(t,n,i){e.instance._title=GameText.STR_TYPE_COUNTRY_STORE_PUT,e.instance._inputDataArr=[[GameText.STR_TYPE_MAIL_ATTACH_ITEM_NUM,i.toString()],[GameText.STR_TYPE_COUNTRY_STORE_CONVERT,"1"]],e.instance._thisobj=n,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.createUnion=function(t,n){e.instance._title=GameText.STR_TYPE_CREATE_UNION,e.instance._inputDataArr=[[GameText.STR_TYPE_CREATE_UNION_NAME,"",20,e.ANY]],e.instance._thisobj=n,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.ChangeTax=function(t,n){e.instance._title=GameText.STR_ADJUST_TAX_RATE,e.instance._inputDataArr=[[GameText.STR_TAX_RATE,"",20,e.NUMBER]],e.instance._thisobj=n,e.instance._okCallBack=t,e.instance._subInfo=GameText.STR_COUNTRY_PRICE_ADUST_INFO,PanelManager.openScene(e.instance)},e.changeCountryFee=function(t,n){e.instance._title=GameText.STR_TYPE_COUNTRY_ENTER_RATE,e.instance._inputDataArr=[[Tool.manageStringList(GameText.STR_TYPE_COUNTRY_ENTER_RATE_CON,["黄金",100]),"",20,e.NUMBER],[Tool.manageStringList(GameText.STR_TYPE_COUNTRY_ENTER_RATE_CON,["铜币",1e5]),"",20,e.NUMBER]],e.instance._thisobj=n,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.countryArmyValue=function(t,n){e.instance._title=GameText.STR_COUNTRY_ADD_ARMY,e.instance._inputDataArr=[[GameText.STR_PLAYER_CHANGE_JOB_TITLE,"",20,e.ANY]],e.instance._thisobj=n,e.instance._okCallBack=t,e.instance._subInfo=GameText.STR_COUNTRY_ADDARMY_USELAND,PanelManager.openScene(e.instance)},e.countryProsperity=function(t,n){e.instance._title=GameText.STR_COUNTRY_BOOK_USE,e.instance._inputDataArr=[[GameText.STR_KING_COMMAND_COUNT_INFO,"",20,e.NUMBER]],e.instance._thisobj=n,e.instance._okCallBack=t,e.instance._subInfo=GameText.STR_KING_COMMAND_COUNT_EXPLAIN,PanelManager.openScene(e.instance)},e.createWarDeclare=function(t,n){e.instance._title=GameText.STR_TYPE_WAR_DECLARE,e.instance._inputDataArr=[[GameText.STR_MONEY1,"0",12],[GameText.STR_MONEY3,"0",12]],e.instance._subInfo=GameText.STR_TYPE_WAR_DECLARE_INFO1+"\n\n"+GameText.STR_TYPE_WAR_DECLARE_INFO2,e.instance._thisobj=n,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.countryKing=function(t,n){e.instance._title=GameText.STR_COUNTRY_BECOME_KILL,e.instance._inputDataArr=[[GameText.STR_PLAYER_CHANGE_JOB_TITLE,"",20,e.ANY]],e.instance._thisobj=n,e.instance._okCallBack=t,e.instance._subInfo=GameText.STR_COUNTRY_BECOME_KING,PanelManager.openScene(e.instance)},e.combinMulti=function(t,n,i){e.instance._title=GameText.STR_COMBIN_MULTI,e.instance._inputDataArr=[[Tool.manageString(GameText.STR_COMBIN_MULTI_INPUT,n+""),"",3,e.NUMBER]],e.instance._thisobj=i,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.actorBuySearch=function(t,n){e.instance._radioLabelArr=["ID",GameText.STR_NAME],e.instance._radioValueArr=[ActorBuyHandler.ACTOR_SELL_FIND_TYPE_ID,ActorBuyHandler.ACTOR_SELL_FIND_TYPE_NAME],e.instance._radioIndex=1,e.instance._radioDefaultSelect=0,e.instance._title=GameText.STR_TYPE_ACTOR_SELL_SEARCH,e.instance._inputDataArr=[[GameText.STR_TYPE_ACTOR_SELL_SEARCH_NAME,"",8,e.ANY]],e.instance._thisobj=n,e.instance._okCallBack=t,PanelManager.openScene(e.instance)},e.NUMBER="0-9",e.ANY=null,e}(ComponentBase);__reflect(CommonFormPanel.prototype,"CommonFormPanel");var FilterMenuPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._isCloseWhileClick=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._itemList&&(this._itemList=[this.btn1,this.btn2,this.btn3],this.removeChild(this.btn1),this.removeChild(this.btn2),this.removeChild(this.btn3)),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.reset()},e.prototype.onClose=function(){PanelManager.closeFilterMenuPanel()},e.prototype.onBtnTouch=function(t){var e=t.target;if(null!=e){var n=this;ButtonUtils.buttonTweenEffect(e,(function(){var t=n._btnList.indexOf(e),i=n._menuList[t];null!=i&&null!=n._callbackFunc&&null!=n._thisObj&&(null!=i.params&&null!=i.params2?n._callbackFunc.call(n._thisObj,i.action,i.params,i.params2):null!=i.params?n._callbackFunc.call(n._thisObj,i.action,i.params):n._callbackFunc.call(n._thisObj,i.action)),n._isCloseWhileClick&&PanelManager.closeFilterMenuPanel()}),this)}},e.prototype.setData=function(t,e,n,i){void 0===i&&(i=!0),this._menuList=t,this._callbackFunc=e,this._thisObj=n,this._isCloseWhileClick=i},e.prototype.reset=function(){if(this._btnList&&this._btnList.length>0){for(var t=0;t<this._btnList.length;t++){var e=this._btnList[t];e&&e.parent&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),e.parent.removeChild(e))}this._btnList=null}this._index=0},e.prototype.update=function(){if(this.init&&(this.reset(),this._btnList=[],null!=this._menuList&&0!=this._menuList.length)){this._menuList.length>12&&(this._menuList.length=12);for(var t,e=0;e<this._menuList.length;e++){var n=this._menuList[e];if(null!=n){var i=n.menu;Tool.isNullText(i)||((t=this.getItem()).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),t.y=e*t.height+10*xhdRatio,t.labelDisplay.textFlow=Tool.convertDescToTextFlow(i),this.addChild(t),this._btnList.push(t))}}this.height=this._btnList.length*t.height+20*xhdRatio}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&((t=new eui.Button).skinName=xhd?"CommonBtn5HDSkin":"CommonBtn5SDSkin",this._itemList[this._index]=t),t.width=this.width-20*xhdRatio,t.horizontalCenter=0,t.height=35*xhdRatio,this._index++,t},e}(ComponentBase);__reflect(FilterMenuPanel.prototype,"FilterMenuPanel");var HScrollView=function(t){function e(){var e=t.call(this)||this;return e._totalWidth=0,e._standardWidth=0,e._standardHeight=0,e._isInitScroll=!1,e._isAddTouch=!1,e._touchStartX=0,e._touchShowX=0,e._oneMoveSign=!1,e._targetScrollEffect=!1,e._isTweening=!1,e._tweenGap=100,e._tweenNum=0,e._targetX=0,e._itemList=new Array,e._showRect=new egret.Rectangle,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._standardWidth=this.width,this._standardHeight=this.width,0==this._standardWidth||0==this._standardHeight||this._isInitScroll||(this._showRect.width=this._standardWidth,this._showRect.height=this._standardHeight,this.container.scrollRect=this._showRect),this.upBlackBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpTouch,this),this.downBlackBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDownTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.upBlackBg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpTouch,this),this.downBlackBg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDownTouch,this),egret.Tween.removeTweens(this),this.onTouchEnd(null),this._isTweening=!1},e.prototype.onUpTouch=function(t){if(!this._isTweening){var e=this._showRect.x-this._tweenGap;this.onTweenShowRect(e)}},e.prototype.onDownTouch=function(t){if(!this._isTweening){var e=this._showRect.x+this._tweenGap;this.onTweenShowRect(e)}},e.prototype.onTweenShowRect=function(t){void 0===t&&(t=-1),this._targetX=t,this._targetX<0?this._targetX=0:this._targetX>this._totalWidth-this._showRect.width&&(this._targetX=this._totalWidth-this._showRect.width);var e=this;this._tweenNum=this._showRect.x;var n=2*Math.floor(Math.abs(this._targetX-this._showRect.x));egret.Tween.get(this,{onChange:function(){e._showRect.x=e._tweenNum,e.updateShowRect()},onChangeObj:this}).to({_tweenNum:this._targetX},n).call((function(){egret.Tween.removeTweens(this),e._isTweening=!1,e._showRect.x=e._targetX,e.updateShowRect()}),this),this._isTweening=!0},Object.defineProperty(e.prototype,"tweenGap",{get:function(){return this._tweenGap},set:function(t){this._tweenGap=t},enumerable:!0,configurable:!0}),e.prototype.initScroll=function(t,e){this._isInitScroll=!0,this._standardWidth=t,this._standardHeight=e,this._showRect.width=this._standardWidth,this._showRect.height=this._standardHeight,this.container.scrollRect=this._showRect,this.width=t,this.width=e},e.prototype.add=function(t,e,n){if(void 0===e&&(e=-1),void 0===n&&(n=-1),t){if(t.y=n>=0?n:0,e>=0){t.x=e;var i=t.x+t.width;i>this._totalWidth&&(this._totalWidth=i)}else t.x=this._totalWidth,this._totalWidth+=t.width;this._itemList.push(t)}},e.prototype.remove=function(t){if(t){var e=this._itemList.indexOf(t);-1!=e&&(this._itemList.splice(e,1),this.container.removeChild(t),this._totalWidth-=t.width,this.update())}},e.prototype.reset=function(t){void 0===t&&(t=!1),this.container.removeChildren(),this._itemList.length=0,this._totalWidth=0,t&&(this._showRect.x=0),this.upBlackBg.visible=!1,this.downBlackBg.visible=!1},Object.defineProperty(e.prototype,"list",{get:function(){return this._itemList},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(void 0===t&&(t=!1),this.init&&this.stage){for(var e=0;e<this._itemList.length;e++)this.container.addChild(this._itemList[e]);this._showRect.width>0&&this._showRect.height>0&&(t?this._showRect.x=0:(this._showRect.x+this._showRect.width>this._totalWidth&&(this._showRect.x=this._totalWidth-this._showRect.width),this._showRect.x<0&&(this._showRect.x=0)),this.updateShowRect()),this._targetShowItem&&(this.updateToShowItem(this._targetShowItem,this._targetScrollEffect),this._targetShowItem=null),this._totalWidth>this._standardWidth?this._isAddTouch||(this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._isAddTouch=!0):this._isAddTouch&&(this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._isAddTouch=!1)}},e.prototype.updateShowRect=function(){this.upBlackBg.visible=!1,this.downBlackBg.visible=!1,this.container.scrollRect=this._showRect},e.prototype.updateAutoSize=function(t,e){var n=t;t>e&&(n=e),this.width=n,this.initScroll(this.width,this.height),this.update()},e.prototype.onTouchBegin=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._touchStartX=t.stageX,this._touchShowX=this._showRect.x,this._oneMoveSign=!0,this.container.touchChildren=!0},e.prototype.onTouchMove=function(t){var e=t.stageX-this._touchStartX;this._showRect.x=this._touchShowX-e,this._showRect.x<0?this._showRect.x=0:this._showRect.x>this._totalWidth-this._standardWidth&&(this._showRect.x=this._totalWidth-this._standardWidth),this.updateShowRect(),null!=this._scrollCallback&&this._oneMoveSign&&(this._oneMoveSign=!1,this._scrollCallback.call(this._scrollCallbackThisObj)),this.container.touchChildren=!1},e.prototype.onTouchEnd=function(t){this.stage&&(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._oneMoveSign=!1,this.container.touchChildren=!0)},e.prototype.setScrollCallback=function(t,e){this._scrollCallback=t,this._scrollCallbackThisObj=e},e.prototype.setItemToTop=function(t){t&&-1!=this._itemList.indexOf(t)&&t.parent&&t.parent.setChildIndex(t,t.parent.numChildren-1)},Object.defineProperty(e.prototype,"totalWidth",{get:function(){return this._totalWidth},enumerable:!0,configurable:!0}),e.prototype.updateToStart=function(){this._showRect.x=0,this.updateShowRect()},e.prototype.updateToRight=function(){this._showRect.x=this._totalWidth-this._showRect.width,this._showRect.x<0&&(this._showRect.x=0),this.updateShowRect()},e.prototype.updateToShowItem=function(t,e){if(void 0===e&&(e=!1),null!=t){if(!this.init)return this._targetShowItem=t,void(this._targetScrollEffect=e);if(-1!=this._itemList.indexOf(t)){var n,i=0;t.x>=this._showRect.x&&t.x+t.width<=this._showRect.x+this._showRect.width?n=!1:(n=!0,t.x<=this._showRect.x?0>(i=t.x-15*xhdRatio)&&(i=0):0>(i=t.x+t.width-this._showRect.width+15*xhdRatio)?i=0:this._showRect.x>this._totalWidth-this._showRect.width&&(i=this._totalWidth-this._showRect.width)),e?(i=t.x-15*xhdRatio,this._showRect.x>this._totalWidth-this._showRect.width&&(i=this._totalWidth-this._showRect.width),0>i&&(i=0),this._showRect.x!=i&&(this.moveNum=this._showRect.x,egret.Tween.get(this,{onChange:this.scrollEffect,onChangeObj:this}).to({moveNum:i},300,egret.Ease.circInOut))):n&&(this._showRect.x=i,this.updateShowRect())}}},e.prototype.scrollEffect=function(){var t=this;t._showRect.x=t.moveNum,t._showRect.x>t._totalWidth-t._showRect.width&&(t._showRect.x=t._totalWidth-t._showRect.width,egret.Tween.removeTweens(this)),t.updateShowRect()},e}(ComponentBase);__reflect(HScrollView.prototype,"HScrollView");var ImageNum=function(t){function e(){var e=t.call(this)||this;return e._num=0,e.numSpace=0,e.numOffsetX=0,e.numOffsetY=0,e}return __extends(e,t),e.create=function(t,e){void 0===e&&(e=-1);var n=ObjectPool.getPool("ImageNum").createObject();return n.setIndex=t,e>-1&&(n.title=e),n.addEvent(),n},e.prototype.addEvent=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this._num=parseInt(t+""),this.stage&&this.initImgs()},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.initImgs()},e.prototype.onRemoveFromStage=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.x=0,this.y=0,ObjectPool.getPool("ImageNum").returnObject(this),this.clearImg(),this.imgArr=null,this.numSpace=0,this.numOffsetX=0,this.numOffsetY=0,this._num=0,this.title=-1,this.setIndex=-1},e.prototype.initImgs=function(){if(this.setIndex>=0){this.imgArr?this.clearImg():this.imgArr=[];var t=void 0,e=void 0,n=0;this.title>=0&&(t=this.getImg(),e=nato.findTextureForSheet(this.title),t.texture=e,t.x=0,this.addChild(t),n=e.textureWidth),e=nato.findTextureForSheet(this.setIndex,0);for(var i=this._num>=1e5,o=(i?Math.floor(this._num/1e4):this._num)+"",a=o.length,r=0;a>r;r++){var s=parseInt(o.charAt(r));(t=this.getImg()).texture=nato.findTextureForSheet(this.setIndex,s),t.x=n+this.numOffsetX+(r>0?this.numSpace:0),n=t.x+t.texture.textureWidth,t.y=this.numOffsetY,this.addChild(t)}i&&(t=this.getImg(),e=nato.findTextureForSheet(3012),t.texture=e,t.x=n,this.addChild(t)),this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height}},e.prototype.getImg=function(){var t=ObjectPool.getPool("egret.Bitmap").createObject();return this.imgArr.push(t),t},e.prototype.clearImg=function(){if(this.imgArr){for(var t=0,e=this.imgArr.length;e>t;t++)this.imgArr[t].x=0,this.imgArr[t].y=0,Tool.removeObjSafe(this.imgArr[t]),ObjectPool.getPool("egret.Bitmap").returnObject(this.imgArr[t]);this.imgArr.length=0}},e}(egret.DisplayObjectContainer);__reflect(ImageNum.prototype,"ImageNum");var LoadingScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){if(null==this.roleSprite){var e=xself;e&&(this.roleSprite=GameSprite.cloneSprite(e.sprite))}this.roleSprite&&this.aniCtn.addChild(this.roleSprite),this.roleSprite.scaleX=this.roleSprite.scaleY=nato.mapRatio},e.prototype.updateJumpTips=function(t){this.jumpTips.textFlow=Tool.convertDescToTextFlow(t)},e}(eui.Component);__reflect(LoadingScene.prototype,"LoadingScene");var MenuActionData=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this.menu="",this.action=0,this.params=null,this.params2=null,this.menu=t,this.action=e,this.params=n,this.params2=i};__reflect(MenuActionData.prototype,"MenuActionData");var MoneyView=function(t){function e(){var e=t.call(this)||this;return e._money1=0,e._money2=0,e._money3=0,e._isDetailMoney1=!1,e._isDetailMoney2=!1,e._isDetailMoney3=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_money0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch1,this),this.label_money1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch2,this),this.label_money2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch3,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._watchMoney1&&(this._watchMoney1.unwatch(),this._watchMoney1=null),this._watchMoney2&&(this._watchMoney2.unwatch(),this._watchMoney2=null),this._watchMoney3&&(this._watchMoney3.unwatch(),this._watchMoney3=null),this.label_money0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch1,this),this.label_money1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch2,this),this.label_money2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch3,this),this._isDetailMoney1=!1,this._isDetailMoney2=!1,this._isDetailMoney3=!1},e.prototype.onLabelTouch1=function(t){this._isDetailMoney1=!this._isDetailMoney1,this.updateMoney1()},e.prototype.onLabelTouch2=function(t){this._isDetailMoney2=!this._isDetailMoney2,this.updateMoney2()},e.prototype.onLabelTouch3=function(t){this._isDetailMoney3=!this._isDetailMoney3,this.updateMoney3()},e.prototype.setData=function(t){this._player=t},e.prototype.update=function(){this.init&&(null==this._player&&(this._player=xself),this._watchMoney1&&this._watchMoney1.unwatch(),this._watchMoney2&&this._watchMoney2.unwatch(),this._watchMoney3&&this._watchMoney3.unwatch(),this._watchMoney1=eui.Watcher.watch(this._player,["money1"],this.watcherHander,this),this._watchMoney2=eui.Watcher.watch(this._player,["money2"],this.watcherHander,this),this._watchMoney3=eui.Watcher.watch(this._player,["money3"],this.watcherHander,this),this._player?this.watcherHander(null):(this.label_money0.text="0",this.label_money1.text="0",this.label_money2.text="0"))},e.prototype.watcherHander=function(t){this._player&&this.updateMoney(this._player.money1,this._player.money2,this._player.money3)},e.prototype.updateMoney=function(t,e,n){this._money1=t,this._money2=e,this._money3=n,this.updateMoney1(),this.updateMoney2(),this.updateMoney3()},e.prototype.updateMoney1=function(){var t;t=this._isDetailMoney1?""+this._money1:this._money1>1e8?Math.floor(this._money1/1e8)+"亿":this._money1>1e5?Math.floor(this._money1/1e4)+"万":""+this._money1,this.label_money0.text=t},e.prototype.updateMoney2=function(){var t;t=this._isDetailMoney2?""+this._money2:this._money2>1e8?Math.floor(this._money2/1e8)+"亿":this._money2>1e5?Math.floor(this._money2/1e4)+"万":""+this._money2,this.label_money1.text=t},e.prototype.updateMoney3=function(){var t;t=this._isDetailMoney3?""+this._money3:this._money3>1e8?Math.floor(this._money3/1e8)+"亿":this._money3>1e5?Math.floor(this._money3/1e4)+"万":""+this._money3,this.label_money2.text=t},e}(ComponentBase);__reflect(MoneyView.prototype,"MoneyView");var MoneyViewOther=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._value=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._type=0},e.prototype.setData=function(t,e){this._type=t,this._value=e},e.prototype.update=function(){this.init&&0!=this._type&&(this.label_money.text=this._value.toString(),this._type==e.MoneyType_integray?(this.label_type.text=GameText.STR_ATTR_INTEGRAL,this.img_icon.source="money_ji"+(xhd?"_hd":"_sd")):this._type==e.MoneyType_arena?(this.label_type.text=GameText.STR_ATTR_ARENA,this.img_icon.source="money_jing"+(xhd?"_hd":"_sd")):this._type==e.MoneyType_sky_arena&&(this.label_type.text=GameText.STR_SKY_ATTR_ARENA,this.img_icon.source="money_zhan"+(xhd?"_hd":"_sd")))},e.MoneyType_integray=1,e.MoneyType_arena=2,e.MoneyType_sky_arena=3,e}(ComponentBase);__reflect(MoneyViewOther.prototype,"MoneyViewOther");var NumberEditView=function(t){function e(){var e=t.call(this)||this;return e._value=1,e._maxValue=99,e._minValue=1,e._isTouching=!1,e._isStartTween=!1,e._isPlus=!1,e._isAddTicker=!1,e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_minus,this.onBtnMinus,this),ButtonUtils.addTouchEvent(this.btn_plus,this.onBtnPlus,this),this.input_count.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputTxtFocusOut,this),this.btn_plus.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPlusTouchBegin,this),this.btn_minus.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnMinusTouchBegin,this),this.checkMaxChars(),this.checkValue(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_minus),ButtonUtils.removeTouchEvent(this.btn_plus),this.input_count.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputTxtFocusOut,this),this.btn_plus.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnPlusTouchBegin,this),this.btn_minus.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnMinusTouchBegin,this)},e.prototype.onBtnMinus=function(){this._value>this._minValue&&(this._value--,this.onChange())},e.prototype.onBtnPlus=function(){this._value<this._maxValue&&(this._value++,this.onChange())},e.prototype.onInputTxtFocusOut=function(t){this._value=Number(this.input_count.text),this.checkValue(),this.onChange()},e.prototype.onBtnPlusTouchBegin=function(t){this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this._isTouching=!0,this._isPlus=!0,this._isStartTween=!1,this.startTicker()},e.prototype.onBtnMinusTouchBegin=function(t){this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this._isTouching=!0,this._isPlus=!1,this._isStartTween=!1,this.startTicker()},e.prototype.onStageTouchEnd=function(t){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this._isTouching=!1,this.stopTicker()},e.prototype.startTicker=function(){0==this._isAddTicker&&(this._isAddTicker=!0,nato.WorldTicker.instance.register(this.logic,this))},e.prototype.stopTicker=function(){this._isAddTicker&&(this._isAddTicker=!1,nato.WorldTicker.instance.unregister(this.logic,this)),this._isStartTween=!1},e.prototype.logic=function(t){this._isTouching?(this._logicCount+=t,0==this._isStartTween?this._logicCount>500&&(this._isStartTween=!0):this._logicCount>=50&&(this._logicCount=0,this._isPlus?this._value++:this._value--,this.checkValue(),this.onChange())):this.stopTicker()},e.prototype.onChange=function(){this.dispatchEventWith(egret.Event.CHANGE),this.update()},e.prototype.checkValue=function(){this._value<this._minValue?(this._value=this._minValue,this._isStartTween&&this.stopTicker()):this._value>this._maxValue&&(this._value=this._maxValue,this._isStartTween&&this.stopTicker())},e.prototype.checkMaxChars=function(){var t;t=this._maxValue>=1e3?4:this._maxValue>=100?3:2,this.input_count.maxChars=t},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minValue",{get:function(){return this._minValue},set:function(t){this._minValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxValue",{get:function(){return this._maxValue},set:function(t){this._maxValue=t},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this.input_count.text=this._value.toString())},e}(ComponentBase);__reflect(NumberEditView.prototype,"NumberEditView");var PlayerMenuPanel=function(t){function e(){var e=t.call(this)||this;return e._getListTimes=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),!SocietyHandler.friendList||SocietyHandler.updateFriendList?(this.visible=!1,SocietyHandler.doRelationFriendListMsg(this.getFriendListCallback,this)):this.initMenu(),ButtonUtils.addTouchEvent(this.btn_close,this.closePanel,this),this.label_name.text=this._model.getName(),this.label_id.text=this._model.getClientUid(!0)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),this._model=null,this._getListTimes=0},e.prototype.getFriendListCallback=function(t){if(SocietyHandler.friendList=[],t&&t.length>0&&Array.prototype.push.apply(SocietyHandler.friendList,t),!SocietyHandler.blackList||SocietyHandler.updateFriendList){setTimeout((function(t){SocietyHandler.doRelationBlackListMsg(t.getBlackListCallback,t)}),30,this)}else this.initMenu();SocietyHandler.updateFriendList=!1},e.prototype.getBlackListCallback=function(t){SocietyHandler.blackList=[],t&&t.length>0&&Array.prototype.push.apply(SocietyHandler.blackList,t),this.initMenu()},e.prototype.initMenu=function(){Menu.setData(this,this._model,this._type,!0),this.visible=!0},e.prototype.closePanel=function(){PanelManager.closeAroundCheckPlayerPanel()},Object.defineProperty(e.prototype,"data",{set:function(t){this._model=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{set:function(t){this._type=t},enumerable:!0,configurable:!0}),e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(WindowPanelBase);__reflect(PlayerMenuPanel.prototype,"PlayerMenuPanel");var ProgressGreenBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.ProgressBar);__reflect(ProgressGreenBar.prototype,"ProgressGreenBar");var ProgressRedBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.ProgressBar);__reflect(ProgressRedBar.prototype,"ProgressRedBar");var RadioButton=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.RadioButton);__reflect(RadioButton.prototype,"RadioButton");var RadioButtonComponent=function(t){function e(){var e=t.call(this)||this;return e.NORMAL="normal",e.SELECTED="selected",e._clickSameDispatchEvent=!1,e}return __extends(e,t),e.prototype.add=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=!0),void 0===i&&(i=!1),this._list=t?t.slice():null;var o=this._list;if(this._currentIndex=-1,this._clickSameDispatchEvent=i,o&&o.length>0){for(var a=0,r=o.length;r>a;a++)o[a].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);n&&o[0].addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFormStage,this),e>=0&&(this._currentIndex=e,this.selectItem(o[e]))}},e.prototype.clear=function(){var t=this._list;if(t&&t.length>0){t[0].hasEventListener(egret.Event.REMOVED_FROM_STAGE)&&t[0].removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFormStage,this);for(var e=0,n=t.length;n>e;e++)t[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this._list=null},e.prototype.onClick=function(t){var e=this._list.indexOf(t.currentTarget);if(e!=this._currentIndex){this._currentIndex=e;for(var n=0,i=this._list.length;i>n;n++)this._list[n]==t.currentTarget?this.select(this._list[n],!0):this.select(this._list[n],!1);this.dispatchEvent(new egret.Event(egret.Event.CHANGE))}else this._clickSameDispatchEvent&&this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},e.prototype.removeFormStage=function(t){this.clear()},e.prototype.select=function(t,e){t.currentState=e?this.SELECTED:this.NORMAL},e.prototype.selectItem=function(t){var e=this._list;if(e&&t&&-1!=e.indexOf(t))for(var n=0,i=e.length;i>n;n++)e[n]==t?this.select(e[n],!0):this.select(e[n],!1)},e.prototype.removeItem=function(t,e){void 0===e&&(e=!0);var n=this._list;if(n&&t){var i=n.indexOf(t);if(-1!=i){var o=n.splice(n.indexOf(t),1)[0];return e&&Tool.removeObjSafe(t),t.hasEventListener(egret.Event.REMOVED_FROM_STAGE)&&(t.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFormStage,this),n.length>0&&n[0].addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFormStage,this)),t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),i==this._currentIndex&&(this._currentIndex=-1),o}}return null},e.prototype.getCurentSelectItem=function(){return this._list&&this._list.length>0&&this._currentIndex>=0?this._list[this._currentIndex]:null},e.prototype.getCurrentIndex=function(){return this._currentIndex},e}(egret.EventDispatcher);__reflect(RadioButtonComponent.prototype,"RadioButtonComponent");var ScrollView=function(t){function e(){var e=t.call(this)||this;return e._totalHeight=0,e._standardWidth=0,e._standardHeight=0,e._isInitScroll=!1,e._isAddTouch=!1,e._touchStartY=0,e._touchShowY=0,e._oneMoveSign=!1,e._targetScrollEffect=!1,e._itemList=new Array,e._showRect=new egret.Rectangle,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._standardWidth=this.width,this._standardHeight=this.height,0==this._standardWidth||0==this._standardHeight||this._isInitScroll||(this._showRect.width=this._standardWidth,this._showRect.height=this._standardHeight,this.container.scrollRect=this._showRect),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),egret.Tween.removeTweens(this),this.onTouchEnd(null)},e.prototype.initScroll=function(t,e){this._isInitScroll=!0,this._standardWidth=t,this._standardHeight=e,this._showRect.width=this._standardWidth,this._showRect.height=this._standardHeight,this.container.scrollRect=this._showRect,this.width=t,this.height=e},e.prototype.add=function(t,e,n){if(void 0===e&&(e=-1),void 0===n&&(n=-1),t){if(t.x=e>=0?e:0,n>=0){t.y=n;var i=t.y+t.height;i>this._totalHeight&&(this._totalHeight=i)}else t.y=this._totalHeight,this._totalHeight+=t.height;this._itemList.push(t)}},e.prototype.remove=function(t){if(t){var e=this._itemList.indexOf(t);-1!=e&&(this._itemList.splice(e,1),this.container.removeChild(t),this._totalHeight-=t.height,this.update())}},e.prototype.reset=function(t){void 0===t&&(t=!1),this.container.removeChildren(),this._itemList.length=0,this._totalHeight=0,t&&(this._showRect.y=0),this.upBlackBg.visible=!1,this.downBlackBg.visible=!1},Object.defineProperty(e.prototype,"list",{get:function(){return this._itemList},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(void 0===t&&(t=!1),this.init&&this.stage){for(var e=0;e<this._itemList.length;e++)this.container.addChild(this._itemList[e]);this._showRect.width>0&&this._showRect.height>0&&(t?this._showRect.y=0:(this._showRect.y+this._showRect.height>this._totalHeight&&(this._showRect.y=this._totalHeight-this._showRect.height),this._showRect.y<0&&(this._showRect.y=0)),this.updateShowRect()),this._targetShowItem&&(this.updateToShowItem(this._targetShowItem,this._targetScrollEffect),this._targetShowItem=null),this._totalHeight>this._standardHeight?this._isAddTouch||(this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._isAddTouch=!0):this._isAddTouch&&(this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._isAddTouch=!1)}},e.prototype.updateShowRect=function(){this._showRect.y>0?this.upBlackBg.visible=!0:this.upBlackBg.visible=!1,this._totalHeight-(this._showRect.y+this._showRect.height)>0?this.downBlackBg.visible=!0:this.downBlackBg.visible=!1,this.container.scrollRect=this._showRect},e.prototype.updateAutoSize=function(t,e){var n=t;t>e&&(n=e),this.height=n,this.initScroll(this.width,this.height),this.update()},e.prototype.onTouchBegin=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._touchStartY=t.stageY,this._touchShowY=this._showRect.y,this._oneMoveSign=!0,this.container.touchChildren=!0},e.prototype.onTouchMove=function(t){var e=t.stageY-this._touchStartY;this._showRect.y=this._touchShowY-e,this._showRect.y<0?this._showRect.y=0:this._showRect.y>this._totalHeight-this._standardHeight&&(this._showRect.y=this._totalHeight-this._standardHeight),this.updateShowRect(),null!=this._scrollCallback&&this._oneMoveSign&&(this._oneMoveSign=!1,this._scrollCallback.call(this._scrollCallbackThisObj)),this.container.touchChildren=!1},e.prototype.onTouchEnd=function(t){this.stage&&(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._oneMoveSign=!1,this.container.touchChildren=!0)},e.prototype.setScrollCallback=function(t,e){this._scrollCallback=t,this._scrollCallbackThisObj=e},e.prototype.setItemToTop=function(t){t&&-1!=this._itemList.indexOf(t)&&t.parent&&t.parent.setChildIndex(t,t.parent.numChildren-1)},Object.defineProperty(e.prototype,"totalHeight",{get:function(){return this._totalHeight},enumerable:!0,configurable:!0}),e.prototype.updateToTop=function(){this._showRect.y=0,this.updateShowRect()},e.prototype.updateToBottom=function(){this._showRect.y=this._totalHeight-this._showRect.height,this._showRect.y<0&&(this._showRect.y=0),this.updateShowRect()},e.prototype.updateToShowItem=function(t,e){if(void 0===e&&(e=!1),null!=t){if(!this.init)return this._targetShowItem=t,void(this._targetScrollEffect=e);if(-1!=this._itemList.indexOf(t)){var n,i=0;t.y>=this._showRect.y&&t.y+t.height<=this._showRect.y+this._showRect.height?n=!1:(n=!0,t.y<=this._showRect.y?0>(i=t.y-15*xhdRatio)&&(i=0):0>(i=t.y+t.height-this._showRect.height+15*xhdRatio)?i=0:this._showRect.y>this._totalHeight-this._showRect.height&&(i=this._totalHeight-this._showRect.height)),e?(i=t.y-15*xhdRatio,this._showRect.y>this._totalHeight-this._showRect.height&&(i=this._totalHeight-this._showRect.height),0>i&&(i=0),this._showRect.y!=i&&(this.moveNum=this._showRect.y,egret.Tween.get(this,{onChange:this.scrollEffect,onChangeObj:this}).to({moveNum:i},300,egret.Ease.circInOut))):n&&(this._showRect.y=i,this.updateShowRect())}}},e.prototype.scrollEffect=function(){var t=this;t._showRect.y=t.moveNum,t._showRect.y>t._totalHeight-t._showRect.height&&(t._showRect.y=t._totalHeight-t._showRect.height,egret.Tween.removeTweens(this)),t.updateShowRect()},e}(ComponentBase);__reflect(ScrollView.prototype,"ScrollView");var SelectMenuPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._btnList&&(this.btn1.parent&&this.btn1.parent.removeChild(this.btn1),this.btn2.parent&&this.btn2.parent.removeChild(this.btn2),this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),this._btnList=[this.btn1,this.btn2],this._index=0),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n,i){this._content=t,this._actionList=e,this._callbackFunc=n,this._thisObj=i},e.prototype.reset=function(){if(this.init){this.label_desc.text="";for(var t=0;t<this._btnList.length;t++){var e=this._btnList[t];e&&e.parent&&e.parent.removeChild(e)}this._index=0,this.contentBtns.reset(),this.contentDesc.reset()}},e.prototype.update=function(){if(this.init&&(this.reset(),this._actionList&&this._actionList.length>0)){this.label_desc.textFlow=Tool.convertDescToTextFlow(this._content),this.label_desc.height=this.label_desc.textHeight+5*xhdRatio,this.contentDesc.add(this.label_desc,7*xhdRatio,5*xhdRatio),this.contentDesc.updateAutoSize(this.label_desc.height+10*xhdRatio,250*xhdRatio),this.bg2.height=this.contentDesc.height+7*nato.mapRatio,this.contentBtns.y=this.bg2.y+this.bg2.height;for(var t,e,n=10*xhdRatio,i=0;i<this._actionList.length;i++){t=this._actionList[i],e=this.getBtn(),PowerString.converColorStrToStr(t.menu).length>=16?e.labelDisplay.size=11*xhdRatio:e.labelDisplay.size=15*xhdRatio;var o=Tool.convertDescToTextFlow(t.menu);e.labelDisplay.textFlow=o,e.y=n,n+=e.height,this.contentBtns.add(e)}this.contentBtns.updateAutoSize(this._actionList.length*e.height,170*xhdRatio),this.height=this.contentBtns.y+this.contentBtns.height+10*xhdRatio,this.y=.5*egret.MainContext.instance.stage.stageHeight}},e.prototype.onBtnTouch=function(t){var e=t.target;if(e&&-1!=this._btnList.indexOf(e)){var n=this;ButtonUtils.buttonTweenEffect(e,(function(){var t=n._btnList.indexOf(e),i=n._actionList[t];null!=n._callbackFunc&&null!=n._thisObj&&null!=i&&(null!=i.params&&null!=i.params2?n._callbackFunc.call(n._thisObj,i.action,i.params,i.params2):null!=i.params?n._callbackFunc.call(n._thisObj,i.action,i.params):n._callbackFunc.call(n._thisObj,i.action))}),this)}},e.prototype.getBtn=function(){var t=this._btnList[this._index];return null==t&&((t=new eui.Button).skinName=xhd?"CommonBtn1HDSkin":"CommonBtn1SDSkin",t.horizontalCenter=0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTouch,this),this._btnList[this._index]=t),t.horizontalCenter=0,t.width=235*xhdRatio,t.height=40*xhdRatio,this._index++,t},e}(ComponentBase);__reflect(SelectMenuPanel.prototype,"SelectMenuPanel");var TurnPage=function(t){function e(){var e=t.call(this)||this;return e._totalPage=1,e._currentPage=1,e._pageCount=5,e._isAlertOver=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.prev_btn,this.onPrevBtn,this),ButtonUtils.addTouchEvent(this.next_btn,this.onNextBtn,this),this.prev_btn.label=GameText.getText(GameText.TI_PREVIOUS_PAGE),this.next_btn.label=GameText.getText(GameText.TI_NEXT_PAGE),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.prev_btn),ButtonUtils.removeTouchEvent(this.next_btn),this._currentPage=1,this._totalPage=1},e.prototype.update=function(){this._currentPage>this._totalPage&&(this._currentPage=this._totalPage),this.page_info_label.text=this._currentPage+"/"+this._totalPage},e.prototype.onPrevBtn=function(){this._currentPage<=1?this._isAlertOver&&AlertPanel.alertCommon(GameText.STR_FIRST_PAGE):(this._currentPage--,this.update(),this.change())},e.prototype.onNextBtn=function(){this._currentPage>=this._totalPage?this._isAlertOver&&AlertPanel.alertCommon(GameText.STR_LAST_PAGE):(this._currentPage++,this.update(),this.change())},e.prototype.change=function(){this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},Object.defineProperty(e.prototype,"totalPage",{get:function(){return this._totalPage},set:function(t){this._totalPage=1>t?1:t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageCount",{set:function(t){this._pageCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),e.prototype.setPage=function(t,e,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=!1),this._currentPage=t,this.totalPage=e,n&&this.change()},e.prototype.data=function(t,e){void 0===e&&(e=1),this._data=t,this.setPage(e,t?Math.ceil(t.length/this._pageCount):1,!0)},Object.defineProperty(e.prototype,"currentPageData",{get:function(){var t=(this.currentPage-1)*this._pageCount;return this._data?this._data.slice(t,t+this._pageCount):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAlertOver",{get:function(){return this._isAlertOver},set:function(t){this._isAlertOver=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(TurnPage.prototype,"TurnPage");var WaitForServerPanel=function(t){function e(){var e=t.call(this)||this;return e._width=180*xhdRatio,e._height=30*xhdRatio,e._content="",e._time=0,e._lastTime=0,e.bg=new egret.Shape,e.bg.graphics.beginFill(0,0),e.bg.graphics.drawRect(0,0,320*xhdRatio,480*xhdRatio),e.bg.graphics.endFill(),e.addChild(e.bg),e.width=e.bg.width,e.height=e.bg.height,e.shp=new egret.Shape,e.shp.cacheAsBitmap=!0,e.shp.graphics.lineStyle(1,0),e.shp.graphics.beginFill(16705443,1),e.shp.graphics.drawRect(0,0,e._width,e._height),e.shp.graphics.endFill(),e.shp.x=(e.width-e.shp.width)/2,e.shp.y=(e.height-e.shp.height)/2,e.addChild(e.shp),e.txt=new egret.TextField,e.txt.textColor=0,e.txt.size=15*xhdRatio,e.txt.width=e._width,e.txt.textAlign="center",e.txt.fontFamily="黑体",e.txt.text="请稍候...",e.txt.multiline=!1,e.txt.x=e.shp.x,e.txt.y=e.shp.y+5*xhdRatio,e.addChild(e.txt),e.line=new egret.Shape,e.line.graphics.lineStyle(1,0),e.line.graphics.lineTo(0,0),e.line.graphics.endFill(),e.line.x=e.shp.x,e.line.y=e.shp.y+e._height-5*xhdRatio,e.addChild(e.line),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._time=0,this._lastTime=0,nato.WorldTicker.instance.register(this.update,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),nato.WorldTicker.instance.unregister(this.update,this)},e.prototype.show=function(t){void 0===t&&(t=null),t&&t.length>0?this._content=t:this._content="请稍候...",this.txt.text=this._content},e.prototype.update=function(t){if(this._time+=t,this._time-this._lastTime>1e3){this._lastTime+=1e3;var e=this._lastTime/1e3;this.txt.text=this._content+"("+e+")";var n=5*e;n>this._width&&(n%=this._width),this.line.graphics.clear(),this.line.graphics.lineStyle(2,0,1),this.line.graphics.moveTo(0,0),this.line.graphics.lineTo(n,0),this.line.graphics.endFill(),this.line.x=(this.width-n)/2}},e}(ComponentBase);__reflect(WaitForServerPanel.prototype,"WaitForServerPanel");var ComboBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this._defaultIndex=0},e.prototype.onClick=function(t){if(this._data&&this._data.length>0){this._listPanel=ObjectPool.getPool("ComboBoxListPanel").createObject(),nato.attachSkin(this._listPanel),this._listPanel.data=this._data,this._listPanel.defaultIndex=this._defaultIndex;var e=this.localToGlobal(0,0+this.height);this._listPanel.x=e.x,this._listPanel.y=e.y,UILayer.instance.uiLayer.addChild(this._listPanel),this._listPanel.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.listRemoveFromStage,this),this._listPanel.addEventListener(egret.Event.CHANGE,this.listChange,this)}},e.prototype.listRemoveFromStage=function(t){this._listPanel.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.listRemoveFromStage,this),this._listPanel.removeEventListener(egret.Event.CHANGE,this.listChange,this),ObjectPool.getPool("ComboBoxListPanel").returnObject(this._listPanel),this._listPanel=null},e.prototype.listChange=function(t){this._defaultIndex=this._listPanel.getCurrentIndex(),this.label_name.text=this.selectData.label,this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._defaultIndex},set:function(t){this._data&&this._data.length>0&&(0>t?t=0:t>=this._data.length&&(t=this._data.length-1),this._defaultIndex=t,this.label_name.text=this._data[t].label,this._listPanel&&(this._listPanel.defaultIndex=t))},enumerable:!0,configurable:!0}),e.prototype.setColor=function(t){this.label_name.textColor=t},Object.defineProperty(e.prototype,"selectData",{get:function(){return this._listPanel?this._listPanel.getCurrentItem().data:this._data?this._data[this._defaultIndex]:null},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(ComboBox.prototype,"ComboBox");var ComboBoxListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.initPanel=function(){this.label_name.text=this._data.label},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(ComboBoxListItem.prototype,"ComboBoxListItem");var ComboBoxListPanel=function(t){function e(){var e=t.call(this)||this;return e._max=9,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,this.touchEnabled=!1,this.container.touchEnabled=!1,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0,1e3),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.container.reset(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0),this._radioBtns.removeEventListener(egret.Event.CHANGE,this.radioChange,this),this._radioBtns=null},e.prototype.initPanel=function(){for(var t=[],e=0,n=this._data.length;n>e;e++){var i=new ComboBoxListItem;nato.attachSkin(i),i.data=this._data[e],this.container.add(i),t.push(i)}this._radioBtns=new RadioButtonComponent,this._radioBtns.add(t,this._defaultIndex,!0,!0),this._radioBtns.addEventListener(egret.Event.CHANGE,this.radioChange,this),this.bg.width=i.width+15*xhdRatio,e>this._max?(this.bg.height=i.height*this._max+15*xhdRatio,this.container.initScroll(i.width,i.height*this._max)):(this.bg.height=i.height*e+16*xhdRatio,this.container.initScroll(i.width,i.height*e)),this.container.update(),this._defaultIndex>=0&&t[this._defaultIndex]&&this.container.updateToShowItem(t[this._defaultIndex])},e.prototype.onClickStage=function(t){var e;((e=this.globalToLocal(t.stageX,t.stageY)).x<0||e.x>this.width||e.y<0||e.y>this.height)&&(t.stopImmediatePropagation(),this.close())},e.prototype.radioChange=function(t){this._radioBtns.getCurrentIndex()!=this._defaultIndex&&(this._defaultIndex=this._radioBtns.getCurrentIndex(),this.dispatchEvent(new egret.Event(egret.Event.CHANGE))),this.close()},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultIndex",{set:function(t){this._defaultIndex=t},enumerable:!0,configurable:!0}),e.prototype.getCurrentItem=function(){return this._radioBtns.getCurentSelectItem()},e.prototype.getCurrentIndex=function(){return this._defaultIndex},e.prototype.close=function(){Tool.removeObjSafe(this)},e}(ComponentBase);__reflect(ComboBoxListPanel.prototype,"ComboBoxListPanel");var AssetAdapter=function(){function t(){this.skin={},t.instance=this}return t.prototype.addSkin=function(t,e){var n=e;this.skin[t]=n},t.prototype.findSkin=function(t){var e=t.indexOf("_png"),n=t.substr(0,e);return this.skin[n]},t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}var o=t;if(t.prototype&&(o=new t),o instanceof egret.DisplayObject||o instanceof egret.Texture)i(o);else if("string"==typeof t){var a=t.indexOf(".");-1!=a&&(t=t.substr(a+1)),nato.getTextureFromUICache(t,i,this)}else i(o)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var CountryWarArmyFightPanel=function(t){function e(){var e=t.call(this)||this;return e._pageSize=8,e._currSelectItem=0,e._allSize=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE,this.updateList,this),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE,this.updateList,this),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),ButtonUtils.removeTouchEvent(this.btn),this._armyItemList){for(var n=0,i=this._armyItemList.length;i>n;n++)this.removeItem(n),n--,i--;this._armyItemList=null}this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),this._radioBtns=null),this.comboBox.removeEventListener(egret.Event.CHANGE,this.selectBuild,this)},e.prototype.removeItem=function(t){this._armyItemList[t]&&(Tool.removeObjSafe(this._armyItemList[t]),ObjectPool.getPool("SoldierHelpItem").returnObject(this._armyItemList[t]),this._armyItemList.splice(t,1))},e.prototype.update=function(){if(CountryWarArmyListScene.subType==CountryWarHandler.SUB_TYPE_COUNTRYWAR_BUILD_TEAM){this.currentState="build";var t=GameWorld.countryWar.getBuildByPos(CountryWarArmyListScene.buildPos);null!=t&&(this.label_info.text=Tool.manageStringList(GameText.STR_WARBUILD_INFO_DUR,[t.buildName,t.buildHP+""])),this.btn.label=GameText.STR_WAR_ADD_ARMY,ButtonUtils.addTouchEvent(this.btn,this.onBtnAdd,this,[CountryWarHandler.EVENT_ALL_WAR_ADD_ARMY]),this.getList(CountryWarArmyListScene.buildPos,this.turnPage.currentPage)}else{this.currentState="army";var e=[];e.push({value:CountryWar.ARMY_LIST_ALL,label:GameText.STR_LIST_ALL});for(var n=0;n<CountryWar.BUILD_NUM_MAX;n++)e.push({value:n,label:CountryWar.getBuildName(n,!0)});this.comboBox.addEventListener(egret.Event.CHANGE,this.selectBuild,this),this.comboBox.data=e,this.comboBox.select=0,this.selectBuild()}},e.prototype.getList=function(t,e){CountryWar.doWarArmyList(GameWorld.countryWar,t,this._pageSize,e,this.returnList,this)},e.prototype.returnList=function(t){if(this.stage){var e=GameWorld.countryWar.armyList,n=0;if(e&&e.length>0)for(var i=0,o=e.length;o>i;i++)if(!e[i].isStatus(WarArmy.STATUS_IS_DEL)){var a;this._armyItemList||(this._armyItemList=[]),n<this._armyItemList.length?a=this._armyItemList[n]:(a=ObjectPool.getPool("CountryWarArmyFightItem").createObject(),nato.attachSkin(a),this._armyItemList.push(a)),a.x=9*xhdRatio,a.y=43*xhdRatio+n*a.height,a.data=e[n],a.tabEvent=1,a.parent||this.addChild(a),n++}if(this.addChild(this.bg),this._armyItemList){for(o=this._armyItemList.length;o>n;n++)this.removeItem(n),n--,o--;this._armyItemList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._currSelectItem>this._armyItemList.length-1&&(this._currSelectItem=0),this._radioBtns.add(this._armyItemList,this._currSelectItem,!0,!0))}this._allSize=t,this.turnPage.totalPage=Math.ceil(t/this._pageSize)}},e.prototype.onBtnAdd=function(t){CountryWarHandler.doCountryWarEvent(t)},e.prototype.selectBuild=function(){this.turnPage.setPage(),this.getList(this.comboBox.selectData.value,1)},e.prototype.selectItem=function(){},e.prototype.updateList=function(t){this.onTurnPage(null)},e.prototype.onTurnPage=function(t){this.getList(CountryWarArmyListScene.buildPos,this.turnPage.currentPage)},e}(ComponentBase);__reflect(CountryWarArmyFightPanel.prototype,"CountryWarArmyFightPanel");var CountryWarArmyListScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){this.tabPanelList=[this.fight_panel,this.ready_panel],t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"index",{set:function(t){this._tabIndex=t},enumerable:!0,configurable:!0}),e}(TabPanelBase);__reflect(CountryWarArmyListScene.prototype,"CountryWarArmyListScene");var CountryWarArmyReadyPanel=function(t){function e(){var e=t.call(this)||this;return e._pageSize=8,e._currSelectItem=0,e._allSize=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE,this.updateList,this),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.COUNTRY_WAR_ARMY_LIST_UPDATE,this.updateList,this),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),this._armyItemList){for(var n=0,i=this._armyItemList.length;i>n;n++)this.removeItem(n),n--,i--;this._armyItemList=null}this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),this._radioBtns=null)},e.prototype.removeItem=function(t){this._armyItemList[t]&&(Tool.removeObjSafe(this._armyItemList[t]),ObjectPool.getPool("SoldierHelpItem").returnObject(this._armyItemList[t]),this._armyItemList.splice(t,1))},e.prototype.update=function(){this.label_info.text=GameText.STR_WAR_ARMY_TAB_READY_FAIL,this.getList(CountryWarArmyListScene.buildPos,this.turnPage.currentPage)},e.prototype.getList=function(t,e){CountryWar.doWarArmyList(GameWorld.countryWar,-1,this._pageSize,e,this.returnList,this)},e.prototype.returnList=function(t){if(this.stage){var e=GameWorld.countryWar.armyList;if(e&&e.length>0)for(var n=0,i=0,o=e.length;o>i;i++)if(!e[i].isStatus(WarArmy.STATUS_IS_DEL)){var a;this._armyItemList||(this._armyItemList=[]),n<this._armyItemList.length?a=this._armyItemList[n]:(a=ObjectPool.getPool("CountryWarArmyFightItem").createObject(),nato.attachSkin(a),this._armyItemList.push(a)),a.x=9*xhdRatio,a.y=43*xhdRatio+n*a.height,a.data=e[n],a.tabEvent=2,a.parent||this.addChild(a),n++}if(this.addChild(this.bg),this._armyItemList){for(o=this._armyItemList.length;o>n;n++)this.removeItem(n),n--,o--;this._armyItemList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._currSelectItem>this._armyItemList.length-1&&(this._currSelectItem=0),this._radioBtns.add(this._armyItemList,this._currSelectItem,!0,!0))}this._allSize=t,this.turnPage.totalPage=Math.ceil(t/this._pageSize)}},e.prototype.selectItem=function(){},e.prototype.updateList=function(t){this.turnPage.totalPage<=1?this.returnList(this._allSize-1):this.onTurnPage(null)},e.prototype.onTurnPage=function(t){this.getList(CountryWarArmyListScene.buildPos,this.turnPage.currentPage)},e}(ComponentBase);__reflect(CountryWarArmyReadyPanel.prototype,"CountryWarArmyReadyPanel");var CountryWarBuildingItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.group_spr.removeChildren()},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._warBuild=t,this.update()},Object.defineProperty(e.prototype,"warBuild",{get:function(){return this._warBuild},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){if(null==this._warBuild)return void(this.visible=!1);this.visible=!0,this.updateBuildSource(),this.updateHP(),this.img_select.visible=this._select,this._warBuild.armyNum>0?(this.group_flag.visible=!0,this._warBuild.armyNum>1?this.label_army_count.text="X"+this._warBuild.armyNum:this.label_army_count.text=""):this.group_flag.visible=!1}},e.prototype.updateBuildSource=function(){this._warBuild&&(this.img_type.source=this.getBuildSource(GameWorld.countryWar.getBuildIcon(this._warBuild.buildPos)))},e.prototype.updateHP=function(){this._warBuild&&(this.buildingHp.hp=this._warBuild.buildHP)},e.prototype.getBuildSource=function(t){return"countrywar_building_"+t},e}(ComponentBase);__reflect(CountryWarBuildingItem.prototype,"CountryWarBuildingItem");var CountryWarCommandItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_use),ButtonUtils.removeTouchEvent(this.btn_see),this._data=null},e.prototype.initPanel=function(){this.btn_see.label=GameText.STR_SEE,this.btn_use.label=GameText.STR_USE,ButtonUtils.addTouchEvent(this.btn_use,this.onUse,this),ButtonUtils.addTouchEvent(this.btn_see,this.onSee,this),this._data&&(this.label_name.textFlow=Tool.convertDescToTextFlow(this._data.getNameInfo()))},e.prototype.onUse=function(){this._data&&CountryWar.doUseCommand(this._data)},e.prototype.onSee=function(){this._data&&AlertPanel.alertTipsCommon(this._data.getInfo(),!0,"left")},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CountryWarCommandItem.prototype,"CountryWarCommandItem");var CountryWarCommandPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),Tool.removeObjSafe(this.group_command_1),Tool.removeObjSafe(this.group_command_2),CountryWar.doCommandList(GameWorld.countryWar,this.returnList,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this._commandItemList){for(var n=0,i=this._commandItemList.length;i>n;n++)Tool.removeObjSafe(this._commandItemList[n]),ObjectPool.getPool("CountryWarCommandItem").returnObject(this._commandItemList[n]);this._commandItemList=null}},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.returnList=function(t){t?(this._commandItemList=[],this.scroll.reset(),this.udpateCommandContainer(GameWorld.countryWar.command1List,this._commandItemList,this.group_command_1,this.label_command_1,Tool.manageString(GameText.STR_COMMAND,"1")),this.udpateCommandContainer(GameWorld.countryWar.command2List,this._commandItemList,this.group_command_2,this.label_command_2,Tool.manageString(GameText.STR_COMMAND,"2")),this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject()),this._radioBtns.add(this._commandItemList)):AlertPanel.alertCommon(GameText.STR_GET_WAR_COMMAND_ERROR)},e.prototype.udpateCommandContainer=function(t,e,n,i,o){if(!(null==t||t.length<=0)){if(t.length>0){i.text=o;var a=(this.scroll.width-n.width)/2;this.scroll.add(n,a)}for(var r=0;r<t.length;r++){if(null!=t[r]){var s=ObjectPool.getPool("CountryWarCommandItem").createObject();nato.attachSkin(s),s.data=t[r],this.scroll.add(s),e.push(s)}}this.scroll.update()}},e}(ComponentBase);__reflect(CountryWarCommandPanel.prototype,"CountryWarCommandPanel");var CountryWarHandler=function(){function t(){}return t.createWarBuildInfo=function(e,n){if(null!=e){var i=e.getBuildByPos(n);if(null!=i){t.currBuildPos=n;var o,a=[],r=e.isEnemyBuildPos(n);o=new MenuActionData((r?GameText.STR_COUNTRY_WAR_ASSAULT:GameText.STR_COUNTRY_WAR_GARRISON)+CountryWar.getBuildName(n,!1),t.EVENT_ALL_WAR_ADD_ARMY),a.push(o);var s=CountryWar.isOpeArmy(xself);o=new MenuActionData(s?GameText.STR_MANAGER_ARMY:GameText.STR_SEE_ARMY,t.EVENT_ALL_WAR_ARMY_BUILD_LIST),a.push(o),o=new MenuActionData(GameText.getText(GameText.TI_BACK),0),a.push(o),PanelManager.openSelectMenuPanel(i.getInfo(),a,t.doCountryWarEvent,t)}}},t.createWarPowerMenu=function(){var e,n=[];e=new MenuActionData(GameText.STR_WAR_EMBATTLE,t.EVENT_ALL_WAR_EMBATTLE),n.push(e),e=new MenuActionData(GameText.STR_WAR_ARMY_LIST,t.EVENT_ALL_WAR_ARMY_LIST),n.push(e),e=new MenuActionData(GameText.STR_WAP_SCHEME,t.EVENT_ALL_WAP_SCHEME),n.push(e),e=new MenuActionData(GameText.STR_WAR_SOLDIER_ARRAY,t.EVENT_ALL_WAR_SOLDIER_ARRAY),n.push(e),e=new MenuActionData(GameText.STR_WAR_VIEW_COUNTRY_INFO,t.EVENT_ALL_WAR_VIEW_COUNTRY),n.push(e),e=new MenuActionData(GameText.getText(GameText.TI_BACK),t.EVENT_ALL_BACK),n.push(e),PanelManager.openFilterMenuPanel(n,t.doCountryWarOtherEvent,t)},t.doCountryWarEvent=function(e){var n=GameWorld.countryWar;if(null!=n){var i=t.currBuildPos;switch(e){case t.EVENT_ALL_WAR_ARMY_MENU:t.createMyTeamUI(n);break;case t.EVENT_ALL_WAR_POWER_MENU:t.createWarPowerMenu();break;case t.EVENT_ALL_WAR_QUIT_MENU:CountryWar.doQuitCountryWar(n);break;case t.EVENT_COUNTRYWAR_BUILD_ATTACK:case t.EVENT_COUNTRYWAR_BUILD_DEFEND:case t.SLOTPOS_ATTACK_PALACE:case t.SLOTPOS_ATTACK_UP_WALL:case t.SLOTPOS_ATTACK_DOWN_WALL:case t.SLOTPOS_ATTACK_UP_TOWER:case t.SLOTPOS_ATTACK_MIDDLE_TOWER:case t.SLOTPOS_ATTACK_DOWN_TOWER:case t.SLOTPOS_DEFEND_PALACE:case t.SLOTPOS_DEFEND_UP_WALL:case t.SLOTPOS_DEFEND_DOWN_WALL:case t.SLOTPOS_DEFEND_UP_TOWER:case t.SLOTPOS_DEFEND_MIDDLE_TOWER:case t.SLOTPOS_DEFEND_DOWN_TOWER:CountryWar.doUIOpeTouchBuild(n,i);break;case t.EVENT_ALL_WAR_ADD_ARMY:CountryWar.doAddArmy(n,i);break;case t.EVENT_ALL_WAR_ARMY_BUILD_LIST:t.createCountryWarArmyListUI(t.SUB_TYPE_COUNTRYWAR_BUILD_TEAM,i,0)}PanelManager.closeSelectMenuPanel()}},t.doCountryWarOtherEvent=function(e){switch(e){case t.EVENT_ALL_WAR_MY_ARMY:t.createMyTeamUI(GameWorld.countryWar);break;case t.EVENT_ALL_WAR_ARMY_LIST:t.createCountryWarArmyListUI(t.SUB_TYPE_COUNTRYWAR_ALL_ARMY,-1,0);break;case t.EVENT_ALL_WAR_SOLDIER_ARRAY:PanelManager.openCountryWarTopScene();break;case t.EVENT_ALL_WAR_EMBATTLE:PanelManager.openCountryWarInfoScene();break;case t.EVENT_ALL_WAR_READY_ARMY_LIST:t.createCountryWarArmyListUI(t.SUB_TYPE_COUNTRYWAR_ALL_ARMY,-2,1);break;case t.EVENT_ALL_WAP_SCHEME:PanelManager.openScene(PanelManager.getPanel(CountryWarCommandPanel));break;case t.EVENT_ALL_WAR_VIEW_COUNTRY:null!=xself&&Country.doViewCountryInfo(xself.getCountryId())}},t.createMyTeamUI=function(t){return 0==xself.isPlayerTeam()?void AlertPanel.alertCommon(GameText.STR_WAR_MY_ARMY_NO_PLAYER):void 0},t.createCountryWarArmyListUI=function(t,e,n){if(null!=GameWorld.countryWar){var i=PanelManager.getPanel(CountryWarArmyListScene);i.index=n,CountryWarArmyListScene.subType=t,CountryWarArmyListScene.buildPos=e,PanelManager.openScene(i)}},t.createCountryWarStatusUI=function(t){},t.EVENT_ALL_WAR_ADD_ARMY=30050,t.EVENT_ALL_WAR_ARMY_DETAIL=30051,t.EVENT_ALL_WAR_MY_ARMY=30052,t.EVENT_ALL_WAR_ARMY_LIST=30053,t.EVENT_ALL_WAR_SOLDIER_ARRAY=30054,t.EVENT_ALL_WAR_ARMY_MENU=30055,t.EVENT_ALL_WAR_POWER_MENU=30056,t.EVENT_ALL_WAR_QUIT_MENU=30057,t.EVENT_ALL_WAR_EMBATTLE=30059,t.EVENT_ALL_WAR_READY_ARMY_LIST=30060,t.EVENT_ALL_WAP_SCHEME=30061,t.EVENT_ALL_WAR_ARMY_REMOVE=30062,t.EVENT_ALL_WAR_ARMY_INSERT=30063,t.EVENT_ALL_WAR_ARMY_DELETE=30064,t.EVENT_ALL_WAR_ARMY_BUILD_LIST=30069,t.EVENT_ALL_WAR_VIEW_COUNTRY=30070,t.EVENT_COUNTRYWAR_BUILD_ATTACK=13009,t.EVENT_COUNTRYWAR_BUILD_DEFEND=13010,t.SLOTPOS_ATTACK_PALACE=1,t.SLOTPOS_ATTACK_UP_WALL=2,t.SLOTPOS_ATTACK_DOWN_WALL=3,t.SLOTPOS_ATTACK_UP_TOWER=4,t.SLOTPOS_ATTACK_MIDDLE_TOWER=5,t.SLOTPOS_ATTACK_DOWN_TOWER=6,t.SLOTPOS_DEFEND_PALACE=7,t.SLOTPOS_DEFEND_UP_WALL=8,t.SLOTPOS_DEFEND_DOWN_WALL=9,t.SLOTPOS_DEFEND_UP_TOWER=10,t.SLOTPOS_DEFEND_MIDDLE_TOWER=11,t.SLOTPOS_DEFEND_DOWN_TOWER=12,t.EVENT_ALL_BACK=0,t.SUB_TYPE_COUNTRYWAR_BUILD_TEAM=0,t.SUB_TYPE_COUNTRYWAR_ALL_ARMY=1,t.currBuildPos=-1,t}();__reflect(CountryWarHandler.prototype,"CountryWarHandler");var CountryWarInfoArmyStateItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._warBuild=t},e.prototype.reset=function(){this.init&&(this.label_name.text="",this.label_value.text="",this.label_army.text="")},e.prototype.update=function(){if(this.init){if(null==this._warBuild)return void this.reset();this.label_name.text=this._warBuild.getBuildName(),this.label_value.text=this._warBuild.getHPInfo(),this.label_army.text=this._warBuild.getArmyNumInfo()}},e}(ComponentBase);__reflect(CountryWarInfoArmyStateItem.prototype,"CountryWarInfoArmyStateItem");var CountryWarInfoArmyStatePanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(){},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){this.reset();var t=GameWorld.countryWar;if(null!=t&&null!=t.buildList&&0!=t.buildList.length){for(var e=0;e<t.buildList.length;e++){var n=t.buildList[e],i=this.getItem();i.setData(n),this.container.add(i)}this.container.update()}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new CountryWarInfoArmyStateItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(CountryWarInfoArmyStatePanel.prototype,"CountryWarInfoArmyStatePanel");var CountryWarInfoBattleLogPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_desc.parent&&this.label_desc.parent.removeChild(this.label_desc),CountryWar.doGetReportList(GameWorld.countryWar)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(){},e.prototype.reset=function(){this.init&&(this.container.reset(),this.label_desc.text="")},e.prototype.update=function(){if(this.init){this.reset();var t=GameWorld.countryWar;if(null!=t&&null!=t.reportList&&0!=t.reportList.length){for(var e="",n=0;n<t.reportList.length;n++)e+=t.reportList[n],n<t.reportList.length-1&&(e+="\n");this.label_desc.text=e,this.container.add(this.label_desc,-1,10),this.container.update()}}},e}(ComponentBase);__reflect(CountryWarInfoBattleLogPanel.prototype,"CountryWarInfoBattleLogPanel");var CountryWarInfoBattleWatchItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_view)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._warArmy=t},Object.defineProperty(e.prototype,"warArmy",{get:function(){return this._warArmy},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.label_desc.text="")},e.prototype.update=function(){this.init&&(this.btn_view.label=GameText.getText(GameText.TI_VIEW_BATTLE),this._warArmy?(this.label_desc.text=this._warArmy.getArmyInfo2(),ButtonUtils.addTouchEvent(this.btn_view,this.onView,this)):this.label_desc.text="")},e.prototype.onView=function(){GameWorld.doBattleSeeInter(this._warArmy.getLeaderID())},e}(ComponentBase);__reflect(CountryWarInfoBattleWatchItem.prototype,"CountryWarInfoBattleWatchItem");var CountryWarInfoBattleWatchPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),CountryWar.doGetViewArmyList(GameWorld.countryWar)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onItemTouch=function(t){t.target instanceof CountryWarInfoBattleWatchItem?this.onSelectItem(t.target):t.target.parent instanceof CountryWarInfoBattleWatchItem&&this.onSelectItem(t.target.parent)},e.prototype.onSelectItem=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelect.select=!0)},e.prototype.reset=function(){this.init&&this.container.reset()},e.prototype.update=function(){if(this.init){this.reset();var t=GameWorld.countryWar;if(null!=t&&null!=t.viewArmyList&&0!=t.viewArmyList.length){for(var e=0;e<t.viewArmyList.length;e++){var n=t.viewArmyList[e],i=this.getItem();i.setData(n),this.container.add(i)}this.container.update()}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&((t=new CountryWarInfoBattleWatchItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(CountryWarInfoBattleWatchPanel.prototype,"CountryWarInfoBattleWatchPanel");var CountryWarInfoScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabbtn_armyState,this.tabbtn_battleLog,this.tabbtn_battleWatch];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this._tabIndex=0},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.openTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.updateTab=function(){this.init&&(ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_ARMY_STATE?this.addChild(this.armyStatePanel):this._tabIndex==e.TAB_INDEX_BATTLE_LOG?this.addChild(this.battleLogPanel):this._tabIndex==e.TAB_INDEX_BATTLE_WATCH&&this.addChild(this.battleWatchPanel))},e.prototype.removeAllPanel=function(){this.armyStatePanel&&this.armyStatePanel.parent&&this.armyStatePanel.parent.removeChild(this.armyStatePanel),this.battleLogPanel&&this.battleLogPanel.parent&&this.battleLogPanel.parent.removeChild(this.battleLogPanel),this.battleWatchPanel&&this.battleWatchPanel.parent&&this.battleWatchPanel.parent.removeChild(this.battleWatchPanel)},e.TAB_INDEX_ARMY_STATE=0,e.TAB_INDEX_BATTLE_LOG=1,e.TAB_INDEX_BATTLE_WATCH=2,e}(ComponentBase);__reflect(CountryWarInfoScene.prototype,"CountryWarInfoScene");var CountryWarMyArmyListPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_leave,this.onBtnLeave,this),xevent.addEventListener(WorldEvent.AROUND__REFRESH_TEAM_INFO,this.onResetTeamList,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_leave),xevent.removeEventListener(WorldEvent.AROUND__REFRESH_TEAM_INFO,this.onResetTeamList,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnLeave=function(){GameWorld.isCountryWarStatus()&&CountryWar.doQuitCountryWar(GameWorld.countryWar)},e.prototype.onResetTeamList=function(t){this.update()},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){this.reset();var t=xworld.getTypeModel(Define.NEAR_MY_TEAM);if(null!=t&&0!=t.length){for(var e=0;e<t.length;e++){var n=this.getItem();n.setData(t[e]),this.container.add(n)}this.container.update()}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new AroundTeamItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(CountryWarMyArmyListPanel.prototype,"CountryWarMyArmyListPanel");var CountryWarScene=function(t){function e(){var e=t.call(this)||this;return e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.headInfoView.setData(xself),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_army,this.onBtnArmy,this),ButtonUtils.addTouchEvent(this.btn_power,this.onBtnPower,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnClose,this),null==this._itemList){this._itemList=[];for(var n=0;this["item"+n];){var i=this["item"+n];this._itemList.push(i),n++}}if(GameWorld.countryWar){var o=GameWorld.countryWar.buildList;if(o)for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.setData(null==o[n]?null:o[n]),i.select=!1}GameWorld.countryWar.beginToUpdateWar()}this.update(),this._curSelectItem&&this.onSelectItem(this._curSelectItem)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_army),ButtonUtils.removeTouchEvent(this.btn_power),ButtonUtils.removeTouchEvent(this.closeBtn);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}},e.prototype.onBtnClose=function(){CountryWar.doQuitCountryWar(GameWorld.countryWar)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnArmy=function(){PanelManager.openCountryWarMyArmyListPanel()},e.prototype.onBtnPower=function(){CountryWarHandler.createWarPowerMenu()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onItemTouch=function(t){var e=t.currentTarget,n=this._itemList.indexOf(e);e&&n>=0&&(this.onSelectItem(e),e&&CountryWar.doUIOpeTouchBuild(GameWorld.countryWar,e.warBuild.buildPos))},e.prototype.onSelectItem=function(t){null!=t&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.update=function(){if(this.init){var t=GameWorld.countryWar;if(null!=t){if(null!=t.armySprite){var e=t.armySprite.sprite,n=-1==t.mySlotPos?t.getMyPalace():t.mySlotPos;null!=(a=this.getItemByPos(n))&&a.group_spr.addChild(e)}if(this.label_round.text="回合数："+t.round+"/"+t.roundMax,this.label_armyNum1.text=t.soldierAttack+"",this.label_armyNum2.text=t.soldierDefend+"",GameWorld.countryWar){var i=GameWorld.countryWar.buildList;if(i)for(var o=0;o<this._itemList.length;o++){var a;(a=this._itemList[o]).setData(null==i[o]?null:i[o])}}}}},e.prototype.logic=function(t){var e=GameWorld.countryWar;if(null!=e&&(this._logicCount+=t,!(this._logicCount<500))){this._logicCount=0;var n,i=e.getRoundStateStr();n=Tool.currentTime>e.roundEndTime?GameText.STR_COUNTRY_WAR_REACH_TIME_WAIT:Tool.getPlanTimeStr(e.roundEndTime),i+=PowerString.makeColorString(n,ColorUtils.COLOR_GREEN),this.label_time.textFlow=Tool.convertDescToTextFlow(i)}},e.prototype.getItemByPos=function(t){for(var e=0;e<this._itemList.length;e++){var n=this._itemList[e];if(n&&n.warBuild&&n.warBuild.buildPos==t)return n}return null},e}(ComponentBase);__reflect(CountryWarScene.prototype,"CountryWarScene");var CountryWarSelectBuildPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;this["btn_"+n];)ButtonUtils.removeTouchEvent(this["btn_"+n]),n++;ButtonUtils.removeTouchEvent(this.btn_close)},e.prototype.initPanel=function(){for(var t=0;this["btn_"+t];)ButtonUtils.addTouchEvent(this["btn_"+t],this.onBtnClick,this,[t]),t++;ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this)},e.prototype.onBtnClick=function(t){CountryWar.doInsertArmy(t,this._data),this.onClose()},e.prototype.onClose=function(){PopUpManager.removePopUp(this)},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CountryWarSelectBuildPanel.prototype,"CountryWarSelectBuildPanel");var CountryWarTopListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._listPlayer=null,this._country=null},Object.defineProperty(e.prototype,"listPlayer",{get:function(){return this._listPlayer},set:function(t){this._listPlayer=t,this._country=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"country",{get:function(){return this._country},set:function(t){this._country=t,this._listPlayer=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(null!=this._listPlayer?(this.label_name.text=this._listPlayer.getWarTopNameInfo(),this.label_value.text=this._listPlayer.killInfo):null!=this._country&&(this.label_name.text=this._country.name+"( "+Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._country.getScale()+"")+" )",this.label_value.text=this._country.warInfo))},e}(ComponentBase);__reflect(CountryWarTopListItem.prototype,"CountryWarTopListItem");var CountryWarTopScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._allPage=0,e._curPage=1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabbtn_current,this.tabbtn_hero,this.tabbtn_country];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}if(ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),null==this._itemList){this._itemList=[];for(n=0;10>n;n++)this._itemList.push(this["item"+n])}for(n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.reset(),this.onGetData()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn);for(n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),this._dataList=null},e.prototype.onGetData=function(){Country.doUIGetWarTopList(this._tabIndex,10,this._curPage)},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this._curPage=1,this.onGetData())},e.prototype.onTurnPage=function(t){this._curPage=this.turnPage.currentPage,this.onGetData()},e.prototype.setTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onItemTouch=function(t){t.target instanceof CountryWarTopListItem||t.target.parent instanceof CountryWarTopListItem&&this.onSelectItem(t.target.parent)},e.prototype.onSelectItem=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.setData=function(t,e,n){this._tabIndex=t,this._dataList=e;var i=Math.floor(n/10);n%10>0&&(i+=1),this._allPage=i},e.prototype.reset=function(){if(this.init){for(var t=0;t<this._itemList.length;t++){this._itemList[t].visible=!1}this.turnPage.setPage(1,1,!1)}},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.update()},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._dataList&&0!=this._dataList.length)){if(this._tabIndex==e.TAB_INDEX_CURRENT||this._tabIndex==e.TAB_INDEX_HERO)for(var t=0;t<this._dataList.length;t++){var n=this._dataList[t],i=this._itemList[t];null!=n&&null!=i&&(i.visible=!0,i.listPlayer=n,i.update())}else if(this._tabIndex==e.TAB_INDEX_COUNTRY)for(t=0;t<this._dataList.length;t++){var o=this._dataList[t];i=this._itemList[t];null!=o&&null!=i&&(i.visible=!0,i.country=o,i.update())}this.turnPage.setPage(this._curPage,this._allPage,!1)}},e.TAB_INDEX_CURRENT=0,e.TAB_INDEX_HERO=1,e.TAB_INDEX_COUNTRY=2,e}(ComponentBase);__reflect(CountryWarTopScene.prototype,"CountryWarTopScene");var CountryWarWinActionItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._data=""},e.prototype.initPanel=function(){this.label_name.text=this._data},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CountryWarWinActionItem.prototype,"CountryWarWinActionItem");var CountryWarWinActionPanel=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._selectBuilding=0,e._selectWarn=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_confirm.label=GameText.getText(GameText.TI_OK),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.tabBtn_0,this.onChangeTab,this,[0]),ButtonUtils.addTouchEvent(this.tabBtn_1,this.onChangeTab,this,[1]),ButtonUtils.addTouchEvent(this.btn_confirm,this.onConfirm,this),this._tabBtnArr=[],this._tabBtnArr.push(this.tabBtn_0),this._tabBtnArr.push(this.tabBtn_1),this.initPanel()},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.tabBtn_0),ButtonUtils.removeTouchEvent(this.tabBtn_1),ButtonUtils.removeTouchEvent(this.btn_confirm),this._data=null,this._tabBtnArr=null,this._itemArr){for(var n=0,i=this._itemArr.length;i>n;n++)this.removeItem(n),n--,i--;this._itemArr=null}this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),this._radioBtns=null),this._selectBuilding=0,this._selectWarn=0,this._tabIndex=0},e.prototype.removeItem=function(t){this._itemArr[t]&&(Tool.removeObjSafe(this._itemArr[t]),ObjectPool.getPool("CountryWarWinActionItem").returnObject(this._itemArr[t]),this._itemArr.splice(t,1))},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.initPanel=function(){this.label_title.text=GameText.STR_TYPE_WIN_ACTION_DO,this.onChangeTab(0)},e.prototype.onChangeTab=function(t){ButtonUtils.selectTabBtnList(this._tabBtnArr,t),this._tabIndex=t,this.initTab(this._tabIndex)},e.prototype.initTab=function(t){if(this._data){this.scroll.reset();var e,n=0;if(this._itemArr=[],0==t){for(this.label_sub_title.text=GameText.STR_TYPE_WIN_ACTION_DO_LEVEL,e=0;e<this._data.buildingList.length;e++){var i=this._data.buildingList[e];if(null!=i){var o=i[0],a=i[1],r=Define.getBuildingText(o)+"("+a+")";(s=this.getItem(e)).data=r,this.scroll.add(s)}}n=this._selectBuilding}else{for(this.label_sub_title.text=GameText.STR_TYPE_WIN_ACTION_DO_ERROR,e=0;e<this._data.warnInfoList.length;e++){var s,l=this._data.warnInfoList[e][1];(s=this.getItem(e)).data=l,this.scroll.add(s)}n=this._selectWarn}if(this.scroll.update(),this._itemArr){for(var _=this._itemArr.length;_>e;e++)this.removeItem(e),e--,_--;this._itemArr.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._radioBtns.add(this._itemArr,n,!0,!0))}}},e.prototype.getItem=function(t){var e;return t<this._itemArr.length?e=this._itemArr[t]:(e=ObjectPool.getPool("CountryWarWinActionItem").createObject(),nato.attachSkin(e),this._itemArr.push(e)),e},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurrentIndex();0==this._tabIndex?this._selectBuilding=e:this._selectWarn=e},e.prototype.onConfirm=function(){Country.doWinActionDo(this._data,this._selectBuilding,this._selectWarn),PanelManager.closeScene()},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(CountryWarWinActionPanel.prototype,"CountryWarWinActionPanel");var BuildingHP=function(t){function e(){var e=t.call(this)||this;return e._hp=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this.hp0.visible=this._hp>=5,this.hp1.visible=this._hp>=4,this.hp2.visible=this._hp>=3,this.hp3.visible=this._hp>=2,this.hp4.visible=this._hp>=1)},e}(ComponentBase);__reflect(BuildingHP.prototype,"BuildingHP");var CountryBossBuildingItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e._isShowHp=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"isShopHp",{get:function(){return this._isShowHp},set:function(t){this._isShowHp=t,this.buildingHp&&(this.buildingHp.visible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._boss=t,this.update()},Object.defineProperty(e.prototype,"boss",{get:function(){return this._boss},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this._boss?this._boss.num<=0?this.img_type.source=this.getBuildSource(CountryBoss.IMAGESET_DESTROY):this.img_type.source=this.getBuildSource(this._boss.icon):this.img_type.source=null,this._isShowHp?(this.buildingHp.visible=!0,this.buildingHp.update()):this.buildingHp.visible=!1,this.img_select.visible=this._select)},e.prototype.getBuildSource=function(t){return"countrywar_building_"+t},e}(ComponentBase);__reflect(CountryBossBuildingItem.prototype,"CountryBossBuildingItem");var CountryBossScene=function(t){function e(){var e=t.call(this)||this;return e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.headInfoView.setData(xself),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_mail,this.onBtnMail,this),ButtonUtils.addTouchEvent(this.btn_battleReport,this.onBtnBattleReport,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnClose,this),this.group_resource.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onResourceTouch,this),null==this._itemList){this._itemList=[];for(var n=0;12>n;n++){(i=this["item"+n]).isShopHp=!1,this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){var i;(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}nato.WorldTicker.instance.register(this.logic,this),this.update(),this._curSelectItem&&this.onSelectItem(this._curSelectItem)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_mail),ButtonUtils.removeTouchEvent(this.btn_battleReport),ButtonUtils.removeTouchEvent(this.closeBtn),this.group_resource.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onResourceTouch,this);for(var n=0;n<this._itemList.length;n++){var i=this._itemList[n];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}this.group_spr.removeChildren(),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnMail=function(){PanelManager.openMailScene()},e.prototype.onBtnBattleReport=function(){this._countryBoss&&AlertPanel.alertCommon(this._countryBoss.getBattleLog())},e.prototype.onResourceTouch=function(t){this._countryBoss&&AlertPanel.alertCommon(this._countryBoss.getBattleResource())},e.prototype.onBtnClose=function(){CountryBoss.doCountryBossQuit()},e.prototype.onItemTouch=function(t){var e=t.target,n=this._itemList.indexOf(e);e&&n>=0&&(this.onSelectItem(e),e&&e.boss&&CountryBoss.doFightAsk(e.boss))},e.prototype.onSelectItem=function(t){null!=t&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.setData=function(t){this._countryBoss=t,this.update()},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._countryBoss){if(this.group_spr.removeChildren(),null!=this._countryBoss.spriteModel){var t=this._countryBoss.spriteModel.sprite;if(-1!=this._countryBoss.myPos){var e=this._itemList[this._countryBoss.myPos-1];t.x=e.x+e.width/2,t.y=e.y+e.height,this.group_spr.addChild(t)}}this.bar_iron.value=this._countryBoss.countryIron/this._countryBoss.countryallIron*100,this.label_iron.text=this._countryBoss.countryIron+"/"+this._countryBoss.countryallIron,this.bar_rock.value=this._countryBoss.countryRock/this._countryBoss.countryallRock*100,this.label_rock.text=this._countryBoss.countryRock+"/"+this._countryBoss.countryallRock,this.bar_wood.value=this._countryBoss.countryWood/this._countryBoss.countryallWood*100,this.label_wood.text=this._countryBoss.countryWood+"/"+this._countryBoss.countryallWood,this._countryBoss.countryallmoney1>0||0==this._countryBoss.countryallmoney3?(this.icon_money.source=xitem.getMoneyIconSource(ModelConst.MONEY1),this.bar_money.value=this._countryBoss.countrymoney1/this._countryBoss.countryallmoney1*100,this.label_money.text=Tool.getMoneyText(this._countryBoss.countrymoney1,Tool.DIVIDE_TEN_THOUSAND)+"/"+Tool.getMoneyText(this._countryBoss.countryallmoney1,Tool.DIVIDE_TEN_THOUSAND)):(this.icon_money.source=xitem.getMoneyIconSource(ModelConst.MONEY3),this.bar_money.value=this._countryBoss.countrymoney3/this._countryBoss.countryallmoney3*100,this.label_money.text=Tool.getMoneyText(this._countryBoss.countrymoney3,Tool.DIVIDE_TEN_THOUSAND)+"/"+Tool.getMoneyText(this._countryBoss.countryallmoney3,Tool.DIVIDE_TEN_THOUSAND));for(var n=0;n<this._itemList.length;n++){e=this._itemList[n];var i=this._countryBoss.getBossByIndex(n);e.setData(i)}}},e.prototype.logic=function(t){if(this._countryBoss&&this._countryBoss.logic(t),this._logicCount+=t,!(this._logicCount<500))if(this._logicCount=0,this._countryBoss)if(this._countryBoss.isTimeOut())this.label_time.textFlow=Tool.convertDescToTextFlow(PowerString.makeColorString(GameText.STR_OVER,ColorUtils.COLOR_WHITE));else{var e="剩余时间：",n=Tool.getPlanTimeStr(this._countryBoss.endTime);e+=PowerString.makeColorString(n,ColorUtils.COLOR_GREEN),this.label_time.textFlow=Tool.convertDescToTextFlow(e)}else this.label_time.text=""},e}(ComponentBase);__reflect(CountryBossScene.prototype,"CountryBossScene");var DailyLotteryHandler=function(){function t(){}return t.doActorLotteryDrawListNow=function(e,n,i){void 0===e&&(e=!1),void 0===n&&(n=50),void 0===i&&(i=1);var o=xself;if(null==o)return null;PanelManager.openWaitForServer();var a=new nato.Message(ProtocolDefine.CG_ACTOR_LOTTERY_DRAW_LIST);a.putByte(n),a.putShort(i),nato.Network.sendCmd(a,(function(n){if(PanelManager.closeWaitForServer(),null==n)return null;if(0>n.getShort())return PanelManager.getPanel(DailyLotteryPanel).closePanel(),AlertPanel.alertCommon(n.getString()),null;var i=n.getInt();if(new StringBuffer,0>=i)return null;t.myResult=n.getInt(),t.myCount=n.getByte(),t.costMoney2=n.getInt(),t.costMoney3=n.getInt(),t.freeCount=n.getByte(),t.allCount=n.getByte(),t.rewardMoney2=n.getInt(),t.rewardMoney3=n.getInt();var a=n.getInt(),r=n.getInt(),s=n.getInt();if(t.openStatus=n.getByte(),o.money1=a,o.money2=r,o.money3=s,n.getBoolean()&&(t.item=new ItemData,ItemData.fromBytesAtts2(t.item,n)),n.getBoolean()){t.historyMoney2=n.getInt(),t.historyMoney3=n.getInt(),t.historyItem=new ItemData,t.historyItem.name=n.getString();var l=n.getByte();t.historyItem.bagIcon=l,t.historyItem.grade=n.getByte(),t.historyluckyNum=n.getInt()}var _=n.getInt();t.lotteryDrawList=[];for(var h=0;_>h;h++){var u=t.fromByteToLotteryDraw(n);null!=u&&t.lotteryDrawList.push(u)}t.premiumsNum=n.getByte(),t.strluckyNumber=n.getString(),xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_DAILY_LOTTERY_DATA)),e&&t.doLotteryDrawView(!0)}),this)},t.fromByteToLotteryDraw=function(t){if(null==t)return null;var e=new ListPlayer;return e.setId(t.getInt()),e.setName(t.getString()),e.flag=t.getByte(),e.setVipLevel(t.getByte()),e.luckNum=t.getInt(),e},t.fromByteToLotteryDrawHistory=function(t){if(null==t)return null;var e=new ListPlayer;e.winnerList=t.getString(),e.rewardDate=t.getString(),e.setName(t.getString()),e.rewardMoney2=t.getInt(),e.rewardMoney3=t.getInt(),e.rewarditem=new ItemData,e.rewarditem.name=t.getString();var n=t.getByte();return e.rewarditem.bagIcon=n,e.rewarditem.grade=t.getByte(),e},t.doActorLotteryDrawWinningList=function(e,n){void 0===e&&(e=50),void 0===n&&(n=1);PanelManager.openWaitForServer();var i=new nato.Message(ProtocolDefine.CG_ACTOR_LOTTERY_DRAW_WINNING_LIST);i.putByte(e),i.putShort(n),nato.Network.sendCmd(i,(function(e){if(PanelManager.closeWaitForServer(),null==e)return null;if(0>e.getShort())return AlertPanel.alertCommon(e.getString()),null;var n=e.getInt();if(0>=n)return null;t.lotteryDrawListHistory=[];for(var i=0;n>i;i++){var o=t.fromByteToLotteryDrawHistory(e);null!=o&&t.lotteryDrawListHistory.push(o)}xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_DAILY_LOTTERY_DATA_HISTORY))}),this)},t.doLotteryDraw=function(e){if(0!=SafeLock.doSafeLockVerify())switch(e){case this.ACTOR_LOTTERY_DRAW_MONEY2:AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_VIP_PAY_ASK,PowerString.makeColorString(GameText.getMoneyText(ModelConst.MONEY2)+t.costMoney2,ColorUtils.COLOR_RED)),(function(){Model.checkEnoughMoney(0,t.costMoney2,0,(function(){t.sendLotteryMsg(this.ACTOR_LOTTERY_DRAW_MONEY2)}),this)}),this);break;case this.ACTOR_LOTTERY_DRAW_MONEY3:AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_VIP_PAY_ASK,PowerString.makeColorString(GameText.getMoneyText(ModelConst.MONEY3)+t.costMoney3,ColorUtils.COLOR_RED)),(function(){Model.checkEnoughMoney(0,0,t.costMoney3,(function(){t.sendLotteryMsg(this.ACTOR_LOTTERY_DRAW_MONEY3)}),this)}),this);break;case t.ACTOR_LOTTERY_DRAW_DF:t.sendLotteryMsg(t.ACTOR_LOTTERY_DRAW_DF)}else PanelManager.closeSelectMenuPanel()},t.sendLotteryMsg=function(e){var n=new nato.Message(ProtocolDefine.CG_ACTOR_LOTTERY_DRAW);n.putByte(e),nato.Network.sendCmd(n,(function(e){if(null!=e){if(0>e.getShort())return void AlertPanel.alertCommon(e.getString());if(!(0>=e.getInt())){var n=e.getInt(),i=e.getInt(),o=e.getByte(),a=e.getByte(),r="";e.getBoolean()&&(r=MsgHandler.processAddItemMsg(e,ProtocolDefine.ADD_ITEM_USE_REWARD),r=Tool.manageString(GameText.STR_LOTTERY_DRAW_REWARD_PIC,r));var s="";a>0&&(s="\n"+Tool.manageString(GameText.STR_LOTTERY_DRAW_PREMIUMSNUM,a+""));var l=GameText.STR_LIST_NULL;0!=n&&(l=n+"");var _=ColorUtils.COLOR_GREEN;n>i&&(_=ColorUtils.COLOR_RED),AlertPanel.alertCommon(Tool.manageStringList(GameText.STR_LOTTERY_DRAW_RESULT_INFO,[l,PowerString.makeColorString(i+"",_),o+""])+s+r),t.doActorLotteryDrawListNow(!0)}}}),this)},t.doSeeHistoryReward=function(e){if(null==e)return"";var n=new StringBuffer;return n.append(Tool.manageString(GameText.STR_LOTTERY_DRAW_REWARD_HISINFO,e.luckNum+"")),null!=t.historyItem&&n.append(t.historyItem.getRewardDesc()+"\n"),t.historyMoney2>0&&n.append(t.historyMoney2+GameText.STR_MONEY2+" "),t.historyMoney3>0&&n.append(t.historyMoney3+GameText.STR_MONEY3+" "),n.toString()},t.doLotteryDrawView=function(e){void 0===e&&(e=!1);var n=xself;if(null!=n){var i,o="",a=[],r="";if(t.premiumsNum>0&&(r=Tool.manageString(GameText.STR_LOTTERY_DRAW_PREMIUMSNUM,t.premiumsNum+"")+"\n"),t.myCount>=t.freeCount&&t.myCount<t.allCount){var s=new StringBuffer,l="";t.costMoney2>0&&t.costMoney3>0&&(l=" "+GameText.STR_OR+" "),t.costMoney2>0&&(s.append(PowerString.makeColorString(t.costMoney2+GameText.STR_MONEY2,ColorUtils.COLOR_MONEY2)+l),i=new MenuActionData(GameText.STR_LOTTERY_DRAW_MONEY2_TITLE,t.ACTOR_LOTTERY_DRAW_MONEY2),a.push(i)),t.costMoney3>0&&(s.append(PowerString.makeColorString(t.costMoney3+GameText.STR_MONEY3,ColorUtils.COLOR_MONEY3)),i=new MenuActionData(GameText.STR_LOTTERY_DRAW_MONEY3_TITLE,t.ACTOR_LOTTERY_DRAW_MONEY3),a.push(i)),o=Tool.manageStringList(GameText.STR_LOTTERY_DRAW_MONEY_INFO,[t.myResult+"",t.strluckyNumber+"\n",r,Tool.manageString(GameText.STR_LOTTERY_DRAW_MONEY_NEED,s.toString()),n.money1+"",n.money2+"",n.money3+""])}else t.myCount<t.freeCount?(i=new MenuActionData(GameText.STR_LOTTERY_DRAW_FREE_TITLE,t.ACTOR_LOTTERY_DRAW_DF),a.push(i),o=Tool.manageStringList(GameText.STR_LOTTERY_DRAW_MONEY_INFO,[t.myResult+"",t.strluckyNumber+"\n",r,GameText.STR_LOTTERY_DRAW_FREE_NEED,n.money1+"",n.money2+"",n.money3+""]),t.myCount<1&&(o=Tool.manageStringList(GameText.STR_LOTTERY_DRAW_FREE_FIR_INFO,[t.strluckyNumber+"\n",r,n.money1+"",n.money2+"",n.money3+""]))):t.myCount>=t.allCount&&(o=GameText.STR_LOTTERY_DRAW_COUNT_OVER);i=new MenuActionData(GameText.getText(GameText.TI_BACK),t.ACTOR_LOTTERY_DRAW_BACK),a.push(i),e?(PanelManager.getPanel(SelectMenuPanel).setData(o,a,t.selectMenuCallBack,this),PanelManager.getPanel(SelectMenuPanel).update()):PanelManager.openSelectMenuPanel(o,a,t.selectMenuCallBack,this)}},t.selectMenuCallBack=function(e){if(e===t.ACTOR_LOTTERY_DRAW_BACK)PanelManager.closeSelectMenuPanel();else t.doLotteryDraw(e)},t.ACTOR_LOTTERY_DRAW_DF=1,t.ACTOR_LOTTERY_DRAW_MONEY2=2,t.ACTOR_LOTTERY_DRAW_MONEY3=3,t.ACTOR_LOTTERY_DRAW_BACK=4,t}();__reflect(DailyLotteryHandler.prototype,"DailyLotteryHandler");var DailyLotteryPanel=function(t){function e(){var e=t.call(this)||this;return e.ACTION_BACK=40,e}return __extends(e,t),e.prototype.partAdded=function(t,e){switch(t){case"label_lucky_number":this.label_lucky_number.text="";break;case"label_my_number":this.label_my_number.text="";break;case"label_reward_money2":this.label_reward_money2.text="";break;case"label_reward_money3":this.label_reward_money3.text="";break;case"label_item_name":this.label_item_name.text=""}},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.visible=!1,xevent.addEventListener(WorldEvent.RETURN_DAILY_LOTTERY_DATA,this.returnDailyLotteryData,this),this.getData()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.RETURN_DAILY_LOTTERY_DATA,this.returnDailyLotteryData,this),ButtonUtils.removeTouchEvent(this.btn_lottery),this.group_item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this),this.scroll.reset(!0),this._btnsRadio&&(this._btnsRadio.removeEventListener(egret.Event.CHANGE,this.onSelectItem,this),this._btnsRadio=null)},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.getData=function(){DailyLotteryHandler.doActorLotteryDrawListNow()},e.prototype.returnDailyLotteryData=function(){if(this.visible=!0,this.scroll.reset(!0),this.label_lucky_number.text=DailyLotteryHandler.strluckyNumber,this.label_my_number.text=DailyLotteryHandler.myResult+"",this.label_reward_money2.text=DailyLotteryHandler.rewardMoney2+"",this.label_reward_money3.text=DailyLotteryHandler.rewardMoney3+"",this.btn_lottery_label.text=GameText.STR_LOTTERY_DRAW_FREE_TITLE,ButtonUtils.addTouchEvent(this.btn_lottery,DailyLotteryHandler.doLotteryDrawView,this),this.item_icon.setData(DailyLotteryHandler.item.bagIcon,DailyLotteryHandler.item.grade),this.label_item_name.text=DailyLotteryHandler.item.name,this.label_item_name.width=this.label_item_name.textWidth+5,this.group_item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this),DailyLotteryHandler.lotteryDrawList&&DailyLotteryHandler.lotteryDrawList.length>0){for(var t=[],e=0,n=DailyLotteryHandler.lotteryDrawList.length;n>e;e++){var i=ObjectPool.getPool("YesterdayWinnerItem").createObject();nato.attachSkin(i),i.data=DailyLotteryHandler.lotteryDrawList[e],this.scroll.add(i,0),t.push(i)}var o=0;this._btnsRadio?(o=this._btnsRadio.getCurrentIndex(),this._btnsRadio.clear()):this._btnsRadio=new RadioButtonComponent,this._btnsRadio.add(t,o,!0,!0),this._btnsRadio.addEventListener(egret.Event.CHANGE,this.onSelectItem,this)}this.scroll.update()},e.prototype.onClickItem=function(t){var e=Tool.convertDescToTextFlow(DailyLotteryHandler.item.getDesc(xself,!1,!1));AlertPanel.alertTipsTextFlow(DailyLotteryHandler.item.name,e,"left")},e.prototype.onSelectItem=function(t){PanelManager.openPlayerMenuPanel(this._btnsRadio.getCurentSelectItem().data,Menu.UI_INTO_LOTTERY_DRAW_PLAYER)},e}(WindowPanelBase);__reflect(DailyLotteryPanel.prototype,"DailyLotteryPanel");var YesterdayWinnerItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_reward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSeeReward,this),ObjectPool.getPool("YesterdayWinnerItem").returnObject(this)},e.prototype.initPanel=function(){this._data&&(this.item_name_label.text=this._data.getName(),this.btn_reward.label=GameText.STR_LOTTERY_DRAW_BTN_REWARD,this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSeeReward,this))},e.prototype.onSeeReward=function(t){var e=Tool.convertDescToTextFlow(DailyLotteryHandler.doSeeHistoryReward(this._data));AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),e),t.stopPropagation()},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(YesterdayWinnerItem.prototype,"YesterdayWinnerItem");var DrugItem=function(t){function e(){var e=t.call(this)||this;return e._isAutoUse=!1,e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._isAutoUse?this.updateAuto():this.update(),this.label_name.touchEnabled=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._itemData=t,this.select=!1,this.update()},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._itemData?this.label_name.text=this._itemData.name+" x "+this._itemData.quantity:this.label_name.text="")},Object.defineProperty(e.prototype,"isAutoUse",{get:function(){return this._isAutoUse},set:function(t){this._isAutoUse=t,this._isAutoUse&&this.updateAuto()},enumerable:!0,configurable:!0}),e.prototype.updateAuto=function(){this.init&&(this.label_name.text=GameText.STR_ITEM_ONE_KEY_RECOVERY)},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(DrugItem.prototype,"DrugItem");var DrugPanel=function(t){function e(){var e=t.call(this)||this;return e.subType=0,e._itemList=[],e._index=0,e._type=0,e._autoUseItem=new ItemData,e._autoUseItem.bagIcon=17,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.item.cacheAsBitmap=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeDrugPanel()},e.prototype.onItemTouch=function(t){var e=t.target.parent;e&&e.itemData?null!=this._curSelectItem&&this._curSelectItem==e?this.useItemBySubType(e.itemData):(this.selectItem(e),t.target==e.btn_add&&(ButtonUtils.buttonTweenEffect(t.target),e.itemData.quantity>0?this.useItemBySubType(e.itemData):AlertPanel.alertCommon("物品已用完"))):e&&e.isAutoUse&&(null!=this._curSelectItem&&this._curSelectItem==e?ItemManager.doQuickAddHP(xself):(this.selectItem(e),this.label_desc.text=GameText.STR_ITEM_ONE_KEY_RECOVERY_INFO,t.target==e.btn_add&&(ButtonUtils.buttonTweenEffect(t.target),ItemManager.doQuickAddHP(xself))))},e.prototype.useItemBySubType=function(t){var n=1==t.quantity;if((t.isChestItem()||t.isPetEgg())&&(n=!0),this.subType==e.SUB_TYPE_WORLD_ITEM_LIST)ItemManager.doItem(t,n);else if(this.subType==e.SUB_TYPE_PET_ITEM_LIST){var i=xself,o=PanelManager.getPanel(PetDetailScene).detailPanel.getPet(),a=o.petItem;t.isPetSkillBook()?Skill.doUseLearnSkillItem(t,!0,o,a):t.isPetSealSkillBook()?Skill.doUsePetSealItemLearnSkill(t,!0,o,a):ItemManager.doWorldUseItemAction(i,t,n,a,o)}},e.prototype.checkClose=function(){var t=xself;this.subType==e.SUB_TYPE_PET_ITEM_LIST&&(0==t.bag.getCanUsePetItemList2().length&&PanelManager.closeDrugPanel())},e.prototype.selectItem=function(t){if(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0,this._curSelectItemData=this._curSelectItem.itemData;var e="";t.itemData?(this.item.itemData=t.itemData,e=t.itemData.getPowerDesc(),Tool.isNullText(e)&&(e=t.itemData.getInfo()),this.label_desc.textFlow=Tool.convertDescToTextFlow(e)):t.isAutoUse?(this.item.itemData=this._autoUseItem,this.label_desc.text=GameText.STR_ITEM_ONE_KEY_RECOVERY_INFO):(this.item.itemData=null,this.label_desc.text="")}else this.item.itemData=null,this.label_desc.text=""},e.prototype.setData=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=0),this._itemDataList=t,this._type=e,this.subType=n},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(this.init){var t,n;if(this.reset(),this._type==e.Type_drug&&((t=this.getItem()).isAutoUse=!0,t.setData(null),this.container.add(t),xself&&xself.bag?this._itemDataList=xself.bag.getCanUseItemList(1):this._itemDataList=null),this._itemDataList&&this._itemDataList.length>0)for(var i=0;i<this._itemDataList.length;i++)null!=(n=this._itemDataList[i])&&(0!=n.quantity?((t=this.getItem()).setData(n),this.container.add(t,0)):this._curSelectItemData==n&&(this._curSelectItemData=null));if(this.container.update(),null==this._curSelectItemData){var o=this.container.list[0];this.selectItem(o)}else{var a=this.container.list;if(a&&a.length>0){var r=!1;for(i=0;i<a.length;i++){if((o=a[i]).itemData&&o.itemData==this._curSelectItemData){this.selectItem(o),r=!0;break}}r||(this._curSelectItemData=null,this.selectItem(a[0]))}else this.selectItem(null),this._curSelectItemData=null}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new DrugItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t.isAutoUse=!1,t},e.Type_drug=1,e.Type_item=2,e.SUB_TYPE_WORLD_ITEM_LIST=0,e.SUB_TYPE_PET_ITEM_LIST=1,e.SUB_PET_ITEM_RESET2=2,e.SUB_PET_ITEM_RESET=3,e.SUB_PET_ITEM_ADD_SKILL=4,e.SUB_PET_ITEM_AGE=5,e}(ComponentBase);__reflect(DrugPanel.prototype,"DrugPanel");var Interface=function(){function t(){}return t.prototype.onBack=function(){console.log("Interface.onBack"),t.back()},t.prototype.onMenu=function(){},t.prototype.onReady=function(){xmicro=!0},t.prototype.onSearch=function(){},t.prototype.onShake=function(){console.log("Interface.onShake")},t.prototype.onPause=function(){console.log("Interface.onPause")},t.prototype.onResume=function(){console.log("Interface.onResume")},t.prototype.onStartCall=function(){},t.prototype.onEndCall=function(){},t.prototype.onOffline=function(){},t.prototype.onOnline=function(t){},t.prototype.onRotation=function(t){},t.prototype.onVolume=function(t){},t.prototype.onCreateShortcut=function(){},t.prototype.onLoadString=function(e){t.loadStringCallback&&t.loadStringCallback(e)},t.back=function(){xmicro&&t.backFunc&&t.backFunc()},t.ready=function(){xmicro&&t.reloadFunc&&t.readyFunc()},t.reload=function(){xmicro&&t.reloadFunc&&t.reloadFunc()},t.clearChannel=function(){xmicro&&t.reloadFunc&&t.clearChannelFunc()},t.gotoUrl=function(e){xmicro&&t.gotoUrlFunc&&t.gotoUrlFunc()},t.rotating=function(e){xmicro&&t.rotatingFunc&&t.rotatingFunc()},t.saveString=function(e,n){e="world-"+xgameid+"-"+xchannel+"-"+e,xmicro&&t.saveStringFunc?t.saveStringFunc(e,n):"safari"==nato.getBrowser()?Cookies.setItem(e,n):egret.localStorage.setItem(e,n)},t.loadString=function(e,n){if(e="world-"+xgameid+"-"+xchannel+"-"+e,xmicro&&t.loadStringFunc)t.loadStringCallback=n,t.loadStringFunc(e);else{n("safari"==nato.getBrowser()?Cookies.getItem(e):egret.localStorage.getItem(e))}},t.setAliasAndTags=function(e,n){xmicro&&t.setAliasAndTagsFunc&&t.setAliasAndTagsFunc(e,n)},t.createShortcut=function(e,n,i){xmicro&&t.createShortcutFunc&&t.createShortcutFunc(e,n,i)},t}();__reflect(Interface.prototype,"Interface");var xnato=new Interface,EscortItem=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._type=t,this.update()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this.img_select.visible=this._select,this.img_type.source="escort_"+this._type+(xhd?"_hd":"_sd"))},e}(ComponentBase);__reflect(EscortItem.prototype,"EscortItem");var EscortRobListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._escort=t},Object.defineProperty(e.prototype,"escort",{get:function(){return this._escort},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._escort&&(this.label_name.text=this._escort.getSimpleDesc()),this.img_select.visible=this._select)},e}(ComponentBase);__reflect(EscortRobListItem.prototype,"EscortRobListItem");var EscortRobListPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.onItemTouch=function(t){var e=t.target.parent;e&&e.escort&&(this.onSelectItem(e),t.target instanceof eui.Button?(ButtonUtils.buttonTweenEffect(t.target),this.onItemBtnAttack(e.escort)):AlertPanel.alertTips(GameText.STR_ESCORT_MISSION_TEAM,e.escort.getTeamDesc(),"center"))},e.prototype.onSelectItem=function(t){null!=t&&null!=t.escort&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.onItemBtnAttack=function(t){Escort.doEscortRobMsg(t)},e.prototype.setData=function(t){this._dataList=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._dataList&&0!=this._dataList.length)){for(var t=0;t<this._dataList.length;t++){var e=this._dataList[t],n=this.getItem();n.setData(e),n.select=!1,this.container.add(n)}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new EscortRobListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(EscortRobListPanel.prototype,"EscortRobListPanel");var EscortScene=function(t){function e(){var e=t.call(this)||this;return e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.headInfoView.setData(xself),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_mail,this.onBtnMail,this),ButtonUtils.addTouchEvent(this.btn_look,this.onBtnView,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnClose,this),null==this._itemList){this._itemList=[];for(var n=0;16>n;n++){var i=this["escortItem"+n];this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}nato.WorldTicker.instance.register(this.logic,this),0==this._escort.isInitPos&&(this._curSelectItem=null,this._escort.initModelPositon()),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_mail),ButtonUtils.removeTouchEvent(this.btn_look),ButtonUtils.removeTouchEvent(this.closeBtn);for(var n=0;n<this._itemList.length;n++){var i=this._itemList[n];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}this.group_spr.removeChildren(),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnMail=function(){PanelManager.openMailScene()},e.prototype.onBtnView=function(){Escort.doEscortListPlayer(this._escort)},e.prototype.onBtnClose=function(){Escort.doEscortPostQuitMsg()},e.prototype.onItemTouch=function(t){var e=t.target,n=this._itemList.indexOf(e);e&&n>=0&&e.type!=Escort.IMAGE_NO_PASS&&(Escort.doEscortMove(this._escort,n)&&this.onSelectItem(e))},e.prototype.onSelectItem=function(t){null!=t&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.getItemByIndex=function(t){return this._itemList[t]},e.prototype.setData=function(t){this._escort=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._escort){this.group_spr.removeChildren(),this._escort.escortModel&&this.group_spr.addChild(this._escort.escortModel),this._escort.robEscortModel&&this.group_spr.addChild(this._escort.robEscortModel);for(var t=0;t<this._itemList.length;t++){var e=this._escort.getEventImage(t);this._itemList[t].setData(e)}null!=this._curSelectItem&&(this._curSelectItem.select=!0),this.logic(1e3)}},e.prototype.logic=function(t){var e;(this._escort&&this._escort.logic(),this._logicCount+=t,this._logicCount<500||(this._logicCount=0,!this._escort))||(this._escort.type==Escort.ESCORT_TURN_HUN?(this.label_status.visible=!0,this.label_time.visible=!1,this.img_timeBg.visible=!1,e=0==this._escort.isRobMove()?this._escort.getHunInfo():"",this.label_status.text=e):(this.label_status.visible=!1,this.label_time.visible=!0,this.img_timeBg.visible=!0,e=0==this._escort.isMoveTime()?GameText.STR_ESCORT_WAIT+":"+PowerString.makeColorString(Tool.getPlanTimeString(this._escort.nextMoveTime),ColorUtils.COLOR_YELLOW):0==this._escort.isOverTimeMove()?GameText.STR_ESCORT_TIME+":"+PowerString.makeColorString(Tool.getPlanTimeString(this._escort.nextOverTime),ColorUtils.COLOR_YELLOW):GameText.STR_ESCORT_TIME_OUT,this.label_time.textFlow=Tool.convertDescToTextFlow(e)))},e}(ComponentBase);__reflect(EscortScene.prototype,"EscortScene");var NewEscort=function(t){function e(){var e=t.call(this)||this;return e.isInitPos=!1,e.myPosID=0,e.hunPosID=0,e._tempCount=0,e}return __extends(e,t),e.fromBytes=function(t,n){if(null==xself)return null;for(var i=t.getByte(),o=t.getInt(),a=t.getInt(),r=t.getShort(),s=t.getByte(),l=new Array(i),_=0;i>_;_++)l[_]=NewEscortPoint.fromNewEscortPoint(t);var h=0,u=0,c=0,T=0,p=-1,d=t.getByte();if(d==e.ESCORT_TURN_HUN)u=t.getInt(),c=t.getInt(),T=t.getInt(),h=t.getByte(),p=t.getByte();else{xself.clearFightPower();var E=t.getByte();for(_=0;E>_;_++)xself.addFightPower(t.getShort(),t.getShort());xself.checkHPMP()}var g=new e;return g.pointList=l,g.myPosID=s,g.hunPosID=p,g.type=d,g.round=r,d==e.ESCORT_TURN_HUN&&(g.setRobMove(h),g.robEscortModel=new ListPlayer,g.robEscortModel.setDir(1),g.robEscortModel.setPlayerSprite(GameSprite.cloneSprite(n)),g.robEscortModel.setAnimationByDir(!1),g.robEscortModel.sprite.setScale(xhd?1.5:1),g.robEscortModel.setPos(g.getHunPosXY(!0),g.getHunPosXY(!1)),n=SpriteHelper.createSpriteByIcon(u,c,T,!1)),g.escortModel=new ListPlayer,g.escortModel.setDir(0),g.escortModel.setPlayerSprite(n),g.escortModel.setAnimationByDir(!1),g.escortModel.sprite.setScale(xhd?1.5:1),g.nextMoveTime=Tool.currentTime+o,g.nextOverTime=Tool.currentTime+a,g.nextUpdateTime=Tool.currentTime+e.POST_UPDATE_TIME,g},e.prototype.setMyposXY=function(){var t=this.getMyPosXY(!0),e=this.getMyPosXY(!1);null!=this.escortModel&&this.escortModel.setPos(t,e)},e.prototype.setHunposXY=function(){var t=this.getHunPosXY(!0),e=this.getHunPosXY(!1);null!=this.robEscortModel&&this.robEscortModel.setPos(t,e)},e.prototype.getMyPosXY=function(t){var e=this.getNewEscortPointByID(this.myPosID);return null==e?-1:t?e.px*xhdRatio:e.py*xhdRatio},e.prototype.getHunPosXY=function(t){var e=this.getNewEscortPointByID(this.hunPosID);return null==e?-1:t?e.px*xhdRatio:e.py*xhdRatio},e.prototype.getNewEscortPointByID=function(t){if(null==this.pointList)return null;for(var e=0;e<this.pointList.length;e++){var n=this.pointList[e];if(null!=n&&n.id==t)return n}return null},e.prototype.logic=function(){this._tempCount+=1,this._tempCount>1e3&&(this._tempCount=0),0==Tool.isNullText(this.battleMsg)&&(AlertPanel.alertTips(GameText.getText(GameText.TI_MISSION_REWARD),this.battleMsg),this.battleMsg=null);var t=Tool.currentTime;if(null!=this.escortModel){if(this.escortModel.logic(this._tempCount),this.moveCount<this.moveMaxCount&&this.moveStartTime+this.moveCount*this.moveTime<t){this.moveCount++;var n=MapTool.getDirByMovePixels(this.moveDirX,this.moveDirY,!1);this.escortModel.getDir()!=n&&this.escortModel.setDir(n),this.escortModel.setAnimationByDir(!0);var i=this.moveDirX,o=this.moveDirY;this.escortModel.x==this.getMyPosXY(!0)&&(i=0),this.escortModel.y==this.getMyPosXY(!1)&&(o=0),this.escortModel.moveByPixel(i,o),this.moveCount==this.moveMaxCount&&(this.escortModel.setAnimationByDir(!1),this.clearAutoMove())}1==this.isMoveTime()&&0==this.isOverTimeMove()?1!=this.isStatus(e.STATUS_UPDATE_POS)&&this.setStatus(!0,e.STATUS_UPDATE_POS):this.setStatus(!1,e.STATUS_UPDATE_POS)}if(null!=this.robEscortModel&&this.robEscortModel.logic(this._tempCount),!(t<this.nextUpdateTime)){var a=MsgHandler.createEscortRefreshMsg(this.round);nato.Network.sendCmd(a,(function(t){Escort.processEscortRefreshMsg(t,GameWorld.getEscort())}),this),this.nextUpdateTime=t+e.POST_UPDATE_TIME}},e.isCanMove_newEScort=function(t,e){if(xself.isMember())return AlertPanel.alertCommon(GameText.STR_ESCORT_MOVE_IS_MEMBER),!1;if(null!=t.getEscortRobModel()){if(0==t.isRobMove())return AlertPanel.alertCommon(GameText.STR_ESCORT_ROB_MOVE),!1}else if(0==t.isMoveTime())return AlertPanel.alertCommon(GameText.STR_ESCORT_MOVE_COOL),!1;return 1!=t.isStatus(Escort.STATUS_MOVE)||(AlertPanel.alertCommon(GameText.STR_ESCORT_STATUS_MOVE),!1)},e.clearRefreshTime_newEscort=function(t){null!=t&&(t.nextUpdateTime=0)},e.doNewEscortMove=function(t,n){if(null==t||null==n)return!1;if(0==e.isCanMove_newEScort(t,n))return!1;var i=MsgHandler.createEscortMoveMsg(n.id,-1);return nato.Network.sendCmd(i,(function(n){var i=n.getByte();if(0>i)AlertPanel.errorMessage(n.getString());else{var o=i;if(0>=o)e.clearRefreshTime_newEscort(t);else{for(var a,r=n.getString(),s=(new Array(o),[]),l=0;o>l;l++){var _=n.getShort(),h=n.getString();a=new MenuActionData(h,_),s.push(a)}t.refreshTime(n.getInt(),n.getInt()),n.getByte()==Escort.NEWESCORT&&(t.myPosID=n.getByte()),PanelManager.openSelectMenuPanel(r,s,(function(e){Escort.doEscortEventMsg(t,e)}),this,PopUpManager.CloseType.NONE)}}}),this),!0},e.processEscrotRefreshPosMsg=function(t,e){var n=t.getByte(),i=t.getInt(),o=t.getInt(),a=t.getShort(),r=0,s=0;if(1==t.getBoolean()){r=t.getByte(),s=t.getByte();var l=t.getByte();null!=e&&(e.favourerStatus=l,e.setRobMove(r),e.hunPosID=s)}if(null!=e){e.myPosID=n,null!=e.escortModel&&e.doMove();var _=e.getNewEscortPointByID(e.myPosID);null!=_&&(_.isPass=!0),e.round=a,e.refreshTime(i,o);var h=e.robEscortModel;if(null!=h&&h.setPos(e.getHunPosXY(!0),e.getHunPosXY(!1)),PanelManager.isPanelShow(NewEscortScene))PanelManager.getPanel(NewEscortScene).update()}},e.prototype.doMove=function(){this.moveCount=0;var t,e=0,n=0,i=this.escortModel.x-this.getMyPosXY(!0),o=this.escortModel.y-this.getMyPosXY(!1);t=Math.abs(i)>=Math.abs(o)?Math.abs(i):Math.abs(o),i>0?e=-1:0==i?e=0:0>i&&(e=1),o>0?n=-1:0==o?n=0:0>o&&(n=1),(0!=e||0!=n)&&t>0?(this.moveMaxCount=t,this.moveTime=Math.floor((this.nextMoveTime-Tool.currentTime)/t),this.moveStartTime=Tool.currentTime,this.moveDirX=e,this.moveDirY=n):this.escortModel.setPos(this.getMyPosXY(!0),this.getMyPosXY(!1))},e.doEscortRobListMsg=function(t,n){var i=MsgHandler.createNewEscortRobList(t,n);nato.Network.sendCmd(i,(function(t){for(var n=(t.getShort(),t.getByte()),i=[],o=0;n>o;o++){var a=new e;a.setId(t.getInt()),a.setMoney1(t.getInt()),a.setMoney2(t.getInt()),a.setMoney3(t.getInt());for(var r=t.getByte(),s=[],l=0;r>l;l++){var _=new Model(3);_.setName(t.getString()),_.setLevel(t.getByte()),_.setJob(t.getByte()),_.setType(t.getByte()),s.push(_),0==l&&a.setSimpleDesc(Tool.manageStringList(GameText.STR_ESCORT_SIMPLE_DESC,[r+"",_.getName()]))}a.setTeamDesc(Escort.getModelListDesc(s)),i.push(a)}}),this)},e}(Escort);__reflect(NewEscort.prototype,"NewEscort");var NewEscortItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e._icon=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e){this._point=t,this._icon=e},Object.defineProperty(e.prototype,"point",{get:function(){return this._point},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this.img_select.visible=this._select,this.img_type.source="escort_"+this._icon+(xhd?"_hd":"_sd"))},e}(ComponentBase);__reflect(NewEscortItem.prototype,"NewEscortItem");var NewEscortPoint=function(){function t(){this.id=0,this.px=0,this.py=0,this.isPass=!1,this.icon=0}return t.fromNewEscortPoint=function(e){var n=new t;n.id=e.getInt(),n.icon=e.getByte();var i=e.getShort(),o=e.getShort();n.isPass=e.getBoolean(),n.px=i,n.py=o;var a=e.getByte();n.connectID=new Array(a);for(var r=0;a>r;r++)n.connectID[r]=e.getByte();return n},t.prototype.getImageIcon=function(){return 0==this.isPass?Escort.IMAGE_DEFAULT:this.icon},t.STATUS_NO_PASS=0,t.STATUS_PASS=1,t.STATUS_NEXT_PASS=2,t}();__reflect(NewEscortPoint.prototype,"NewEscortPoint");var NewEscortScene=function(t){function e(){var e=t.call(this)||this;return e._isInitScene=!1,e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.headInfoView.setData(xself),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_mail,this.onBtnMail,this),ButtonUtils.addTouchEvent(this.btn_look,this.onBtnView,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnClose,this),null==this._itemList){this._itemList=[];for(var n=0;13>n;n++){var i=this["item"+n];this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}nato.WorldTicker.instance.register(this.logic,this),this.update(),this.initScene(),this._escort&&!this._escort.isInitPos?(this._escort.isInitPos=!0,this._escort.setMyposXY(),this._escort.setHunposXY(),this._curSelectItem):this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_mail),ButtonUtils.removeTouchEvent(this.btn_look),ButtonUtils.removeTouchEvent(this.closeBtn);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this._escort&&(this._escort.escortModel&&this._escort.escortModel.parent&&this._escort.escortModel.parent.removeChild(this._escort.escortModel),this._escort.robEscortModel&&this._escort.robEscortModel.parent&&this._escort.robEscortModel.parent.removeChild(this._escort.robEscortModel)),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnMail=function(){PanelManager.openMailScene()},e.prototype.onBtnView=function(){NewEscort.doEscortListPlayer(this._escort)},e.prototype.onBtnClose=function(){NewEscort.doEscortPostQuitMsg()},e.prototype.onItemTouch=function(t){var e=t.target,n=this._itemList.indexOf(e);e&&n>=0&&e.point&&(NewEscort.doNewEscortMove(this._escort,e.point)&&this.onSelectItem(e))},e.prototype.onSelectItem=function(t){null!=t&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.getItemByIndex=function(t){return this._itemList[t]},e.prototype.setData=function(t){this._escort=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._escort){this.group_spr.removeChildren(),this._escort.escortModel&&this.group_spr.addChild(this._escort.escortModel),this._escort.robEscortModel&&this.group_spr.addChild(this._escort.robEscortModel);for(var t=0;t<this._itemList.length;t++){var e,n=this._escort.pointList[t],i=this._itemList[t];e=0==t?Escort.IMAGE_START:t==this._itemList.length-1?Escort.IMAGE_END:n.getImageIcon(),i.setData(n,e),i.update()}this.logic(1e3)}},e.prototype.logic=function(t){var e;(this._escort&&this._escort.logic(),this._logicCount+=t,this._logicCount<500||(this._logicCount=0,!this._escort))||(this._escort.type==Escort.ESCORT_TURN_HUN?(this.label_status.visible=!0,this.label_time.visible=!1,this.img_timeBg.visible=!1,e=0==this._escort.isRobMove()?this._escort.getHunInfo():"",this.label_status.text=e):(this.label_status.visible=!1,this.label_time.visible=!0,this.img_timeBg.visible=!0,e=0==this._escort.isMoveTime()?GameText.STR_ESCORT_WAIT+":"+PowerString.makeColorString(Tool.getPlanTimeString(this._escort.nextMoveTime),ColorUtils.COLOR_YELLOW):0==this._escort.isOverTimeMove()?GameText.STR_ESCORT_TIME+":"+PowerString.makeColorString(Tool.getPlanTimeString(this._escort.nextOverTime),ColorUtils.COLOR_YELLOW):GameText.STR_ESCORT_TIME_OUT,this.label_time.textFlow=Tool.convertDescToTextFlow(e)))},e.prototype.initScene=function(){function t(t){var e=o._itemList[t];o._lineBg.graphics.moveTo(e.x+e.width/2,e.y+e.height/2)}function e(t){var e=o._itemList[t];o._lineBg.graphics.lineTo(e.x+e.width/2,e.y+e.height/2)}if(!this._isInitScene&&null!=this._itemList&&0!=this._itemList.length){this._isInitScene=!0;for(var n=0;n<this._itemList.length;n++){(i=this._itemList[n])&&i.point&&(i.x=i.point.px*xhdRatio-i.width/2,i.y=i.point.py*xhdRatio-i.height/2)}var i,o=this;i=this._itemList[0],this._lineBg=new egret.Shape,this._lineBg.touchEnabled=!1,this._lineBg.graphics.clear(),this._lineBg.alpha=1,this._lineBg.graphics.lineStyle(10,16730112),t(0),e(1),e(2),e(3),t(2),e(4),e(5),e(6),e(7),e(8),e(9),e(10),e(12),t(9),e(11),this._lineBg.graphics.endFill(),this._lineBg.cacheAsBitmap=!0,this.addChildAt(this._lineBg,1)}},e}(ComponentBase);__reflect(NewEscortScene.prototype,"NewEscortScene");var ExchangeMoneyHandler=function(){function t(){}return t.process=function(e){t.maxCount=e.getInt(),t.usedCount=e.getInt(),t.lastUsedDay=e.getInt(),t.money2Cost=e.getInt(),t.money1Get=e.getInt()},t.startExchange=function(e,n,i){PanelManager.openWaitForServer();var o=MsgHandler.createExchangeMoneyMsg();nato.Network.sendCmd(o,(function(n){return PanelManager.closeWaitForServer(),0>n.getByte()?void AlertPanel.errorMessage(n.getString()):(xself.money1=n.getInt(),xself.money2=n.getInt(),xself.money3=n.getInt(),t.maxCount=n.getInt(),t.usedCount=n.getInt(),t.lastUsedDay=n.getInt(),t.money2Cost=n.getInt(),WorldMessage.addTips(Tool.manageString(PowerString.makeColorString(GameText.EXCHANGE_MONEY_SUCCESS,ColorUtils.COLOR_YELLOW),t.money1Get+"")),void e.call(i,!1))}),this)},t.isExchangeMoneyOpen=!1,t.maxCount=0,t.usedCount=0,t.lastUsedDay=0,t.money2Cost=0,t.money1Get=0,t}();__reflect(ExchangeMoneyHandler.prototype,"ExchangeMoneyHandler");var ExchangeMoneyPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_exchange,this.beginExchange,this),this.initPanel(!0)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_exchange),Tool.removeObjSafe(this.eff),this.eff=null},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.initPanel=function(t){if(ExchangeMoneyHandler.maxCount>0){var e=new Date;Math.floor(e.getTime()/1e3/24/3600)>ExchangeMoneyHandler.lastUsedDay&&(ExchangeMoneyHandler.usedCount=0)}var n=ExchangeMoneyHandler.maxCount-ExchangeMoneyHandler.usedCount;this.label_desc.textFlow=Tool.convertDescToTextFlow(GameText.EXCHANGE_MONEY_DESC),this.label_cost.text=(0==n?0:0==ExchangeMoneyHandler.money2Cost?GameText.EXCHANGE_MONEY_COST_FREE:ExchangeMoneyHandler.money2Cost)+"",this.label_get.text=(0==n?0:ExchangeMoneyHandler.money1Get)+"",this.label_count.textFlow=Tool.convertDescToTextFlow(GameText.EXCHANGE_MONEY_CONST+PowerString.makeColorString(n+"",ColorUtils.COLOR_YELLOW_GOLD)),t||this.effect()},e.prototype.beginExchange=function(){return 0!=SafeLock.doSafeLockVerify()?ExchangeMoneyHandler.maxCount-ExchangeMoneyHandler.usedCount<=0?void WorldMessage.addTips(GameText.EXCHANGE_MONEY_NO_COUNT):void Model.checkEnoughMoney(0,ExchangeMoneyHandler.money2Cost,0,this.send,this):void 0},e.prototype.send=function(){ExchangeMoneyHandler.startExchange(this.initPanel,!1,this)},e.prototype.effect=function(){this.eff?(this.eff.parent||this.showEff(),this.eff.gotoAndPlay(1)):(this.eff=new MovieClip("levelup",1,function(){this.eff.setRate(3),this.eff.play(),this.eff.x=111*xhdRatio,this.eff.y=99*xhdRatio,this.eff.scaleX=this.eff.scaleY=1.2*xhdRatio,this.showEff()}.bind(this),this),this.eff.load())},e.prototype.showEff=function(){this.img_box.parent.addChild(this.eff),this.img_box.parent.swapChildren(this.eff,this.img_box)},e}(WindowPanelBase);__reflect(ExchangeMoneyPanel.prototype,"ExchangeMoneyPanel");var FollowPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_follow)},e.prototype.initPanel=function(){ButtonUtils.addTouchEvent(this.btn_follow,this.onFollow,this),this.label_money.text=200+GameText.STR_MONEY2},e.prototype.onFollow=function(){PanelManager.openWaitForServer();var t=MsgHandler.createFollow();nato.Network.sendCmd(t,(function(t){PanelManager.closeWaitForServer();var e=t.getByte();if(-1==e||-3==e)AlertPanel.alertCommon(t.getString());else if(-2==e)Sdk.xsdk.follow();else if(0==e){var n=t.getInt(),i=n-xself.money2;xself.money2=n,AlertPanel.alertCommon(GameText.FOLLOW_GET_REWARD+i+GameText.STR_MONEY2),xworld.isFollow=!1,PanelManager.updateWorldTopMenu(),PanelManager.closeFollowPanel()}}),this)},e}(WindowPanelBase);__reflect(FollowPanel.prototype,"FollowPanel");var ForgeBagView=function(t){function e(){var e=t.call(this)||this;return e._curMaskItemDataList=[],e._bagType=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._bagBtnList&&(this._bagBtnList=[this.btn_bag_1,this.btn_bag_2,this.btn_bag_3]),null==this._itemList){this._itemList=new Array;for(var n=0;28>n;n++){var i=this["item"+n];this._itemList.push(i)}}for(n=0;n<this._bagBtnList.length;n++){this._bagBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBagBtnTouch,this)}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.comboBox_type.addEventListener(egret.Event.CHANGE,this.onComboTypeChange,this),this.initCombo(),this._bagIndex=0,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=1;n<this._bagBtnList.length;n++){this._bagBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBagBtnTouch,this)}for(n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.comboBox_type.removeEventListener(egret.Event.CHANGE,this.onComboTypeChange,this),this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=null,this._curSelectItemData=null,this._itemSelectCallbackFunc=null,this._thisObj=null,this._bagType=null,this._comboboxData=null},e.prototype.onBagBtnTouch=function(t){var e=t.target,n=this._bagBtnList.indexOf(e);n>=0&&n!=this._bagIndex&&(this._bagIndex=n,this.update())},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=e,this._curSelectItemData=e.itemData,this._curSelectItem.select=!0,null!=this._itemSelectCallbackFunc&&this._itemSelectCallbackFunc.call(this._thisObj,e.itemData))},e.prototype.onComboTypeChange=function(t){this.dispatchEventWith(egret.Event.CHANGE)},e.prototype.setBagType=function(t){this._bagType=t,this._bagType==e.BagType_identify?(this._comboboxData=[],this._comboboxData.push({value:ForgeScene.ComboType_normal,label:"普通鉴定"}),this._comboboxData.push({value:ForgeScene.ComboType_upgrade,label:"进阶鉴定"})):this._bagType==e.BagType_star?(this._comboboxData=[],this._comboboxData.push({value:ForgeScene.ComboType_normal,label:"普通升星"}),this._comboboxData.push({value:ForgeScene.ComboType_upgrade,label:"进阶升星"})):this._comboboxData=null},e.prototype.setData=function(t,e,n){this._itemDataList=t,this._itemSelectCallbackFunc=e,this._thisObj=n},e.prototype.setSelectItem=function(t){this._curSelectItemData=t},e.prototype.addMaskItem=function(t){t&&(this.checkIsMask(t)||this._curMaskItemDataList.push(t),this.updateMask())},e.prototype.removeMaskItem=function(t){if(t){var e=this._curMaskItemDataList.indexOf(t);-1!=e&&(this._curMaskItemDataList.splice(e,1),this.updateMask())}},e.prototype.clearMask=function(){this._curMaskItemDataList.length=0,this.updateMask()},e.prototype.updateMask=function(){if(this.init)for(var t=0;t<this._itemList.length;t++){var e=this._itemList[t];e&&e.visible&&(this.checkIsMask(e.itemData)?e.isMask=!0:e.isMask=!1)}},e.prototype.checkIsMask=function(t){return!!(t&&this._curMaskItemDataList&&this._curMaskItemDataList.length>0&&-1!=this._curMaskItemDataList.indexOf(t))},Object.defineProperty(e.prototype,"selectItem",{get:function(){return this._curSelectItem},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t=0;t<this._itemList.length;t++){this._itemList[t].reset()}},e.prototype.update=function(){if(this.init&&(this.reset(),ButtonUtils.selectTabBtnList(this._bagBtnList,this._bagIndex),this.moneyView.setData(xself),this.moneyView.update(),this._itemDataList&&this._itemDataList.length>0))for(var t=PlayerBag.MAX_BAG_NUM*PlayerBag.EACH_BAG_SIZE,e=this._itemList.length*this._bagIndex,n=0;n<this._itemList.length;n++){var i=this._itemList[n],o=e+n;if(o>=t)i.visible=!1;else{i.visible=!0;var a=this._itemDataList[o];i.itemData=a,this._curSelectItemData&&this._curSelectItemData==a?(i.select=!0,this._curSelectItem=i):i.select=!1,this.checkIsMask(a)?i.isMask=!0:i.isMask=!1,a&&a.isEquited()?i.isEquiped=!0:i.isEquiped=!1}}},e.prototype.initCombo=function(){this.init&&(null==this._comboboxData?this.comboBox_type.visible=!1:(this.comboBox_type.visible=!0,this.comboBox_type.data=this._comboboxData,this.comboBox_type.select=0))},e.prototype.getComboType=function(){return this.comboBox_type.visible?this.comboBox_type.select:0},e.BagType_identify=1,e.BagType_star=2,e}(ComponentBase);__reflect(ForgeBagView.prototype,"ForgeBagView");var ForgeDecomposePanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._itemDataList=[],e._price=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._tempMultipleItem&&(this._tempMultipleItem=new ItemData,this._tempMultipleItem.bagIcon=35,this._tempMultipleItem.grade=3),ButtonUtils.addTouchEvent(this.btn_decompose,this.onBtnDecompose,this),this.reset(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_decompose)},e.prototype.onBtnDecompose=function(){ItemManager.doItemIntegral_1(this._itemDataList,this.onDecomposeOverBack,this)},e.prototype.reset=function(){this.init&&(this._itemDataList=[],this._price=0,this.bagView.clearMask(),this.addMoney(0))},e.prototype.update=function(){if(this.init){var t=xself;if(null!=t&&null!=t.bag)if(t.getLevel()<30)this.label_openLv.visible=!0,this.label_tips.visible=!1,this.label_desc.visible=!1,this.label_money.visible=!1,this.container.visible=!1,this.btn_decompose.visible=!1,this.bagView.visible=!1;else{this.label_openLv.visible=!1,this.label_tips.visible=!0,this.label_desc.visible=!0,this.label_money.visible=!0,this.container.visible=!0,this.btn_decompose.visible=!0,this.bagView.visible=!0;var e=t.bag.getCanDecomposeItemList();this.bagView.setData(e,this.onItemTouch,this),this.bagView.update(),this.updateSelect()}}},e.prototype.onItemTouch=function(t){null!=t&&(-1!=this._itemDataList.indexOf(t)?PanelManager.openItemSelectView(t,"取下分解",this.onItemSelect,this):PanelManager.openItemSelectView(t,"放入分解",this.onItemSelect,this))},e.prototype.onItemSelect=function(t){var e=this._itemDataList.indexOf(t);if(-1!=e)this._itemDataList.splice(e,1),this.bagView.removeMaskItem(t),this.updateSelect(),this.addMoney(-t.price/2);else{if(this._itemDataList.length>=30)return void AlertPanel.alertCommon(GameText.STR_RESOLVE_NUM_OVER);this._itemDataList.push(t),this.bagView.addMaskItem(t),this.updateSelect(!0),this.addMoney(t.price/2)}},e.prototype.addMoney=function(t){this._price+=t;var e="需要收费(铜币)："+PowerString.makeColorString(this._price.toString(),ColorUtils.COLOR_WHITE);this.label_money.textFlow=Tool.convertDescToTextFlow(e)},e.prototype.onDecomposeOverBack=function(){this.reset(),this.update()},e.prototype.updateSelect=function(t){void 0===t&&(t=!1),0==this._itemDataList.length?(this.item.itemData=null,this.img_itemAdd.visible=!0,this.label_tips.visible=!0,this.label_tips.text="* 注意装备分解后无法还原"):1==this._itemDataList.length?(this.item.itemData=this._itemDataList[0],this.img_itemAdd.visible=!1,this.label_tips.visible=!0,this.label_tips.text="* 可以选择多个物品一起分解"):(this.item.itemData=this._tempMultipleItem,this.img_itemAdd.visible=!1,this.label_tips.visible=!1),this.container.reset(),this._index=0;var e=10;this.container.add(this.label_desc,10,e),e+=30;for(var n=0;n<this._itemDataList.length;n++){var i=this.getItem(),o=this._itemDataList[n];i.itemData=o,this.container.add(i,10,e),e+=i.height+5}this.container.update(),t&&this.container.updateToBottom()},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new Item2,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ForgeDecomposePanel.prototype,"ForgeDecomposePanel");var ForgeEnchantPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._itemDataList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._tempMultipleItem&&(this._tempMultipleItem=new ItemData,this._tempMultipleItem.bagIcon=35,this._tempMultipleItem.grade=3),ButtonUtils.addTouchEvent(this.btn_enchant,this.onBtnEnchant,this),this._itemDataList=[],this.bagView.clearMask(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_enchant)},e.prototype.onBtnEnchant=function(){Enchant.doItemEnChant(this._itemDataList,Enchant.ENCHANT_TYPE_SEE,this.onEnchantOverBack,this)},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){var t=xself;if(null!=t&&null!=t.bag){var e="当前附魔值："+PowerString.makeColorString(t.getEnchantValue()+"/10000",ColorUtils.COLOR_WHITE);if(this.label_value.textFlow=Tool.convertDescToTextFlow(e),t.getLevel()<30)this.label_openLv.visible=!0,this.label_tips.visible=!1,this.label_desc.visible=!1,this.btn_enchant.visible=!1,this.container.visible=!1,this.bagView.visible=!1;else{this.label_openLv.visible=!1,this.label_tips.visible=!0,this.label_desc.visible=!0,this.btn_enchant.visible=!0,this.container.visible=!0,this.bagView.visible=!0;var n=t.bag.getCanEnchantItemList();this.bagView.setData(n,this.onItemTouch,this),this.bagView.update(),this.updateSelect()}}}},e.prototype.onItemTouch=function(t){null!=t&&(-1!=this._itemDataList.indexOf(t)?PanelManager.openItemSelectView(t,"取下吸收",this.onItemSelect,this):PanelManager.openItemSelectView(t,"放入吸收",this.onItemSelect,this))},e.prototype.onItemSelect=function(t){var e=this._itemDataList.indexOf(t);if(-1!=e)this._itemDataList.splice(e,1),this.bagView.removeMaskItem(t),this.updateSelect();else{if(this._itemDataList.length>=30)return void AlertPanel.alertCommon(GameText.STR_RESOLVE_NUM_OVER);this._itemDataList.push(t),this.bagView.addMaskItem(t),this.updateSelect(!0)}},e.prototype.onEnchantOverBack=function(){this._itemDataList=[],this.bagView.clearMask(),this.update()},e.prototype.updateSelect=function(t){void 0===t&&(t=!1),0==this._itemDataList.length?(this.item.itemData=null,this.img_itemAdd.visible=!0,this.label_tips.visible=!0):1==this._itemDataList.length?(this.item.itemData=this._itemDataList[0],this.img_itemAdd.visible=!1,this.label_tips.visible=!0):(this.item.itemData=this._tempMultipleItem,this.img_itemAdd.visible=!1,this.label_tips.visible=!1),this.container.reset(),this._index=0;var e=10;this.container.add(this.label_desc,10,e),e+=30;for(var n=0;n<this._itemDataList.length;n++){var i=this.getItem(),o=this._itemDataList[n];i.itemData=o,this.container.add(i,10,e),e+=i.height+5}this.container.update(),t&&this.container.updateToBottom()},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new Item2,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ForgeEnchantPanel.prototype,"ForgeEnchantPanel");var ForgeGemPanel=function(t){function e(){var e=t.call(this)||this;return e._bagEquip=null,e._isGetGem=!1,e._isGetEquip=!1,e._btnActionX1=180*xhdRatio,e._btnActionX2=227*xhdRatio,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_action,this.onBtnAction,this),ButtonUtils.addTouchEvent(this.btn_replace,this.onBtnReplace,this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipGridTouch,this),this.item1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGemGridTouch,this),this.item.select=!1,this.item1.select=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_action),ButtonUtils.removeTouchEvent(this.btn_replace),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipGridTouch,this),this.item1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGemGridTouch,this),this._selectItemData=null,this._selectGem=null,this._bagEquip=null,this._isGetGem=!1,this._isGetEquip=!1},e.prototype.onEquipGridTouch=function(t){this.item.select=!0,this.item1.select=!1,this.updateBag(null,!1,!0)},e.prototype.onGemGridTouch=function(t){this.item.select=!1,this.item1.select=!0,this.updateBag(this._selectItemData,!0,!1)},e.prototype.onBtnAction=function(){return null!=this._selectItemData?null==this._selectGem?void AlertPanel.alertMaterialLess("请放入宝石！",ItemGet.Type_gem):this._selectItemData.attachDone>0&&0==this._selectItemData.isAttackBroken()&&this._selectItemData.attachDone<=20&&this._selectItemData.attachPower!=this._selectGem.power1?void AlertPanel.alertCommon("相同类型宝石才能镶嵌！"):void ItemManager.doWorldAttachItemAction(xself,this._selectItemData,this._selectGem):void 0},e.prototype.onBtnReplace=function(){if(null!=this._selectItemData){if(null==this._selectGem)return void AlertPanel.alertMaterialLess("请放入宝石！",ItemGet.Type_gem);if(this._selectItemData.attachValue<20)return void AlertPanel.alertCommon("镶嵌值大于20才可用其他宝石替换");var t="宝石替换时，需要原镶嵌宝石的/cffff002/p倍!\n本次替换需要消耗/c00ff00"+2*this._selectItemData.attachDone+"/p颗宝石,\n是否替换？";AlertPanel.alert("宝石替换",t,(function(){ItemManager.doWorldAttachChangeGemSelect(this._selectGem,this._selectItemData)}),this)}},e.prototype.setdata=function(t){this._selectItemData=t},e.prototype.reset=function(){this.init},e.prototype.onItemTouch=function(t){null!=t&&(t.isCanEquip()?PanelManager.openItemSelectView(t,"确认镶嵌",this.onItemSelect,this):PanelManager.openItemSelectView(t,"放入宝石",this.onGemSelect,this))},e.prototype.onItemSelect=function(t){return this.init?(this.bagView.removeMaskItem(this._selectItemData),this._selectItemData=t,this.updateSelect(),void(this._selectGem&&this._selectItemData&&(this._selectItemData.attachDone>0&&this._selectItemData.attachPower==this._selectGem.power1||this.onGemSelect(null)))):void(this._selectItemData=t)},e.prototype.updateSelect=function(t){if(void 0===t&&(t=!0),this._selectItemData){this.bagView.addMaskItem(this._selectItemData),this.bagView.setSelectItem(this._selectItemData),this.img_itemAdd.visible=!1,this.item.itemData=this._selectItemData,this.label_done.text=this._selectItemData.attachDone+"/"+this._selectItemData.attachCount,this.label_successRate.text=this._selectItemData.getAttachRateDesc();var e="";this._selectItemData.attachDone>0&&(e=PowerString.makeColorString(Define.getPowerDesc(this._selectItemData.attachPower,this._selectItemData.attachValue),ColorUtils.COLOR_GREEN)),this.label_desc.textFlow=Tool.convertDescToTextFlow(e)}else this.img_itemAdd.visible=!0,this.item.itemData=null,this.label_desc.text="",this.label_successRate.text="",this.label_done.text="";this.updateBtns(),t&&(this._selectItemData&&this._selectItemData.isAttackBroken()?this.updateResult(PowerString.makeColorString(GameText.STR_WORLD_ITEM_ATTACH_WARN,ColorUtils.COLOR_RED)):this.updateResult(null))},e.prototype.onGemSelect=function(t){return this.init?(this.bagView.removeMaskItem(this._selectGem),this._selectGem=t,void(this._selectGem?(this.bagView.addMaskItem(this._selectGem),this.item1.itemData=this._selectGem,this.img_itemAdd1.visible=!1):(this.item1.itemData=null,this.img_itemAdd1.visible=!0))):void(this._selectGem=t)},e.prototype.update=function(){this.init&&(this.bagView.clearMask(),this.updateBag(this._selectItemData,!0,!0),this.onItemSelect(this._selectItemData),this.onGemSelect(this._selectGem))},e.prototype.updateBag=function(t,e,n){var i,o=xself;null!=o&&null!=o.bag&&(this._bagEquip=t,this._isGetGem=e,this._isGetEquip=n,i=null!=t?o.bag.getAttachGemItemList(t):o.bag.getGemAndEquipList(e,n),this.bagView.setData(i,this.onItemTouch,this),this.bagView.update())},e.prototype.updateResult=function(t){this.label_tips.textFlow=null==t?Tool.convertDescToTextFlow("/cffff00当装备宝石基础属性超过/c00ff0020/p时，可用其他宝石替换。/p"):Tool.convertDescToTextFlow(t)},e.prototype.updateBtns=function(){null!=this._selectItemData&&this._selectItemData.attachValue>=20&&ItemData.isReplaceInlayGem(this._selectItemData.attachPower)?(this.btn_action.x=this._btnActionX2,this.btn_replace.visible=!0):(this.btn_action.x=this._btnActionX1,this.btn_replace.visible=!1)},e.prototype.updateFromServer=function(t){this.updateSelect(!1),this.updateResult(t),this._selectGem&&this._selectGem.quantity>0?this.onGemSelect(this._selectGem):this.onGemSelect(null),this._isGetGem&&this.updateBag(this._bagEquip,this._isGetGem,this._isGetEquip)},e}(ComponentBase);__reflect(ForgeGemPanel.prototype,"ForgeGemPanel");var ForgeIdentifyPanel=function(t){function e(){var e=t.call(this)||this;return e._comboType=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_identify5.visible=!1,ButtonUtils.addTouchEvent(this.btn_identify,this.onBtnIdentify,this),ButtonUtils.addTouchEvent(this.btn_identify5,this.onBtnIdentify5,this),ButtonUtils.addTouchEvent(this.btn_continue,this.onBtnContinue,this),ButtonUtils.addTouchEvent(this.btn_replace,this.onBtnReplace,this),this.bagView.addEventListener(egret.Event.CHANGE,this.onBagComboTypeChange,this),this.bagView.setBagType(ForgeBagView.BagType_identify),this._comboType=this.bagView.getComboType(),null!=ItemManager.save_identify5_item&&(this._selectItemData=ItemManager.save_identify5_item,ItemManager.save_identify5_item=null),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_identify),ButtonUtils.removeTouchEvent(this.btn_continue),ButtonUtils.removeTouchEvent(this.btn_replace),this.bagView.addEventListener(egret.Event.CHANGE,this.onBagComboTypeChange,this),this._selectItemData=null},e.prototype.onBtnIdentify=function(){var t=!1;this._comboType==ForgeScene.ComboType_upgrade&&(t=!0),ItemManager.doWorldIdentifyItemAction(xself,this._selectItemData,!1,t,!1)},e.prototype.onBtnIdentify5=function(){var t=!1;this._comboType==ForgeScene.ComboType_upgrade&&(t=!0),ItemManager.doWorldIdentifyItemAction(xself,this._selectItemData,!1,t,!0)},e.prototype.onBtnContinue=function(){var t=!1;this._comboType==ForgeScene.ComboType_upgrade&&(t=!0),ItemManager.doWorldIdentifyItemAction(xself,this._selectItemData,!1,t)},e.prototype.onBtnReplace=function(){var t=!1;this._comboType==ForgeScene.ComboType_upgrade&&(t=!0);ItemManager.doIdentifyReplace(t,0)},e.prototype.onBagComboTypeChange=function(t){this._comboType=this.bagView.getComboType(),this.update()},e.prototype.setdata=function(t){this._selectItemData=t},e.prototype.reset=function(){this.init&&(this.bagView.reset(),this.item.reset(),this.container.reset())},e.prototype.update=function(){if(this.init){var t=xself;if(null!=t&&null!=t.bag){var e=!1;this._comboType==ForgeScene.ComboType_upgrade&&(e=!0);var n=PlayerBag.getIdentifyItemVector(t,e);this.bagView.setData(n,this.onItemTouch,this),this.bagView.update(),this.updateItemCount(),this.checkSelect(),this.onItemSelect(this._selectItemData)}}},e.prototype.updateItemCount=function(){if(this._comboType==ForgeScene.ComboType_upgrade){var t=0;xself&&null!=xself.bag&&(t=xself.bag.getUpgradeIdentifyScrollNum()),this.label_commonCount.textFlow=Tool.convertDescToTextFlow("剩余进阶卷轴:"+PowerString.makeColorString(t+"个",ColorUtils.COLOR_YELLOW)),this.label_seniorCount.visible=!1}else{var e=0,n=0,i=xself;(null!=i||null!=i.bag)&&(e=i.bag.getIdentifyScrollNum(),n=i.bag.getHighIdentifyScrollNum()),this.label_commonCount.textFlow=Tool.convertDescToTextFlow("剩余普通卷轴:"+PowerString.makeColorString(e+"个",ColorUtils.COLOR_YELLOW)),this.label_seniorCount.textFlow=Tool.convertDescToTextFlow("剩余高级卷轴:"+PowerString.makeColorString(n+"个",ColorUtils.COLOR_YELLOW)),this.label_seniorCount.visible=!0}},e.prototype.onItemTouch=function(t){null!=t&&PanelManager.openItemSelectView(t,"确认鉴定",this.onItemSelect,this)},e.prototype.onItemSelect=function(t){if(this._selectItemData=t,this.init){if(this.btn_continue.visible=!1,this.btn_replace.visible=!1,this.btn_identify.visible=!0,this._comboType==ForgeScene.ComboType_upgrade?this.btn_identify.label="进阶鉴定":this.btn_identify.label="鉴定",this.container.reset(!0),this.bagView.clearMask(),this.bagView.addMaskItem(this._selectItemData),this.bagView.setSelectItem(this._selectItemData),this._selectItemData){var e;e=this._comboType==ForgeScene.ComboType_upgrade?Tool.convertDescToTextFlow(this._selectItemData.getUpgradeIdentifyInfo()):Tool.convertDescToTextFlow(this._selectItemData.getIdentifyInfo()),this.label_desc.textFlow=e,this.container.add(this.label_desc,5,10),this.img_itemAdd.visible=!1,this.item.itemData=this._selectItemData}else this.item.itemData=null,this.img_itemAdd.visible=!0,this.label_desc.text="";this.container.update()}},e.prototype.checkSelect=function(){this._comboType==ForgeScene.ComboType_upgrade&&null!=this._selectItemData&&(this._selectItemData.isUpgradeItem||(this._selectItemData=null))},e.prototype.updateFromServer=function(t,e){this.label_desc.textFlow=Tool.convertDescToTextFlow(t),this.container.reset(),this.container.add(this.label_desc,5,10),this.container.update(),this.updateItemCount(),e?(this.btn_continue.visible=!0,this.btn_replace.visible=!0,this.btn_identify.visible=!1,this.btn_identify5.visible=!1):(this.btn_continue.visible=!1,this.btn_replace.visible=!1,this.btn_identify.visible=!0,this.btn_identify.label="继续鉴定")},e.prototype.onPowerConfirm=function(t,e){void 0===e&&(e=!1),0>t||ItemManager.doIdentifyReplace(e,t)},e.prototype.updateFromServerMulti=function(t,e,n){1==t.length?(this.label_desc.textFlow=Tool.convertDescToTextFlow(t[0]),this.container.reset(),this.container.add(this.label_desc,5,10),this.container.update()):(n?t.splice(0,0,e.getUpgradeIdentifyInfo()):t.splice(0,0,e.getIdentifyInfo()),ItemManager.save_identify5_item=e,PanelManager.openForgeMultiPanel(t,this.onPowerConfirm,this,n)),this.updateItemCount(),this.btn_continue.visible=!1,this.btn_replace.visible=!1,this.btn_identify.visible=!0},e}(ComponentBase);__reflect(ForgeIdentifyPanel.prototype,"ForgeIdentifyPanel");var ForgeMultiPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.powerList.itemRenderer=ForgePowerItem,ButtonUtils.addTouchEvent(this.btn_ok,this.onConfirm,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onConfirm,this),this.powerList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.closeBtn),this.powerList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this)},e.prototype.onConfirm=function(){AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),"是否确定选择该鉴定属性?",this.onConfirmYes,this)},e.prototype.onConfirmYes=function(){var t=this.powerList.selectedIndex;this.onClose(),this.callback instanceof Function&&this.callback.apply(this.obj,[t-1,this.isUpgrade])},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e,n,i){this.powerData=new eui.ArrayCollection(t),this.powerList.dataProvider=this.powerData,this.powerList.selectedIndex=0,this.callback=e,this.obj=n,this.isUpgrade=i},e.prototype.onTap=function(t){var e=t.itemIndex;this.powerList.selectedIndex,this.powerList.selectedIndex=e},e}(ComponentBase);__reflect(ForgeMultiPanel.prototype,"ForgeMultiPanel");var ForgePowerItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.dataChanged=function(){this.label_desc.textFlow=Tool.convertDescToTextFlow(this.data)},e}(eui.ItemRenderer);__reflect(ForgePowerItem.prototype,"ForgePowerItem");var ForgeScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_identify,this.tabBtn_gem,this.tabBtn_upStar,this.tabBtn_decompose,this.tabBtn_exchant];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){this._tabIndex=0,PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.openTab=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null),this._tabIndex=t,this._openItemData=e,this.updateTab()},e.prototype.updateTab=function(){this.init&&(ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_IDENTIFY?(null!=this._openItemData&&(this.identifyPanel.setdata(this._openItemData),this._openItemData=null),this.addChild(this.identifyPanel)):this._tabIndex==e.TAB_INDEX_GEM?(null!=this._openItemData&&(this.gemPanel.setdata(this._openItemData),this._openItemData=null),this.addChild(this.gemPanel)):this._tabIndex==e.TAB_INDEX_UPSTAR?(null!=this._openItemData&&(this.upStarPanel.setdata(this._openItemData),this._openItemData=null),this.addChild(this.upStarPanel)):this._tabIndex==e.TAB_INDEX_DECOMPOSE?this.addChild(this.decomposePanel):this._tabIndex==e.TAB_INDEX_ENCHANT&&this.addChild(this.enchantPanel))},e.prototype.removeAllPanel=function(){this.identifyPanel&&this.identifyPanel.parent&&this.identifyPanel.parent.removeChild(this.identifyPanel),this.gemPanel&&this.gemPanel.parent&&this.gemPanel.parent.removeChild(this.gemPanel),this.decomposePanel&&this.decomposePanel.parent&&this.decomposePanel.parent.removeChild(this.decomposePanel),this.enchantPanel&&this.enchantPanel.parent&&this.enchantPanel.parent.removeChild(this.enchantPanel),this.upStarPanel&&this.upStarPanel.parent&&this.upStarPanel.parent.removeChild(this.upStarPanel)},e.TAB_INDEX_IDENTIFY=0,e.TAB_INDEX_GEM=1,e.TAB_INDEX_UPSTAR=2,e.TAB_INDEX_DECOMPOSE=3,e.TAB_INDEX_ENCHANT=4,e.ComboType_normal=0,e.ComboType_upgrade=1,e}(ComponentBase);__reflect(ForgeScene.prototype,"ForgeScene");var ForgeUpStarPanel=function(t){function e(){var e=t.call(this)||this;return e._comboType=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_upStar,this.onBtnUpStar,this),ButtonUtils.addTouchEvent(this.btn_tenUpStar,this.onBtnTenUpStar,this),this.label_desc.text="",this.bagView.addEventListener(egret.Event.CHANGE,this.onBagComboTypeChange,this),this.bagView.setBagType(ForgeBagView.BagType_star),this._comboType=this.bagView.getComboType(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_upStar),ButtonUtils.removeTouchEvent(this.btn_tenUpStar),this.bagView.addEventListener(egret.Event.CHANGE,this.onBagComboTypeChange,this),this._selectItemData=null},e.prototype.onBtnUpStar=function(){this._selectItemData&&ItemManager.doItemStarMenu(this._selectItemData,ItemManager.ITEM_STAR_TYPE2,this.isUpgrade)},e.prototype.onBtnTenUpStar=function(){this._selectItemData&&ItemManager.doItemTenUpStar(this._selectItemData,this.isUpgrade)},e.prototype.onBagComboTypeChange=function(t){this._comboType=this.bagView.getComboType(),this.update()},Object.defineProperty(e.prototype,"isUpgrade",{get:function(){var t=!1;return this._comboType==ForgeScene.ComboType_upgrade&&(t=!0),t},enumerable:!0,configurable:!0}),e.prototype.setdata=function(t){this._selectItemData=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this.updateBag(),this.updateItemCount(),this.onItemSelect(this._selectItemData))},e.prototype.updateBag=function(){if(this.init){var t=xself;if(null!=t&&null!=t.bag){var e=t.bag.getCanUpStarEquipList(this.isUpgrade);this.bagView.setData(e,this.onItemTouch,this),this.bagView.update()}}},e.prototype.onItemTouch=function(t){null!=t&&PanelManager.openItemSelectView(t,"确认升星",this.checkItemBind,this)},e.prototype.checkItemBind=function(t){t&&(t.isBinded()?this.onItemSelect(t):(this._askBindItem=t,AlertPanel.alert("物品绑定","物品绑定后才能升星，确定是否绑定？",this.alert_ok_bind,this)))},e.prototype.alert_ok_bind=function(){ItemManager.doWorldItemBind(xself,this._askBindItem,!1,this.bind_over,this)},e.prototype.bind_over=function(){this.onItemSelect(this._askBindItem),this._askBindItem=null},e.prototype.onItemSelect=function(t){this._selectItemData=t,this.init&&(this.bagView.clearMask(),this.bagView.addMaskItem(this._selectItemData),this.bagView.setSelectItem(this._selectItemData),this.updateSelect(),this._selectItemData?(this.img_itemAdd.visible=!1,this.item.itemData=this._selectItemData,this._selectItemData.isBinded()?ItemManager.doItemStarMenu(this._selectItemData,ItemManager.ITEM_STAR_TYPE1,this.isUpgrade):this.updateSelect(this._selectItemData.getUpStarInfo())):(this.img_itemAdd.visible=!0,this.item.itemData=null))},e.prototype.updateSelect=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),this.container.reset(!0),this.label_desc.textFlow=Tool.convertDescToTextFlow(t),this.container.add(this.label_desc,10,10),this.container.update(),this.label_rate.text="成功率："+e},e.prototype.updateItemCount=function(){var t=xself;if(null!=t&&null!=t.bag){var e="",n=0,i=12;this.isUpgrade?(n=t.bag.getUpgradeUpstarScrollNum(),e="剩余进阶升星卷轴："+PowerString.makeColorString(n+"个",ColorUtils.COLOR_YELLOW),i=10):(n=t.bag.getItemNumByID(Define.ITEM_ID_STAR_SCROLL),e="剩余升星卷轴："+PowerString.makeColorString(n+"个",ColorUtils.COLOR_YELLOW),i=12),this.label_left.size=i*xhdRatio,this.label_left.textFlow=Tool.convertDescToTextFlow(e)}},e.prototype.updateFromServer=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),this.updateSelect(t,e),this.updateItemCount()},e}(ComponentBase);__reflect(ForgeUpStarPanel.prototype,"ForgeUpStarPanel");var FurnaceCraftsmanItem=function(t){function e(){var e=t.call(this)||this;return e._index=-1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._index=t,this._craftsman=e},Object.defineProperty(e.prototype,"craftsman",{get:function(){return this._craftsman},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._craftsman?(this.img_type.source=this.getResource(this._index),this.img_mask.visible=!this._craftsman.isOpen,this.label_name.text=this._craftsman.name):(this.img_type.source=null,this.img_mask.visible=!1,this.label_name.text=""))},e.prototype.getResource=function(t){return"furnace_craftsman_"+t},e}(ComponentBase);__reflect(FurnaceCraftsmanItem.prototype,"FurnaceCraftsmanItem");var FurnaceHelpItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)},e.prototype.onItemTouch=function(t){this._itemData&&AlertPanel.alertTipsCommon(this._itemData.getDesc(xself,!0))},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._furnace=t},e.prototype.reset=function(){this.init&&(this.label_level.text="",this.label_quality.text="",this.label_desc.text="",this.item.itemData=null)},e.prototype.update=function(){if(this.init){if(this._furnace&&this._furnace.vItem&&this._furnace.vItem.length>0?this._itemData=this._furnace.vItem[0]:this._itemData=null,null==this._itemData)return void this.reset();this.label_level.text=this._furnace.furnaceLevel+"级",this.label_quality.textColor=Define.getGradeColor(this._itemData.grade),this.label_quality.text=Define.getGradeString(this._itemData.grade),this.label_desc.text=this.getDesc(this._itemData),this.item.itemData=this._itemData}},e.prototype.getDesc=function(t){var e="";return 0!=t.atkMin&&0!=t.atkMax&&(e+="攻击力："+t.atkMin+"~"+t.atkMax+"\n"),0!=t.getItemHitRate()&&(e+="攻击命中："+t.getItemHitRate()+"\n"),0!=t.atk_time&&(e+="攻击次数："+(t.atk_time+1)+"\n"),t.type!=Define.ITEM_TYPE_WEAPON_ONEHAND_HAND&&(e+=Define.getAtkTypeString(t.atkType)),e},e}(ComponentBase);__reflect(FurnaceHelpItem.prototype,"FurnaceHelpItem");var FurnaceHelpPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._itemList){this._itemList=[];for(var n=0;9>n;n++){var i=this["item"+n];this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onItemTouch=function(t){t.target instanceof FurnaceHelpItem?this.onSelectItem(t.target):t.target.parent instanceof FurnaceHelpItem&&this.onSelectItem(t.target.parent)},e.prototype.onSelectItem=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelect.select=!0)},e.prototype.setData=function(t){this._dataList=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){if(null==this._dataList||0==this._dataList.length)return void this.reset();for(var t=0;t<this._itemList.length;t++){var e=this._itemList[t],n=this._dataList[t];e.setData(n),e.update()}}},e}(ComponentBase);__reflect(FurnaceHelpPanel.prototype,"FurnaceHelpPanel");var FurnacePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._itemList){this._itemList=[];for(var n=0;8>n;n++)this._itemList.push(this["item"+n])}for(n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_furnace,this.onBtnFurnace,this),ButtonUtils.addTouchEvent(this.btn_help,this.onBtnHelp,this),this.label_vipCount.visible=!1,this.item_furnace.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFurnaceItemTouch,this),this.check_coin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBoxTouch,this),this.check_gold.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBoxTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_furnace),ButtonUtils.removeTouchEvent(this.btn_help),this.item_furnace.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFurnaceItemTouch,this),this.check_coin.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBoxTouch,this),this.check_gold.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBoxTouch,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onFurnaceItemTouch=function(t){this.item_furnace&&this.item_furnace.itemData&&AlertPanel.alertTipsCommon(this.item_furnace.itemData.getDesc(xself,!0))},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.craftsman&&this._furnace&&Furnace.doOpenCraftsmanMenu(this._furnace,e.craftsman)},e.prototype.onBtnFurnace=function(){this._furnace&&Furnace.doOperateFurnace(this._furnace)},e.prototype.onBtnHelp=function(){Furnace.doSeeFurnaceItemLists()},e.prototype.onCheckBoxTouch=function(t){var e=t.target;e&&this._furnace&&(e==this.check_coin?(this._furnace.moneytype=2,this._furnace.moneyvalue=this._furnace.costMoney3,this.updateCheckBox()):e==this.check_gold&&(this._furnace.moneytype=0,this._furnace.moneyvalue=this._furnace.costMoney1,this.updateCheckBox()))},e.prototype.updateCheckBox=function(){if(this.init&&null!=this._furnace){var t=2==this._furnace.moneytype;this.check_coin.selected=t,this.check_coin.touchEnabled=!t,this.check_gold.selected=!t,this.check_gold.touchEnabled=t}},e.prototype.setData=function(t){this._furnace=t},e.prototype.reset=function(){this.init&&(this.label_tips.text="",this.label_class.text="0档",this.label_todayTimes.text="今日已炼制次数：",this.label_times.text="",this.label_quality.text="",this.bar_progress.value=0,this.label_vipCount.text="VIP增加次数：+0",this.item_furnace.itemData=null)},e.prototype.update=function(){if(this.init){if(null==this._furnace)return void this.reset();this.label_tips.text="("+this._furnace.tips+")",this.label_todayTimes.text="今日已炼制次数："+this._furnace.todayRefineNum+"/"+this._furnace.maxTodayRefineNum,this.label_times.text=this._furnace.refineNum+"/"+this._furnace.maxRefineNum,this.label_quality.text=this._furnace.furnaceQuality+"",this.item_furnace.itemData=this._furnace.item,this.label_class.textFlow=Tool.convertDescToTextFlow(PowerString.makeColorString(this._furnace.furnaceLevel+"",ColorUtils.COLOR_YELLOW)+"档"),this.bar_progress.maximum=this._furnace.maxRefineNum,this.bar_progress.value=this._furnace.refineNum;for(var t=0;t<this._itemList.length;t++){var e=this._itemList[t],n=this._furnace.vCraftsman[t];e.setData(t,n),e.update()}0==this._furnace.moneyvalue&&(this._furnace.moneytype=2,this._furnace.moneyvalue=this._furnace.costMoney3),this.check_coin.label=this._furnace.costMoney3+"铜币",this.check_gold.label=this._furnace.costMoney1+"黄金",this.updateCheckBox(),this.moneyView.setData(xself),this.moneyView.update()}},e}(ComponentBase);__reflect(FurnacePanel.prototype,"FurnacePanel");var ItemGet=function(){function t(){}return t.initData=function(){null==this._data&&nato.loadJson(t._tabelPath,this.loadTabelOver,this)},t.loadTabelOver=function(t,e){var n=t;this._data=new ItemGetData,this._data.type1=0,this._data.isDir=!0,this._data.dirList=[],this._data.desc="全部";for(var i=0;i<n.length;i++){var o=ItemGetData.parseData(n[i]);if(0==o.dirType&&(o.isDir=!0,o.dirList=[]),o.isRecommend=1==o.recommend,o.isDir){var a=this.getType1Data(o.type1);0==o.type2?(this._data.dirList[o.id]=o,o.parentType=0):(a.dirList[o.type2]=o,o.parentType=o.type1)}else{o.type2>0?o.parentType=o.type2:o.parentType=o.type1;var r=this.getItemGetData(o.type1,o.type2);null!=r&&r.dirList.push(o)}}},t.getType1Data=function(e){return null==this._data?null:e==t.Type_all?this._data:this._data.dirList[e]},t.getType2Data=function(t,e){var n=this.getType1Data(t);return 0==e?n:n&&n.isDir?n.dirList[e]:null},t.openItemGet=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),null!=this._data){var n=this.getItemGetData(t,e);PanelManager.openItemGetPanel(n)}},t.openItemGetItemData=function(t){var e=this.getItemType1(t);if(e>0){var n=this.getItemType2(t);if(n>0){var i=this.getType2Data(e,n);i&&PanelManager.openItemGetPanel(i)}else{var o=this.getType1Data(e);PanelManager.openItemGetPanel(o)}}},t.getItemType1=function(e){if(null==e)return-1;switch(e.type){case Define.ITEM_TYPE_ARMOR_BACK:case Define.ITEM_TYPE_ARMOR_NECKLACE:case Define.ITEM_TYPE_ARMOR_RING:case Define.ITEM_TYPE_ARMOR_AMULET:return t.Type_jewelry;case Define.ITEM_TYPE_ARMOR_HEAD:case Define.ITEM_TYPE_ARMOR_CLOTHES:case Define.ITEM_TYPE_ARMOR_TROUSERS:case Define.ITEM_TYPE_ARMOR_SHOULDER:case Define.ITEM_TYPE_ARMOR_WAIST:case Define.ITEM_TYPE_ARMOR_SHOES:case Define.ITEM_TYPE_ARMOR_HAND:return t.Type_armor;case Define.ITEM_TYPE_ARMOR_TRANSPORT:return t.Type_transport;case Define.ITEM_TYPE_ARMOR_FASHION:return t.Type_fashicon;case Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD:case Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD:case Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE:case Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE:case Define.ITEM_TYPE_WEAPON_ONEHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY:case Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF:case Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE:case Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW:case Define.ITEM_TYPE_WEAPON_TWOHAND_BOW:case Define.ITEM_TYPE_WEAPON_ONEHAND_HAND:case Define.ITEM_TYPE_WEAPON_BALL:return t.Type_weapon;case Define.ITEM_TYPE_BUILD_MATERIAL:return e.isCrystal()?t.Type_crystal:e.isMaigcCrystal()?t.Type_magicCrystal:e.isCountryMateria()?t.Type_countryMaterial:-1;case Define.ITEM_TYPE_GEM:return t.Type_gem;case Define.ITEM_TYPE_ANYTIME_USE:case Define.ITEM_TYPE_NOT_BATTLE_USE:return e.isIdentifyScrollItem()?t.Type_identify:e.isStarScroll()?t.Type_strengthen:-1;case Define.ITEM_TYPE_PET:return t.Type_pet;case Define.ITEM_TYPE_SPECEAIL:case Define.ITEM_TYPE_SKILL_BOOK:case Define.ITEM_TYPE_TASK:case Define.ITEM_TYPE_BATTLE_USE:return-1}return-1},t.getItemType2=function(t){if(null==t)return 0;if(t.isGem())return 1==t.powerValue1||2==t.powerValue1||3==t.powerValue1||4==t.powerValue1?t.powerValue1:5;if(t.isWeapon())return t.isLightWeapon()?1:2;if(t.isArmor())return t.isMagicArmor()?1:2;if(t.isMateria()){if(t.isCountryMateria()){if(t.isCountryWood())return 1;if(t.isCountryStone())return 2;if(t.isCountryIron())return 3}return 0}return t.type==Define.ITEM_TYPE_ARMOR_TRANSPORT?31006==t.id?1:31001==t.id?2:31008==t.id?3:31022==t.id?4:31002==t.id?5:31013==t.id?6:31003==t.id?7:31029==t.id?8:31045==t.id?9:-1:t.type==Define.ITEM_TYPE_ARMOR_FASHION?15011==t.id?1:15010==t.id?2:15021==t.id?3:15042==t.id?4:15e3==t.id?5:15007==t.id?6:15008==t.id?7:-1:t.type==Define.ITEM_TYPE_ARMOR_RING?1:t.type==Define.ITEM_TYPE_ARMOR_AMULET?2:t.type==Define.ITEM_TYPE_ARMOR_NECKLACE?3:t.type==Define.ITEM_TYPE_ARMOR_BACK?4:0},t.getItemGetData=function(t,e){return void 0===e&&(e=0),this.getType2Data(t,e)},t.getItemGetDataByEquipPos=function(t){var e=this.getType1ByEquipPos(t),n=this.getType2ByEquipPos(t);return n>0?this.getType2Data(e,n):this.getType1Data(e)},t.getType1ByEquipPos=function(e){var n=0;switch(e){case PlayerBag.ARMOR_NECKLACE_POS:case PlayerBag.ARMOR_AMULET_POS:case PlayerBag.ARMOR_BACK_POS:case PlayerBag.ARMOR_RING_LEFT_POS:case PlayerBag.ARMOR_RING_RIGHT_POS:n=t.Type_jewelry;break;case PlayerBag.PET_POS:n=t.Type_pet;break;case PlayerBag.ARMOR_FASHION_POS:n=t.Type_fashicon;break;case PlayerBag.WEAPON_LEFT_POS:case PlayerBag.WEAPON_RIGHT_POS:n=t.Type_weapon;break;case PlayerBag.ARMOR_CLOTHES_POS:case PlayerBag.ARMOR_HAND_POS:case PlayerBag.ARMOR_HEAD_POS:case PlayerBag.ARMOR_SHOES_POS:case PlayerBag.ARMOR_WAIST_POS:case PlayerBag.ARMOR_TROUSERS_POS:case PlayerBag.ARMOR_SHOULDER_POS:n=t.Type_armor;break;case PlayerBag.ARMOR_TRANSPORT_POS:n=t.Type_transport}return n},t.getType2ByEquipPos=function(t){var e=0,n=xself.getJob();return t==PlayerBag.WEAPON_LEFT_POS||t==PlayerBag.WEAPON_RIGHT_POS||(t==PlayerBag.ARMOR_CLOTHES_POS||t==PlayerBag.ARMOR_HAND_POS||t==PlayerBag.ARMOR_HEAD_POS||t==PlayerBag.ARMOR_SHOES_POS||t==PlayerBag.ARMOR_WAIST_POS||t==PlayerBag.ARMOR_TROUSERS_POS||t==PlayerBag.ARMOR_SHOULDER_POS?n==Define.JOB_RANGER||n==Define.JOB_WARRIOR?e=2:(n==Define.JOB_XIUZHEN||n==Define.JOB_WIZARD)&&(e=1):t==PlayerBag.ARMOR_NECKLACE_POS?e=3:t==PlayerBag.ARMOR_AMULET_POS?e=2:t==PlayerBag.ARMOR_BACK_POS?e=4:(t==PlayerBag.ARMOR_RING_LEFT_POS||t==PlayerBag.ARMOR_RING_RIGHT_POS)&&(e=1)),e},t.getNameByEquipPos=function(t){switch(t){case PlayerBag.ARMOR_NECKLACE_POS:return"项链";case PlayerBag.ARMOR_AMULET_POS:return"护符";case PlayerBag.ARMOR_BACK_POS:return"披风";case PlayerBag.ARMOR_RING_LEFT_POS:case PlayerBag.ARMOR_RING_RIGHT_POS:return"戒指";case PlayerBag.PET_POS:return"宠物";case PlayerBag.ARMOR_FASHION_POS:return"时装";case PlayerBag.WEAPON_LEFT_POS:case PlayerBag.WEAPON_RIGHT_POS:return"武器";case PlayerBag.ARMOR_CLOTHES_POS:case PlayerBag.ARMOR_HAND_POS:case PlayerBag.ARMOR_HEAD_POS:case PlayerBag.ARMOR_SHOES_POS:case PlayerBag.ARMOR_WAIST_POS:case PlayerBag.ARMOR_TROUSERS_POS:case PlayerBag.ARMOR_SHOULDER_POS:return"防具";case PlayerBag.ARMOR_TRANSPORT_POS:return"坐骑"}},t.getAlertBtnName=function(t){var e=this.getType1Data(t);return e&&null!=e.desc&&e.desc.length<=2?e.desc+"获取":"获取途径"},t.openMaterialLessByItem=function(t){if(null!=t){var e=null,n=this.getItemType1(t);if(n>0){var i=this.getItemType2(t);e=i>0?this.getItemGetData(n,i):this.getItemGetData(n),PanelManager.openItemGetPanel(e)}}},t.Type_all=0,t.Type_gem=1,t.Type_transport=2,t.Type_fashicon=3,t.Type_weapon=4,t.Type_armor=5,t.Type_jewelry=6,t.Type_strengthen=7,t.Type_identify=8,t.Type_enchant=9,t.Type_crystal=10,t.Type_pet=11,t.Type_countryMaterial=12,t.Type_title=13,t.Type_money3=14,t.Type_magicCrystal=15,t.PanelID_shop=1,t.PanelID_sell=2,t.PanelID_recharge=3,t.PanelID_enchant=4,t.PanelID_decompose=5,t.PanelID_exchange=6,t.NPCID_shop=-1,t.NPCID_task=-2,t.NPCID_achieve=-3,t.OPEN_LEVEL=15,t._tabelPath="table/item_get.json",t._data=null,t}();__reflect(ItemGet.prototype,"ItemGet");var ItemGetData=function(){function t(){this.id=0,this.type1=0,this.type2=0,this.taskID=0,this.npcID=0,this.mapID=0,this.openLevel=0,this.panelID=0,this.recommend=0,this.isRecommend=!1,this.icon=-1,this.dirType=-1,this.isJustJumpMap=!1,this.isDir=!1,this.parentType=-1}return t.parseData=function(e){var n=new t;return n.id=Number(e.id),n.type1=Number(e.type1),null!=e.type2&&(n.type2=Number(e.type2)),null!=e.icon&&(n.icon=Number(e.icon)),null!=e.dirType&&(n.dirType=Number(e.dirType)),n.desc=e.desc,null!=e.taskID&&(n.taskID=Number(e.taskID)),null!=e.mapID&&(n.mapID=Number(e.mapID)),null!=e.npcID?n.npcID=Number(e.npcID):0!=n.mapID&&(n.npcID=AutoFindPath.JUST_FIND_MAP_NPCID),null!=e.openLevel&&(n.openLevel=Number(e.openLevel)),null!=e.panelID&&(n.panelID=Number(e.panelID)),null!=e.recommend&&(n.recommend=Number(e.recommend)),null!=e.icon&&(n.icon=Number(e.icon)),n},t.prototype.doListAction=function(){this.isDir&&PanelManager.openItemGetPanel(this)},t.prototype.doAction=function(){return GameWorld.isCountryBossStatus()||GameWorld.isEscortStatus()||GameWorld.isTeamBossStatus()||GameWorld.isCountryWarStatus()?void AlertPanel.alertCommon("当前场景下不能使用"):void(this.panelID>0?this.doOpenPanel(this.panelID):this.taskID>0?this.doAutoFindTask(this.taskID):this.doAutoFindNPC(this.mapID,this.npcID))},t.prototype.doOpenPanel=function(t){PanelManager.closeItemGetPanel(),t==ItemGet.PanelID_shop?xworld.doBrowseShop(Define.SHOP_MARKETPLACE,null):t==ItemGet.PanelID_sell?(xworld.doBrowseShop(Define.SHOP_MARKETPLACE,null),ShopScene.isOpenSell=!0):t==ItemGet.PanelID_recharge?(AlertPanel.alertCommon("敬请期待"),PayInfo.getPayList()):t==ItemGet.PanelID_decompose?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_DECOMPOSE):t==ItemGet.PanelID_enchant?PanelManager.openForgeScene(ForgeScene.TAB_INDEX_ENCHANT):t==ItemGet.PanelID_exchange&&PanelManager.openExchangeMoneyPanel()},t.prototype.doAutoFindTask=function(t){AutoFindPath.findTask(t)},t.prototype.doAutoFindNPC=function(t,e){var n=e;e==ItemGet.NPCID_achieve?n=AutoFindPath.NPCID_achieve:e==ItemGet.NPCID_shop?n=AutoFindPath.NPCID_shop:e==ItemGet.NPCID_task&&(n=AutoFindPath.NPCID_cityTask),AutoFindPath.findPath(t,n)},t}();__reflect(ItemGetData.prototype,"ItemGetData");var ItemGetListItem=function(t){function e(){var n=t.call(this)||this;return null==e._whiteSpaceStr&&(e._whiteSpaceStr=TextFieldUtils.getSpaceByWidth(30*xhdRatio,15*xhdRatio,"黑体")),n}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGo,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.btn_go.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGo,this)},e.prototype.onTouch=function(t){this._itemGetData&&this._itemGetData.isDir&&this._itemGetData.doListAction()},e.prototype.onBtnGo=function(){this._itemGetData&&!this._itemGetData.isDir&&this._itemGetData.doAction()},e.prototype.setData=function(t){this._itemGetData=t},Object.defineProperty(e.prototype,"itemGetData",{get:function(){return this._itemGetData},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._itemGetData){var t=this._itemGetData.desc;this._itemGetData.isRecommend&&(t+=PowerString.makeColorString("(推荐)",ColorUtils.COLOR_GREEN)),this._itemGetData.icon>=0?(t=e._whiteSpaceStr+t,this.icon.visible=!0,this.icon.setData(this._itemGetData.icon,4)):this.icon.visible=!1,TextFieldUtils.getTextWidth(t,this.label_name.size,this.label_name.fontFamily)/2>this.label_name.width?this.label_name.size=14*xhdRatio:this.label_name.size=15*xhdRatio,this.label_name.textFlow=Tool.convertDescToTextFlow(t),this.btn_go.visible=!this._itemGetData.isDir}},e._whiteSpaceStr=null,e}(ComponentBase);__reflect(ItemGetListItem.prototype,"ItemGetListItem");var ItemGetPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update(),0==PlayerDataManager.playerData.isItemGetOpen&&PlayerDataManager.playerData.isSpriteOpen&&(PlayerDataManager.playerData.isItemGetOpen=!0,PlayerDataManager.savePlayerData(PlayerDataManager.playerData),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_6))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this._itemGetData=null,this._parentData=null},e.prototype.onClose=function(){this._parentData==this._itemGetData?PanelManager.closeItemGetPanel():this._itemGetData&&this._itemGetData.parentType>=0?ItemGet.openItemGet(this._itemGetData.parentType):PanelManager.closeItemGetPanel()},e.prototype.setData=function(t){this._itemGetData=t,null==this._parentData&&(this._parentData=t)},e.prototype.reset=function(){this.init&&(this.container.reset(!0),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._itemGetData)){this.label_title.text=this._itemGetData.desc+"获取途径";var t=xself.getLevel();if(this._itemGetData.isDir){var e=this._itemGetData.dirList.concat();e.sort(this.sortList);for(var n=0;n<e.length;n++){var i=e[n];if(null!=i&&!(i.openLevel>0&&i.openLevel>t))(o=this.getItem()).setData(i),this.container.add(o)}}else{var o;(o=this.getItem()).setData(this._itemGetData),this.container.add(o)}this.container.update()}},e.prototype.sortList=function(t,e){if(t&&t.isRecommend)return-1;if(e&&e.isRecommend)return 1;if(t&&e){if(t.id<e.id)return-1;if(t.id>e.id)return 1;if(t.type1<e.type1)return-1;if(t.type1>e.type1)return 1;if(t.type2<e.type2)return-1;if(t.type2>e.type2)return 1}return 0},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new ItemGetListItem,nato.attachSkin(t)),t},e}(ComponentBase);__reflect(ItemGetPanel.prototype,"ItemGetPanel");var AreaLineLastSelectView=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e._isInitShowList=!1,e._isAddStageEvent=!1,e._isShowing=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_show.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShow,this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShow,this),this.item.changeToLastShowItem(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_show.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShow,this),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShow,this),this.hideList(),this.clearShowList()},e.prototype.onBtnShow=function(t){t.stopImmediatePropagation(),this._isShowing?this.hideList():this.showList()},e.prototype.setData=function(t,e,n){this._dataList=t,this._callbackFunc=e,this._thisObj=n},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectServerInfo",{get:function(){return this._dataList?this._dataList[this._selectIndex]:null},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&!(null==this._dataList||0==this._dataList.length||this._selectIndex<0)){var t=this._dataList[this._selectIndex];t?this.item.setData(t):this.item.setData(null),this.item.update(),this.hideList()}},e.prototype.showList=function(){this.initShowList(),this.group_list.visible=!0,this.addChild(this.group_list),this.stage&&!this._isAddStageEvent&&(this._isAddStageEvent=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this)),this._isShowing=!0},e.prototype.initShowList=function(){if(!this._isInitShowList&&null!=this._dataList&&0!=this._dataList.length){this._isInitShowList=!0,this._itemList=[];for(var t=0,e=5,n=0;n<this._dataList.length;n++){var i=this._dataList[n];if(null!=i){var o=this.getItem();o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),o.setData(i),o.changeToLastSelectItem(),o.width=this.width-10,o.x=5,o.y=e,this.group_list.addChild(o),this._itemList.push(o),t+=o.height,e+=o.height}}this.bg2.height=t+10}},e.prototype.hideList=function(){this.group_list&&this.group_list.parent&&this.group_list.parent.removeChild(this.group_list),this.stage&&this._isAddStageEvent&&(this._isAddStageEvent=!1,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this)),this._isShowing=!1},e.prototype.clearShowList=function(){if(!(null==this._itemList||this._itemList.length<=0)){for(var t=0;t<this._itemList.length;t++){var e=this._itemList[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),e.parent&&e.parent.removeChild(e),this.returnItem(e)}this._itemList=null,this._isInitShowList=!1}},e.prototype.onItemTouch=function(t){t&&t.serverInfo&&(this._selectIndex=this._itemList.indexOf(t),this.update(),null!=this._callbackFunc&&null!=this._thisObj&&this._callbackFunc.call(this._thisObj))},e.prototype.onStageTouch=function(t){if(null!=this.stage){if(t.target instanceof AreaLineListItem){var e=t.target;e&&e.parent==this.group_list&&this.onItemTouch(e)}this.hideList()}},e.prototype.getItem=function(){var t=ObjectPool.getPool("AreaLineListItem").createObject();return nato.attachSkin(t),t},e.prototype.returnItem=function(t){ObjectPool.getPool("AreaLineListItem").returnObject(t)},e}(ComponentBase);__reflect(AreaLineLastSelectView.prototype,"AreaLineLastSelectView");var AreaLineListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._serverInfo=t},Object.defineProperty(e.prototype,"serverInfo",{get:function(){return this._serverInfo},enumerable:!0,configurable:!0}),e.prototype.changeToLastSelectItem=function(){this.bg0.visible=!1,this.bg1.visible=!0},e.prototype.changeToLastShowItem=function(){this.bg0.visible=!1,this.bg1.visible=!1,this.label_name.width=210,this.label_name.size=30},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.select=!1,this.label_name.textAlign="center",this.label_name.text="--",this.img_state.visible=!1)},e.prototype.update=function(){if(this.init){if(null==this._serverInfo)return void this.reset();var t=this._serverInfo.name,e=TextFieldUtils.getSizeByMaxWidth(t,this.label_name.width,this.label_name.fontFamily);e>14*xhdRatio&&(e=14*xhdRatio),this.label_name.size=e,this.label_name.verticalAlign="middle",this.label_name.height=15*xhdRatio,this.label_name.text=t,this.img_state.visible=!0,this.img_state.source=this.getResourece(this._serverInfo),this.img_select.visible=this._select}},e.prototype.getResourece=function(t){if(null==t)return null;var e=t.state;return e==ServerInfo.SERVER_STATE_NEW?"server_state_new":e==ServerInfo.SERVER_STATE_HOT?"server_state_2":e==ServerInfo.SERVER_STATE_FULL?"server_state_3":e==ServerInfo.SERVER_STATE_STOP?"server_state_4":"server_state_0"},e}(ComponentBase);__reflect(AreaLineListItem.prototype,"AreaLineListItem");var AreaLineListPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e._isFitBg=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_enterGame,this.onBtnEnterGame,this),ButtonUtils.addTouchEvent(this.btn_notice,this.onBtnNotice,this),ButtonUtils.addTouchEvent(this.btn_enterGame2,this.onBtnEnterGame2,this),ButtonUtils.addTouchEvent(this.group_selectSever,this.onOpenSelect,this),this.updateList(),this.updateLaseServer();var n=Sdk.xsdk.param&&Sdk.xsdk.param.showCheckBtn&&3100==xchannel;this.btn_check.visible=!!n,ButtonUtils.addTouchEvent(this.btn_check,this.onCheck,this),Sdk.noneSdk?(this.closeBtn.visible=!0,this.group_sdkIndex.visible=!1,this.group_arealine.visible=!0):(this.closeBtn.visible=!1,this.group_sdkIndex.visible=!0,this.group_arealine.visible=!1,this.lastSelectView2.item.bg0.visible=!1,this._isFitBg||(this._isFitBg=!0,this.img_index_bg.anchorOffsetX=.5*this.img_index_bg.width,this.img_index_bg.anchorOffsetY=.5*this.img_index_bg.height,this.img_index_bg.scaleX=nato.uiEnlargeRatio/this.scaleX,this.img_index_bg.scaleY=nato.uiEnlargeRatio/this.scaleY,this.img_index_bg.x=this.group_sdkIndex.width/2,this.img_index_bg.y=this.group_sdkIndex.height/2))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_enterGame),ButtonUtils.removeTouchEvent(this.btn_enterGame2),ButtonUtils.removeTouchEvent(this.group_selectSever),ButtonUtils.removeTouchEvent(this.btn_notice),this.reset()},e.prototype.onClose=function(){Sdk.xsdk.logout()},e.prototype.onOpenSelect=function(){this.group_arealine.visible=!0},e.prototype.onCheck=function(){Sdk.xsdk.logout((function(){PanelManager.openQQBrowserLoginPanel(["qq","wx"],null),Sdk.xsdk.param&&(Sdk.xsdk.param.isOnCheck=!0)}))},e.prototype.onBtnEnterGame=function(){Main.instance.stopCollect()||(this.scaleX=.5,this.scaleY=.5,this.x=0,this.y=0,this.anchorOffsetX=0,this.anchorOffsetY=0,PanelManager.waitForServerPanel=null),this._curSelectItem&&this._curSelectItem.serverInfo&&this._curSelectItem.serverInfo.doSelectServer();var t={serverid:ServerInfo.getSelectServer().id};Sdk.xsdk.statistic(t)},e.prototype.onBtnEnterGame2=function(){Main.instance.stopCollect()||(this.scaleX=.5,this.scaleY=.5,this.x=0,this.y=0,this.anchorOffsetX=0,this.anchorOffsetY=0,PanelManager.waitForServerPanel=null),this.lastSelectView2.selectServerInfo&&this.lastSelectView2.selectServerInfo.doSelectServer();var t={serverid:ServerInfo.getSelectServer().id};Sdk.xsdk.statistic(t)},e.prototype.onBtnNotice=function(){GameNotice.showNotice()},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.serverInfo&&this.onSelectItem(e)},e.prototype.onSelectItem=function(t){this.init&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0),this._curSelectItem&&this._curSelectItem.serverInfo?this.label_current.text="当前服务器:"+this._curSelectItem.serverInfo.name:this.label_current.text="当前服务器: --")},e.prototype.reset=function(){this.init&&(this.container.reset(!0),this._index=0)},e.prototype.updateLaseServer=function(){if(this.init){var t=null,e=ServerInfo.loginedServerList,n=GameWorld.lastServerID,i=GameWorld.lastServerName;if(e&&e.length>0&&n>0)for(var o=0;o<e.length;o++)if(e[o].id==n&&e[o].name==i){t=e[o];break}if(this.lastSelectView.setData(e,this.onSelectLastServer,this),this.lastSelectView2.setData(e,this.onSelectLastServer2,this),null!=t){var a=e.indexOf(t);this.lastSelectView.selectIndex=a,this.lastSelectView2.selectIndex=a}else e&&1==e.length?(this.lastSelectView.selectIndex=0,this.lastSelectView2.selectIndex=0):(this.lastSelectView.selectIndex=-1,this.lastSelectView2.selectIndex=-1);if(t)this.onSelectByServerInfo(t);else if(this._serverList&&this._serverList.length>0){for(var r=this._serverList.length-1,s=0;s<this._serverList.length;s++)if(this._serverList[s].state==ServerInfo.SERVER_STATE_NEW){r=s;break}this.onSelectByServerInfo(this._serverList[r],!1),this.lastSelectView2.setData(this._serverList,this.onSelectLastServer2,this),this.lastSelectView2.selectIndex=r}else this.onSelectItem(null)}},e.prototype.onSelectLastServer=function(){var t=this.lastSelectView.selectServerInfo;this.onSelectByServerInfo(t)},e.prototype.onSelectLastServer2=function(){var t=this.lastSelectView2.selectServerInfo;this.onSelectByServerInfo(t)},e.prototype.onSelectByServerInfo=function(t,e){if(void 0===e&&(e=!0),null!=t){var n=this.container.list;if(n&&n.length>0)for(var i=0;i<n.length;i++){var o=n[i];if(o instanceof AreaLineListItem){var a=o;if(a.serverInfo&&a.serverInfo==t){this.onSelectItem(o),e&&this.container.updateToShowItem(o);break}}}}else this.onSelectItem(null)},e.prototype.updateList=function(){if(this.init&&(this.reset(),this._serverList=ServerInfo.gameAreaList,null!=this._serverList&&0!=this._serverList.length)){var t,e=0,n=10;this.container.add(this.group_recommend,0,n),n+=this.group_recommend.height+15;for(var i=0;2>i;i++)null!=(o=this._serverList[i])&&(i%2==0?(e=18,i>0&&(n+=70)):e=312,(t=this.getItem()).setData(o),this.container.add(t,e,n));n+=70,this.container.add(this.group_list,0,n),n+=this.group_list.height+15;for(i=2;i<this._serverList.length;i++){var o;null!=(o=this._serverList[i])&&(i%2==0?(e=18,i>2&&(n+=70)):e=312,(t=this.getItem()).setData(o),this.container.add(t,e,n))}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&((t=new AreaLineListItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(AreaLineListPanel.prototype,"AreaLineListPanel");var CreateRoleName=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCreate=function(){this.x=(egret.MainContext.instance.stage.stageWidth-this.width)/2,this.y=(egret.MainContext.instance.stage.stageHeight-this.height)/2,this.tips.textColor=16711680},e.prototype.setScene=function(t){this.createRoleScene=t},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btnConfirm,this.onCreateRole,this),ButtonUtils.addTouchEvent(this.btnCancel,this.onCancel,this),ButtonUtils.addTouchEvent(this.btn_random,this.onBtnRandom,this),this.tips.text="",3100==xchannel?this.textInput.text=Sdk.param.nickName:this.onBtnRandom()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btnConfirm),ButtonUtils.removeTouchEvent(this.btnCancel),ButtonUtils.removeTouchEvent(this.btn_random)},e.prototype.onCreateRole=function(){""==this.textInput.text&&(this.tips.text="角色名为空！"),this.createRoleScene.createRole(this.textInput.text)},e.prototype.onBtnRandom=function(){var t=this.createRoleScene.getSelectSex();this.textInput.text="",e.getRandomName(t,this.onGetRandomNameBack,this)},e.prototype.onGetRandomNameBack=function(t){this.textInput.text=t},e.prototype.setTipsText=function(t){this.tips.text=t},e.prototype.onCancel=function(t){this.parent&&this.parent.removeChild(this)},e.getRandomName=function(t,n,i){if(null!=this.nameList&&this.nameList.length>0){var o=this.nameList.pop();n.call(i,o)}else{var a=xcacheurl+"random_name?sex="+t,r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(a,egret.HttpMethod.GET),r.addEventListener(egret.Event.COMPLETE,(function(t){var o=t.currentTarget.response;if(0==Tool.isNullText(o)){var a=o.split(";"),r=a.pop();n.call(i,r),e.nameList=a}}),this),r.addEventListener(egret.IOErrorEvent.IO_ERROR,(function(){}),this),r.send()}},e.nameList=null,e}(ComponentBase);__reflect(CreateRoleName.prototype,"CreateRoleName");var CreateRoleScene=function(t){function e(){var e=t.call(this)||this;return e.selectedSexIndex=0,e.selectedRaceIndex=0,e.selectedJobIndex=0,e.selectedLookIndex=0,e}return __extends(e,t),e.prototype.onCreate=function(){this.sex0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectSex,this),this.sex1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectSex,this),this.race0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRace,this),this.race1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectRace,this),this.job0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectJob,this),this.job1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectJob,this),this.look0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLook,this),this.look1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLook,this),this.look2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectLook,this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btnCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateRole,this)},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.sexCheckBoxList=[this.sex0,this.sex1],this.raceCheckBoxList=[this.race0,this.race1],this.jobCheckBoxList=[this.job0,this.job1],this.lookCheckBoxList=[this.look0,this.look1,this.look2],this.player=ListPlayer.getRandomCreatePlayer(),this.player.setStyleDataToIcon(),this.player.refreshWorldSprite(),this.playerSprite=this.player.sprite,this.addPlayerSprite(),this.selectedSexIndex=this.player.getSex(),this.selectSex(this.selectedSexIndex);var n=this.player.getRace();this.selectedRaceIndex=n,this.selectRace(n);var i=this.player.getJob(),o=this.player.getRace()==Define.RACE_EAST?i-1:i-3;this.selectedJobIndex=o,this.selectJob(o),this.selectLook(this.player.getModel())},e.prototype.onSelectSex=function(t){var e=parseInt(t.target.name.split("_")[1]);this.selectedSexIndex=e,this.selectSex(e),this.player.setSex(e),this.updatePlayerSprite()},e.prototype.onSelectRace=function(t){var e=parseInt(t.target.name.split("_")[1]);this.selectedRaceIndex=e,this.selectRace(e),this.player.setRace(e)},e.prototype.onSelectJob=function(t){var e=parseInt(t.target.name.split("_")[1]);this.selectedJobIndex=e,this.selectJob(e),this.player.initJobByRace(e)},e.prototype.onSelectLook=function(t){var e=parseInt(t.target.name.split("_")[1]);this.selectedLookIndex=e,this.selectLook(e),this.player.setModel(e),this.updatePlayerSprite()},e.prototype.selectSex=function(t){this.sex0.select=!1,this.sex1.select=!1,this.sexCheckBoxList[t].select=!0},e.prototype.selectRace=function(t){this.race0.select=!1,this.race1.select=!1,this.raceCheckBoxList[t].select=!0,this.jobLabel1.text=t==Define.RACE_EAST?Define.getJobString(Define.JOB_RANGER):Define.getJobString(Define.JOB_WARRIOR),this.jobLabel2.text=t==Define.RACE_EAST?Define.getJobString(Define.JOB_XIUZHEN):Define.getJobString(Define.JOB_WIZARD),this.updateSelectedJob()},e.prototype.selectJob=function(t){this.job0.select=!1,this.job1.select=!1,this.jobCheckBoxList[t].select=!0,this.updateSelectedJob()},e.prototype.updateSelectedJob=function(){var t=Define.getJobByRace(this.selectedRaceIndex,this.selectedJobIndex);this.player.setJob(t),this.statusLabel.textFlow=Define.getJobInfoString(t)},e.prototype.selectLook=function(t){for(var e=0,n=this.lookCheckBoxList;e<n.length;e++){n[e].selected=!1}this.lookCheckBoxList[t].selected=!0},e.prototype.updatePlayerSprite=function(){this.player.setStyleDataToIcon(),this.removeChild(this.playerSprite),this.player.refreshWorldSprite(),this.playerSprite=this.player.sprite,this.addPlayerSprite()},e.prototype.addPlayerSprite=function(){var t=xhd?490:245,e=xhd?300:150;this.playerSprite.x=t,this.playerSprite.y=e,this.playerSprite.scaleX=this.playerSprite.scaleY=xhd?nato.mapRatio:1,this.addChild(this.playerSprite)},e.prototype.onCreateRole=function(t){null==this.createRoleNamePanel&&(this.createRoleNamePanel=new CreateRoleName,nato.attachSkin(this.createRoleNamePanel),this.createRoleNamePanel.setScene(this)),this.addChild(this.createRoleNamePanel)},e.prototype.setTipsText=function(t){this.createRoleNamePanel.setTipsText(t)},e.prototype.createRole=function(t){this.player.setName(t),Login.instance.createPlayer(this.player)},e.prototype.createRoleSuccess=function(){this.createRoleNamePanel&&this.contains(this.createRoleNamePanel)&&this.removeChild(this.createRoleNamePanel),this.parent&&this.parent.removeChild(this)},e.prototype.onClose=function(t){Login.instance.openSelectRoleScene()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeChild(this.playerSprite)},e.prototype.getSelectSex=function(){return this.selectedSexIndex},e}(ComponentBase);__reflect(CreateRoleScene.prototype,"CreateRoleScene");var ImgCheckPanel=function(t){function e(){var e=t.call(this)||this;return e.type=0,e}return __extends(e,t),e.prototype.onCreate=function(){this.captchaImg=new egret.Bitmap,this.captchaImg.name="captchaImg",this.captchaImg.scaleX=2,this.captchaImg.scaleY=2,this.tips.textColor=16711680},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.captcha_container.removeChildren(),this.input.text="",ButtonUtils.addTouchEvent(this.btn_confirm,this.onConfirm,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_confirm),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeImgCheckPanel()},e.prototype.setImgCheck=function(t,e,n){this.type=e,this.tips.text=n;var i=(document.createElement("canvas").getContext("2d"),new Image),o=this;i.onload=function(){var t=new egret.Texture,e=new egret.BitmapData(i);t._setBitmapData(e),o.captchaImg.texture=t,o.captcha_container.addChild(o.captchaImg)},i.onerror=function(){console.error("build captcha error")},i.src="data:image/png;base64,"+nato.hexToBase64(t.dataView,0,t.length)},e.prototype.onConfirm=function(t){var e=this.input.text;if(this.onClose(),!Tool.isNullText(e))switch(this.type){case Login.IMG_CHECK_TYPE_LOGIN:GameWorld.strImgCheck=e;break;case Login.IMG_CHECK_TYPE_REGISTER:GameWorld.strImgCreate=e}},e}(ComponentBase);__reflect(ImgCheckPanel.prototype,"ImgCheckPanel");var LoginPanel=function(t){function e(){var e=t.call(this)||this;return e.lastLoginClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.input_account.text=this._account,this.input_password.text=this._password,this.tips.text="",this.tips.textColor=16711680,ButtonUtils.addTouchEvent(this.btn_enterGame,this.login,this),ButtonUtils.addTouchEvent(this.btn_managerAccount,this.openRegisterPanel,this),ButtonUtils.addTouchEvent(this.btn_modifyPassword,this.openModifyPasswordPanel,this),ButtonUtils.addTouchEvent(this.btn_notice,this.onBtnNotice,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_enterGame),ButtonUtils.removeTouchEvent(this.btn_managerAccount),ButtonUtils.removeTouchEvent(this.btn_notice)},e.prototype.onCheckboxSelect=function(){},e.prototype.setAccount=function(t,e){Tool.isNullText(t)?this.assignLocalStorageAccount():(this._account=t,this._password=e)},e.prototype.updateAccountInStorage=function(t,e){var n=new Account(t,e);this.accountList=[n],Login.instance.saveAccountInStorage(t,e)},e.prototype.assignLocalStorageAccount=function(){if(null==xaccountlist||""==xaccountlist?this.accountList=[]:(this.accountList=JSON.parse(xaccountlist),null==this.accountList&&(this.accountList=[])),0==this.accountList.length)this._account="",this._password="";else{var t=this.accountList[0];this._account=t.account,this._password=t.passwd}},e.prototype.login=function(t){if(!(egret.getTimer()-this.lastLoginClickTime<500)){this.lastLoginClickTime=egret.getTimer();var e=this.input_account.text,n=this.input_password.text;if(""==e)return void this.updateTips("账号不能为空!");if(""==n)return void this.updateTips("密码不能为空！");GameWorld.username=e,GameWorld.password=n;var i=MsgHandler.createUserLoginMsg(e,n);Login.instance.sendLogin(i),this.updateAccountInStorage(e,n)}},e.prototype.openRegisterPanel=function(){PanelManager.closeLoginPanel(),PanelManager.openRegisterPanel()},e.prototype.openModifyPasswordPanel=function(){PanelManager.closeLoginPanel(),PanelManager.openModifyPasswordPanel()},e.prototype.onBtnExchange=function(){Login.isChangeServer=!0,this.login(null)},e.prototype.onBtnNotice=function(){GameNotice.showNotice()},e.prototype.updateTips=function(t){this.tips.text=t},e}(ComponentBase);__reflect(LoginPanel.prototype,"LoginPanel");var Account=function(t,e){this.account=t,this.passwd=e};__reflect(Account.prototype,"Account");var ModifyAccount=function(t){function e(){var e=t.call(this)||this;return e.lastClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.input1.textAlign=egret.HorizontalAlign.CENTER,this.input2.textAlign=egret.HorizontalAlign.CENTER},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.reset()},e.prototype.onConfirm=function(){egret.getTimer()-this.lastClickTime<500||(this.lastClickTime=egret.getTimer(),this.onConfirmModifyAccount())},e.prototype.onConfirmModifyAccount=function(){return""==this.input1.text||""==this.input2.text?void(this.tips.text="账号或密码不能为空"):this.input1.text.length>12?void(this.tips.text=GameText.STR_PET_NAME_TOOLONG):(this.callback(this.input1.text,this.input2.text),void PopUpManager.removePopUp(PanelManager.modifyAccountPanel))},e.prototype.onCancel=function(){PopUpManager.removePopUp(PanelManager.modifyAccountPanel)},e.prototype.setData=function(t,e){this.input1.text=GameWorld.username,this.input2.text=GameWorld.password,this.callback=t,this.thisObj=e},e.prototype.reset=function(){this.input1.text="",this.input2.text="",this.tips.text=""},e}(ComponentBase);__reflect(ModifyAccount.prototype,"ModifyAccount");var ModifyName=function(t){function e(){var e=t.call(this)||this;return e.lastClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.input1.textAlign=egret.HorizontalAlign.CENTER},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.reset()},e.prototype.onConfirm=function(){egret.getTimer()-this.lastClickTime<500||(this.lastClickTime=egret.getTimer(),this.onConfirmModifyName())},e.prototype.onConfirmModifyName=function(){return""==this.input1.text?void(this.tips.text="名字不能为空"):this.input1.text.length>12?void(this.tips.text=GameText.STR_PET_NAME_TOOLONG):void this.callback(this.input1.text)},e.prototype.onCancel=function(){PopUpManager.removePopUp(PanelManager.modifyNamePanel)},e.prototype.setData=function(t,e){this.callback=t,this.thisObj=e},e.prototype.setTips=function(t){this.tips.text=t},e.prototype.reset=function(){this.input1.text="",this.tips.text=""},e}(ComponentBase);__reflect(ModifyName.prototype,"ModifyName");var ModifyPasswordPanel=function(t){function e(){var e=t.call(this)||this;return e.lastClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.input_account.text="",this.input_password.text="",this.input_new_password.text="",this.tips.text="",this.tips.textColor=16711680,ButtonUtils.addTouchEvent(this.btn_confirm,this.onModifyPassword,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_confirm),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeModifyPasswordPanel(),PanelManager.openLoginPanel()},e.prototype.onModifyPassword=function(t){if(!(egret.getTimer()-this.lastClickTime<500)){this.lastClickTime=egret.getTimer();var n=this.input_account.text,i=this.input_password.text,o=this.input_new_password.text;GameWorld.modifyAccount=n,GameWorld.modifyPwd=i,GameWorld.modifyNewPwd=o;var a=PanelManager.getPanel(e);if(0==n.length)return void(a&&a.stage&&a.updateTips("账号不能为空！"));if(0==i.length||0==o.length)return void(a&&a.stage&&a.updateTips("密码不能为空！"));a&&a.stage&&a.updateTips(""),Login.instance.isLoginServerConnected?Login.instance.sendModifyPassword(n,i,o):Login.instance.connectLoginServer(!1,!1,!0)}},e.prototype.updateTips=function(t){this.tips.text=t},e}(ComponentBase);__reflect(ModifyPasswordPanel.prototype,"ModifyPasswordPanel");var RegisterPanel=function(t){function e(){var e=t.call(this)||this;return e.lastClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.input_account.text="",this.input_password.text="",this.tips.text="",this.tips.textColor=16711680,ButtonUtils.addTouchEvent(this.btn_enterGame,this.onRegister,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_enterGame),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeRegisterPanel(),PanelManager.openLoginPanel()},e.prototype.onRegister=function(t){if(!(egret.getTimer()-this.lastClickTime<500)){this.lastClickTime=egret.getTimer();var n=this.input_account.text,i=this.input_password.text;GameWorld.registerAccount=n,GameWorld.registerPasswd=i;var o=PanelManager.getPanel(e);if(""==n)return void(o&&o.stage&&o.updateTips("账号不能为空！"));if(""==i)return void(o&&o.stage&&o.updateTips("密码不能为空！"));o&&o.stage&&o.updateTips(""),Login.instance.isLoginServerConnected?Login.instance.registerAccount(n,i):Login.instance.connectLoginServer(!1,!0)}},e.prototype.updateTips=function(t){this.tips.text=t},e}(ComponentBase);__reflect(RegisterPanel.prototype,"RegisterPanel");var SafeLockPassword=function(t){function e(){var e=t.call(this)||this;return e.lastClickTime=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.reset()},e.prototype.onConfirm=function(){egret.getTimer()-this.lastClickTime<500||(this.lastClickTime=egret.getTimer(),this.onConfirmDeleteRole())},e.prototype.onConfirmDeleteRole=function(){return""==this.input.text?void(this.tips.text="安全码不能为空"):void this.callback(this.input.text)},e.prototype.onCancel=function(){PopUpManager.removePopUp(PanelManager.protectCodePanel)},e.prototype.setData=function(t,e){this.callback=t,this.thisObj=e},e.prototype.setTips=function(t){this.tips.text=t},e.prototype.reset=function(){this.input.text="",this.tips.text=""},e}(ComponentBase);__reflect(SafeLockPassword.prototype,"SafeLockPassword");var SelectRoleScene=function(t){function e(){var e=t.call(this)||this;return e.curPlayerListStartIndex=0,e}return __extends(e,t),e.prototype.onCreate=function(){Statistic.selectRole(GameWorld.ukey.value.toString(),xchannel,ServerInfo.getSelectServer().id),this.roleCtn0.name="roleCtn_0",this.roleCtn1.name="roleCtn_1",this.roleCtn2.name="roleCtn_2",this.btnCreateList=[this.btn_create0,this.btn_create1,this.btn_create2],this.effList=[this.eff_selected0,this.eff_selected1,this.eff_selected2],this.roleCtnList=[this.roleCtn0,this.roleCtn1,this.roleCtn2],8600==xchannel&&(this.btn_return.visible=!1);for(var t=0;3>t;t++)this.effList[t].visible=!1;this.btn_create0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCreate,this),this.btn_create1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCreate,this),this.btn_create2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCreate,this),this.roleCtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectPlayer,this),this.roleCtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectPlayer,this),this.roleCtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectPlayer,this),this.prevPage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPrevPage,this),this.nextPage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextPage,this),this.btn_enterGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnterGame,this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogout,this),this.btn_deleteRole.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDeleteRole,this),this.btn_recoverRole.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecoverRole,this)},e.prototype.onTouchCreate=function(t){var e=this.btnCreateList.indexOf(t.target);return-1!=e&&e>=xworld.actorCreatableCount?void WorldMessage.addTips("VIP等级不足"):void Login.instance.openCreateRoleScene()},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.curPlayerListStartIndex=0,Login.instance.allPlayerList,this.updatePlayerListView(),this.btn_create1.visible&&(xworld.actorCreatableCount>=2?this.btn_create1.source="select_role_create"+(xhd?"_hd":"_sd"):this.btn_create1.source="select_role_create_vip1"+(xhd?"_hd":"_sd")),this.btn_create2.visible&&(xworld.actorCreatableCount>=3?this.btn_create2.source="select_role_create"+(xhd?"_hd":"_sd"):this.btn_create2.source="select_role_create_vip4"+(xhd?"_hd":"_sd"))},e.prototype.onPrevPage=function(){0!=this.curPlayerListStartIndex&&(this.curPlayerListStartIndex-=1,this.updatePlayerListView())},e.prototype.onNextPage=function(){var t=Login.instance.allPlayerList;this.curPlayerListStartIndex+3>=t.length||(this.curPlayerListStartIndex+=1,this.updatePlayerListView())},e.prototype.updatePlayerListView=function(){for(var t=0;3>t;t++)this.effList[t].visible=!1;this.selectedPlayer=null;var e=GameWorld.lastPlayerID,n=Login.instance.allPlayerList;for(t=0;3>t;t++)if(!(t>=n.length)){var i=n[this.curPlayerListStartIndex+t];this.btnCreateList[t].visible=!1;var o=i.createSprite(!1);o.name="sprite",xhd&&o.setScale(nato.mapRatio);var a=this.roleCtnList[t].getChildByName("sprite");a&&this.roleCtnList[t].removeChild(a),this.roleCtnList[t].addChild(o),i.getId()==e&&(this.selectedPlayer=i,this.effList[t].visible=!0)}null==this.selectedPlayer&&n.length>0&&(this.effList[0].visible=!0,this.selectedPlayer=n[this.curPlayerListStartIndex]),this.selectedPlayer&&this.updatePlayerInfo()},e.prototype.onSelectPlayer=function(t){var e=t.target;if(null!=e){var n=parseInt(e.name.split("_")[1]);this.selectedPlayer=Login.instance.allPlayerList[this.curPlayerListStartIndex+n],this.updatePlayerInfo();for(var i=0;3>i;i++)this.effList[i].visible=!1;this.effList[n].visible=!0}},e.prototype.updatePlayerInfo=function(){var t=this.selectedPlayer,e=ListPlayer.getPlayerListInfo(t);this.label_status.text=e,this.selectedPlayer.isStatusBit(ModelConst.STATUS_TEMP_DEL)?(this.btn_deleteRole.visible=!1,this.btn_recoverRole.visible=!0):(this.btn_deleteRole.visible=!0,this.btn_recoverRole.visible=!1)},e.prototype.onLogout=function(t){return 3100==xchannel?void(window.parent.location.href=window.parent.location.href):void Sdk.xsdk.logout()},e.prototype.onEnterGame=function(t){function e(){xworld.createMyPlayer(n.selectedPlayer.getId(),n.selectedPlayer.getName()),Login.instance.doPlayerLogin()}if(0!=Login.instance.allPlayerList.length){var n=this;this.selectedPlayer.isTabStatus(Model.OFFLINE_DOING)&&this.selectedPlayer.getLongLeaveTime()>0?AlertPanel.alert(GameText.STR_OFFLINE_MISSION_NOW,GameText.STR_OFFLINE_MISSION_DEL_ASK,e,this):e()}else Login.instance.openCreateRoleScene()},e.prototype.onDeleteRole=function(t){var e=MsgHandler.createDelPlayerMsg(this.selectedPlayer.getId());nato.Network.sendCmd(e,this.onDeleteRoleBack,this)},e.prototype.onRecoverRole=function(t){var e=MsgHandler.createCancelDelPlayerMsg(this.selectedPlayer.getId());nato.Network.sendCmd(e,this.onRecoverRoleBack,this)},e.prototype.onDeleteRoleBack=function(t){var e=t.getByte();if(-8!=e)if(0==e){this.selectedPlayer.setStatusBit(ModelConst.STATUS_TEMP_DEL);var n=t.getShort(),i=Date.now()+n*Tool.MILLIS_IN_MINUTE;this.selectedPlayer.setTimes(i),this.updatePlayerInfo()}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString());else this.doDeleteRoleByProtectCode()},e.prototype.doDeleteRoleByProtectCode=function(){PanelManager.openProtectCodePanel((function(n){var i=MsgHandler.createDeleteRoleByProtectCodeMsg(t,n);nato.Network.sendCmd(i,e.onDeleteRoleByProtectCodeBack,e)}),this);var t=this.selectedPlayer.getId(),e=this},e.prototype.onDeleteRoleByProtectCodeBack=function(t){var e=t.getByte();if(-8!=e)if(0==e){PanelManager.closeProtectCodePanel(),this.selectedPlayer.setStatusBit(ModelConst.STATUS_TEMP_DEL);var n=t.getShort(),i=Date.now()+n*Tool.MILLIS_IN_MINUTE;this.selectedPlayer.setTimes(i),this.updatePlayerInfo()}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString());else PanelManager.protectCodePanel.setTips("安全码错误")},e.prototype.onRecoverRoleBack=function(t){0==t.getByte()&&(this.selectedPlayer.clearStatusBit(ModelConst.STATUS_TEMP_DEL),this.updatePlayerInfo())},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0,i=this.roleCtnList;n<i.length;n++){i[n].removeChildren()}},e}(ComponentBase);__reflect(SelectRoleScene.prototype,"SelectRoleScene");var Mail=function(){function t(){this.toPID=0,this.sendType=0,this.money1=0,this.money2=0,this.money3=0,this.reqMoney1=0,this.reqMoney2=0,this.reqMoney3=0,this.status=0,this.type=0,this.intValue1=0}return t.prototype.isTypeBit=function(t){return 0!=(this.type&t)},t.prototype.setTabStatus=function(t,e){this.intValue1=Tool.setBit(t,e,this.intValue1)},t.prototype.isTabStatus=function(t){return Tool.isBit(t,this.intValue1)},t.prototype.addAttachItem=function(e){if(null==e)return!1;null==this.attachItem&&(this.attachItem=new Array(t.MAIL_MAX_ATTACHMENT));for(var n=0;n<this.attachItem.length;n++)if(null==this.attachItem[n])return this.attachItem[n]=e,!0;return!1},t.prototype.setAttachItem=function(e,n){return null==this.attachItem&&(this.attachItem=new Array(t.MAIL_MAX_ATTACHMENT)),!(0>n||n>this.attachItem.length)&&(this.attachItem[n]=e,!0)},t.prototype.isSameAttachItem=function(t){if(null==t)return-1;if(null==this.attachItem)return-1;for(var e=0;e<this.attachItem.length;e++)if(null!=this.attachItem[e]&&this.attachItem[e].slotPos==t.slotPos&&this.attachItem[e].id==t.id)return e;return-1},t.prototype.isHasReqMoney=function(t){if(null==t&&(t=new StringBuffer),this.reqMoney1<=0&&this.reqMoney2<=0&&this.reqMoney3<=0)return!1;var e="";this.reqMoney1>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY1+" -"+this.reqMoney1,ColorUtils.COLOR_RED)+" "),this.reqMoney2>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY2+" -"+this.reqMoney2,ColorUtils.COLOR_RED)+" "),this.reqMoney3>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY3+" -"+this.reqMoney3,ColorUtils.COLOR_RED)+" "),0==Tool.isNullText(e)&&t.append(Tool.manageString(GameText.STR_MAIL_PAY,e)),e="",this.money1>0&&(e+=GameText.STR_MONEY1+" +"+this.money1+" "),this.money2>0&&(e+=GameText.STR_MONEY2+" +"+this.money2+" "),this.money3>0&&(e+=GameText.STR_MONEY3+" +"+this.money3+" "),0==Tool.isNullText(e)&&t.append(Tool.manageString(GameText.STR_MAIL_PRESENT,e));var n=!1,i=this.money1-this.reqMoney1;e="",0!=i&&(n=0>i,e+=PowerString.makeColorString(GameText.STR_MONEY1+(n?" "+i:" +"+i)+" ",n?ColorUtils.COLOR_RED:ColorUtils.COLOR_GOLD_YELLOW));var o=this.money2-this.reqMoney2;0!=o&&(n=0>o,e+=PowerString.makeColorString(GameText.STR_MONEY2+(n?" "+o:" +"+o)+" ",n?ColorUtils.COLOR_RED:ColorUtils.COLOR_GOLD_YELLOW));var a=this.money3-this.reqMoney3;return 0!=a&&(n=0>a,e+=PowerString.makeColorString(GameText.STR_MONEY3+(n?" "+a:" +"+a)+" ",n?ColorUtils.COLOR_RED:ColorUtils.COLOR_GOLD_YELLOW)),0==Tool.isNullText(e)&&t.append(Tool.manageString(GameText.STR_MAIL_GROSS,e)),!0},t.prototype.isHasAttachItem=function(){if(null!=this.attachItem&&this.attachItem.length>=0)for(var t=0;t<this.attachItem.length;t++)if(null!=this.attachItem[t])return!0;return this.money1>0||this.money2>0||this.money3>0||this.reqMoney1>0||this.reqMoney2>0||this.reqMoney3>0},t.prototype.isHasSelectItem=function(){if(null!=this.selectItem&&this.selectItem.length>=0)for(var t=0;t<this.selectItem.length;t++)if(null!=this.selectItem[t])return!0;return!1},t.prototype.getMissionRewardDesc=function(){var t=new StringBuffer;t.append(Tool.convertDesc(this.content)),t.append("\n");var e=new Mission(-1);e.money2=this.money2,e.money3=this.money3,e.rewardItems=this.attachItem;var n=e.getMissionRewardString(!1,this.money1);return t.append(n),t.toString()},t.prototype.getTitleDesc=function(){var e=new StringBuffer;switch(this.isTypeBit(t.MAIL_TYPE_SEND)?e.append(Tool.manageString(GameText.STR_MAIL_TITLE_TYPE_SEND,this.toName)):this.isTypeBit(t.MAIL_TYPE_BACK)?e.append(Tool.manageString(GameText.STR_MAIL_TITLE_TYPE_BACK,this.toName)):e.append(Tool.manageString(GameText.STR_MAIL_TITLE_TYPE_OTHER,this.toName)),this.status){case t.MAIL_STATUS_READ_TEXT:case t.MAIL_STATUS_UNREAD_TEXT:case t.MAIL_STATUS_READ_ITEM:case t.MAIL_STATUS_UNREAD_ITEM:e.append(GameText.getText(GameText.TI_MAIL));break;case t.MAIL_STATUS_READ_TRADE:case t.MAIL_STATUS_UNREAD_TRADE:e.append(GameText.STR_MAIL_READ_MAIL);break;default:e.append(GameText.STR_MAIL_UNKNOWN_MAIL)}return e.toString()},t.prototype.getStatusDesc=function(){if(this.isTabStatus(t.DEL_STATUS))return"["+GameText.STR_MAIL_HAS_DEL+"]";switch(this.status){case t.MAIL_STATUS_UNREAD_TEXT:case t.MAIL_STATUS_UNREAD_ITEM:case t.MAIL_STATUS_UNREAD_TRADE:return"("+GameText.STR_MAIL_NEW+")";case t.MAIL_STATUS_READ_TEXT:case t.MAIL_STATUS_READ_ITEM:case t.MAIL_STATUS_READ_TRADE:return"["+GameText.STR_MAIL_HAS_READ+"]"}return""},t.prototype.setReadStatus=function(){switch(this.status){case t.MAIL_STATUS_UNREAD_TEXT:this.status=t.MAIL_STATUS_READ_TEXT;break;case t.MAIL_STATUS_UNREAD_ITEM:this.status=t.MAIL_STATUS_READ_ITEM;break;case t.MAIL_STATUS_UNREAD_TRADE:this.status=t.MAIL_STATUS_READ_TRADE}},t.prototype.isNewStatus=function(){switch(this.status){case t.MAIL_STATUS_UNREAD_TEXT:case t.MAIL_STATUS_UNREAD_ITEM:case t.MAIL_STATUS_UNREAD_TRADE:return!0;default:return!1}},t.prototype.isHaveItemStatus=function(){return!this.isTabStatus(t.DEL_STATUS)&&(this.status==t.MAIL_STATUS_UNREAD_ITEM||this.status==t.MAIL_STATUS_READ_ITEM||this.status==t.MAIL_STATUS_READ_TRADE)},t.fromBytes=function(e,n){n.toPID=e.getInt(),n.isTypeBit(t.MAIL_TYPE_SEND)?(e.getInt(),n.type=t.MAIL_TYPE_SEND):n.type=e.getInt(),e.getBoolean()&&n.setTabStatus(!0,t.DEL_STATUS),n.content=e.getString(),n.datetime=e.getString(),n.money1=e.getInt(),n.money2=e.getInt(),n.money3=e.getInt(),n.reqMoney1=e.getInt(),n.reqMoney2=e.getInt(),n.reqMoney3=e.getInt();var i=e.getByte();if(i>0){n.attachItem=new Array(i);for(var o=0;i>o;o++)n.attachItem[o]=ItemData.fromMailBytes(e)}if((i=e.getByte())>0){n.selectItem=new Array(i);for(o=0;i>o;o++)n.selectItem[o]=ItemData.fromMailBytes(e)}return n.type==t.MAIL_TYPE_TASK||n.type==t.MAIL_TYPE_SYSTEM?n.title=e.getString():Tool.isNullText(n.title)&&(n.title=n.getTitleDesc()),n.type==t.MAIL_TYPE_SERVICE&&(n.sendcontent=e.getString()),n},t.fromBytesSimpleMail=function(e,n){var i=new t;i.type=n,i.id=e.getLong(),i.toName=e.getString(),i.status=e.getByte();var o=e.getBoolean();return i.title=o?e.getString():i.getTitleDesc(),i.needcheck=e.getBoolean(),i},t.doMaildeduct=function(t,e){if(null!=t&&null!=e){e.money1>0&&t.addValue(ModelConst.MONEY1,-e.money1),e.money2>0&&t.addValue(ModelConst.MONEY2,-e.money2),e.money3>0&&t.addValue(ModelConst.MONEY3,-e.money3);var n=t.bag;if(null!=n){var i=e.attachItem;if(null!=i&&i.length>0)for(var o=null,a=0;a<i.length;a++)if(null!=(o=i[a])){n.removeBagItemByPos(o.slotPos,o.quantity)!=Define.SUCCESS&&WorldMessage.addSystemChat("邮件扣除附件物品失败!")}}}},t.prototype.isPayMoneySure=function(t){if(null!=this.attachItem&&this.attachItem.length>=0)for(var e=0;e<this.attachItem.length;e++){var n=this.attachItem[e];null!=n&&t.append(Tool.manageString(GameText.STR_MAIL_AFFIX,n.getRewardDesc()))}return this.money1>0&&t.append(PowerString.makeColorString(Tool.manageString(GameText.STR_MAIL_PRESENT,GameText.STR_MONEY1+this.money1),ColorUtils.COLOR_YELLOW)),this.money2>0&&t.append(PowerString.makeColorString(Tool.manageString(GameText.STR_MAIL_PRESENT,GameText.STR_MONEY2+this.money2),ColorUtils.COLOR_YELLOW)+"\n"),this.money3>0&&t.append(PowerString.makeColorString(Tool.manageString(GameText.STR_MAIL_PRESENT,GameText.STR_MONEY3+this.money3),ColorUtils.COLOR_YELLOW)+"\n"),!Tool.isNullText(t.toString())&&(!(this.reqMoney1>0||this.reqMoney2>0||this.reqMoney3>0)&&(t.append(GameText.STR_MAIL_SEND_ASK),!0))},t.doMailSendMsg=function(e,n){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;if(Tool.isNullText(e.toName))return AlertPanel.warnMessage(GameText.STR_MAIL_NO_NAME),!1;var i=function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString());else{t.doMaildeduct(xself,e);var i=GameText.STR_MAIL_SEND_SUCCESS;(e.reqMoney1>0||e.reqMoney2>0||e.reqMoney3>0)&&(i+=GameText.STR_MAIL_SEND_SUCCESS_INFO),PanelManager.closeScene(),AlertPanel.alertCommon(i)}},o=function(){var t=null;switch(n){case ProtocolDefine.MAIL_SEND_ID:t=MsgHandler.createMailSendByID(e,e.toPID);break;case ProtocolDefine.MAIL_SEND_NAME:t=MsgHandler.createMailSendByName(e,e.toName);break;case ProtocolDefine.MAIL_SEND_UID:t=MsgHandler.createMailSendByUID(e,e.toName);break;default:return}t&&(nato.Network.sendCmd(t,i,this),PanelManager.openWaitForServer())},a=new StringBuffer;return e.isPayMoneySure(a)?AlertPanel.alert(GameText.getText(GameText.TI_WARN),a.toString(),o,this):o(),!1},t.doMailListMsg=function(e){var n=t.PAGE_NUM_MAX,i=0;e==MailScene.TYPE_READ_FROM_PLAYER?i=t.MAIL_TYPE_PLAYER:e==MailScene.TYPE_READ_FROM_TASK?i=t.MAIL_TYPE_TASK:e==MailScene.TYPE_READ_FROM_PAY?i=t.MAIL_TYPE_MONEY:e==MailScene.TYPE_READ_FROM_GM?i=t.MAIL_TYPE_SERVICE|t.MAIL_TYPE_SYSTEM:e==MailScene.TYPE_READ_FROM_TRADE?i=t.MAIL_TYPE_SEND:e==MailScene.TYPE_READ_FROM_RETURN&&(i=t.MAIL_TYPE_BACK|t.MAIL_TYPE_RECEIPT),PanelManager.openWaitForServer();var o=MsgHandler.createMailListMsg(i,n,1);nato.Network.sendCmd(o,(function(n){PanelManager.closeWaitForServer();var o=n.getShort();if(0>o)AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString());else{for(var a=n.getByte(),r=[],s=0;a>s;s++){var l=t.fromBytesSimpleMail(n,i);null!=l&&r.push(l)}t.curMailList=r,o>0?PanelManager.openMailListPanel(e,!1):AlertPanel.alertCommon("信箱中没有邮件！")}}),this)},t.doMailInformMsg=function(e){if(null==e||0==e.isTypeBit(t.MAIL_TYPE_PLAYER))return!1;var n=function(t){return PanelManager.closeWaitForServer(),0>t.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString()):(AlertPanel.alertCommon(GameText.STR_MAIL_INFORM_SUCCESS),void PanelManager.closeScene())};AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_MAIL_INFORM_ASK,(function(){var t=new nato.Message(ProtocolDefine.CG_MAIL_REPORT);t.putLong(e.id),nato.Network.sendCmd(t,n,this),PanelManager.openWaitForServer()}),this)},t.doMailDetailMsg=function(e){if(null==e)return!1;if(e.isTabStatus(t.DEL_STATUS))return AlertPanel.alertCommon(GameText.STR_NO_MAIL),!1;if(e.needcheck&&0==SafeLock.doSafeLockVerify())return!1;var n=MsgHandler.createMailDetailMsg(e.id);return nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString());else{var i=e.isTypeBit(t.MAIL_TYPE_TASK),o=e.isTypeBit(t.MAIL_TYPE_SERVICE)&&0==e.isTypeBit(t.MAIL_TYPE_SYSTEM);if(t.fromBytes(n,e),e.setReadStatus(),i){var a=[],r=new NPCActionData(GameText.getText(GameText.TI_GET_MISSION),9,e);a.push(r),PanelManager.openNPCDialogue(e.title,e.getMissionRewardDesc(),a,e.attachItem,e.selectItem,null)}else o?PanelManager.openMailReadFromGMPanel(e.type,e):PanelManager.openMailReadPanel(e.type,e)}}),this),PanelManager.openWaitForServer(),!0},t.doAttachItemMsg=function(e,n){if(0==e.isTypeBit(t.MAIL_TYPE_TASK)&&0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var i=function(n){if(0>n.getByte())AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString());else{var i=xself;if(null!=i){var o,a=n.getInt(),r=n.getInt(),s=n.getInt(),l=new StringBuffer;o=a>i.money1?l:null,i.setMoneyByType(ModelConst.MONEY1,a,o,!1),o=r>i.money2?l:null,i.setMoneyByType(ModelConst.MONEY2,r,o,!1),o=s>i.money3?l:null,i.setMoneyByType(ModelConst.MONEY3,s,o,!1);var _=MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_MAIL_REWARD);Tool.isNullText(_);var h=l.toString().split("\n");if(h&&h.length>0)for(var u=0;u<h.length;u++){var c=h[u];0==Tool.isNullText(c)&&WorldMessage.addTips("获得 "+c)}e.setTabStatus(!0,t.DEL_STATUS);var T=PanelManager.getPanel(MailListPanel,!1),p=PanelManager.getPanel(MailReadPanel,!1);T&&T.stage&&T.update(),p&&p.stage&&p.onClose()}}},o=function(){if(e.isHasSelectItem()){if(null==n)for(var t=0;t<e.selectItem.length;t++)if(null!=e.selectItem[t]){n=e.selectItem[t];break}}else n=null;var o=null==n?0:n.id,a=MsgHandler.createMailAttachMsg(e,o);nato.Network.sendCmd(a,i,this)},a=new StringBuffer;if(e.isTypeBit(t.MAIL_TYPE_BACK)||e.isTypeBit(t.MAIL_TYPE_RECEIPT)||1!=e.isHasReqMoney(a))o();else{var r=function(){o(),AlertPanel.closeAll()};AlertPanel.alert(GameText.getText(GameText.TI_MAIL_PICK_ITEM),Tool.manageString(GameText.STR_MAIL_PICK_ASK,a.toString()),(function(){Model.checkEnoughMoney(e.reqMoney1,e.reqMoney2,e.reqMoney3,r,this)}),this)}},t.doDeleteMailMsg=function(e,n){if(void 0===n&&(n=!1),0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var i=MsgHandler.createMailDeleteMsg(e.id);return nato.Network.sendCmd(i,(function(i){return 0>i.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),i.getString()):(e.setTabStatus(!0,t.DEL_STATUS),AlertPanel.alertCommon(GameText.STR_MAIL_DEL_SUCCESS),void(PanelManager.isPanelShow(MailReadPanel)||PanelManager.isPanelShow(MailReadFromGMPanel)?PanelManager.closeScene():n?PanelManager.openMailListPanel(MailScene.TYPE_READ_FROM_GM,!1):PanelManager.openMailListPanel(MailScene.TYPE_READ_FROM_PLAYER,!1)))}),this),!0},t.doBackmailMsg=function(e){if(0==SafeLock.doSafeLockVerify())return!1;if(null==e)return!1;var n=MsgHandler.createMailBackMsg(e.id);return nato.Network.sendCmd(n,(function(n){return 0>n.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),n.getString()):(e.setTabStatus(!0,t.DEL_STATUS),AlertPanel.alertCommon(GameText.STR_MAIL_BACK_SUCCESS),void PanelManager.openMailListPanel(MailScene.TYPE_READ_FROM_PLAYER,!1))}),this),!0},t.doMailSendGMMsg=function(t,e){var n=MsgHandler.createMailSendGMMsg(t,e);nato.Network.sendCmd(n,(function(t){return 0>t.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString()):(PanelManager.openMailScene(!1),void AlertPanel.alertCommon(GameText.STR_MAIL_SEND_GM_SUCCESS))}),this)},t.doMenuButton=function(e,n,i){if(void 0===i&&(i=null),null==e)return!1;var o=!1;switch(n){case t.EVENT_ALL_BACK:break;case t.EVENT_NOTE:e.doItemSee(i);break;case t.EVENT_ALL_MAIL_REPLY:o=!0;break;case t.EVENT_ALL_MAIL_REFUSE:case t.EVENT_ALL_MAIL_REGAIN:o=t.doBackmailMsg(e);break;case t.EVENT_ALL_MAIL_PICK:o=t.doAttachItemMsg(e,i);break;case t.EVENT_ALL_MAIL_DEL:o=t.doDeleteMailMsg(e);break;case t.EVENT_ALL_MAIL_SEND:(o=t.doMailSendMsg(e,e.sendType))&&PlayerBag.clearBagAllItemStatus(xself,PlayerBag.CLEAR_BAG_MAIL_SELECT);break;case t.EVENT_ALL_MENU_RECMAIL_REPORT:o=t.doMailInformMsg(e);break;case t.EVENT_SERVICER_EMAIL_EVALUATE:AlertPanel.alertCommon(GameText.STR_NOT_OPEN);break;case t.EVENT_SERVICER_EMAIL_DEL:o=t.doDeleteMailMsg(e);case t.EVENT_ALL_ENTER_CONTINUE_PAY:}return o},t.prototype.doItemSee=function(t){if(null==t)return!1;if(t.isPetType()){var e=new MyPet(null);e.petItem=t;MyPet.doPetInfoMsg(e,MsgHandler.PET_INFO_MAIL,[this.id,t.slotPos],(function(){PanelManager.openPetDetailScene(e,PetDetailScene.FromType_see)}),this)}else if(0==t.isStatusBit(1024)){var n=MsgHandler.createMailSeeItem(this.id,t.slotPos);nato.Network.sendCmd(n,(function(e){return 0>e.getByte()?void AlertPanel.errorMessage(e.getString()):(ItemData.fromBytesEdit(t,e),MsgHandler.processGetSuitInfoMsg(e),t.setStatusBit(!0,1024),void AlertPanel.alertTipsTextFlow(t.name,Tool.convertDescToTextFlow(t.getDesc(xself)),"left"))}),this)}else AlertPanel.alertTipsTextFlow(t.name,Tool.convertDescToTextFlow(t.getDesc(xself)),"left");return!0},t.newMailNoticeAction=function(){var e=MsgHandler.createMailNewNotice();nato.Network.sendCmd(e,(function(e){return 0>e.getByte()?void AlertPanel.errorMessage(e.getString()):(t.newMailNum[0]=e.getUnsignedByte(),t.newMailNum[1]=e.getUnsignedByte(),t.newMailNum[2]=e.getUnsignedByte(),t.newMailNum[3]=e.getUnsignedByte(),t.newMailNum[4]=e.getUnsignedByte(),void(PanelManager.isPanelShow(MailScene)&&PanelManager.getPanel(MailScene).update()))}),this)},t.removeNewMailNum=function(e){switch(e){case t.MAIL_TYPE_PLAYER:t.newMailNum[0]-=1;break;case t.MAIL_TYPE_TASK:t.newMailNum[1]-=1;break;case t.MAIL_TYPE_MONEY:t.newMailNum[2]-=1;break;case t.MAIL_TYPE_SERVICE|t.MAIL_TYPE_SYSTEM:t.newMailNum[3]-=1;break;case t.MAIL_TYPE_BACK|t.MAIL_TYPE_RECEIPT:t.newMailNum[4]-=1}this.checkHaveNewMail()},t.checkHaveNewMail=function(){0>=t.newMailNum[0]+t.newMailNum[1]+t.newMailNum[2]+t.newMailNum[3]+t.newMailNum[4]&&xself&&xself.setTabStatus(!1,Model.MAIL_NEW_NOTICE)},t.isAllAttach=function(e){return e==t.MAIL_TYPE_TASK||e==(t.MAIL_TYPE_BACK|t.MAIL_TYPE_RECEIPT)},t.prototype.isDirectAttach=function(){if(this.reqMoney1>0||this.reqMoney2>0||this.reqMoney3>0)return!1;if(this.isHasSelectItem())return!1;if(this.money1>0||this.money2>0||this.money3>0)return!0;if(null!=this.attachItem&&this.attachItem.length>=0)for(var t=0;t<this.attachItem.length;t++)if(null!=this.attachItem[t])return!0;return!1},t.doAllAttach=function(e,n){function i(){++c>=e.length?a():o(e[c])}function o(e){function n(n){if(0>n.getByte())a(n.getString());else if(null!=xself){r.setMoneyByType(ModelConst.MONEY1,n.getInt()),r.setMoneyByType(ModelConst.MONEY2,n.getInt()),r.setMoneyByType(ModelConst.MONEY3,n.getInt());var o=MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_MAIL_REWARD);0==Tool.isNullText(o)&&h.append(o+"\n"),e.setTabStatus(!0,t.DEL_STATUS),u++,i()}}if(null!=e)if(e.isTabStatus(t.DEL_STATUS))i();else{var o=(e.status,MsgHandler.createMailDetailMsg(e.id));nato.Network.sendCmd(o,(function(o){return 0>o.getByte()?(o.getString(),void a()):(t.removeNewMailNum(e.type),t.fromBytes(o,e),0==e.isDirectAttach()?void i():(o=MsgHandler.createMailAttachMsg(e,0),void nato.Network.sendCmd(o,n,this)))}),this),PanelManager.openWaitForServer(Tool.manageString(GameText.STR_MAIL_PICK_READ_NUM,u+1+""))}else i()}function a(t){if(void 0===t&&(t=null),PanelManager.closeWaitForServer(),0!=u){var e="",n=r.get(ModelConst.MONEY1)-s;n>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY1+n,ColorUtils.COLOR_YELLOW)+" ");var i=r.get(ModelConst.MONEY2)-l;i>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY2+i,ColorUtils.COLOR_MONEY2)+" ");var o=r.get(ModelConst.MONEY3)-_;o>0&&(e+=PowerString.makeColorString(GameText.STR_MONEY3+o,ColorUtils.COLOR_MONEY3)+" "),0==Tool.isNullText(e)&&(e+="\n"),e+=h.toString();var a="成功提取/c00ff00"+u+"/p封邮件";if(0==Tool.isNullText(e)&&(a+="，获得\n"+e),0==Tool.isNullText(t)&&(a+="\n",a+="剩余领取失败，原因：\n"+t),AlertPanel.alertCommon(a),PanelManager.isPanelShow(MailListPanel))PanelManager.getPanel(MailListPanel).update()}else 0==Tool.isNullText(t)?AlertPanel.alertCommon(t):AlertPanel.alertCommon(GameText.STR_MAIL_PICK_NULL)}if(0!=SafeLock.doSafeLockVerify()&&null!=e&&0!=e.length){var r=xself;if(null!=r){var s=r.get(ModelConst.MONEY1),l=r.get(ModelConst.MONEY2),_=r.get(ModelConst.MONEY3),h=new StringBuffer,u=0,c=-1;i()}}},t.isServiceEmail=function(e){return e==t.MAIL_TYPE_SERVICE||e==(t.MAIL_TYPE_SERVICE|t.MAIL_TYPE_SYSTEM)},t.prototype.toString=function(){var t=new StringBuffer;if(t.append("标题:"+this.title+"\n"),t.append("内容:"+this.content+"\n"),t.append("日期:"+this.datetime+"\n"),this.money1>0&&t.append("赠送金:"+this.money1+"\n"),this.money2>0&&t.append("赠送银:"+this.money2+"\n"),this.money3>0&&t.append("赠送铜:"+this.money3+"\n"),this.reqMoney1>0&&t.append("付费金:"+this.reqMoney1+"\n"),this.reqMoney2>0&&t.append("付费银:"+this.reqMoney2+"\n"),this.reqMoney3>0&&t.append("付费铜:"+this.reqMoney3+"\n"),null!=this.attachItem&&this.attachItem.length>0){t.append("附件物品:\n");for(var e=0;e<this.attachItem.length;e++){null!=(n=this.attachItem[e])&&t.append(n.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+n.quantity+"\n")}}if(null!=this.selectItem&&this.selectItem.length>0){t.append("可选物品:\n");for(e=0;e<this.selectItem.length;e++){var n;null!=(n=this.selectItem[e])&&t.append(n.getNameInfo()+GameText.getText(GameText.TI_ITEM_X)+n.quantity+"\n")}}return t.toString()},t.prototype.getToName=function(t){return void 0===t&&(t=!1),t&&Tool.isNullText(this.toName)?GameText.STR_MAIL_CHOICE_PEOPLE:this.toName},t.prototype.setToName=function(t){this.toName=t},t.prototype.getContent=function(t){return void 0===t&&(t=!1),t&&Tool.isNullText(this.content)?GameText.STR_MAIL_INPUT_CON:this.content},t.prototype.setContent=function(t){this.content=t},t.PAGE_NUM_MAX=127,t.MAIL_TYPE_SEND=1,t.MAIL_TYPE_SYSTEM=2,t.MAIL_TYPE_MONEY=4,t.MAIL_TYPE_TASK=8,t.MAIL_TYPE_SERVICE=16,t.MAIL_TYPE_PLAYER=32,t.MAIL_TYPE_BACK=64,t.MAIL_TYPE_RECEIPT=128,t.MAIL_TYPE_CHARGE_FAIL=256,t.MAIL_GM_BUG=0,t.MAIL_GM_MONEY=1,t.MAIL_STATUS_UNREAD_TEXT=1,t.MAIL_STATUS_UNREAD_ITEM=2,t.MAIL_STATUS_UNREAD_TRADE=3,t.MAIL_STATUS_READ_TEXT=4,t.MAIL_STATUS_READ_ITEM=5,t.MAIL_STATUS_READ_TRADE=6,t.MAIL_MAX_ATTACHMENT=3,t.EVENT_ALL_BACK=-1,t.EVENT_BACK=998,t.EVENT_NOTE=910,t.EVENT_ALL_MAIL_REPLY=11080,t.EVENT_ALL_MAIL_REFUSE=11081,t.EVENT_ALL_MAIL_REGAIN=11082,t.EVENT_ALL_MAIL_PICK=11083,t.EVENT_ALL_MAIL_DEL=11084,t.EVENT_ALL_MAIL_SEND=11085,t.EVENT_ALL_ENTER_CONTINUE_PAY=11364,t.EVENT_ALL_MENU_RECMAIL_REPORT=11298,t.EVENT_SERVICER_EMAIL_SEND=11401,t.EVENT_SERVICER_EMAIL_RECEIVE=11402,t.EVENT_SERVICER_EMAIL_EVALUATE=11403,t.EVENT_SERVICER_EMAIL_DEL=11404,t.newMailNum=[0,0,0,0,0],t.curMailList=null,t.DEL_STATUS=1,t}();__reflect(Mail.prototype,"Mail");var MailInputNameView=function(t){function e(){var e=t.call(this)||this;return e.selectIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.checkbtn_name.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnName,this),this.checkbtn_id.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnId,this),this.selectIndex=0,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.checkbtn_name.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnName,this),this.checkbtn_id.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnId,this)},e.prototype.onBtnName=function(){this.selectIndex=0,this.update()},e.prototype.onBtnId=function(){this.selectIndex=1,this.update()},e.prototype.update=function(){this.init&&(this.checkbtn_name.select=0==this.selectIndex,this.checkbtn_id.select=1==this.selectIndex)},e}(ComponentBase);__reflect(MailInputNameView.prototype,"MailInputNameView");var MailItem=function(t){function e(){var e=t.call(this)||this;return e._isWrite=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"isWrite",{get:function(){return this._isWrite},set:function(t){this._isWrite=t},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._data=t,this.update()},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._data=null,this.update()},e.prototype.update=function(){this.init&&(this._data?(this.item.itemData=this._data,this.label_name.textFlow=Tool.convertDescToTextFlow(this._data.getNameInfo()),this._isWrite?(this.btn_action.visible=!1,this.btn_del.visible=!0):(this.btn_action.visible=!0,this.btn_del.visible=!1)):(this.btn_action.visible=!1,this.btn_del.visible=!1,this.item.itemData=null,this._isWrite?this.label_name.text="  <添加道具>  ":this.label_name.text=""))},e}(ComponentBase);__reflect(MailItem.prototype,"MailItem");var MailListItem=function(t){function e(){var e=t.call(this)||this;return e._type=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._type=t,this._mail=e},e.prototype.reset=function(){},e.prototype.update=function(){this.init&&null!=this._mail&&(this.label_name.text=this._mail.title,this.label_status.text=this._mail.getStatusDesc(),this.img_haveItem.visible=this._mail.isHaveItemStatus(),this._mail.isNewStatus()&&RedPoint.addRedPoint(this,0,0))},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mail",{get:function(){return this._mail},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(MailListItem.prototype,"MailListItem");var MailListPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._type=0,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_getAll,this.onBtnGetAll,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_getAll),this.container.setScrollCallback(null,null)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnGetAll=function(){this._mailList&&this._mailList.length>0?Mail.doAllAttach(this._mailList,this._type):AlertPanel.alertCommon(GameText.STR_MAIL_PICK_NULL)},e.prototype.onMailListItemTouch=function(t){var e;t.target instanceof MailListItem?e=t.target:t.target.parent instanceof MailListItem&&(e=t.target.parent),e&&e.type>0&&e.mail&&(t.target==e.img_haveItem?ButtonUtils.buttonTweenEffect(e.img_haveItem,(function(){Mail.doAttachItemMsg(e.mail,null)}),this):Mail.doMailDetailMsg(e.mail),Mail.removeNewMailNum(e.mail.type))},e.prototype.setData=function(t){this._type=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.waitForServer=function(){if(this.init){this.reset();var t="";this._type==MailScene.TYPE_READ_FROM_PLAYER?t=GameText.getText(GameText.TI_MAIL_TYPE_PLAYER):this._type==MailScene.TYPE_READ_FROM_TASK?t=GameText.getText(GameText.TI_MAIL_TYPE_TASK):this._type==MailScene.TYPE_READ_FROM_PAY?t=GameText.getText(GameText.TI_MAIL_TYPE_MONEY):this._type==MailScene.TYPE_READ_FROM_GM?t=GameText.getText(GameText.TI_MAIL_TYPE_SERVICE):this._type==MailScene.TYPE_READ_FROM_TRADE?t=GameText.getText(GameText.TI_MAIL_TYPE_SEND):this._type==MailScene.TYPE_READ_FROM_RETURN&&(t=GameText.getText(GameText.TI_MAIL_TYPE_BACK)),this.label_title.text=t}},e.prototype.update=function(){if(this.init&&(this._mailList=Mail.curMailList,null!=this._mailList&&0!=this._mailList.length)){this.reset();for(var t=0;t<this._mailList.length;t++){var e=this._mailList[t],n=this.getItem();n.setData(this._type,e),this.container.add(n,0)}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new MailListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMailListItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(MailListPanel.prototype,"MailListPanel");var MailReadFromGMPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_del,this.onBtnDel,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_del),ButtonUtils.removeTouchEvent(this.closeBtn),this._mail=null},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnDel=function(){Mail.doDeleteMailMsg(this._mail,!0)},e.prototype.setData=function(t,e){this._type=t,this._mail=e},e.prototype.reset=function(){},e.prototype.update=function(){this.init&&(this._mail?(this.label_myDesc.text=this._mail.sendcontent,this.label_gmDesc.text=this._mail.getContent()):(this.label_myDesc.text="",this.label_gmDesc.text=""))},e}(ComponentBase);__reflect(MailReadFromGMPanel.prototype,"MailReadFromGMPanel");var MailReadPanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_get,this.onBtnGet,this),ButtonUtils.addTouchEvent(this.btn_get2,this.onBtnReply,this),ButtonUtils.addTouchEvent(this.btn_refuse,this.onBtnRefuse,this),ButtonUtils.addTouchEvent(this.btn_report,this.onBtnReport,this),ButtonUtils.addTouchEvent(this.item0.btn_action,this.onBtnItemAction0,this),ButtonUtils.addTouchEvent(this.item1.btn_action,this.onBtnItemAction1,this),ButtonUtils.addTouchEvent(this.item2.btn_action,this.onBtnItemAction2,this),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2]),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_get),ButtonUtils.removeTouchEvent(this.btn_get2),ButtonUtils.removeTouchEvent(this.btn_refuse),ButtonUtils.removeTouchEvent(this.btn_report),ButtonUtils.removeTouchEvent(this.item0.btn_action),ButtonUtils.removeTouchEvent(this.item1.btn_action),ButtonUtils.removeTouchEvent(this.item2.btn_action)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnItemAction0=function(){this.item0.itemData&&Mail.doMenuButton(this._mail,Mail.EVENT_NOTE,this.item0.itemData)},e.prototype.onBtnItemAction1=function(){this.item1.itemData&&Mail.doMenuButton(this._mail,Mail.EVENT_NOTE,this.item1.itemData)},e.prototype.onBtnItemAction2=function(){this.item2.itemData&&Mail.doMenuButton(this._mail,Mail.EVENT_NOTE,this.item2.itemData)},e.prototype.onBtnGet=function(){this._mail&&(this._mail.isTypeBit(Mail.MAIL_TYPE_SEND)?Mail.doMenuButton(this._mail,Mail.EVENT_ALL_MAIL_REGAIN):Mail.doMenuButton(this._mail,Mail.EVENT_ALL_MAIL_PICK))},e.prototype.onBtnReply=function(){this._mail&&(this._mail.isTypeBit(Mail.MAIL_TYPE_PLAYER)?PanelManager.openMailWritePanel(MailScene.TYPE_WRITE_TO_PLAYER,this._mail.toPID,this._mail.getToName()):this._mail.isHasAttachItem()?this.onBtnGet():Mail.doDeleteMailMsg(this._mail))},e.prototype.onBtnRefuse=function(){this._mail.isHasReqMoney(null)||this._mail.isHasAttachItem()||this._mail.isHasSelectItem()?Mail.doBackmailMsg(this._mail):Mail.doDeleteMailMsg(this._mail)},e.prototype.onBtnReport=function(){Mail.doMailInformMsg(this._mail)},e.prototype.setData=function(t,e){this._type=t,this._mail=e},e.prototype.reset=function(){},e.prototype.update=function(){if(this.init&&this._mail){var t,e,n;if(this._mail.isTypeBit(Mail.MAIL_TYPE_SEND)?this.label_title.text=GameText.STR_MAIL_TYPE_SEND:this._mail.isTypeBit(Mail.MAIL_TYPE_BACK)?this.label_title.text=GameText.STR_MAIL_TYPE_BACK:this._mail.isTypeBit(Mail.MAIL_TYPE_RECEIPT)?this.label_title.text=GameText.STR_MAIL_TYPE_RECEIPT:this.label_title.text=GameText.STR_RECEIVE_EMAIL,this._mail.isTypeBit(Mail.MAIL_TYPE_PLAYER)?(this.btn_refuse.visible=!0,this.btn_get2.label="回复",this._mail.isHasReqMoney(null)||this._mail.isHasAttachItem()||this._mail.isHasSelectItem()?this.btn_refuse.label="拒收邮件":this.btn_refuse.label="删除"):(this.btn_refuse.visible=!1,this._mail.isHasAttachItem()?(this.btn_get2.label="提取附件",this.btn_get2.visible=!0):(this.btn_get2.visible=!0,this.btn_get2.label="删除")),this.label_name.text=this._mail.getToName(),this._mail.isTypeBit(Mail.MAIL_TYPE_PLAYER)?this.btn_report.visible=!0:this.btn_report.visible=!1,this._mail.isTypeBit(Mail.MAIL_TYPE_SEND)?this.label_fromType.text=GameText.STR_TYPE_MAIL_NAME+":":this.label_fromType.text=GameText.STR_TYPE_MAIL_SEND+":",this._mail.attachItem&&this._mail.attachItem.length>0)for(t=0;t<this._itemList.length;t++)e=this._itemList[t],n=this._mail.attachItem[t],e.setData(n);else for(t=0;t<this._itemList.length;t++)(e=this._itemList[t]).reset();var i=GameText.getMoneyResource(ModelConst.MONEY1),o="0";this._mail.money1>0?(i=GameText.getMoneyResource(ModelConst.MONEY1),o=this._mail.money1.toString()):this._mail.money2>0&&(i=GameText.getMoneyResource(ModelConst.MONEY2),o=this._mail.money2.toString()),this.img_moneyIcon1.source=i,this.label_money1.text=o,this.label_money3.text=this._mail.money3.toString(),i=GameText.getMoneyResource(ModelConst.MONEY1),o="0",this._mail.reqMoney1>0?(i=GameText.getMoneyResource(ModelConst.MONEY1),o=this._mail.reqMoney1.toString()):this._mail.reqMoney2>0&&(i=GameText.getMoneyResource(ModelConst.MONEY2),o=this._mail.reqMoney2.toString()),this.img_reqMoneyIcon1.source=i,this.label_reqMoney1.text=o,this.label_reqMoney3.text=this._mail.reqMoney3.toString(),this.label_desc.textFlow=Tool.convertDescToTextFlow(this._mail.getContent()),this.container.reset(),this.container.add(this.label_desc,7,7),this.container.update()}},e}(ComponentBase);__reflect(MailReadPanel.prototype,"MailReadPanel");var MailScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_writeToPlayer,this.onWriteToPlayer,this),ButtonUtils.addTouchEvent(this.btn_writeToGM,this.onWriteToGM,this),ButtonUtils.addTouchEvent(this.btn_readPlayer,this.onReadFromPlayer,this),ButtonUtils.addTouchEvent(this.btn_readTask,this.onReadFromTask,this),ButtonUtils.addTouchEvent(this.btn_readPay,this.onReadFromPay,this),ButtonUtils.addTouchEvent(this.btn_readGM,this.onReadFromGM,this),ButtonUtils.addTouchEvent(this.btn_readTrade,this.onReadFromTrade,this),ButtonUtils.addTouchEvent(this.btn_readReback,this.onReadFromReturn,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_writeToPlayer),ButtonUtils.removeTouchEvent(this.btn_writeToGM),ButtonUtils.removeTouchEvent(this.btn_readPlayer),ButtonUtils.removeTouchEvent(this.btn_readTask),ButtonUtils.removeTouchEvent(this.btn_readPay),ButtonUtils.removeTouchEvent(this.btn_readGM),ButtonUtils.removeTouchEvent(this.btn_readTrade),ButtonUtils.removeTouchEvent(this.btn_readReback)},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.onWriteToPlayer=function(){PanelManager.openMailWritePanel(e.TYPE_WRITE_TO_PLAYER)},e.prototype.onWriteToGM=function(){PanelManager.openMailWriteToGMPanel()},e.prototype.onReadFromPlayer=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_PLAYER)},e.prototype.onReadFromTask=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_TASK)},e.prototype.onReadFromPay=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_PAY)},e.prototype.onReadFromGM=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_GM)},e.prototype.onReadFromTrade=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_TRADE)},e.prototype.onReadFromReturn=function(){PanelManager.openMailListPanel(e.TYPE_READ_FROM_RETURN)},e.prototype.update=function(){if(this.init){this.label_tradeMailCount.text="";var t=-190*xhdRatio,e=-10*xhdRatio,n=Mail.newMailNum;n?(n[0]>0?(this.label_playerMailCount.text="("+n[0]+")",RedPoint.addRedPoint(this.label_playerMailCount,t,e)):(this.label_playerMailCount.text="",RedPoint.removeRedPoint(this.label_playerMailCount)),n[1]>0?(this.label_taskMailCount.text="("+n[1]+")",RedPoint.addRedPoint(this.label_taskMailCount,t,e)):(this.label_taskMailCount.text="",RedPoint.removeRedPoint(this.label_taskMailCount)),n[2]>0?(this.label_payMailCount.text="("+n[2]+")",RedPoint.addRedPoint(this.label_payMailCount,t,e)):(this.label_payMailCount.text="",RedPoint.removeRedPoint(this.label_payMailCount)),n[3]>0?(this.label_gmMailCount.text="("+n[3]+")",RedPoint.addRedPoint(this.label_gmMailCount,t,e)):(this.label_gmMailCount.text="",RedPoint.removeRedPoint(this.label_gmMailCount)),n[4]>0?(this.label_rebackMailCount.text="("+n[4]+")",RedPoint.addRedPoint(this.label_rebackMailCount,t,e)):(this.label_rebackMailCount.text="",RedPoint.removeRedPoint(this.label_rebackMailCount))):(this.label_playerMailCount.text="",this.label_taskMailCount.text="",this.label_payMailCount.text="",this.label_gmMailCount.text="",this.label_rebackMailCount.text="",RedPoint.removeRedPoint(this.label_playerMailCount),RedPoint.removeRedPoint(this.label_taskMailCount),RedPoint.removeRedPoint(this.label_payMailCount),RedPoint.removeRedPoint(this.label_gmMailCount),RedPoint.removeRedPoint(this.label_rebackMailCount))}},e.TYPE_WRITE_TO_PLAYER=1,e.TYPE_WRITE_TO_GM=2,e.TYPE_READ_FROM_PLAYER=3,e.TYPE_READ_FROM_TASK=4,e.TYPE_READ_FROM_PAY=5,e.TYPE_READ_FROM_GM=6,e.TYPE_READ_FROM_TRADE=7,e.TYPE_READ_FROM_RETURN=8,e}(ScenePanelBase);__reflect(MailScene.prototype,"MailScene");var MailSelectItemPanel=function(t){function e(){var e=t.call(this)||this;return e._selectSlotList=null,e._callbackFunc=null,e._thisObj=null,e._isCheckCount=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bagView.setAction(GameText.STR_INSERT,this.onInsert,this.onItemSelect,this),this.bagView.setData(xself,this._selectSlotList),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.group_count.visible=!1,this.input_count.restrict="0-9",ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),ButtonUtils.addTouchEvent(this.btn_cancel,this.onBtnCancel,this),this.label_desc.text="",this.container.reset(),this.container.add(this.label_desc,12,12),this.container.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_cancel),this._callbackFunc=null,this._thisObj=null},e.prototype.onClose=function(){this.bagView.clearSelected(),PanelManager.closeScene()},e.prototype.onInsert=function(){this._curSelectItem=null;var t=this.bagView.selectItem;if(t&&t.itemData){if(t.isMask)return void AlertPanel.alertCommon("该物品已被选择过了");t.itemData.isCanEquip()?(this.onCallback(t.itemData),this.onClose()):t.itemData.quantity>1&&this._isCheckCount?(this.group_count.visible=!0,this.input_count.text=t.itemData.quantity.toString(),this._curSelectItem=t.itemData):(this.onCallback(t.itemData),this.onClose())}},e.prototype.onCallback=function(t){null!=this._callbackFunc&&null!=this._thisObj&&this._callbackFunc.call(this._thisObj,t)},e.prototype.onItemSelect=function(){var t=this.bagView.selectItem;t&&t.itemData&&(this.label_desc.textFlow=Tool.convertDescToTextFlow(t.itemData.getDesc(xself,!0)),this.container.reset(!0),this.container.add(this.label_desc,6*xhdRatio,6*xhdRatio),this.container.update())},e.prototype.onBtnCancel=function(){this.group_count.visible=!1},e.prototype.onBtnOk=function(){if(this._curSelectItem){var t=Number(this.input_count.text);if(0==t)return void AlertPanel.alertCommon("请输入数量");if(t>this._curSelectItem.quantity)return void AlertPanel.alertCommon("数量超过物品数量上限");var e=new ItemData;this._curSelectItem.setItemDataTo(e),e.quantity=t,e.slotPos=this._curSelectItem.slotPos,this.onCallback(e),this.onClose()}},e.prototype.setCallback=function(t,e,n,i){void 0===i&&(i=!1),this._selectSlotList=t,this._callbackFunc=e,this._thisObj=n,this._isCheckCount=i},e.prototype.update=function(){this.init&&(this.bagView.update(),this.container.reset(),this.container.add(this.label_desc,12,12),this.container.update())},e}(ComponentBase);__reflect(MailSelectItemPanel.prototype,"MailSelectItemPanel");var MailWritePanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._id=0,e._toName=null,e._sendType=0,e._isClear=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_name.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelNameTouch,this),ButtonUtils.addTouchEvent(this.btn_friend,this.onBtnFriend,this),ButtonUtils.addTouchEvent(this.btn_delect,this.onBtnDelect,this),ButtonUtils.addTouchEvent(this.btn_send,this.onBtnSend,this),ButtonUtils.addTouchEvent(this.inputNameView.btn_ok,this.onBtnInputNameOk,this),ButtonUtils.addTouchEvent(this.inputNameView.btn_cancel,this.onBtnInputNameCancel,this),this.input_money1.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_money3.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_money1.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_money3.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_reqMoney1.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_reqMoney3.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_reqMoney1.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_reqMoney3.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.inputNameView.visible=!1,this.input_desc.multiline=!0,this.item0.isWrite=!0,this.item1.isWrite=!0,this.item2.isWrite=!0,this.item0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch0,this),this.item1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch1,this),this.item2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch2,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.label_name.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelNameTouch,this),ButtonUtils.removeTouchEvent(this.btn_friend),ButtonUtils.removeTouchEvent(this.btn_delect),ButtonUtils.removeTouchEvent(this.btn_send),ButtonUtils.removeTouchEvent(this.inputNameView.btn_ok),ButtonUtils.removeTouchEvent(this.inputNameView.btn_cancel),this.input_money1.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_money3.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_money1.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_money3.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_reqMoney1.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_reqMoney3.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputMoneyFocusIn,this),this.input_reqMoney1.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.input_reqMoney3.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputMoneyFocusOut,this),this.item0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch0,this),this.item1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch1,this),this.item2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch2,this)},e.prototype.closePanel=function(){xevent.removeEventListener(WorldEvent.RETURN_FRIEND_ID,this.returnFriendID,this),PanelManager.closeScene()},e.prototype.onBtnFriend=function(){xevent.addEventListener(WorldEvent.RETURN_FRIEND_ID,this.returnFriendID,this),PanelManager.openSocietyScene(SocietyScene.OPEN_FROM_MAIL)},e.prototype.onInputMoneyFocusIn=function(t){var e=t.target;e&&(0==Number(e.text)&&(e.text=""))},e.prototype.onInputMoneyFocusOut=function(t){var e=t.target;e&&(0==Number(e.text)&&(e.text="0"))},e.prototype.returnFriendID=function(t){xevent.removeEventListener(WorldEvent.RETURN_FRIEND_ID,this.returnFriendID,this),this._sendType=ProtocolDefine.MAIL_SEND_ID,this._id=t.param,this.label_name.text=this._id+""},e.prototype.onLabelNameTouch=function(){this.inputNameView.visible=!0,this.inputNameView.selectIndex=0,this.inputNameView.update()},e.prototype.onBtnDelect=function(){this.label_name.text="",this._sendType=0,this._id=0,this._toName=null},e.prototype.onItemTouch0=function(t){t.target==this.item0.btn_del?this.item0.setData(null):(this._selectMailItem=this.item0,PanelManager.openMailSelectItemPanel(this.getSelectedSlotList(),this.intertItem,this,!0))},e.prototype.onItemTouch1=function(t){t.target==this.item1.btn_del?this.item1.setData(null):(this._selectMailItem=this.item1,PanelManager.openMailSelectItemPanel(this.getSelectedSlotList(),this.intertItem,this,!0))},e.prototype.onItemTouch2=function(t){t.target==this.item2.btn_del?this.item2.setData(null):(this._selectMailItem=this.item2,PanelManager.openMailSelectItemPanel(this.getSelectedSlotList(),this.intertItem,this,!0))},e.prototype.intertItem=function(t){this._selectMailItem&&this._selectMailItem.setData(t)},e.prototype.getSelectedSlotList=function(){var t=[];return null!=this.item0.itemData&&t.push(this.item0.itemData.slotPos),null!=this.item1.itemData&&t.push(this.item1.itemData.slotPos),null!=this.item2.itemData&&t.push(this.item2.itemData.slotPos),t},e.prototype.onBtnSend=function(){if(0!=this._sendType){var t=new Mail;t.sendType=this._sendType,t.money1=Number(this.input_money1.text),t.money2=0,t.money3=Number(this.input_money3.text),t.reqMoney1=Number(this.input_reqMoney1.text),t.reqMoney2=0,t.reqMoney3=Number(this.input_reqMoney3.text),t.attachItem=new Array,t.attachItem.push(this.item0.itemData),t.attachItem.push(this.item1.itemData),t.attachItem.push(this.item2.itemData),t.toPID=this._id,t.setContent(this.input_desc.text),t.setToName(this.label_name.text),Mail.doMailSendMsg(t,this._sendType)}else AlertPanel.alertCommon("请输入收件人")},e.prototype.onBtnInputNameOk=function(){""!=this.inputNameView.input_name.text?(0==this.inputNameView.selectIndex?(this._sendType=ProtocolDefine.MAIL_SEND_NAME,this._id=0):1==this.inputNameView.selectIndex&&(this._sendType=ProtocolDefine.MAIL_SEND_ID,this._id=Number(this.inputNameView.input_name.text)),this.label_name.text=this.inputNameView.input_name.text,this.inputNameView.visible=!1):AlertPanel.alertCommon("收件人不能为空")},e.prototype.onBtnInputNameCancel=function(){this.inputNameView.visible=!1},e.prototype.setData=function(t,e,n){void 0===e&&(e=-1),void 0===n&&(n=null),this._type=t,this._id=e,this._toName=n,this._id>0&&(this._sendType=ProtocolDefine.MAIL_SEND_ID),this._isClear=!0},e.prototype.reset=function(){this.init&&(this.item0.setData(null),this.item1.setData(null),this.item2.setData(null),this.input_desc.text="",this.input_reqMoney1.text="0",this.input_reqMoney3.text="0",this.input_money1.text="0",this.input_money3.text="0",this.label_name.text="<请选择玩家>",this._selectMailItem=null)},e.prototype.update=function(){this.init&&(this._isClear&&(this.reset(),this._isClear=!1),this._toName&&this._toName.length>0?this.label_name.text=this._toName:this._id>0&&(this.label_name.text=this._id+""))},e}(ScenePanelBase);__reflect(MailWritePanel.prototype,"MailWritePanel");var MailWriteToGMPanel=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.input_content.text="",null==this._checkBtnList&&(this._checkBtnList=[this.checkbtn1,this.checkbtn2,this.checkbtn3,this.checkbtn4]),this.checkbtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnReturn,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),ButtonUtils.addTouchEvent(this.btn_return,this.onBtnReturn,this),this._selectIndex=0,this.updateBtnList()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.checkbtn1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),this.checkbtn4.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckBtnTouch,this),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_return)},e.prototype.onBtnOk=function(){var t=this.input_content.text;return Tool.isNullText(t)?void AlertPanel.alertCommon("内容不能为空"):void Mail.doMailSendGMMsg(this._selectIndex,t)},e.prototype.onBtnReturn=function(){PanelManager.closeScene()},e.prototype.onCheckBtnTouch=function(t){var e=t.target;if(e){var n=this._checkBtnList.indexOf(e);n>=0&&(this._selectIndex=n,this.updateBtnList())}},e.prototype.updateBtnList=function(){for(var t=0;t<this._checkBtnList.length;t++)t==this._selectIndex?this._checkBtnList[t].select=!0:this._checkBtnList[t].select=!1},e}(ComponentBase);__reflect(MailWriteToGMPanel.prototype,"MailWriteToGMPanel");var ChatButton=function(t){function e(){var e=t.call(this)||this;return e._hasNewMessage=!1,e.counter=1,e.oriUpdateTime=100,e.curUpdateTime=100,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bubble.visible=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"hasNewMessage",{set:function(t){this._hasNewMessage!=t&&(this._hasNewMessage=t,t?this.activate():this.deactivate())},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this.bubble.visible=!0,this.chat.visible=!1,this.new_msg.visible=!0,nato.WorldTicker.instance.register(this.logic,this)},e.prototype.logic=function(t){this.curUpdateTime-=t,this.curUpdateTime>0||(this.curUpdateTime=this.oriUpdateTime,this.counter%12==1?this.setBubbleScale(.9):this.counter%12==2?this.setBubbleScale(.95):this.counter%12==3?this.setBubbleScale(1):this.counter%12==4?this.setBubbleScale(1.05):this.counter%12==5?this.setBubbleScale(1.1):this.counter%12==6?this.setBubbleScale(.95):this.counter%12>6&&this.setBubbleScale(1),this.counter+=1,this.counter>1e3&&(this.counter=1))},e.prototype.setBubbleScale=function(t){this.bubble.scaleX=t,this.bubble.scaleY=t},e.prototype.deactivate=function(){this.bubble.visible=!1,this.chat.visible=!0,this.new_msg.visible=!1,this.setBubbleScale(1),nato.WorldTicker.instance.unregister(this.logic,this)},e}(ComponentBase);__reflect(ChatButton.prototype,"ChatButton");var HeadInfoViewOld=function(t){function e(){var e=t.call(this)||this;return e._headIcon1=0,e.roleProgressBarWidth=0,e.petProgressBarWidth=0,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),this.roleProgressBarWidth=e.ROLE_PROGRESS_WIDTH*xhdRatio,this.petProgressBarWidth=e.PET_PROGRESS_WIDTH*xhdRatio,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.getPlayerIconHPMPRect=function(){if(null==this.playerIconHPMPRect){this.playerIconHPMPRect=new egret.Rectangle;var t=this.localToGlobal(this.role_hp.x,this.role_hp.y);this.localToGlobal(this.role_mp.x,this.role_mp.y),this.playerIconHPMPRect.x=t.x,this.playerIconHPMPRect.y=t.y,this.playerIconHPMPRect.width=this.roleProgressBarWidth,this.playerIconHPMPRect.height=this.role_mp.y+this.role_mp.height-this.role_hp.y}return this.playerIconHPMPRect},e.prototype.getPetIconHPMPRect=function(){if(null==xself.getPet())return null;if(null==this.petIconHPMPRect){this.petIconHPMPRect=new egret.Rectangle;var t=this.localToGlobal(this.pet_hp.x,this.pet_hp.y);this.localToGlobal(this.pet_mp.x,this.pet_mp.y),this.petIconHPMPRect.x=t.x,this.petIconHPMPRect.y=t.y,this.petIconHPMPRect.width=this.petProgressBarWidth,this.petIconHPMPRect.height=this.pet_mp.y+this.pet_mp.height-this.pet_hp.y}return this.petIconHPMPRect},e.prototype.onPlayerHeadTouch=function(){xworld.inBattle||GameWorld.doWorldTouristFiveLevel()},e.prototype.onPetHeadTouch=function(){xworld.inBattle||PanelManager.openPetDetailScene()},e.prototype.setData=function(t){this._player=t,this.update()},e.prototype.update=function(){this.init&&(this.updateHeadIcon(),this.updatePetHeadIcon(),this.updateRoleProgress(),this.updateRoleLevel(),this.updatePetProgress(),this.updatePetLevel())},e.prototype.updateHeadIcon=function(){if(this._player&&0!=this._player.getIcon1()&&(this._headIcon1!=this._player.getIcon1()&&(this.headSpr&&this.headSpr.parent&&this.headSpr.parent.removeChild(this.headSpr),this.headSpr=null),null==this.headSpr)){var t=this._player.getIcon1()>>Model.OFFSET_SEX&Model.LEN_SEX,e=t==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(e),this.headSpr.x=20*xhdRatio,this.headSpr.y=40*xhdRatio,this.headSpr.setScale(xhd?2.5:1.25),this.addChild(this.headSpr),this.headSpr.touchEnabled=!0,this.headSpr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlayerHeadTouch,this),this._headIcon1=this._player.getIcon1();var n=new ChangeSpriteInfo(this._headIcon1,0,0,t,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(n)}},e.prototype.updatePetHeadIcon=function(){if(this._player&&null!=this._player.getPet()){var t=this._player.getPet();null==this.petHeadSpr?(this.petHeadSpr=new ItemIcon,nato.attachSkin(this.petHeadSpr),this.petHeadSpr.x=76*xhdRatio,this.petHeadSpr.y=14*xhdRatio,this.petHeadSpr.scaleX=this.petHeadSpr.scaleY=.7,this.petHeadSpr.setData(25,t.grade),this.addChild(this.petHeadSpr),this.petHeadSpr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPetHeadTouch,this)):(this.petHeadSpr.grade!=t.grade&&this.petHeadSpr.setData(25,t.grade),null==this.petHeadSpr.parent&&this.addChild(this.petHeadSpr)),this.pet_hp.visible=!0,this.pet_mp.visible=!0,this.pet_exp.visible=!0,this.pet_level.visible=!0}else this.petHeadSpr&&this.petHeadSpr.parent&&this.petHeadSpr.parent.removeChild(this.petHeadSpr),this.pet_hp.visible=!1,this.pet_mp.visible=!1,this.pet_exp.visible=!1,this.pet_level.visible=!1},e.prototype.updateRoleProgress=function(){if(this._player){this.role_hp.width=this.roleProgressBarWidth*(this._player.get(ModelConst.HP)/this._player.get(ModelConst.HPMAX)),this.role_mp.width=this.roleProgressBarWidth*(this._player.get(ModelConst.MP)/this._player.get(ModelConst.MPMAX));var t=this._player.get(ModelConst.EXP),e=this._player.get(ModelConst.EXPMAX),n=0!=e?t/e:1;this.role_exp.width=this.roleProgressBarWidth*n}else this.role_hp.width=0,this.role_mp.width=0,this.role_exp.width=0},e.prototype.updateRoleLevel=function(){this._player&&(this.role_level.text=this._player.getLevel().toString())},e.prototype.updatePetProgress=function(){if(this._player&&this._player.getPet()){var t=this._player.getPet();this.pet_hp.width=this.petProgressBarWidth*(t.get(ModelConst.HP)/t.get(ModelConst.HPMAX)),this.pet_mp.width=this.petProgressBarWidth*(t.get(ModelConst.MP)/t.get(ModelConst.MPMAX)),this.pet_exp.width=this.petProgressBarWidth*(t.get(ModelConst.EXP)/t.get(ModelConst.EXPMAX))}},e.prototype.updatePetLevel=function(){if(this._player&&this._player.getPet()){var t=this._player.getPet();this.pet_level.text=t.getLevel().toString()}},e.ROLE_PROGRESS_WIDTH=32,e.PET_PROGRESS_WIDTH=30,e}(ComponentBase);__reflect(HeadInfoViewOld.prototype,"HeadInfoViewOld");var HeadInfoView=function(t){function e(){var e=t.call(this)||this;return e._headIcon1=0,e.roleProgressBarWidth=0,e.petProgressBarWidth=0,e}return __extends(e,t),e.prototype.onAddToStage=function(n){if(t.prototype.onAddToStage.call(this,n),this.roleProgressBarWidth=e.ROLE_PROGRESS_WIDTH*xhdRatio,this.petProgressBarWidth=e.PET_PROGRESS_WIDTH*xhdRatio,Tool.removeObjSafe(this.label_power_info),null==this.fireAnim){this.fireAnim=new MovieClip("fire",-1);var i=xhd?1.2:.6,o=xhd?1.4:.7;this.fireAnim.setScaleXY(i,o),this.fireAnim.load(),this.anim_ctn.addChild(this.fireAnim)}if(null==this.rechangeAnim){this.rechangeAnim=new MovieClip("rechange",-1);var a=xhd?1:.5,r=xhd?1:.5;this.rechangeAnim.setScaleXY(a,r),this.rechangeAnim.setRate(3),this.rechangeAnim.load(),this.group_rechange.addChild(this.rechangeAnim)}null==this._shapeRechange&&(this._shapeRechange=new egret.Shape,this._shapeRechange.touchEnabled=!0,this._shapeRechange.graphics.beginFill(16711680,0),this._shapeRechange.graphics.drawRect(0,0,this.group_rechange.width,this.group_rechange.height),this._shapeRechange.graphics.endFill(),this._shapeRechange.cacheAsBitmap=!0,this._shapeRechange.x=this.group_rechange.x,this._shapeRechange.y=this.group_rechange.y,this.addChild(this._shapeRechange)),null==this._shapeVip&&(this._shapeVip=new egret.Shape,this._shapeVip.touchEnabled=!0,this._shapeVip.graphics.beginFill(65280,0),this._shapeVip.graphics.drawRect(0,0,this.group_vip.width,this.group_vip.height),this._shapeVip.graphics.endFill(),this._shapeVip.cacheAsBitmap=!0,this._shapeVip.x=this.group_vip.x,this._shapeVip.y=this.group_vip.y,this.addChild(this._shapeVip)),this._shapeRechange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRechangeTouch,this),this._shapeVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onVipTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.clearWatch(),Main.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hidePowerInfo,this),this.power_area.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showPowerInfo,this),this._shapeRechange.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRechangeTouch,this),this._shapeVip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onVipTouch,this),Tool.removeObjSafe(this.power),Tool.removeObjSafe(this.roleLevel),Tool.removeObjSafe(this.petLevel),Tool.removeObjSafe(this.powerBG),Tool.removeObjSafe(this.vipLevel),this.power=null,this.roleLevel=null,this.petLevel=null,this.vipLevel=null},e.prototype.onRechangeTouch=function(t){xworld.inBattle||(xshowdemo?PayInfo.getTestPayInfo():PayInfo.getPayList())},e.prototype.onVipTouch=function(t){xworld.inBattle||PanelManager.openVIPScene()},e.prototype.clearWatch=function(){if(this.watcherArr){for(var t=0,e=this.watcherArr.length;e>t;t++)this.watcherArr[t].unwatch();this.watcherArr=null}},e.prototype.getPlayerIconHPMPRect=function(){if(null==this.playerIconHPMPRect){this.playerIconHPMPRect=new egret.Rectangle;var t=this.localToGlobal(this.role_hp.x,this.role_hp.y);this.localToGlobal(this.role_mp.x,this.role_mp.y),this.playerIconHPMPRect.x=t.x,this.playerIconHPMPRect.y=t.y,this.playerIconHPMPRect.width=this.roleProgressBarWidth,this.playerIconHPMPRect.height=this.role_mp.y+this.role_mp.height-this.role_hp.y}return this.playerIconHPMPRect},e.prototype.getPetIconHPMPRect=function(){if(null==xself.getPet())return null;if(null==this.petIconHPMPRect){this.petIconHPMPRect=new egret.Rectangle;var t=this.localToGlobal(this.pet_hp.x,this.pet_hp.y);this.localToGlobal(this.pet_mp.x,this.pet_mp.y),this.petIconHPMPRect.x=t.x,this.petIconHPMPRect.y=t.y,this.petIconHPMPRect.width=this.petProgressBarWidth,this.petIconHPMPRect.height=this.pet_mp.y+this.pet_mp.height-this.pet_hp.y}return this.petIconHPMPRect},e.prototype.onPlayerHeadTouch=function(){xworld.inBattle||GameWorld.doWorldTouristFiveLevel()},e.prototype.onPetHeadTouch=function(){xworld.inBattle||PanelManager.openPetDetailScene()},e.prototype.setData=function(t){this.clearWatch(),this._player=t,this._player.addWatcher(),this.createWatch("powerX"),this.watcherHander(),this.update()},e.prototype.watcherHander=function(){this.power||(this.power=ImageNum.create(2006,3011),this.power.numSpace=-4,this.power.numOffsetY=3,this.power.scaleX=this.power.scaleY=.5*xhdRatio,this.power_ctn.addChild(this.power)),this.power.num=this._player.powerX,this.power_area.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPowerInfo,this)},e.prototype.createWatch=function(t){this.watcherArr||(this.watcherArr=[]);var e=eui.Watcher.watch(this._player,[t],this.watcherHander,this);return this.watcherArr.push(e),e},e.prototype.showPowerInfo=function(t){PanelManager.openRoleScene(),this.power.num<1e5||(this.label_power_info.stage?this.hidePowerInfo():(this.label_power_info.text=GameText.STR_POWER+this.power.num,this.label_power_info.wordWrap=!1,this.label_power_info.width=this.label_power_info.textWidth+10,this.label_power_info.textColor=ColorUtils.COLOR_YELLOW,this.drawPowerBG(),this.addChild(this.powerBG),this.addChild(this.label_power_info),this.powerBG.x=this.label_power_info.x-15,this.powerBG.y=this.label_power_info.y-5,t.stopImmediatePropagation(),Main.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidePowerInfo,this)))},e.prototype.hidePowerInfo=function(){Tool.removeObjSafe(this.label_power_info),Tool.removeObjSafe(this.powerBG),Main.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hidePowerInfo,this)},e.prototype.drawPowerBG=function(){this.powerBG||(this.powerBG=new egret.Sprite),this.powerBG.graphics.clear(),this.powerBG.graphics.beginFill(0,.8),this.powerBG.graphics.lineStyle(2,16777215,1),this.powerBG.graphics.drawRoundRect(5,0,this.label_power_info.textWidth+20,this.label_power_info.textHeight+10,20,20),this.powerBG.graphics.endFill()},e.prototype.update=function(){this.init&&(this.updateHeadIcon(),this.updatePetHeadIcon(),this.updateRoleProgress(),this.updateRoleLevel(),this.updatePetProgress(),this.updatePetLevel(),this.updateVip())},e.prototype.updateHeadIcon=function(){if(this._player&&0!=this._player.getIcon1()&&(this._headIcon1!=this._player.getIcon1()&&(this.headSpr&&this.headSpr.parent&&this.headSpr.parent.removeChild(this.headSpr),this.headSpr=null),null==this.headSpr)){var t=this._player.getIcon1()>>Model.OFFSET_SEX&Model.LEN_SEX,e=t==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(e),this.headSpr.x=26*xhdRatio,this.headSpr.y=39*xhdRatio,this.headSpr.setScale(xhd?2.7:1.25),this.addChild(this.headSpr),this.headSpr.touchEnabled=!0,this.headSpr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlayerHeadTouch,this),this._headIcon1=this._player.getIcon1();var n=new ChangeSpriteInfo(this._headIcon1,0,0,t,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(n)}},e.prototype.updatePetHeadIcon=function(){if(this._player&&null!=this._player.getPet()){var t=this._player.getPet();null==this.petHeadSpr?(this.petHeadSpr=new ItemIcon,nato.attachSkin(this.petHeadSpr),this.petHeadSpr.x=98*xhdRatio,this.petHeadSpr.y=11*xhdRatio,this.petHeadSpr.scaleX=this.petHeadSpr.scaleY=.8,this.petHeadSpr.setData(25,t.grade),this.addChild(this.petHeadSpr),this.petHeadSpr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPetHeadTouch,this),this.petLevel||this.updatePetLevel()):(this.petHeadSpr.grade!=t.grade&&this.petHeadSpr.setData(25,t.grade),null==this.petHeadSpr.parent&&this.addChild(this.petHeadSpr)),this.pet_hp.visible=!0,this.pet_mp.visible=!0,this.pet_exp.visible=!0}else this.petHeadSpr&&this.petHeadSpr.parent&&this.petHeadSpr.parent.removeChild(this.petHeadSpr),this.pet_hp.visible=!1,this.pet_mp.visible=!1,this.pet_exp.visible=!1,Tool.removeObjSafe(this.petLevel),this.petLevel=null},e.prototype.updateRoleProgress=function(){var t=this._player;if(t){var e=xworld.inBattle?ModelConst.HP_DISPLAY:ModelConst.HP,n=t.get(e),i=t.get(ModelConst.HPMAX),o=t.get(ModelConst.MP),a=t.get(ModelConst.MPMAX),r=t.get(ModelConst.EXP),s=t.get(ModelConst.EXPMAX);this.role_hp.width=this.roleProgressBarWidth*(n/i),this.role_mp.width=this.roleProgressBarWidth*(o/a);var l=0!=s?r/s:1;this.role_exp.width=this.roleProgressBarWidth*l}else this.role_hp.width=0,this.role_mp.width=0,this.role_exp.width=0},e.prototype.updateRoleLevel=function(){this._player&&(this.roleLevel||(this.roleLevel=ImageNum.create(2007),this.roleLevel.numSpace=-4,this.roleLevel.y=41*xhdRatio,this.roleLevel.x=50*xhdRatio,this.roleLevel.scaleX=this.roleLevel.scaleY=.5*xhdRatio,this.cache_node.addChild(this.roleLevel)),this.roleLevel.num=this._player.getLevel())},e.prototype.updatePetProgress=function(){if(this._player&&this._player.getPet()){var t=this._player.getPet();this.pet_hp.width=this.petProgressBarWidth*(t.get(ModelConst.HP)/t.get(ModelConst.HPMAX)),this.pet_mp.width=this.petProgressBarWidth*(t.get(ModelConst.MP)/t.get(ModelConst.MPMAX)),this.pet_exp.width=this.petProgressBarWidth*(t.get(ModelConst.EXP)/t.get(ModelConst.EXPMAX))}},e.prototype.updatePetLevel=function(){if(this._player&&this._player.getPet()){var t=this._player.getPet();this.petLevel||(this.petLevel=ImageNum.create(2007),this.petLevel.numSpace=-4,this.petLevel.y=41*xhdRatio,this.petLevel.x=130*xhdRatio,this.petLevel.scaleX=this.petLevel.scaleY=.5*xhdRatio,this.cache_node.addChild(this.petLevel)),this.petLevel.num=t.getLevel()}},e.prototype.updateVip=function(){var t=0;xself&&(t=xself.getVipLevel()),null==this.vipLevel&&(this.vipLevel=ImageNum.create(2008),this.vipLevel.x=42*xhdRatio,this.vipLevel.y=8*xhdRatio,this.vipLevel.scaleX=this.vipLevel.scaleY=.55*xhdRatio,this.group_vip.addChild(this.vipLevel)),this.vipLevel.num=t},e.ROLE_PROGRESS_WIDTH=42,e.PET_PROGRESS_WIDTH=40,e}(ComponentBase);__reflect(HeadInfoView.prototype,"HeadInfoView");var IconEff1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setRotation=function(t){this.eff.rotation=t},e}(ComponentBase);__reflect(IconEff1.prototype,"IconEff1");var IconEff2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setRotation=function(t){this.eff.rotation=t},e}(ComponentBase);__reflect(IconEff2.prototype,"IconEff2");var LoginLotteryDraw=function(){function t(){this.vipCount=0,this.allCount=0,this.count=0,this.isItem=!1,this.type=0,this.value=0}return t.doPushIsOpen=function(e){t.leftCount=e.getInt(),t.isOpen=e.getBoolean(),t.isNeedCheck=!0,t.isHasOpen=!1},t.LoginAlert=function(){var e=xself;return null!=e&&(t.isOpen&&t.leftCount>0&&t.isNeedCheck&&0==t.isHasOpen&&e.getLevel()>=t.LOGIN_LOTTERYDRAY_NEED_LEVEL)},t.closeGameNotice=function(){var e=xself;return null!=e&&(t.isOpen&&t.leftCount>0&&0==t.isHasOpen&&e.getLevel()>=t.LOGIN_LOTTERYDRAY_NEED_LEVEL)},t.showInWorld=function(){var e=xself;return null!=e&&(t.isOpen&&t.leftCount>0&&e.getLevel()>=t.LOGIN_LOTTERYDRAY_NEED_LEVEL)},t.showInMenu=function(){var e=xself;return null!=e&&(t.isOpen&&e.getLevel()>=t.LOGIN_LOTTERYDRAY_NEED_LEVEL)},t.doEnter=function(){var e=xself;if(null!=e)if(null==GameWorld.loginLotteryDraw){var n=new nato.Message(ProtocolDefine.CG_ACTOR_LOTTERY_DRAW_LIST_NEW);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=new t;i.desc=n.getString(),i.vipdesc=n.getString(),i.vipCount=n.getByte(),i.allCount=n.getInt(),i.count=n.getInt(),i.drawDescMsg1=n.getString(),i.drawTimeMsg1=n.getString(),i.drawDescMsg2=n.getString(),i.drawTimeMsg2=n.getString(),i.drawDescMsg3=n.getString(),i.drawTimeMsg3=n.getString(),i.vLoginLotteryDraw=[];for(var o=n.getByte(),a=0;o>a;a++){var r;if(n.getBoolean()){if(n.getBoolean())(r=new t).isItem=!0,r.item=new ItemData,ItemData.fromBytesAtts2(r.item,n),r.item.quantity=n.getShort(),r.item.durability=r.item.durMax,i.vLoginLotteryDraw.push(r)}else(r=new t).isItem=!1,r.type=n.getInt(),r.value=n.getInt(),r.desc2=n.getString(),i.vLoginLotteryDraw.push(r)}if(GameWorld.loginLotteryDraw=i,n.getByte()>0){t.isEnterHasReWard=!0;var s="";1==n.getBoolean()?s=GameText2.STR_LOGIN_LOTTERYDRAW_REWARD+MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_USE_REWARD):(e.money1=n.getInt(),e.money2=n.getInt(),e.money3=n.getInt(),e.exp=n.getInt(),s=n.getString()),t.reWardDesc=s}else t.isEnterHasReWard=!1;var l=i.desc.split(" ");if(l&&l.length>0)for(a=0;a<l.length;a++){var _=l[a];Number(_)>0&&(_="/cCCFF33"+_+"/p",l[a]=_)}if(i.desc=l.join(""),PanelManager.isPanelShow(RewardScene))PanelManager.getPanel(RewardScene).updateTab()}}),this),PanelManager.openWaitForServer()}else if(PanelManager.isPanelShow(RewardScene)){var i=PanelManager.getPanel(i);i.updateTab()}},t.doPlay=function(){var e=xself;if(null!=e&&null!=GameWorld.loginLotteryDraw){var n=new nato.Message(ProtocolDefine.CG_ACTOR_LOTTERY_DRAW_START_NEW);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0>n.getByte())AlertPanel.alertCommon(n.getString());else{var i=n.getInt(),o="";if(1==n.getBoolean()?(o=GameText2.STR_LOGIN_LOTTERYDRAW_REWARD+"\n"+MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_USE_REWARD),t.tempCount=n.getInt(),t.tempAllCount=n.getInt(),t.leftCount=t.tempCount):(e.money1=n.getInt(),e.money2=n.getInt(),e.money3=n.getInt(),e.exp=n.getInt(),t.tempCount=n.getInt(),t.tempAllCount=n.getInt(),o=n.getString(),t.leftCount=t.tempCount),t.reWardDesc=o,PanelManager.isPanelShow(RewardScene))PanelManager.getPanel(RewardScene).doLoginLotteryPlay(i)}}),this),PanelManager.openWaitForServer()}},t.clean=function(){t.tempAllCount=0,t.tempCount=0,t.leftCount=0,t.isOpen=!1,t.isHasOpen=!1,t.isNeedCheck=!1},t.reWardDesc="",t.isEnterHasReWard=!1,t.tempAllCount=0,t.tempCount=0,t.leftCount=0,t.isOpen=!1,t.isHasOpen=!1,t.isNeedCheck=!1,t.LOGIN_LOTTERYDRAY_NEED_LEVEL=1,t}();__reflect(LoginLotteryDraw.prototype,"LoginLotteryDraw");var LoginLotteryItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e.cacheAsBitmap=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.img_mask.parent&&this.img_mask.parent.removeChild(this.img_mask),this.img_newSign.parent&&this.img_newSign.parent.removeChild(this.img_newSign),this.img_strongerSign.parent&&this.img_strongerSign.parent.removeChild(this.img_strongerSign),this.img_equiped.parent&&this.img_equiped.parent.removeChild(this.img_equiped),this.img_lock.parent&&this.img_lock.parent.removeChild(this.img_lock),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.select=!1},Object.defineProperty(e.prototype,"loginLotteryDraw",{get:function(){return this._loginLotteryDraw},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._loginLotteryDraw=t,this.update()},e.prototype.reset=function(){this._loginLotteryDraw=null,this.resetView()},e.prototype.resetView=function(){this.init&&(this.itemColorBg_img.source="",this.icon_img.source="",this.count_label.text="",this.select=!1)},e.prototype.update=function(){return this.init?this._loginLotteryDraw?void(this._loginLotteryDraw.isItem?null!=this._loginLotteryDraw.item&&(this.itemColorBg_img.source=xitem.getItemColorTexture(this._loginLotteryDraw.item.grade),this.icon_img.source=xitem.getItemIcon(this._loginLotteryDraw.item.bagIcon),this.count_label.text=this._loginLotteryDraw.item.quantity.toString()):(this.itemColorBg_img.source=null,this.count_label.text="",this.icon_img.source="loginlottery_"+(this._loginLotteryDraw.type-1))):void this.resetView():void 0},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.bg&&(this.bg.source=this._select?"item_select"+(xhd?"_hd":"_sd"):"item_bg"+(xhd?"_hd":"_sd"))},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(LoginLotteryItem.prototype,"LoginLotteryItem");var LoginLotteryPanel=function(t){function e(){var e=t.call(this)||this;return e._curSelectIndex=0,e._isRuning=!1,e._targetIndex=0,e._curIndex=0,e._speed=1,e._count=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._itemList){this._itemList=[];for(var n=0;16>n;n++){var i=this["item"+n];this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLoginLotteryItemTouch,this)}this.btn_action.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAction,this),null!=GameWorld.loginLotteryDraw?this.update():LoginLotteryDraw.doEnter()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLoginLotteryItemTouch,this)}this.btn_action.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAction,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnClose=function(t){this._isRuning},e.prototype.onBtnAction=function(){if(!this._isRuning){ButtonUtils.buttonTweenEffect(this.btn_action,(function(){LoginLotteryDraw.doPlay()}),this)}},e.prototype.onLoginLotteryItemTouch=function(t){if(!this._isRuning){var e=t.target;if(e&&e.loginLotteryDraw)if(this.onSelectItem(e),e.loginLotteryDraw.isItem){var n="";e.loginLotteryDraw.item&&(n=PowerString.makeColorString(e.loginLotteryDraw.item.name,Define.getGradeColor(e.loginLotteryDraw.item.grade))+"\n"+e.loginLotteryDraw.item.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}else AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.loginLotteryDraw.desc2)}},e.prototype.onSelectItem=function(t){if(null!=t){var e=this._itemList.indexOf(t);-1!=e&&this.onSelectIndex(e)}},e.prototype.onSelectIndex=function(t){var e=this._itemList[t];e&&(this._curSelectItem=e,this._curSelectIndex=t,this.img_select.x=this._curSelectItem.x-2,this.img_select.y=this._curSelectItem.y-2)},e.prototype.update=function(){if(this.init){var t=GameWorld.loginLotteryDraw;if(null!=t){LoginLotteryDraw.isEnterHasReWard&&(AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),LoginLotteryDraw.reWardDesc),LoginLotteryDraw.isEnterHasReWard=!1),this.label_loginDay.textFlow=Tool.convertDescToTextFlow(t.desc);var e="VIP"+xself.getVipLevel()+"增加次数：/c33ff00+"+t.vipCount+"/p";this.label_vip.textFlow=Tool.convertDescToTextFlow(e),this.updateCount();var n="连续登录："+t.drawDescMsg1+"    "+t.drawDescMsg2+"    "+t.drawDescMsg3,i="抽奖次数："+t.drawTimeMsg1+"       "+t.drawTimeMsg2+"       "+t.drawTimeMsg3;this.label_desc1.text=n,this.label_desc2.text=i;for(var o=0;o<this._itemList.length;o++){var a=t.vLoginLotteryDraw[o];this._itemList[o].setData(a)}this.onSelectIndex(0)}}},e.prototype.updateCount=function(){var t=GameWorld.loginLotteryDraw;this.label_times.text=t.count+"/"+t.allCount},e.prototype.doPlay=function(t){var n=0;0!=this._curSelectIndex&&(n=e.MAXINDEX-this._curSelectIndex),this._targetIndex=e.CIRCLE+t+n,this._curIndex=0,this._count=0,this._isRuning=!0,nato.WorldTicker.instance.register(this.logic,this)},e.prototype.logic=function(t){this._isRuning&&(this._count++,this._count>this._speed&&(this._count=0,this._curIndex++,this._curSelectIndex++,this._curSelectIndex>=e.MAXINDEX&&(this._curSelectIndex=0),this.onSelectIndex(this._curSelectIndex),this._curIndex==this._targetIndex&&this.endPlay()))},e.prototype.endPlay=function(){this._isRuning=!1,null!=LoginLotteryDraw.reWardDesc&&(AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(LoginLotteryDraw.reWardDesc)),LoginLotteryDraw.reWardDesc=null),GameWorld.loginLotteryDraw.allCount=LoginLotteryDraw.tempAllCount,GameWorld.loginLotteryDraw.count=LoginLotteryDraw.tempCount,this.updateCount(),this.dispatchEventWith(e.Event_finish),nato.WorldTicker.instance.unregister(this.logic,this)},e.Event_finish="finish",e.MAXINDEX=16,e.CIRCLE=3*e.MAXINDEX,e}(ComponentBase);__reflect(LoginLotteryPanel.prototype,"LoginLotteryPanel");var MainMenuScene=function(t){function e(){var e=t.call(this)||this;return e._isOpenActivityNotice=!1,e._isHideActivityNotice=!1,e._isTweenActivityNotice=!1,e._activityStartTime=0,e._isInit=!1,e._isLight=!1,e._btnWidth=0,e._lightAlpha=0,e._isHideTopMenu=!1,e._isTween=!1,e._isHideMenu=!1,e._isHelpInit=!1,e._logicTime=0,e._logicTop=0,e._logicSpriteTalk=0,e._logicActivitiNotice=0,e.isForceHideGuideSprite=!1,e._btnWidth=xhd?80:45,e}return __extends(e,t),e.prototype.onCreate=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this)},e.prototype.onAddToStage=function(t){if(ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_shop,this.btn_shop_select,this.onBtnShop,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_task,this.btn_task_select,this.onBtnTask,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_drug,this.btn_drug_select,this.onBtnDrug,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_map,this.btn_map_select,this.onBtnMap,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_social,this.btn_social_select,this.onBtnSocial,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_around,this.btn_around_select,this.onBtnAround,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_tower,this.btn_tower_select,this.onBtnTower,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_role,this.btn_role_select,this.onBtnRole,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_pet,this.btn_pet_select,this.onBtnPet,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_item,this.btn_item_select,this.onBtnItem,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_forge,this.btn_forge_select,this.onBtnForge,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_system,this.btn_system_select,this.onBtnSystem,this),ButtonUtils.addMenuBtnTouchEvent(this.btn_hideMenu,this.btn_hideMenu_select,this.onBtnHideMenu,this),ButtonUtils.addTouchEvent(this.btn_showMenu,this.onBtnShowMenu,this),this.btn_topMenu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTopMenu,this),this.g_mail.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMail,this),this.g_onlineReward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOnlineReward,this),this.g_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReward,this),this.g_exchangeMoney.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchangeMoney,this),this.g_fiveDay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnFiveDay,this),this.g_springDay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSpringDay,this),this.g_offLineExp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOffLineExp,this),this.g_activityList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnActivityList,this),this.g_redPaper.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRedPaper,this),this.g_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRank,this),this.g_save.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSave,this),this.g_trade.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTrade,this),this.g_welfare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnWelfare,this),this.g_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnInvite,this),this.g_strengthen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnStrengthen,this),this.group_strengthen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnStrengthenTask,this),this.g_onekeyDailyMission.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOnekeyDailyMission,this),this.group_activityNotice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupActivityNoticeTouch,this),(xchannel==Define.CHANNEL_SINA||xchannel==Define.CHANNEL_1758||xchannel==Define.CHANNEL_WANBA)&&this.g_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShare,this),xchannel==Define.CHANNEL_1758&&this.g_follow.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnFollow,this),ButtonUtils.addTouchEvent(this.micro_btn,this.onMicro,this),ButtonUtils.addTouchEvent(this.img_zudui,this.onTeam,this),ButtonUtils.addTouchEvent(this.help_btn,this.onBtnHelp,this),ButtonUtils.addTouchEvent(this.autogame_btn,this.onAutoGame,this),ButtonUtils.addTouchEvent(this.autogame_cancel_btn,this.onAutoGame,this),ButtonUtils.addTouchEvent(this.btn_repair,this.onBtnRepair,this),ButtonUtils.addTouchEvent(this.firstCharge_btn,this.onBtnFirstCharge,this),ButtonUtils.addTouchEvent(this.dailyCharge_btn,this.onBtnDailyCharge,this),ButtonUtils.addTouchEvent(this.quickPower_btn,this.onBtnQuickPower,this),this._isHelpInit=!1,this._isInit||(this._isInit=!0,this.group_menubg.visible=!0,this.group_menu.visible=!0,this.btn_showMenu.visible=!1,this.micro_btn.visible=!1,this.group_topMenu.visible=!0,this.img_topMenuBg.visible=!0,this._isHideTopMenu=!1,this._isHideTopMenu=!1,this._isTween=!1,this.checkTaskTarget(),this.see_sell_btn.label=GameText.getText(GameText.TI_SEE_PLAYER_SHOP),this.sell_record_btn.label=GameText.getText(GameText.TI_PLAYER_SHOP_RECORD),this.sell_end_btn.label=GameText.getText(GameText.TI_SHOP_END),this.group_spriteTalk.parent&&this.group_spriteTalk.parent.removeChild(this.group_spriteTalk),this.group_spriteTalk.visible=!0),!this.g_welfare.getChildByName("welfareMov")){var e=new MovieClip("fuli",-1);e.x=-12,e.y=-7,e.name="welfareMov",this.g_welfare.addChild(e),e.load()}this.headInfoView.setData(xself),xself.isShopMode()?this.addSellBtns():this.removeSellBtns(),xchannel==Define.CHANNEL_WANBA?(this.updateStrengthen(),this.updateQuickPower(),this.updateDailyCharge()):(this.g_strengthen.visible=!1,this.group_strengthen.visible=!1,this.quickPower_btn.visible=!1,this.quickPower_btn.includeInLayout=!1,this.dailyCharge_btn.visible=!1,this.dailyCharge_btn.includeInLayout=!1),this.updateActivityNotice(),this.updateWorldIconPoint(),nato.WorldTicker.instance.register(this.logic,this),xworld.isEquipChangePanelShow&&(PanelManager.mainMenu.equipChangePanel.visible=!0),PlayerDataManager.getPlayerData((function(){0==PlayerDataManager.playerData.isSpriteOpen&&this.setGuideSpriteShow(!1)}),this),this.img_zudui.visible=GameWorld.isBlinkzd},e.prototype.onRemoveFromStage=function(t){ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_shop),ButtonUtils.removeMenuBtnTouchEvent(this.btn_task),ButtonUtils.removeMenuBtnTouchEvent(this.btn_drug),ButtonUtils.removeMenuBtnTouchEvent(this.btn_map),ButtonUtils.removeMenuBtnTouchEvent(this.btn_social),ButtonUtils.removeMenuBtnTouchEvent(this.btn_around),ButtonUtils.removeMenuBtnTouchEvent(this.btn_tower),ButtonUtils.removeMenuBtnTouchEvent(this.btn_role),ButtonUtils.removeMenuBtnTouchEvent(this.btn_pet),ButtonUtils.removeMenuBtnTouchEvent(this.btn_item),ButtonUtils.removeMenuBtnTouchEvent(this.btn_forge),ButtonUtils.removeMenuBtnTouchEvent(this.btn_system),ButtonUtils.removeTouchEvent(this.btn_hideMenu),ButtonUtils.removeTouchEvent(this.btn_showMenu),this.btn_topMenu.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTopMenu,this),this.g_mail.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMail,this),this.g_onlineReward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOnlineReward,this),this.g_reward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReward,this),this.g_exchangeMoney.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExchangeMoney,this),this.g_fiveDay.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnFiveDay,this),this.g_springDay.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSpringDay,this),this.g_offLineExp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOffLineExp,this),this.g_activityList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnActivityList,this),this.g_redPaper.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRedPaper,this),this.g_rank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRank,this),this.g_share.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShare,this),this.g_save.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSave,this),this.g_trade.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTrade,this),this.g_welfare.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnWelfare,this),this.g_invite.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnInvite,this),this.g_strengthen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnStrengthen,this),this.group_strengthen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnStrengthenTask,this),this.g_onekeyDailyMission.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnOnekeyDailyMission,this),this.group_activityNotice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupActivityNoticeTouch,this),ButtonUtils.removeTouchEvent(this.micro_btn),ButtonUtils.removeTouchEvent(this.img_zudui),ButtonUtils.removeTouchEvent(this.help_btn),ButtonUtils.removeTouchEvent(this.autogame_btn),ButtonUtils.removeTouchEvent(this.autogame_cancel_btn),ButtonUtils.removeTouchEvent(this.btn_repair),ButtonUtils.removeTouchEvent(this.firstCharge_btn),ButtonUtils.removeTouchEvent(this.dailyCharge_btn),ButtonUtils.removeTouchEvent(this.quickPower_btn),this.removeSellBtns(),egret.Tween.removeTweens(this.group_spriteTalk),this.group_spriteTalk.parent&&this.group_spriteTalk.parent.removeChild(this.group_spriteTalk),nato.WorldTicker.instance.unregister(this.logic,this)},Object.defineProperty(e.prototype,"isHideMenu",{get:function(){return this._isHideMenu},enumerable:!0,configurable:!0}),e.prototype.onBtnHideMenu=function(){this._isHideMenu||(this._isHideMenu=!0,this._isTween=!0,this.group_menubg.visible=!1,this.btn_showMenu.visible=!0,egret.Tween.get(this.group_menu).to({scaleX:0,scaleY:0},100).call(this.gotoMenuHideStatus,this).call((function(){egret.callLater(this.updateMenu,this)}),this)),GuideHandler.setGuideWidgetVisible(!1)},e.prototype.onBtnShowMenu=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this._isHideMenu&&(this._isHideMenu=!1,this._isTween=!0,this.group_menu.visible=!0,egret.Tween.get(this.group_menu).to({scaleX:1,scaleY:1},100).call(this.gotoMenuShowStatus,this).call((function(){egret.callLater(this.updateMenu,this)}),this).call((function(){egret.callLater(t,e)}),this)),GuideHandler.setGuideWidgetVisible(!0)},e.prototype.gotoMenuHideStatus=function(){this._isTween=!1,this.group_menu.visible=!1,this.group_menubg.visible=!1,this.btn_showMenu.visible=!0},e.prototype.gotoMenuShowStatus=function(){this._isTween=!1,this.group_menu.visible=!0,this.group_menubg.visible=!0,this.btn_showMenu.visible=!1},e.prototype.onBtnOnlineReward=function(t){t.stopImmediatePropagation(),PanelManager.openOnlineRewardPanel()},e.prototype.onBtnReward=function(){PanelManager.openRewardPanel()},e.prototype.onBtnExchangeMoney=function(){PanelManager.openExchangeMoneyPanel()},e.prototype.onBtnTopMenu=function(t){this._isHideTopMenu?this.tweenTopMenuShow():this.tweenTopMenuHide()},e.prototype.tweenTopMenuHide=function(){this._isTween=!0,egret.Tween.get(this.group_topMenu).to({x:-this.img_topMenuBg.width},150).call(this.gotoTopMenuHideStatus,this).call(this.updateTopMenu,this)},e.prototype.gotoTopMenuHideStatus=function(){this.group_topMenu.x=-this.img_topMenuBg.width,this.btn_topMenu_hide.visible=!1,this.btn_topMenu_show.visible=!0,this._isTween=!1,this._isHideTopMenu=!0},e.prototype.tweenTopMenuShow=function(){this._isTween=!0,egret.Tween.get(this.group_topMenu).to({x:0},150).call(this.gotoTopMenuShowStatus,this).call(this.updateTopMenu,this)},e.prototype.gotoTopMenuShowStatus=function(){this.group_topMenu.x=0,this.btn_topMenu_hide.visible=!0,this.btn_topMenu_show.visible=!1,this._isTween=!1,this._isHideTopMenu=!1},e.prototype.removeSellBtns=function(){ButtonUtils.removeTouchEvent(this.see_sell_btn),ButtonUtils.removeTouchEvent(this.sell_record_btn),ButtonUtils.removeTouchEvent(this.sell_end_btn),Tool.removeObjSafe(this.sell_group),xevent.removeEventListener(WorldEvent.ITEM_SELL_END,this.sellEndSuccess,this)},e.prototype.addSellBtns=function(){ButtonUtils.addTouchEvent(this.see_sell_btn,this.onSeeSell,this),ButtonUtils.addTouchEvent(this.sell_record_btn,this.onSellRecord,this),ButtonUtils.addTouchEvent(this.sell_end_btn,this.onSellEnd,this),this.addChild(this.sell_group),xevent.addEventListener(WorldEvent.ITEM_SELL_END,this.sellEndSuccess,this)},e.prototype.expandGroupMenu1=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.onBtnShowMenu(t,e)},e.prototype.onBtnChat=function(){PanelManager.openChatScene(),this.btn_chat.hasNewMessage=!1},e.prototype.onBtnTask=function(){PanelManager.openTaskScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnAround=function(){PanelManager.openAroundScene()},e.prototype.onBtnTower=function(){PanelManager.openManorScene()},e.prototype.onBtnMap=function(){PanelManager.openWorldMap()},e.prototype.onBtnSocial=function(){PanelManager.openSocietyScene()},e.prototype.onBtnDrug=function(){PanelManager.openDrugPanel(null,DrugPanel.Type_drug)},e.prototype.onBtnSystem=function(){PanelManager.openSystemScene()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnMail=function(t){t.stopImmediatePropagation(),PanelManager.openMailScene()},e.prototype.onBtnForge=function(){PanelManager.openForgeScene()},e.prototype.onBtnFiveDay=function(){FiveDayActityData.openFiveDayActivity()},e.prototype.onBtnSpringDay=function(){PanelManager.openSpringRewardPanel()},e.prototype.onBtnActivityList=function(){PanelManager.openActivityListScene()},e.prototype.onBtnRedPaper=function(){PanelManager.openRedPaperScene()},e.prototype.onBtnOffLineExp=function(){OfflineExp.doOpenOfflineExp()},e.prototype.onBtnRank=function(){PanelManager.openRankPanel()},e.prototype.onBtnTrade=function(){PanelManager.openTradeEntryPanel()},e.prototype.onBtnWelfare=function(){(new WelfarePanel).show()},e.prototype.onBtnInvite=function(){(new InvitePanel).show()},e.prototype.onBtnStrengthen=function(){ActivityService.instance.openActivity("StrengthenAct")},e.prototype.onBtnStrengthenTask=function(){ActivityService.instance.openActivity("StrengthenAct","task")},e.prototype.onTeam=function(){PanelManager.openAroundScene(),PanelManager.getPanel(AroundScene).setTab(AroundScene.TAB_INDEX_TEAM)},e.prototype.onBtnShop=function(){var t=xself.getLevel()>=15;xworld.doBrowseShop(Define.SHOP_MARKETPLACE,null,-1,t)},e.prototype.onBtnNotify=function(t){t.stopImmediatePropagation(),PanelManager.openActivityListScene()},e.prototype.onBtnHelp=function(){SpriteGuide.openSpriteGuide(),this.hideGuideSpriteTalk()},e.prototype.onMicro=function(){MicroPanel.openMicroPanelForwardly=!0,PanelManager.openMicroPanel()},e.prototype.onAutoGame=function(){AutoGamer.autoGaming=!AutoGamer.autoGaming,AutoGamer.autoGaming?(AutoGamer.autoFindMission(!0,!0),this.autogame_btn.visible=!1,this.autogame_cancel_btn.visible=!0):(this.autogame_btn.visible=!0,this.autogame_cancel_btn.visible=!1),GuideHandler.checkAutopathGuide()},e.prototype.onBtnRepair=function(){var t=new StringBuffer;t.append(GameText.STR_ALL_INFO_DUR_BROCKEN);var e=xself;e&&e.bag&&(e.bag.isDestroyEquip(!1,t),t.append("\n\n(背包已有野外修理卷："+e.bag.getRepaireItemCount()+")")),AlertPanel.alertRepair(t.toString())},e.prototype.updateHeadIcon=function(){this.headInfoView.updateHeadIcon()},e.prototype.updatePetHeadIcon=function(){this.headInfoView.updatePetHeadIcon(),this.updatePetProgress()},e.prototype.updateTeamIcon=function(){GameWorld.isBlinkzd!=this.img_zudui.visible&&(this.img_zudui.visible=GameWorld.isBlinkzd,this.updateIconPosition())},e.prototype.updateWorldIconPoint=function(){if(null!=xself){this.updateTopMenu(),this.updateMenu(),this.checkGuideSprite(),this.updateIconPosition(),this.updateChargeGroup(),this.checkRebateReward();var t=PlayerBag.isHaveBrokenEquip();this.btn_repair.visible=t,this.btn_repair.visible&&window.__myEvent__&&window.__myEvent__.emit("requestRepair")}},e.prototype.updateTopMenu=function(){if(!this._isTween&&null!=this.stage){var t=xself.isTabStatus(Model.MAIL_NEW_NOTICE),e=OnlineReward.isShowIcon&&OnlineReward.instance.isCanReward(),n=SevenDayReward.isOpen,i=SevenDayReward.checkIsCanDraw(),o=RewardHandler.isLevelRewardOpen,a=RewardHandler.canGetLevelReward,r=LoginLotteryDraw.showInWorld(),s=FiveDayActityData.isOpen,l=FiveDayActityData.isCanDraw,_=SpringReward.checkIsCanDraw();if(0==this._isHideTopMenu){RedPoint.removeRedPoint(this.btn_topMenu),RedPoint.removeRedPoint(this.g_mail),RedPoint.removeRedPoint(this.g_onlineReward),RedPoint.removeRedPoint(this.g_reward),RedPoint.removeRedPoint(this.g_fiveDay),RedPoint.removeRedPoint(this.g_exchangeMoney),RedPoint.removeRedPoint(this.g_springDay);var h=[],u=[];h.push(this.g_mail),h.push(this.g_rank),xself.getLevel()>=15?h.push(this.g_trade):u.push(this.g_trade),OfflineExp.isOpen?h.push(this.g_offLineExp):u.push(this.g_offLineExp),xchannel==Define.CHANNEL_SINA&&xworld.isShare||xchannel==Define.CHANNEL_1758||xchannel==Define.CHANNEL_WANBA?h.push(this.g_share):u.push(this.g_share),xchannel==Define.CHANNEL_SINA&&Sdk.xsdk.getSDKSatus()||xchannel==Define.CHANNEL_QQBROWSER||xchannel==Define.CHANNEL_WANBA?h.push(this.g_save):u.push(this.g_save),xchannel==Define.CHANNEL_1758&&xworld.isFollow?h.push(this.g_follow):u.push(this.g_follow),OnlineReward.isShowIcon?h.push(this.g_onlineReward):u.push(this.g_onlineReward),h.push(this.g_reward),s?h.push(this.g_fiveDay):u.push(this.g_fiveDay),h.push(this.g_exchangeMoney),h.push(this.g_activityList),RedPaper.isOPen?h.push(this.g_redPaper):u.push(this.g_redPaper),SpringReward.isOpen?h.push(this.g_springDay):u.push(this.g_springDay),xchannel==Define.CHANNEL_WANBA?(h.push(this.g_welfare),h.push(this.g_invite)):(u.push(this.g_welfare),u.push(this.g_invite)),xchannel==Define.CHANNEL_WANBA&&h.push(this.g_strengthen),xself.getLevel()>=30?h.push(this.g_onekeyDailyMission):u.push(this.g_onekeyDailyMission);var c=this._btnWidth,T=0,p=0;if(h.length<=2){for(var d=0;d<h.length;d++){null!=(E=h[d])&&(E.x=0,E.y=d*c+15,E.visible=!0)}T=c,p=2*c+30}else{for(d=0;d<h.length;d++){null!=(E=h[d])&&(E.x=d%2*c,E.y=Math.floor(d/2)*c+15,E.visible=!0)}T=2*c,p=c*Math.ceil(h.length/2)+30}for(d=0;d<u.length;d++){var E;null!=(E=u[d])&&(E.visible=!1)}this.img_topMenuBg.width=T,this.img_topMenuBg.height=p,this.btn_topMenu.y=(this.img_topMenuBg.height-this.btn_topMenu.height)/2+this.img_topMenuBg.y,this.btn_topMenu.x=this.img_topMenuBg.width-2*xhdRatio,t&&RedPoint.addRedPoint(this.g_mail),(a&&o||i&&n||r)&&RedPoint.addRedPoint(this.g_reward),l&&RedPoint.addRedPoint(this.g_fiveDay),this.gotoTopMenuShowStatus()}else{r||t||e||i||a||l||_?RedPoint.addRedPoint(this.btn_topMenu,this.btn_topMenu.width-20*xhdRatio,5*xhdRatio):RedPoint.removeRedPoint(this.btn_topMenu),RedPoint.removeRedPoint(this.g_mail),RedPoint.removeRedPoint(this.g_onlineReward),RedPoint.removeRedPoint(this.g_reward),RedPoint.removeRedPoint(this.g_exchangeMoney),RedPoint.removeRedPoint(this.g_fiveDay),RedPoint.removeRedPoint(this.g_springDay),this.gotoTopMenuHideStatus()}this.checkOnLineReward()}},e.prototype.updateMenu=function(){if(xself){var t=xself.cp>0,e=xself.isTabStatus(Model.CHAT_NEW_NOTICE),n=xself.isTabStatus(Model.COUNTRY_APPLY);1==this.group_menu.visible?(RedPoint.removeRedPoint(this.btn_showMenu),t?RedPoint.addRedPoint(this.btn_role):RedPoint.removeRedPoint(this.btn_role),n?RedPoint.addRedPoint(this.btn_tower):RedPoint.removeRedPoint(this.btn_tower),this.btn_chat.hasNewMessage=!!e):(RedPoint.removeRedPoint(this.btn_role),RedPoint.removeRedPoint(this.btn_tower),t||e||n?RedPoint.addRedPoint(this.btn_showMenu):RedPoint.removeRedPoint(this.btn_showMenu))}},e.prototype.updateIconPosition=function(){var t=this.group_topMenu.y+this.group_topMenu.height+10*xhdRatio;this.img_zudui.visible&&(this.img_zudui.y=t,t+=this.img_zudui.height+2*xhdRatio),xself.isShopMode()?(this.group_taskTarget.visible=!1,this.micro_btn.visible=!1):(this.group_taskTarget.visible=!0,this.checkMicroBtn(),this.micro_btn.visible&&(this.micro_btn.top=this.group_taskTarget.top+this.group_taskTarget.height+5*xhdRatio))},e.prototype.updateRoleProgress=function(){this.headInfoView.updateRoleProgress()},e.prototype.updateRoleLevel=function(){this.headInfoView.updateRoleLevel(),this.checkGuideSprite()},e.prototype.updatePetProgress=function(){this.headInfoView.updatePetProgress()},e.prototype.updatePetLevel=function(){this.headInfoView.updatePetLevel()},e.prototype.updateVipLevel=function(){this.headInfoView.updateVip()},e.prototype.logic=function(t){this._logicSpriteTalk>0&&(this._logicSpriteTalk-=t,this._logicSpriteTalk<=0&&this.hideGuideSpriteTalk()),this._isOpenActivityNotice&&this._activityStartTime>0&&(this._logicActivitiNotice+=t,this._logicActivitiNotice>1e3&&(this._logicActivitiNotice=0,this.updateActivityNoticeTime()))},e.prototype.setBubbleScale=function(t){this.btn_topMenu_show.scaleX=t,this.btn_topMenu_show.scaleY=t},e.prototype.checkOnLineReward=function(){var t=OnlineReward.isShowIcon&&OnlineReward.instance.isCanReward();this._isHideTopMenu?t&&RedPoint.addRedPoint(this.btn_topMenu,this.btn_topMenu.width-20*xhdRatio,5*xhdRatio):(RedPoint.removeRedPoint(this.btn_topMenu),this.g_onlineReward.visible&&(t?(this.img_onlineRewardTimeBg.visible=!1,this.label_onlineRewardTime.visible=!1,RedPoint.addRedPoint(this.g_onlineReward)):(this.img_onlineRewardTimeBg.visible=!0,this.label_onlineRewardTime.visible=!0,this.updateOnlineRewardTime(),RedPoint.removeRedPoint(this.g_onlineReward))))},e.prototype.updateOnlineRewardTime=function(){this.label_onlineRewardTime.visible&&(this.label_onlineRewardTime.text=this.getTime(OnlineReward.instance.getLeftTime()))},e.prototype.checkRebateReward=function(){var t=this;InviteNewDataModel.instance.checkReward((function(e){e?RedPoint.addRedPoint(t.g_activityList):RedPoint.removeRedPoint(t.g_activityList)}),this)},e.prototype.getTime=function(t){var e=Math.floor(t/1e3);if(0>e)return"00:00";var n=Math.floor(e/60),i=e%60,o="";return o+=10>n?"0"+n:""+n,(o+=":")+(10>i?"0"+i:""+i)},e.prototype.checkMail=function(){this.updateTopMenu()},e.prototype.checkPlayerEvent=function(){this.updateTopMenu()},e.prototype.setGuideSpriteShow=function(t){t?(this.isForceHideGuideSprite=!1,this.checkGuideSprite()):(this.isForceHideGuideSprite=!0,this.help_btn.visible=!1,this.hideGuideSpriteTalk(),TodayEvent.isOpenTodayEvent=!1,RedPoint.removeRedPoint(this.help_btn))},e.prototype.checkGuideSprite=function(){this.isForceHideGuideSprite||(GameWorld.isShowSrpiteGuide()?(this.help_btn.visible=!0,TodayEvent.isOpenTodayEvent=!0,this.setHelpPoint()):(this.help_btn.visible=!1,TodayEvent.isOpenTodayEvent=!1,RedPoint.removeRedPoint(this.help_btn)))},e.prototype.setHelpPoint=function(){var t=this;this._isHelpInit||(this._isHelpInit=!0,TodayEvent.reqData((function(){var e=!1,n=TodayEvent.getShowList();n&&n.length>0&&n.forEach((function(t){e=e||!t.isFinish}),t),e?(t.validateNow(),RedPoint.addRedPoint(t.help_btn)):RedPoint.removeRedPoint(t.help_btn)}),this))},e.prototype.onBtnShare=function(){PanelManager.openSharePanel()},e.prototype.onBtnSave=function(){xchannel==Define.CHANNEL_QQBROWSER?Sdk.xsdk.sendToDesktop((function(){WorldMessage.addTips("添加桌面成功！！")})):PanelManager.openSavePanel()},e.prototype.onBtnFollow=function(){PanelManager.openFollowPanel()},e.prototype.onBtnFirstCharge=function(){PanelManager.openFirstChargeScene()},e.prototype.onBtnDailyCharge=function(){ActivityService.instance.openActivity("DailyChargeAct")},e.prototype.onBtnQuickPower=function(){ActivityService.instance.openActivity("QuickPowerAct")},e.prototype.onBtnOnekeyDailyMission=function(){PanelManager.openOnekeyDailyMissionPanel()},e.prototype.guideSpriteTalk=function(t){if(this.group_spriteTalk){this.label_spriteTalk.textFlow=Tool.convertDescToTextFlow(t),this.group_spriteTalk.visible=!0,this.addChild(this.group_spriteTalk),this.group_spriteTalk.scaleX=0,egret.Tween.get(this.group_spriteTalk).to({scaleX:1},100);var e=Math.round(4*Math.random())+8;this._logicSpriteTalk=1e3*e}},e.prototype.hideGuideSpriteTalk=function(){if(this._logicSpriteTalk=0,this.group_spriteTalk&&this.group_spriteTalk.stage&&this.group_spriteTalk.visible){var t=this.group_spriteTalk;egret.Tween.get(this.group_spriteTalk).to({scaleX:0},100).call((function(){t.visible=!1,t.parent&&t.parent.removeChild(t)}),this)}},e.prototype.checkMicroBtn=function(){return 0==showMicro||"android"!=nato.getPlatform()?void(this.micro_btn.visible=!1):void(Sdk.xsdk&&Sdk.xsdk.param&&1==Sdk.xsdk.param.isOpenMicro?"ios"==nato.getPlatform()||xself.getLevel()>35?this.micro_btn.visible=!1:this.micro_btn.visible=!xworld.isDrawMicroReward:this.micro_btn.visible=!1)},e.prototype.hideOnlineReward=function(){this.g_onlineReward.visible=!1,this.updateTopMenu()},e.prototype.onSeeSell=function(){PanelManager.openBag(1)},e.prototype.onSellRecord=function(){SellHandler.doStallRecord()},e.prototype.onSellEnd=function(){SellHandler.doSellEnd()},e.prototype.sellEndSuccess=function(){this.removeSellBtns()},e.prototype.checkTaskTarget=function(){if(null!=this.group_taskTarget){if(this._taskTargetList&&this._taskTargetList.length>0)for(var t=0;t<this._taskTargetList.length;t++)TaskTargetItem.returnItem(this._taskTargetList[t]);this._taskTargetList=[];var e=[],n=xself.missionList;if(n&&n.length>0)for(t=n.length-1;t>=0;t--){var i=n[t];if(i&&i.isShowTargetType()){var o=i.getTargetData();if((e=i==Mission.curUpdateMission?o.concat(e):e.concat(o)).length>=6)break}}var a=e.length;a>6&&(a=6);for(t=0;a>t;t++){var r=e[t],s=TaskTargetItem.getItem();s.setData(r),s.y=s.height*t,this.group_taskTarget.addChild(s),this._taskTargetList.push(s)}}},e.prototype.updateTaskTarget=function(){this.checkTaskTarget(),this.updateIconPosition()},e.prototype.getIsInit=function(){return this._isInit},e.prototype.updateChargeGroup=function(){this.firstCharge_btn.visible=FirstCharge.isOpen,this.firstCharge_btn.includeInLayout=FirstCharge.isOpen},e.prototype.updateStrengthen=function(){if(xchannel==Define.CHANNEL_WANBA){var t=ActivityService.instance.getActivity("StrengthenAct");if(t){this.g_strengthen.visible=t.getActData("init");var e=t.getActData("task");Tool.isNullText(e)?this.group_strengthen.visible=!1:(this.group_strengthen.visible=!0,this.txtStrenthen.text=e),t.getActData("hasAward")?RedPoint.addRedPoint(this.g_strengthen):RedPoint.removeRedPoint(this.g_strengthen)}else this.g_strengthen.visible=!1,this.group_strengthen.visible=!1}},e.prototype.updateQuickPower=function(){if(xchannel==Define.CHANNEL_WANBA){var t=ActivityService.instance.getActivity("QuickPowerAct");if(t){var e=t.getActData();this.quickPower_btn.visible=e,this.quickPower_btn.includeInLayout=e}else this.quickPower_btn.visible=!1,this.quickPower_btn.includeInLayout=!1}},e.prototype.updateDailyCharge=function(){if(xchannel==Define.CHANNEL_WANBA){var t=ActivityService.instance.getActivity("DailyChargeAct");if(t){var e=t.getActData();this.dailyCharge_btn.visible=0!=e,this.dailyCharge_btn.includeInLayout=0!=e,this.dailyCharge_btn.source="zjm_dailycharge"+e+"_hd"}else this.dailyCharge_btn.visible=!1,this.dailyCharge_btn.includeInLayout=!1}},e.prototype.updateActivityNotice=function(){this._isOpenActivityNotice=!1,this._isOpenActivityNotice?(null==this.group_activityNoticeItem.parent&&this.group_activityNotice.addChild(this.group_activityNoticeItem),0==this._isHideActivityNotice?this.gotoActivityNoticeShowStatus():this.gotoActivityNoticeHideStatus()):this.group_activityNotice.removeChildren()},e.prototype.gotoActivityNoticeShowStatus=function(){this.group_activityNoticeItem.x=0,this._isTweenActivityNotice=!1,this._isHideActivityNotice=!1,this.img_activityNotice_menu_time_bg.visible=!1,this.label_activityNotice_menu_time.visible=!1,this.label_activity_name.text="测试活动名称",this.updateActivityNoticeTime()},e.prototype.gotoActivityNoticeHideStatus=function(){this.group_activityNoticeItem.x=0-this.img_activityNotice_bg.width+36*xhdRatio,this._isTweenActivityNotice=!1,this._isHideActivityNotice=!0,this.img_activityNotice_menu_time_bg.visible=!0,this.label_activityNotice_menu_time.visible=!0,this.updateActivityNoticeTime()},e.prototype.tweenActivityNoticeShow=function(){0==this._isTweenActivityNotice&&(this._isTweenActivityNotice=!0,egret.Tween.get(this.group_activityNoticeItem).to({x:0},150).call(this.gotoActivityNoticeShowStatus,this).call(this.updateActivityNotice,this))},e.prototype.tweenActivityNoticeHide=function(){0==this._isTweenActivityNotice&&(this._isTweenActivityNotice=!0,egret.Tween.get(this.group_activityNoticeItem).to({x:0-this.img_activityNotice_bg.width+36*xhdRatio},150).call(this.gotoActivityNoticeHideStatus,this).call(this.updateActivityNotice,this))},e.prototype.updateActivityNoticeTime=function(){if(this._isOpenActivityNotice&&0==this._isTweenActivityNotice){var t="";if(this._isHideActivityNotice){if((e=this._activityStartTime-Tool.currentTime)>0)10>(n=Math.floor(e/1e3/60))&&(t+="0"),t+=n+":",10>(i=Math.floor(e/1e3)%60)&&(t+="0"),t+=i,this.label_activityNotice_menu_time.text=t,0==this.label_activityNotice_menu_time.visible&&(this.label_activityNotice_menu_time.visible=!0,this.img_activityNotice_menu_time_bg.visible=!0);else this.label_activityNotice_menu_time.visible&&(this.img_activityNotice_menu_time_bg.visible=!1,this.label_activityNotice_menu_time.visible=!1)}else{var e,n,i;if((e=this._activityStartTime-Tool.currentTime)>0)10>(n=Math.floor(e/1e3/60))&&(t+="0"),t+=n+"分",10>(i=Math.floor(e/1e3)%60)&&(t+="0"),t+=i+"秒";else t="点击参与";this.label_activity_time.text=t}}},e.prototype.onGroupActivityNoticeTouch=function(t){this._isHideActivityNotice?this.tweenActivityNoticeShow():t.target==this.label_activity_time||this.tweenActivityNoticeHide()},e}(eui.Component);__reflect(MainMenuScene.prototype,"MainMenuScene");var OnlineRewardPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.label_time.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch,this),this.item.cacheAsBitmap=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this.label_time.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelTouch,this)},e.prototype.onClose=function(){PanelManager.closeOnlineRewardPanel()},e.prototype.onLabelTouch=function(){OnlineReward.instance.doGetReward()},e.prototype.onBtnGetReward=function(){OnlineReward.instance.doGetReward()},e.prototype.update=function(){this.init&&(this.item.itemData=OnlineReward.instance.item,this.label_name.textFlow=Tool.convertDescToTextFlow(OnlineReward.instance.item.getNameInfo()),this.updateTime())},e.prototype.updateTime=function(){this.init&&(OnlineReward.instance.isCanReward()?(this.label_time.touchEnabled=!0,this.label_time.text="领取"):(this.label_time.touchEnabled=!1,this.label_time.text=OnlineReward.instance.getTime()))},e}(ComponentBase);__reflect(OnlineRewardPanel.prototype,"OnlineRewardPanel");var OneKeyDailyMissionPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._finishImgList){this._finishImgList=[],this._goBtnList=[],this._lvLabelList=[];for(var n=0;7>n;n++){var i=this["label_lv"+n],o=this["img_finish"+n],a=this["btn_go"+n];this._finishImgList.push(o),this._goBtnList.push(a),this._lvLabelList.push(i)}}for(n=0;n<this._goBtnList.length;n++){(a=this._goBtnList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoBtnTouch,this)}ButtonUtils.addTouchEvent(this.btn_open,this.onBtnOpenTouch,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._goBtnList.length;n++){this._goBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoBtnTouch,this)}ButtonUtils.removeTouchEvent(this.btn_open),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeOnekeyDailyMissionPanel()},e.prototype.onGoBtnTouch=function(t){var e=t.target,n=this._goBtnList.indexOf(e);-1!=n&&OneKeyDailyMission.doOneKeyMission_local(n+1)},e.prototype.onBtnOpenTouch=function(){OneKeyDailyMission.doOpenOnekeyDailyMission()},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){for(var t=xself.getLevel(),e=OneKeyDailyMission.openLvList,n=0;n<e.length;n++){var i=e[n],o=this._lvLabelList[n],a=this._goBtnList[n],r=this._finishImgList[n];i>t?(o.textFlow=Tool.convertDescToTextFlow("(/cff0000lv"+i+"/p)"),r.visible=!1,a.visible=!0,a.enabled=!1,a.label="前往",a.touchEnabled=!1):(o.textFlow=Tool.convertDescToTextFlow("(/c00ff00lv"+i+"/p)"),a.visible=!0,a.enabled=!0,a.touchEnabled=!0,n+1==OneKeyDailyMission.ID_yuangusenlin?this.updateYuangusenlingStatus():this.updateCityTaskStatus(n))}if(OneKeyDailyMission.isOpenOnekeyDailyMission?(this.group_info.visible=!1,this.height=330*xhdRatio,this.group_cache.height=314*xhdRatio):(this.group_info.visible=!0,this.height=400*xhdRatio,this.group_cache.height=386*xhdRatio),OneKeyDailyMission.curSelect>0){this.img_curSelect.visible=!0;o=this._lvLabelList[OneKeyDailyMission.curSelect-1];this.img_curSelect.y=o.y}else this.img_curSelect.visible=!1}},e.prototype.updateCityTaskStatus=function(t){var e=this._finishImgList[t],n=this._goBtnList[t];if(OneKeyDailyMission.checkIsFinish(t+1))n.visible=!1,e.visible=!0;else{e.visible=!1,n.visible=!0;var i=OneKeyDailyMission.checkIsHaveAccept(t+1);n.label=i?"继续":"前往"}},e.prototype.updateYuangusenlingStatus=function(){if(OneKeyDailyMission.checkIsFinish(OneKeyDailyMission.ID_yuangusenlin))this.btn_go6.visible=!1,this.img_finish6.visible=!0;else{this.img_finish6.visible=!1,this.btn_go6.visible=!0;var t=OneKeyDailyMission.idList_yuangusenlin[0];Mission.isMissionFinish(xself,t)||null!=xself.getMissionById(t)?this.btn_go6.label="继续":this.btn_go6.label="前往"}},e}(ComponentBase);__reflect(OneKeyDailyMissionPanel.prototype,"OneKeyDailyMissionPanel");var PlatformGiftPanel=function(t){function e(e){var n=t.call(this)||this;return nato.attachSkin(n),n._giftId=e,n}return __extends(e,t),e.prototype.initComponent=function(){var e=this;t.prototype.initComponent.call(this);var n=new egret.ByteArray;n.writeInt(this._giftId),InteractUtil.sendMessage(ProtocolDefine.CG_OPEN_WANBA_PLAT_GIFT,(function(t){e._msg=t,e.initAward()}),this,n)},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnGetAward",this.onGetAward,this)},e.prototype.initAward=function(){this._msg.getBoolean()?(this.btnGetAward.label="已领取",this.btnGetAward.touchEnabled=!1,DisplayUtil.applyGray(this.btnGetAward)):(this.btnGetAward.label="领取奖励",this.btnGetAward.touchEnabled=!0,DisplayUtil.clearFilter(this.btnGetAward)),this.txtTitle.text=this._msg.getString(),this.txtDesc.text=this._msg.getString();for(var t=[],e=this._msg.getByte(),n=0;e>n;n++){var i=new ItemData;this._msg.getBoolean()?(i.isMoney=!0,i.moneyType=InteractUtil.toMoneyType(this._msg.getInt()),i.quantity=this._msg.getInt()):(i.isMoney=!1,ItemData.fromBytesAtts2(i,this._msg),i.quantity=this._msg.getInt(),i.durMax>0&&(i.durability=i.durMax)),t.push(i)}this.listAward.itemRenderer=ItemRender3,this.listAward.dataProvider=new eui.ArrayCollection(t)},e.prototype.onGetAward=function(){var t=this,e=new egret.ByteArray;e.writeInt(this._giftId),InteractUtil.sendMessage(ProtocolDefine.CG_DRAW_WANBA_PLAT_GIFT,(function(e){var n=new StringBuffer,i=e.getInt(),o=e.getInt(),a=e.getInt();xself.setMoneyByType(ModelConst.MONEY1,i,n),xself.setMoneyByType(ModelConst.MONEY2,o,n),xself.setMoneyByType(ModelConst.MONEY3,a,n),t.btnGetAward.label="已领取",t.btnGetAward.touchEnabled=!1,DisplayUtil.applyGray(t.btnGetAward);var r=MsgHandler.processAddItemMsg(e,ProtocolDefine.CG_DRAW_WANBA_GIFT);n.append(r),WorldMessage.addTips(n.toString())}),this,e)},e}(PanelBase);__reflect(PlatformGiftPanel.prototype,"PlatformGiftPanel");var RedPoint=function(){function t(){}return t.addRedPoint=function(e,n,i){if(void 0===n&&(n=-1),void 0===i&&(i=-1),null!=e&&null!=e.parent&&0!=e.visible&&null==t._pointDictionary[e.hashCode]){var o=e.width;0==o&&(o=35*xhdRatio);var a=t.getRedPointItem();a.target=e,a.targetX=n,a.targetY=i,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onTargetRemoveFromStage,t),-1==n&&-1==i?(a.x=e.x+(o-a.width),a.y=e.y):(a.x=e.x+n,a.y=e.y+i),e.parent.addChild(a),t._pointDictionary[e.hashCode]=a}},t.onTargetRemoveFromStage=function(e){t.removeRedPoint(e.target)},t.removeRedPoint=function(e){if(null!=e){var n=t._pointDictionary[e.hashCode];n&&(delete t._pointDictionary[e.hashCode],e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,t.onTargetRemoveFromStage,t),t.returnRedPointItem(n))}},t.updateRedPoint=function(e,n,i){if(null!=e){var o=t._pointDictionary[e.hashCode];o&&(o.targetX=n,o.targetY=i,o.x=e.x+n,o.y=e.y+i)}},t.getRedPointItem=function(){return ObjectPool.getPool("RedPointItem").createObject()},t.returnRedPointItem=function(t){null!=t&&(t.parent&&t.parent.removeChild(t),ObjectPool.getPool("RedPointItem").returnObject(t))},t._pointDictionary={},t}();__reflect(RedPoint.prototype,"RedPoint");var RedPointItem=function(t){function e(){var e=t.call(this)||this;return e.targetX=-1,e.targetY=-1,e.touchEnabled=!1,e.source="notice_red_point"+(xhd?"_hd":"_sd"),e.width=13.5*xhdRatio,e}return __extends(e,t),e}(eui.Image);__reflect(RedPointItem.prototype,"RedPointItem");var SpriteGuidePanel=function(t){function e(){var e=t.call(this)||this;return e._content=null,e._isNext=!1,e._nextContent=null,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_continue.touchEnabled=!1,this.label_other.touchEnabled=!1,this.img_sure.touchEnabled=!1,ButtonUtils.addTouchEvent(this.btn_sure,this.onSure,this),ButtonUtils.addTouchEvent(this.btn_sure0,this.onSure0,this),ButtonUtils.addTouchEvent(this.btn_sure1,this.onSure1,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onSure=function(){return null!=this._nextContent?void PanelManager.getPanel(e).setData(this._nextContent,null):(PopUpManager.removePopUp(PanelManager.getPanel(e,!1)),guide.isStatusFlag(guide.IS_GUIDE_SPRITE_GUIDE)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_SPRITE_GUIDE),GuideHandler.ballGuide()),void(guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL)&&(guide.battleFailFirse=!0,BattleView.instance.doExit(),SpriteGuide.doSpriteGuideAutoMove(906,5))))},e.prototype.onSure0=function(){return null!=this._nextContent?void PanelManager.getPanel(e).setData(this._nextContent,null):(PopUpManager.removePopUp(PanelManager.getPanel(e,!1)),void(guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL_2)&&(guide.battleFailFirse=!0,BattleView.instance.doExit(),TodayEvent.checkTask())))},e.prototype.onSure1=function(){return null!=this._nextContent?void PanelManager.getPanel(e).setData(this._nextContent,null):(PopUpManager.removePopUp(PanelManager.getPanel(e,!1)),void(guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL_2)&&BattleView.instance.doExit()))},e.prototype.setData=function(t,e){this._content=t,this._nextContent=e,PanelManager.closeNPCDialogue(),this.update()},e.prototype.update=function(){0!=this.init&&null!=this._content&&(this.edit_text.text=this._content,guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL_2)?(this.group_1.visible=!1,this.group_2.visible=!0):(this.group_1.visible=!0,this.group_2.visible=!1))},e}(ComponentBase);__reflect(SpriteGuidePanel.prototype,"SpriteGuidePanel");var TaskTargetItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=e.touchEnabled=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._taskTargetData=t},e.prototype.update=function(){this.init&&null!=this._taskTargetData&&(this.label_name.width=300,this.label_name.text=this._taskTargetData.showName+":",this.label_name.width=this.label_name.textWidth,this.label_name.x=this.label_count.x-this.label_name.width,this._taskTargetData.currentCount>=this._taskTargetData.needCount?(this.label_count.textColor=65280,this.label_count.text=this._taskTargetData.needCount+"/"+this._taskTargetData.needCount):(this.label_count.textColor=16711680,this.label_count.text=this._taskTargetData.currentCount+"/"+this._taskTargetData.needCount))},e.getItem=function(){var t=ObjectPool.getPool("TaskTargetItem").createObject();return nato.attachSkin(t),t},e.returnItem=function(t){null!=t&&(t.parent&&t.parent.removeChild(t),ObjectPool.getPool("TaskTargetItem").returnObject(t))},e}(ComponentBase);__reflect(TaskTargetItem.prototype,"TaskTargetItem");var TaskTargetData=function(){this.currentCount=0,this.needCount=0};__reflect(TaskTargetData.prototype,"TaskTargetData");var WelcomePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_enterGame,this.onBtnEnterGame,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_enterGame)},e.prototype.onBtnEnterGame=function(){var t=xself;if(t){var e=Control.createMoveTo(t.getId(),11,7);t.addControl(e)}xworld.setTouchNpcId(1),PanelManager.closeWelcomePanel()},e}(ComponentBase);__reflect(WelcomePanel.prototype,"WelcomePanel");var CountryArmyBuildItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_update),ButtonUtils.removeTouchEvent(this.btn_see)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.initPanel=function(){this._data?(this.btn_update.label=GameText.getText(GameText.TI_UP_LEVEL),this.btn_see.label=GameText.STR_SEE,ButtonUtils.addTouchEvent(this.btn_see,this.onSee,this),this.label_name.text=this._data.getBuildName(),this._data.isCanUpdate()?(this.addChild(this.btn_update),ButtonUtils.addTouchEvent(this.btn_update,this.onUpdate,this)):Tool.removeObjSafe(this.btn_update)):this.label_name.text=""},e.prototype.onUpdate=function(){var t,e=[];t=new MenuActionData(GameText.getText(GameText.TI_UP_LEVEL),1),e.push(t),t=new MenuActionData(GameText.getText(GameText.TI_BACK),0),e.push(t),Tool.manageString(GameText.STR_PARTNER_APPLY_INFO,MarryHandler.getPartnerAddMoney()),PanelManager.openSelectMenuPanel(this._data.nextWarBuild.getArmyBuildInfo(!0),e,this.confirmUpdate,this)},e.prototype.confirmUpdate=function(t){1==t&&Country.doBuildUpdateLevel(CountryArmyScene.country,this._data),PanelManager.closeSelectMenuPanel()},e.prototype.onSee=function(){this._data&&AlertPanel.alertTipsCommon(this._data.getArmyBuildInfo(!1),!0,"left")},e}(ComponentBase);__reflect(CountryArmyBuildItem.prototype,"CountryArmyBuildItem");var CountryArmyBuildPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.COUNTRY_ARMY_BUILD_UPDATE,this.updateBuild,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.COUNTRY_ARMY_BUILD_UPDATE,this.updateBuild,this),this._country=null,this._buildItemList){for(var n=0,i=this._buildItemList.length;i>n;n++)Tool.removeObjSafe(this._buildItemList[n]),ObjectPool.getPool("CountryArmyBuildItem").returnObject(this._buildItemList[n]);this._buildItemList=null}this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null)},e.prototype.update=function(){this._country=CountryArmyScene.country,Country.doGetBuildList(this._country,this.returnBuildList,this)},e.prototype.returnBuildList=function(){if(this.stage){this.initInfo();for(var t=0;;){var e=this._country.getWarBuild(t);if(!e)break;var n=ObjectPool.getPool("CountryArmyBuildItem").createObject();nato.attachSkin(n),this._buildItemList||(this._buildItemList=[]),this._buildItemList.push(n),n.x=9*xhdRatio,n.y=58*xhdRatio+t*n.height,n.data=e,n.parent||this.addChild(n),t++}this.addChild(this.bg),this._buildItemList&&this._buildItemList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject()),this._radioBtns.add(this._buildItemList,-1))}},e.prototype.initInfo=function(){this.label_armyStrength.text=this._country.armyStrength+"",this.label_bookNum.text=this._country.bookNum+"",this.label_gk_money1.text=this._country.getMoney1(),this.label_gk_money2.text=this._country.getMoney2(),this.label_gk_money3.text=this._country.getMoney3(),this.label_zy_1.text=this._country.getWood(),this.label_zy_2.text=this._country.getStone(),this.label_zy_3.text=this._country.getIron()},e.prototype.updateBuild=function(){for(var t=0;;){var e=this._country.getWarBuild(t),n=this._buildItemList[t];if(!e||!n)break;n.data=e,t++}this.initInfo()},e}(ComponentBase);__reflect(CountryArmyBuildPanel.prototype,"CountryArmyBuildPanel");var CountryArmyCampPanel=function(t){function e(){var e=t.call(this)||this;return e._isRegistTime=!1,e._time=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_applyWar.label=GameText.STR_ARMYCAMP_APPLY_WAR,this.btn_declare_war.label=GameText.STR_COUNTRY_WAR_DECLARE,ButtonUtils.addTouchEvent(this.btn_applyWar,this.onApplyWar,this),ButtonUtils.addTouchEvent(this.btn_declare_war,this.onDeclareWar,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_applyWar),ButtonUtils.removeTouchEvent(this.btn_declare_war),this._country=null,this._isRegistTime&&(this._isRegistTime=!1,nato.WorldTicker.instance.unregister(this.time,this)),this._time=0},e.prototype.update=function(){CountryArmyScene.country&&(this._country=CountryArmyScene.country,this.label_countryName.text=this._country.name,this.label_kingName.text=this._country.kingName,this.label_campLevel.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._country.campLevel+""),this.label_unionName.text=this._country.getUnionName(),this.label_unionNum.text=this._country.unionNum+"",this.label_armyStrength.text=this._country.armyStrength+"",this.label_militaryStrength.text=this._country.militaryStrength+"",this.label_soldierNum.text=this._country.soldierNum+" / "+this._country.soldierMax,this.label_helpNum.text=this._country.helpNum+" / "+this._country.helpMax,this.label_warCount.text=this._country.warCount+"",this.label_warWinRate.text=this._country.warWinRate+"%",this.label_fightCountry.text=this._country.getFightCountry(),this.label_gz_money1.text=this._country.getFightMoney1(),this.label_gz_money3.text=this._country.getFightMoney3(),this.label_gk_money1.text=this._country.getMoney1(),this.label_gk_money2.text=this._country.getMoney2(),this.label_gk_money3.text=this._country.getMoney3(),this.label_zy_1.text=this._country.getWood(),this.label_zy_2.text=this._country.getStone(),this.label_zy_3.text=this._country.getIron(),this._time=this._country.fightTime-Tool.currentTime,this.time())},e.prototype.time=function(t){void 0===t&&(t=0),this._time-=t,this._time>0&&!this._isRegistTime?(this._isRegistTime=!0,nato.WorldTicker.instance.register(this.time,this)):this._time<=0&&this._isRegistTime&&(this._isRegistTime=!1,nato.WorldTicker.instance.unregister(this.time,this)),this.label_fightTime.text=this._country.getFightTime(this._time)},e.prototype.onApplyWar=function(){Country.doSoldierApply()},e.prototype.onDeclareWar=function(){PanelManager.openManorScene(2,ManorScene.FROM_WAR_DECLARE)},e}(ComponentBase);__reflect(CountryArmyCampPanel.prototype,"CountryArmyCampPanel");var CountryArmyScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(n){this.tabPanelList=[this.army_camp_panel,this.army_soldier_panel,this.army_build_panel],t.prototype.onAddToStage.call(this,n),(!e.country||e.updateCountry)&&(e.updateCountry=!1,Country.doGetCampInfo(this.getCampInfo,this)),this.btn_union.currentState="down",ButtonUtils.addTouchEvent(this.btn_union,this.openUnionPanel,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_union)},e.prototype.closePanel=function(){t.prototype.closePanel.call(this),this.army_soldier_panel.clear(),e.country=null},e.prototype.getCampInfo=function(t){e.country=t,this.getCurrentPanel().update()},e.prototype.openUnionPanel=function(){PanelManager.openScene(PanelManager.getPanel(WarUnionScene))},e.updateCountry=!1,e}(TabPanelBase);__reflect(CountryArmyScene.prototype,"CountryArmyScene");var CountryArmySoldierPanel=function(t){function e(){var e=t.call(this)||this;return e.MBMBER="member",e.APPLY="apply",e._currComboBoxType=0,e._currRadioSelect=1,e._currSelectItem=0,e.allSize=0,e.pageSize=7,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.radio_0.label=GameText.STR_ARMYSOLDIER_FIGHT_SOLDIER2,this.radio_1.label=GameText.STR_ARMYSOLDIER_TYPE_MY_APPLY2,this.radio_2.label=GameText.STR_ARMYSOLDIER_TYPE_HELP_APPLY2,this.radio_0.value=Country.SOLDIER_TYPE_WAR_MENBER,this.radio_1.value=Country.SOLDIER_TYPE_APPLY,this.radio_2.value=Country.SOLDIER_TYPE_HPLT_APPLY,this._radioGroup||(this._radioGroup=new eui.RadioButtonGroup),this.radio_0.group=this._radioGroup,this.radio_1.group=this._radioGroup,this.radio_2.group=this._radioGroup,this["radio_"+(this._currRadioSelect-1)].selected=!0,this._radioGroup.addEventListener(egret.Event.CHANGE,this.onChangeSoldierList,this),PanelManager.getPanel(CountryArmyScene).validateNow();var n=[];n.push({value:-1,label:GameText.STR_LIST_ALL}),n.push({value:Define.RANK_COMTE,label:Define.getRankString(Define.RANK_COMTE)}),n.push({value:Define.RANK_VICOMTE,label:Define.getRankString(Define.RANK_VICOMTE)}),n.push({value:Define.RANK_LORD,label:Define.getRankString(Define.RANK_LORD)}),n.push({value:Define.RANK_NOBLE,label:Define.getRankString(Define.RANK_NOBLE)}),n.push({value:Define.RANK_NATIONAL,label:Define.getRankString(Define.RANK_NATIONAL)}),n.push({value:Define.RANK_SUCCOR,label:Define.getRankString(Define.RANK_SUCCOR)}),this.comboBox.data=n,this.comboBox.select=this._currComboBoxType,this.comboBox.addEventListener(egret.Event.CHANGE,this.onSelectType,this),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.btn_all_yes.label=GameText.STR_MENU_ALL_YES,this.btn_all_no.label=GameText.STR_MENU_ALL_NO,ButtonUtils.addTouchEvent(this.btn_all_yes,this.onAllApply,this,[!0]),ButtonUtils.addTouchEvent(this.btn_all_no,this.onAllApply,this,[!1]),xevent.addEventListener(WorldEvent.COUNTRY_ARMY_SOLDIER_UPDATE,this.updateList,this),this.getSoldierList()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.COUNTRY_ARMY_SOLDIER_UPDATE,this.updateList,this),this.comboBox.removeEventListener(egret.Event.CHANGE,this.onSelectType,this),this._radioGroup.removeEventListener(egret.Event.CHANGE,this.onChangeSoldierList,this),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),ButtonUtils.removeTouchEvent(this.btn_all_yes),ButtonUtils.removeTouchEvent(this.btn_all_no),this._soldierItemList&&(this.clearSoldierItem(),this._soldierItemList=null),this._radioBtns||(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),this._radioBtns=null)},e.prototype.clearSoldierItem=function(){for(var t=0,e=this._soldierItemList.length;e>t;t++)this.removeItem(this._soldierItemList[t],t),t--,e--},e.prototype.clear=function(){this._currComboBoxType=0,this._currRadioSelect=1,this._currSelectItem=0,CountryArmyScene.country.soldierType=this._currRadioSelect},e.prototype.removeItem=function(t,e){Tool.removeObjSafe(this._soldierItemList[e]),t instanceof SoldierItem?ObjectPool.getPool("SoldierItem").returnObject(this._soldierItemList[e]):t instanceof SoldierApplyItem?ObjectPool.getPool("SoldierApplyItem").returnObject(this._soldierItemList[e]):ObjectPool.getPool("SoldierHelpItem").returnObject(this._soldierItemList[e]),this._soldierItemList.splice(e,1)},e.prototype.onChangeSoldierList=function(t){this.clearSoldierItem(),this._currRadioSelect=this._radioGroup.selectedValue,CountryArmyScene.country.soldierType=this._currRadioSelect,this._currRadioSelect==Country.SOLDIER_TYPE_WAR_MENBER?this.currentState=this.MBMBER:this.currentState=this.APPLY,this.getSoldierList()},e.prototype.onSelectType=function(t){this.getSoldierList()},e.prototype.updateList=function(t){this.turnPage.totalPage<=1?this.returnSoldierList(this.allSize-1):this.getSoldierList()},e.prototype.getSoldierList=function(){var t=CountryArmyScene.country;if(t){t.soldierType=this._currRadioSelect,t.soldierRank=this.comboBox.selectData.value;var e=this.pageSize;this._radioGroup.selectedValue==Country.SOLDIER_TYPE_HPLT_APPLY&&(e=4),Country.doGetSoldierList(t,e,this.turnPage.currentPage,this.returnSoldierList,this)}},e.prototype.returnSoldierList=function(t){if(this.stage){this._soldierItemList||(this._soldierItemList=[]);for(var e=CountryArmyScene.country,n=0,i=0,o=e.soldierList.length;o>i;i++){var a,r=e.soldierList[i];if(r&&1!=r.isTabStatus(Model.DEL_STATUS))n<this._soldierItemList.length?a=this._soldierItemList[n]:(a=this.getItem(),this._soldierItemList.push(a)),a.x=9*xhdRatio,a.y=86*xhdRatio+n*a.height,a.data=r,n++,a.parent||this.addChild(a)}if(this.addChild(this.bg),this._soldierItemList)for(o=this._soldierItemList.length;o>n;n++)this.removeItem(this._soldierItemList[n],n),n--,o--;e.soldierList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._currSelectItem>e.soldierList.length-1&&(this._currSelectItem=0),this._radioBtns.add(this._soldierItemList,this._currSelectItem,!0,!0)),this.allSize=t,this.turnPage.totalPage=Math.ceil(t/this.pageSize)}},e.prototype.getItem=function(){var t;return t=this._radioGroup.selectedValue==Country.SOLDIER_TYPE_WAR_MENBER?ObjectPool.getPool("SoldierItem").createObject():this._radioGroup.selectedValue==Country.SOLDIER_TYPE_APPLY?ObjectPool.getPool("SoldierApplyItem").createObject():ObjectPool.getPool("SoldierHelpItem").createObject(),nato.attachSkin(t),t},e.prototype.selectItem=function(t){this._currSelectItem=this._radioBtns.getCurrentIndex();var e=this._radioBtns.getCurentSelectItem().data;if(e.getId()!=xself.getId()){var n=this._radioGroup.selectedValue==Country.SOLDIER_TYPE_WAR_MENBER?Menu.UI_INTO_SOLDIER_LIST:Menu.UI_INTO_SOLDIER_APPLY;PanelManager.openPlayerMenuPanel(e,n)}},e.prototype.onAllApply=function(t){CountryArmyScene.country&&CountryArmyScene.country.soldierList&&CountryArmyScene.country.soldierList.length>0&&Country.doSoldierDealAllApply(CountryArmyScene.country,t)},e.prototype.onTurnPage=function(t){this.getSoldierList()},e}(ComponentBase);__reflect(CountryArmySoldierPanel.prototype,"CountryArmySoldierPanel");var CountryTaskAppointItem=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_detail,this.onBtnDetail,this),ButtonUtils.addTouchEvent(this.btn_appoint,this.onBtnAppoint,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_detail),ButtonUtils.removeTouchEvent(this.btn_appoint)},e.prototype.onBtnDetail=function(){this._countryTask&&AlertPanel.alertTipsCommon(this._countryTask.getCountryMissionDesc())},e.prototype.onBtnAppoint=function(){this._country&&this._countryTask&&Country.doCountryAssignMemList(this._country,this._countryTask)},e.prototype.setData=function(t,e){this._countryTask=t,this._country=e},Object.defineProperty(e.prototype,"countryTask",{get:function(){return this._countryTask},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this.img_select.visible=this._select,this._countryTask?(this.label_name.text=this._countryTask.getCountryMission().name+"("+this._countryTask.level+")",this.label_count.text=this._countryTask.getUpperBoundDesc()):(this.label_name.text="",this.label_count.text=""))},e}(ComponentBase);__reflect(CountryTaskAppointItem.prototype,"CountryTaskAppointItem");var CountryTaskListItem=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._isMyMission=!1,e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onAction=function(){this._countryTask&&this._countryTask.mission},e.prototype.setData=function(t,e,n){void 0===n&&(n=!1),this._type=t,this._countryTask=e,this._isMyMission=n,this.update()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countryTask",{get:function(){return this._countryTask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMyMission",{get:function(){return this._isMyMission},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this.img_select.visible=this._select,this._countryTask&&this._countryTask.mission?(this.label_name.text=this._countryTask.mission.name+"("+this._countryTask.level+")",this.label_count.text=this._countryTask.getUpperBoundDesc(),this.img_missionStatus.source=Mission.getSourceByMissionStatus(this._countryTask.mission.getMissionStatus(xself))):(this.label_name.text="",this.label_count.text="",this.img_missionStatus.source=null))},e}(ComponentBase);__reflect(CountryTaskListItem.prototype,"CountryTaskListItem");var CountryTaskListPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._type=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.reset(),this.reqestData()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),this.onSelectTaskListItem(null)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onTaskListItemTouch=function(t){var n=t.target;this.onSelectTaskListItem(n),n&&n.countryTask&&(this._type==e.Type_Today||this._type==e.Type_Tomorrow?AlertPanel.alertTipsCommon(n.countryTask.getCountryMissionDesc()):n.isMyMission?Country.handleCountryMissionAction(n.countryTask.mission,n.countryTask.countryAssignIds):AlertPanel.alertTipsCommon(n.countryTask.getCountryMissionDesc()))},e.prototype.onSelectTaskListItem=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelect.select=!0)},e.prototype.reqestData=function(){this._type==e.Type_Today?Country.getCountryInfo(this._country,Country.INFO_MISSION):this._type==e.Type_Tomorrow?(this._country=new Country(-1),Country.getCountryMissionInfo(this._country)):this._type==e.Type_Operate&&(this._country=new Country(-1),Country.getCountryValidMission(this._country))},e.prototype.setData=function(t,e){this._type=t,this._country=e},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){var t;if(this.init&&(this._type==e.Type_Today?t=GameText.STR_TODAY_MISSION:this._type==e.Type_Tomorrow?t=GameText.STR_TOMORROW_MISSION:this._type==e.Type_Operate&&(t=GameText.STR_TODAY_MISSION),this.label_title.text=t,this.reset(),null!=this._country)){if(this._country.missionCommonList&&this._country.missionCommonList.length>0)for(var n=0;n<this._country.missionCommonList.length;n++){var i=this._country.missionCommonList[n];if(this._type!=e.Type_Operate||!this._country.isMyMission||1!=Mission.isMissionFinish(xself,i.mission.getId())){var o=this.getItem();o.setData(this._type,i,this._country.isMyMission),this.container.add(o)}}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&((t=new CountryTaskListItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTaskListItemTouch,this),nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e.Type_Today=0,e.Type_Tomorrow=1,e.Type_Operate=2,e}(ComponentBase);__reflect(CountryTaskListPanel.prototype,"CountryTaskListPanel");var EditNameView=function(t){function e(){var e=t.call(this)||this;return e._inputAreaHeight=30,e._maxCount=-1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),ButtonUtils.addTouchEvent(this.btn_cancel,this.onBtnCancel,this),this.input_content.addEventListener(egret.Event.CHANGE,this.onInputChange,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_cancel),this.input_content.removeEventListener(egret.Event.CHANGE,this.onInputChange,this),this._title=null,this._editName=null,this._inputDefaultContent=null,this._okCallbackFunc=null,this._cancelCallbackFunc=null,this._thisObj=null,this._maxCount=-1},e.prototype.onClose=function(){PanelManager.closeEditNameView()},e.prototype.onBtnOk=function(){var t=this.input_content.text;return Tool.isNullText(t)?void AlertPanel.alertCommon("请输入内容"):-1!=t.indexOf("/")?void AlertPanel.alertCommon("内容中含有非法字符串“/”"):(null!=this._okCallbackFunc&&null!=this._thisObj&&this._okCallbackFunc.call(this._thisObj,this.input_content.text),void this.onClose())},e.prototype.onBtnCancel=function(){null!=this._cancelCallbackFunc&&null!=this._thisObj&&this._cancelCallbackFunc.call(this._thisObj),this.onClose()},e.prototype.onInputChange=function(t){if(!(this._maxCount<=0)){var e=this.getLen(this.input_content.text);this.label_count.text="("+e+"/"+this._maxCount+")"}},e.prototype.getLen=function(t){if(null==t||""==t)return 0;for(var e=0,n=0;n<t.length;n++)e+=t.charCodeAt(n)>127?2:1;return e},e.prototype.setData=function(t,e,n,i,o,a,r,s){void 0===r&&(r=30),void 0===s&&(s=-1),this._title=t,this._editName=e,this._inputDefaultContent=n,this._okCallbackFunc=i,this._cancelCallbackFunc=o,this._thisObj=a,this._inputAreaHeight=r,this._maxCount=s},e.prototype.update=function(){this.init&&(this.label_title.text=this._title,this.label_editName.text=this._editName,this.input_content.text=this._inputDefaultContent,this.input_content.height=this._inputAreaHeight,this.height=(220+this._inputAreaHeight)*(xhd?1:.5),this._maxCount>0?(this.input_content.maxChars=this._maxCount,this.label_count.visible=!0,this.label_count.x=this.label_editName.x+this.label_editName.width,this.onInputChange(null)):(this.input_content.maxChars=0,this.label_count.visible=!1))},e}(ComponentBase);__reflect(EditNameView.prototype,"EditNameView");var ManorCityPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_editCityName,this.onEditCityName,this),ButtonUtils.addTouchEvent(this.btn_getMoney,this.onGetMoney,this),ButtonUtils.addTouchEvent(this.btn_editSign,this.onEditSign,this),ButtonUtils.addTouchEvent(this.btn_enterCity,this.onEnterCity,this),this.touchEnabled=!1,ManorScene.from==ManorScene.FROM_NORMAL&&null==this._city&&City.doViewCityInfo(GameWorld.getPlayerID());egret.callLater((function(){GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_CITY_OPEN_UI)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_CITY_OPEN_UI),GameWorld.setGuide(GameWorld.GUIDE_NEW_CITY_ENTER))}),this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_editCityName),ButtonUtils.removeTouchEvent(this.btn_getMoney),ButtonUtils.removeTouchEvent(this.btn_editSign),ButtonUtils.removeTouchEvent(this.btn_enterCity),this.clearSpr(),this._city=null},e.prototype.onEditCityName=function(){this._city&&PanelManager.openEditNameView("修改城市名称","城市名",this._city.cityName,this.onEditCityName_backFunc,null,this,15*xhdRatio,12)},e.prototype.onEditCityName_backFunc=function(t){this._city&&this._city.doCityNameModify(t)},e.prototype.onGetMoney=function(){this._city&&this._city.doGetMoney()},e.prototype.onEditSign=function(){this._city&&PanelManager.openEditNameView("修改城市签名","签名内容",this._city.citySign,this.onEditSign_backFunc,null,this,75*xhdRatio,100)},e.prototype.onEditSign_backFunc=function(t){this._city&&this._city.doCitySignModify(t)},e.prototype.onEnterCity=function(){this._city&&ManorScene.from!=ManorScene.ACTOR_SELL_CITY&&(GameWorld.getCurMapID(),City.doEnterCity(this._city.masterId),PanelManager.closeScene(!0))},e.prototype.setData=function(t){this._city=t},e.prototype.reset=function(){this.init&&(this.clearSpr(),this.btn_editCityName.visible=!1,this.btn_getMoney.visible=!1,this.btn_editSign.visible=!1,this.btn_enterCity.visible=!1,this.label_cityName.text="",this.label_cityLevel.text="",this.label_roleLevel.text="",this.label_master.text="",this.label_status.text="",this.label_country.text="",this.label_camp.text="",this.label_prosperity.text="",this.label_army.text="",this.label_masterSign.text="",this.moneyView.updateMoney(0,0,0))},e.prototype.update=function(){if(this.init){if(null==this._city)return void this.reset();this.clearSpr(),this._city.masterId==GameWorld.getPlayerID()?(this.btn_getMoney.visible=!0,this.btn_editCityName.visible=!0,this.btn_editSign.visible=!0):(this.btn_getMoney.visible=!1,this.btn_editCityName.visible=!1,this.btn_editSign.visible=!1),this.btn_enterCity.visible=!0,this.label_cityName.text=this._city.cityName,this.label_cityLevel.text=this._city.cityScaleName,this.label_roleLevel.text=this._city.masterLevel.toString(),this.label_master.text=this._city.masterName,this.label_status.text=this._city.cityStatusName,Tool.isNullText(this._city.masterCountryName)?this.label_country.text="无":this.label_country.text=this._city.masterCountryName,Tool.isNullText(this._city.masterUnionName)?this.label_camp.text="无":this.label_camp.text=this._city.masterUnionName,this.label_prosperity.text=this._city.prosperityDegree.toString(),this.label_army.text=this._city.armyStrength.toString(),this.label_masterSign.text=this._city.citySign,this.moneyView.updateMoney(this._city.money1,this._city.money2,this._city.money3),this._playerSpr=this._city.getMasterSprite(),this.group_role.addChild(this._playerSpr),this.group_role.touchChildren=this.group_role.touchEnabled=!1}},e.prototype.clearSpr=function(){this.group_role&&this.group_role.removeChildren()},e}(ComponentBase);__reflect(ManorCityPanel.prototype,"ManorCityPanel");var ManorCreatePanel=function(t){function e(){var e=t.call(this)||this;return e._defaultTips="输入国家名",e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,this.label_desc.textFlow=Tool.convertDescToTextFlow(GameText.STR_CREATE_COUNTRY_DESC),this.input_countryName.text="",this.input_countryName.prompt=this._defaultTips,ButtonUtils.addTouchEvent(this.btn_create,this.onBtnCreate,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_create)},e.prototype.onBtnCreate=function(){var t=this.input_countryName.text;return Tool.isNullText(t)||t==this._defaultTips?void AlertPanel.alertCommon("请输入国家名"):void Country.doCreateCountry(t)},e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(ManorCreatePanel.prototype,"ManorCreatePanel");var ManorListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.WAR_DECLARE_NORMAL=1,e.WAR_DECLARE_TEST=2,e.BACK=3,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_check,this.onBtnCheck,this),ButtonUtils.addTouchEvent(this.btn_into,this.onBtnInto,this),ManorScene.from==ManorScene.FROM_NORMAL?this.btn_into.label=GameText.getText(GameText.TI_ENTER):this.btn_into.label=GameText.STR_WAR_DECLARE,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_check),ButtonUtils.removeTouchEvent(this.btn_into)},e.prototype.onBtnCheck=function(){this._country&&Country.getCountryInfo(this._country,Country.INFO_NORMAL,!0)},e.prototype.onBtnInto=function(){if(ManorScene.from==ManorScene.FROM_WAR_DECLARE){var t=[],e=new MenuActionData(GameText.STR_COUNTRY_WAR_REAL,this.WAR_DECLARE_NORMAL);t.push(e),e=new MenuActionData(GameText.STR_COUNTRY_WAR_TEST,this.WAR_DECLARE_TEST),t.push(e),e=new MenuActionData(GameText.getText(GameText.TI_BACK),this.BACK),t.push(e),PanelManager.openFilterMenuPanel(t,this.onMenuSelect,this)}else ManorScene.from==ManorScene.DECLARE_FORCE?this._country.doCommandCreateWarDeclare(this._country):this._country&&Country.doEnterCountry(this._country)},e.prototype.onMenuSelect=function(t){t==this.WAR_DECLARE_NORMAL?(PanelManager.getPanel(ManorScene).listPanel.isGetData=!1,Country.doWarDeclare(this._country,!1)):t==this.WAR_DECLARE_TEST?Country.doWarDeclare(this._country,!0):this.BACK},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._country=t,this.update()},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&(this.img_select.visible=this._select,this._country?(this.label_name.text=this._country.name,this.label_level.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._country.searchBuildingLevel+"")):(this.label_name.text="",this.label_level.text=""))},e}(ComponentBase);__reflect(ManorListItem.prototype,"ManorListItem");var ManorListPanel=function(t){function e(){var e=t.call(this)||this;return e._curPage=0,e._maxPage=0,e._comboBoxSelect=0,e.isGetData=!0,e.isOpenWarinfo=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._comboBoxData){this._comboBoxData=[];for(var n=0;n<Define.buildingText.length;n++)this._comboBoxData.push({value:n,label:Define.buildingText[n]});this.combo_type.data=this._comboBoxData}this.combo_type.select=this._comboBoxSelect,null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5,this.item6,this.item7,this.item8,this.item9]),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.combo_type.addEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this);for(n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.isGetData&&this.onGetData(),this.isGetData=!0},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.combo_type.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.isGetData&&(this._comboBoxSelect=0,this._curSelect&&(this._curSelect.select=!1,this._curSelect=null))},e.prototype.onItemTouch=function(t){var e;t.target instanceof ManorListItem?e=t.target:t.target.parent instanceof ManorListItem&&(e=t.target.parent),this.onSelectItem(e)},e.prototype.onTurnPage=function(t){this._curPage=this.turnPage.currentPage,this.onGetData()},e.prototype.onGetData=function(){null==this._country&&(this._country=new Country(-1),this._curPage=1),this._country.searchBuildingID=this.combo_type.selectData.value,this._country.countryList=[],ManorScene.from==ManorScene.FROM_WAR_DECLARE?Country.doWarDeclareList(this._country,10,this._curPage):ManorScene.from==ManorScene.DECLARE_FORCE?Country.doCommandCreateWarDeclareList(this._country,10,this._curPage):Country.doCountryList(this._country,10,this._curPage)},e.prototype.onComboBoxSearch=function(t){this.onSelectItem(null),this._comboBoxSelect=this.combo_type.select,this.onGetData()},e.prototype.onSelectItem=function(t){this._curSelect&&(this._curSelect.select=!1),this._curSelect=t,this._curSelect&&(this._curSelect.select=!0)},e.prototype.setData=function(t,e){this._country=t,this._maxPage=e,this.update()},e.prototype.reset=function(){this.init},e.prototype.clearItems=function(){for(var t=0;t<this._itemList.length;t++){this._itemList[t].visible=!1}},e.prototype.update=function(){if(this.init){if(this.clearItems(),this._country&&(this.turnPage.setPage(this._curPage,this._maxPage,!1),this._country.countryList&&this._country.countryList.length>0)){for(var t=0;t<this._country.countryList.length;t++){var e=this._itemList[t],n=this._country.countryList[t];e.searchType=this._country.searchBuildingID,e.setData(n),e.visible=!0}this.onSelectItem(this._curSelect?this._curSelect:this._itemList[0])}this.turnPage.setPage(this._curPage,this._maxPage,!1),""==this._country.createwarinfo||ManorScene.from!=ManorScene.DECLARE_FORCE||this.isOpenWarinfo||(this.isOpenWarinfo=!0,AlertPanel.alertCommon(this._country.createwarinfo))}},e}(ComponentBase);__reflect(ManorListPanel.prototype,"ManorListPanel");var ManorManageBuildding=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._isSelf=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ManorManageBuilddingItemList=new Array},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._country=t,this._isSelf=xself.getCountryId()==t.id,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init&&0!=this._country.buildingList.length){this.label_td.text=this._country.freeLand.toString(),this.label_yj.text=this._country.getHaveBuildNum()+"/"+(this._country.freeBuild+this._country.getHaveBuildNum()),this.reset();for(var t=this._country.buildingList.length,e=0;t>e;e++){var n=this.getManorManageMemberItem();n.setData(e,this._country),this.container.add(n,2)}this.container.update()}},e.prototype.getManorManageMemberItem=function(){var t=this._ManorManageBuilddingItemList[this._index];return t||(t=new ManorManageBuilddingItem,nato.attachSkin(t),this._ManorManageBuilddingItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ManorManageBuildding.prototype,"ManorManageBuildding");var ManorManageBuilddingItem=function(t){function e(){var e=t.call(this)||this;return e._isSelf=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_destory,this.onDestory,this),ButtonUtils.addTouchEvent(this.btn_build,this.onBuild,this),ButtonUtils.addTouchEvent(this.btn_detail,this.onDetail,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_destory),ButtonUtils.removeTouchEvent(this.btn_build),ButtonUtils.removeTouchEvent(this.btn_detail)},e.prototype.onDestory=function(){this._country.doCountryBuildingRemove(this._index)},e.prototype.onBuild=function(){this._country.doCountryBuildingUpgrade(this._index)},e.prototype.onDetail=function(){var t=this._country.getBuildingInfo(this._index,!1);AlertPanel.alertCommon(t)},e.prototype.setData=function(t,e){this._index=t,this._country=e,this._isSelf=xself.getCountryId()==e.id,this._buidddingData=this._country.buildingList[this._index],this.update()},e.prototype.update=function(){if(0!=this.init){var t=this._country.getBuildingAttrByIndex(this._index,Country.BUILDING_ID),e=Define.getBuildingText(t),n=this._country.getBuildingAttrByIndex(this._index,Country.BUILDING_LEVEL);this.label_name.textColor=n>=1?16763904:16711692,this.label_name.text=n>=1?e+"("+n+"级)":e+"(未建)",this.btn_destory.visible=n>=1&&this._isSelf,this.btn_build.visible=this._isSelf,this.btn_build.label=n>=1?"升级":"建造"}},e}(ComponentBase);__reflect(ManorManageBuilddingItem.prototype,"ManorManageBuilddingItem");var ManorManageDonate=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.labNameList=[[this.lab_name_11,this.lab_name_12,this.lab_name_13],[this.lab_name_21,this.lab_name_22,this.lab_name_23],[this.lab_name_31,this.lab_name_32,this.lab_name_33],[this.lab_name_41,this.lab_name_42,this.lab_name_43],[this.lab_name_51,this.lab_name_52,this.lab_name_53]],this.labdonateist=[[this.lab_donate_11,this.lab_donate_12,this.lab_donate_13],[this.lab_donate_21,this.lab_donate_22,this.lab_donate_23],[this.lab_donate_31,this.lab_donate_32,this.lab_donate_33],[this.lab_donate_41,this.lab_donate_42,this.lab_donate_43],[this.lab_donate_51,this.lab_donate_52,this.lab_donate_53]],this.imgSelectList=[[this.img_select_11,this.img_select_12,this.img_select_13],[this.img_select_21,this.img_select_22,this.img_select_23],[this.img_select_31,this.img_select_32,this.img_select_33],[this.img_select_41,this.img_select_42,this.img_select_43],[this.img_select_51,this.img_select_52,this.img_select_53]],this.groupTouchList=[[this.group_btn_11,this.group_btn_12,this.group_btn_13],[this.group_btn_21,this.group_btn_22,this.group_btn_23],[this.group_btn_31,this.group_btn_32,this.group_btn_33],[this.group_btn_41,this.group_btn_42,this.group_btn_43],[this.group_btn_51,this.group_btn_52,this.group_btn_53]];for(var n=0;5>n;n++)for(var i=0;3>i;i++)this.labNameList[n][i].text=Define.DONATE_LABEL[n][i][0],this.labdonateist[n][i].text=Define.DONATE_LABEL[n][i][1],this.imgSelectList[n][i].visible=!1,this.groupTouchList[n][i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_donate,this.onDonate,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_donate);for(var n=0;5>n;n++)for(var i=0;3>i;i++)this.imgSelectList[n][i].visible=!1,this.groupTouchList[n][i].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this._donateData=null},e.prototype.onTouch=function(t){for(var e=t.target,n=0;5>n;n++)for(var i=0;3>i;i++)if(this.imgSelectList[n][i].visible=!1,this.groupTouchList[n][i].contains(e)){this.imgSelectList[n][i].visible=!0,this._donateData=Define.DONATE_DATA[n][i];var o=this._donateData&&this._donateData[2]?this._donateData[2]:0,a=xself.countryHonor+PowerString.makeColorString(" +"+o,ColorUtils.COLOR_WHITE);this.label_donate.textFlow=Tool.convertDescToTextFlow(a)}},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t){this._country=t},e.prototype.onDonate=function(){this._donateData&&this._country?Country.doCountryPeopleDonateAction(this._country,this._donateData):AlertPanel.alertCommon("请选择要捐献的材料！")},e.prototype.update=function(){if(0!=this.init){this.label_money1.text=Tool.getMoneyText(xself.money1,Tool.DIVIDE_TEN_THOUSAND),this.label_money3.text=Tool.getMoneyText(xself.money3,Tool.DIVIDE_TEN_THOUSAND),this.label_zy_1.text=Tool.getMoneyText(xself.bag.getItemNumByID(Define.ITEM_ID_WOOD),Tool.DIVIDE_TEN_THOUSAND),this.label_zy_2.text=Tool.getMoneyText(xself.bag.getItemNumByID(Define.ITEM_ID_STONE),Tool.DIVIDE_TEN_THOUSAND),this.label_zy_3.text=Tool.getMoneyText(xself.bag.getItemNumByID(Define.ITEM_ID_IRON),Tool.DIVIDE_TEN_THOUSAND);var t=this._donateData&&this._donateData[2]?this._donateData[2]:0,e=xself.countryHonor+PowerString.makeColorString(" +"+t,ColorUtils.COLOR_WHITE);this.label_donate.textFlow=Tool.convertDescToTextFlow(e)}},e}(ComponentBase);__reflect(ManorManageDonate.prototype,"ManorManageDonate");var ManorManageDonateItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ComponentBase);__reflect(ManorManageDonateItem.prototype,"ManorManageDonateItem");var ManorManageMember=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._currentPage=1,e._pageNum=8,e._allSize=0,e._isSelf=!0,e._currComboBoxType=Define.RANK_NONE,e._currentRadioType=Define.SEARCH_MEM_ALL,e.rankTypeData=[Define.RANK_NONE,Define.RANK_KING,Define.RANK_PRIME,Define.RANK_MARSHAL,Define.RANK_KNIGHT,Define.RANK_COMTE,Define.RANK_VICOMTE,Define.RANK_LORD,Define.RANK_NOBLE,Define.RANK_NATIONAL,Define.RANK_SOLDIER,Define.RANK_SUCCOR],e.typeData=[Define.SEARCH_MEM_ALL,Define.SEARCH_MEM_ONLINE,Define.SEARCH_MEM_UN_ONLINE,Define.SEARCH_MEM_APPLY],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ManorManageMemberItemList=new Array,this._ManorManageMemberItemApplyList=new Array,this._radioGroup||(this._radioGroup=new eui.RadioButtonGroup),this.radioBtnList=[this.radioBtn0,this.radioBtn1,this.radioBtn2,this.radioBtn3];for(var n=0;n<this.radioBtnList.length;n++)this.radioBtnList[n].group=this._radioGroup,this.radioBtnList[n].value=this.typeData[n];this.radioBtnList[0].selected=!0;for(var i=[],o=(n=0,this.rankTypeData.length);o>n;n++)i.push({value:this.rankTypeData[n],label:Define.getRankString(this.rankTypeData[n])});this.comboBox.data=i,this.comboBox.select=this._currComboBoxType,this._radioGroup.addEventListener(egret.Event.CHANGE,this.onChangeType,this),this.comboBox.addEventListener(egret.Event.CHANGE,this.onChangeRankType,this),ButtonUtils.addTouchEvent(this.btn_page_top,this.onPageTop,this),ButtonUtils.addTouchEvent(this.btn_page_down,this.onPageDown,this),ButtonUtils.addTouchEvent(this.btn_agree,this.onAgree,this),ButtonUtils.addTouchEvent(this.btn_refuse,this.onRefuse,this),this.group_btn.visible=this._currentRadioType==Define.SEARCH_MEM_APPLY,this.group_title.visible=!(this._currentRadioType==Define.SEARCH_MEM_APPLY),this.updateRedPoint()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._radioGroup.removeEventListener(egret.Event.CHANGE,this.onChangeType,this),this.comboBox.removeEventListener(egret.Event.CHANGE,this.onChangeRankType,this),ButtonUtils.removeTouchEvent(this.btn_page_top),ButtonUtils.removeTouchEvent(this.btn_page_down),ButtonUtils.removeTouchEvent(this.btn_agree),ButtonUtils.removeTouchEvent(this.btn_refuse);for(var n=0;n<this._index;n++)this._currentList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this._currComboBoxType=Define.RANK_NONE,this._currentRadioType=Define.SEARCH_MEM_ALL,this._currentPage=1,this._country=null},e.prototype.onAgree=function(){Country.doCountryApplyAllDeal(this._country,!0)},e.prototype.onRefuse=function(){Country.doCountryApplyAllDeal(this._country,!1)},e.prototype.onPageTop=function(){this.turnPage(e.TURNP_TYPE_TOP)},e.prototype.onPageDown=function(){this.turnPage(e.TURNP_TYPE_DOWN)},e.prototype.turnPage=function(t){if(e.TURNP_TYPE_TOP==t){var n=this._currentPage-1;if(0>=n)return void AlertPanel.alertCommon("已经是第一页啦！");this._currentPage=n,Country.doCountryMemberList(this._country,this._pageNum,this._currentPage)}else{var i=this._currentPage+1;if(i>this._allSize)return void AlertPanel.alertCommon("已经是最后一页啦！");this._currentPage=i,Country.doCountryMemberList(this._country,this._pageNum,this._currentPage)}},e.prototype.onChangeType=function(t){var e=t.target.selectedValue;(this._currentRadioType=e,this.group_btn.visible=this._currentRadioType==Define.SEARCH_MEM_APPLY,this.group_title.visible=!(this._currentRadioType==Define.SEARCH_MEM_APPLY),this._currentPage=1,this.getMemberInfo(),e==Define.SEARCH_MEM_APPLY&&(xself.setTabStatus(!1,Model.COUNTRY_APPLY),this.updateRedPoint(),PanelManager.isPanelShow(ManorManageScene)))&&PanelManager.getPanel(ManorManageScene).updateRedPoint()},e.prototype.onChangeRankType=function(t){this.comboBox.select,this._currComboBoxType=this.comboBox.selectData.value,this._currentPage=1,this.getMemberInfo()},e.prototype.getMemberInfo=function(){this._country.searchRankID=this._currComboBoxType,this._country.searchMemberStatus=this._currentRadioType,Country.doCountryMemberList(this._country,this._pageNum,this._currentPage)},e.prototype.requestData=function(t){t.searchRankID=this._currComboBoxType,t.searchMemberStatus=this._currentRadioType,Country.doCountryMemberList(t,this._pageNum,this._currentPage)},e.prototype.setData=function(t,e){this._country=t,this._isSelf=xself.getCountryId()==t.id;var n=e%this._pageNum==0,i=Math.floor(e/this._pageNum);this._allSize=0==e?1:n?i:i+1,this.update()},e.prototype.getAllSize=function(){return this._allSize},e.prototype.reset=function(){this.container.reset();for(var t=0;t<this._index;t++)this._currentList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this._index=0},e.prototype.update=function(){if(0!=this.init&&null!=this._country.memberList){this.radioBtn3.visible=this._isSelf,this.reset(),this.label_page.text=this._currentPage+"/"+this._allSize;for(var t=this._country.memberList.length,e=0;t>e;e++)if(null!=this._country.memberList[e]){var n=this.getManorManageItem();n.setData(this._country,this._country.memberList[e]),this.container.add(n,6)}this.container.update();var i=this._currentRadioType==Define.SEARCH_MEM_APPLY;this._currentList=i?this._ManorManageMemberItemApplyList:this._ManorManageMemberItemList;for(e=0;e<this._index;e++)i?this._currentList[e].group_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this):this._currentList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)}},e.prototype.onTouch=function(t){for(var e,n=t.target,i=0;i<this._currentList.length;i++)this._currentList[i].select=!1,this._currentList[i].contains(n)&&(this._currentList[i].select=!0,e=this._country.memberList[i]);if(e.getId()!=xself.getId()){var o=xself.getCountryRank();o==Define.RANK_KING?PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_COUNTRY_MEM2):o==Define.RANK_PRIME?PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_COUNTRY_MEM3):o==Define.RANK_MARSHAL?PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_COUNTRY_MEM4):o==Define.RANK_KNIGHT?PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_COUNTRY_MEM5):PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_COUNTRY_MEM1)}},e.prototype.getManorManageItem=function(){var t;return this._currentRadioType==Define.SEARCH_MEM_APPLY?(t=this._ManorManageMemberItemApplyList[this._index])||(t=new ManorManageMemberApplyItem,nato.attachSkin(t),this._ManorManageMemberItemApplyList[this._index]=t):(t=this._ManorManageMemberItemList[this._index])||(t=new ManorManageMemberItem,nato.attachSkin(t),this._ManorManageMemberItemList[this._index]=t),this._index++,t},e.prototype.updateRedPoint=function(){this.radioBtn3&&this.radioBtn3.visible&&xself.isTabStatus(Model.COUNTRY_APPLY)?RedPoint.addRedPoint(this.radioBtn3,0,0):RedPoint.removeRedPoint(this.radioBtn3)},e.TURNP_TYPE_TOP=1,e.TURNP_TYPE_DOWN=2,e}(ComponentBase);__reflect(ManorManageMember.prototype,"ManorManageMember");var ManorManageMemberApplyItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_agree,this.onAgree,this),ButtonUtils.addTouchEvent(this.btn_refuse,this.onRefuse,this),this.img_select.visible=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_agree),ButtonUtils.removeTouchEvent(this.btn_refuse)},e.prototype.onAgree=function(){Country.doCountryApplyDeal(this._country,this._listPlayer,!0)},e.prototype.onRefuse=function(){Country.doCountryApplyDeal(this._country,this._listPlayer,!1)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e){this._listPlayer=e,this._country=t,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_name.text=this._listPlayer.getName(),this.lable_position.text=Define.getRankString(this._listPlayer.getCountryRank()),this.label_job.text=this._listPlayer.getLevel()+Define.getJobString(this._listPlayer.getJob()))},e}(ComponentBase);__reflect(ManorManageMemberApplyItem.prototype,"ManorManageMemberApplyItem");var ManorManageMemberItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.img_select.visible=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e){this._listPlayer=e,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_name.text=this._listPlayer.getName(),this.lable_position.text=Define.getRankString(this._listPlayer.getCountryRank()),this.label_job.text=this._listPlayer.getLevel()+Define.getJobString(this._listPlayer.getJob()),this.label_gxz.text=this._listPlayer.countryHonor.toString(),this.label_zls.text=this._listPlayer.countryBookNum.toString(),this.label_time.text=this._listPlayer.getOnlineDesc())},e}(ComponentBase);__reflect(ManorManageMemberItem.prototype,"ManorManageMemberItem");var ManorManagePower=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ManorManagePowerItemList=new Array,this.checkbox_zm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecruit,this),this.checkbox_tz.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLine,this),ButtonUtils.addTouchEvent(this.btn_tax,this.onChangeTax,this),ButtonUtils.addTouchEvent(this.btn_enter,this.onEnter,this),ButtonUtils.addTouchEvent(this.btn_do,this.onDo,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.checkbox_zm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecruit,this),this.checkbox_tz.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLine,this),ButtonUtils.removeTouchEvent(this.btn_tax),ButtonUtils.removeTouchEvent(this.btn_enter),ButtonUtils.removeTouchEvent(this.btn_do)},e.prototype.onRecruit=function(){this._country.doCountryRecruit(this.checkbox_zm.selected)},e.prototype.onLine=function(){this._country.doCountrySetOnlineNotify(this.checkbox_tz.selected)},e.prototype.onChangeTax=function(){this._country.doCountryTaxRateModify()},e.prototype.onEnter=function(){this._country.doCountryEnterRateModify()},e.prototype.onDo=function(){var t=PanelManager.getPanel(ManorManageScene,!1);t&&t.setIndex(ManorManageScene.TAB_INDEX_MEMBER)},e.prototype.setData=function(t){this._country=t,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(0!=this.init){this.reset(),this.checkbox_zm.selected=this._country.isOpenRecruit,this.checkbox_tz.selected=this._country.onlineNotify,this.label_tax.text=this._country.taxRate.toString(),this.label_rj_money0.text=Tool.getMoneyText(this._country.entryTaxMoney1,Tool.DIVIDE_TEN_THOUSAND),this.label_rj_money3.text=Tool.getMoneyText(this._country.entryTaxMoney3,Tool.DIVIDE_TEN_THOUSAND),this.lable_zls.text="特殊指令(指令书"+this._country.bookNum.toString()+")";var t=30==this._country.coolKingChange&&xself.getCountryRank()==Define.RANK_KING;this.btn_do.label=t?"执行":"冷却中",this.label_cool_time.text=t?GameText.STR_EXECUTEABLE:Tool.manageString(GameText.STR_COUNTRY_DATE_COOL,this._country.coolKingChange+"");for(var e=this._country.commandCoolList.length,n=0;e>n;n++){var i=this.getManorManagePowerItem();i.setData(this._country.commandCoolList[n],n+1,this._country),this.container.add(i,4)}this.container.update()}},e.prototype.getManorManagePowerItem=function(){var t=this._ManorManagePowerItemList[this._index];return t||(t=new ManorManagePowerItem,nato.attachSkin(t),this._ManorManagePowerItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ManorManagePower.prototype,"ManorManagePower");var ManorManagePowerItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_do,this.onDo,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_do)},e.prototype.onDo=function(){this._commandType==Define.COUNTRY_COMMAND_CHANGE_NAME?this._country.doCountryChangeName(Define.COUNTRY_COMMAND_CHANGE_NAME):this._commandType==Define.COUNTRY_COMMAND_TRANSFER_RESOURCE?this._country.getLoadResourseData():this._commandType==Define.COUNTRY_COMMAND_KING_COMMAND?this._country.doCountryKingCommand(this._commandType):this._commandType==Define.COUNTRY_COMMAND_CREATE_WAR?PanelManager.openManorScene(2,ManorScene.DECLARE_FORCE):this._country.doCountryBookUse(this._commandType)},e.prototype.setData=function(t,e,n){this._commandCoolData=t,this._country=n,this._isCool=this._commandCoolData[0],this._coolTime=this._commandCoolData[1],this._commandType=e,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_title.text=Define.getCountryBookText(this._commandType),this.lebel_cool_time.text=Tool.getTimeStrByMin(this._coolTime,!0),this.btn_do.label=this._isCool?"冷却中":"执行")},e}(ComponentBase);__reflect(ManorManagePowerItem.prototype,"ManorManagePowerItem");var ManorManageResourse=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._ManorManageResourseItemList=new Array,e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.btn_tab1,this.btn_tab2,this.btn_tab3];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_charge,this.onCharge,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_charge)},e.prototype.onCharge=function(){this._chargeData?Country.doCountryResourseAction(this._country,this._chargeData):AlertPanel.alertCommon("请选择需要兑换的资源！")},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e,n){this._textArray=e,this._objArray=n,this._country=t,this.update()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.reset=function(){this.container.reset();for(var t=0;t<this._index;t++)this._ManorManageResourseItemList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this._index=0,this._chargeData=null},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.reset();for(var t=this._textArray[this._tabIndex].length,e=0;t>e;e++){var n=this.getManorManagePowerItem();this.container.add(n),n.setData(this._country,this._textArray[this._tabIndex][e])}for(e=0;e<this._index;e++)this._ManorManageResourseItemList[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.container.update()},e.prototype.onTouch=function(t){for(var e=t.target,n=0;n<this._ManorManageResourseItemList.length;n++)this._ManorManageResourseItemList[n].select=!1,this._ManorManageResourseItemList[n].contains(e)&&(this._ManorManageResourseItemList[n].select=!0,this._chargeData=this._objArray[this._tabIndex][n])},e.prototype.update=function(){0!=this.init&&null!=this._textArray&&null!=this._objArray&&(this.label_money1.text=Tool.getMoneyText(this._country.money1,Tool.DIVIDE_TEN_THOUSAND),this.label_money3.text=Tool.getMoneyText(this._country.money3,Tool.DIVIDE_TEN_THOUSAND),this.label_zy_1.text=this._country.getWood(),this.label_zy_2.text=this._country.getStone(),this.label_zy_3.text=this._country.getIron(),this.updateTab())},e.prototype.getManorManagePowerItem=function(){var t=this._ManorManageResourseItemList[this._index];return t||(t=new ManorManageResourseItem,nato.attachSkin(t),this._ManorManageResourseItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ManorManageResourse.prototype,"ManorManageResourse");var ManorManageResourseItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.img_select.visible=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.select=!1},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e){this._country=t,this._strdata=e,this.update()},e.prototype.update=function(){this.label_1.text=this._strdata[0],this.label_2.text=this._strdata[1]},e}(ComponentBase);__reflect(ManorManageResourseItem.prototype,"ManorManageResourseItem");var ManorManageScene=function(t){function e(){var e=t.call(this)||this;return e._tabSelfIndex=0,e._tabOtherIndex=0,e._isSelf=!0,e._isSeeOther=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.btn_tab0,this.btn_tab1,this.btn_tab2,this.btn_tab3,this.btn_tab4];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn0,this.onClose,this),this.updateTab(),this.updateRedPoint(),this.show()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn0)},e.prototype.onClose=function(){PanelManager.closeScene(),this.tabIndex=0,this._isSeeOther=!1},Object.defineProperty(e.prototype,"tabIndex",{get:function(){return this._isSeeOther?this._tabOtherIndex:this._tabSelfIndex},set:function(t){this._isSeeOther?this._tabOtherIndex=t:this._tabSelfIndex=t},enumerable:!0,configurable:!0}),e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this.tabIndex&&(this.tabIndex=n,this.updateTab())},e.prototype.updateTab=function(){if(ButtonUtils.selectTabBtnList(this._tabBtnList,this.tabIndex),this.removeAllPanel(),null!=this.getCountry()){if(this.tabIndex==e.TAB_INDEX_COUNTY&&(this.addChild(this.manroManageCountry),this._isSeeOther||Country.doViewCountryInfo2(xself.getCountryId())),this.tabIndex==e.TAB_INDEX_MEMBER){this.addChild(this.manorManageMember);var t=this.getCountry();this.manorManageMember.requestData(t)}this.tabIndex==e.TAB_INDEX_BUILDING&&(this.addChild(this.manorManageBuildding),Country.getCountryBuildingInfo(this.getCountry())),this.tabIndex==e.TAB_INDEX_TASK&&(this.addChild(this.manorManageTask),Country.getCountryMainMenu(this.getCountry(),!1)),this.tabIndex==e.TAB_INDEX_POWER&&(this.addChild(this.manorManagePower),Country.getCountryInfo(this.getCountry(),Country.INFO_COMMAND))}},e.prototype.setIndex=function(t){this.tabIndex=t,this.updateTab()},e.prototype.setCountryData=function(t,e){void 0===e&&(e=!1),this.setCountry(t),this._isSeeOther=xself.getCountryId()!=t.id,this.manroManageCountry&&this.manroManageCountry.setData(t)},e.prototype.getSeeOther=function(){return this._isSeeOther},e.prototype.setSeeOther=function(t){this._isSeeOther=t},e.prototype.setMemberData=function(t,e){this.setCountry(t),this.manorManageMember&&this.manorManageMember.setData(t,e)},e.prototype.setBuilddingData=function(t){this.setCountry(t),this.manorManageBuildding&&this.manorManageBuildding.setData(t)},e.prototype.setTaskData=function(t){this.setCountry(t),this.manorManageTask&&this.manorManageTask.setData(t)},e.prototype.setPowerData=function(t){this.setCountry(t),this.manorManagePower&&this.manorManagePower.setData(t)},e.prototype.setCountry=function(t){this._isSelf=xself.getCountryId()==t.id,this._isSelf?this._countrySelf=t:this._countryOther=t,this.stage&&this.show()},e.prototype.getCountry=function(){return this._isSeeOther?this._countryOther:this._countrySelf},e.prototype.getIsSelf=function(){return this._isSelf},e.prototype.show=function(){this._tabBtnList[3].visible=this._isSelf,this._tabBtnList[4].visible=this._isSelf},e.prototype.removeAllPanel=function(){this.manroManageCountry&&this.manroManageCountry.parent&&this.manroManageCountry.parent.removeChild(this.manroManageCountry),this.manorManageMember&&this.manorManageMember.parent&&this.manorManageMember.parent.removeChild(this.manorManageMember),this.manorManageBuildding&&this.manorManageBuildding.parent&&this.manorManageBuildding.parent.removeChild(this.manorManageBuildding),this.manorManageTask&&this.manorManageTask.parent&&this.manorManageTask.parent.removeChild(this.manorManageTask),this.manorManagePower&&this.manorManagePower.parent&&this.manorManagePower.parent.removeChild(this.manorManagePower)},e.prototype.updateRedPoint=function(){this.btn_tab1&&this.btn_tab1.visible&&xself.isTabStatus(Model.COUNTRY_APPLY)?RedPoint.addRedPoint(this.btn_tab1):RedPoint.removeRedPoint(this.btn_tab1)},e.TAB_INDEX_COUNTY=0,e.TAB_INDEX_MEMBER=1,e.TAB_INDEX_BUILDING=2,e.TAB_INDEX_TASK=3,e.TAB_INDEX_POWER=4,e}(ComponentBase);__reflect(ManorManageScene.prototype,"ManorManageScene");var ManorManageTask=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ManorManageTaskTypeItemList=new Array,ButtonUtils.addTouchEvent(this.btn_today,this.onTaskToday,this),ButtonUtils.addTouchEvent(this.btn_tomorrow,this.onTaskTomorrow,this),xevent.addEventListener(WorldEvent.MANOR_TASK_DOT,this.updateDotEvent,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_today),ButtonUtils.removeTouchEvent(this.btn_tomorrow),xevent.removeEventListener(WorldEvent.MANOR_TASK_DOT,this.updateDotEvent,this)},e.prototype.onTaskToday=function(){PanelManager.openCountryTaskListPanel(CountryTaskListPanel.Type_Today,this._country)},e.prototype.onTaskTomorrow=function(){PanelManager.openCountryTaskListPanel(CountryTaskListPanel.Type_Tomorrow,this._country)},e.prototype.setData=function(t){this._country=t,this.usePoint=this._country.usePoint,this.update()},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.updateDotEvent=function(t){t.param?++this.usePoint:--this.usePoint,this.updateDot(this.usePoint)},e.prototype.updateDot=function(t){this.label_task_dot.text=t+"/"+this._country.issuePoint},e.prototype.update=function(){if(0!=this.init&&0!=this._country.taskMainType.length){this.reset(),this.label_task_dot.text=this._country.usePoint+"/"+this._country.issuePoint;for(var t=this._country.taskMainType.length,e=0;t>e;e++){var n=this.getManorManageMemberItem();n.setData(this._country,this._country.taskMainType[e]),this.container.add(n,4)}this.container.update()}},e.prototype.getManorManageMemberItem=function(){var t=this._ManorManageTaskTypeItemList[this._index];return t||(t=new ManorManageTaskTypeItem,nato.attachSkin(t),this._ManorManageTaskTypeItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ManorManageTask.prototype,"ManorManageTask");var ManorManageTaskRelease=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._ManorManageTaskReleaseItemList=new Array,ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_onekey,this.onOneKey,this),xevent.addEventListener(WorldEvent.MANOR_TASK_DOT,this.updateDot,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_onekey),xevent.removeEventListener(WorldEvent.MANOR_TASK_DOT,this.updateDot,this)},e.prototype.onClose=function(){0==this._country.isSameIdPublicList()?AlertPanel.alert(GameText.STR_PUBLISH_MISSION,GameText.STR_PUBLISH_COUNTRY_MISSION_ASK,(function(){Country.doCountryPublishMission(this._missionType,this._country)}),this):PanelManager.closeManorManageTaskReleasePanel()},e.prototype.onOneKey=function(){Country.doCountryPublishMission(this._missionType,this._country)},e.prototype.setData=function(t,e,n){this._countryTaskList=t,this._country=e,this.usePoint=this._country.usePoint,this._missionType=n},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.updateDot=function(t){t.param?this.label_task_dot.text=++this.usePoint+"/"+this._country.issuePoint:this.label_task_dot.text=--this.usePoint+"/"+this._country.issuePoint},e.prototype.getUsePoint=function(){return this.usePoint},e.prototype.update=function(){if(0!=this.init){this.reset(),this.label_task_dot.text=this._country.usePoint+"/"+this._country.issuePoint,this.label_title.text=Define.getBuildingText2(this._missionType);for(var t=this._countryTaskList.length,e=0;t>e;e++){var n=this.getManorManageMemberItem();n.setData(this._countryTaskList[e],this.usePoint,this._country.issuePoint),this.container.add(n,6)}this.container.update()}},e.prototype.getManorManageMemberItem=function(){var t=this._ManorManageTaskReleaseItemList[this._index];return t||(t=new ManorManageTaskReleaseItem,nato.attachSkin(t),this._ManorManageTaskReleaseItemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ManorManageTaskRelease.prototype,"ManorManageTaskRelease");var ManorManageTaskReleaseItem=function(t){function e(){var e=t.call(this)||this;return e._usePoint=0,e._allPoint=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_look,this.onLook,this),this.btn_select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onSelect=function(){var t=PanelManager.getPanel(ManorManageTaskRelease).getUsePoint();return this.btn_select.selected?t++:t--,t>this._allPoint?(this.btn_select.selected=!1,void AlertPanel.alertCommon("任务点不足！")):(this._countryTask.select=this.btn_select.selected,void xevent.dispatchEvent(new WorldEvent(WorldEvent.MANOR_TASK_DOT,this.btn_select.selected)))},e.prototype.onLook=function(){AlertPanel.alertTipsCommon(this._countryTask.getCountryMissionDesc())},e.prototype.setData=function(t,e,n){this._countryTask=t,this._usePoint=e,this._allPoint=n,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_task.text=this._countryTask.mission.name+"("+this._countryTask.level+")",this.label_times.text=this._countryTask.rightNum.toString(),this.btn_select.selected=this._countryTask.select)},e}(ComponentBase);__reflect(ManorManageTaskReleaseItem.prototype,"ManorManageTaskReleaseItem");var ManorManageTaskTypeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_release,this.onRelease,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_release)},e.prototype.onRelease=function(){this._country.doCountryMissionList(this._itemData[0])},e.prototype.setData=function(t,e){this._country=t,this._itemData=e,this.update()},e.prototype.update=function(){0!=this.init&&(this.label_type.text=Define.getBuildingText2(this._itemData[0])+"("+this._itemData[1]+")")},e}(ComponentBase);__reflect(ManorManageTaskTypeItem.prototype,"ManorManageTaskTypeItem");var ManorScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e._tabIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),this._tabBtnList=[this.tabBtn_city,this.tabBtn_status,this.tabBtn_list];for(var i=0;i<this._tabBtnList.length;i++){this._tabBtnList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.tabBtn_status.label="我的国家",e.from==e.FROM_WAR_DECLARE||e.from==e.DECLARE_FORCE?(Tool.removeObjSafe(this.tabBtn_status),Tool.removeObjSafe(this.tabBtn_city)):e.from==e.FROM_OTHER_CITY||e.from==e.ACTOR_SELL_CITY?(Tool.removeObjSafe(this.tabBtn_status),Tool.removeObjSafe(this.tabBtn_list)):e.from==e.ACTOR_SELL_COUNTRY?(Tool.removeObjSafe(this.tabBtn_city),Tool.removeObjSafe(this.tabBtn_list),this.tabBtn_status.label="国家状态"):(this.tabBtn_group.addChild(this.tabBtn_status),this.tabBtn_group.addChild(this.tabBtn_city),this.tabBtn_group.addChild(this.tabBtn_list)),this.updateTab(),this.updateCountryRedPoint()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this.statusPanel.setData(null)},e.prototype.onClose=function(){(e.from==e.FROM_WAR_DECLARE||e.from==e.DECLARE_FORCE)&&(this._tabIndex=e.TAB_INDEX_STATUS),e.from=e.FROM_NORMAL,PanelManager.closeScene(),this.listPanel.isOpenWarinfo=!1},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTab=function(t){this._tabIndex=t},e.prototype.updateTab=function(){if(ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_CITY)this.addChild(this.cityPanel),this.cityPanel.update();else if(this._tabIndex==e.TAB_INDEX_STATUS){var t=xself.getCountryId()>0;e.from==e.ACTOR_SELL_COUNTRY||t?this.addChild(this.statusPanel):(this.addChild(this.createPanel),this.createPanel.update())}else this._tabIndex==e.TAB_INDEX_LIST&&(this.addChild(this.listPanel),this.listPanel.update())},e.prototype.removeAllPanel=function(){this.cityPanel&&this.cityPanel.parent&&this.cityPanel.parent.removeChild(this.cityPanel),this.statusPanel&&this.statusPanel.parent&&this.statusPanel.parent.removeChild(this.statusPanel),this.listPanel&&this.listPanel.parent&&this.listPanel.parent.removeChild(this.listPanel),this.createPanel&&this.createPanel.parent&&this.createPanel.parent.removeChild(this.createPanel)},e.prototype.setCityData=function(t){this.cityPanel&&(this.cityPanel.setData(t),this.cityPanel.update()),t&&t.masterId!=xself.getId()?(Tool.removeObjSafe(this.tabBtn_status),Tool.removeObjSafe(this.tabBtn_list),this.tabBtn_city.label="城市"):(this.tabBtn_city.label="我的城市",this.tabBtn_status.parent||this.tabBtn_group.addChild(this.tabBtn_status),this.tabBtn_list.parent||this.tabBtn_group.addChild(this.tabBtn_list))},e.prototype.updateCountryStatus=function(t){this.statusPanel&&this.statusPanel.setData(t)},e.prototype.updateCountryList=function(t,e){this.listPanel&&this.listPanel.setData(t,e)},e.prototype.updateCountryRedPoint=function(){this.tabBtn_status&&this.tabBtn_status.visible&&xself.isTabStatus(Model.COUNTRY_APPLY)?RedPoint.addRedPoint(this.tabBtn_status):RedPoint.removeRedPoint(this.tabBtn_status)},e.TAB_INDEX_CITY=0,e.TAB_INDEX_STATUS=1,e.TAB_INDEX_LIST=2,e.FROM_WAR_DECLARE=1,e.FROM_NORMAL=2,e.FROM_OTHER_CITY=3,e.DECLARE_FORCE=4,e.ACTOR_SELL_COUNTRY=5,e.ACTOR_SELL_CITY=6,e.from=e.FROM_NORMAL,e}(ComponentBase);__reflect(ManorScene.prototype,"ManorScene");var ManorStatusPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update(),this._country&&this._country.sellPlayer||(ButtonUtils.addTouchEvent(this.btn_manager,this.onBtnManager,this),ButtonUtils.addTouchEvent(this.btn_war,this.onBtnWar,this),ButtonUtils.addTouchEvent(this.btn_editNotify,this.onBtnEditNotify,this),ButtonUtils.addTouchEvent(this.btn_action,this.onBtnAction,this)),null==this._country&&xself.getCountryId()>0&&Country.doViewCountryStatus(xself.getCountryId())},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_manager),ButtonUtils.removeTouchEvent(this.btn_war),ButtonUtils.removeTouchEvent(this.btn_editNotify),ButtonUtils.removeTouchEvent(this.btn_action)},e.prototype.onBtnManager=function(){PanelManager.openManorManagerScene(this._country,!1)},e.prototype.onBtnWar=function(){PanelManager.openCountryArmyScene()},e.prototype.onBtnEditNotify=function(){this._country&&PanelManager.openEditNameView("修改国家公告","公告内容",this._country.affiche,this.onEditNotify_backFunc,null,this,75*xhdRatio,100)},e.prototype.onEditNotify_backFunc=function(t){this._country&&this._country.doCountryAfficheModify(t)},e.prototype.onBtnAction=function(){this._country&&(this._country.getStatus()==Country.STATUS_INACTIVE?Country.doCountryActive(this._country.id,this._country):Country.doEnterCountry(this._country))},e.prototype.setData=function(t){this._country=t,this.update()},e.prototype.reset=function(){this.init&&(this.label_countryName.text="",this.label_class.text="",this.label_taxRate.text="",this.label_contribution.text="",this.label_bookNum.text="",this.label_prosperous.text="",this.label_notify.text="",this.btn_action.visible=!1,RedPoint.removeRedPoint(this.btn_manager))},e.prototype.update=function(){this.init&&(this._country?(this.label_countryName.text=this._country.name+"("+this._country.getScale()+"级)",this.label_class.text=xself.getCountryRankStr(),this.label_taxRate.text=this._country.taxRate+"%",this.label_contribution.text=xself.countryHonor+"",this.label_bookNum.text=this._country.myBookNum+"",this.label_prosperous.text=this._country.prosperity+"/"+this._country.prosperityMax,this.label_member.text=this._country.allPeopleNum+"/"+this._country.maxPeopleNum,this.label_notify.text=this._country.affiche,this.btn_action.visible=!0,this._country.getStatus()==Country.STATUS_INACTIVE?this.btn_action.label="激活":this.btn_action.label="进入国家",xself.isTabStatus(Model.COUNTRY_APPLY)?RedPoint.addRedPoint(this.btn_manager):RedPoint.removeRedPoint(this.btn_manager)):this.reset())},e}(ComponentBase);__reflect(ManorStatusPanel.prototype,"ManorStatusPanel");var ManroManageCountry=function(t){function e(){var e=t.call(this)||this;return e._isSelf=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.show(),ButtonUtils.addTouchEvent(this.btn_jz,this.onBtnjz,this),ButtonUtils.addTouchEvent(this.btn_tc,this.onBtntc,this),this.update(),GameWorld.isCountryWarStatus()?this.btn_tc.enabled=!1:this.btn_tc.enabled=!0,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_jz),ButtonUtils.removeTouchEvent(this.btn_tc)},e.prototype.setData=function(t){this._country=t,this._isSelf=xself.getCountryId()==t.id,this.update()},e.prototype.onBtnjz=function(){this._isSelf?PanelManager.openManorManageDonate(this._country):this._country.doCountryApply()},e.prototype.onBtntc=function(){this._isSelf?Country.doLeaveCountry(this._country):Country.doEnterCountry(this._country)},e.prototype.show=function(){this._isSelf?(this.btn_jz.label="捐赠物质",this.btn_tc.label="退出国家"):(this.btn_jz.label="申请加入",this.btn_tc.label="进入国家")},e.prototype.update=function(){0!=this.init&&null!=this._country&&(this.label_cityName0.text=this._country.name+"("+this._country.getScale()+"级)",this.label_nc.text=this._country.name,this.label_gxzls.text=this._country.myBookNum.toString(),this.label_gjcy.text=this._country.allPeopleNum+"/"+this._country.maxPeopleNum,this.label_frd.text=this._country.prosperity.toString()+"/"+this._country.prosperityMax,this.label_sqrs.text=this._country.applyPeopleNum.toString(),this.label_gzsl.text=this._country.warWinRate+"%",this.label_sl.text=this._country.taxRate.toString(),this.label_dj.text=this._country.getScale().toString(),this.label_jlz.text=this._country.armyStrength.toString(),this.label_zls.text=this._country.bookNum.toString(),this.label_sssl.text=this._country.unionName,this.label_gzcs.text=this._country.warCount.toString(),this.label_kytd.text=this._country.freeLand.toString(),this.label_rj_money1.text=Tool.getMoneyText(this._country.entryTaxMoney1,Tool.DIVIDE_TEN_THOUSAND),this.label_rj_money3.text=Tool.getMoneyText(this._country.entryTaxMoney3,Tool.DIVIDE_TEN_THOUSAND),this.label_gk_money1.text=this._country.getMoney1(),this.label_gk_money2.text=this._country.getMoney2(),this.label_gk_money3.text=this._country.getMoney3(),this.label_zy_1.text=this._country.getWood(),this.label_zy_2.text=this._country.getStone(),this.label_zy_3.text=this._country.getIron())},e}(ComponentBase);__reflect(ManroManageCountry.prototype,"ManroManageCountry");var MyUnionItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._country=null,this.btn_yes.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNo,this),this.btn_no.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNo,this)},Object.defineProperty(e.prototype,"data",{get:function(){return this._country},set:function(t){this._country=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.initPanel=function(){this.label_name.text=this._country.getUnionInfo3(),this._country.isApplyUnion()?(Tool.removeObjSafe(this.label_status),this.addChild(this.btn_yes),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onYes,this),this.addChild(this.btn_no),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNo,this)):(Tool.removeObjSafe(this.btn_yes),Tool.removeObjSafe(this.btn_no),this.addChild(this.label_status),this.label_status.text=Country.getUnionStatusText(this._country.getStatus()))},e.prototype.onYes=function(t){t.stopImmediatePropagation(),ButtonUtils.buttonTweenEffect(t.currentTarget),Country.doDealApplyUnion(CountryArmyScene.country,this._country,!0,this)},e.prototype.onNo=function(t){t.stopImmediatePropagation(),ButtonUtils.buttonTweenEffect(t.currentTarget),Country.doDealApplyUnion(CountryArmyScene.country,this._country,!1,this)},e}(ComponentBase);__reflect(MyUnionItem.prototype,"MyUnionItem");var MyUnionPanel=function(t){function e(){var e=t.call(this)||this;return e.isGetMyUnion=!0,e.EVENT_UNIONLIB_MYUNION_LIB_YES=14218,e.EVENT_UNIONLIB_MYUNION_LIB_NO=14219,e.EVENT_UNIONLIB_MYUNION_LIB_VIEW=14220,e.EVENT_ALL_UNION_APPLY_HELP=30110,e.EVENT_ALL_UNION_DEL_MENBER=30107,e.EVENT_ALL_UNION_CHANGE=30108,e.EVENT_UNIONLIB_MYUNION_LIB_VIEW_FIGHT=14290,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_create),ButtonUtils.removeTouchEvent(this.btn_quit_union),xevent.removeEventListener(WorldEvent.MY_UNION_UPDATE,this.applyUnionBack,this),this._unionList){for(var n=0,i=this._unionList.length;i>n;n++)this.removeItem(n);this._unionList=null}this.isGetMyUnion=!0,this.scroll.reset(),this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.onSelectUnion,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null)},e.prototype.removeItem=function(t){Tool.removeObjSafe(this._unionList[t]),ObjectPool.getPool("MyUnionItem").returnObject(this._unionList[t])},e.prototype.partAdded=function(t,e){switch(t){case"btn_quit_union":this.btn_quit_union.label=GameText.STR_UNION_LEAVE;break;case"label_unionName":this.label_unionName.text="";break;case"label_create_info":this.label_create_info.text="";break;case"btn_create":this.btn_create.label=GameText.STR_TYPE_CREATE_UNION}},e.prototype.update=function(){CountryArmyScene.country&&(this.isGetMyUnion?(this.isGetMyUnion=!1,Country.doGetMyUnion(CountryArmyScene.country,this.myUnionListBack,this)):this.myUnionListBack())},e.prototype.myUnionListBack=function(){var t=CountryArmyScene.country;if(t.leagueid&&t.leagueid>0){this.currentState="list",this.scroll.reset(),xevent.addEventListener(WorldEvent.MY_UNION_UPDATE,this.applyUnionBack,this),this.label_unionName.text=CountryArmyScene.country.unionName,this.btn_quit_union.label=GameText.STR_UNION_LEAVE,ButtonUtils.addTouchEvent(this.btn_quit_union,this.onQuitUnion,this),this._unionList||(this._unionList=[]);for(var e=0,n=0;null!=t.myUnionList&&n<t.myUnionList.length;n++){var i,o=t.myUnionList[n];if(null!=o)e<this._unionList.length?i=this._unionList[e]:(i=ObjectPool.getPool("MyUnionItem").createObject(),nato.attachSkin(i),this._unionList.push(i)),i.data=o,this.scroll.add(i),e++}if(this.scroll.update(),this._unionList)for(n=this._unionList.length;n>e;e++)this.removeItem(e),e--,n--;this._unionList&&this._unionList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.onSelectUnion,this)),this._radioBtns.add(this._unionList,-1,!0,!0))}else{this.currentState="create";this.label_create_info.textFlow=Tool.convertDescToTextFlow(Tool.manageStringList(GameText.STR_CREATE_UNION_INFO,[PowerString.makeColorString(GameText.STR_MONEY1+100,ColorUtils.COLOR_YELLOW)+"  "+PowerString.makeColorString(GameText.STR_MONEY3+1e6,ColorUtils.COLOR_MONEY3)+"  ","5"])),ButtonUtils.addTouchEvent(this.btn_create,this.onCreate,this)}},e.prototype.onSelectUnion=function(t){var e,n="",i=[],o=this._radioBtns.getCurentSelectItem();if(null!=o){var a=o.data.getStatus();n=o.data.getWarFightInfo(),e=new MenuActionData(o.data.name,this.EVENT_UNIONLIB_MYUNION_LIB_VIEW,o),i.push(e),(a==Country.UNION_STATUS_WAR||a==Country.UNION_STATUS_TEST)&&(e=new MenuActionData(Tool.manageString(GameText.STR_UNIONLIB_MYUNION_LIB_VIEW,o.data.fightCountry),this.EVENT_UNIONLIB_MYUNION_LIB_VIEW_FIGHT,o),i.push(e),a==Country.UNION_STATUS_WAR&&(e=new MenuActionData(GameText.STR_UNION_APPLY_HELP_APPLY,this.EVENT_ALL_UNION_APPLY_HELP,o),i.push(e))),CountryArmyScene.country.getUnionOwer().id==CountryArmyScene.country.id&&(0==o.data.isLoad(Country.WAR_IS_APPLY_UNION)?(e=new MenuActionData(GameText.STR_UNION_KICK_OUT_MENBER,this.EVENT_ALL_UNION_DEL_MENBER,o),i.push(e),e=new MenuActionData(GameText.STR_UNION_CHANGE,this.EVENT_ALL_UNION_CHANGE,o),i.push(e)):(e=new MenuActionData(GameText.STR_AGREE_APPLY,this.EVENT_UNIONLIB_MYUNION_LIB_YES,o),i.push(e),e=new MenuActionData(GameText.STR_DISAGREE_APPLY,this.EVENT_UNIONLIB_MYUNION_LIB_NO,o),i.push(e)))}e=new MenuActionData(GameText.getText(GameText.TI_BACK),0),i.push(e),PanelManager.openSelectMenuPanel(n,i,this.doWarUnionEvent,this)},e.prototype.doWarUnionEvent=function(t,e){switch(t){case this.EVENT_ALL_UNION_DEL_MENBER:Country.doUnionDelMember(CountryArmyScene.country,e.data);break;case this.EVENT_ALL_UNION_CHANGE:Country.doUnionChange(CountryArmyScene.country,e.data);break;case this.EVENT_ALL_UNION_APPLY_HELP:Country.doUnionApplyHelp(e.data);break;case this.EVENT_UNIONLIB_MYUNION_LIB_YES:Country.doDealApplyUnion(CountryArmyScene.country,e.data,!0,e);break;case this.EVENT_UNIONLIB_MYUNION_LIB_NO:Country.doDealApplyUnion(CountryArmyScene.country,e.data,!1,e);break;case this.EVENT_UNIONLIB_MYUNION_LIB_VIEW:e&&null!=e.data&&Country.doViewCountryInfo(e.data.id);break;case this.EVENT_UNIONLIB_MYUNION_LIB_VIEW_FIGHT:e&&null!=e.data&&Country.doViewCountryInfo(e.data.fightID)}PanelManager.closeSelectMenuPanel()},e.prototype.onCreate=function(){CommonFormPanel.createUnion(this.confirmCreateUnion,this)},e.prototype.onQuitUnion=function(){Country.doQuitUnion(CountryArmyScene.country,this.quitUnionBack,this)},e.prototype.quitUnionBack=function(){this.update()},e.prototype.confirmCreateUnion=function(t){Country.doCreateUnion(CountryArmyScene.country,t[0])},e.prototype.applyUnionBack=function(t){this.myUnionListBack()},e}(ComponentBase);__reflect(MyUnionPanel.prototype,"MyUnionPanel");var OtherUnionItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._country=null,ButtonUtils.removeTouchEvent(this.btn_join),ButtonUtils.removeTouchEvent(this.btn_see)},e.prototype.initPanel=function(){this._country&&(this.label_name.text=this._country.getUnionInfo2(),this.btn_join.label=GameText.STR_JOIN,this.btn_see.label=GameText.STR_SEE,ButtonUtils.addTouchEvent(this.btn_join,this.onJoin,this),ButtonUtils.addTouchEvent(this.btn_see,this.onSee,this))},Object.defineProperty(e.prototype,"data",{get:function(){return this._country},set:function(t){this._country=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.onJoin=function(){Country.doAddUnion(this._country,CountryArmyScene.country)},e.prototype.onSee=function(){for(var t,e=[],n=0,i=this._country.myUnionList.length;i>n;n++){var o=this._country.myUnionList[n];null!=o&&(t=new MenuActionData(o.getUnionInfo1(),0,o.id),e.push(t))}PanelManager.openFilterMenuPanel(e,this.onSeeCountry,this)},e.prototype.onSeeCountry=function(t,e){Country.doViewCountryInfo(e),PanelManager.closeSelectMenuPanel()},e}(ComponentBase);__reflect(OtherUnionItem.prototype,"OtherUnionItem");var OtherUnionPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.GET_UNION_LIST_BACK,this.initPanel,this),Country.doGetUnionList(CountryArmyScene.country)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this._unionList){for(var n=0,i=this._unionList.length;i>n;n++)Tool.removeObjSafe(this._unionList[n]),ObjectPool.getPool("OtherUnionItem").returnObject(this._unionList[n]);this._unionList=null}this._radioBtns&&(ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),xevent.removeEventListener(WorldEvent.GET_UNION_LIST_BACK,this.initPanel,this),this.scroll.reset(!0)},e.prototype.initPanel=function(){var t=CountryArmyScene.country;if(t&&t.unionList){for(var e=0,n=t.unionList.length;n>e;e++){var i=ObjectPool.getPool("OtherUnionItem").createObject();nato.attachSkin(i),i.data=t.unionList[e],this._unionList||(this._unionList=[]),this._unionList.push(i),this.scroll.add(i)}this.scroll.update(),this._unionList&&this._unionList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject()),this._radioBtns.add(this._unionList,-1))}},e}(ComponentBase);__reflect(OtherUnionPanel.prototype,"OtherUnionPanel");var OtherWarItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.initPanel=function(){this._country&&(this.label_countryName1.text=this._country.countryName1,this.label_countryName2.text=this._country.countryName2,this.label_countryFightTime.text=this._country.countryFightTime)},Object.defineProperty(e.prototype,"data",{get:function(){return this._country},set:function(t){this._country=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(OtherWarItem.prototype,"OtherWarItem");var OtherWarPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),xevent.addEventListener(WorldEvent.GET_WAR_LIST_BACK,this.initPanel,this),Country.doGetWarList(CountryArmyScene.country,Country.WAR_UNION_TYPE_OTHER)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.itemClick,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),xevent.removeEventListener(WorldEvent.GET_WAR_LIST_BACK,this.initPanel,this),this.scroll.reset(!0)},e.prototype.initPanel=function(){var t=CountryArmyScene.country;if(t&&t.warList){for(var e=0,n=t.warList.length;n>e;e++){var i=ObjectPool.getPool("OtherWarItem").createObject();nato.attachSkin(i),i.data=t.warList[e],this._warList||(this._warList=[]),this._warList.push(i),this.scroll.add(i)}this.scroll.update(),this._warList&&this._warList.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject()),this._radioBtns.add(this._warList,-1,!0,!0),this._radioBtns.addEventListener(egret.Event.CHANGE,this.itemClick,this))}},e.prototype.itemClick=function(){var t,e=[],n=this._radioBtns.getCurentSelectItem().data;t=new MenuActionData(Tool.manageString(GameText.STR_UNION_COUNTRY_ASSAULT,n.countryName1),1,n.countryID1),e.push(t),t=new MenuActionData(Tool.manageString(GameText.STR_UNION_COUNTRY_GARRISON,n.countryName2),1,n.countryID2),e.push(t),t=new MenuActionData(GameText.getText(GameText.TI_BACK),0),e.push(t),PanelManager.openSelectMenuPanel(n.getWarFightInfo2(),e,this.onSeeCountry,this)},e.prototype.onSeeCountry=function(t,e){1==t&&Country.doViewCountryInfo(e),PanelManager.closeSelectMenuPanel()},e}(ComponentBase);__reflect(OtherWarPanel.prototype,"OtherWarPanel");var SoldierApplyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYes,this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNo,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_yes.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYes,this),this.btn_no.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNo,this)},e.prototype.onBtnYes=function(t){t.stopImmediatePropagation(),this.onApplyHandler(!0)},e.prototype.onBtnNo=function(t){t.stopImmediatePropagation(),this.onApplyHandler(!1)},e.prototype.onApplyHandler=function(t){Country.doSoldierDealApply(CountryArmyScene.country,this._data,t)},e}(SoldierItemBase);__reflect(SoldierApplyItem.prototype,"SoldierApplyItem");var SoldierHelpItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYes,this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNo,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_yes.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYes,this),this.btn_no.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnNo,this)},e.prototype.onBtnYes=function(t){t.stopImmediatePropagation(),this.onApplyHandler(!0)},e.prototype.onBtnNo=function(t){t.stopImmediatePropagation(),this.onApplyHandler(!1)},e.prototype.onApplyHandler=function(t){Country.doSoldierDealApply(CountryArmyScene.country,this._data,t)},e}(SoldierItemBase);__reflect(SoldierHelpItem.prototype,"SoldierHelpItem");var SoldierItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e}(SoldierItemBase);__reflect(SoldierItem.prototype,"SoldierItem");var LoadManager=function(){function t(){}return t.prototype.load=function(){nato.resetLoad(null),null==nato.xuis?nato.loadJson("ui/ui.json",this.onPreload,this,"preload"):this.onPreload(null,"preload")},t.prototype.onPreloadIcons=function(t,e){nato.addIcons(t)},t.prototype.onPreload=function(e,n){var i=e;nato.addUIData(i),t.loadingUI=new LoadingUI,nato.attachSkin(t.loadingUI),this.loadResource(),nato.loadImage("ui/icons.png",this.onPreloadIcons,this,"icons"),nato.loadBinary("ani/sprite.js",this.onLoadSprite,this,"sprite"),xlocal||nato.loadBinary("ani/basic.js",this.onLoadBasic,this,"anchor")},t.prototype.onLoadSprite=function(t,e){nato.loadSprite(t),xlocal||xworld.preload()},t.prototype.onLoadBasic=function(t,e){nato.loadBasicData(t)},t.prototype.onLoadAnchor=function(t,e){nato.loadAnchorData(t)},t.prototype.onBinary=function(t,e){nato.loadXinary(t)},t.prototype.loadResource=function(){xlocal?(nato.resetLoad(this.onLoadFinish,this),nato.Resource.progress(this.updateProgress),nato.loadBinary("data/basic.bin",this.onBinary,this,"binary"),nato.loadBinary("data/basic1.bin",this.onBinary,this,"binary"),nato.loadBinary("data/basic2.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data1.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data2.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data3.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data4.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data5.bin",this.onBinary,this,"binary"),nato.loadBinary("data/data6.bin",this.onBinary,this,"binary")):this.onLoadFinish()},t.prototype.updateProgress=function(t,e){},t.prototype.onLoadFinish=function(){nato.resetLoad();var t=this;xlocal&&xworld.preload(),nato.getTextureFromUICache("3010",(function(e){nato.FrameCache.instance.init(e),t.onLoaded()}),null)},t.prototype.onLoaded=function(){null!=xclearLoading&&(xclearLoading(),xclearLoading=null),Sdk.xsdk.openLogin(),Main.instance.collectFPS()},t.prototype.removeLoadingUI=function(){Main.instance.removeUI(t.loadingUI),PanelManager.closeLoginPanel(),t.loadingUI=null},t.prototype.returnLoginView=function(){Sdk.xsdk.openLogin()},t.instance=new t,t}();__reflect(LoadManager.prototype,"LoadManager");var WarUnionScene=function(t){function e(){var e=t.call(this)||this;return e._isGetCountryData=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){this.tabPanelList=[this.my_union_panel,this.other_war_panel,this.other_union_panel],t.prototype.onAddToStage.call(this,e),CountryArmyScene.country||(this._isGetCountryData=!0,Country.doGetCampInfo(this.getCampInfo,this))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.closePanel=function(){t.prototype.closePanel.call(this),this._isGetCountryData&&(this._isGetCountryData=!1,CountryArmyScene.country=null)},e.prototype.getCampInfo=function(t){CountryArmyScene.country=t,this.getCurrentPanel().update()},e}(TabPanelBase);__reflect(WarUnionScene.prototype,"WarUnionScene");var MarryHandler=function(){function t(){}return t.doPartnerFly=function(){var t=MsgHandler.createPartnerFly();nato.Network.sendCmd(t,(function(t){MsgHandler.isMessageHaveError(t)||(MsgHandler.instance.processDataBlockFlagMsg(t),AlertPanel.alertCommon(GameText.STR_PARTNERFLY_SUCCESS),Menu.clickBtn(),PanelManager.openMainMenuScene())}),this)},t.doPartnerApply=function(){var e,n=[];e=new MenuActionData(GameText.STR_PARTNER_APPLY,t.PARTNER_APPLY),n.push(e),e=new MenuActionData(GameText.getText(GameText.TI_BACK),0),n.push(e);var i=Tool.manageString(GameText.STR_PARTNER_APPLY_INFO,t.getPartnerAddMoney());PanelManager.openSelectMenuPanel(i,n,t.onPartnerApplyMenu,xitem)},t.onPartnerApplyMenu=function(e){e==t.PARTNER_APPLY&&t.doPartnerAdd(),PanelManager.closeSelectMenuPanel()},t.doPartnerAdd=function(){if(0!=SafeLock.doSafeLockVerify()&&null!=xself){if(0==xself.isPlayerTeam())return void AlertPanel.alertCommon(GameText.STR_PARTNER_APPLY_NEED_TEAM);if(!(null==xself.getMembers()||xself.getMembers().length<=0)){for(var e=null,n=0;n<xself.getMembers().length;n++){var i=xself.getMembers()[n];if(null!=i&&3==i.getType()){e=i;break}}if(null!=e){var o=function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_PARTNER_APPLY_SUCCESS_WAIT)};AlertPanel.alert(GameText.STR_PARTNER,Tool.manageStringList(GameText.STR_PARTNER_ASK,[e.getName(),t.getPartnerAddMoney()]),(function(){var t=MsgHandler.createPartnerAdd();nato.Network.sendCmd(t,o,this)}),this)}}}},t.doPartnerDel=function(){if(0!=SafeLock.doSafeLockVerify()&&null!=xself){if(xself.partnerId<0)return void AlertPanel.alertCommon(GameText.STR_UNPARTNER);var t=function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_PARTNER_DEL_SUCCESS)};AlertPanel.alert(GameText.STR_PARTNER_DEL,Tool.manageString(GameText.STR_PARTNER_DEL_ASK,xself.partnerName),(function(){var e=MsgHandler.createPartnerDel();nato.Network.sendCmd(e,t,this)}),this)}},t.getPartnerAddMoney=function(){if(null==t.PARTNER_ADD_MONEY)return"";var e=t.PARTNER_ADD_MONEY[0],n=t.PARTNER_ADD_MONEY[1];return GameText.getMoneyText(e)+n},t.PARTNER_APPLY=1,t.PARTNER_ADD_MONEY=null,t}();__reflect(MarryHandler.prototype,"MarryHandler");var MasterItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e.prototype.initPanel=function(){this._data&&(this.label_name.text=this._data.getName(),this.label_value.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._data.getLevel()+"")+Define.getJobString(this._data.getJob()),this._data.vipLevel>0?this.vip_icon.source=xitem.getItemIcon(39):this.vip_icon.source=xitem.getItemIcon(50),this._data.isStatusBit(ModelConst.STATUS_ONLINE)?this.label_name.textColor=ColorUtils.COLOR_TEXT_GOLD:this.label_name.textColor=ColorUtils.COLOR_GRAY)},e}(ComponentBase);__reflect(MasterItem.prototype,"MasterItem");var MasterPanel=function(t){function e(){var e=t.call(this)||this;return e._currComboBoxJob=0,e._currComboBoxStatus=0,e._currSelectIten=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_title.text=GameText.STR_MASTER_TITLE,this.label_master.text=GameText.STR_LIST_DESC_RELATION_MASTER,this.label_job.text=GameText.STR_JOB;for(var n=[],i=ListPlayer.getSortJobMenuList(),o=0,a=i.length;a>o;o++)n.push({value:o,label:i[o]+""});this.comboBox_job.data=n,this.comboBox_job.select=this._currComboBoxJob,this.comboBox_job.addEventListener(egret.Event.CHANGE,this.onChangeJob,this),n=[];var r=ListPlayer.statusText;for(o=0,a=r.length;a>o;o++)n.push({value:o,label:r[o]+""});this.comboBox_online.data=n,this.comboBox_online.select=this._currComboBoxStatus,this.comboBox_online.addEventListener(egret.Event.CHANGE,this.onChangeStatus,this),xself.getLevel()<40?this.btn_master_accept.label=GameText.STR_MASTER_ACCEPTDISCIPLE_TI:this.btn_master_accept.label=GameText.STR_MASTER_ACCEPT,ButtonUtils.addTouchEvent(this.btn_master_accept,this.onMasterAccept,this),xevent.addEventListener(WorldEvent.RETURN_MASTER_LIST,this.returnMasterList,this),this.getList()},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this.comboBox_job.removeEventListener(egret.Event.CHANGE,this.onChangeJob,this),this.comboBox_online.removeEventListener(egret.Event.CHANGE,this.onChangeStatus,this),ButtonUtils.removeTouchEvent(this.btn_master_accept),xevent.removeEventListener(WorldEvent.RETURN_MASTER_LIST,this.returnMasterList,this),this.masterItemArr){for(var n=0,i=this.masterItemArr.length;i>n;n++)this.removeItem(this.masterItemArr[n],n),n--,i--;this.masterItemArr=null}this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.radioChange,this),this._radioBtns=null)},e.prototype.closePanel=function(){PanelManager.closeScene(),this._currComboBoxJob=0,this._currComboBoxStatus=0,this._currSelectIten=0},e.prototype.onChangeJob=function(t){this.getList()},e.prototype.onChangeStatus=function(t){this.getList()},e.prototype.getList=function(){ListPlayer.doMasterList(this.comboBox_online.selectData.value,this.comboBox_job.selectData.value)},e.prototype.returnMasterList=function(t){var e=t.param,n=0,i=0;if(!e||e.length<=0){if(this.masterItemArr)for(n=0,i=this.masterItemArr.length;i>n;n++)this.removeItem(this.masterItemArr[n],n),n--,i--}else{for(this.masterItemArr||(this.masterItemArr=[]),this._radioBtns?this._radioBtns.clear():(this._radioBtns=new RadioButtonComponent,this._radioBtns.addEventListener(egret.Event.CHANGE,this.radioChange,this)),n=0,i=e.length;i>n;n++){var o;n<this.masterItemArr.length?o=this.masterItemArr[n]:(o=ObjectPool.getPool("MasterItem").createObject(),nato.attachSkin(o),this.masterItemArr.push(o),this.scroll.add(o)),o.data=e[n],o.x=0,o.y=o.height*n}for(this.scroll.update(),i=this.masterItemArr.length;i>n;n++)this.removeItem(this.masterItemArr[n],n),n--,i--;this._radioBtns.add(this.masterItemArr,this._currSelectIten,!0,!0)}},e.prototype.removeItem=function(t,e){this.scroll.remove(t),ObjectPool.getPool("MasterItem").returnObject(this.masterItemArr[e]),this.masterItemArr.splice(e,1)},e.prototype.radioChange=function(t){this._currSelectIten=this._radioBtns.getCurrentIndex();var e=this._radioBtns.getCurentSelectItem().data;PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_MASTER_SHOP_LIST)},e.prototype.onMasterAccept=function(){var t,e="",n=[];xself.getLevel()>=40?(t=new MenuActionData(GameText.STR_MASTER_ACCEPT_PLAYER,1),n.push(t),e=GameText.STR_MASTER_ACCEPT_INFO):e=GameText.STR_MASTER_ACCEPTDISCIPLE,t=new MenuActionData(GameText.getText(GameText.TI_BACK),2),n.push(t),PanelManager.openSelectMenuPanel(e,n,this.menuCallBack,this)},e.prototype.menuCallBack=function(t){1==t&&CommonFormPanel.masterAccept(this,this.inputManifesto),PanelManager.closeSelectMenuPanel()},e.prototype.inputManifesto=function(t){var e=t[0];if(!Tool.isNullText(e)){var n=new nato.Message(ProtocolDefine.CG_ACTOR_ACCEPTDISCIPLE_START);n.putString(e),nato.Network.sendCmd(n,(function(t){if(null!=t)return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_MASTER_SUCCEE)}),this)}},e}(WindowPanelBase);__reflect(MasterPanel.prototype,"MasterPanel");var Menu=function(){function t(){}return t.contentRemove=function(e){t.currentMenu.removeEventListener(egret.Event.REMOVED_FROM_STAGE,t.contentRemove,this);for(var n=t.currentList,i=0;i<n.length;i++)ButtonUtils.removeTouchEvent(t.currentMenu["btn_"+i])},t.setData=function(e,n,i,o){void 0===o&&(o=!1),t.currentMenu=e,t.clickClose=o,e.group_info&&(n instanceof ListPlayer&&""!=n.manifesto?(e.addChild(e.group_info),e.label_info.text=n.manifesto,e.label_info.height=e.label_info.textHeight,e.bg_info.height=e.label_info.textHeight+23,e.group_btn.y=52*xhdRatio+e.group_info.height):(Tool.removeObjSafe(e.group_info),e.group_btn.y=52*xhdRatio));for(var a=0;e["btn_"+a];){e["btn_"+a].visible=!1,a++}e.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.contentRemove,this);var r=t.getList(n,i);t.currentList=r;for(a=0;a<r.length;a++)e["btn_"+a]&&(ButtonUtils.addTouchEvent(e["btn_"+a],r[a][1],this,r[a][2]),e["btn_"+a].label=r[a][0],e["btn_"+a].visible=!0)},t.getList=function(e,n){var i=[],o=!1;e.getId()!=GameWorld.getPlayerID()&&e.getId()>=Define.ADMIN_MAX&&(o=!0),o&&n!=t.UI_INTO_ACTOR_SELL_LIST&&(i.push([GameText.getText(GameText.TI_CHATMSG_PLAYER),this.chat,[e]]),i.push([GameText.getText(GameText.TI_SEE_DETAILS),this.seeInfo,[e,n]]));var a=e.isBattleRemote(),r=e.isShopMode();switch(n){case t.UI_INTO_FRIEND_LIST:i.push([GameText2.STR_CHANGE_FRIEND_REMARDS,this.changeFriendRemard,[e]]),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),i.push([GameText.getText(GameText.TI_DELETE_FRIEND),this.delRelation,[e,Define.RELATION_FRIEND]]),i.push([GameText.getText(GameText.TI_NO_TALK),this.black,[e]]),i.push([GameText.getText(GameText.TI_RELATION_FLY),this.relationFly,[e]]),t.addPlayerMenu(i,t.MENU_ADD_MASTER,e),i.push([GameText.getText(GameText.TI_TEAM_INVITE),this.inviteTeam,[e]]),i.push([GameText.getText(GameText.TI_JOIN_TEAM),this.joinTeam,[e]]),t.addPlayerMenu(i,t.MENU_INVITE_COUNTRY,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]);break;case t.UI_INTO_BLACK_LIST:i.push([GameText2.STR_CHANGE_FRIEND_REMARDS,this.changeFriendRemard,[e]]),i.push([GameText.getText(GameText.TI_DEL_RELATION),this.delRelation,[e,Define.RELATION_BLACK]]),i.push([GameText.getText(GameText.TI_MAKE_FRIEND),this.addFriend,[e,ProtocolDefine.MAIL_SEND_NAME]]),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]);break;case t.UI_INTO_COUNTRY_MEM1:i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]);break;case t.UI_INTO_COUNTRY_MEM2:i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]),i.push([GameText.getText(GameText.TI_LEAVE_COUNTRY),this.leaveCountry,[e]]),i.push([GameText.getText(GameText.TI_BECOME_KING),this.otherKing,[e]]),i.push([GameText.getText(GameText.TI_ADJUST_JOB),this.adjustJob,[e]]);break;case t.UI_INTO_COUNTRY_MEM3:case t.UI_INTO_COUNTRY_MEM4:i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]),xself.getCountryRank()<e.getCountryRank()&&(i.push([GameText.getText(GameText.TI_LEAVE_COUNTRY),this.leaveCountry,[e]]),i.push([GameText.getText(GameText.TI_ADJUST_JOB),this.adjustJob,[e]]));break;case t.UI_INTO_COUNTRY_MEM5:i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]),xself.getCountryRank()<e.getCountryRank()&&i.push([GameText.getText(GameText.TI_LEAVE_COUNTRY),this.leaveCountry,[e]]);break;case t.UI_INTO_MASTER_LIST:i.push([GameText2.STR_CHANGE_FRIEND_REMARDS,this.changeFriendRemard,[e]]),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),i.push([GameText.getText(GameText.TI_RELATION_FLY),this.relationFly,[e]]),i.push([GameText.getText(GameText.TI_DEL_MASTER),this.delMaster,[e]]),t.addPlayerMenu(i,t.MENU_INVITE_COUNTRY,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]);break;case t.UI_INTO_NEAR_LIST:1==a&&i.push([GameText.getText(GameText.TI_VIEW_BATTLE),this.viewBatle,[e]]),1==r&&i.push([GameText.getText(GameText.TI_SEE_PLAYER_SHOP),this.seeShop,[e]]),0==r&&(0==xself.isMember()&&0==e.isPlayerTeam()&&0==xself.getMemberById(e.getId())&&i.push([GameText.getText(GameText.TI_TEAM_INVITE),this.inviteTeam,[e]]),0==xself.isPlayerTeam()&&i.push([GameText.getText(GameText.TI_JOIN_TEAM),this.joinTeam,[e]]),0==Model.isSameTeam(xself,e)&&0==e.isMember()&&0==xself.isNovice&&e.getLevel()>=Player.NOVICE_LEVEL&&i.push([GameText.getText(GameText.TI_PK),this.pk,[e]])),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_MASTER,e),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),t.addPlayerMenu(i,t.MENU_INVITE_COUNTRY,e),GameWorld.isCountryWarStatus()||i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]),Tool.isBit(GameWorld.IS_ACCOST,GameWorld.loginSetting)&&(i.push([GameText.getText(GameText.TI_SEE_ACHIEVE),this.seeAchieve,[e]]),i.push([GameText2.STR_CHAT_UP2,this.chatUp,[e]]));break;case t.UI_INTO_TEMP_TALK:case t.UI_INTO_RANK_LIST:case t.UI_INTO_MASTER_SHOP_LIST:case t.UI_INTO_LOTTERY_DRAW_PLAYER:case t.UI_INTO_ARENA_SEE_OTHER:t.addPlayerMenu(i,t.MENU_ADD_MASTER,e),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_INVITE_COUNTRY,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]),i.push([GameText.getText(GameText.TI_SEE_ACHIEVE),this.seeAchieve,[e]]);break;case t.UI_INTO_TYPE_CHAT:o&&(t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),i.push([GameText.getText(GameText.TI_TEAM_INVITE),this.inviteTeam,[e]]),i.push([GameText.getText(GameText.TI_JOIN_TEAM),this.joinTeam,[e]]),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]));break;case t.UI_INTO_SOLDIER_LIST:i.push([GameText.getText(GameText.TI_ARMY_DELETE),this.soldierRemove,[e]]),i.push([GameText.getText(GameText.TI_SEND_MAIL),this.sendMailByID,[e]]),t.addPlayerMenu(i,t.MENU_ADD_FRIEND,e),t.addPlayerMenu(i,t.MENU_ADD_BLACK,e),i.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[e]]);break;case t.UI_INTO_SOLDIER_APPLY:break;case t.UI_INTO_ACTOR_SELL_LIST:i.push([GameText.getText(GameText.TI_BUY_PLAYER),this.buyPlayer,[e]]),i.push([GameText.getText(GameText.TI_SHOPPLAYER_INFO),this.shopplayerInfo,[e]]),i.push([GameText.getText(GameText.TI_SHOPPLAYER_BAG),this.shopplayerBag,[e]]),i.push([GameText.getText(GameText.TI_SEE_COUNTRY),this.shopplayerCountry,[e]]),i.push([GameText.getText(GameText.TI_SEE_CITY),this.shopplayerCity,[e]]),i.push([GameText.getText(GameText.TI_SEE_PET),this.shopplayerPetList,[e]]),i.push([GameText.getText(GameText.TI_SEE_STORE),this.shopplayerStore,[e]]);var s=GameText.STR_VIP;i.push([Tool.manageString(GameText.STR_VIP_STORAGE_SEE,s),this.shopplayerStoreVip,[e]]),i.push([GameText.getText(GameText.TI_SEE_ACHIEVE),this.shopplayerSeeAchieveShop,[e]]),i.push([GameText.getText(GameText.TI_CANTACT_SELLER),this.cantactSeller,[e]])}return i},t.addPlayerMenu=function(e,n,i){if(null!=i){var o,a,r=xself;switch(n){case t.MENU_VIEW_CARD:i.isHasCard()&&e.push([GameText.getText(GameText.TI_CARD_VIEW),this.cardView,[i]]);break;case t.MENU_VIEW_CITY:i.isHasCity()&&e.push([GameText.getText(GameText.TI_SEE_CITY),this.seeCity,[i]]);break;case t.MENU_INVITE_COUNTRY:null!=r&&r.getCountryId()>0&&r.getCountryRank()>=Define.RANK_KING&&r.getCountryRank()<=Define.RANK_KNIGHT&&e.push([GameText.getText(GameText.TI_INVITE_COUNTRY),this.inviteCountry,[i]]);break;case t.MENU_ADD_MASTER:null!=r&&0==r.isMaster()&&r.getLevel()<=40&&e.push([GameText.getText(GameText.TI_APPRENTICE),this.addMaster,[i]]);break;case t.MENU_ADD_FRIEND:if(SocietyHandler.friendList)for(o=0,a=SocietyHandler.friendList.length;a>o;o++)if(SocietyHandler.friendList[o].getId()==i.getId())return void e.push([GameText.getText(GameText.TI_DELETE_FRIEND),this.delRelation,[i,Define.RELATION_FRIEND]]);e.push([GameText.getText(GameText.TI_MAKE_FRIEND),this.addFriend,[i,ProtocolDefine.MAIL_SEND_NAME]]);break;case t.MENU_ADD_BLACK:if(SocietyHandler.blackList)for(o=0,a=SocietyHandler.blackList.length;a>o;o++)if(SocietyHandler.blackList[o].getId()==i.getId())return void e.push([GameText.getText(GameText.TI_DEL_RELATION),this.delRelation,[i,Define.RELATION_BLACK]]);e.push([GameText.getText(GameText.TI_NO_TALK),this.black,[i]])}}},t.clickBtn=function(){t.contentRemove(null),t.currentMenu instanceof WindowPanelBase?t.currentMenu.closePanel():t.currentMenu.parent&&t.currentMenu.parent.removeChild(t.currentMenu)},t.chat=function(e){t.clickClose&&this.clickBtn(),ChatMsg.openPersonalChat(e)},t.seeInfo=function(e,n){t.clickClose&&this.clickBtn(),OtherPlayerPanel.menuType=n,ListPlayer.doSeePlayerMsg(e)},t.changeFriendRemard=function(e){t.clickClose&&this.clickBtn(),CommonFormPanel.createFriendsRemards(this,t.returnFriendsRemarks,e)},t.sendMailByID=function(e){t.clickClose&&this.clickBtn(),PanelManager.openMailWritePanel(MailScene.TYPE_READ_FROM_PLAYER,e.getId())},t.delRelation=function(e,n){t.clickClose&&this.clickBtn();var i=new nato.Message(ProtocolDefine.CG_RELATION_DELETE);if(i.putByte(n),i.putInt(e.getId()),n==Define.RELATION_BLACK)nato.Network.sendCmd(i,t.delBlackCallback,this,[e]);else{if(!Tool.isNullText(xself.partnerName)&&xself.partnerName==e.getName())return void AlertPanel.alertCommon(GameText.STR_DEL_PARTNER);nato.Network.sendCmd(i,t.delRelationCallback,this,[e])}},t.addFriend=function(e,n){t.clickClose&&this.clickBtn(),n==ProtocolDefine.MAIL_SEND_ID?SocietyHandler.addFriend(n,e.getClientUid(!1)):n==ProtocolDefine.MAIL_SEND_NAME&&SocietyHandler.addFriend(n,e.getName())},t.black=function(e){t.clickClose&&this.clickBtn();var n=MsgHandler.createRelationAddById(Define.RELATION_BLACK,e.getId());nato.Network.sendCmd(n,t.blackCallback,this,[e])},t.relationFly=function(t){GameWorld.doRelationFlyAction(t)},t.inviteTeam=function(e){t.clickClose&&this.clickBtn(),ListPlayer.doInviteTeamMsg(xself,e)},t.joinTeam=function(e){t.clickClose&&this.clickBtn(),ListPlayer.doJoinTeamMsg(xself,e)},t.seeCity=function(e){t.clickClose&&this.clickBtn(),City.doViewCityInfo(e.getId())},t.photoOtherView=function(){this.clickBtn()},t.cardView=function(){t.clickClose&&this.clickBtn(),AlertPanel.alertCommon("敬请期待!")},t.inviteCountry=function(e){if(t.clickClose&&this.clickBtn(),null!=e){if(0==SafeLock.doSafeLockVerify())return;var n=MsgHandler.createCountryInvite(e.getId());nato.Network.sendCmd(n)}},t.leaveCountry=function(e){t.clickClose&&this.clickBtn(),Country.doCountryDelMem(e)},t.otherKing=function(e){t.clickClose&&this.clickBtn(),Country.doCountryBecomeKing(e)},t.adjustJob=function(e){t.clickClose&&this.clickBtn(),Country.doCountryAdjustJob(e)},t.soldierRemove=function(e){t.clickClose&&this.clickBtn(),Country.doSoldierDelete(e)},t.viewBatle=function(e){t.clickClose&&this.clickBtn(),GameWorld.doBattleSeeInter(e.getId())},t.seeShop=function(e){t.clickClose&&this.clickBtn(),SellHandler.doPlayerShopListMsg(e)},t.pk=function(e){t.clickClose&&this.clickBtn();var n=MsgHandler.createPKAskMsg(e.getId());nato.Network.sendCmd(n),AlertPanel.alertCommon(GameText.STR_PK_OTHER_WAIT_INFO)},t.seeAchieve=function(e){t.clickClose&&this.clickBtn(),Achieve.seeOtherAchieve(e,!1,Achieve.SEARCH_ALL)},t.chatUp=function(e){t.clickClose&&this.clickBtn(),ChatUp.doChatUp(e.getId())},t.addMaster=function(e){t.clickClose&&this.clickBtn();var n=MsgHandler.createRelationAddMaster(e.getId());nato.Network.sendCmd(n,t.addMasterCallback,this)},t.delMaster=function(e){t.clickClose&&this.clickBtn(),AlertPanel.alert(GameText.getText(GameText.TI_DEL_MASTER),Tool.manageString(GameText.STR_DEL_MASTER_ASK_CON,PowerString.makeColorString(e.getListDesc(!1),ColorUtils.COLOR_GREEN)),this.confirmDelMaster,this).params=e},t.buyPlayer=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doActorSellBuy(e)},t.shopplayerInfo=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_DETAIL)},t.shopplayerBag=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_ITEM)},t.shopplayerCountry=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_COUNTRY)},t.shopplayerCity=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_CITY)},t.shopplayerPetList=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_PET_LIST)},t.shopplayerStore=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_STORAGE)},t.shopplayerStoreVip=function(e){t.clickClose&&this.clickBtn(),ActorBuyHandler.doSeeSellActorInfo(e,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_STORAGE_VIP)},t.shopplayerSeeAchieveShop=function(e){t.clickClose&&this.clickBtn(),Achieve.seeOtherAchieve(e,!0,Achieve.SEARCH_ALL)},t.cantactSeller=function(e){t.clickClose&&this.clickBtn(),PanelManager.openMailWritePanel(MailScene.TYPE_READ_FROM_PLAYER,e.ownerId)},t.confirmDelMaster=function(e){var n=MsgHandler.createRelationDelMaster(e.getId());nato.Network.sendCmd(n,t.delMasterCallback,this)},t.delMasterCallback=function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_DEL_MASTER_SUCCEE)},t.delRelationCallback=function(t,e){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{AlertPanel.alertCommon(GameText.STR_DEL_FRIEND_SUCCEE);var n=PanelManager.getPanel(SocietyScene);n&&n.friendPanel&&n.friendPanel.stage?n.friendPanel.deleteUpdate():SocietyHandler.removeList(SocietyHandler.friendList,e[0])}},t.delBlackCallback=function(t,e){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{AlertPanel.alertCommon(GameText.STR_TI_DEL_RELATION_SUCCEE);var n=PanelManager.getPanel(SocietyScene);n&&n.blackListPanel&&n.blackListPanel.stage?n.blackListPanel.blackUpdate():SocietyHandler.updateFriendList=!0}},t.blackCallback=function(t,e){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{AlertPanel.alertCommon(GameText.STR_NO_TALK_SUCCEE);var n=PanelManager.getPanel(SocietyScene,!1);n&&n.friendPanel&&n.friendPanel.stage?n.friendPanel.blackUpdate():SocietyHandler.removeList(SocietyHandler.friendList,e[0],SocietyHandler.blackList)}},t.addMasterCallback=function(t){return 0>t.getByte()?void AlertPanel.errorMessage(t.getString()):void AlertPanel.alertCommon(GameText.STR_REQUEST_ADD_MASTER)},t.returnFriendsRemarks=function(e,n){var i=e[0],o=new nato.Message(ProtocolDefine.CG_RELATION_ADD_REMARKS);o.putString(i),o.putInt(n.getId()),nato.Network.sendCmd(o,t.changeRemarksCallback,this)},t.changeRemarksCallback=function(t){return 0>t.getByte()?void AlertPanel.alertCommon(t.getString()):void AlertPanel.alertCommon(GameText2.STR_CHANGE_REMARDS_SUCCESS)},t.UI_INTO_NEAR_LIST=0,t.UI_INTO_TYPE_CHAT=1,t.UI_INTO_FRIEND_LIST=2,t.UI_INTO_BLACK_LIST=3,t.UI_INTO_TEMP_TALK=4,t.UI_INTO_MASTER_LIST=9,t.UI_INTO_SOLDIER_LIST=10,t.UI_INTO_SOLDIER_APPLY=11,t.UI_INTO_RANK_LIST=14,t.UI_INTO_ACTOR_SELL_LIST=15,t.UI_INTO_MASTER_SHOP_LIST=16,t.UI_INTO_LOTTERY_DRAW_PLAYER=17,t.UI_INTO_ARENA_SEE_OTHER=18,t.UI_INTO_COUNTRY_MEM1=19,t.UI_INTO_COUNTRY_MEM2=20,t.UI_INTO_COUNTRY_MEM3=21,t.UI_INTO_COUNTRY_MEM4=22,t.UI_INTO_COUNTRY_MEM5=24,t.MENU_VIEW_PHOTO=0,t.MENU_VIEW_CARD=1,t.MENU_VIEW_CITY=2,t.MENU_INVITE_COUNTRY=3,t.MENU_ADD_MASTER=4,t.MENU_ADD_FRIEND=5,t.MENU_ADD_BLACK=6,t}();__reflect(Menu.prototype,"Menu");var MicroPanel=function(t){function e(){var e=t.call(this)||this;return e.itemCtnList=[],e.itemList=[],e.codeCtnList=[],e.counter=0,e.ANI_SCALE_LIST1=[0,.2,.4,.6,.8,1,.8,.6,.4,.2],e.ANI_SCALE_LIST2=[.6,.8,1,.8,.6,.4,.2,0,.2,.4],e.ANI_SCALE_LIST3=[.6,.4,.2,0,.2,.4,.6,.8,1,.8],e.originalFrameTime=100,e.currentFrameTime=100,e}return __extends(e,t),e.prototype.onCreate=function(){this.light_eff1=this.createLightAni(),this.light_eff2=this.createLightAni(),this.light_eff3=this.createLightAni(),this.itemCtnList.push(this.item_ctn1),this.itemCtnList.push(this.item_ctn2),this.itemCtnList.push(this.item_ctn3),this.itemCtnList.push(this.item_ctn4),this.itemCtnList.push(this.item_ctn5),this.itemList.push(this.item1),this.itemList.push(this.item2),this.itemList.push(this.item3),this.itemList.push(this.item4),this.itemList.push(this.item5),this.codeCtnList.push(this.platform_code1),this.codeCtnList.push(this.platform_code2),this.codeCtnList.push(this.platform_code3)},e.prototype.createLightAni=function(){var t=new eui.Image;return t.source="light_ani",t.anchorOffsetX=30,t.anchorOffsetY=30,t},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.eff_ctn1.addChild(this.light_eff1),this.eff_ctn2.addChild(this.light_eff2),this.eff_ctn3.addChild(this.light_eff3),ButtonUtils.addTouchEvent(this.btn_ctn,this.onButton,this),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),nato.WorldTicker.instance.register(this.render,this);for(var n=0;5>n;n++)this.itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this);1==xmicro?(this.btn_get.visible=!0,this.btn_save.visible=!1):(this.btn_get.visible=!1,this.btn_save.visible=!0),this.updateReward(),this.group_code.visible=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_ctn),ButtonUtils.removeTouchEvent(this.btn_close),nato.WorldTicker.instance.unregister(this.render,this);for(var n=0;5>n;n++)this.itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)},e.prototype.setObjectScale=function(t,e){t.scaleX=e,t.scaleY=e},e.prototype.convertPlatCode=function(t){for(var e=(t=Math.floor(t/10)).toString();e.length<3;)e="0"+e;return e},e.prototype.setPlatformCode=function(t){for(var e,n=this.convertPlatCode(t),i=0,o=0;3>o;o++)e=new egret.Bitmap,i=parseInt(n.charAt(o)),e.texture=nato.findTextureForSheet(ImageSet.IMG_SET_NUMBER_PLATFORM_CODE,i),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,this.codeCtnList[o].removeChildren(),this.codeCtnList[o].addChild(e)},e.prototype.onItemTouch=function(t){var e=t.target;if(null!=e&&null!=e.itemData){var n=Tool.convertDescToTextFlow(e.itemData.getDesc(xself,!1,!1));AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),n,"left")}},e.prototype.setRewardList=function(t){for(var e=0,n=t.length;n>e;e++)if(this.itemList[e].itemData=t[e],t[e].type==Define.ITEM_TYPE_NOT_BATTLE_USE){var i=new MovieClip(xhd?"grideffhd":"grideffsd",-1);i.load(),i.x=xhd?-16:-8,i.y=xhd?-34:-17,2==this.itemCtnList[e].numChildren&&this.itemCtnList[e].removeChildAt(1),this.itemCtnList[e].addChild(i)}},e.prototype.setRewardPet=function(t){null!=t&&(this.playerSprite=SpriteHelper.createPetSpriteByIcon(21,!1),this.playerSprite.setScale(xhd?2:1),this.model_ctn.removeChildren(),this.model_ctn.addChild(this.playerSprite))},e.processRewards=function(t){e.rewardItems=[];var n,i=t.getInt(),o=t.getInt(),a=t.getInt();i>0&&((n=new ItemData).isMoney=!0,n.moneyType=ItemData.ITEM_MONEY_TYPE_1,n.quantity=i,e.rewardItems.push(n)),o>0&&((n=new ItemData).isMoney=!0,n.moneyType=ItemData.ITEM_MONEY_TYPE_2,n.quantity=o,e.rewardItems.push(n)),a>0&&((n=new ItemData).isMoney=!0,n.moneyType=ItemData.ITEM_MONEY_TYPE_3,n.quantity=a,e.rewardItems.push(n));for(var r,s=t.getByte(),l=0;s>l;l++)(r=ItemData.fromBytesForMicroReward(t)).type==Define.ITEM_TYPE_NOT_BATTLE_USE?(e.rewardPet=r,e.rewardItems.unshift(r)):e.rewardItems.push(r)},e.prototype.updateReward=function(){if(this.setPlatformCode(xchannel),null!=e.rewardItems){var t=e.rewardItems;this.setRewardList(t),this.setRewardPet(e.rewardPet)}},e.prototype.render=function(t){if(this.currentFrameTime-=t,!(this.currentFrameTime>0)){this.currentFrameTime=this.originalFrameTime,this.counter+=1;var e=this.counter%10;this.setObjectScale(this.light_eff1,this.ANI_SCALE_LIST1[e]),this.setObjectScale(this.light_eff2,this.ANI_SCALE_LIST2[e]),this.setObjectScale(this.light_eff3,this.ANI_SCALE_LIST3[e]),this.counter>=1e3&&(this.counter=0)}},e.prototype.onButton=function(t){if(this.btn_get.visible)if(xmicro){var e=MsgHandler.createDrawMicroReward();nato.Network.sendCmd(e)}else WorldMessage.addPromptMsg("请通过微端登录领取");else if(this.btn_save.visible){downloadFile("world.apk",apkLink);var n=this.convertPlatCode(xchannel);PowerString.makeColorString(n,ColorUtils.COLOR_GREEN),GameText.getText(GameText.TI_WARM_SHOW)}},e.prototype.onClose=function(t){PanelManager.closeMicroPanel()},e.openMicroPanelForwardly=!1,e.rewardItems=[],e}(ComponentBase);__reflect(MicroPanel.prototype,"MicroPanel");var NewArenaItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_fight,this.onFightPlayer,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_fight)},e.prototype.setEmpty=function(){this.content.visible=!1,this.avatar&&this.roleCtn.contains(this.avatar)&&this.roleCtn.removeChild(this.avatar)},e.prototype.update=function(t){return this.newArena=t,null==t?void this.setEmpty():(this.content.visible=!0,this.avatar&&this.roleCtn.contains(this.avatar)&&this.roleCtn.removeChild(this.avatar),this.avatar=SpriteHelper.createOtherHeadSpriteByIcon(t.icon1),this.avatar.setScale(nato.mapRatio),this.roleCtn.addChild(this.avatar),this.btn_fight.label=t.isLead?GameText2.STR_SUPER_CHALLENGE:GameText2.STR_CHALLENGE,this.level.text=t.level+"",this.job.text=Define.getJobString(t.job),this.player_name.text=t.name,this.rank.text=t.rank+"",void(this.power.text=t.fightValue+""))},e.prototype.onFightPlayer=function(t){var e=GameWorld.newArena;if(null!=e){var n=e.isInCool(),i=e.firstCost;0==n?NewArena.doChallenge(this.newArena,i):AlertPanel.alertCommon(GameText2.STR_RESIDUE_COOLING_CHALLENGE)}},e}(ComponentBase);__reflect(NewArenaItem.prototype,"NewArenaItem");var NewArenaRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.update=function(t){return null==t?(this.label_name.text="",void(this.label_rank.text="")):(this.label_name.text=t.rank+"  "+t.actorname,void(this.label_rank.text=t.actorValue+""))},e}(ComponentBase);__reflect(NewArenaRankItem.prototype,"NewArenaRankItem");var NewArenaRankScene=function(t){function e(){var e=t.call(this)||this;return e._curPage=1,e._maxPage=1,e._searchType=0,e._comboBoxSelect=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e);var n=this.newArenaRank.vNewArenaRankSearch;if(null==this._comboBoxData){this._comboBoxData=[];for(var i=void 0,o=0;o<n.length;o++)i=n[o],this._comboBoxData.push({value:i.ranktype,label:i.rankName});this.combobox_type.data=this._comboBoxData}this.combobox_type.select=this._comboBoxSelect,null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5,this.item6,this.item7]),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.combobox_type.addEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_my_rank,this.onMyRank,this),ButtonUtils.addTouchEvent(this.btn_reward,this.onReward,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),this.combobox_type.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_my_rank),ButtonUtils.removeTouchEvent(this.btn_reward)},e.prototype.setData=function(t){this.newArenaRank=t},e.prototype.update=function(t,e){this.rank_type.text=this.newArenaRank.valueName,this._maxPage=Math.ceil(e/NewArenaRank.NEWARENA_RANK_PAGE_COUNT),this.turnPage.setPage(this._curPage,this._maxPage,!1);for(var n,i,o=0;o<NewArenaRank.NEWARENA_RANK_PAGE_COUNT;o++)n=this._itemList[o],i=t[o],n.update(i)},e.prototype.onTurnPage=function(t){this._curPage=this.turnPage.currentPage,this.onGetData()},e.prototype.onGetData=function(){var t=this.combobox_type.selectData.value;NewArenaRank.doNewArenaRankActorList(this.newArenaRank,t,NewArenaRank.NEWARENA_RANK_PAGE_COUNT,this._curPage)},e.prototype.onComboBoxSearch=function(t){this._searchType=this.combobox_type.selectData.value,this._comboBoxSelect=this.combobox_type.select,this.onGetData()},e.prototype.onMyRank=function(t){NewArenaRank.doSeeMyRank()},e.prototype.onReward=function(t){NewArenaReward.checkScoreReward()},e.prototype.onClose=function(t){PanelManager.closeScene()},e}(ComponentBase);__reflect(NewArenaRankScene.prototype,"NewArenaRankScene");var NewArenaRewardItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_get,this.onGetReward,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_get)},e.prototype.update=function(t){if(this.reward=t,null!=t.rwItemList&&t.rwItemList.length>0){var e=t.rwItemList[0];this.item.itemData=e,this.label_name.textFlow=Tool.convertDescToTextFlow(e.getRewardDesc())}else this.label_name.text="";this.label_point.text=t.rwTotalScore+"",t.rwState==NewArenaReward.STATUS_CANNOT_GET&&(this.label_status.visible=!0,this.btn_get.visible=!1,this.label_status.text="未达成"),t.rwState==NewArenaReward.STATUS_HAS_GET&&(this.label_status.visible=!0,this.btn_get.visible=!1,this.label_status.text="已领取"),t.rwState==NewArenaReward.STATUS_CAN_GET&&(this.label_status.visible=!1,this.btn_get.visible=!0)},e.prototype.onGetReward=function(t){this.reward.doGetScoreReward(this.onGetRewardSuccess,this)},e.prototype.onGetRewardSuccess=function(){this.label_status.visible=!0,this.btn_get.visible=!1,this.label_status.text="已领取"},e}(ComponentBase);__reflect(NewArenaRewardItem.prototype,"NewArenaRewardItem");var NewArenaRewardScene=function(t){function e(){var e=t.call(this)||this;return e._newArenaRewardItemList=[],e.newArenaRewardItemPool=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.updateUI()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.setData=function(t){this.newArenaReward=t},e.prototype.updateUI=function(){if(null!=this.newArenaReward){this.cleanContainer();for(var t,e,n=this.newArenaReward.allList,i=n.length,o=0;i>o;o++)t=n[o],(e=this.getNewArenaItem()).update(t),this.container.add(e),this._newArenaRewardItemList.push(e);this.container.update()}},e.prototype.cleanContainer=function(){for(;this._newArenaRewardItemList.length;)this.newArenaRewardItemPool.push(this._newArenaRewardItemList.pop());this._newArenaRewardItemList.length=0,this.container.reset()},e.prototype.getNewArenaItem=function(){if(this.newArenaRewardItemPool.length>0)return this.newArenaRewardItemPool.pop();var t=new NewArenaRewardItem;return nato.attachSkin(t),t},e.prototype.onClose=function(t){PanelManager.closeScene()},e}(ComponentBase);__reflect(NewArenaRewardScene.prototype,"NewArenaRewardScene");var NewArenaScene=function(t){function e(){var e=t.call(this)||this;return e._newArenaItemList=[],e.newArenaItemPool=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_close,this.onExit,this),ButtonUtils.addTouchEvent(this.btn_rank,this.onOpenRank,this),ButtonUtils.addTouchEvent(this.btn_adjust,this.onAdjust,this),ButtonUtils.addTouchEvent(this.count_refresh,this.onRefreshCount,this),ButtonUtils.addTouchEvent(this.time_refresh,this.onRefreshTime,this),ButtonUtils.addTouchEvent(this.state,this.onNewArenaState,this),this.player_info.setData(xself)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_rank),ButtonUtils.removeTouchEvent(this.btn_adjust),ButtonUtils.removeTouchEvent(this.count_refresh),ButtonUtils.removeTouchEvent(this.time_refresh),ButtonUtils.removeTouchEvent(this.state)},e.prototype.setData=function(t){this.newArena=t},e.prototype.logic=function(t){this.time.text=this.newArena.getTime()},e.prototype.update=function(){this.cleanContainer(),this.power.text=this.newArena.fightValue+"",this.rank.text=this.newArena.rank+"",this.score.text=this.newArena.score+"",this.fight_count.text=this.newArena.competeCount+"";for(var t=this.newArena.vArenaNew,e=t.length>5?t.length:5,n=0;e>n;n++){var i=this.newArena.getNewArenaByIndex(n),o=this.getNewArenaItem();o.update(i),this.container.add(o),this._newArenaItemList.push(o)}this.container.update()},e.prototype.cleanContainer=function(){for(;this._newArenaItemList.length;)this.newArenaItemPool.push(this._newArenaItemList.pop());this._newArenaItemList.length=0,this.container.reset()},e.prototype.getNewArenaItem=function(){if(this.newArenaItemPool.length>0)return this.newArenaItemPool.pop();var t=new NewArenaItem;return nato.attachSkin(t),t},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onOpenRank=function(t){NewArenaRank.doGetRankSearchType()},e.prototype.onAdjust=function(t){NewArena.doSaveAdjust()},e.prototype.onRefreshCount=function(t){NewArena.doAddSurplus()},e.prototype.onRefreshTime=function(t){NewArena.doClearInterval()},e.prototype.onNewArenaState=function(t){NewArena.doSeeState()},e.prototype.onExit=function(t){NewArena.doExit()},e}(ComponentBase);__reflect(NewArenaScene.prototype,"NewArenaScene");var PlayerEventItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._data?this.label_name.text="["+this._data.title+"]"+this._data.info:this.label_name.text="")},e}(ComponentBase);__reflect(PlayerEventItem.prototype,"PlayerEventItem");var PlayerEventPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.data&&e.data.doPlayerEvent()},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){this.reset(),GameWorld.refreshPlayerEvent();var t=GameWorld.playerEventList;if(t&&t.length>0){for(var e=0;e<t.length;e++){var n=t[e];if(n){var i=this.getItem();i.setData(n),this.container.add(i)}}this.container.update()}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new PlayerEventItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(PlayerEventPanel.prototype,"PlayerEventPanel");var MessageFrame=function(t){function e(e,n,i){void 0===n&&(n=150),void 0===i&&(i=40);var o=t.call(this)||this;return o._width=150,o._height=40,o.isActivity=!1,o._isShow=!1,o.drawCount=300,o._content=e,o._width=n,o._height=i,o.init(),o}return __extends(e,t),e.prototype.init=function(){if(null==this._txt&&(this._txt=new egret.TextField,this._txt.fontFamily="微软雅黑",this._txt.textColor=0,this._txt.size=14),this._txt.width=this._width,this._txt.x=4,this._txt.y=4,-1!=this._content.indexOf("/f")){var t=this._content.indexOf("/f");this._content=this._content.substring(0,t)+this._content.substring(t+4)}this._txt.textFlow=Tool.convertDescToTextFlow(this._content,-1),this._txt.textWidth<this._width&&(this._txt.width=this._txt.textWidth),this.width=this._txt.width+8,this.height=this._txt.textHeight+8;null==this._bg&&(this._bg=new egret.Shape),this._bg.graphics.clear(),this._bg.graphics.beginFill(16777215,1),this._bg.graphics.lineStyle(1,0,1),this._bg.graphics.drawRoundRect(0,0,this.width,this.height,10,10),this._bg.graphics.moveTo(this.width/2-10,this.height),this._bg.graphics.lineTo(this.width/2,this.height+15),this._bg.graphics.lineTo(this.width/2+10,this.height),this._bg.graphics.endFill(),this._bg.cacheAsBitmap=!0,this.addChild(this._bg),this.addChild(this._txt)},e.prototype.updateMessage=function(t){this._content=t,this._width=150,this._height=40,this.init()},e.prototype.setDrawCount=function(t){this.drawCount=t},e.prototype.show=function(){this._isShow=!0,this._count=this.drawCount},e.prototype.logic=function(t){return this._count>0&&(this._count-=1,this._count<=0&&this.clear()),this._count<0},Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},set:function(t){this._isShow&&!t&&this.clear()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._count=0,this._isShow=!1,this.parent&&this.parent.removeChild(this)},e.prototype.setScale=function(t){this.scaleX=t,this.scaleY=t},e}(eui.Component);__reflect(MessageFrame.prototype,"MessageFrame");var NPCDialogueBtn=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMission",{set:function(t){if(this.missionIcon&&(this.missionIcon.visible=t,t&&this._data)){var e,n=this._data.data;if(n){var i=n.getMissionStatus(xself);e=i==MissionConst.CAN_SUBMIT?"task_finish":i==MissionConst.NOT_CAN_SUBMIT?"task_unfinish":i==MissionConst.NOT_CAN_ACCEPT?"task_not_accept":"task_can_accept"}this.missionIcon.source=e,this.missionIcon.x=(this.width-TextFieldUtils.getTextWidth(this._data.menu,this.label.size))/2-20*xhdRatio}},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._data=null,this.update()},e.prototype.update=function(){this.init&&(this._data?(this.label.text=this._data.menu,1==this._data.action?this.isMission=!0:this.isMission=!1):(this.label.text="",this.isMission=!1))},Object.defineProperty(e.prototype,"mission",{get:function(){return null==this._data||null==this._data.data?null:this._data.data.mission},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(NPCDialogueBtn.prototype,"NPCDialogueBtn");var NPCDialoguePanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._rewardItemIndex=0,e._selectIndex=0,e._faceIconList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.return_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReturn,this),null==this._btnList&&(this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHandler,this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHandler,this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHandler,this),this._btnList=[this.btn1,this.btn2,this.btn3]),null==this._rewardItemViewList&&(this._rewardItemViewList=[this.reward1,this.reward2,this.reward3,this.reward4],this.reward1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemTouch,this),this.reward2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemTouch,this),this.reward3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemTouch,this),this.reward4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemTouch,this)),this.updatePanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.spriteGuide&&this.spriteGuide.parent&&this.spriteGuide.parent.removeChild(this.spriteGuide)},e.prototype.onBtnReturn=function(t){PanelManager.closeNPCDialogue()},e.prototype.onRewardItemTouch=function(t){if(egret.is(t.target,"ItemIcon")){var e=t.target.parent.itemData;e&&e.doViewItem()}else if(egret.is(t.target,"RewardItem")){if(null==this._selectRewardItemList||0==this._selectRewardItemList.length)return;var n=t.target,i=this._selectRewardItemList.indexOf(n);if(-1==i)return;this._selectIndex=i,this.updateSelect()}},e.prototype.updateSelect=function(){if(null!=this._selectRewardItemList&&0!=this._selectRewardItemList.length)for(var t,e=0;e<this._selectRewardItemList.length;e++)t=this._selectRewardItemList[e],e==this._selectIndex?t.select=!0:t.select=!1},e.prototype.onBtnHandler=function(t){var e=t.target,n=this._btnList.indexOf(e);if(-1!=n){guide.rectBoxGuiding||Main.cleanPointerKey(),PanelManager.closeNPCDialogue();var i=null;this._selectRewardItemList&&this._selectRewardItemList.length>0&&(i=this._selectRewardItemList[this._selectIndex].itemData);var o=this._actionList[n];if(8==o.action){var a=o.data.mission,r=o.data.subType;Mission.doMenuButton(this._npc,i,r,a)}else if(9==o.action){var s=o.data;Mail.doAttachItemMsg(s,i)}else if(11==o.action){var l=o.data;SpriteGuide.doLocalGuide(l)}else if(12==o.action){var _=o.data.subType;a=o.data.mission;RandomMission.doNPCDialogueAction(_,a)}else NPC.handlerMissionNPCAction(this._npc,o)}},e.prototype.show=function(t,e,n,i,o,a){this._title=t,this._textInfo=Tool.convertDesc(Tool.convertLastLinefeed(e)),this._actionList=n,this._rewardItemList=i,this._selectItemList=o,this._npc=a,null==this._rewardItemList&&(this._rewardItemList=[]),null==this._selectItemList&&(this._selectItemList=[]),this.updatePanel()},e.prototype.reset=function(){this.container.reset(!0),this.removeBtns(),this.clearFaceIconList(),this.group_reward.removeChildren(),this._selectRewardItemList=[],this._selectIndex=0},e.prototype.clearFaceIconList=function(){if(this._faceIconList&&this._faceIconList.length>0)for(;this._faceIconList.length>0;){var t=this._faceIconList.pop();t&&(t.parent&&t.parent.removeChild(t),FaceIcon.returnFaceIcon(t))}},e.prototype.updatePanel=function(){if(this.init){this.reset(),this.title_label.text=this._title;var t,e=null;if(-1!=this._textInfo.indexOf("/f")){var n=new StringBuffer;e=PowerString.getFaceIconPosition(this._textInfo,this.content_label,FaceIcon.getFaceReplaceSpace(this.content_label.size),n),t=Tool.convertDescToTextFlow(n.toString())}else t=Tool.convertDescToTextFlow(this._textInfo);this.content_label.textFlow=t;var i=this.content_label.textHeight;i<this.content_label.size&&(i=this.content_label.size),i+=10*xhdRatio,this.content_label.height=i,this.container.add(this.content_label,15*xhdRatio,10*xhdRatio);var o=i+8*xhdRatio;if(this.bg2.height=o,this.container.add(this.bg2,3*xhdRatio,2*xhdRatio),e&&e.length>0)for(var a=0;a<e.length;a++){var r=e[a],s=FaceIcon.getFaceIcon(r.index,this.content_label.size);this.container.add(s,r.x+this.content_label.x,r.y+this.content_label.y),this._faceIconList.push(s)}if(this._rewardItemList.length>0||this._selectItemList.length>0){a=0;var l,_,h=7*xhdRatio,u=20*xhdRatio,c=115*xhdRatio,T=40*xhdRatio;if(this._rewardItemIndex=0,this._rewardItemList.length>0&&this._selectItemList.length>0){for(this.label_reward1.text="奖励物品:",this.group_reward.addChild(this.label_reward1),a=0;a<this._rewardItemList.length;a++)_=this._rewardItemList[a],(l=this.getRewardItem()).x=h+a%2*c,l.y=u+Math.floor(a/2)*T,l.itemData=_,l.select=!1,this.group_reward.addChild(l);for(this.label_reward2.text="可选物品:",this.label_reward2.y=l.y+T,this.group_reward.addChild(this.label_reward2),u=this.label_reward2.y+20*xhdRatio,a=0;a<this._selectItemList.length;a++)_=this._selectItemList[a],(l=this.getRewardItem()).x=h+a%2*c,l.y=u+Math.floor(a/2)*T,l.itemData=_,this.group_reward.addChild(l),this._selectRewardItemList.push(l)}else if(this._rewardItemList.length>0)for(this.label_reward1.text="奖励物品:",this.group_reward.addChild(this.label_reward1),a=0;a<this._rewardItemList.length;a++)_=this._rewardItemList[a],(l=this.getRewardItem()).x=h+a%2*c,l.y=u+Math.floor(a/2)*T,l.itemData=_,l.select=!1,this.group_reward.addChild(l);else if(this._selectItemList.length>0)for(this.label_reward1.text="可选物品:",this.group_reward.addChild(this.label_reward1),a=0;a<this._selectItemList.length;a++)_=this._selectItemList[a],(l=this.getRewardItem()).x=h+a%2*c,l.y=u+Math.floor(a/2)*T,l.itemData=_,this.group_reward.addChild(l),this._selectRewardItemList.push(l);this.bg3.height=l.y+T,this.group_reward.addChild(this.bg3),this.group_reward.height=this.bg3.height,this.container.add(this.group_reward,3*xhdRatio,-1),this.updateSelect()}this.container.updateAutoSize(this.container.totalHeight,230*xhdRatio),this.img_line2.y=this.container.y+this.container.height;var p=this.container.y+this.container.height+2*xhdRatio;this._index=0;var d,E,g,S=function(){if(d=m.getBtn(),E=m._actionList[a],d.y=p+a*d.height,d.data=E,m.addChild(d),11==E.action&&1==E.data){var t=!1;(g=TodayEvent.getShowList())&&g.length>0&&g.forEach((function(e){t=t||!e.isFinish}),m),t&&RedPoint.addRedPoint(d)}},m=this;for(a=0;a<this._actionList.length;a++)S();this.height=d.y+38*xhdRatio,this.addChild(this.bg1)}},e.prototype.removeBtns=function(){for(var t=0;t<this._btnList.length;t++){var e=this._btnList[t];e.reset(),e.parent&&e.parent.removeChild(e)}},e.prototype.getBtn=function(){var t=this._btnList[this._index];return null==t&&(t=new NPCDialogueBtn,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnHandler,this),this._btnList[this._index]=t),t.horizontalCenter=0,this._index++,t},e.prototype.getRewardItem=function(){var t=this._rewardItemViewList[this._rewardItemIndex];return null==t&&(t=new RewardItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRewardItemTouch,this),this._rewardItemViewList[this._rewardItemIndex]=t),this._rewardItemIndex++,t},e.prototype.showSpriteGuide=function(){this.spriteGuide&&(this.spriteGuide.visible=!0,this.addChild(this.spriteGuide))},e.prototype.getNpc=function(){return this._npc},e}(ComponentBase);__reflect(NPCDialoguePanel.prototype,"NPCDialoguePanel");var RewardItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.img_select.touchEnabled=!1,this.label_name.touchEnabled=!1,this.icon.touchChildren=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},set:function(t){this._itemData=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){},e.prototype.update=function(){this.init&&this._itemData&&(this.icon.setData(this._itemData.bagIcon,this._itemData.grade),this.label_name.textColor=ColorUtils.getGradeColor(this._itemData.grade),this.label_name.text=this._itemData.name,this.img_select.visible=this._select)},e}(ComponentBase);__reflect(RewardItem.prototype,"RewardItem");var OffLineExpScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_goddessUpgrade,this.onBtnGoddessUpgrade,this),ButtonUtils.addTouchEvent(this.btn_offlineGet,this.onBtnOfflineExp,this),ButtonUtils.addTouchEvent(this.btn_offlineGet3,this.onBtnOfflineExp3Rate,this),ButtonUtils.addTouchEvent(this.btn_pray,this.onBtnPray,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_goddessUpgrade),ButtonUtils.removeTouchEvent(this.btn_offlineGet),ButtonUtils.removeTouchEvent(this.btn_offlineGet3),ButtonUtils.removeTouchEvent(this.btn_pray)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnGoddessUpgrade=function(){PanelManager.openOffLineExpUpgradePanel()},e.prototype.onBtnOfflineExp=function(){var t=this,e=OfflineExp.info;if(null!=e){if(e.expGetable<=0)return void AlertPanel.alertCommon("当前没有可领取的离线经验");AlertPanel.alert("温馨提示","是否直接领取全部离线经验？",(function(){var e=new nato.Message(ProtocolDefine.CG_ACTOR_OFFLINE_EXP_GET);e.putByte(0),nato.Network.sendCmd(e,t.onGetOfflineExp,t),PanelManager.openWaitForServer()}),this)}},e.prototype.onBtnOfflineExp3Rate=function(){var t=this,e=OfflineExp.info;if(null!=e){if(e.expGetable<=0)return void AlertPanel.alertCommon("当前没有可领取的离线经验");var n="是否花费/cffcc00"+e.trebleCost+"金叶/p领取/cffcc00三倍/p离线经验？";AlertPanel.alert("温馨提示",n,(function(){var e=new nato.Message(ProtocolDefine.CG_ACTOR_OFFLINE_EXP_GET);e.putByte(1),nato.Network.sendCmd(e,t.onGetOfflineExp,t),PanelManager.openWaitForServer()}),this)}},e.prototype.onGetOfflineExp=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertCommon(t.getString());else{xself.setMoneyByType(ModelConst.MONEY1,t.getInt()),xself.setMoneyByType(ModelConst.MONEY2,t.getInt()),xself.setMoneyByType(ModelConst.MONEY3,t.getInt()),OfflineExp.info.offlineTime=0,OfflineExp.info.prayExp=t.getInt(),OfflineExp.info.expEachHour=t.getInt();var e=new StringBuffer,n=MsgHandler.processUpLevelMsg(t,xself,e);AlertPanel.alertCommon("成功领取了"+n+"点离线经验"),this.update()}},e.prototype.onBtnPray=function(){if(0!=xself.vipLevel){var t=this,e=OfflineExp.info;if(null!=e){if(e.prayedCount>=e.prayMaxCount)return void AlertPanel.alertVIPUPgrade("祈祷次数已用完，提升VIP等级获取更多次数");n="是否花费/cffcc00"+e.prayCost+"金叶/p进行祈祷？";AlertPanel.alert("温馨提示",n,(function(){var e=new nato.Message(ProtocolDefine.CG_ACTOR_OFFLINE_EXP_PRAY);nato.Network.sendCmd(e,t.onPray,t),PanelManager.openWaitForServer()}),this)}}else{var n=Tool.convertDescToTextFlow("您不是VIP无法使用此功能,是否开启VIP？");AlertPanel.alertTextFlow(GameText.getText(GameText.TI_WARM_SHOW),n,(function(){PayInfo.getPayList()}),null,this)}},e.prototype.onPray=function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertCommon(t.getString());else{xself.setMoneyByType(ModelConst.MONEY1,t.getInt()),xself.setMoneyByType(ModelConst.MONEY2,t.getInt()),xself.setMoneyByType(ModelConst.MONEY3,t.getInt()),OfflineExp.info.prayedCount=t.getInt(),OfflineExp.info.prayCost=t.getShort(),OfflineExp.info.prayExp=t.getInt(),OfflineExp.info.expEachHour=t.getInt();var e=new StringBuffer,n=MsgHandler.processUpLevelMsg(t,xself,e);AlertPanel.alertCommon("祈祷获得了"+n+"点经验"),this.update()}},e.prototype.reset=function(){this.init},e.prototype.update=function(){var t=OfflineExp.info;if(null!=t){this.label_goddessLv.text="女神像 LV"+t.lv,this.label_addExp.text=t.battleExp+"%",this.label_addHP.text=t.hpRecover+"%";var e="最多储存/cffffff"+t.maxStoreHours+"/p小时离线经验";this.label_offlineInfo.textFlow=Tool.convertDescToTextFlow(e);var n=(t.expGetable,t.maxStoreHours,t.expEachHour,Math.floor(t.expGetable)),i=Math.floor(t.maxStoreHours*t.expEachHour);this.bar_offlineExp.maximum=i,this.bar_offlineExp.value=n,this.label_prayExp.textFlow=Tool.convertDescToTextFlow("经验：/cffffff"+t.prayExp+"/p"),this.label_prayCount.textFlow=Tool.convertDescToTextFlow("次数：/cffffff"+t.prayedCount+"/"+t.prayMaxCount+"/p")}},e}(ComponentBase);__reflect(OffLineExpScene.prototype,"OffLineExpScene");var OffLineExpUpgradePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_upgrade,this.onBtnUpgrade,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_upgrade)},e.prototype.onClose=function(){PanelManager.closeOffLineExpUpgradePanel()},e.prototype.onBtnUpgrade=function(){OfflineExp.doGoddessUpgrade()},e.prototype.update=function(){if(this.init){var t=OfflineExp.info;if(null!=t){var e=!(t.nextLv>0),n="LV"+t.lv;if(n+=e?"(已满级)":" /c00ff00→/p LV"+t.nextLv,this.label_level.textFlow=Tool.convertDescToTextFlow(n),e){this.label_add0.text="",this.label_add1.text="",this.label_add2.text="",this.label_add3.text="";var i=t.expEachHour*t.maxStoreHours;this.label_exp.text=i+""}else{this.label_info0.textFlow=Tool.convertDescToTextFlow("战斗经验：/cffffff+"+t.battleExp+"%/p"),this.label_add0.text="→ +"+t.nextBattleExp+"%",this.label_info1.textFlow=Tool.convertDescToTextFlow("任务经验：/cffffff+"+t.taskExp+"%/p"),this.label_add1.text="→ +"+t.nextTaskExp+"%",this.label_info2.textFlow=Tool.convertDescToTextFlow("战斗后恢复生命：/cffffff+"+t.hpRecover+"%/p"),this.label_add2.text="→ +"+t.nextHpRecover+"%",this.label_info3.textFlow=Tool.convertDescToTextFlow("战斗后恢复法力：/cffffff+"+t.mpRecover+"%/p"),this.label_add3.text="→ +"+t.nextMpRecover+"%";i=t.maxStoreHours;var o=Math.floor(t.nextMaxStoreMinutes/30)/2;this.label_exp.textFlow=Tool.convertDescToTextFlow(i+"  /c00ff00→/p  "+o)}var a=xself.bag.getItemNumByID(128);this.label_cost.textFlow=Tool.convertDescToTextFlow("消耗祈祷石：/cffffff"+t.itemCount+"/p"),this.label_all.textFlow=Tool.convertDescToTextFlow("剩余祈祷石：/cffffff"+a+"/p")}}},e}(ComponentBase);__reflect(OffLineExpUpgradePanel.prototype,"OffLineExpUpgradePanel");var ProgressBarOffLineExp=function(t){function e(){var e=t.call(this)||this;return e._value=0,e._max=100,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._value=t,this._max=e,this.update()},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(t){this._max=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.init){this._value>this._max&&(this._value=this._max),this._value<0&&(this._value=0);var t=this._value/this._max;this.thumb.scaleX=t,this.label_value.text=this._value.toString()}},e}(ComponentBase);__reflect(ProgressBarOffLineExp.prototype,"ProgressBarOffLineExp");var MercenarydDetailRolePanel=function(t){function e(){var e=t.call(this)||this;return e._selectIdx=0,e._imgTouchList=new Array,e._objList=new Array,e._imgSelectList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){for(var n in t.prototype.onAddToStage.call(this,e),this._objList=[this._mercenary,this._pet],this._imgSelectList=[this.img_select_bg1,this.img_select_bg2],this._imgTouchList=[this.img_touch1,this.img_touch2],this._imgTouchList)this._imgTouchList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSpriteTouch,this);this._starObjX=this.img_stra.x+this.img_stra.width/2,this.update(),ButtonUtils.addTouchEvent(this.btn_rest,this.onReset,this),ButtonUtils.addTouchEvent(this.btn_fire,this.onFire,this)},e.prototype.onReset=function(){this._state?Mercenary.doMercenarySetStatus(this._mercenary,Mercenary.SOLDIER_STATE_SLEEP):Mercenary.doMercenarySetStatus(this._mercenary,Mercenary.SOLDIER_STATE_FIGHT)},e.prototype.onFire=function(){this._pannelType==Mercenary.PANEL_MERCENARY_SHOP_TYPE?Mercenary.doMercenaryBuyMsg(this._mercenary):Mercenary.doMercenaryDelMsg(this._mercenary)},e.prototype.onSpriteTouch=function(t){var e=t.target,n=this._imgTouchList.indexOf(e);n>=0&&n!=this._selectIdx&&(this._selectIdx=n,this.update())},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_rest),ButtonUtils.removeTouchEvent(this.btn_fire),ButtonUtils.removeTouchEvent(this.img_touch1),ButtonUtils.removeTouchEvent(this.img_touch2)},e.prototype.setData=function(t,e){this._mercenary=t,this._pet=this._mercenary.getPet(),this._pannelType=e,this._state=null!=xself.getMercenaryById(this._mercenary.groupId),this.update()},e.prototype.reset=function(){},e.prototype.update=function(){if(0!=this.init&&null!=this._mercenary){this.reset();var t=this._objList[this._selectIdx];if(this._selectIdx!=e.SELECT_IDX_PET||null!=this._pet){if(this._mercenary&&!this._mercenarySprite){var n=null==this._mercenary.sprite?this._mercenary.createSprite(!1):this._mercenary.sprite;this._mercenarySprite=GameSprite.cloneSprite(n),this._mercenarySprite.setScale(nato.mapRatio),this.rect_mercenary1.addChild(this._mercenarySprite)}if(this._pet&&!this._petSprite){var i=null==this._pet.sprite?this._pet.createSprite(!1):this._pet.sprite;this._petSprite=GameSprite.cloneSprite(i),this._petSprite.setScale(nato.mapRatio),this.rect_mercenary2.addChild(this._petSprite)}for(var o=this._imgSelectList,a=0,r=o.length;r>a;a++)a==this._selectIdx?o[a].visible=!0:o[a].visible=!1;this.lab_name.text=t.getName(),this.lab_lv.text=t.getLevel().toString(),this.lab_caree.text=Define.getJobString(t.getJob());var s=t.get(ModelConst.HP),l=t.get(ModelConst.HPMAX),_=t.get(ModelConst.MP),h=t.get(ModelConst.MPMAX);this.bar_hp.labelDisplay.text=s+"/"+l,this.bar_hp.minimum=0,this.bar_hp.maximum=l,this.bar_hp.value=s,this.bar_mp.labelDisplay.text=_+"/"+h,this.bar_mp.minimum=0,this.bar_mp.maximum=h,this.bar_mp.value=_;var u=Tool.convertDescToTextFlow(t.getInfo());this.lab_des.textColor=ColorUtils.COLOR_TEXT_GOLD,this.lab_des.textFlow=u,this.lab_des.height=this.lab_des.textHeight+10,this.lab_stely.text=Define.getMercenaryFightString(t.monstertype),this.lab_type.text=Define.getAtkTypeString(t.atkType),this.lab_time.text=this._mercenary.getCoolDownTime(this._pannelType==Mercenary.PANEL_MERCENARY_SHOP_TYPE),this.setStar(this.img_stra,this._starObjX),this._pannelType==Mercenary.PANEL_MERCENARY_SHOP_TYPE?(this.btn_fire.x=this.btn_rest.x,this.btn_fire.y=this.btn_rest.y,this.btn_rest.visible=!1,this.btn_fire.label=GameText.STR_EMPLOY):this.btn_rest.label=this._state?GameText2.STR_REST:GameText2.STR_FIGHT}}},e.prototype.setStar=function(t,e){var n,i=Math.floor(this._mercenary.strength/20);n=this._mercenary.strength/20-i>=.5?i+.5:i,t.setData(n),t.x=e-t.getShowWidth()/2},e.SELECT_IDX_MERCENARY=0,e.SELECT_IDX_PET=1,e}(ComponentBase);__reflect(MercenarydDetailRolePanel.prototype,"MercenarydDetailRolePanel");var MercenaryDetailScene=function(t){function e(){var e=t.call(this)||this;return e.op=0,e._tabIndex=0,e._index=0,e.isAttributeOpen=!1,e._tabBtnList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.btn_mercenary,this.btn_pro];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this._ProItemList=new Array,this._tabIndex=0,this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.btn_close)},e.prototype.onTabBtnTouch=function(t){this.op=e.OP_TABLE;var n=t.target,i=this._tabBtnList.indexOf(n);i>=0&&i!=this._tabIndex&&(this._tabIndex=i,this.updateTab())},e.prototype.onClose=function(){PanelManager.closeScene(!1,1)},e.prototype.reset=function(){this.container1.reset(),this.container.reset(),this._index=0},e.prototype.setData=function(t,n){this._panelType=n,this._mercenary=t,this.op=e.OP_SETDATA,this.isAttributeOpen=!1,this.reset()},e.prototype.updateTab=function(){if(ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this._tabIndex==e.TAB_INDEX_MERCENARY){if(this.container.visible=!1,this.container1.visible=!0,null!=this.mercenaryDetailRolePanel&&this.op==e.OP_TABLE)return void this.mercenaryDetailRolePanel.setData(this._mercenary,this._panelType);this.mercenaryDetailRolePanel=new MercenarydDetailRolePanel,nato.attachSkin(this.mercenaryDetailRolePanel),this.mercenaryDetailRolePanel.setData(this._mercenary,this._panelType),this.container1.add(this.mercenaryDetailRolePanel),this.container1.update()}else if(this._tabIndex==PetScene.TAB_INDEX_MERCENARY){if(this.container.visible=!0,this.container1.visible=!1,this.op==e.OP_TABLE&&1==this.isAttributeOpen)return;this.addAttribute(PlayerInfoUIAction.ATTR_SPEED,GameText.STR_MONSTER_SPEED,this._mercenary.get(ModelConst.SPEED).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DMG,GameText.STR_ATTR_ATK,this._mercenary.get(ModelConst.ATK_MIN)+"~"+this._mercenary.get(ModelConst.ATK_MAX)),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_TIME,GameText.STR_ATTR_ATK_TIME,this._mercenary.get(ModelConst.ATK_TIME).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_STR,GameText.STR_CHANGE_ATT_DESC_ATK_STR,this._mercenary.get(ModelConst.ATK_STR).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_AGI,GameText.STR_CHANGE_ATT_DESC_ATK_AGI,this._mercenary.get(ModelConst.ATK_AGI).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_MAGIC,GameText.STR_CHANGE_ATT_DESC_ATK_MAGIC,this._mercenary.get(ModelConst.ATK_MAGIC).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_STR,GameText.STR_CHANGE_ATT_DESC_DEF_STR,this._mercenary.get(ModelConst.DEF_STR).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_AGI,GameText.STR_CHANGE_ATT_DESC_DEF_AGI,this._mercenary.get(ModelConst.DEF_AGI).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_MAGIC,GameText.STR_CHANGE_ATT_DESC_DEF_MAGIC,this._mercenary.get(ModelConst.DEF_MAGIC).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DODGE,GameText.STR_CHANGE_ATT_DESC_DODGE,this._mercenary.get(ModelConst.DODGE).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_RATE,GameText.STR_ATTR_HIT_RATE,this._mercenary.get(ModelConst.HIT_RATE).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_MAGIC,GameText.STR_ATTR_HIT_MAGIC,this._mercenary.get(ModelConst.HIT_MAGIC).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_CRITICAL,GameText.STR_ATTR_CRITICAL,this._mercenary.get(ModelConst.CRITICAL).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_WIL,GameText.STR_ATTR_WIL,this._mercenary.get(ModelConst.WIL).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_TOUGH,GameText.STR_ATTR_TOUGH,this._mercenary.get(ModelConst.TOUGH).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_BLOCK,GameText.STR_ATTR_BLOCK,this._mercenary.get(ModelConst.BLOCK).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_BRK,GameText.STR_ATTR_BRK,this._mercenary.get(ModelConst.BRK_ARMOR).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_INSIGHT,GameText.STR_ATTR_INSIGHT,this._mercenary.get(ModelConst.INSIGHT).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_FIELD,GameText.STR_ATTR_DEF_FIELD,this._mercenary.get(ModelConst.DEF_FIELD).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_BACK,GameText.STR_ATTR_BACK,this._mercenary.get(ModelConst.BACK).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_BACK,GameText.STR_ATTR_MAGIC_BACK,this._mercenary.get(ModelConst.MAGIC_BACK).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_GET_HP,GameText.STR_ATTR_GET_HP,this._mercenary.get(ModelConst.LIFE_ABSORPTION).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_GET_MP,GameText.STR_ATTR_GET_MP,this._mercenary.get(ModelConst.MANA_ABSORPTION).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_PEN,GameText.STR_ATTR_MAGIC_PEN,this._mercenary.get(ModelConst.MAGIC_PENETRATION).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_FORCE_HIT,GameText.STR_ATTR_FORCE_HIT,this._mercenary.get(ModelConst.FORCE_HIT).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_HP,GameText.STR_ATTR_AUTO_HP,this._mercenary.get(ModelConst.HEAL_RECOVERY).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_MP,GameText.STR_ATTR_AUTO_MP,this._mercenary.get(ModelConst.MANA_RECOVERY).toString()),this.addAttribute(PlayerInfoUIAction.ATTR_KEEPOUT_ATK_TIME,GameText.STR_ATTR_KEEPOUT_ATK_TIME,this._mercenary.get(ModelConst.KEEPOUT_ATK_TIME).toString()),this.container.update(),this.isAttributeOpen=!0}},e.prototype.addAttribute=function(t,e,n){var i=this._ProItemList[this._index];i||(i=new MercenaryProItem,nato.attachSkin(i),this._ProItemList[this._index]=i),i.setData(t,e,n,this._mercenary),this.container.add(this._ProItemList[this._index]),this._index++},e.TAB_INDEX_MERCENARY=0,e.TAB_INDEX_PROPERTY=1,e.OP_SETDATA=1,e.OP_TABLE=2,e}(ComponentBase);__reflect(MercenaryDetailScene.prototype,"MercenaryDetailScene");var MercenaryItem=function(t){function e(){var e=t.call(this)||this;return e._isFight=!1,e.starX=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_state,this.onState,this),ButtonUtils.addTouchEvent(this.btn_detail,this.onDetail,this),ButtonUtils.addTouchEvent(this.btn_fire,this.onOperate,this),this.starX=this.mercenary_star.x+this.mercenary_star.width/2,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_state),ButtonUtils.removeTouchEvent(this.btn_detail),ButtonUtils.removeTouchEvent(this.btn_fire)},e.prototype.onState=function(){this._isFight?Mercenary.doMercenarySetStatus(this._mercenary,Mercenary.SOLDIER_STATE_SLEEP):Mercenary.doMercenarySetStatus(this._mercenary,Mercenary.SOLDIER_STATE_FIGHT)},e.prototype.onDetail=function(){Mercenary.doMercenaryInfoMsg(this._mercenary,GameWorld.getPlayerID(),this._panelType==Mercenary.PANEL_MERCENARY_SHOP_TYPE,this._panelType)},e.prototype.onOperate=function(){this._panelType==Mercenary.PANEL_MERCENARY_OTHER_TYPE?Mercenary.doMercenaryDelMsg(this._mercenary):Mercenary.doMercenaryBuyMsg(this._mercenary)},e.prototype.setData=function(t,e){this._mercenary=t,this._panelType=e,xself.getMercenaryById(this._mercenary.groupId)&&(this._isFight=!0),this.createMemberShow(),this.update()},e.prototype.createMemberShow=function(){this.group_head.removeChildren(),this.mercenarySprite=this._mercenary.createSprite(!1),this.mercenarySprite.setScale(nato.mapRatio),this.group_head.addChild(this.mercenarySprite)},e.prototype.setStar=function(t,e){var n,i=Math.floor(e/20);n=e/20-i>=.5?i+.5:i,t.setData(n),t.x=75-t.getShowWidth()/2},e.prototype.reset=function(){this.group_mercenary_shop.visible=!0,this.mercenary_star.visible=!0,this.btn_state.visible=!0,this.group_gold.visible=!0,this.group_gold_leaf.visible=!0,this.group_gold_coin.visible=!0,this.group_fight.visible=!0,this.lab_gold.text="",this.lab_gold_leaf.text="",this.lab_gold_coin.text=""},e.prototype.update=function(){this.init&&null!=this._mercenary&&(this.reset(),this._panelType==Mercenary.PANEL_MERCENARY_OTHER_TYPE?(this.group_mercenary_shop.visible=!1,this.mercenary_star.visible=!1):(this.btn_state.visible=!1,this.btn_fire.label=GameText.STR_EMPLOY,0==this._mercenary.money1?this.group_gold.visible=!1:this.lab_gold.text=this._mercenary.money1.toString(),0==this._mercenary.money2?this.group_gold_leaf.visible=!1:this.lab_gold_leaf.text=this._mercenary.money2.toString(),0==this._mercenary.money3?this.group_gold_coin.visible=!1:this.lab_gold_coin.text=this._mercenary.money3.toString()),this.setStar(this.mercenary_star,this._mercenary.strength),this.lab_lv.text=this._mercenary.getLevel()+GameText.STR_STEP,this.lab_name.text=this._mercenary.getName(),this.lab_carre.text=Define.getJobString(this._mercenary.getJob()),this.lab_pro.text=Define.getMercenaryFightString(this._mercenary.monstertype),this.lab_time.text=this._mercenary.getCoolDownTime(this._panelType==Mercenary.PANEL_MERCENARY_SHOP_TYPE),this._isFight=null!=xself.getMercenaryById(this._mercenary.groupId),this.btn_state.label=this._isFight?GameText2.STR_REST:GameText2.STR_FIGHT,this.group_fight.visible=this._isFight&&this._panelType==Mercenary.PANEL_MERCENARY_OTHER_TYPE)},e}(ComponentBase);__reflect(MercenaryItem.prototype,"MercenaryItem");var MercenaryProItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_des,this.onBtnExplainTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_des)},e.prototype.onBtnExplainTouch=function(){this.attrDes&&AlertPanel.alertTipsTextFlow(GameText.STR_ATTRIBUTE_INFO,this.attrDes)},e.prototype.setData=function(t,e,n,i){this.attrID=t,this.attrName=e,this.attrValue=n;var o=PlayerInfoUIAction.getPlayerAttributeText(this.attrID,i);this.attrDes=Tool.convertDescToTextFlow(o)},e.prototype.reset=function(){},e.prototype.update=function(){this.init&&(this.lab_pro.text=this.attrName,this.lab_value.text=this.attrValue,this.cacheAsBitmap=!0)},e}(ComponentBase);__reflect(MercenaryProItem.prototype,"MercenaryProItem");var MercenaryShop=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_return,this.onClose,this),this._MercenaryItemList=new Array,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_return)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t){this._mercenaryList=t},e.prototype.opMercenary=function(t){var e=this._mercenaryList.indexOf(t);e>=0&&(this._mercenaryList.splice(e,1),this.update())},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.getMercenaryItemList=function(){return this._MercenaryItemList},e.prototype.update=function(){if(0!=this.init&&null!=this._mercenaryList){this.reset();for(var t=this._mercenaryList.length,e=0;t>e;e++){var n=this.getMercenaryItem();n instanceof MercenaryItem&&(this.container.add(n),n.setData(this._mercenaryList[e],Mercenary.PANEL_MERCENARY_SHOP_TYPE))}this.container.update();egret.callLater((function(){guide.isStatusFlag(guide.IS_GUIDE_BATTLE_FAIL)&&GameWorld.setGuide(GameWorld.GUIDE_BATTLE_FAIL_SHOP)}),this)}},e.prototype.getMercenaryItem=function(){var t=this._MercenaryItemList[this._index];return t||(t=new MercenaryItem,nato.attachSkin(t),this._MercenaryItemList[this._index]=t),this._index++,t},e.pageDisplayNum=127,e.currentPage=1,e}(ComponentBase);__reflect(MercenaryShop.prototype,"MercenaryShop");var PetCompositeSelectItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.checkbox_select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckboxSelect,this),ButtonUtils.addTouchEvent(this.btn_detail,this.onBtnDetail,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.checkbox_select.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckboxSelect,this),ButtonUtils.removeTouchEvent(this.btn_detail)},e.prototype.onBtnDetail=function(){MyPet.doPetSeeMsg(this._petComposite.petcompositepet,this.getPetDetailBack,this)},e.prototype.getPetDetailBack=function(){PanelManager.openPetDetailScene(this._petComposite.petcompositepet)},e.prototype.onCheckboxSelect=function(t){this._petComposite&&(this._petComposite.ischoice=!this._petComposite.ischoice,this.checkbox_select&&(this.checkbox_select.selected=this._petComposite.ischoice))},e.prototype.setData=function(t){this._petComposite=t},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._petComposite){var t=Tool.manageString(GameText.getText(GameText.TI_LEVEL),this._petComposite.petlevel+"")+"  "+PowerString.makeColorString(this._petComposite.petname,Define.getGradeColor(this._petComposite.petgrade));this.label_name.textFlow=Tool.convertDescToTextFlow(t),this.checkbox_select.selected=this._petComposite.ischoice}},e}(ComponentBase);__reflect(PetCompositeSelectItem.prototype,"PetCompositeSelectItem");var PetCompositeSelectPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOK,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnOK=function(){null!=this._petComposite&&PetComposite.doPetCompositeEnSure(this._petComposite.pettype,this._petComposite.petgrade,this._petComposite.getSelectslotposArray(),this._petComposite.getEnSureSelectInfo(),this._petComposite.petneedmoney1,this._petComposite.petneedmoney2,this._petComposite.petneedmoney3,this._petComposite.petid)},e.prototype.setData=function(t){this._petComposite=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._petComposite&&null!=this._petComposite.vcompositeList)){for(var t=0;t<this._petComposite.vcompositeList.length;t++){var e=this._petComposite.vcompositeList[t];if(null!=e){var n=this.getItem();n.setData(e),this.container.add(n)}}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new PetCompositeSelectItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(PetCompositeSelectPanel.prototype,"PetCompositeSelectPanel");var PetDetailPanel=function(t){function e(){var e=t.call(this)||this;return e.growLevelImages=[],e._starGrowX=0,e._starLearnX=0,e._fromType=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_rename,this.onBtnRename,this),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplain,this),ButtonUtils.addTouchEvent(this.btn_fight,this.onBtnFight,this),ButtonUtils.addTouchEvent(this.btn_free,this.onBtnFree,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_reborn,this.onBtnReborn,this),ButtonUtils.addTouchEvent(this.btn_wash,this.onBtnWash,this),ButtonUtils.addTouchEvent(this.btn_potential,this.onBtnPotentail,this),0==this._starGrowX&&(this._starGrowX=this.star_grow.x+this.star_grow.width/2,this._starLearnX=this.star_learn.x+this.star_learn.width/2),this.growLevelImages=[this.growLevel_1,this.growLevel_2,this.growLevel_3,this.growLevel_4,this.growLevel_5,this.growLevel_6,this.growLevel_7,this.growLevel_8,this.growLevel_9,this.growLevel_10],this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_rename),ButtonUtils.removeTouchEvent(this.btn_explain),ButtonUtils.removeTouchEvent(this.btn_fight),ButtonUtils.removeTouchEvent(this.btn_free),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_reborn),ButtonUtils.removeTouchEvent(this.btn_wash),ButtonUtils.removeTouchEvent(this.btn_potential)},e.prototype.onBtnRename=function(){MyPet.doPetChangeNameMsg(this.pet)},e.prototype.onBtnExplain=function(){if(null!=this.pet){var t=this.pet.cp,e=this.pet.growLevel,n=GameText.STR_PET_EXPLAIN_INFO;n=Tool.manageStringU(n,"",!1),n=Tool.manageStringU(n,t.toString(),!1),n=Tool.manageStringU(n,e.toString(),!1),AlertPanel.alertTips(GameText.STR_PET_EXPLAIN,n)}},e.prototype.onBtnFight=function(){this._fromType==PetDetailScene.FromType_normal?null==xself.getPet()||"出战"==this.btn_fight.label?ItemManager.doEquipAction(xself,this.pet.petItem,PlayerBag.PET_POS,this.pet,this.onFightHandler,this):ItemManager.doUnEquipAction(xself,this.pet.petItem,this.pet,this.onRestHandler,this):PanelManager.closeScene()},e.prototype.onFightHandler=function(){this.btn_fight.label="休息"},e.prototype.onRestHandler=function(){this.btn_fight.label="出战"},e.prototype.onBtnFree=function(){this._fromType==PetDetailScene.FromType_composite?PetComposite.doPetCompositeImmediately(this.pet):this._fromType==PetDetailScene.FromType_petRaiders?AlertPanel.alertTipsCommon(this.pet.petraidersinfo,!1):ItemManager.doDelEquipAction(xself,this.pet.petItem,this.onFreeHandler,this)},e.prototype.onFreeHandler=function(){PanelManager.closeScene()},e.prototype.onBtnItem=function(){if(this._fromType==PetDetailScene.FromType_composite)PetComposite.doPetCompositeSelectPetData(this.pet);else{var t=xself.bag.getCanUsePetItemList2();if(0==t.length)return void AlertPanel.alertCommon(GameText.STR_NO_WORLD_ITEM_USE);PanelManager.openDrugPanel(t,DrugPanel.Type_item,DrugPanel.SUB_TYPE_PET_ITEM_LIST)}},e.prototype.onBtnReborn=function(){MyPet.doOpenPetProShop(xself,DrugPanel.SUB_PET_ITEM_RESET2,this.pet)},e.prototype.onBtnWash=function(){MyPet.doOpenPetProShop(xself,DrugPanel.SUB_PET_ITEM_RESET,this.pet)},e.prototype.onBtnPotentail=function(){MyPet.doOpenPetProShop(xself,DrugPanel.SUB_PET_ITEM_ADD_SKILL,this.pet)},e.prototype.reset=function(){},e.prototype.getPet=function(){return this.pet},e.prototype.setStar=function(t,e){var n=0,i=Math.floor(e/20);.5>=(n=e/20-i>=.5?i+.5:i)&&(n=.5),t.setData(n)},e.prototype.updateName=function(t){this.label_name.text=t},e.prototype.update=function(t,e){if(void 0===e&&(e=0),this.init&&null!=t){this.pet=t;var n=xself.getPet()&&xself.getPet().getId()==t.getId();for(var i in n?this.onFightHandler():this.onRestHandler(),this.label_level.text=t.getLevel()+"级",this.label_name.textColor=Define.getGradeColor(null!=t.petItem?t.petItem.grade:t.grade),this.label_name.text=t.getName(),this.label_grade.text=t.growLevel+"",this.growLevelImages)this.growLevelImages[i].visible=!1;for(var o=0;o<t.cp;o++)this.growLevelImages[o].visible=!0;this.petSprite&&this.sprite_ctn.contains(this.petSprite)&&this.sprite_ctn.removeChild(this.petSprite),null==this.pet.sprite?this.petSprite=SpriteHelper.createPetSpriteByIcon(this.pet.getIcon1(),!1):this.petSprite=GameSprite.cloneSprite(this.pet.sprite),this.petSprite.scaleX=this.petSprite.scaleY=xhd?nato.mapRatio:1,this.sprite_ctn.addChild(this.petSprite);var a=t.get(ModelConst.HP),r=t.get(ModelConst.HPMAX),s=t.get(ModelConst.MP),l=t.get(ModelConst.MPMAX),_=t.get(ModelConst.EXP),h=t.get(ModelConst.EXPMAX);this.bar_hp.labelDisplay.text=a+"/"+r,this.bar_hp.minimum=0,this.bar_hp.maximum=r,this.bar_hp.value=a,this.bar_mp.labelDisplay.text=s+"/"+l,this.bar_mp.minimum=0,this.bar_mp.maximum=l,this.bar_mp.value=s,this.bar_exp.minimum=0,this.bar_exp.maximum=h,this.bar_exp.value=_,this.label_str.text=this.getAttDesc(t.str,t.get(ModelConst.STR)),this.label_con.text=this.getAttDesc(t.con,t.get(ModelConst.CON)),this.label_agi.text=this.getAttDesc(t.agi,t.get(ModelConst.AGI)),this.label_ilt.text=this.getAttDesc(t.ilt,t.get(ModelConst.ILT)),this.label_wis.text=this.getAttDesc(t.wis,t.get(ModelConst.WIS)),this.label_quality.text=Define.getGradeString(t.grade,!0),this.label_type.text=Define.getJobString(t.getJob()),this.label_life.text=t.getPetAge()+"",this.setStar(this.star_grow,t.grow),this.setStar(this.star_learn,t.compre),this.star_grow.x=this._starGrowX-this.star_grow.getShowWidth()/2,this.star_learn.x=this._starLearnX-this.star_learn.getShowWidth()/2,this._fromType=e,this._fromType==PetDetailScene.FromType_composite?(this.btn_reborn.visible=!1,this.btn_wash.visible=!1,this.btn_potential.visible=!1,this.btn_rename.visible=!1,this.btn_fight.visible=!0,this.btn_free.visible=!0,this.btn_item.visible=!0,this.btn_fight.label=GameText.getText(GameText.TI_BACK),this.btn_free.label=GameText.STR_PETCOMPOSITE_IMMEDIATELY,this.btn_item.label=GameText.STR_PETCOMPOSITE_SELECT_DATA):this._fromType==PetDetailScene.FromType_other||this._fromType==PetDetailScene.FromType_trade||this._fromType==PetDetailScene.FromType_see?(this.btn_reborn.visible=!1,this.btn_wash.visible=!1,this.btn_potential.visible=!1,this.btn_free.visible=!1,this.btn_item.visible=!1,this.btn_rename.visible=!1,this.btn_fight.visible=!0,this.btn_fight.label=GameText.getText(GameText.TI_BACK)):this._fromType==PetDetailScene.FromType_petRaiders?(this.btn_reborn.visible=!1,this.btn_wash.visible=!1,this.btn_potential.visible=!1,this.btn_item.visible=!1,this.btn_rename.visible=!1,this.btn_fight.visible=!0,this.btn_free.visible=!0,this.btn_fight.label=GameText.getText(GameText.TI_BACK),this.btn_free.label="攻略"):(this.btn_reborn.visible=!0,this.btn_wash.visible=!0,this.btn_potential.visible=!0,this.btn_fight.visible=!0,this.btn_free.visible=!0,this.btn_item.visible=!0,this.btn_rename.visible=!0,xself.getPet()==this.getPet()?this.btn_fight.label="休息":this.btn_fight.label=GameText.getText(GameText.TI_PET_EQUIP),this.btn_free.label=GameText.getText(GameText.TI_PET_DROP),this.btn_item.label=GameText.getText(GameText.TI_PET_ITEM))}},e.prototype.getAttDesc=function(t,e){var n=new StringBuffer;n.append(t+"");var i=e-t;return n.append("(+"+i+")"),n.toString()},e}(ComponentBase);__reflect(PetDetailPanel.prototype,"PetDetailPanel");var PetDetailScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_pet,this.tabBtn_prop,this.tabBtn_skill];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this._tabIndex=0,this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setData=function(t,n){void 0===n&&(n=0),this._pet=t,e.fromType=n,n==e.FromType_other?this.tabBtn_skill.visible=!1:this.tabBtn_skill.visible=!0,this.updateTab()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_PET?(this.addChild(this.detailPanel),this.detailPanel.update(this._pet,e.fromType)):this._tabIndex==e.TAB_INDEX_PROP?(this.addChild(this.propPanel),this.propPanel.update(this._pet)):this._tabIndex==e.TAB_INDEX_SKILL&&(this.addChild(this.skillPanel),this.skillPanel.update(this._pet))},e.prototype.removeAllPanel=function(){this.detailPanel&&this.detailPanel.parent&&this.detailPanel.parent.removeChild(this.detailPanel),this.propPanel&&this.propPanel.parent&&this.propPanel.parent.removeChild(this.propPanel),this.skillPanel&&this.skillPanel.parent&&this.skillPanel.parent.removeChild(this.skillPanel)},e.TAB_INDEX_PET=0,e.TAB_INDEX_PROP=1,e.TAB_INDEX_SKILL=2,e.FromType_normal=0,e.FromType_composite=1,e.FromType_other=2,e.FromType_petRaiders=3,e.FromType_trade=4,e.FromType_see=5,e.fromType=0,e}(ComponentBase);__reflect(PetDetailScene.prototype,"PetDetailScene");var PetEquipDes=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.update()},e.prototype.onClose=function(){PopUpManager.removePopUp(PanelManager.getPanel(e,!1))},e.prototype.onAdd=function(){ItemManager.doWorldUseItemAction(xself,this._itemData,!1,this._pet.petItem,this._pet),PanelManager.closePetEquipDes()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btn_add.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this)},e.prototype.setData=function(t,e){this._itemData=t,this._pet=e,this.update()},e.prototype.update=function(){if(0!=this.init&&null!=this._itemData){this.img_item.itemData=this._itemData,this.label_name.text=this._itemData.name+" x "+this._itemData.quantity;var t=this._itemData.getInfo(),e=Tool.convertDescToTextFlow(t);this.label_desc.textFlow=e}},e}(ComponentBase);__reflect(PetEquipDes.prototype,"PetEquipDes");var PetListItem=function(t){function e(){var e=t.call(this)||this;return e._from=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._from==PetScene.FromType_sell?(Tool.removeObjSafe(this.btn_seal),Tool.removeObjSafe(this.btn_rename),Tool.removeObjSafe(this.btn_fight),Tool.removeObjSafe(this.btn_rest),Tool.removeObjSafe(this.btn_free)):(this.addChild(this.btn_seal),this.addChild(this.btn_rename),this.addChild(this.btn_fight),this.addChild(this.btn_rest),this.addChild(this.btn_free),ButtonUtils.addTouchEvent(this.btn_seal,this.onBtnSeal,this),ButtonUtils.addTouchEvent(this.btn_rename,this.onBtnRename,this),ButtonUtils.addTouchEvent(this.btn_fight,this.onBtnFight,this),ButtonUtils.addTouchEvent(this.btn_rest,this.onBtnRest,this),ButtonUtils.addTouchEvent(this.btn_free,this.onBtnFree,this)),ButtonUtils.addTouchEvent(this.btn_detail,this.onBtnDetail,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_seal),ButtonUtils.removeTouchEvent(this.btn_rename),ButtonUtils.removeTouchEvent(this.btn_fight),ButtonUtils.removeTouchEvent(this.btn_rest),ButtonUtils.removeTouchEvent(this.btn_detail),ButtonUtils.removeTouchEvent(this.btn_free)},e.prototype.onBtnSeal=function(){MyPet.doGetPetSealDetails(this.pet)},e.prototype.onBtnRename=function(){MyPet.doPetChangeNameMsg(this.pet)},e.prototype.onBtnFight=function(){ItemManager.doEquipAction(xself,this.pet.petItem,PlayerBag.PET_POS,this.pet)},e.prototype.onBtnRest=function(){ItemManager.doUnEquipAction(xself,this.pet.petItem,this.pet)},e.prototype.onBtnDetail=function(){this._from==PetScene.FromType_sell?ActorBuyHandler.doSeeSellActorInfo(this._player,ActorBuyHandler.ACTOR_SELL_INFO_TYPE_PET_DATA,this.pet):MyPet.doPetSeeMsg(this.pet,this.getPetDetailBack,this)},e.prototype.getPetDetailBack=function(){var t=this._from==PetScene.FromType_sell?PetDetailScene.FromType_trade:this._from;PanelManager.openPetDetailScene(this.pet,t)},e.prototype.onBtnFree=function(){ItemManager.doDelEquipAction(xself,this.pet.petItem)},e.prototype.setData=function(t,e,n){this.pet=t,this._from=e,this._player=n,this.update()},e.prototype.reset=function(){},e.prototype.update=function(){if(this.init&&null!=this.pet){var t=this.pet.getName();("守护鹰"==t||"熊猫"==t)&&(this.btn_seal.visible=!1),this.label_level.text=this.pet.getLevel()+"级",this.label_name.textColor=Define.getGradeColor(this.pet.petItem.grade),this.label_name.text=this.pet.getName(),this.petSprite&&this.sprite_ctn.contains(this.petSprite)&&this.sprite_ctn.removeChild(this.petSprite),this.petSprite=GameSprite.cloneSprite(this.pet.sprite),this.petSprite.scaleX=this.petSprite.scaleY=xhd?nato.mapRatio:1,this.sprite_ctn.addChild(this.petSprite);var e=!1,n=xself;this.pet==n.getPet()&&(e=!0),this.group_fightSign.visible=e,this.btn_fight.visible=!e,this.btn_rest.visible=e,this.group_cache.cacheAsBitmap=!0}},e}(ComponentBase);__reflect(PetListItem.prototype,"PetListItem");var PetName=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfire,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.textInput.textAlign=egret.HorizontalAlign.CENTER},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.reset()},e.prototype.onConfire=function(){return""==this.textInput.text?void(this.tips.text=GameText.STR_PET_NAME_NOTNULL):this.textInput.text.length>12?void(this.tips.text=GameText.STR_PET_NAME_TOOLONG):(this._callback(this.textInput.text),void PopUpManager.removePopUp(PanelManager.getPanel(e,!1)))},e.prototype.onCancel=function(){PopUpManager.removePopUp(PanelManager.getPanel(e,!1))},e.prototype.setData=function(t,e){this._pet=t,this._callback=e},e.prototype.reset=function(){this.textInput.text="",this.tips.text=""},e}(ComponentBase);__reflect(PetName.prototype,"PetName");var PetPropPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){if(this.init){this.reset();var e=t;this.initAttributeText(e);var n=0,i=e.get(ModelConst.LEVEL)>10;this.addAttribute(PlayerInfoUIAction.ATTR_POWER,"战力",""+e.getPower(),this.color_green);var o=t.getPetBornStatusInfo(!0,3,!1);Tool.isNullText(o)&&(o=GameText.STR_LIST_NULL),this.addAttribute(PlayerInfoUIAction.ATTR_BORNSTATUS,GameText.STR_ATTR_BORNSTATUS,o,this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_STR,GameText.STR_CHANGE_ATT_DESC_ATK_STR,""+e.get(ModelConst.ATK_STR),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_AGI,GameText.STR_CHANGE_ATT_DESC_ATK_AGI,""+e.get(ModelConst.ATK_AGI),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_MAGIC,GameText.STR_CHANGE_ATT_DESC_ATK_MAGIC,""+e.get(ModelConst.ATK_MAGIC),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_DMG,GameText.STR_ATTR_EQUIP_ATK,e.get(ModelConst.ATK_MIN)+"~"+e.get(ModelConst.ATK_MAX),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_TIME,GameText.STR_ATTR_ATK_TIME,""+e.get(ModelConst.ATK_TIME),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_RATE,GameText.STR_ATTR_HIT_RATE,""+e.get(ModelConst.HIT_RATE),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_MAGIC,GameText.STR_ATTR_HIT_MAGIC,""+e.get(ModelConst.HIT_MAGIC),this.color_green),n=e.get(ModelConst.BRK_ARMOR),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BRK,GameText.STR_ATTR_BRK,n+"",this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_CRITICAL,GameText.STR_ATTR_CRITICAL,""+e.get(ModelConst.CRITICAL),this.color_green),n=e.get(ModelConst.MAGIC_PENETRATION),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_PEN,GameText.STR_ATTR_MAGIC_PEN,""+n,this.color_green),n=e.get(ModelConst.FORCE_HIT),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_FORCE_HIT,GameText.STR_ATTR_FORCE_HIT,n+"%",this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_WIL,"无视状态抵抗",""+e.get(ModelConst.IGNORE_WIL),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_TOUCH,"无视伤害减免",""+e.get(ModelConst.IGNORE_TOUCH),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_BLOCK,"无视格挡",""+e.get(ModelConst.IGNORE_BLOCK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_BACK,"无视反击",""+e.get(ModelConst.IGNORE_BACK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_INSIGHT,"无视洞察",""+e.get(ModelConst.IGNORE_INSIGHT),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_MAGIC_BACK,"无视魔法反馈",""+e.get(ModelConst.IGNORE_MAGIC_BACK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_STR,GameText.STR_CHANGE_ATT_DESC_DEF_STR,""+e.get(ModelConst.DEF_STR),this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_AGI,GameText.STR_CHANGE_ATT_DESC_DEF_AGI,""+e.get(ModelConst.DEF_AGI),this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_MAGIC,GameText.STR_CHANGE_ATT_DESC_DEF_MAGIC,""+e.get(ModelConst.DEF_MAGIC),this.color_blue),n=e.get(ModelConst.BLOCK),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BLOCK,GameText.STR_ATTR_BLOCK,n+"",this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DODGE,GameText.STR_CHANGE_ATT_DESC_DODGE,""+e.get(ModelConst.DODGE),this.color_blue),n=e.get(ModelConst.INSIGHT),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_INSIGHT,GameText.STR_ATTR_INSIGHT,""+n,this.color_blue),n=e.get(ModelConst.BACK),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BACK,GameText.STR_ATTR_BACK,""+n,this.color_blue),n=e.get(ModelConst.TOUGH),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_TOUGH,GameText.STR_ATTR_TOUGH,n+"",this.color_blue),n=e.get(ModelConst.DEF_FIELD),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_DEF_FIELD,GameText.STR_ATTR_DEF_FIELD,""+n,this.color_blue),n=e.get(ModelConst.MAGIC_BACK),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_BACK,GameText.STR_ATTR_MAGIC_BACK,""+n,this.color_blue),n=e.get(ModelConst.WIL),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_WIL,GameText.STR_ATTR_WIL,n+"",this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_SPEED,GameText.STR_ATTR_SPEED,""+e.get(ModelConst.SPEED),this.color_yellow),n=e.get(ModelConst.KEEPOUT_ATK_TIME),this.addAttribute(PlayerInfoUIAction.ATTR_KEEPOUT_ATK_TIME,GameText.STR_ATTR_KEEPOUT_ATK_TIME,n+"",this.color_yellow),n=e.get(ModelConst.LIFE_ABSORPTION),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_GET_HP,GameText.STR_ATTR_GET_HP,""+n,this.color_yellow),n=e.get(ModelConst.MANA_ABSORPTION),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_GET_MP,GameText.STR_ATTR_GET_MP,""+n,this.color_yellow),n=e.get(ModelConst.HEAL_RECOVERY),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_HP,GameText.STR_ATTR_AUTO_HP,""+n,this.color_yellow),n=e.get(ModelConst.MANA_RECOVERY),(i||n>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_MP,GameText.STR_ATTR_AUTO_MP,""+n,this.color_yellow),this.container.update()}},e}(RolePropBasePanel);__reflect(PetPropPanel.prototype,"PetPropPanel");var PetScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._index=0,e.ItemObj=[PetListItem,MercenaryItem],e.fromType=0,e._tabBtnList=new Array,e._petItemList=new Array,e._MercenaryItemList=new Array,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_pet,this.tabBtn_mercenary];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this._tabIndex=PanelManager.PANEL_INDEX,this.updateTab(),xevent.addEventListener(WorldEvent.MERCENARY_REFRESH_INFO,this.onRefresh,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),xevent.removeEventListener(WorldEvent.MERCENARY_REFRESH_INFO,this.onRefresh,this)},e.prototype.setData=function(t,n){void 0===n&&(n=0),n==e.FromType_sell?this.tabBtn_mercenary.visible=!1:this.tabBtn_mercenary.visible=!0,this.fromType=n,this._player=t},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onRefresh=function(){PanelManager.getPanel(MercenaryDetailScene,!1)&&PanelManager.isPanelShow(MercenaryDetailScene)&&PanelManager.closeScene(),this.updateTab()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.reset();var t=this.container;if(this._tabIndex==e.TAB_INDEX_PET){var n=this._player,i=MyPet.doGetBagPetItem(n);if(null==i)return;for(var o=0,a=i.length;a>o;o++){var r=i[o],s=this.getPetItem();s instanceof PetListItem&&(s.setData(r,this.fromType,n),t.add(s))}t.update()}else if(this._tabIndex==e.TAB_INDEX_MERCENARY){n=xself;Mercenary.doMercenaryMyListMsg(n,(function(n){if(null!=n){for(var i=0,o=n.length;o>i;i++){var a=e.instance.getMercenaryItem();t.add(a),a.setData(n[i],Mercenary.PANEL_MERCENARY_OTHER_TYPE)}t.update()}}))}},e.prototype.getPetItem=function(){var t=this._petItemList[this._index];return t||(t=new PetListItem,nato.attachSkin(t),this._petItemList[this._index]=t),this._index++,t},e.prototype.getMercenaryItem=function(){var t=this._MercenaryItemList[this._index];return t||(t=new MercenaryItem,nato.attachSkin(t),this._MercenaryItemList[this._index]=t),this._index++,t},e.TAB_INDEX_PET=0,e.TAB_INDEX_MERCENARY=1,e.FromType_default=0,e.FromType_sell=1,e}(ComponentBase);__reflect(PetScene.prototype,"PetScene");var PetSeal=function(t){function e(){var e=t.call(this)||this;return e.item_head=new ItemIcon,nato.attachSkin(e.item_head),e.btnItemList=new Array,e._moneyType=new Array,e._sealType=new Array,e._btnIndex=-1,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),this.btnItemList=[this.btn_0,this.btn_1,this.btn_2],this._moneyType=[ModelConst.MONEY3,ModelConst.MONEY2,ModelConst.MONEY1],this._sealType=[e.SEAL_TYPE_1,e.SEAL_TYPE_2,e.SEAL_TYPE_3],ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this);for(var i=0;i<this.btnItemList.length;i++){this.btnItemList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this)}this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close);for(var n=0;n<this.btnItemList.length;n++){var i=this.btnItemList[n];ButtonUtils.removeTouchEvent(i)}},e.prototype.onClose=function(){PopUpManager.removePopUp(PanelManager.getPanel(e,!1))},e.prototype.onBtn=function(t){var e=t.target,n=this.btnItemList.indexOf(e);n>=0&&n!=this._btnIndex&&(this._btnIndex=n,this._petSeal=this._petSealList[this._btnIndex],MyPet.doGetPetSealSelect(this._petSeal))},e.prototype.setData=function(t,e,n){this._info=t,this._petSealList=e,this._pet=n},e.prototype.reset=function(){this._btnIndex=-1},e.prototype.update=function(){if(0!=this.init&&null!=this._info&&null!=this._pet){this.reset();var t=this._pet.petItem;this.item_head.setData(t.bagIcon,t.grade),this.container.add(this.item_head,18,15);var e=Tool.convertDescToTextFlow(this._info);this.desc_label.textColor=ColorUtils.COLOR_TEXT_GOLD,this.desc_label.textFlow=e,this.desc_label.height=this.desc_label.textHeight,this.container.add(this.desc_label,13,46);var n=this.container.totalHeight;this.container.updateAutoSize(n,600),this.group_btn.y=this.container.y+this.container.height,this.height=this.group_btn.y+this.group_btn.height+20,this.img_bg.height=this.height,this.img_bg2.height=this.container.y+this.container.height}},e.SEAL_TYPE_1=1,e.SEAL_TYPE_2=2,e.SEAL_TYPE_3=3,e}(ComponentBase);__reflect(PetSeal.prototype,"PetSeal");var PetSelectPanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._selectIndex=0,e._groupList=null,e._sprList=null,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._groupList&&(this._groupList=[this.group_spr0,this.group_spr1,this.group_spr2],this.group_spr0.touchChildren=!1,this.group_spr1.touchChildren=!1,this.group_spr2.touchChildren=!1),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),this.group_spr0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),this.group_spr1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),this.group_spr2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok),this.group_spr0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),this.group_spr1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this),this.group_spr2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTouch,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnOk=function(){if(this._type==e.Type_pet&&null!=this._petGuide){var t=this._petGuide.vPetList[this._selectIndex];t&&PetGuide.doPetGuideSelect(this._petGuide.itemslotPos,this._petGuide.itemid,t.getId())}else if(this._type==e.Type_mount&&null!=this._mountGuide){var n=this._mountGuide.vItemList[this._selectIndex];n&&MountGuide.doMountGuideSelect(this._mountGuide.itemslotPos,this._mountGuide.itemid,n.id)}},e.prototype.onGroupTouch=function(t){var e=t.target;if(e&&e.numChildren>0){var n=this._groupList.indexOf(e);-1!=n&&this.onSelectItem(n)}},e.prototype.onSelectItem=function(t){this._selectIndex=t,this.img_select0.visible=0==this._selectIndex,this.img_select1.visible=1==this._selectIndex,this.img_select2.visible=2==this._selectIndex,this._type==e.Type_pet?this.onSelectPet(t):this.onSelectMount(t)},e.prototype.setData=function(t,n){this._type=t,this._type==e.Type_pet?(this._petGuide=n,this._mountGuide=null):(this._petGuide=null,this._mountGuide=n)},e.prototype.reset=function(){this.init&&this.clearSpr()},e.prototype.clearSpr=function(){this.group_spr0.removeChildren(),this.group_spr1.removeChildren(),this.group_spr2.removeChildren(),this._sprList=null},e.prototype.update=function(){this.init&&(this._type==e.Type_pet?(this.group_pet.visible=!0,this.group_mount.visible=!1,this.updatePet()):(this.group_pet.visible=!1,this.group_mount.visible=!0,this.updateMount()))},e.prototype.updatePet=function(){if(null!=this._petGuide&&null!=this._petGuide.vPetList){this.clearSpr(),this.label_title.text="选择宠物",this.label_desc.text="从以下3个宠物中选择一个心仪的伙伴吧！",this.label_info.text="宠物信息",this._sprList=[];for(var t=0;t<this._petGuide.vPetList.length;t++){var e=this._petGuide.vPetList[t],n=SpriteHelper.createPetSpriteByIcon(e.getIcon1(),!1);n.setScale(nato.mapRatio),this._groupList[t].addChild(n),this._sprList.push(n)}this.onSelectItem(0)}},e.prototype.onSelectPet=function(t){if(null!=this._petGuide&&null!=this._petGuide.vPetList){var e=this._petGuide.vPetList[t];e?(this.label_petName.text=e.getName(),this.label_petType.text=Define.getJobString(e.getJob()),this.setStar(this.star_grow,e.grow),this.setStar(this.star_learn,e.compre)):(this.label_petName.text="",this.label_petType.text="",this.setStar(this.star_grow,0),this.setStar(this.star_learn,0))}},e.prototype.updateMount=function(){if(null!=this._mountGuide){this.clearSpr(),this.label_title.text="选择坐骑",this.label_desc.text="从以下3个坐骑中选择一个心仪的伙伴吧！",this.label_info.text="坐骑信息";var t=xself;this._sprList=[];for(var e=0;e<this._mountGuide.vItemList.length;e++){var n=this._mountGuide.vItemList[e],i=Player.getCompareSprite(t,n);i.setScale(1),this._groupList[e].addChild(i),this._sprList.push(i)}this.onSelectItem(0)}},e.prototype.onSelectMount=function(t){if(null!=this._mountGuide&&null!=this._mountGuide.vItemList){var e=this._mountGuide.vItemList[t];if(e){var n=PowerString.makeColorString(e.name,Define.getGradeColor(e.grade));this.label_mountName.textFlow=Tool.convertDescToTextFlow(n),this.label_mountDesc.textFlow=Tool.convertDescToTextFlow(e.getDesc(null))}else this.label_mountName.text="",this.label_mountDesc.text=""}},e.prototype.setStar=function(t,e){var n,i=Math.floor(e/20);n=e/20-i>=.5?i+.5:i,t.setData(n)},e.Type_pet=1,e.Type_mount=2,e}(ComponentBase);__reflect(PetSelectPanel.prototype,"PetSelectPanel");var PetSkillCompare=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCreate=function(){this._btnList=new Array},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n,i,o,a){this._menuList=t,this._info=e,this._equipType=n,this._pet=i,this._oldSkill=o,this._newSkill=a},e.prototype.copyBtn=function(){if(null!=this.btn_mode0){for(var t=this.btn_mode0.width,e=this.btn_mode0.height,n=0;n<this._menuList.length;n++){var i=new eui.Button;i.skinName=xhd?"CommonBtn2HDSkin":"CommonBtn2SDSkin",this.btn_mode0.visible=!1,i.x=0,i.label=this._menuList[n],i.width=t,i.height=this.btn_mode0.height,i.y=0+n*e,this._btnList.push(i),this.group_btn.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBtn,this)}this.group_btn.height=e*this._menuList.length}},e.prototype.onTouchBtn=function(t){var e=t.target,n=this._btnList.indexOf(e);this._touchIdx=n,this.onExcute(e)},e.prototype.onExcute=function(t){0==this._touchIdx?PopUpManager.removePopUp(PanelManager.getPanel(e,!1)):1==this._touchIdx?t.label==GameText.STR_PET_ADD_SKILL_USE||t.label==GameText.STR_PET_RESET_ITEM_USE?this._equipType==DrugPanel.SUB_PET_ITEM_RESET2||this._equipType==DrugPanel.SUB_PET_ITEM_RESET?MyPet.doPetUseResetItemMenuSelect(this._pet,this._pet.petItem,GameText.STR_PET_RESET_ITEM_USE):this._equipType==DrugPanel.SUB_PET_ITEM_ADD_SKILL&&MyPet.doSelectPetAddSkillMenu2(GameText.STR_PET_ADD_SKILL_USE,this._pet,this._pet.petItem):t.label==GameText.STR_PET_ADD_SKILL_ASK&&MyPet.doSelectPetAddSkillMenu(GameText.STR_PET_ADD_SKILL_ASK,this._pet,this._oldSkill,this._newSkill,this._pet.petItem):2==this._touchIdx&&MyPet.doSelectPetAddSkillMenu(GameText.STR_PET_ADD_SKILL_ASK,this._pet,this._oldSkill,this._newSkill,this._pet.petItem)},e.prototype.reset=function(){this._btnList.length=0,this.group_btn.removeChildren()},e.prototype.update=function(){if(0!=this.init&&null!=this._info){this.reset(),this.copyBtn();var t=Tool.convertDescToTextFlow(this._info);this.desc_label.textColor=ColorUtils.COLOR_TEXT_GOLD,this.desc_label.size=28,this.desc_label.textFlow=t;this.desc_label.height=this.desc_label.textHeight,this.container.add(this.desc_label,13,5);var e=this.desc_label.height+10;this.container.updateAutoSize(e+20,500),this.group_btn.y=this.container.y+this.container.height,this.height=this.group_btn.y+this.group_btn.height,this.img_bg.height=this.height+15,this.img_square.height=e+15,this.img_bg_color.height=this.height-15}},e}(ComponentBase);__reflect(PetSkillCompare.prototype,"PetSkillCompare");var PetSkillPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._isRestPet=!1,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_gotoLearn,this.onBtnGotoLearn,this),this.bg.touchEnabled=!1,this.update(this._pet)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_gotoLearn)},e.prototype.onBtnGotoLearn=function(){TodayEvent.doPetSkill()},e.prototype.reset=function(){this._index=0,this.container.reset(),this.skill_passive&&this.skill_passive.parent&&this.skill_passive.parent.removeChild(this.skill_passive),this.skill_active&&this.skill_active.parent&&this.skill_active.parent.removeChild(this.skill_active),this.skill_round&&this.skill_round.parent&&this.skill_round.parent.removeChild(this.skill_round),this.skill_formation&&this.skill_formation.parent&&this.skill_formation.parent.removeChild(this.skill_formation)},e.prototype.getPet=function(){return this._pet},e.prototype.update=function(t){if(this.init&&null!=t){this.reset(),this._pet=t,xself&&xself.getPet()==t?this._isRestPet=!1:this._isRestPet=!0;var e=this._pet.get(ModelConst.SP);this.label_haveSkillPoint.text=e.toString(),this.btn_gotoLearn.visible=this._pet.getLevel()>=15&&0==this._isRestPet,this.updateSkillList(GameText.STR_PASSIVE_SKILL,Define.SKILL_TYPE_PASSIVE),this.updateSkillList(GameText.STR_ACTIVE_SKILL,Define.SKILL_TYPE_ACTIVE),this.updateSkillList(GameText.STR_ROUND_SKILL,Define.SKILL_TYPE_ROUND),this.updateSkillList(GameText2.STR_FORMATION,Define.SKILL_TYPE_FORMATION),this.container.update()}},e.prototype.getContainerBySkillType=function(t){switch(t){case Define.SKILL_TYPE_PASSIVE:return this.skill_passive;case Define.SKILL_TYPE_ACTIVE:return this.skill_active;case Define.SKILL_TYPE_ROUND:return this.skill_round;case Define.SKILL_TYPE_FORMATION:return this.skill_formation}},e.prototype.updateSkillList=function(t,e){var n=Player.getSkillListByType(this._pet.skillList,e);if(Define.SKILL_TYPE_FORMATION==e&&(n=this._pet.formationList),null!=n&&0!=n.length){var i=this.getContainerBySkillType(e),o=(this.container.width-256)/2;this.container.add(i,o,-1);for(var a=0;a<n.length;a++)this.addSkillItem(n[a])}},e.prototype.addSkillItem=function(t){var e=this._itemList[this._index];e||(e=new RoleSkillItem,nato.attachSkin(e),this._itemList[this._index]=e),e.setData(t,this._pet,this._isRestPet),PetDetailScene.fromType==PetDetailScene.FromType_trade||PetDetailScene.fromType==PetDetailScene.FromType_other?e.isMe=!1:e.isMe=!0,this.container.add(e,0,-1),this._index++},e}(ComponentBase);__reflect(PetSkillPanel.prototype,"PetSkillPanel");var PetStarView=function(t){function e(){var e=t.call(this)||this;return e._starWidth=30,e._star=0,e._showRect=new egret.Rectangle(0,0,30,27),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._star=t,this._starWidth=xhd?30:15,this._showRect.width=this._starWidth*this._star,this.update()},e.prototype.getShowWidth=function(){return this._showRect.width},e.prototype.setPos=function(t,e){this.x=t,this.y=e},e.prototype.reset=function(){},e.prototype.update=function(){this.init&&(this.scrollRect=this._showRect)},e}(ComponentBase);__reflect(PetStarView.prototype,"PetStarView");var PetRaidersListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setPetRaiders=function(t){this._petRaiders=t,this._mountRaiders=null},e.prototype.setMountRaiders=function(t){this._mountRaiders=t,this._petRaiders=null},Object.defineProperty(e.prototype,"petRaiders",{get:function(){return this._petRaiders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mountRaiders",{get:function(){return this._mountRaiders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._petRaiders?(this.label_name.text=this._petRaiders.pet.name,this.label_desc.text=Define.getJobString(this._petRaiders.pet.getJob())):this._mountRaiders?(this.label_name.text=this._mountRaiders.item.name,this.label_desc.text=this._mountRaiders.item.reqLv+"级"):(this.label_name.text="",this.label_desc.text=""),this.img_select.visible=this._select)},e}(ComponentBase);__reflect(PetRaidersListItem.prototype,"PetRaidersListItem");var PetRaidersPanel=function(t){function e(){var e=t.call(this)||this;e._itemList=[],e._index=0,e._type=0,e._comboboxSelect=0,e._pet_comboBoxData=[],e._pet_comboBoxData.push({value:0,label:"全部"}),e._pet_comboBoxData.push({value:1,label:Define.getJobString(Raiders.petjobSortIDTable[1])}),e._pet_comboBoxData.push({value:2,label:Define.getJobString(Raiders.petjobSortIDTable[2])}),e._pet_comboBoxData.push({value:3,label:Define.getJobString(Raiders.petjobSortIDTable[3])}),e._mount_comboBoxData=[];for(var n=MountRaiders.mountLevelSortIDTable,i=0;i<n.length;i++)e._mount_comboBoxData.push({value:i,label:MountRaiders.mountLevelText[i]});return e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_detail,this.onBtnDetail,this),this.combobox_type.addEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),this.combobox_type.data=this._comboboxData,this.combobox_type.select=this._comboboxSelect,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_detail),this.combobox_type.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.clearSpr=function(){this.groupRole.removeChildren(),this._sprite=null},e.prototype.onBtnDetail=function(){if(null!=this._curSelectItem)if(this._type==e.Type_Pet){if(this._curSelectItem.petRaiders){var t=this._curSelectItem.petRaiders.pet;MyPet.doSeeRaidersPet(t,(function(){PanelManager.openPetDetailScene(t,PetDetailScene.FromType_petRaiders)}),this)}}else this._type==e.Type_Mount&&this._curSelectItem.mountRaiders&&AlertPanel.alertTipsCommon(this._curSelectItem.mountRaiders.item.getDesc(null,!1),!1)},e.prototype.onComboBoxSearch=function(){this.onSelectItem(null),this._comboboxSelect=this.combobox_type.selectData.value,this.update()},e.prototype.onItemTouch=function(t){var n=t.target;n&&(this._type==e.Type_Pet?n.petRaiders&&(AlertPanel.alertTipsCommon(n.petRaiders.pet.petraidersinfo,!1),this.onSelectItem(n)):this._type==e.Type_Mount&&n.mountRaiders&&(AlertPanel.alertTipsCommon(n.mountRaiders.strInfo,!1),this.onSelectItem(n)))},e.prototype.onSelectItem=function(t){return this._curSelectItem&&(this._curSelectItem.select=!1),null==t||null==t.petRaiders&&null==t.mountRaiders?(this._curSelectItem=null,void this.clearSpr()):(this._curSelectItem=t,void(this._curSelectItem&&(this._curSelectItem.select=!0,this.clearSpr(),this._type==e.Type_Pet&&null!=this._curSelectItem.petRaiders?(this._sprite=SpriteHelper.createPetSpriteByIcon(this._curSelectItem.petRaiders.pet.getIcon1(),!1),this._sprite.setScale(xhd?1.5:1),this.groupRole.addChild(this._sprite)):this._type==e.Type_Mount&&null!=this._curSelectItem.mountRaiders&&(this._sprite=Player.getCompareSprite(xself,this._curSelectItem.mountRaiders.item),this._sprite.setScale(xhd?1.5:1),this.groupRole.addChild(this._sprite)))))},e.prototype.setData=function(t,n){this._type=t,this._dataList=n,this.onSelectItem(null),this._type==e.Type_Pet?this._comboboxData=this._pet_comboBoxData:this._type==e.Type_Mount&&(this._comboboxData=this._mount_comboBoxData),this._comboboxSelect=0},e.prototype.reset=function(){this.init&&(this.container.reset(null==this._curSelectItem),this._index=0)},e.prototype.update=function(){if(this.init){var t;if(this.reset(),this._type==e.Type_Pet?t="宠物攻略":this._type==e.Type_Mount&&(t="坐骑攻略"),this.label_title.text=t,this._dataList&&this._dataList.length>0){if(this._type==e.Type_Pet)for(var n=Raiders.petjobSortIDTable[this._comboboxSelect],i=0;i<this._dataList.length;i++){var o=this._dataList[i];if(-1==n||o.pet.getJob()==n)(r=this.getItem()).setPetRaiders(o),r.select=!1,this.container.add(r)}else if(this._type==e.Type_Mount){var a=MountRaiders.mountLevelSortIDTable[this._comboboxSelect];for(i=0;i<this._dataList.length;i++){var r,s=this._dataList[i];if(MountRaiders.isMatchLevel(s.item.reqLv,a))(r=this.getItem()).setMountRaiders(s),r.select=!1,this.container.add(r)}}this.container.update()}if(null==this._curSelectItem)null!=(r=this.container.list[0])&&this.onSelectItem(r);else this.onSelectItem(this._curSelectItem)}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new PetRaidersListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.Type_Pet=1,e.Type_Mount=2,e}(ComponentBase);__reflect(PetRaidersPanel.prototype,"PetRaidersPanel");var RaidersListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.init){if(this._data){var t=this._data.menu;this._data.type==InfoData.TYPE_LEAVE&&(t=-1==this._data.prePageID?"离开":"返回上一页"),this.label_name.text=t}else this.label_name.text="";this.img_select.visible=this._select}},e}(ComponentBase);__reflect(RaidersListItem.prototype,"RaidersListItem");var RaidersPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._prePageID=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update(),0==PlayerDataManager.playerData.isStrategyOpend&&(PlayerDataManager.playerData.isStrategyOpend=!0,PlayerDataManager.savePlayerData(PlayerDataManager.playerData),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_4))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.data&&(e.data.doViewGameHelp(),this.onSelectItem(e))},e.prototype.onSelectItem=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.setData=function(t,e,n){void 0===n&&(n=0),this._title=t,this._dataList=e,this._prePageID=n},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){var t;if(this.reset(),this._dataList&&this._dataList.length>0){for(var e=0;e<this._dataList.length;e++){var n=this._dataList[e],i=this.getItem();i.setData(n),i.select=!1,this.container.add(i),this._prePageID>0&&this._prePageID==n.id&&(t=i)}this.container.update()}this.onSelectItem(t),this.container.updateToShowItem(t)}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new RaidersListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(RaidersPanel.prototype,"RaidersPanel");var RankFirstItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this._playerSprite),ObjectPool.getPool("Player").returnObject(this._player),this._player=null,Tool.removeObjSafe(this.petSprite),this.petSprite=null},e.prototype.initPanel=function(){t.prototype.initPanel.call(this),this._data&&(this.label_job.text=Define.getJobString(this._data.job)+" "+GameText.STR_LEVEL+this._data.level,this.showPet(),this.showRole())},e.prototype.headIcon=function(){},e.prototype.createRoleLevel=function(){},e.prototype.showRole=function(){this._player=ObjectPool.getPool("Player").createObject(),this._player.setSex(this._data.sex),this._player.setIcon1(this._data.icon1),this._player.setIcon2(this._data.icon2),this._player.setIcon3(this._data.icon3),this._player.setPlayerSprite(this._player.createSprite(!1));var t=this._player.sprite;null==t&&(t=this._player.createSprite(!1)),Tool.removeObjSafe(this._playerSprite),this._playerSprite=GameSprite.cloneSprite(t),this._playerSprite.setScale(xhd?1.5:1),this._playerSprite.x=xhd?530:265,this._playerSprite.y=xhd?150:75,this.addChild(this._playerSprite)},e.prototype.showPet=function(){this.pet=new MyPet(this._player),Tool.removeObjSafe(this.petSprite),this.petSprite=null,this._data.petIcon>0&&(this.petSprite=SpriteHelper.createPetSpriteByIcon(this._data.petIcon,!1)),this.petSprite&&(this.petSprite.scaleX=this.petSprite.scaleY=xhd?nato.mapRatio:1,this.petSprite.x=xhd?410:205,this.petSprite.y=xhd?182:91,this.addChild(this.petSprite))},e}(RankItem);__reflect(RankFirstItem.prototype,"RankFirstItem");var RankHandler=function(){function t(){}return t.isFlag=function(t,e){return 0!=(t&e)},t.getRewardList=function(){if(t.rewardData)PanelManager.openRankRewardPanel();else{PanelManager.openWaitForServer();var e=new nato.Message(ProtocolDefine.CG_ACTOR_OPEN_RANK_REWARD);nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),e){for(var n=e.getShort(),i=[],o=0;n>o;o++){var a={};a.type=e.getByte(),a.name=e.getString();var r=e.getByte();if(0!=r){a.rankList=[];for(var s=0;r>s;s++){for(var l=e.getByte(),_=[],h=0;l>h;h++){var u=new ItemData;u.isMoney=e.getBoolean(),u.isMoney?(u.moneyType=t.toMoneyType(e.getInt()),u.quantity=e.getInt()):(ItemData.fromBytesAtts2(u,e),u.quantity=e.getInt(),u.durMax>0&&(u.durability=u.durMax)),_.push(u)}a.rankList.push(_)}i.push(a)}}t.rewardUpdateTime=e.getInt(),t.rewardData=i,PanelManager.openRankRewardPanel()}}),this)}},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.doGetRankList=function(){if(t.rankTypeList)xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_RANK_TYPE_LIST,t.rankTypeList));else{var e=new nato.Message(ProtocolDefine.CG_TOP_TYPE_LIST);nato.Network.sendCmd(e,(function(e){if(null==e)return null;var n=e.getByte();if(0>=n)AlertPanel.alertCommon(GameText.STR_INFODATA_RANK_LIST_CLOSE);else{t.rankTypeList=[];for(var i=0;n>i;i++){var o=t.fromRankListBytes(e);t.rankTypeList.push(o)}xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_RANK_TYPE_LIST,t.rankTypeList))}}),this)}},t.doViewRankInfo=function(e,n,i,o){void 0===i&&(i=5),void 0===o&&(o=1);var a=e.type,r=n,s=new nato.Message(ProtocolDefine.CG_TOP_DATA_LIST);s.putByte(a),s.putByte(r),s.putByte(i),s.putShort(o),nato.Network.sendCmd(s,(function(n){if(null==n)return null;if(0>n.getShort())return null;var i=n.getByte();e.subTitle=[];for(var o=0;i>o;o++)e.subTitle.push(n.getString());var a=n.getByte(),r=[];for(o=0;a>o;o++){var s=t.fromRandDataBytes(n);r.push(s)}xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_RANK_INFO_LIST,r))}),this)},t.fromRankListBytes=function(t){var e={};e.type=t.getByte(),e.content=t.getString();var n=t.getByte();e.rankSubTypeIDList=[],e.rankSubTypeNameList=[];for(var i=0;n>i;i++)e.rankSubTypeIDList.push(t.getByte()),e.rankSubTypeNameList.push(t.getString());return e},t.fromRandDataBytes=function(e){var n={};n.actorId=e.getInt(),n.actorName=e.getString(),n.flag=e.getByte(),n.topIndex=e.getShort(),n.sex=e.getByte(),n.job=e.getByte(),n.level=e.getInt(),n.icon1=e.getInt(),n.icon2=e.getInt(),n.icon3=e.getInt(),n.petIcon=e.getInt();var i=e.getByte();n.rankStr=[];for(var o=0;i>o;o++)n.rankStr.push(e.getString());return t.isFlag(n.flag,t.FAG_IS_VIP)||t.isFlag(n.flag,t.FAG_IS_VIP_CQ)?n.vipLevel=e.getByte():n.vipLevel=0,n},t.doSeeMyRank=function(t){if(null!=t){var e=new nato.Message(ProtocolDefine.CG_TOP_ME);e.putByte(t),nato.Network.sendCmd(e,(function(t){if(null!=t){var e=t.getInt(),n=t.getString();xevent.dispatchEvent(new WorldEvent(WorldEvent.RETURN_MY_RANK_INFO,{info:n,value:e}))}}),this)}},t.FAG_IS_PHOTO=1,t.FAG_IS_VIP=2,t.FAG_IS_VIP_CQ=4,t.rewardUpdateTime=0,t}();__reflect(RankHandler.prototype,"RankHandler");var PetSealPro=function(){};__reflect(PetSealPro.prototype,"PetSealPro");var MyPet=function(t){function e(e){var n=t.call(this)||this;return n.setType(4),n.owner=e,n}return __extends(e,t),e.prototype.isAlive=function(){return!(this.vipLevel>0&&this.owner&&xworld.isVipOverDue(this.owner))&&this.ageTime>Date.now()},e.doPetSeeMsg=function(t,n,i){if(null!=t&&null!=t.petItem){if(t==xself.getPet())return void n.call(i,t);if(1==t.isTabStatus(Model.PET_INFO))return void n.call(i,t);var o=MsgHandler.createPetSeeMsg(t.petItem.slotPos);nato.Network.sendCmd(o,(function(o){return 0>o.getByte()?void AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),o.getString()):(e.fromBytesDetail(o,t),t&&t.refreshWorldSprite(),t.setTabStatus(!0,Model.PET_INFO),void n.call(i,t))}),this)}},e.doPetInfoMsg=function(t,n,i,o,a){function r(){null!=o&&null!=a&&o.call(a)}if(null!=t){if(1==t.isTabStatus(Model.PET_INFO))return void r();var s=MsgHandler.createPetInfoMsg(n,i);null!=s&&(nato.Network.sendCmd(s,(function(n){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(n)||(e.fromBytesDetail(n,t),null!=t&&t.refreshWorldSprite(),t.setTabStatus(!0,Model.PET_INFO),r())}),this),PanelManager.openWaitForServer())}},e.doSeeRaidersPet=function(t,n,i){if(null!=t){if(1==t.isTabStatus(Model.PET_INFO))return void n.call(i);var o=new nato.Message(ProtocolDefine.CG_PET_INFO_BYID);o.putInt(t.getId()),nato.Network.sendCmd(o,(function(o){return PanelManager.closeWaitForServer(),0>o.getByte()?void AlertPanel.alertCommon(o.getString()):(e.fromBytesDetail(o,t),t.setTabStatus(!0,Model.PET_INFO),void(null!=n&&null!=i&&n.call(i)))}),this),PanelManager.openWaitForServer()}},e.doGetBagPetItem=function(t){if(null==t)return null;var n=t.bag;if(null==n)return null;for(var i=[],o=0;o<=n.bagEnd;o++){var a=n.getItem(o);null!=a&&a.type==Define.ITEM_TYPE_PET&&i.push(e.itemChangePet(a,t))}return i},e.itemChangePet=function(t,n){if(null==t)return null;var i=null;return(i=t.slotPos==PlayerBag.PET_POS&&n==xself?n.getPet():e.createItemPet(t,n)).petItem=t,i},e.createItemPet=function(t,n){var i=new e(n);return i.setName(t.name),i.setLevel(t.reqLv),i.setIcon1(t.icon),i.grade=t.grade,i.setPlayerSprite(i.createSprite(!1)),i},e.fromBytesDetail=function(t,e){if(null==e)return-1;var n=t.getByte();if(0>n)return n;e.id=n,e.playerName=t.getString(),e.name=e.playerName,e.level=t.getByte(),e.icon1=t.getInt(),e.hp=t.getInt(),e.mp=t.getInt(),e.exp=t.getInt(),e.expMax=t.getInt(),e.sp=t.getInt(),e.str=t.getShort(),e.con=t.getShort(),e.agi=t.getShort(),e.ilt=t.getShort(),e.wis=t.getShort(),e.grow=t.getByte(),e.compre=t.getByte(),e.cp=t.getByte(),e.growLevel=t.getByte();var i=t.getLong().value;e.ageTime=Date.now()+i,e.petHitrate=t.getShort(),e.atkType=t.getByte(),e.atkMin=t.getShort(),e.atkMax=t.getShort(),e.petAtkTime=t.getByte(),e.job=t.getByte(),e.grade=t.getByte();var o=t.getByte();e.autoSkillID=[];for(var a=0;o>a;a++)e.autoSkillID[a]=t.getShort();return e.autoSkillID_Initiative=t.getShort(),e.skillList=MsgHandler.processDataPlayerSkillMsg(t,!1),e.vipLevel=t.getByte(),e.bornStatus=t.getInt(),e.owner&&(e.x=e.owner.x,e.y=e.owner.y),0},e.fromBytesMyPlayer=function(t,n){var i=new e(n);return 0>e.fromBytesDetail(t,i)?null:i},e.fromBytesOtherPlayer=function(t,e){var n=t.getByte();if(0>n)return null;var i=new Model(4);return i.setId(n),i.setName(t.getString()),i.setIcon1(t.getInt()),i.setPosition(e.getGx(),e.getGy()),i},e.fromBytesDetails=function(t,e){return null==e?-1:(e.id=t.getInt(),e.setType(t.getShort()),e.name=t.getString(),e.job=t.getByte(),e.grade=t.getByte(),e.atkType=t.getByte(),e.str=t.getShort(),e.con=t.getShort(),e.agi=t.getShort(),e.ilt=t.getShort(),e.wis=t.getShort(),e.grow=t.getByte(),e.compre=t.getByte(),e.talentSkill1=t.getString(),e.talentSkill2=t.getString(),e.setIcon1(t.getInt()),e.bornStatus=t.getInt(),0)},e.fromBytesInfo=function(t,n){var i=new e(n);return 0>e.fromBytesDetails(t,i)?null:i},e.prototype.getPetCompositeDesc=function(){var t=new StringBuffer;t.append(GameText.STR_PET_NAME+this.name+"\n"),t.append(GameText.STR_PET_JOB+Define.getJobString(this.job)+"\n"),t.append(GameText.STR_PET_SKILL_NAME+this.talentSkill1+","+this.talentSkill2+"\n");var e="";return e=this.getPetBornStatusInfo(!0,0,!1),0==Tool.isNullText(e)&&(e=GameText.STR_BORN_STATUS+": "+e),t.append(e),t.toString()},e.prototype.getPetBornStatusInfo=function(t,e,n){var i="\n";t&&(i=", ");var o=new StringBuffer;if(this.bornStatus>0)for(var a=0,r=Define.BUFFER_POISON;r<=Define.BUFFER_DIE_CANNOT_RELIVE;r++){if(0!=this.isBornStatus(Define.getBufferBitValue(r))){if(t&&e>0&&a>=e){o.append("...");break}var s="";n&&(s=": "+Define.getBufferInfoString(r)),Define.getBufferType(r)==Define.BUFFER_DIE_CANNOT_RELIVE?(a>0&&o.append(i),o.append(Define.getBufferString(r)+s)):n?(a>0&&o.append(i),o.append(PowerString.makeColorString(Define.getBufferString(r),ColorUtils.COLOR_GREEN)+s)):(a>0&&o.append(i),o.append(Define.getBufferString(r)+s)),++a}}return o.toString()},e.prototype.isBornStatus=function(t){return 0!=(this.bornStatus&t)},e.prototype.setBattleStatus=function(e){return(e==Player.BSTATUS_ESCAPE||!this.isBornStatus(e)||Define.getBufferType(e,!0)!=Define.BUFFER_TYPE_DEBUFF)&&t.prototype.setBattleStatus.call(this,e)},e.prototype.isBattleStatus=function(e){return!(e==Player.BSTATUS_ESCAPE||!this.isBornStatus(e)||Define.getBufferType(e,!0)!=Define.BUFFER_TYPE_BUFF&&e!=Define.getBufferBitValue(Define.BUFFER_DIE_CANNOT_RELIVE))||t.prototype.isBattleStatus.call(this,e)},e.prototype.addValue=function(e,n){if(e===ModelConst.PET_GROW_LEVEL)this.growLevel=Tool.sumValue(this.growLevel,n,0,120);else t.prototype.addValue.call(this,e,n);PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.updatePetProgress()},e.prototype.get=function(e){var n=0;switch(e){case ModelConst.PET_COLOR:return this.color;case ModelConst.PET_GRADE:return this.grade;case ModelConst.PET_GROW_LEVEL:return this.growLevel;case ModelConst.ATK_TYPE:return this.atkType;case ModelConst.HIT_RATE:return n=this.petHitrate,this.getPetPowerValue(n,this.hitrate,Define.POWER_HITRATE,Define.POWER_HITRATE_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_NONE);case ModelConst.HIT_MAGIC:return n=this.petHitrate,this.getPetPowerValue(n,this.hitMagic,Define.POWER_MAGIC_HITRATE,Define.POWER_MAGIC_HITRATE_PERCENT,Define.SKILL_TYPE_PASSIVE,ModelConst.MIN_HIT_MAGIC,Model.MAX_BASE_ATTRIBUTE,Define.POWER_NONE);case ModelConst.LEFT_ATK_TIME:case ModelConst.ATK_TIME:return n=this.petAtkTime,(n=Tool.sumValue(n+1,this.atk_time,ModelConst.MIN_HIT_TIME,ModelConst.MAX_HIT_TIME))+this.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,Define.POWER_ALL_ATK_TIME);case ModelConst.RIGHT_ATK_TIME:return 0;case ModelConst.LEFT_ATK_MIN:return n=this.atkMin,n=this.getPetPowerValue(n,0,Define.POWER_NONE,Define.POWER_NONE,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE,Define.POWER_PET_DAMAGE),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.LEFT_ATK_MAX:return n=this.atkMax,n=this.getPetPowerValue(n,0,Define.POWER_NONE,Define.POWER_NONE,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_OTHER_ATTRIBUTE,Define.POWER_PET_DAMAGE),Tool.sumValue(n,0,0,ModelConst.MAX_ATK);case ModelConst.RIGHT_ATK_MIN:case ModelConst.RIGHT_ATK_MAX:return 0;case ModelConst.HPMAX:return n=Math.floor(65*this.get(ModelConst.CON)/10+3*this.get(ModelConst.STR)+100+20*(this.get(ModelConst.LEVEL)-1)),this.getPetPowerValue(n,this.hpMax,Define.POWER_HPMAX,Define.POWER_HPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_HP,Define.POWER_PET_HPMAX_PERCENT);case ModelConst.MPMAX:return n=5*this.get(ModelConst.ILT)+2*this.get(ModelConst.WIS)+40+5*(this.get(ModelConst.LEVEL)-1),this.getPetPowerValue(n,this.mpMax,Define.POWER_MPMAX,Define.POWER_MPMAX_PERCENT,Define.SKILL_TYPE_PASSIVE,1,Model.MAX_PLAYER_MP,Define.POWER_PET_MPMAX_PERCENT);case ModelConst.STR:return n=this.str,this.getPetBaseValue(n,Define.POWER_STR,Define.POWER_STR_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_PET_STR_PERCENT);case ModelConst.CON:return n=this.con,this.getPetBaseValue(n,Define.POWER_CON,Define.POWER_CON_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_PET_CON_PERCENT);case ModelConst.AGI:return n=this.agi,this.getPetBaseValue(n,Define.POWER_AGI,Define.POWER_AGI_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_PET_AGI_PERCENT);case ModelConst.ILT:return n=this.ilt,this.getPetBaseValue(n,Define.POWER_ILT,Define.POWER_ILT_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_PET_ILT_PERCENT);case ModelConst.WIS:return n=this.wis,this.getPetBaseValue(n,Define.POWER_WIS,Define.POWER_WIS_PERCENT,Define.SKILL_TYPE_PASSIVE,0,Model.MAX_BASE_ATTRIBUTE,Define.POWER_PET_WIS_PERCENT);default:return this.owner&&(this.formationSkill=this.owner.formationSkill),t.prototype.get.call(this,e)}},e.prototype.getPetBaseValue=function(t,e,n,i,o,a,r){var s=t;s+=this.getSkillPowerValue(i,e);var l=this.getSkillPowerValue(i,n);return this.owner&&(l+=this.owner.getBagEquipPowerValue(r),l+=this.owner.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,r),l+=this.owner.getPowerValueByBuffer(r)),this.owner&&this.owner.formationSkill&&(s+=this.owner.formationSkill.getPowerValue(e),l+=this.owner.formationSkill.getPowerValue(n)),l>0&&(s+=Math.floor(s*l/100)),Tool.sumValue(s,0,o,a)},e.prototype.getPetPowerValue=function(t,e,n,i,o,a,r,s){var l=t;l+=this.getSkillPowerValue(o,n);var _=this.getSkillPowerValue(o,i);return this.owner&&s>0&&(_+=this.owner.getBagEquipPowerValue(s),_+=this.owner.getSkillPowerValue(Define.SKILL_TYPE_PASSIVE,s),_+=this.owner.getPowerValueByBuffer(s)),this.owner&&this.owner.formationSkill&&(l+=this.owner.formationSkill.getPowerValue(n),_+=this.owner.formationSkill.getPowerValue(i)),_>0&&(l+=Math.floor(l*_/100)),Tool.sumValue(l,e,a,r)},e.prototype.getPetAge=function(){var t=Math.floor((this.ageTime-Date.now())/Tool.MILLIS_IN_DAY);return 0>t&&(t=0),t},e.prototype.isHaveCanNotReliveBuffer=function(){return!!this.isBornStatus(Define.getBufferBitValue(Define.BUFFER_DIE_CANNOT_RELIVE))||t.prototype.isHaveCanNotReliveBuffer.call(this)},e.doGetPetSealDetails=function(t){if(null==t)return!1;if(null==t||null==t.petItem)return!1;if(t.petItem.isShopLocked())return AlertPanel.alertCommon(GameText.STR_CHANGE_NAME_NO_SHOP),!1;var e=new nato.Message(ProtocolDefine.CG_GET_SEAL_PET_SKILL);return e.putShort(t.petItem.slotPos),nato.Network.sendCmd(e,(function(e){if(null==e)return!1;if(0>e.getByte())return AlertPanel.alertCommon(e.getString()),!1;for(var n=e.getByte(),i="",o=0;n>o;o++){var a=e.getString()+"\n";i+=PowerString.makeColorString(a,Define.getGradeColor(t.petItem.grade))}i=Tool.manageStringList(GameText2.STR_PET_SEAL_INFO,["          "+t.petItem.getNameInfo()+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),t.level+"")+")",i]);for(var r=new Array,s=new Array,l=e.getByte(),_=0;l>_;_++){var h=new PetSealPro;h.type=e.getInt(),h.moneyvalue=e.getInt(),h.moneytype=e.getByte(),h.rate=e.getInt(),h.sealName=e.getString(),h.pet=t,r.push(h.sealName),s.push(h)}PanelManager.openPetSealPanel(i,s,t)}),this),!0},e.doGetPetSealSelect=function(t){if(null!=t&&null!=t.pet&&null!=t.pet.petItem){var e=xself;if(null!=e&&null!=e.bag&&0!=SafeLock.doSafeLockVerify()){var n="";switch(t.moneytype){case ModelConst.MONEY1:n=GameText.STR_MONEY1;break;case ModelConst.MONEY2:n=GameText.STR_MONEY2;break;case ModelConst.MONEY3:n=GameText.STR_MONEY3}AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageStringList(GameText2.STR_PET_SEAL_ASK,[t.pet.petItem.getNameInfo(),n+t.moneyvalue,t.rate+""]),(function(){function i(){var n=new nato.Message(ProtocolDefine.GC_SEAL_PET_TYPE);n.putShort(t.pet.petItem.slotPos),n.putInt(t.type),nato.Network.sendCmd(n,(function(n){if(null!=n){var i=n.getByte();if(0>i){var o=n.getString();return void AlertPanel.alertCommon(o)}i=n.getByte();var a=n.getBoolean(),r=GameText2.STR_PET_SEAL_SUCCESS;2==i&&(r=GameText2.STR_PET_SEAL_FAIL),e.bag&&e.bag.removeItem(t.pet.petItem.slotPos),a&&(r+="\n"+Tool.manageString(GameText2.STR_PET_SEAL_RS_INFO,MsgHandler.processAddItemMsg(n,ProtocolDefine.ADD_ITEM_USE_REWARD)+"\n")),e.money1=n.getInt(),e.money2=n.getInt(),e.money3=n.getInt();var s=Tool.convertDescToTextFlow(r);AlertPanel.alertTipsTextFlow(GameText.STR_GAME_NOTICE,s),PanelManager.closePetSealPanel(),PanelManager.getPanel(PetScene).updateTab()}}),this)}switch(t.moneytype){case ModelConst.MONEY1:n=GameText.STR_MONEY1,Model.checkEnoughMoney(t.moneyvalue,0,0,i,this);break;case ModelConst.MONEY2:n=GameText.STR_MONEY2,Model.checkEnoughMoney(0,t.moneyvalue,0,i,this);break;case ModelConst.MONEY3:n=GameText.STR_MONEY3,Model.checkEnoughMoney(0,0,t.moneyvalue,i,this)}}),this)}}},e.getPetChangeNameMoneyText=function(){var t=e.PET_CHANGE_NAME_MONEY[1];return 0>=t?"":Tool.manageString(GameText.STR_MYPET_CHANGE_NAME_COST,PowerString.makeColorString(GameText.getMoneyText(this.PET_CHANGE_NAME_MONEY[0])+t,ColorUtils.COLOR_RED))+"\n"},e.doPetChangeNameMsg=function(t){if(0==SafeLock.doSafeLockVerify())return!1;if(null==t)return!1;if(null==t||null==t.petItem)return!1;if(t.petItem.isShopLocked())return AlertPanel.alertCommon(GameText.STR_CHANGE_NAME_NO_SHOP),!1;var e=this,n=this.getPetChangeNameMoneyText();if(0==Tool.isNullText(n)){var i=function(e){if(1==Tool.isNullText(e))return!1;var n=MsgHandler.createPetChangeName(t.petItem.slotPos,e);nato.Network.sendCmd(n,(function(n){if(null==n)return!1;if(0>n.getByte())AlertPanel.errorMessage(n.getString());else{xself.setPlayerMoney(n.getInt(),n.getInt(),n.getInt(),null),t.setName(e),t.petItem.name=e;var i=PanelManager.getPanel(PetDetailScene,!1);i&&i.detailPanel.updateName(e)}}),this)},o=function(){PanelManager.openPetNamePanel(t,i)};AlertPanel.alert(GameText.STR_MYPET_CHANGE_NAME,n+GameText.STR_MYPET_CHANGE_NAME_ASK,(function(){var t=GameWorld.getMoneyArrayValue(this.PET_CHANGE_NAME_MONEY,Tool.MAX_VALUE_int);Model.checkEnoughMoney(t[0],t[1],t[2],o,e)}),this)}return!0},e.doOpenPetProShop=function(t,e,n){var i=t.bag;if(null!=i){var o;if(e==DrugPanel.SUB_TYPE_WORLD_ITEM_LIST?(o=i.getCanUseItemList(1),GameWorld.isShowWorldShop()&&(null!=o&&o.length>0?o.unshift(ItemData.getOneKeyWorldShop()):(o=new Array).push(ItemData.getOneKeyWorldShop()))):e==DrugPanel.SUB_TYPE_PET_ITEM_LIST?o=i.getCanUsePetItemList2():e==DrugPanel.SUB_PET_ITEM_RESET?o=i.getPetItemReset1():e==DrugPanel.SUB_PET_ITEM_RESET2?o=i.getPetItemReset2():e==DrugPanel.SUB_PET_ITEM_ADD_SKILL?o=i.getPetItemAddSkillList():e==DrugPanel.SUB_PET_ITEM_AGE&&(o=i.getPetAgeItem()),null==o||o.length<=0){if(e==DrugPanel.SUB_PET_ITEM_RESET||e==DrugPanel.SUB_PET_ITEM_RESET2||e==DrugPanel.SUB_PET_ITEM_ADD_SKILL||e==DrugPanel.SUB_PET_ITEM_AGE){return void AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),GameText.STR_PET_NO_ITEM_ASK,(function(){xworld.doBrowseShop(Define.SHOP_PET_USEITEM_ID,null)}),this)}return void AlertPanel.alertCommon(GameText.STR_NO_WORLD_ITEM_USE)}if(o.length>0){var a=o[0];PanelManager.openPetEquipDes(a,n)}return!0}},e.dogetResetItemInfo=function(t){var e="",n=t/2;return 10>n?e="☆":n>=10&&15>n?e="★":n>=15&&20>n?e="★☆":n>=20&&25>n?e="★★":n>=25&&30>n?e="★★☆":n>=30&&35>n?e="★★★":n>=35&&40>n?e="★★★☆ ":n>=40&&45>n?e="★★★★ ":n>=45&&50>n?e="★★★★☆":n>=50&&(e="★★★★★"),e},e.doPetUseResetItemMenu=function(t,e,n,i){if(null!=t&&null!=e&&null!=n){var o=t.bag;if(null!=o){var a=(o.getPetItemAddSkillList(),o.getItemNumByID(Define.ITEM_ID_PET_RESET)),r=new Array;r.push(GameText.getText(GameText.TI_BACK)),a>0&&r.push(GameText.STR_PET_RESET_ITEM_USE);var s=PanelManager.getPanel(PetDetailScene,!1);s&&s.setData(e),PanelManager.openPetSkillComparePanel(r,i,DrugPanel.SUB_PET_ITEM_RESET,e,null,null)}}},e.doPetUseResetItemMenuSelect=function(t,e,n){if(null!=t&&null!=e){var i=xself.bag;if(null!=i){var o=i.getItemNumByID(Define.ITEM_ID_PET_RESET);if(n==GameText.STR_PET_RESET_ITEM_USE&&o>0){var a=i.getPetItemReset1()[0];if(ItemManager.doWorldUseItemAction(xself,a,!1,e,t)){var r=PanelManager.getPanel(PetDetailScene,!1);r&&r.setData(t)}}}}},e.doPetAddSkill=function(t,n,i,o,a,r,s){if(null!=t&&null!=i&&null!=n&&null!=o&&null!=a&&null!=r){var l=new Array,_=new Array,h=new StringBuffer;h.append(Tool.manageString(GameText.STR_PET_ADD_SKILL_NUM,o.getItemNumByID(a.id)+"")+"\n");for(var u=!0,c=i.getByte(),T=0;c>T;T++){var p=i.getShort();-1!=p&&(u=!1),null!=n.getSkillByID(p)&&l.push(n.getSkillByID(p))}var d=i.getByte();for(T=0;d>T;T++){var E=Skill.fromBytes(i);_.push(E)}if(u){var g=new StringBuffer;for(T=0;T<_.length;T++){null!=(E=_[T])&&(g.append(E.getName()+"\n"),n.skillList.push(E))}return void e.doPetAddSkillMenu2(g.toString(),n,s)}h.append(e.getPetAddSkillInfo(l,_,u)),e.doPetAddSkillMenu(r,h.toString(),t,n,l,_,s)}},e.doPetAddSkillMenu=function(t,e,n,i,o,a,r){if(null!=n&&null!=i&&null!=r){var s=n.bag;if(null!=s){var l=(s.getPetItemAddSkillList(),s.getItemNumByID(Define.ITEM_ID_PET_ADD_SKILL)),_=new Array;_.push(GameText.getText(GameText.TI_BACK)),l>0&&_.push(GameText.STR_PET_ADD_SKILL_USE),_.push(GameText.STR_PET_ADD_SKILL_ASK),e+=GameText.STR_PET_ADD_SKILL_INFO_ASK+GameText.STR_PET_ADD_SKILL_INFO,PanelManager.openPetSkillComparePanel(_,e,DrugPanel.SUB_PET_ITEM_ADD_SKILL,i,o,a)}}},e.getPetAddSkillInfo=function(t,e,n){var i=new Array,o=new Array,a=new Array,r=new StringBuffer;if(n){for(var s=0;s<e.length;s++){var l=e[s];null!=l&&r.append(" -  --\x3e"+l.name+"\n")}return r.toString()}for(s=0;s<e.length;s++)i[s]=t[s],o[s]=e[s],a[s]=ColorUtils.COLOR_YELLOW;for(s=0;s<e.length;s++)for(var _=0;_<e.length;_++)if(i[s].id==o[_].id){i[s].level>o[_].level?a[s]=ColorUtils.COLOR_RED:i[s].level<o[_].level&&(a[s]=ColorUtils.COLOR_GREEN);var h=o[s];o[s]=o[_],o[_]=h}for(s=0;s<e.length;s++){var u=null!=i[s]?i[s].name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),i[s].level+"")+")":" - ",c=null!=o[s]?o[s].name+"("+Tool.manageString(GameText.getText(GameText.TI_LEVEL),o[s].level+"")+")":"-";r.append(u+" --\x3e "+PowerString.makeColorString(c,a[s])+"\n")}return r.toString()},e.doSelectPetAddSkillMenu=function(t,n,i,o,a){if(null!=n&&null!=xself){var r=xself.bag;if(null!=r){var s=r.getItemNumByID(Define.ITEM_ID_PET_ADD_SKILL),l=new nato.Message(ProtocolDefine.CG_ITEM_PET_ADD_SKILL);if(t==GameText.STR_PET_ADD_SKILL_ASK)l.putByte(n.getId()),l.putBoolean(!0),nato.Network.sendCmd(l,(function(t){for(var r=new StringBuffer,s=0;s<i.length;s++){var l=i[s];null!=l&&n.removeSkillSure(l)}for(s=0;s<o.length;s++){var _=o[s];null!=_&&(r.append(_.getName()+"\n"),n.skillList.push(_))}e.doPetAddSkillMenu2(r.toString(),n,a)}),this);else if(t==GameText.STR_PET_ADD_SKILL_USE&&s>0){var _=r.getPetItemAddSkillList()[0];ItemManager.doWorldUseItemAction(xself,_,!1,a,n)}}}},e.doPetAddSkillMenu2=function(t,e,n){var i=PlayerBag.getMyBagPetItemAddSkillNum(),o=new Array;if(o.push(GameText.getText(GameText.TI_BACK)),i>=0){i>0&&o.push(GameText.STR_PET_ADD_SKILL_USE);var a=Tool.manageString(GameText.STR_PET_ADD_SKILL_NUM,i+"");a+=t,a+=GameText.STR_PET_ADD_SKILL_INFO,PanelManager.openPetSkillComparePanel(o,a,DrugPanel.SUB_PET_ITEM_ADD_SKILL,e,null,null)}},e.doSelectPetAddSkillMenu2=function(t,e,n){if(null!=e){if(null!=xself){var i=xself.bag;if(null!=i){var o=i.getItemNumByID(Define.ITEM_ID_PET_ADD_SKILL);if(t==GameText.STR_PET_ADD_SKILL_USE&&o>0){var a=i.getPetItemAddSkillList()[0];ItemManager.doWorldUseItemAction(xself,a,!1,n,e)}}}}},e.prototype.getDescribe=function(){var t=new StringBuffer;t.append(GameText.STR_PET_GRADE+PowerString.makeColorString(Define.getGradeString(this.grade,!0),Define.getGradeColor(this.grade))+"\n"),t.append(GameText.STR_MONSTER_ATK_TYPE+Define.getAtkTypeString(this.atkType)+"\n"),t.append(GameText.STR_PET_NAME+name+"\n"),t.append(GameText.STR_PET_JOB+Define.getJobString(this.job)+"\n"),this.getBaseAttributeDesc(GameText.STR_PET_STR,this.str,t),this.getBaseAttributeDesc(GameText.STR_PET_CON,this.con,t),this.getBaseAttributeDesc(GameText.STR_PET_AGI,this.agi,t),this.getBaseAttributeDesc(GameText.STR_PET_ILT,this.ilt,t),this.getBaseAttributeDesc(GameText.STR_PET_WIS,this.wis,t),t.append(GameText.STR_PET_grow+e.dogetResetItemInfo(this.grow)+"\n"),t.append(GameText.STR_PET_compre+e.dogetResetItemInfo(this.compre)+"\n"),t.append(GameText.STR_PET_SKILL_NAME+this.talentSkill1+","+this.talentSkill2+"\n");var n="";return n=this.getPetBornStatusInfo(!0,3,!0),0==Tool.isNullText(n)&&(n=GameText.STR_BORN_STATUS+" : \n"+n),t.append(n),t.toString()},e.prototype.getBaseAttributeDesc=function(t,e,n){0>=e||n.append(t+e+"\n")},e.PET_CHANGE_NAME_MONEY=[ModelConst.MONEY2,50],e}(Player);__reflect(MyPet.prototype,"MyPet");var RankPanel=function(t){function e(){var e=t.call(this)||this;return e._currComboBoxType=0,e._currRadioSelect=0,e._currSelectIten=0,e._isInit=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._isInit&&(this.label_title.text=GameText.STR_RANK,this.label_rank_name.text="",this.label_my_rank_title.text=GameText.STR_INFODATA_RANK_MY_RANK,this.label_my_rank.text="",this.label_my_rank_value.text="",xevent.addEventListener(WorldEvent.RETURN_RANK_TYPE_LIST,this.getRankList,this),RankHandler.doGetRankList(),ButtonUtils.addTouchEvent(this.btn_reward,this.onReward,this),this._isInit=!1),this.headIcon(),this.createMyLevel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.myLevel),this.myLevel=null},e.prototype.closePanel=function(){if(this._currComboBoxType=0,this._currSelectIten=0,this.rankTypeDataArr=null,xevent.removeEventListener(WorldEvent.RETURN_RANK_TYPE_LIST,this.getRankList,this),xevent.removeEventListener(WorldEvent.RETURN_RANK_INFO_LIST,this.onReturnRankInfo,this),xevent.removeEventListener(WorldEvent.RETURN_MY_RANK_INFO,this.onReturnMyRankInfo,this),ButtonUtils.removeTouchEvent(this.btn_reward),Tool.removeObjSafe(this.headSpr),this.headSpr=null,this.rankInfoArr){for(var e=0,n=this.rankInfoArr.length;n>e;e++)this.removeItem(this.rankInfoArr[e],e),e--,n--;this.rankInfoArr=null}this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.radioChange,this),this._radioBtns.clear(),this._radioBtns=null),this._isInit=!0,t.prototype.closePanel.call(this)},e.prototype.headIcon=function(){if(xself&&0!=xself.getIcon1()&&null==this.headSpr){var t=xself.getIcon1()>>Model.OFFSET_SEX&Model.LEN_SEX,e=t==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(e),this.headSpr.x=50*xhdRatio,this.headSpr.y=453*xhdRatio,this.headSpr.setScale(xhd?2.7:1.25),this.myLevel?this.addChildAt(this.headSpr,this.getChildIndex(this.myLevel)):this.addChild(this.headSpr);var n=new ChangeSpriteInfo(xself.getIcon1(),0,0,t,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(n)}},e.prototype.createMyLevel=function(){xself&&(this.myLevel||(this.myLevel=ImageNum.create(2007),this.myLevel.numSpace=-4,this.myLevel.x=33*xhdRatio,this.myLevel.y=455*xhdRatio,this.myLevel.scaleX=this.myLevel.scaleY=.5*xhdRatio,this.addChild(this.myLevel)),this.myLevel.num=xself.getLevel())},e.prototype.getRankList=function(t){var e=t.param;this.rankTypeDataArr=e;for(var n=[],i=0,o=e.length;o>i;i++)n.push(e[i].content);for(this.setTabBtnLabel(n);this["tabBtn_"+i];)Tool.removeObjSafe(this["tabBtn_"+i]),i++;xevent.addEventListener(WorldEvent.RETURN_RANK_INFO_LIST,this.onReturnRankInfo,this),xevent.addEventListener(WorldEvent.RETURN_MY_RANK_INFO,this.onReturnMyRankInfo,this),this.getRankInfo(this._currComboBoxType)},e.prototype.updateTab=function(){t.prototype.updateTab.call(this),this.getRankInfo(this._tabIndex)},e.prototype.getRankInfo=function(t){this.rankTypeDataArr&&(PanelManager.openWaitForServer(),RankHandler.doViewRankInfo(this.rankTypeDataArr[t],1),RankHandler.doSeeMyRank(this.rankTypeDataArr[t].type))},e.prototype.onReturnRankInfo=function(t){PanelManager.closeWaitForServer(),this.rankInfoArr||(this.rankInfoArr=[]),this._radioBtns?this._radioBtns.clear():(this._radioBtns=new RadioButtonComponent,this._radioBtns.addEventListener(egret.Event.CHANGE,this.radioChange,this));for(var e=t.param,n=0,i=0,o=e.length;o>i;i++){var a;0==i?(this.rankFirstItem||(this.rankFirstItem=ObjectPool.getPool("RankFirstItem").createObject(),nato.attachSkin(this.rankFirstItem),this.scroll.add(this.rankFirstItem),this.rankInfoArr.push(this.rankFirstItem)),a=this.rankFirstItem):i<this.rankInfoArr.length?a=this.rankInfoArr[i]:(a=ObjectPool.getPool("RankItem").createObject(),nato.attachSkin(a),this.scroll.add(a),this.rankInfoArr.push(a)),a.setData(e[i],this.rankTypeDataArr[this._tabIndex].subTitle[1]),a.x=0,a.y=n,n+=a.height}for(this.scroll.update(!0),o=this.rankInfoArr.length;o>i;i++)this.removeItem(this.rankInfoArr[i],i),i--,o--;this._currSelectIten>this.rankInfoArr.length-1&&(this._currSelectIten=this.rankInfoArr.length-1),this._currSelectIten<0&&(this._currSelectIten=0),this._radioBtns.add(this.rankInfoArr,this._currSelectIten,!1,!0),this.label_rank_name.text=this.rankTypeDataArr[this._tabIndex].subTitle.length>0?this.rankTypeDataArr[this._tabIndex].subTitle[1]+"：":""},e.prototype.onReturnMyRankInfo=function(t){var e=t.param;this.label_my_rank_value.text=this.rankTypeDataArr[this._tabIndex].subTitle.length>0?e.value:"",this.label_my_rank.text=e.info,this.label_my_rank_value.x=this.label_rank_name.x+this.label_rank_name.textWidth},e.prototype.removeItem=function(t,e){this.scroll.remove(t),t instanceof RankFirstItem?(ObjectPool.getPool("RankFirstItem").returnObject(this.rankFirstItem),this.rankFirstItem=null):ObjectPool.getPool("RankItem").returnObject(this.rankInfoArr[e]),this.rankInfoArr.splice(e,1)},e.prototype.radioChange=function(t){this._currSelectIten=this._radioBtns.getCurrentIndex();var e=new Model(3),n=this._radioBtns.getCurentSelectItem();e.setId(n.getData().actorId),e.setName(n.getData().actorName),e.setVipLevel(n.getData().vipLevel),PanelManager.openPlayerMenuPanel(e,Menu.UI_INTO_RANK_LIST)},e.prototype.onReward=function(){RankHandler.getRewardList()},e}(TabPanelBase);__reflect(RankPanel.prototype,"RankPanel");var RankRewardItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),Tool.removeObjSafe(this.rankIndex),this.rankIndex=null,this._itemArr=null;for(var n=0,i=this._itemIcon.length;i>n;n++)this.removeItem(this._itemIcon[n],n),n--,i--;this._itemIcon.length=0},e.prototype.removeItem=function(t,e){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this),this.hscroll.remove(t),Tool.removeObjSafe(this._itemIcon[e]),ObjectPool.getPool("Item3").returnObject(this._itemIcon[e]),this._itemIcon.splice(e,1)},e.prototype.setData=function(t,e){this._itemArr=t,this._index=e,this.stage&&this.initPanel()},e.prototype.initPanel=function(){var t=xhd?"_hd":"_sd";this._index<4?(this.index_icon.source="rank_"+this._index+t,this.currentState="top",this.createRankIndex(50)):(this.currentState="last",this.createRankIndex(38));for(var e=0,n=this._itemArr.length;n>e;e++){var i;this._itemIcon||(this._itemIcon=[]),e<this._itemIcon.length?i=this._itemIcon[e]:(i=ObjectPool.getPool("Item3").createObject(),nato.attachSkin(i),this._itemIcon.push(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this)),i.itemData=this._itemArr[e],this.hscroll.add(i,e*(i.width-30),10)}if(this.hscroll.update(),this._itemIcon)for(n=this._itemIcon.length;n>e;e++)this.removeItem(this._itemIcon[e],e),e--,n--},e.prototype.createRankIndex=function(t){null==this.rankIndex&&(this.rankIndex=ImageNum.create(2009),this.rankIndex.numSpace=-4,this.rankIndex.x=44*xhdRatio,this.rankIndex.y=xhdRatio*t,this.rankIndex.scaleX=this.rankIndex.scaleY=.6*xhdRatio,this.addChild(this.rankIndex)),this.rankIndex.num=this._index},e.prototype.onClickItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e}(ComponentBase);__reflect(RankRewardItem.prototype,"RankRewardItem");var RankRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_left,this.onLeft,this),ButtonUtils.addTouchEvent(this.btn_right,this.onRight,this),this._currPage=0,this._data=RankHandler.rewardData,this.update(),this.label_time.text="排行榜发放时间为每周日早上8点\n"},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_left),ButtonUtils.removeTouchEvent(this.btn_right),this._data=null,this._rewardItem){for(var n=0,i=this._rewardItem.length;i>n;n++)this.removeItem(this._rewardItem[n],n),n--,i--;this._rewardItem.length=0}},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.removeItem=function(t,e){this.scroll.remove(t),Tool.removeObjSafe(this._rewardItem[e]),ObjectPool.getPool("RankRewardItem").returnObject(this._rewardItem[e]),this._rewardItem.splice(e,1)},e.prototype.update=function(){if(this._data){this.label_rank_name.text=this._data[this._currPage].name,this._currPage<=0?this.btn_left.visible=!1:this.btn_left.visible=!0,this._currPage>=this._data.length-1?this.btn_right.visible=!1:this.btn_right.visible=!0;for(var t=this._data[this._currPage].rankList,e=0,n=t.length;n>e;e++){var i;this._rewardItem||(this._rewardItem=[]),e<this._rewardItem.length?i=this._rewardItem[e]:(i=ObjectPool.getPool("RankRewardItem").createObject(),nato.attachSkin(i),this._rewardItem.push(i),this.scroll.add(i)),i.setData(t[e],e+1)}if(this.scroll.update(!0),this._rewardItem)for(n=this._rewardItem.length;n>e;e++)this.removeItem(this._rewardItem[e],e),e--,n--}},e.prototype.onLeft=function(){this._currPage--,this._currPage<=0||this._currPage,this.update()},e.prototype.onRight=function(){this._currPage++,this._currPage>=this._data.length-1?this._data.length:this._currPage,this.update()},e.prototype.logic=function(t){this._time<=0&&(this.label_time.text=Tool.getTimeStrByMin(RankHandler.rewardUpdateTime/1e3/60,!0)),this._time+=t,this._time>=6e4&&(this._time=0),RankHandler.rewardUpdateTime-=t,RankHandler.rewardUpdateTime<=0&&nato.WorldTicker.instance.unregister(this.logic,this)},e}(WindowPanelBase);__reflect(RankRewardPanel.prototype,"RankRewardPanel");var RedPaper=function(){function t(){}return t.sendRedPaper=function(e,n,i,o){if(xself.getLevel()<20)AlertPanel.alertCommon("等级不足，20级以上才能发红包！");else if(200>e||e>1e3)AlertPanel.alertCommon("红包金额不能小于200或大于1000黄金");else if(o==t.SendType_country&&xself.getCountryId()<=0)AlertPanel.alertCommon("尚未拥有国家");else{if(0==SafeLock.doSafeLockVerify())return SafeLock.doSafeLockSuccessCallback((function(){PanelManager.openRedPaperScene(),t.sendRedPaper(e,n,i,o)}),this),void PanelManager.closeRedPaperScene();var a=new nato.Message(ProtocolDefine.CG_HAND_OUT_RED_ENVELOPES);a.putInt(e),a.putShort(n),a.putString(i),a.putShort(o),nato.Network.sendCmd(a,(function(t){if(PanelManager.closeWaitForServer(),0>t.getByte())AlertPanel.alertCommon(t.getString());else{var e=t.getInt();if(xself.setPlayerMoneyValue(e),AlertPanel.alertCommon("发送成功"),PanelManager.isPanelShow(RedPaperScene))PanelManager.getPanel(RedPaperScene).updateSendSuccess()}}),this),PanelManager.openWaitForServer()}},t.receiveRedPaper=function(e){var n=e.id,i=new nato.Message(ProtocolDefine.CG_RECEIVE_RED_ENVELOPES);i.putLong(n),nato.Network.sendCmd(i,(function(n){PanelManager.closeWaitForServer();var i=n.getByte();if(0>i){if(-3==i?(e.isRobOver=!0,PanelManager.openRedPaperDetailView(e)):-5==i?(e.isGet=!0,PanelManager.openRedPaperDetailView(e)):AlertPanel.alertCommon(n.getString()),PanelManager.isPanelShow(RedPaperScene))(r=PanelManager.getPanel(RedPaperScene))&&r.listPanel&&r.listPanel.reqList()}else{var o=new RedPacket;o.id=n.getLong(),o.actorName=n.getString(),o.packetName=n.getString(),o.type=n.getInt();var a,r,s=n.getInt();if(!(0>=(a=o.type==t.SendType_recharge?s-xself.money2:s-xself.money1))&&(o.type==t.SendType_recharge?xself.setPlayerMoneyValue(-1,s):xself.setPlayerMoneyValue(s),o.getMoney1=a,PanelManager.openRedPaperDetailView(o),PanelManager.isPanelShow(RedPaperScene)))(r=PanelManager.getPanel(RedPaperScene))&&r.listPanel&&r.listPanel.reqList()}}),this),PanelManager.openWaitForServer()},t.getRedPaperList=function(t,e){var n=new nato.Message(ProtocolDefine.CG_RED_ENVELOPES_LIST);nato.Network.sendCmd(n,(function(n){PanelManager.closeWaitForServer();for(var i=n.getShort(),o=[],a=0;i>a;a++){var r=new RedPacket;r.id=n.getLong(),r.actorName=n.getString(),r.packetName=n.getString(),r.type=n.getInt(),o.push(r)}null!=t&&null!=e&&t.call(e,o)}),this),PanelManager.openWaitForServer()},t.getMyRedPaperRecord=function(t,e){var n=new nato.Message(ProtocolDefine.CG_MY_ENVELOPES_RECORD);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),n.getBoolean()){var i=new RedPaperRecord;i.sendServer=n.getInt(),i.sendCountry=n.getInt(),i.getAll=n.getInt(),i.list=[];for(var o=n.getShort(),a=0;o>a;a++){var r=new RedPaperRecordListData;r.time=n.getLong().value,r.actorID=n.getInt(),r.actorName=n.getString(),r.money=n.getInt(),r.sendType=n.getInt(),i.list.push(r)}null!=t&&null!=e&&t.call(e,i)}else null!=t&&null!=e&&t.call(e,null)}),this),PanelManager.openWaitForServer()},t.getRedPaperRecord=function(t){var e=new nato.Message(ProtocolDefine.CG_RECEIVE_ENVELOPES_RECORD);e.putLong(t.id),nato.Network.sendCmd(e,(function(e){PanelManager.closeWaitForServer();for(var n=[],i=e.getShort(),o=0;i>o;o++){(s=new RedPaperRecordListData).time=e.getLong().value,s.actorID=e.getInt(),s.actorName=e.getString(),s.money=e.getInt(),s.sendType=e.getInt(),n.push(s)}for(var a=0,r=0;r<n.length;r++){var s;(s=n[r]).money>a&&(a=s.money)}PanelManager.closeRedPaperDetailView(),PanelManager.openRedPaperRecordView(t,n,a)}),this),PanelManager.openWaitForServer()},t.getDescByRecord=function(t){if(null==t)return"";return 0==t.sendType?"你抢到了/cffcc00"+t.actorName+"/p的红包/cffcc00"+t.money+"/p黄金":"你在"+this.getTypeDesc(t.sendType)+"发放了/cffcc00"+t.money+"/p黄金的红包"},t.getTypeDesc=function(e){return e==t.SendType_country?"/cffcc00全国/p":e==t.SendType_server?"/cffcc00全服/p":""},t.getTypeDesc2=function(e){return e==t.SendType_country?"全国":e==t.SendType_server?"全服":e==t.SendType_recharge?"全服充值":""},t.sendMsgInChat=function(e){if(null!=e){var n=Define.CHAT_TYPE_SYSTEM;e.type==t.SendType_country&&(n=Define.CHAT_TYPE_COUNTRY);var i=new ChatMsg(n,1,"","",0,32,"");i.redPaperData=e,ChatMsg.addChatMsg(i,!0)}},t.processRedPacketNotify=function(e){var n=new RedPacket;n.id=e.getLong(),n.actorName=e.getString(),n.type=e.getInt(),t.sendMsgInChat(n)},t.isOPen=!0,t.SendType_server=1,t.SendType_country=2,t.SendType_recharge=3,t}();__reflect(RedPaper.prototype,"RedPaper");var RedPacket=function(){this.id=null,this.type=0,this.isRobOver=!1,this.isGet=!1,this.getMoney1=0};__reflect(RedPacket.prototype,"RedPacket");var RedPaperRecord=function(){this.sendServer=0,this.sendCountry=0,this.getAll=0};__reflect(RedPaperRecord.prototype,"RedPaperRecord");var RedPaperRecordListData=function(){this.time=0,this.sendType=0,this.actorID=0,this.money=0,this.isBest=!1};__reflect(RedPaperRecordListData.prototype,"RedPaperRecordListData");var RedPaperCountBtn=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._select=!1},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.init){var t=5;switch(this._type){case 0:t=5;break;case 1:t=10;break;case 2:t=20}this.img_count.source="redpaper_count"+t+(xhd?"_hd":"_sd"),this._select?this.img_bg.source="redpaper_btn2"+(xhd?"_hd":"_sd"):this.img_bg.source="redpaper_btn1"+(xhd?"_hd":"_sd")}},e}(ComponentBase);__reflect(RedPaperCountBtn.prototype,"RedPaperCountBtn");var RedPaperDetailView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_seeRecord.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSeeOtherRecord,this),ButtonUtils.addTouchEvent(this.btn_closeDetail,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.label_seeRecord.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSeeOtherRecord,this),ButtonUtils.removeTouchEvent(this.btn_closeDetail)},e.prototype.onClose=function(){PanelManager.closeRedPaperDetailView()},e.prototype.onSeeOtherRecord=function(t){this._data&&RedPaper.getRedPaperRecord(this._data)},e.prototype.reset=function(){this.init},e.prototype.setData=function(t){this._data=t},e.prototype.update=function(){this.init&&(this.group_getInfo.visible=!1,this.img_over.visible=!1,this.label_hadGet.visible=!1,null!=this._data&&(this._data.isRobOver?this.img_over.visible=!0:this._data.isGet?this.label_hadGet.visible=!0:(this.group_getInfo.visible=!0,this.label_name.text=this._data.actorName,this.label_money.text=this._data.getMoney1+""),this.imgType.source=this._data.type==RedPaper.SendType_recharge?"gold_leaf_hd":"gold_square_hd"))},e}(ComponentBase);__reflect(RedPaperDetailView.prototype,"RedPaperDetailView");var RedPaperListItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&null!=this._data){this.label_desc.text=this._data.packetName,this.label_name.text=this._data.actorName;var t=-1!=[RedPaper.SendType_server,RedPaper.SendType_recharge].indexOf(this._data.type)?2:1;this.img_type.source="redpaper_type"+t+(xhd?"_hd":"_sd")}},e}(ComponentBase);__reflect(RedPaperListItem.prototype,"RedPaperListItem");var RedPaperListPanel=function(t){function e(){var e=t.call(this)||this;return e._redPaperIndex=0,e._redPaperList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reqList=function(){this._dataList=null,this.updateList(),RedPaper.getRedPaperList(this.reqListBack,this)},e.prototype.reqListBack=function(t){this._dataList=t,this.updateList()},e.prototype.onRedPaperListItemTouch=function(t){var e=t.target;e&&e.data&&RedPaper.receiveRedPaper(e.data)},e.prototype.update=function(){this.init&&this.updateList()},e.prototype.updateList=function(){if(this.container.reset(),this._redPaperIndex=0,this._dataList&&this._dataList.length>0){for(var t=0,e=0,n=0;n<this._dataList.length;n++){var i=this._dataList[n],o=this.getRedPaperListItem();t=n%3*o.width,e=Math.floor(n/3)*o.height,o.setData(i),this.container.add(o,t,e)}this.container.update()}},e.prototype.getRedPaperListItem=function(){var t=this._redPaperList[this._redPaperIndex];return null==t&&(t=new RedPaperListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRedPaperListItemTouch,this),this._redPaperList[this._redPaperIndex]=t),this._redPaperIndex++,t},e}(ComponentBase);__reflect(RedPaperListPanel.prototype,"RedPaperListPanel");var RedPaperListRecordItem=function(t){function e(){var e=t.call(this)||this;return e._maxMoney=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e){this._data=t,this._maxMoney=e,this.update()},e.prototype.update=function(){if(this.init){if(null==this._data)return this.label_info.text="",this.label_name.text="",void(this.label_time.text="");var t=this._data.actorName+(this._data.money==this._maxMoney?"/c00ff00(手气最佳)/p":"");this.label_name.textFlow=Tool.convertDescToTextFlow(t),this._data.sendType==RedPaper.SendType_recharge?this.label_info.textFlow=Tool.convertDescToTextFlow("抢到 /cffcc00"+this._data.money+"/p 金叶"):this.label_info.textFlow=Tool.convertDescToTextFlow("抢到 /cffcc00"+this._data.money+"/p 黄金"),this.label_time.text=this.getTimeDesc(this._data.time)}},e.prototype.getTimeDesc=function(t){var e="",n=new Date(t);e=n.getMonth()+1+"月"+n.getDate()+"日 ";var i=n.getHours(),o=n.getMinutes();return 10>i&&(e+="0"),e+=i+":",10>o&&(e+="0"),e+(o+"")},e}(ComponentBase);__reflect(RedPaperListRecordItem.prototype,"RedPaperListRecordItem");var RedPaperRecordItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this._data=null},e.prototype.setData=function(t){this._data=t,this._desc=RedPaper.getDescByRecord(t),this.height=TextFieldUtils.getTextHeight(this._desc,208*xhdRatio,15*xhdRatio,"黑体")+6*xhdRatio},e.prototype.update=function(){if(this.init){if(null==this._data)return this.label_time.text="",void(this.label_content.text="");this.label_time.text=this.getTimeStr(this._data.time),this.label_content.textFlow=Tool.convertDescToTextFlow(this._desc)}},e.prototype.getTimeStr=function(t){var e=new Date(t);return e.getMonth()+1+"月"+e.getDate()+"日"},e}(ComponentBase);__reflect(RedPaperRecordItem.prototype,"RedPaperRecordItem");var RedPaperRecordPanel=function(t){function e(){var e=t.call(this)||this;return e._recordIndex=0,e._recordItemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reset=function(){this.init&&(this.label_server.text="",this.label_country.text="",this.label_my.text="",this._recordIndex=0,this.container.reset())},e.prototype.reqRecordData=function(){this._data=null,RedPaper.getMyRedPaperRecord(this.reqDataBack,this)},e.prototype.reqDataBack=function(t){this._data=t,this.update()},e.prototype.update=function(){if(this.init){if(null==this._data)return void this.reset();if(this.label_server.text=this._data.sendServer+"黄金",this.label_country.text=this._data.sendCountry+"黄金",this.label_my.text=this._data.getAll+"黄金",this.container.reset(),this._recordIndex=0,this._data.list&&this._data.list.length>0){for(var t=0;t<this._data.list.length;t++){var e=this._data.list[t],n=this.getRecortItem();n.setData(e),this.container.add(n)}this.container.update()}}},e.prototype.getRecortItem=function(){var t=this._recordItemList[this._recordIndex];return null==t&&(t=new RedPaperRecordItem,nato.attachSkin(t),this._recordItemList[this._recordIndex]=t),this._recordIndex++,t},e}(ComponentBase);__reflect(RedPaperRecordPanel.prototype,"RedPaperRecordPanel");var RedPaperRecordView=function(t){function e(){var e=t.call(this)||this;return e._maxMoney=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_closeRecord,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_closeRecord),this.returnAllItems()},e.prototype.onClose=function(){PanelManager.closeRedPaperRecordView(),PanelManager.openRedPaperDetailView(this._data)},e.prototype.setData=function(t,e,n){this._data=t,this._list=e,this._maxMoney=n},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init&&(this.returnAllItems(),this._list&&this._list.length>0)){for(var t=0;t<this._list.length;t++){var e=this._list[t],n=this.getItem();n.setData(e,this._maxMoney),this.recordContainer.add(n)}this.recordContainer.update()}},e.prototype.getItem=function(){var t=ObjectPool.getPool("RedPaperListRecordItem").createObject();return nato.attachSkin(t),t},e.prototype.returnAllItems=function(){var t=this.recordContainer.list,e=ObjectPool.getPool("RedPaperListRecordItem");if(t&&t.length>0){for(var n=0;n<t.length;n++){var i=t[n];e.returnObject(i)}this.recordContainer.reset()}},e}(ComponentBase);__reflect(RedPaperRecordView.prototype,"RedPaperRecordView");var RedPaperScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e._tabIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_0,this.tabBtn_1,this.tabBtn_2];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.updateTab(),this.updateRedPoint()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeRedPaperScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTab=function(t){this._tabIndex=t},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_SEND?this.addChild(this.sendPanel):this._tabIndex==e.TAB_INDEX_ROB?(this.addChild(this.listPanel),this.listPanel.reqList()):this._tabIndex==e.TAB_INDEX_RECORD&&(this.addChild(this.recordPanel),this.recordPanel.reqRecordData()),this.addChild(this.group_bg)},e.prototype.removeAllPanel=function(){this.sendPanel&&this.sendPanel.parent&&this.sendPanel.parent.removeChild(this.sendPanel),this.listPanel&&this.listPanel.parent&&this.listPanel.parent.removeChild(this.listPanel),this.recordPanel&&this.recordPanel.parent&&this.recordPanel.parent.removeChild(this.recordPanel)},e.prototype.updateRedPoint=function(){},e.prototype.updateSendSuccess=function(){this.sendPanel&&this.sendPanel.stage&&this.sendPanel.update()},e.TAB_INDEX_SEND=0,e.TAB_INDEX_ROB=1,e.TAB_INDEX_RECORD=2,e}(ComponentBase);__reflect(RedPaperScene.prototype,"RedPaperScene");var RedPaperSendPanel=function(t){function e(){var e=t.call(this)||this;return e._selectCountIndex=-1,e._defalutDesc="恭喜发财",e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._countBtnList&&(this._countBtnList=[this.btn_count0,this.btn_count1,this.btn_count2]);for(var n=0;n<this._countBtnList.length;n++){this._countBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCountTouch,this)}ButtonUtils.addTouchEvent(this.btn_pay,this.onBtnPay,this),ButtonUtils.addTouchEvent(this.btn_sendServer,this.onBtnSendServer,this),ButtonUtils.addTouchEvent(this.btn_sendCountry,this.onBtnSendCountry,this),this.input_num.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputNumFocusIn,this),this.input_num.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputNumFocusOut,this),this.input_info.addEventListener(egret.FocusEvent.FOCUS_IN,this.onInputInfoFocusIn,this),this.input_info.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputInfoFocusOut,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._countBtnList.length;n++){this._countBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnCountTouch,this)}ButtonUtils.removeTouchEvent(this.btn_pay),ButtonUtils.removeTouchEvent(this.btn_sendServer),ButtonUtils.removeTouchEvent(this.btn_sendCountry),this.input_num.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputNumFocusIn,this),this.input_num.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputNumFocusOut,this),this.input_info.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onInputInfoFocusIn,this),this.input_info.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onInputInfoFocusOut,this)},e.prototype.onBtnPay=function(){PanelManager.closeRedPaperScene(),PayInfo.getPayList(!0)},e.prototype.onBtnSendServer=function(){this.onSend(RedPaper.SendType_server)},e.prototype.onBtnSendCountry=function(){this.onSend(RedPaper.SendType_country)},e.prototype.onSend=function(t){var e=Number(this.input_num.text),n=this.input_info.text,i=0;return 0==this._selectCountIndex?i=5:1==this._selectCountIndex?i=10:2==this._selectCountIndex&&(i=20),0>=e?void AlertPanel.alertCommon("请输入红包金额"):0>=i?void AlertPanel.alertCommon("请选择红包个数"):void RedPaper.sendRedPaper(e,i,n,t)},e.prototype.onBtnCountTouch=function(t){var e=this._countBtnList.indexOf(t.target);-1!=e&&(this._selectCountIndex=e,this.updateSelectCount())},e.prototype.onInputNumFocusIn=function(t){this.label_money.visible=!1},e.prototype.onInputNumFocusOut=function(t){this.updateInputNumStatus()},e.prototype.onInputInfoFocusIn=function(t){this.input_info.text==this._defalutDesc&&(this.input_info.text="")},e.prototype.onInputInfoFocusOut=function(t){""==this.input_info.text&&(this.input_info.text=this._defalutDesc)},e.prototype.updateInputNumStatus=function(){var t=this.input_num.text;Tool.isNullText(t)?this.label_money.visible=!0:this.label_money.visible=!1},e.prototype.reset=function(){this.init&&(this.input_num.text="",this.input_info.text="",this._selectCountIndex=-1,this.updateInputNumStatus(),this.updateSelectCount())},e.prototype.update=function(){if(this.init){var t=0;xself&&(t=xself.money1),this.label_myMoney.textFlow=Tool.convertDescToTextFlow("我的黄金："+PowerString.makeColorString(""+t,ColorUtils.COLOR_YELLOW)),this._selectCountIndex=-1,this.updateSelectCount(),this.btn_count0.type=0,this.btn_count1.type=1,this.btn_count2.type=2,this.input_num.text="",this.input_info.text=this._defalutDesc,this.updateInputNumStatus()}},e.prototype.updateSelectCount=function(){if(-1==this._selectCountIndex)this.img_count.visible=!1;else{var t=0;switch(this._selectCountIndex){case 0:t=5;break;case 1:t=10;break;case 2:t=20}this.img_count.visible=!0,this.img_count.source="redpaper_count"+t+(xhd?"_hd":"_sd")}this.btn_count0.select=0==this._selectCountIndex,this.btn_count1.select=1==this._selectCountIndex,this.btn_count2.select=2==this._selectCountIndex},e}(ComponentBase);__reflect(RedPaperSendPanel.prototype,"RedPaperSendPanel");var LevelRewardItem=function(t){function e(){var e=t.call(this)||this;return e.GOT="got",e.HAVE="have",e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_get_reward);for(var n=0;this["item_"+n]&&this["item_"+n].visible;)this["item_"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this),n++},e.prototype.initPanel=function(){this.label_title.text=GameText.LEVEL_REWARD_SUB_TITLE+this.data.level;for(var t=this.data.itemList.length,e=0;this["item_"+e];)t>e?(this["item_"+e].itemData=this.data.itemList[e],this["item_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)):this["item_"+e].visible=!1,e++;this.setStatus()},e.prototype.onGetReward=function(){RewardHandler.getLevelReward(this.data.level,this.getSuccess,this)},e.prototype.getSuccess=function(){this.currentState=this.GOT,this.data.isGet=!0,this.setStatus(),xevent.dispatchEvent(new WorldEvent(WorldEvent.GET_LEVEL_REWARD_SUCCESS,this.data.level));for(var t=0,e=this.data.itemList.length;e>t;t++)this.data.itemList[t].isMoney||WorldMessage.addTips(GameText.STR_CONDITION_GET+" "+PowerString.makeColorString(this.data.itemList[t].name,Define.getGradeColor(this.data.itemList[t].grade))+"x"+this.data.itemList[t].quantity)},e.prototype.onTouchItem=function(t){var e=t.currentTarget;if(e&&e.itemData)if(e.itemData.isMoney)AlertPanel.alertTips(GameText.getText(GameText.TI_WARM_SHOW),e.itemData.getDesc(null));else{var n="";e.itemData&&(n=PowerString.makeColorString(e.itemData.name,Define.getGradeColor(e.itemData.grade))+"\n"+e.itemData.getDesc(null)),AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(n))}},e.prototype.setStatus=function(){this.data.isGet?this.currentState=this.GOT:(this.currentState=this.HAVE,this.data.level<=xself.getLevel()?(this.btn_get_reward.label=GameText.LEVEL_REWARD_CAN_GET,this.btn_get_reward.enabled=!0,ButtonUtils.addTouchEvent(this.btn_get_reward,this.onGetReward,this)):(this.btn_get_reward.label=GameText.LEVEL_REWARD_NO_GET,this.btn_get_reward.enabled=!1))},e}(ComponentBase);__reflect(LevelRewardItem.prototype,"LevelRewardItem");var LevelRewardPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,this.group_bg.touchEnabled=!1,this.group_bg.touchChildren=!1,this._dataArr?this.getList(this._dataArr):RewardHandler.getLevelRewardList(this.getList,this),xevent.addEventListener(WorldEvent.GET_LEVEL_REWARD_SUCCESS,this.onGetLevelSuccess,this)},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.GET_LEVEL_REWARD_SUCCESS,this.onGetLevelSuccess,this),this.container.reset(),this.itemArr)for(var n=0,i=this.itemArr.length;i>n;n++)Tool.removeObjSafe(this.itemArr[n]),ObjectPool.getPool("LevelRewardItem").returnObject(this.itemArr[n]);this.itemArr=null},e.prototype.getList=function(t){if(this.stage){this._dataArr=t,this.itemArr=[];for(var e=0,n=this._dataArr.length;n>e;e++){var i=ObjectPool.getPool("LevelRewardItem").createObject();nato.attachSkin(i),this.itemArr.push(i),i.data=this._dataArr[e],this.container.add(i)}this.container.update(),this.turn()}},e.prototype.onGetLevelSuccess=function(t){for(var e=0,n=this._dataArr.length;n>e;e++)if(this._dataArr[e].level==t.param){this._dataArr[e].isGet=!0;break}this.turn()},e.prototype.turn=function(){for(var t=[],e=0,n=this.itemArr.length;n>e;e++){var i=this.itemArr[e].data;i.isGet?t.push(0):xself.getLevel()<i.level?t.push(2):t.push(1)}var o=t.indexOf(1);if(0>o){o=t.lastIndexOf(0);var a=t.indexOf(2);0>o?o=a:0>a&&(RewardHandler.isLevelRewardOpen=!1),RewardHandler.canGetLevelReward=!1;var r=PanelManager.getPanel(RewardScene);r.stage&&r.updateRedPoint()}this.container.updateToShowItem(this.itemArr[o],!0)},e}(ComponentBase);__reflect(LevelRewardPanel.prototype,"LevelRewardPanel");var RewardHandler=function(){function t(){}return t.getLevelRewardList=function(t,e){PanelManager.openWaitForServer();var n=MsgHandler.createLevelRewardListMsg();nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),!MsgHandler.isMessageHaveError(n)){for(var i=n.getByte(),o=[],a=0;i>a;a++){var r={};r.level=n.getByte(),r.isGet=n.getBoolean();var s=n.getByte();r.itemList=[];for(var l=0;s>l;l++){var _=new ItemData;_.isMoney=n.getBoolean(),_.isMoney=!_.isMoney,_.isMoney?(_.moneyType=this.toMoneyType(n.getInt()),_.quantity=n.getInt()):(ItemData.fromBytesAtts2(_,n),_.quantity=n.getInt(),_.durMax>0&&(_.durability=_.durMax)),r.itemList.push(_)}o.push(r)}o.sort((function(t,e){return t.level-e.level})),t.call(e,o)}}),this)},t.getLevelReward=function(t,e,n){var i=MsgHandler.createLevelRewardMsg(t);nato.Network.sendCmd(i,(function(t){if(!MsgHandler.isMessageHaveError(t)){var i=t.getInt(),o=t.getInt(),a=t.getInt();xself.setPlayerMoneyValue(i,o,a),MsgHandler.processAddItemMsg(t),e.call(n)}}),this)},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.isLevelRewardOpen=!0,t.canGetLevelReward=!1,t}();__reflect(RewardHandler.prototype,"RewardHandler");var RewardScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),this.removeAllTabBtn(),this.removeAllPanel(),this._tabBtnList=[],this._panelList=[],this._tabNameList=[],SevenDayReward.isOpen&&(this._tabNameList.push(e.tabName_sevenDayReward),this._panelList.push(this.sevenDayRewardPanel)),this._tabNameList.push(e.tabName_loginLottery),this._panelList.push(this.loginLotteryPanel),RewardHandler.isLevelRewardOpen&&(this._tabNameList.push(e.tabName_levelReward),this._panelList.push(this.level_reward_panel));for(var i=0;i<this._tabNameList.length;i++){var o=this["tabBtn_"+i];o.label=this._tabNameList[i],this.group_tabBtns.addChild(o),this._tabBtnList.push(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.loginLotteryPanel.addEventListener(LoginLotteryPanel.Event_finish,this.onLoginLotteryPlayFinish,this),this._tabIndex=0,this.updateTab(),this.updateRedPoint(),this.removeMask()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this.loginLotteryPanel.removeEventListener(LoginLotteryPanel.Event_finish,this.onLoginLotteryPlayFinish,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onLoginLotteryPlayFinish=function(t){this.removeMask()},e.prototype.removeMask=function(){this.rect_mask.parent&&this.rect_mask.parent.removeChild(this.rect_mask)},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel();var t=this._panelList[this._tabIndex];this.addChild(t)},e.prototype.removeAllTabBtn=function(){this.tabBtn_0&&this.tabBtn_0.parent&&this.tabBtn_0.parent.removeChild(this.tabBtn_0),this.tabBtn_1&&this.tabBtn_1.parent&&this.tabBtn_1.parent.removeChild(this.tabBtn_1),this.tabBtn_2&&this.tabBtn_2.parent&&this.tabBtn_2.parent.removeChild(this.tabBtn_2)},e.prototype.removeAllPanel=function(){this.level_reward_panel&&this.level_reward_panel.parent&&this.level_reward_panel.parent.removeChild(this.level_reward_panel),this.sevenDayRewardPanel&&this.sevenDayRewardPanel.parent&&this.sevenDayRewardPanel.parent.removeChild(this.sevenDayRewardPanel),this.loginLotteryPanel&&this.loginLotteryPanel.parent&&this.loginLotteryPanel.parent.removeChild(this.loginLotteryPanel)},e.prototype.updateRedPoint=function(){for(var t=SevenDayReward.isOpen,n=SevenDayReward.checkIsCanDraw(),i=RewardHandler.isLevelRewardOpen,o=RewardHandler.canGetLevelReward,a=LoginLotteryDraw.showInWorld(),r=0;r<this._tabBtnList.length;r++)RedPoint.removeRedPoint(this._tabBtnList[r]);if(t&&n){var s=this.getTabBtnByName(e.tabName_sevenDayReward);RedPoint.addRedPoint(s)}if(i&&o){s=this.getTabBtnByName(e.tabName_levelReward);RedPoint.addRedPoint(s)}if(a){s=this.getTabBtnByName(e.tabName_loginLottery);RedPoint.addRedPoint(s)}},e.prototype.getTabBtnByName=function(t){var e=this._tabNameList.indexOf(t);return-1!=e?this._tabBtnList[e]:null},e.prototype.doLoginLotteryPlay=function(t){this.loginLotteryPanel&&this.loginLotteryPanel.stage&&(this.loginLotteryPanel.doPlay(t),this.addChild(this.rect_mask)),this.updateRedPoint()},e.tabName_sevenDayReward="七天奖励",e.tabName_levelReward="等级奖励",e.tabName_loginLottery="登录抽奖",e}(ComponentBase);__reflect(RewardScene.prototype,"RewardScene");var SevenDayReward=function(){function t(){}return t.processReward=function(e){for(var n=e.getUnsignedByte(),i=e.getUnsignedByte(),o=[],a=0;4>a;a++){var r=new SevenDayRewardData;r.day=e.getByte(),r.money1=e.getInt(),r.money2=e.getInt(),r.money3=e.getInt(),r.isHaveMoney=r.money1>0||r.money2>0||r.money3>0,r.rewardList=[];for(var s=e.getByte(),l=void 0,_=0;s>_;_++)l=ItemData.fromBytesForSevenDayReward(e),r.rewardList.push(l);o.push(r)}t.curDay=n,t.drawStatus=i,t.rewardList=o},t.isDraw=function(e){var n=1<<e;return Tool.isBit(n,t.drawStatus)},t.setDraw=function(e){var n=1<<e;t.drawStatus|=n},t.checkIsCanDraw=function(){if(0==this.isOpen)return!1;for(var e=1;e<=t.curDay;e++)if(e%2!=0&&0==t.isDraw(e))return!0;return!1},t.doGetReward=function(e){var n=MsgHandler.createSevenDayReward(e);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0==n.getByte()){var i=new StringBuffer,o=n.getInt(),a=n.getInt(),r=n.getInt();xself.setMoneyByType(ModelConst.MONEY1,o,i),xself.setMoneyByType(ModelConst.MONEY2,a,i),xself.setMoneyByType(ModelConst.MONEY3,r,i);var s=MsgHandler.processAddItemMsg(n,ProtocolDefine.CG_ACTOR_DRAW_SEVEN_DAY_LOGIN_REWARD);if(i.append(s),WorldMessage.addTips(i.toString()),t.setDraw(e),t.drawStatus==t.allDrawOver&&(t.isOpen=!1),PanelManager.isPanelShow(RewardScene)){var l=PanelManager.getPanel(RewardScene);l.sevenDayRewardPanel.updateStatus(),l.sevenDayRewardPanel.update(),l.updateRedPoint()}}else AlertPanel.alertTips(GameText.getText(GameText.TI_ERROR),n.getString())}),this),PanelManager.openWaitForServer()},t.isOpen=!1,t.curDay=0,t.drawStatus=0,t.allDrawOver=170,t}();__reflect(SevenDayReward.prototype,"SevenDayReward");var SevenDayRewardData=function(){function t(){this.day=0,this.money1=0,this.money2=0,this.money3=0,this.isHaveMoney=!1}return t.prototype.getMoneyDesc=function(){var t="";return this.money1>0&&(t+=GameText.STR_MONEY1+"x"+this.money1+"\n"),this.money2>0&&(t+=GameText.STR_MONEY2+"x"+this.money2+"\n"),this.money3>0&&(t+=GameText.STR_MONEY3+"x"+this.money3+"\n"),t},t}();__reflect(SevenDayRewardData.prototype,"SevenDayRewardData");var SevenDayRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._curSelectIndex=0,e._curDay=0,e._isInitReward=!1,e.ANI_SCALE_LIST1=[0,.2,.4,.6,.8,1,.8,.6,.4,.2],e.ANI_SCALE_LIST2=[.6,.8,1,.8,.6,.4,.2,0,.2,.4],e.ANI_SCALE_LIST3=[.6,.4,.2,0,.2,.4,.6,.8,1,.8],e._logicCount=0,e.counter=0,e.originalFrameTime=100,e.currentFrameTime=100,e}return __extends(e,t),e.prototype.createLightAni=function(){var t=new eui.Image;return t.source="light_ani",t.anchorOffsetX=30,t.anchorOffsetY=30,t},e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this.light_eff1&&(this.light_eff1=this.createLightAni(),this.light_eff2=this.createLightAni(),this.light_eff3=this.createLightAni(),this.light_eff4=this.createLightAni(),this.light_eff5=this.createLightAni(),this.light_eff6=this.createLightAni()),this.eff_ctn1.addChild(this.light_eff1),this.eff_ctn2.addChild(this.light_eff2),this.eff_ctn3.addChild(this.light_eff3),this.eff_ctn4.addChild(this.light_eff4),this.eff_ctn5.addChild(this.light_eff5),this.eff_ctn6.addChild(this.light_eff6),null==this._topDayGroupList&&(this._topDayGroupList=[this.group_day0,this.group_day2,this.group_day1,this.group_day3]),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2]),null==this._tempMoneyData1&&(this._tempMoneyData1=new ItemData,this._tempMoneyData1.isMoney=!0,this._tempMoneyData1.moneyType=ItemData.ITEM_MONEY_TYPE_3,this._tempMoneyData2=new ItemData,this._tempMoneyData2.isMoney=!0,this._tempMoneyData2.moneyType=ItemData.ITEM_MONEY_TYPE_2),this.btn_reward.touchChildren=!1,this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRewardTouch,this);for(var n=0;n<this._topDayGroupList.length;n++){var i=this._topDayGroupList[n];i.touchChildren=!1,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupDayTouch,this)}for(n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this);var o=ImageNum.create(2008);o.num=SevenDayReward.curDay,this.group_dayNum.addChild(o),this.initReward();var a=Math.floor((SevenDayReward.curDay-1)/2);SevenDayReward.isDraw(SevenDayReward.curDay)&&a++,a>3&&(a=3),this._curSelectIndex=a,this.update(),nato.WorldTicker.instance.register(this.logic,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_reward.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRewardTouch,this);for(var n=0;n<this._topDayGroupList.length;n++){var i=this._topDayGroupList[n];i.touchChildren=!1,i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupDayTouch,this)}for(n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this.group_dayNum.removeChildren(),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onGroupDayTouch=function(t){var e=t.target,n=this._topDayGroupList.indexOf(e);-1!=n&&this.onSelectDay(n)},e.prototype.onBtnRewardTouch=function(t){this._curData&&SevenDayReward.curDay>=this._curData.day&&!SevenDayReward.isDraw(this._curData.day)&&SevenDayReward.doGetReward(this._curData.day)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&(e.itemData.isMoney?AlertPanel.alertTipsCommon(this._curData.getMoneyDesc()):AlertPanel.alertTipsCommon(e.itemData.getDesc(xself,!0)))},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onSelectDay=function(t){this._curSelectIndex=t,this.update()},e.prototype.reset=function(){this.init},e.prototype.initReward=function(){if(this.init&&!this._isInitReward){this._isInitReward=!0,this.group_spr0.removeChildren(),this.group_spr1.removeChildren(),this.group_spr3.removeChildren(),this._modelList=[];var t,e,n,i=SevenDayReward.rewardList;n=i[0];for(var o=0;o<n.rewardList.length;o++)if((e=n.rewardList[o]).type==Define.ITEM_TYPE_ARMOR_FASHION){(t=Player.getCompareSprite(xself,e,!0)).setScale(xhdRatio),this._modelList.push(t),this.group_spr0.addChild(t);break}n=i[2];for(o=0;o<n.rewardList.length;o++)if((e=n.rewardList[o]).type==Define.ITEM_TYPE_ARMOR_TRANSPORT){(t=Player.getCompareSprite(xself,e,!0)).setScale(xhdRatio),this._modelList.push(t),this.group_spr1.addChild(t);break}(t=SpriteHelper.createPetSpriteByIcon(21,!1)).setScale(xhdRatio),this._modelList.push(t),this.group_spr3.addChild(t);var a=new MovieClip(xhd?"grideffhd":"grideffsd",-1);a.load(),a.x=xhd?-16:-8,a.y=xhd?-34:-17,this.eff_item.addChild(a),this.updateStatus()}},e.prototype.updateStatus=function(){var t=!1;t=SevenDayReward.isDraw(1),this.img_haveGet0.visible=t,this.img_name0.visible=!t,t=SevenDayReward.isDraw(3),this.img_haveGet2.visible=t,this.img_name2.visible=!t,t=SevenDayReward.isDraw(5),this.img_haveGet1.visible=t,this.img_name1.visible=!t,t=SevenDayReward.isDraw(7),this.img_haveGet3.visible=t,this.img_name3.visible=!t},e.prototype.updateToShowNext=function(){this._curSelectIndex++,this._curSelectIndex>3&&(this._curSelectIndex=3),this.update()},e.prototype.update=function(){if(this.init){var t=this._topDayGroupList[this._curSelectIndex];this.img_select.x=t.x,this.img_select.y=t.y,1==this._curSelectIndex?(this.img_detail_giveTxt.visible=!1,this.img_detail_0.visible=!1,this.img_detail_1.visible=!1,this.img_detail_2.visible=!0,this.img_detail_3.visible=!1):(this.img_detail_giveTxt.visible=!0,this.img_detail_2.visible=!1,this.img_detail_0.visible=0==this._curSelectIndex,this.img_detail_1.visible=1==this._curSelectIndex,this.img_detail_3.visible=3==this._curSelectIndex),this.img_day1.visible=0==this._curSelectIndex,this.img_day3.visible=1==this._curSelectIndex,this.img_day5.visible=2==this._curSelectIndex,this.img_day7.visible=3==this._curSelectIndex,0==this._curSelectIndex?this.showDay1Detail():1==this._curSelectIndex?this.showDay3Detail():2==this._curSelectIndex?this.showDay5Detail():3==this._curSelectIndex&&this.showDay7Detail()}},e.prototype.updateRewardBtn=function(t){var e=0;t<=SevenDayReward.curDay?e=SevenDayReward.isDraw(t)?2:1:e=0,this.btn_getNow.visible=1==e,this.btn_haveGet.visible=2==e,this.btn_notReach.visible=0==e,this.btn_bg.visible=1==e,this.btn_bg_gray.visible=1!=e},e.prototype.clearDetailSpr=function(){this.group_detail_spr0.removeChildren(),this.group_detail_spr1.removeChildren(),this.group_detail_spr2.removeChildren(),this.group_detail_spr0.visible=!1,this.group_detail_spr1.visible=!1,this.group_detail_spr2.visible=!1,this._detailSpr=null,this._detailPetSpr1=null,this._detailPetSpr2=null},e.prototype.showDay1Detail=function(){var t,e,n;this.clearDetailSpr(),e=SevenDayReward.rewardList[0],this._curData=e,n=this._itemList[2],e.money2>0?n.itemData=this._tempMoneyData2:n.itemData=this._tempMoneyData1;for(var i=0;i<e.rewardList.length;i++)(t=e.rewardList[i]).type==Define.ITEM_TYPE_ARMOR_FASHION?(this._detailSpr=Player.getCompareSprite(xself,t,!0),this._detailSpr.setScale(xhdRatio),this.group_detail_spr0.addChild(this._detailSpr),this.group_detail_spr0.visible=!0,(n=this._itemList[0]).itemData=t):(n=this._itemList[1]).itemData=t;this.updateRewardBtn(1)},e.prototype.showDay3Detail=function(){var t,e,n;this.clearDetailSpr(),e=SevenDayReward.rewardList[1],this._curData=e,n=this._itemList[2],e.money2>0?n.itemData=this._tempMoneyData2:n.itemData=this._tempMoneyData1;for(var i=0;i<e.rewardList.length;i++)t=e.rewardList[e.rewardList.length-1-i],(n=this._itemList[i]).itemData=t;this.updateRewardBtn(3)},e.prototype.showDay5Detail=function(){var t,e,n;this.clearDetailSpr(),e=SevenDayReward.rewardList[2],this._curData=e,n=this._itemList[2],e.money2>0?n.itemData=this._tempMoneyData2:n.itemData=this._tempMoneyData1;for(var i=0;i<e.rewardList.length;i++)(t=e.rewardList[i]).type==Define.ITEM_TYPE_ARMOR_TRANSPORT?(this._detailSpr=Player.getCompareSprite(xself,t,!0),this._detailSpr.setScale(xhdRatio),this.group_detail_spr0.addChild(this._detailSpr),this.group_detail_spr0.visible=!0,(n=this._itemList[0]).itemData=t):(n=this._itemList[1]).itemData=t;this.updateRewardBtn(5)},e.prototype.showDay7Detail=function(){var t,e,n;this.clearDetailSpr(),e=SevenDayReward.rewardList[3],this._curData=e,n=this._itemList[2],e.money2>0?n.itemData=this._tempMoneyData2:n.itemData=this._tempMoneyData1;for(var i=0;i<e.rewardList.length;i++)t=e.rewardList[i],(n=this._itemList[i]).itemData=t;this._detailPetSpr1=SpriteHelper.createPetSpriteByIcon(21,!1),this._detailPetSpr2=SpriteHelper.createPetSpriteByIcon(209,!1),this._detailPetSpr1.setScale(xhdRatio),this._detailPetSpr2.setScale(xhdRatio),this.group_detail_spr1.visible=!0,this.group_detail_spr2.visible=!0,this.group_detail_spr1.addChild(this._detailPetSpr1),this.group_detail_spr2.addChild(this._detailPetSpr2),this.updateRewardBtn(7)},e.prototype.logic=function(t){if(this.currentFrameTime-=t,!(this.currentFrameTime>0)){this.currentFrameTime=this.originalFrameTime,this.counter+=1;var e=this.counter%10;this.setObjectScale(this.light_eff1,this.ANI_SCALE_LIST1[e]),this.setObjectScale(this.light_eff2,this.ANI_SCALE_LIST2[e]),this.setObjectScale(this.light_eff3,this.ANI_SCALE_LIST3[e]),this.setObjectScale(this.light_eff4,this.ANI_SCALE_LIST1[e]),this.setObjectScale(this.light_eff5,this.ANI_SCALE_LIST2[e]),this.setObjectScale(this.light_eff6,this.ANI_SCALE_LIST3[e]),this.counter>=1e3&&(this.counter=0)}},e.prototype.setObjectScale=function(t,e){t.scaleX=e,t.scaleY=e},e}(ComponentBase);__reflect(SevenDayRewardPanel.prototype,"SevenDayRewardPanel");var SpringReward=function(){function t(){}return t.processReward=function(e){for(var n=e.getByte(),i=e.getBoolean(),o=e.getUnsignedByte(),a=[],r=[],s=0;14>s;s++){var l=new SpringRewardData;l.day=e.getByte(),l.money1=e.getInt(),l.money2=e.getInt(),l.money3=e.getInt(),l.isHaveMoney=l.money1>0||l.money2>0||l.money3>0,l.rewardList=[];for(var _=e.getByte(),h=void 0,u=0;_>u;u++)h=ItemData.fromBytesForSevenDayReward(e),l.rewardList.push(h);7>s?a.push(l):r.push(l)}t.curDay=n,t.hasExtraReward=i,t.drawStatus=o,t.rewardList=a,t.advancedRewardList=r},t.isRewardDrawed=function(e){var n=1<<e;return Tool.isBit(n,t.drawStatus)},t.setDraw=function(e){var n=1<<e;t.drawStatus|=n},t.checkIsCanDraw=function(){return 0!=this.isOpen&&0==t.isRewardDrawed(this.curDay)},t.doGetReward=function(e){var n=MsgHandler.createSpringReward(e);nato.Network.sendCmd(n,(function(n){if(PanelManager.closeWaitForServer(),0==n.getByte()){var i=new StringBuffer,o=n.getInt(),a=n.getInt(),r=n.getInt();xself.setMoneyByType(ModelConst.MONEY1,o,i),xself.setMoneyByType(ModelConst.MONEY2,a,i),xself.setMoneyByType(ModelConst.MONEY3,r,i);var s=MsgHandler.processAddItemMsg(n,ProtocolDefine.CG_ACTOR_DRAW_SPRING_LOGIN_REWARD);if(i.append(s),WorldMessage.addTips(i.toString()),t.setDraw(e),t.drawStatus==t.allDrawOver&&(t.isOpen=!1),PanelManager.isPanelShow(SpringRewardPanel))PanelManager.getPanel(SpringRewardPanel).update()}else AlertPanel.alertTips(GameText.getText(GameText.TI_ERROR),n.getString())}),this),PanelManager.openWaitForServer()},t.isOpen=!1,t.curDay=0,t.hasExtraReward=!1,t.rewardList=[],t.advancedRewardList=[],t.drawStatus=0,t.allDrawOver=254,t}();__reflect(SpringReward.prototype,"SpringReward");var SpringRewardData=function(){function t(){this.day=0,this.money1=0,this.money2=0,this.money3=0,this.rewardList=[],this.isHaveMoney=!1}return t.prototype.getMoneyDesc=function(){var t="";return this.money1>0&&(t+=GameText.STR_MONEY1+"x"+this.money1+"\n"),this.money2>0&&(t+=GameText.STR_MONEY2+"x"+this.money2+"\n"),this.money3>0&&(t+=GameText.STR_MONEY3+"x"+this.money3+"\n"),t},t}();__reflect(SpringRewardData.prototype,"SpringRewardData");var OtherPlayerPanel=function(t){function e(){var e=t.call(this)||this;return e.btnStr=[GameText.getText(GameText.TI_CHATMSG_PLAYER),GameText.getText(GameText.TI_MAKE_FRIEND),GameText.getText(GameText.TI_NO_TALK),GameText.getText(GameText.TI_PK),GameText.getText(GameText.TI_INVITE_COUNTRY),GameText.getText(GameText.TI_SEE_CITY),GameText.getText(GameText.TI_SEND_MAIL),GameText.getText(GameText.TI_SEE_PLAYER_SHOP),GameText.getText(GameText.TI_TEAM_INVITE),GameText.getText(GameText.TI_JOIN_TEAM),GameText.getText(GameText.TI_CARD_VIEW)],e}return __extends(e,t),e.getPlayer=function(){return e.player||(e.player=new ListPlayer),e.player},e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),Menu.setData(this,e.player,e.menuType);for(var i=-1,o=!1,a=0,r=this.btnStr.length;r>a;a++)this["btn_"+a].visible&&(o=!1,(i=this.btnStr.indexOf(this["btn_"+a].label))>=0?(o=!0,e.channel>0&&e.channel!=Define.CHAT_TYPE_MAP&&e.channel!=Define.CHAT_TYPE_PRIVATE&&(this["btn_"+a].label==GameText.getText(GameText.TI_TEAM_INVITE)||this["btn_"+a].label==GameText.getText(GameText.TI_JOIN_TEAM))&&(o=!1,this["btn_"+a].visible=!1)):e.menuType==Menu.UI_INTO_FRIEND_LIST&&this["btn_"+a].label==GameText.STR_DEL_FRIEND?(o=!0,i=1):e.menuType==Menu.UI_INTO_BLACK_LIST&&this["btn_"+a].label==GameText.STR_CANCEL_SCREEN?(o=!0,i=2):this["btn_"+a].visible=!1,o&&(this["btn_"+a].x=i%3*100*xhdRatio,this["btn_"+a].y=31*Math.floor(i/3)*xhdRatio));this.update()},e.prototype.onRemoveFromStage=function(n){t.prototype.onRemoveFromStage.call(this,n),e.channel=-1,ButtonUtils.removeTouchEvent(this.btn_search),GameWorld.isShowStarAndGem=!1},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.update=function(){this.label_name.text=e.player.getName()+"("+GameText.STR_POWER+e.player.powerX+")",this.label_level.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),e.player.getLevel()+"")+Define.getJobString(e.player.getJob()),this.label_partner.text=0==Tool.isNullText(e.player.partnerName)?e.player.partnerName:GameText.STR_LIST_NULL,this.label_kill.text=e.player.killCount+"";var t=e.player.getCountryName();Tool.isNullText(t)&&(t=GameText.STR_LIST_NULL),this.label_country.text=t,this.label_tudi.text=e.player.disciple,this.label_level2.text=e.player.getLevel2()+"",this.label_pk.text=e.player.getPKWin()+"";var n=e.player.getTitle();Tool.isNullText(n)&&(n=GameText.STR_LIST_NULL),this.label_title.text=n,ButtonUtils.addTouchEvent(this.btn_search,this.onSearch,this),this.updateSearchText(),this.roleEquipView.update(e.player)},e.prototype.onSearch=function(){GameWorld.isShowStarAndGem=!GameWorld.isShowStarAndGem,xevent.dispatchEventWith(WorldEvent.BAG_SHOW_CHECK_STAR),this.updateSearchText()},e.prototype.updateSearchText=function(){this.btn_search&&(GameWorld.isShowStarAndGem?this.btn_search.label=GameText.STR_CLOSE_SEARCH:this.btn_search.label=GameText.STR_SEARCH)},e.channel=-1,e}(ScenePanelBase);__reflect(OtherPlayerPanel.prototype,"OtherPlayerPanel");var PlayerInfoUIAction=function(){function t(){}return t.getAttributeText=function(t){return 0>t||t>=this.ATTRIBUTE_TEXT.length?"":this.ATTRIBUTE_TEXT[t]},t.getSocietyText=function(t){return 0>t||t>=this.SOCIETY_EXPLAIN.length?"":this.SOCIETY_EXPLAIN[t]},t.initAttributeText=function(t){var e=new Player;e.setLevel(t.getLevel());var n=new Battle,i=0,o=t.getLevel()+"",a=t.get(ModelConst.ATK_MIN)+"",r=t.get(ModelConst.ATK_MAX)+"",s=t.get(ModelConst.ATK_TIME)+"",l=n.calc(BattleConst.BATTLE_RD_STR,t,e,null)+"",_=n.calc(BattleConst.BATTLE_RD_AGI,t,e,null)+"",h=n.calc(BattleConst.BATTLE_RD_MAGIC,t,e,null)+"",u=(i=(i=n.calc(BattleConst.BATTLE_MAGIC_HITRATE,t,e,null))>100?100:i)+"",c=Tool.getPointValue(t.get(ModelConst.HIT_MAGIC),1),T=n.calc(BattleConst.BATTLE_CRI_RATE,t,e,null)+"";i=(i=t.get(ModelConst.WIL))>700?700:i;var p=Tool.getPointValue(i,1),d=Tool.getPointValue(t.get(ModelConst.TOUGH),1),E=n.calc(BattleConst.BATTLE_BLOCK,t,e,null)+"",g=t.get(ModelConst.BRK_ARMOR)+"",S=t.get(ModelConst.MAGIC_PENETRATION)+"",m=t.get(ModelConst.FORCE_HIT)+"",f=t.get(ModelConst.HEAL_RECOVERY)+"",I=t.get(ModelConst.MANA_RECOVERY)+"",A=n.calc(BattleConst.BATTLE_BACK,t,e,null)+"",y=n.calc(BattleConst.BATTLE_MAGIC_BACK,t,e,null)+"",R=Tool.getPointValue(t.get(ModelConst.LIFE_ABSORPTION),1)+"",P=Tool.getPointValue(t.get(ModelConst.MANA_ABSORPTION),1)+"",C=n.calc(BattleConst.BATTLE_INSIGHT,t,e,null)+"",M=(Tool.manageString(GameText.getText(GameText.TI_LEVEL),t.getLevel2()+""),t.get(ModelConst.HPMAX)-t.getOld(ModelConst.HPMAX)),L=M>0?"+"+M:"+0",v=t.get(ModelConst.MPMAX)-t.getOld(ModelConst.MPMAX),O=v>0?"+"+v:"+0",N=t.get(ModelConst.HP)+"/"+t.get(ModelConst.HPMAX),D=t.get(ModelConst.MP)+"/"+t.get(ModelConst.MPMAX),B="";(4==t.getType()||7==t.getType())&&(B=t.getPetBornStatusInfo(!1,0,!0),B=Tool.isNullText(B)?GameText.STR_BORNSTATUS_INFO_NO:GameText.STR_BORNSTATUS_INFO_HAVE+B);var b=[[N],[D],[L,O],[B],[],[a+"~"+r],[s],[],[],[],[o,l],[o,_],[o,h],[],[],[o,u,c],[o,T],[p,p],[d,d],[o,E],[g],[S],[m,Model.MAX_FORCE_RATE+""],[f],[I],[],[A,A],[y,y],[R],[P],[C],[t.get(ModelConst.KEEPOUT_ATK_TIME)+""],[],[],[],[],[],[],[t.get(ModelConst.IGNORE_WIL)+""],[t.get(ModelConst.IGNORE_TOUCH)+""],[t.get(ModelConst.IGNORE_BLOCK)+""],[t.get(ModelConst.IGNORE_BACK)+""],[t.get(ModelConst.IGNORE_INSIGHT)+""],[t.get(ModelConst.IGNORE_MAGIC_BACK)+""],[t.getPower(!1)+""]];this.CHANGE_TEXT=b},t.getPlayerAttributeText=function(e,n){return this.initAttributeText(n),0>e||e>=this.CHANGE_TEXT.length?GameText.STR_NO_DESC:Tool.manageStringList(t.getAttributeText(e),this.CHANGE_TEXT[e])},t.getChangeText=function(t){return this.initAttributeText(t),this.CHANGE_TEXT},t.initSocietyText=function(t){if(null!=t){var e=t.get(ModelConst.MONEY1)+"",n=t.get(ModelConst.MONEY2)+"",i=t.get(ModelConst.MONEY3)+"",o="";t.titlePower1>0&&(o+=Define.getPowerDesc(t.titlePower1,t.titlePowerValue1)+"\n"),t.titlePower2>0&&(o+=Define.getPowerDesc(t.titlePower2,t.titlePowerValue2)+"\n"),o=1==Tool.isNullText(o)?GameText.STR_NEW_TITLE_INFO:PowerString.makeColorString(o,ColorUtils.COLOR_GREEN);var a,r=GameText.STR_VIP,s=GameText.STR_NO_VIP_INFO;return a=Tool.manageString(GameText.STR_OPEN_VIP,r)+s,[[e],[n],[i],[],[],[],[t.getEnchantValue()+""],[t.exp2+"",t.expMax2+""],[a],[],[],[],[],[],[],[o],[],[]]}},t.ATTR_HP=0,t.ATTR_MP=1,t.ATTR_LEVEL2=2,t.ATTR_BORNSTATUS=3,t.ATTR_SPEED=4,t.ATTR_DMG=5,t.ATTR_ATK_TIME=6,t.ATTR_ATK_STR=7,t.ATTR_ATK_AGI=8,t.ATTR_ATK_MAGIC=9,t.ATTR_DEF_STR=10,t.ATTR_DEF_AGI=11,t.ATTR_DEF_MAGIC=12,t.ATTR_DODGE=13,t.ATTR_HIT_RATE=14,t.ATTR_HIT_MAGIC=15,t.ATTR_CRITICAL=16,t.ATTR_WIL=17,t.ATTR_TOUGH=18,t.ATTR_BLOCK=19,t.ATTR_BRK=20,t.ATTR_MAGIC_PEN=21,t.ATTR_FORCE_HIT=22,t.ATTR_AUTO_HP=23,t.ATTR_AUTO_MP=24,t.ATTR_DEF_FIELD=25,t.ATTR_BACK=26,t.ATTR_MAGIC_BACK=27,t.ATTR_GET_HP=28,t.ATTR_GET_MP=29,t.ATTR_INSIGHT=30,t.ATTR_KEEPOUT_ATK_TIME=31,t.ATTR_MONEY1=32,t.ATTR_MONEY2=33,t.ATTR_MONEY3=34,t.ATTR_INTEGRAL=35,t.ATTR_ARENA=36,t.ATTR_SKY_ARENA=37,t.ATTR_IGNORE_WIL=38,t.ATTR_IGNORE_TOUCH=39,t.ATTR_IGNORE_BLOCK=40,t.ATTR_IGNORE_BACK=41,t.ATTR_IGNORE_INSIGHT=42,t.ATTR_IGNORE_MAGIC_BACK=43,t.ATTR_POWER=44,t.ATTRIBUTE_TEXT=["生命：/c00FF00%U/p","法力：/c00FF00%U/p","生命上限：/c00FF00%U/p\n法力上限：/c00FF00%U/p\n提高掉宝几率（包括怪物掉落、宝箱开启极品）。掉宝几率随传奇等级提高而增加。\n\n降低敌人：格挡、洞察、反击、魔法反馈、劈砍防御、法术防御、穿刺防御、致命率，法术命中。传奇等级越高效果越明显。","%U","出手速度的高低决定了战斗中每回合中行动的顺序。敏捷（大）和感知（小）属性能提高出手速度。","当前伤害/c00FF00%U/p，武器伤害越高，战斗中能造成的伤害越大。","你的一次攻击指令，将对目标进行/c00FF00%U/p 次攻击。每次的命中率、致命率都将独立计算。总攻击力/攻击次数 + 武器伤害 = 每次攻击的攻击力。","使用劈砍类攻击武器、技能时，将以劈砍攻击力计算伤害。目标也以劈砍防御进行防御计算。力量（大）和敏捷（小）属性能提高劈砍攻击力。","使用穿刺类攻击武器、技能时，将以穿刺攻击力计算伤害。目标也以穿刺防御进行防御计算。力量和敏捷属性能提高穿刺攻击力。","使用魔法类攻击武器、技能时，将以魔法攻击力计算伤害。目标也以魔法防御进行防御计算。智力（大）和感知（小）属性能提高魔法攻击力。","在受到同等级（/c00FF00%U级/p）敌人的劈砍攻击时，将减少/c00FF00%U%/p 对你造成的伤害。敌人等级越高，减伤效果越低。反之等级越低，减伤效果越高。体质（大）属性能提高劈砍防御力。","在受到同等级（/c00FF00%U级/p）敌人的穿刺攻击时，将减少/c00FF00%U%/p 对你造成的伤害。敌人等级越高，减伤效果越低。反之等级越低，减伤效果越高。体质（大）属性能提高劈砍防御力。","在受到同等级（/c00FF00%U级/p）敌人的魔法攻击时，将减少/c00FF00%U%/p 对你造成的伤害。敌人等级越高，减伤效果越低。反之等级越低，减伤效果越高。感知（大）和智力（小）能提高魔法防御力。","你的闪避越高，敌人命中你的几率越低。敏捷和感知属性能提高闪避。","物理命中 减去 目标的闪避 等于 命中率。物理命中越高，物理攻击命中敌人的几率越大。","你使用魔法攻击在攻击同等级（/c00FF00%U级/p）敌人时，将有/c00FF00%U%/p 几率命中敌人。并且你的魔法攻击力将获得/c00FF00%U%/p 的增加。","你在攻击同等级（/c00FF00%U级/p）敌人时，将有/c00FF00%U%/p 几率造成2倍的致命伤害。","当你受到负面状态时，有 /c00FF00%U%/p 的几率。使该状态无效。每回合结束时，有/c00FF00%U%/p的几率，取消身上一个负面状态。感知（大）和智力（小）能提高状态抵抗。","每次受到伤害时，将减少 /c00FF00%U%/p 的伤害。遭受到百分比生命扣减时，将减少/c00FF00%U%/p 的扣减效果。最高70%。","当承受同等级（/c00FF00%U级/p）敌人的物理攻击时，将有/c00FF00%U%/p机会格档对方的攻击，格挡率最高为/c00FF0070%/p。成功格档时，将不受到伤害。如果该次攻击，有多次攻击次数的话，每成功格挡一次将减少10%的格挡几率。","物理攻击时，忽略目标 /c00FF00%U/p 点的劈砍和穿刺防御力。","魔法攻击时，忽略目标 /c00FF00%U/p 点的魔法防御力。","使用物理攻击时，有/c00FF00%U%/p的几率必然命中。最高上限/c00FF00%U%/p。","每回合开始前自动恢复/c00FF00%U/p点生命。","每回合开始前自动恢复/c00FF00%U/p点法力。","法力护盾可抵消战斗中产生的任何伤害和负面效果。每抵消1点伤害需消耗1点法力护盾和1点法力值。当足够法力不足时，法力护盾无效。","有/c00FF00%U%/p的几率自动反击物理类型攻击，将其攻击伤害的/c00FF00%U%/p反伤攻击者。最高可反击70%伤害。","有/c00FF00%U%/p的几率自动反击魔法类型攻击，将其攻击伤害的/c00FF00%U%/p反伤攻击者。最高可反击70%伤害。","对目标造成伤害时，自身恢复等于伤害/c00FF00%U%/p的生命。","对目标造成伤害时，自身恢复等于伤害/c00FF00%U%/p的法力。","有/c00FF00%U%/p几率使对你产生的魔法、诅咒攻击效果无效化。洞察法术需消耗对方使用魔法的法力值，法力不足则无法启动。","你可以抵消/c00FF00%U/p次攻击伤害。注意，免伤护盾无法抵御伤害以外的其他负面状态。","","","","","","","发动攻击时，忽略目标 /c00FF00%U/p 点的状态抵抗。","发动攻击时，忽略目标 /c00FF00%U/p 点的伤害减免。","发动穿刺攻击和劈砍攻击时，忽略目标 /c00FF00%U/p 点的格挡。","发动穿刺攻击和劈砍攻击时，忽略目标 /c00FF00%U/p 点的反击。","发动魔法攻击和诅咒攻击时，忽略目标 /c00FF00%U/p 点的洞察。","发动魔法攻击时，忽略目标 /c00FF01%U/p 点的魔法反馈。","战力代表着你的综合实力，当前拥有 /c00FF00%U/p 点战力，战力受当前列表属性及角色属性点影响"],t.Society_Money1=0,t.Society_Money2=1,t.Society_Money3=2,t.Society_INTEGRAL=3,t.Society_ARENA=4,t.Society_SKY_ARENA=5,t.Society_ENCHANT=6,t.Society_PLAYER_LEVEL2=7,t.Society_POSITION=8,t.Society_STORE_NUM=9,t.Society_KILL_COUNT=10,t.Society_PK_WIN_COUNT=11,t.Society_PK_WIN_RATE=12,t.Society_LIST_DESC_PARTNER=13,t.Society_MASTER_AND_APPRENTICE=14,t.Society_TITLE=15,t.Society_REINFORCEMENTS=16,t.Society_HIDDEN_LOVE=17,t.Society_incomeLimit=18,t.Society_payLimit=19,t.SOCIETY_EXPLAIN=["当前数额/cFFFF00 %U/p\n黄金可支付所有的增值服务费用，并可替代金叶进行支付。黄金通过充值获得。","当前数额/c9acaff %U/p\n金叶为绑定货币，不可进行交易，可用于购买绑定性的增值道具。金叶通过任务和充值获得。","当前数额/cc45712 %U/p\n铜币是游戏流通货币，用于支付各种游戏道具。铜币通过任务、怪物掉落等途径获得。","每天在指定时间内参加团队副本战斗，可获取荣誉积分。","每天在指定时间内加入竞技场与其他玩家共同竞技，胜利则可获取竞技积分。","每天参加天空竞技场挑战守护者，战胜可获得挑战积分。","附魔值： %U\n您可以通过吸收装备获得附魔值,通过消耗附魔值给装备进行附魔，即将指定的附魔属性附加到装备上。同时，附魔需要相应的附魔道具，您可以在附魔商店购买。附魔道具可以自己在背包中使用。被附魔的装备等级不得低于附魔道具的等级。当然，一个装备只允许被附魔一次，新的附魔效果会覆盖已有的效果。","传奇经验：\n%U\n当你的/c00FF00角色满级/p后，你所得到的经验会自动转化成传奇经验。通过获取传奇经验提升传奇等级。传奇等级可/c00FF00提升你的战斗属性/p，让你在战斗时更具优势；增加传奇等级还能/c00FF00提高怪物掉宝率/p，并且让/c00FF00宝箱开出极品的几率更高/p。","%U","使用仓库扩展道具可增加仓库格数。","至今击杀的所有怪物总数。","与其他玩家决斗胜利的次数。","与他人决斗胜利的概率。","伴侣\n夫妻双方同时在线可获得1.1倍经验\n夫妻之间互相传送无需使用传送石","玩家只可成为徒弟或者师傅（可收5个徒弟）之一的身份。当维持三天以上关系时，师父可获得徒弟充价值金额5%的金叶。徒弟40级或超越师傅等级时，自动脱离师徒关系。","%U","当盟国发生国战时，你可以申请加入援军，协助盟军作战！","查看他人相册时，可以偷偷选择暗恋的对象哦！","%U","%U"],t}();__reflect(PlayerInfoUIAction.prototype,"PlayerInfoUIAction");var RoleAddPointItem=function(t){function e(){var e=t.call(this)||this;return e._attributeID=0,e._timeout=0,e._interval=0,e._tapTime=500,e._intervalTime=70,e._currAutoAddPoint=0,e._autoAddPoint=0,e._isAutoAddPoint=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.addBtnEvent(),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.removeBtnEvent(),this.clearTime(this.btn_add),this.clearTime(this.btn_mimus),this._isAutoAddPoint=!1,this._currAutoAddPoint=0,this._autoAddPoint=0,this._tapTime=500,this._intervalTime=70},e.prototype.clearTime=function(t){clearTimeout(this._timeout),clearInterval(this._interval),t==this.btn_add?(this.btn_add.removeEventListener(egret.TouchEvent.TOUCH_END,this.onAddEnd,this),this.btn_add.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onAddTouchOutside,this)):(this.btn_mimus.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMinusEnd,this),this.btn_mimus.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMinusTouchOutside,this))},e.prototype.removeBtnEvent=function(){this.btn_add.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onAddBegin,this),this.btn_mimus.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMinusBegin,this)},e.prototype.addBtnEvent=function(){this.btn_add.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onAddBegin,this),this.btn_mimus.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMinusBegin,this)},e.prototype.onAddBtnTouch=function(t){void 0===t&&(t=null),t||(t=this);var e=0;t._isAutoAddPoint?e=t._currAutoAddPoint--:e=PanelManager.getPanel(RoleScene).basePanel.havePoint;e>0?t.setAddPoint(parseInt(t.label_addPoint.text)+1,1):(t.clearTime(t.btn_add),t._isAutoAddPoint&&(t.label_addPoint.text=t.label_addPoint.text+"(+"+t._autoAddPoint+")",xevent.dispatchEvent(new WorldEvent(WorldEvent.AUTO_ADD_POINT_FINISH))))},e.prototype.onAddBegin=function(t){0!=SafeLock.doSafeLockVerify()&&(this.btn_add.addEventListener(egret.TouchEvent.TOUCH_END,this.onAddEnd,this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onAddTouchOutside,this),this._timeout=setTimeout(this.delayAdd,this._tapTime,this))},e.prototype.onAddEnd=function(t){ButtonUtils.buttonTweenEffect(this.btn_add,this.onAddBtnTouch,this),this.clearTime(this.btn_add)},e.prototype.onAddTouchOutside=function(t){this.clearTime(this.btn_add)},e.prototype.delayAdd=function(t){t._interval=setInterval(t.onAddBtnTouch,t._intervalTime,t)},e.prototype.onMinusBegin=function(t){0!=SafeLock.doSafeLockVerify()&&(this._timeout=setTimeout(this.delayMinus,this._tapTime,this),this.btn_mimus.addEventListener(egret.TouchEvent.TOUCH_END,this.onMinusEnd,this),this.btn_mimus.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onMinusTouchOutside,this))},e.prototype.delayMinus=function(t){t._interval=setInterval(t.onMinusBtnTouch,t._intervalTime,t)},e.prototype.onMinusEnd=function(t){ButtonUtils.buttonTweenEffect(this.btn_mimus,this.onMinusBtnTouch,this),this.clearTime(this.btn_mimus)},e.prototype.onMinusTouchOutside=function(t){this.clearTime(this.btn_mimus)},e.prototype.onMinusBtnTouch=function(t){void 0===t&&(t=null),t||(t=this),parseInt(t.label_addPoint.text)>0?t.setAddPoint(parseInt(t.label_addPoint.text)-1,-1):t.clearTime(t.btn_mimus)},e.prototype.setAddPoint=function(t,e){this.label_addPoint.text=t+"",PanelManager.getPanel(RoleScene).basePanel.changeProp(this._attributeID,e),this.setColor()},e.prototype.setColor=function(){var t=this._baseAtt,e=parseInt(this.label_addPoint.text);this.label_addPoint.textColor=t>e?ColorUtils.COLOR_RED:e==t?ColorUtils.COLOR_WHITE:ColorUtils.COLOR_GREEN},e.prototype.setAttributeID=function(t,e,n,i){this._buffAtt=n,this._attributeID=t,this._baseAtt=e,this._addAtt=i,this.update()},e.prototype.update=function(){this.init&&(this.label_value.text=this.getAttDesc(this._baseAtt,this._addAtt),this.label_addPoint.text=this._buffAtt+"",this.setColor(),this.label_prop.text=ModelConst.getAttributeName(this._attributeID))},e.prototype.getAttDesc=function(t,e){var n=new StringBuffer;n.append(t+"");var i=e-t;return i>0?n.append("(+"+i+")"):0>i&&n.append("("+i+")"),n.toString()},e.prototype.autoAddPoint=function(t){this._currAutoAddPoint=t,this._autoAddPoint=t},Object.defineProperty(e.prototype,"isAutoAddPoint",{set:function(t){this._isAutoAddPoint=t,t?(this._tapTime=300,this._currAutoAddPoint>=20?this._intervalTime=100:this._intervalTime=200):(this._tapTime=500,this._intervalTime=70)},enumerable:!0,configurable:!0}),e.prototype.beginToAddPoint=function(){this._timeout=setTimeout(this.delayAdd,this._tapTime,this)},e}(ComponentBase);__reflect(RoleAddPointItem.prototype,"RoleAddPointItem");var RoleBasePanel=function(t){function e(){var e=t.call(this)||this;return e.NEW_PLAYER="newPlayer",e.NORMAL="normal",e.addPointFinishCount=0,e.addPointDesc="",e.isCheckNewPlayer=!0,e.bar_width=183,e._addPointPropIDList=[ModelConst.STR,ModelConst.CON,ModelConst.AGI,ModelConst.ILT,ModelConst.WIS],e._baseAtt=[],e._buffAtt=[],e.canSetBaseAt=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e);var n=!1,i=this.getPlayer();i.getId()==xself.getId()?i.unwatch():n=!0,this.setBaseAtt(),ButtonUtils.addTouchEvent(this.btn_sure,this.onSureBtnTouch,this),ButtonUtils.addTouchEvent(this.img_buff,this.onBuffTouch,this);var o=i.sprite;if(this.playerSprite=GameSprite.cloneSprite(o),this.playerSprite.setScale(nato.mapRatio),this.spriteCtn.addChild(this.playerSprite),this.spriteCtn.touchChildren=this.spriteCtn.touchEnabled=!1,this.touchEnabled=!1,this.isClosePanel=!1,this.havePoint>0&&this.isCheckNewPlayer&&i.isNovice){switch(this.btn_add_auto.enabled=!0,this.currentState=this.NEW_PLAYER,ButtonUtils.addTouchEvent(this.btn_add_auto,this.onBtnAddAuto,this),this.group_add_auto.scaleX=1,this.group_add_auto.scaleY=1,this.addChild(this.group_add_auto),this.autoAddPointItemArr=[],this.addPointDesc="",i.getJob()){case Define.JOB_RANGER:this.autoAddPointItemArr.push(this.addPointItem_2),this.addPointDesc+=ModelConst.getAttributeName(ModelConst.AGI);break;case Define.JOB_XIUZHEN:this.autoAddPointItemArr.push(this.addPointItem_1),this.autoAddPointItemArr.push(this.addPointItem_4);break;case Define.JOB_WARRIOR:this.autoAddPointItemArr.push(this.addPointItem_0),this.addPointDesc+=ModelConst.getAttributeName(ModelConst.STR);break;case Define.JOB_WIZARD:this.autoAddPointItemArr.push(this.addPointItem_3),this.addPointDesc+=ModelConst.getAttributeName(ModelConst.ILT)}if(i.getJob()!=Define.JOB_XIUZHEN)this.autoAddPointItemArr[0].autoAddPoint(this.havePoint),this.autoAddPointItemArr[0].isAutoAddPoint=!0,this.addPointDesc+="+"+this.havePoint;else{var a=Math.ceil(2*this.havePoint/3),r=this.havePoint-a;this.addPointItem_4.autoAddPoint(a),r>0&&(this.addPointItem_1.autoAddPoint(r),this.addPointItem_1.isAutoAddPoint=!0,this.addPointDesc+=ModelConst.getAttributeName(ModelConst.CON)+"+"+r+"  "),this.addPointDesc+=ModelConst.getAttributeName(ModelConst.WIS)+"+"+a,this.addPointItem_4.isAutoAddPoint=!0}this.addPointDesc+="\n\n",n=!0}else this.currentState=this.NORMAL,this.isCheckNewPlayer=!1;if(n)for(var s=0;s<this._addPointPropIDList.length;s++){this["addPointItem_"+s].removeBtnEvent()}var l=i.isPower()||i.isHasCountrypower()||null!=i.playerTurnMonster;this.img_buff.visible=l,this.validateNow(),egret.callLater(this.checkGuide,this)},e.prototype.checkGuide=function(){1==GameWorld.useGuide&&(1==GameWorld.isLoginSetting(GameWorld.IS_GUIDE_ADD_POINT_TIPS)?(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_ADD_POINT_TIPS),GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_TIPS),PanelManager.setStatusFlag(!0,PanelManager.FLAG_IS_ADD_POINT_GUIDE)):1==GameWorld.isLoginSetting(GameWorld.IS_GUIDE_SEL_AUTO_SKILL2)&&(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_SEL_AUTO_SKILL2),GameWorld.setGuide(GameWorld.GUIDE_SEL_AUTO_SKILL2)))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_sure),ButtonUtils.removeTouchEvent(this.btn_add_auto),ButtonUtils.removeTouchEvent(this.img_buff),this.spriteCtn.removeChildren(),this.playerSprite=null,this.canSetBaseAt&&(this.basePlayer=null)},e.prototype.getAddPointWidgetByJob=function(){switch(this.getPlayer().getJob()){case Define.JOB_RANGER:return this.addPointItem_2.btn_add;case Define.JOB_XIUZHEN:return this.addPointItem_4.btn_add;case Define.JOB_WARRIOR:return this.addPointItem_0.btn_add;case Define.JOB_WIZARD:return this.addPointItem_3.btn_add}},e.prototype.getPointAddConfirmWidget=function(){return this.btn_sure},Object.defineProperty(e.prototype,"havePoint",{get:function(){return this._havePoint},set:function(t){this._havePoint=t,this.label_havePoint.text=t+""},enumerable:!0,configurable:!0}),e.prototype.sureBtnStatus=function(){this.currentState!=this.NEW_PLAYER&&(this.isChangeAttValue()?this.btn_sure.parent||this.addChild(this.btn_sure):this.btn_sure.parent&&this.btn_sure.parent.removeChild(this.btn_sure))},e.prototype.changeProp=function(t,e){var n=this.getPlayer();this.basePlayer||(this.basePlayer=n.clonePlayer()),n.addValue(t,e),n.cp-=e,this._buffAtt[t-ModelConst.STR]+=e,this.havePoint-=e,(n=n).get(ModelConst.HP)<this._baseHP&&(n.hp=Math.min(this._baseHP,n.get(ModelConst.HPMAX))),n.get(ModelConst.MP)<this._baseMP&&(n.mp=Math.min(this._baseMP,n.get(ModelConst.MPMAX))),this.sureBtnStatus(),this.updateUI()},e.prototype.onSureBtnTouch=function(t){void 0===t&&(t=!0);var e=new StringBuffer;t&&e.append(GameText.STR_CHANGE_ATT_ASK),this.getNeedMoneyArray(e);var n=this.getChangeAttDesc(e);if(t)AlertPanel.alertTextFlow(GameText.getText(GameText.TI_ATTR_SET),n,this.onSureChangePoint,this.onCancelChangePoint,this,this.alertPopUp);else{var i=xhd?40:20;n.unshift(TextFieldUtils.getTextFlowElement(this.addPointDesc,ColorUtils.COLOR_GREEN,i)),n.unshift(TextFieldUtils.getTextFlowElement(GameText.STR_ADD_POINT,-1,i));var o=AlertPanel.alertNotifyTextFlow(GameText.STR_AUTO_ADD_POINT_TITLE,n,this.onSureChangePoint,this.onSureChangePoint,this,(function(){1==GameWorld.useGuide&&(PanelManager.isStatusFlag(PanelManager.FLAG_IS_ADD_POINT_GUIDE)&&GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_SURE_SHOW,o.btn_ok))}));o.btn_close.visible=!1}},e.prototype.alertPopUp=function(){1==GameWorld.useGuide&&this.getPlayer().isNovice&&1==PanelManager.isStatusFlag(PanelManager.FLAG_IS_ADD_POINT_GUIDE)&&(PanelManager.setStatusFlag(!1,PanelManager.FLAG_IS_ADD_POINT_GUIDE),PanelManager.setStatusFlag(!0,PanelManager.FLAG_IS_ADD_POINT_SURE),GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_SURE))},e.prototype.onSureChangePoint=function(){1==GameWorld.useGuide&&this.getPlayer().isNovice&&(PanelManager.isStatusFlag(PanelManager.FLAG_IS_ADD_POINT_GUIDE)&&GameWorld.setGuide(GameWorld.GUIDE_ADD_POINT_END));var t=this.getNeedMoneyArray(null);return Model.checkEnoughMoney(t[0],t[1],t[2],this.gotoChange,this),!0},e.prototype.gotoChange=function(){if(this.isChangeAttValue()){PanelManager.openWaitForServer();var t=MsgHandler.createAttrAddMessage(this.getChangeAttVector());nato.Network.sendCmd(t,this.changePointCallbackFunc,this)}},e.prototype.changePointCallbackFunc=function(t){var e=t.getByte();if(PanelManager.closeWaitForServer(),this.currentState==this.NEW_PLAYER&&(this.currentState=this.NORMAL,PanelManager.getPanel(RoleScene).validateNow()),0==e){var n=this.getPlayer();if(null!=n){if(n.addWatcher(),n.cp=t.getShort(),n.hp=t.getInt(),n.mp=t.getInt(),n.str=t.getShort(),n.con=t.getShort(),n.agi=t.getShort(),n.ilt=t.getShort(),n.wis=t.getShort(),n.money1=t.getInt(),n.money2=t.getInt(),n.money3=t.getInt(),this.isClosePanel)return void PanelManager.closeScene();if(n.unwatch(),this.canSetBaseAt=!0,this.setBaseAtt(),this.update(),PanelManager.isPanelShow(RoleScene))PanelManager.getPanel(RoleScene).updateRedPoint()}}else AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString())},e.prototype.restoreAtt=function(){var t=this.getPlayer();this.basePlayer&&(t.str=this.basePlayer.str,t.con=this.basePlayer.con,t.agi=this.basePlayer.agi,t.ilt=this.basePlayer.ilt,t.wis=this.basePlayer.wis,t.cp=this._baseCP,t.hp=this._baseHP,t.mp=this._baseMP)},e.prototype.onCancelChangePoint=function(){if(this.restoreAtt(),this.isClosePanel)PanelManager.closeScene();else{for(var t=0;t<this._baseAtt.length;t++)this._buffAtt[t]=this._baseAtt[t];this.sureBtnStatus(),this.havePoint=this._baseCP,this.update()}},e.prototype.setBaseAtt=function(){var t=this.getPlayer();if(this.canSetBaseAt){this.canSetBaseAt=!1,this._baseCP=t.cp,this._baseHP=t.hp,this._baseMP=t.mp,this.basePlayer&&(this.basePlayer.str=t.str,this.basePlayer.con=t.con,this.basePlayer.agi=t.agi,this.basePlayer.ilt=t.ilt,this.basePlayer.wis=t.wis),this._baseAtt[0]=t.str,this._baseAtt[1]=t.con,this._baseAtt[2]=t.agi,this._baseAtt[3]=t.ilt,this._baseAtt[4]=t.wis;for(var e=0;e<this._baseAtt.length;e++)this._buffAtt[e]=this._baseAtt[e];this.sureBtnStatus(),this.havePoint=this._baseCP}},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),n==this.barbg_0&&(this.bar_width=this.barbg_0.width)},e.prototype.update=function(){if(this.init){for(var t=this.getPlayer(),e=0;e<this._addPointPropIDList.length;e++){var n=this._addPointPropIDList[e],i=this["addPointItem_"+e];i&&i.setAttributeID(n,this._baseAtt[e],this._buffAtt[e],(this.basePlayer?this.basePlayer:t).get(n))}this.label_name.text=t.getName(),this.label_level.text=t.getLevel()+Define.getJobString(t.getJob()),this.label_legend.text=Tool.manageString(GameText.getText(GameText.TI_LEVEL),t.getLevel2()+""),this.label_camp.text=Define.getRaceString(t.getRace()),this.label_id.text=t.getClientUid(!1),this.label_country.text=t.getCountryName(),this.label_officialRank.text=t.getCountryRankStr(),this.updateUI()}},e.prototype.updateUI=function(){var t=this.getPlayer();this.bartxt_0.text=t.get(ModelConst.HP)+"/"+t.get(ModelConst.HPMAX),this.bartxt_1.text=t.get(ModelConst.MP)+"/"+t.get(ModelConst.MPMAX),this.bartxt_2.text=t.get(ModelConst.EXP)+"/"+t.get(ModelConst.EXPMAX),this.barbg_0.width=this.bar_width*t.get(ModelConst.HP)/t.get(ModelConst.HPMAX),this.barbg_1.width=this.bar_width*t.get(ModelConst.MP)/t.get(ModelConst.MPMAX),this.barbg_2.width=this.bar_width*t.get(ModelConst.EXP)/t.get(ModelConst.EXPMAX),this.label_power.text=t.getPower()+""},e.prototype.getChangeAttDesc=function(t){return t||(t=new StringBuffer),null!=this.basePlayer&&(t.append(GameText.STR_CHANGE_ATT_DESC_INFO),this.propIsChange(t,ModelConst.HPMAX,GameText.STR_CHANGE_ATT_DESC_HPMAX),this.propIsChange(t,ModelConst.MPMAX,GameText.STR_CHANGE_ATT_DESC_MPMAX),this.propIsChange(t,ModelConst.SPEED,GameText.STR_SPEED),this.propIsChange(t,ModelConst.ATK_STR,GameText.STR_CHANGE_ATT_DESC_ATK_STR),this.propIsChange(t,ModelConst.ATK_AGI,GameText.STR_CHANGE_ATT_DESC_ATK_AGI),this.propIsChange(t,ModelConst.ATK_MAGIC,GameText.STR_CHANGE_ATT_DESC_ATK_MAGIC),this.propIsChange(t,ModelConst.DEF_STR,GameText.STR_CHANGE_ATT_DESC_DEF_STR),this.propIsChange(t,ModelConst.DEF_AGI,GameText.STR_CHANGE_ATT_DESC_DEF_AGI),this.propIsChange(t,ModelConst.DEF_MAGIC,GameText.STR_CHANGE_ATT_DESC_DEF_MAGIC),this.propIsChange(t,ModelConst.DODGE,GameText.STR_CHANGE_ATT_DESC_DODGE),this.propIsChange(t,ModelConst.WIL,GameText.STR_CHANGE_ATT_DESC_WIL),this.propIsChange(t,ModelConst.TOUGH,GameText.STR_CHANGE_ATT_TOUGH),this.propIsChange(t,ModelConst.INSIGHT,GameText.STR_CHANGE_INSIGHT)),t.toTextFlow()},e.prototype.propIsChange=function(t,e,n){var i=this.basePlayer.get(e),o=this.getPlayer().get(e);i!=o&&t.append(n+"："+Tool.compareColorText1(i,o)+"\n")},e.prototype.getChangeAttVector=function(){for(var t=[],e=0;e<this._baseAtt.length;e++)if(this._baseAtt[e]!=this._buffAtt[e]){var n=[];n[0]=ModelConst.STR+e,n[1]=this._buffAtt[e]-this._baseAtt[e],t.push(n)}return t},e.prototype.isChangeAttValue=function(){if(null==this._buffAtt||null==this._baseAtt)return!1;for(var t=0;t<this._buffAtt.length;t++)if(this._buffAtt[t]!=this._baseAtt[t])return!0;return!1},e.prototype.getNeedMoneyArray=function(t){for(var n=this.getChangeAttVector(),i=0,o=0;o<n.length;o++){var a=n[o];null!=a&&a[1]<0&&(i+=-a[1])}return i>0&&t&&t.append(Tool.manageStringList(GameText.STR_NEED_MONEY_ARRAY,[GameText.getMoneyText(e.DEL_ARRTIBUTE[0])+e.DEL_ARRTIBUTE[1]*i,e.DEL_ARRTIBUTE[2]+""])+"\n"),GameWorld.getMoneyArrayValue([e.DEL_ARRTIBUTE[0],e.DEL_ARRTIBUTE[1]*i],e.DEL_ARRTIBUTE[2])},e.prototype.onBtnAddAuto=function(){egret.Tween.get(this.group_add_auto).to({scaleX:0,scaleY:0},200).call(this.closeGroupADDAuto,this),this.btn_add_auto.enabled=!1},e.prototype.closeGroupADDAuto=function(){xevent.addEventListener(WorldEvent.AUTO_ADD_POINT_FINISH,this.autoAddPointFinish,this),Tool.removeObjSafe(this.group_add_auto);for(var t=0,e=this.autoAddPointItemArr.length;e>t;t++)this.autoAddPointItemArr[t].beginToAddPoint();Main.instance.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageClick,this,!0,1e3)},e.prototype.autoAddPointFinish=function(t){if(this.addPointFinishCount++,this.addPointFinishCount==this.autoAddPointItemArr.length){setTimeout((function(t){xevent.removeEventListener(WorldEvent.AUTO_ADD_POINT_FINISH,t.autoAddPointFinish,t),t.addPointFinishCount=0;for(var e=0;e<t._addPointPropIDList.length;e++){var n=t["addPointItem_"+e];n.addBtnEvent(),n.isAutoAddPoint=!1}t.onSureBtnTouch(!1),Main.instance.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onStageClick,t,!0)}),500,this)}},e.prototype.onStageClick=function(t){t.stopImmediatePropagation()},e.prototype.onBuffTouch=function(){var t=GameWorld.doViewMyPlayerBuffInfo(this.getPlayer());return null!=xself&&null!=xself.playerTurnMonster?void PlayerTurnMonster.doSeeTurnMonsterInfo(t):void AlertPanel.alertCommon(t)},e.prototype.getPlayer=function(){return PanelManager.getPanel(RoleScene).getPlayer()},e.DEL_ARRTIBUTE=[ModelConst.MONEY2,2,100],e}(ComponentBase);__reflect(RoleBasePanel.prototype,"RoleBasePanel");var RolePhotoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onClose=function(){},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(RolePhotoPanel.prototype,"RolePhotoPanel");var RolePowerItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.btnTask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTask,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(t){e.btnTask.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onTask,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.txtTask.text=e.taskDesc;for(var n=0;5>n;n++)n>=e.stars?DisplayUtil.applyGray(this["star"+n]):DisplayUtil.clearFilter(this["star"+n])},e.prototype.onTask=function(t){xevent.dispatchEventWith(RolePowerPanel.DoTask,!1,this.data)},e}(eui.ItemRenderer);__reflect(RolePowerItem.prototype,"RolePowerItem");var RolePowerPanel=function(t){function e(){var e=t.call(this)||this;return e._selectTab=-1,e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n);for(var i=[],o=0;o<e.PowerLevel.length;o++)i[o]={tabName:e.PowerLevel[o]};this.tabPower.itemRendererSkinName="TabButton3HDSkin",this.tabPower.dataProvider=new eui.ArrayCollection(i),this.update(),xevent.addEventListener(e.DoTask,this.onDoTask,this),this.tabPower.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTab,this)},e.prototype.onRemoveFromStage=function(n){t.prototype.onRemoveFromStage.call(this,n),xevent.removeEventListener(e.DoTask,this.onDoTask,this),this.tabPower.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTab,this)},e.prototype.onBtnGotoLearn=function(){TodayEvent.doSkill()},e.prototype.update=function(){this._selectTab=0,this.tabPower.selectedIndex=0,this.updatePanel(),this.calculatePower(),this.txtTotal.text=xself.getPower().toString()},e.prototype.updatePanel=function(){if(!(this._selectTab<0)){var t=e.PowerTask[this._selectTab];this.listTask.itemRenderer=RolePowerItem,this.listTask.dataProvider=new eui.ArrayCollection(t)}},e.prototype.onTab=function(t){t.itemIndex!=this._selectTab&&(this._selectTab=t.itemIndex,this.updatePanel())},e.prototype.onDoTask=function(t){var e=t.data,n=Tool.parseStringToArray(e.taskType,"-");switch(n[0]){case 0:var i=n[1],o=n[2];AutoFindPath.findPath(i,o);break;case 1:var a=n[1];AutoFindPath.findTask(a);break;case 2:this.openTaskPanel(n);break;default:AlertPanel.alertCommon("未知任务:"+e.taskDesc)}},e.prototype.openTaskPanel=function(t){switch(t[1]){case e.Task_FirstCharge:FirstCharge.isOpen?PanelManager.openFirstChargeScene():AlertPanel.alertCommon("首冲活动已完成");break;case e.Task_DailyCharge:PanelManager.mainMenu.dailyCharge_btn.visible?ActivityService.instance.openActivity("DailyChargeAct"):AlertPanel.alertCommon("今日充值活动已完成");break;case e.Task_QuickPower:PanelManager.mainMenu.quickPower_btn.visible?ActivityService.instance.openActivity("QuickPowerAct"):AlertPanel.alertCommon("快速升战活动已完成");break;case e.Task_EquipForge:PanelManager.openForgeScene();break;case e.Task_ManorScene:PanelManager.openManorScene();break;case e.Task_Property:PanelManager.openBag();break;case e.Task_Charge:PayInfo.getPayList(!0)}},e.prototype.calculatePower=function(){this.txtPersonPower.text=this.calculatePersonPower().toString(),this.txtEquipPower.text=this.calculateEquipPower().toString(),this.txtClothesPower.text=this.calculateClothesPower().toString(),this.txtPetPower.text=this.calculatePetPower().toString(),this.txtRidePower.text=this.calculateRidePower().toString(),this.txtSkillPower.text=this.calculateSkillPower().toString(),this.txtTitlePower.text=this.calculateTitlePower().toString()},e.prototype.calculatePersonPower=function(){for(var t=0,e=[1,3,5,7,8],n=[xself.str,xself.con,xself.agi,xself.ilt,xself.wis],i=0;i<e.length;i++){var o=n[i],a=PowerConfig.AttrSwitch[e[i]];for(var r in a){var s=parseInt(r),l=a[s],_=PowerConfig.PowerAttr.indexOf(s);if(-1!=_)t+=o*l*PowerConfig.PowerScale[_]}}var h=0,u=0;return h=xself.get(ModelConst.LEVEL)+xself.get(ModelConst.LEVEL2),u=Math.floor(65*xself.get(ModelConst.CON)/10)+3*xself.get(ModelConst.STR)+100+40*(h-1),t+=u+=u*xself.getPowerPercent(Define.POWER_HPMAX_PERCENT)*.09,h=xself.get(ModelConst.LEVEL)+xself.get(ModelConst.LEVEL2),u=Math.floor(75*xself.get(ModelConst.ILT)/10)+Math.floor(35*xself.get(ModelConst.WIS)/10)+50+10*(h-1),t+=u+=u*xself.getPowerPercent(Define.POWER_MPMAX_PERCENT)*.084,t+=xself.get(ModelConst.STR),t+=xself.get(ModelConst.CON),t+=xself.get(ModelConst.AGI),t+=xself.get(ModelConst.ILT),t+=xself.get(ModelConst.WIS),t+=xself.powerValue,t+=xself.getCountryBuffer(Define.POWER_STR_PERCENT),t+=xself.getCountryBuffer(Define.POWER_CON_PERCENT),t+=xself.getCountryBuffer(Define.POWER_AGI_PERCENT),t+=xself.getCountryBuffer(Define.POWER_ILT_PERCENT),t+=xself.getCountryBuffer(Define.POWER_WIS_PERCENT),Math.ceil(t)},e.prototype.calculateEquipPower=function(){for(var t=0,e=0;e<PowerConfig.PowerAttr.length;e++){var n=xself.getBagEquipPowerValue(PowerConfig.PowerAttr[e]),i=xself.getPowerPercent(PowerConfig.PowerPercent[e]);t+=(n+=Math.floor(n*i/100))*PowerConfig.PowerScale[e]}return t+=xself.get(ModelConst.ATK_MAX)*xself.get(ModelConst.ATK_TIME)*.5,Math.ceil(t)},e.prototype.calculateRidePower=function(){var t=0,e=xself.bag.store[PlayerBag.ARMOR_TRANSPORT_POS];if(null==e)return t;for(var n=0;n<PowerConfig.PowerAttr.length;n++){var i=e.getPowerValue(PowerConfig.PowerAttr[n]),o=xself.getPowerPercent(PowerConfig.PowerPercent[n]);t+=(i+=Math.floor(i*o/100))*PowerConfig.PowerScale[n]}return Math.ceil(t)},e.prototype.calculateClothesPower=function(){var t=0,e=xself.bag.store[PlayerBag.ARMOR_FASHION_POS];if(null==e)return t;for(var n=0;n<PowerConfig.PowerAttr.length;n++){var i=e.getPowerValue(PowerConfig.PowerAttr[n]),o=xself.getPowerPercent(PowerConfig.PowerPercent[n]);t+=(i+=Math.floor(i*o/100))*PowerConfig.PowerScale[n]}return Math.ceil(t)},e.prototype.calculatePetPower=function(){var t=xself.getPet();return t?t.getPower():0},e.prototype.calculateSkillPower=function(){for(var t=0,e=function(e){var i=0;null!=xself.skillList&&xself.skillList.forEach((function(t){i+=t.getPowerValue(PowerConfig.PowerAttr[e])}),n);var o=xself.getPowerPercent(PowerConfig.PowerPercent[e]);i+=Math.floor(i*o/100),t+=i*PowerConfig.PowerScale[e]},n=this,i=0;i<PowerConfig.PowerAttr.length;i++)e(i);return Math.ceil(t)},e.prototype.calculateTitlePower=function(){for(var t=0,e=0;e<PowerConfig.PowerAttr.length;e++)t+=xself.getExportPower(PowerConfig.PowerAttr[e])*PowerConfig.PowerScale[e];return Math.ceil(t)},e.Task_FirstCharge=1,e.Task_DailyCharge=2,e.Task_QuickPower=3,e.Task_EquipForge=4,e.Task_ManorScene=5,e.Task_Property=6,e.Task_Charge=7,e.DoTask="RolePower_DoTask",e.PowerLevel=["20-30级","31-40级","41-50级","51-60级","61-70级","71-80级","81-90级"],e.PowerTask={0:[{level:"20-30级",stars:5,taskType:"2-3",taskDesc:"购买“极速升战”的1元大礼包"},{level:"20-30级",stars:5,taskType:"2-1",taskDesc:"购买“6元首冲”获得死亡之翼"},{level:"20-30级",stars:5,taskType:"2-2",taskDesc:"每日1、6、12元充值，获得海量资源"},{level:"20-30级",stars:4,taskType:"0-5-2",taskDesc:"学习技能"}],1:[{level:"31-40级",stars:5,taskType:"2-3",taskDesc:"购买“极速升战”的18元大礼包"},{level:"31-40级",stars:5,taskType:"2-1",taskDesc:"购买“6元首冲”获得死亡之翼"},{level:"31-40级",stars:5,taskType:"0-262-2",taskDesc:"前往太阳神殿参与初级组英雄挑战赛收集勋章兑换坐骑"},{level:"31-40级",stars:4,taskType:"2-2",taskDesc:"每日1、6、12元充值，获得海量资源"},{level:"31-40级",stars:4,taskType:"2-4",taskDesc:"通过锻造系统对装备进行升星"},{level:"31-40级",stars:4,taskType:"2-4",taskDesc:"通过打造镶嵌宝石"},{level:"31-40级",stars:3,taskType:"0-263-15",taskDesc:"通过圣域参与夜雨森林副本"},{level:"31-40级",stars:3,taskType:"0-263-50",taskDesc:"通过圣域前往冒险地图挑战雷斯林"},{level:"31-40级",stars:2,taskType:"0-5-33",taskDesc:"前往新月古镇参与刺客副本"}],2:[{level:"41-50级",stars:5,taskType:"2-3",taskDesc:"购买“极速升战”的58元大礼包"},{level:"41-50级",stars:5,taskType:"2-1",taskDesc:"购买“6元首冲”获得死亡之翼"},{level:"41-50级",stars:4,taskType:"2-2",taskDesc:"每日1、6、12元充值，获得海量资源"},{level:"41-50级",stars:4,taskType:"0-824-22",taskDesc:"前往紫禁城参与植树节/血烟副本"},{level:"41-50级",stars:4,taskType:"2-6",taskDesc:"更换装备"},{level:"41-50级",stars:4,taskType:"2-4",taskDesc:"通过打造镶嵌宝石"},{level:"41-50级",stars:3,taskType:"2-5",taskDesc:"前往我的城市参与无双任务获取强力装备"},{level:"41-50级",stars:3,taskType:"0-263-50",taskDesc:"通过圣域前往冒险地图挑战雷斯林（变态难度）"},{level:"41-50级",stars:2,taskType:"2-5",taskDesc:"前往他人的国家系统升级技能"}],3:[{level:"51-60级",stars:5,taskType:"2-3",taskDesc:"购买“极速升战”的128元大礼包"},{level:"51-60级",stars:5,taskType:"2-1",taskDesc:"购买“6元首冲”获得死亡之翼"},{level:"51-60级",stars:4,taskType:"2-2",taskDesc:"每日1、6、12元充值，获得海量资源"},{level:"51-60级",stars:4,taskType:"0-262-0",taskDesc:"前往太阳神殿参与高难度英雄挑战赛收集勋章兑换坐骑"},{level:"51-60级",stars:4,taskType:"0-824-15",taskDesc:"通过紫禁城参与紫云山副本"},{level:"51-60级",stars:3,taskType:"0-824-22",taskDesc:"通过紫禁城挑战葬送佣兵团"},{level:"51-60级",stars:2,taskType:"0-271-0",taskDesc:"前往英灵殿参与死神的挑战"}],4:[{level:"61-70级",stars:5,taskType:"2-7",taskDesc:"50元大额充值礼包"},{level:"61-70级",stars:4,taskType:"0-5-33",taskDesc:"前往新月古镇参与刺客副本3层收集高级装备"},{level:"61-70级",stars:4,taskType:"0-271-110",taskDesc:"前往英灵殿参与迷宫"},{level:"61-70级",stars:3,taskType:"0-824-22",taskDesc:"通过紫禁城前往月牙山巅讨伐妖魔"}],5:[{level:"71-80级",stars:5,taskType:"2-7",taskDesc:"50元大额充值礼包"},{level:"71-80级",stars:4,taskType:"0-960-14",taskDesc:"前往奇琴依察参与巨石副本"}],6:[{level:"81-90级",stars:5,taskType:"2-7",taskDesc:"50元大额充值礼包"},{level:"81-90级",stars:4,taskType:"0-960-20",taskDesc:"前往奇琴依察参与机械城副本"}]},e}(ComponentBase);__reflect(RolePowerPanel.prototype,"RolePowerPanel");var PowerConfig=function(){function t(){}return t.PowerIds=[ModelConst.SPEED,ModelConst.ATK_STR,ModelConst.ATK_AGI,ModelConst.ATK_MAGIC,ModelConst.DEF_STR,ModelConst.DEF_AGI,ModelConst.DEF_MAGIC,ModelConst.HPMAX,ModelConst.MPMAX,ModelConst.DODGE,ModelConst.HIT_RATE,ModelConst.HIT_MAGIC,ModelConst.CRITICAL,ModelConst.WIL,ModelConst.TOUGH,ModelConst.BLOCK,ModelConst.BRK_ARMOR,ModelConst.INSIGHT,ModelConst.DEF_FIELD,ModelConst.BACK,ModelConst.MAGIC_BACK,ModelConst.LIFE_ABSORPTION,ModelConst.MANA_ABSORPTION,ModelConst.MAGIC_PENETRATION,ModelConst.FORCE_HIT,ModelConst.KEEPOUT_ATK_TIME,ModelConst.IGNORE_WIL,ModelConst.IGNORE_TOUCH,ModelConst.IGNORE_BLOCK,ModelConst.IGNORE_BACK,ModelConst.IGNORE_INSIGHT,ModelConst.IGNORE_MAGIC_BACK,ModelConst.STR,ModelConst.CON,ModelConst.AGI,ModelConst.ILT,ModelConst.WIS],t.PowerAttr=[Define.POWER_SPEED,Define.POWER_ATK_STR,Define.POWER_ATK_AGI,Define.POWER_ATK_MAGIC,Define.POWER_DEF_STR,Define.POWER_DEF_AGI,Define.POWER_DEF_MAGIC,Define.POWER_HPMAX,Define.POWER_MPMAX,Define.POWER_DODGE,Define.POWER_HITRATE,Define.POWER_ATK_MAGIC,Define.POWER_CRITICAL,Define.POWER_WIL,Define.POWER_TOUGH,Define.POWER_BLOCK,Define.POWER_PENETRATION,Define.POWER_INSIGHT,Define.POWER_DEF_FIELD,Define.POWER_BACK,Define.POWER_MAGIC_BACK,Define.POWER_LIFE_ABSORPTION,Define.POWER_MANA_ABSORPTION,Define.POWER_MAGIC_PENETRATION,Define.POWER_HIT_FORCE,Define.POWER_KEEPOUT_ATK_TIME,Define.POWER_IGNORE_WIL,Define.POWER_IGNORE_TOUCH,Define.POWER_IGNORE_BLOCK,Define.POWER_IGNORE_BACK,Define.POWER_IGNORE_INSIGHT,Define.POWER_IGNORE_MAGIC_BACK,Define.POWER_STR,Define.POWER_CON,Define.POWER_AGI,Define.POWER_ILT,Define.POWER_WIS],t.PowerPercent=[Define.POWER_SPEED_PERCENT,Define.POWER_ATK_STR_PERCENT,Define.POWER_ATK_AGI_PERCENT,Define.POWER_ATK_MAGIC_PERCENT,Define.POWER_DEF_STR_PERCENT,Define.POWER_DEF_AGI_PERCENT,Define.POWER_DEF_MAGIC_PERCENT,Define.POWER_HPMAX_PERCENT,Define.POWER_MPMAX_PERCENT,Define.POWER_DODGE_PERCENT,Define.POWER_HITRATE_PERCENT,Define.POWER_MAGIC_HITRATE_PERCENT,Define.POWER_CRITICAL_PERCENT,Define.POWER_WIL_PERCENT,Define.POWER_TOUGH_PERCENT,Define.POWER_BLOCK_PERCENT,Define.POWER_PENETRATION_PERCENT,Define.POWER_INSIGHT_PERCENT,Define.POWER_DEF_FIELD_PERCENT,Define.POWER_BACK_PERCENT,Define.POWER_MAGIC_BACK_PERCENT,Define.POWER_LIFE_ABSORPTION_PERCENT,Define.POWER_MANA_ABSORPTION_PERCENT,Define.POWER_MAGIC_PENETRATION_PERCENT,Define.POWER_HIT_FORCE_PERCENT,0,0,0,0,0,0,0,Define.POWER_STR_PERCENT,Define.POWER_CON_PERCENT,Define.POWER_AGI_PERCENT,Define.POWER_ILT_PERCENT,Define.POWER_WIS_PERCENT],t.PowerScale=[.96,.8,.5,.5,.8,.8,.6,.09,.084,5,.9,4.5,5,13.3,15,3.75,1.3,15,1.3,7.5,7.5,2,2,1.3,.5,200,8,12,7.5,12,6,12,1,1,1,1,1],t.AttrSwitch={1:{11:3,58:5,59:5,65:.1},3:{11:7,61:8,62:8,65:.2},5:{53:3,58:3,59:5,55:.4},7:{13:7,60:3,63:2,64:.1},9:{13:3,53:1.5,60:2,63:4,64:.1,55:.4}},t}();__reflect(PowerConfig.prototype,"PowerConfig");var NPC=function(t){function e(){var e=t.call(this,1)||this;return e.rangeX=0,e.rangeY=0,e.nextMoveTime=0,e.sourceGx=0,e.sourceGy=0,e.comeOutCounter=0,e.missionIDList=null,e.missions=null,e.missionData=null,e.missionGroupID=-1,e.missionIcon=null,e._isShowAllTeacher=!1,e}return __extends(e,t),e.prototype.getSign=function(){return this.icon2},e.prototype.setSign=function(t){this.icon2=0>t||t>4?0:t,this.updateMissionIcon()},e.prototype.isUseMissionData=function(){return 0!=(8&this.status)},e.prototype.isMissionLoadEveryTime=function(){return 0!=(16&this.status)},e.prototype.isJumpIcon=function(){return 0!=(32&this.status)},e.prototype.isEnable=function(){return 0!=(2&this.status)},e.prototype.setEnable=function(t){t?this.status|=2:this.status&=-3},e.prototype.setVisible=function(t){t?this.status|=1:this.status&=-2,this.sprite&&this.sprite.setSpriteVisible(t),this.nameLabel&&this.nameLabel.parent&&(this.nameLabel.visible=t),this.missionIcon&&this.missionIcon.parent&&(this.missionIcon.visible=t)},e.prototype.isVisible=function(){return 0!=(1&this.status)},e.prototype.isInitVisible=function(){return 0!=(1024&this.status)},e.prototype.setInitVisible=function(t){t?this.status|=1024:this.status&=-1025},e.prototype.isInitEnable=function(){return 0!=(2048&this.status)},e.prototype.setInitEnable=function(t){t?this.status|=2048:this.status&=-2049},Object.defineProperty(e.prototype,"isMonster",{get:function(){return 1==this.npcType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAchieveNPC",{get:function(){return 5==this.npcType&&null!=this.shopID&&-1!=this.shopID.indexOf(MenuEventHandler.EVENT_ALL_MENU_ACHIEVE)},enumerable:!0,configurable:!0}),e.prototype.isPlayerSkillTeacher=function(){if(this.teacherId&&this.teacherId.length>0){var t=this.teacherId[0];if(Define.getTypeBySkillShopID(t)==Define.SKILL_TYPE_PLAYER)return!0}return!1},e.prototype.isRepairNPC=function(){return null!=this.shopID&&-1!=this.shopID.indexOf(Define.SHOP_REPAIR_ID)},e.prototype.resetVisibleData=function(){this.setTabStatus(!1,Model.NPC_MISSION_DISPLAY),this.setTabStatus(!1,Model.NPC_MISSION_HIDE),this.setVisible(this.isInitVisible()),this.setEnable(this.isInitEnable()),this.comeOutCounter=-1},e.clearHideNPCs=function(){e.hideCheckNPC1=null,e.hideCheckNPC2=null,e.hideCheckNPC3=null},e.prototype.isHidePlayer=function(){return 0!=(64&this.status)},e.prototype.checkSetHidePlayer=function(){0!=this.isVisible()&&0!=this.isHidePlayer()&&(null==e.hideCheckNPC1?e.hideCheckNPC1=this:null==e.hideCheckNPC2?e.hideCheckNPC2=this:null==e.hideCheckNPC3&&(e.hideCheckNPC3=this))},e.prototype.initWelcomeFrame=function(){1!=Tool.isNullText(this.welcome)&&1!=this.npcType&&(this.welcomeFrame=new MessageFrame(this.welcome))},e.prototype.updateNextMoveTime=function(){var t=Tool.rand(e.MOVE_MIN_INTERVAL,e.MOVE_MAX_INTERVAL);this.nextMoveTime=Date.now()+1e3*t},e.prototype.isNPCInScreen=function(){var t=xworld.gameMap.playerLayer.localToGlobal(this.x,this.y),n=t.x-MapSetup.GRID_HALF_HALF_WIDTH,i=t.y+MapSetup.GRID_HEIGHT-e.NPC_HEIGHT,o=Main.instance.stage.stageWidth,a=Main.instance.stage.stageHeight;return Tool.isColliding(n,i,MapSetup.NPC_WIDTH,MapSetup.NPC_HEIGHT,0,0,o,a)},e.prototype.createMoveControl=function(){if(0!=this.isVisible()&&0!=this.isEnable()&&8!=this.npcType&&!(this.rangeX<=0||this.rangeY<=0)){var t=xworld.gameMap;this.updateNextMoveTime();for(var n=Tool.rand(e.DIR_START,e.DIR_END),i=this.getGx(),o=this.getGy(),a=e.DIR_START;a<e.DIR_END;a++)if(8!=(n=(n+1)%e.DIR_NUM)){var r=Tool.getFaceXY(i,o,n);if(!(r.x<0||r.x>=t.setup.mapColumns)&&!(r.y<0||r.y>=t.setup.mapRows)&&t.isCanPass(r.x,r.y)&&!(Math.abs(r.x-this.sourceGx)>this.rangeX||Math.abs(r.y-this.sourceGy)>this.rangeY)){var s=(r.x,MapSetup.GRID_WIDTH,r.y,MapSetup.GRID_HEIGHT,Control.createMove(this.id,n,2,this.getType()));this.controlList.push(s);break}}}},e.prototype.hide=function(t){this.isVisible()&&(this.setVisible(!1),this.setEnable(!1),this.comeOutCounter=t?30*this.comeOutTime:450)},e.prototype.rebornImmediately=function(){this.comeOutCounter=0,this.setVisible(!0),this.setEnable(!0)},e.prototype.logic=function(e){if(this.sprite&&this.sprite.parent&&this.sprite.isSpriteVisible){if(this.comeOutCounter>0)return this.comeOutCounter--,void(this.comeOutCounter<=0&&(this.setVisible(!0),this.setEnable(!0)));var n=e%8==0,i=!1;if(n){i=this.isNPCInScreen();var o=xworld.gameMap.playerLayer;if(!i)return void(o.contains(this)&&o.removeChild(this));o.contains(this)||o.addChild(this)}if(t.prototype.logic.call(this,e),0!=this.isVisible()&&0!=this.isEnable()&&this.parent){if(n)Date.now()>this.nextMoveTime&&0==this.controlList.length&&i&&this.createMoveControl();var a=xself;return 1==this.npcType?void this.checkBattle(e):void(null!=this.welcomeFrame&&a&&this.checkWelcomeFrame(e))}}},e.prototype.checkBattle=function(t){if(t%12==0){var e,n=xself,i=n.isMember(),o=n.isShopMode();if(e=this.battleID[0],!i&&!(o||0>=e))if(!(Math.abs(n.x-this.x)+Math.abs(n.y-this.y)>MapSetup.GRID_WIDTH||PanelManager.isOpeningFullScene||UILayer.instance.popupLayer.numChildren>0)){var a=xworld.currentTargetMonster,r=n.isAutoMove()&&null==a,s=n.isAutoMove()&&null!=a&&this!=a;r||s||xworld.toBattle(e,!0)&&(1==GameWorld.useGuide&&(this.isGuide()?(this.clearGuide(),GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_BATTLE_DOING)):"小偷"==this.getName()&&GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_BATTLE_DOING)),this.hide(!0))}}},e.prototype.checkWelcomeFrame=function(t){if(this.welcomeFrame.isShow&&this.welcomeFrame.logic(t),t%15==0){var e=xself;Math.abs(e.x-this.x)+Math.abs(e.y-this.y)<=NPCConst.SHOW_WELCOME_RANGE?0==this.welcomeFrame.isActivity&&(this.welcomeFrame.isActivity=!0,this.welcomeFrame.show(),this.welcomeFrame.x=-this.welcomeFrame.width/2,this.welcomeFrame.y=-this.sprite.getHeight()-this.nameLabel.height-this.welcomeFrame.height,this.addChild(this.welcomeFrame)):1==this.welcomeFrame.isActivity&&(this.welcomeFrame.isActivity=!1,this.welcomeFrame.clear())}},e.prototype.isGuide=function(){return 0!=(128&this.status)},e.prototype.clearGuide=function(){this.status&=-129},e.prototype.updateNameLabelPos=function(){return null!=this.nameLabel?0==this.sprite.getHeight()?void this.sprite.setFirstFrameLoaded(this.doUpdateNameLabelPos,this):void this.doUpdateNameLabelPos():void 0},e.prototype.doUpdateNameLabelPos=function(){this.nameLabel.x=MapSetup.GRID_HALF_WIDTH+Math.floor(this.x-this.nameLabel.textWidth/2),this.nameLabel.y=MapSetup.GRID_HEIGHT+Math.floor(this.y-this.sprite.getHeight()-this.nameLabel.textHeight)},e.prototype.updateMissionIconPos=function(){return null!=this.missionIcon?0==this.sprite.getHeight()?void this.sprite.setFirstFrameLoaded(this.doUpdateMissionIconPos,this):void this.doUpdateMissionIconPos():void 0},e.prototype.doUpdateMissionIconPos=function(){this.missionIcon.x=MapSetup.GRID_HALF_WIDTH+Math.floor(this.x-(e.MissionIcon_width-this.missionIcon.width)/2),this.missionIcon.y=MapSetup.GRID_HALF_WIDTH+Math.floor(this.y-this.sprite.getHeight()-e.MissionIcon_height)},e.prototype.initSprite=function(t){(void 0===t&&(t=!0),this.icon1<=0)||(this.sprite=SpriteHelper.createSprite(this.icon1),nato.findSpriteSetup(this.sprite.nameID),this.addChild(this.sprite),this.setAnimationByDir(!1),t&&this.initName(),this.updateMissionIcon(),xworld.gameMap.playerLayer.addChild(this),this.sprite&&this.sprite.setSpriteVisible(this.isVisible()),this.nameLabel&&(this.nameLabel.visible=this.isVisible()))},e.prototype.initName=function(){this.nameLabel||(this.nameLabel=TextFieldUtils.getNameLabel(this.name,this.npcType)),this.updateNameLabelPos();var t=xworld.gameMap.playerLayer;t&&0==this.isMonster&&t.addNpcNameLabel(this.nameLabel)},e.prototype.init=function(){this.talkDetail=Tool.convertDesc(this.talkDetail),this.welcome=Tool.convertDesc(this.welcome),this.setInitVisible(this.isVisible()),this.setInitEnable(this.isEnable()),this.initWelcomeFrame(),this.checkRelaMissionVisible()},e.fromNPCBytes=function(t){var n=new e;n.setSign(t.readByte()),n.id=t.readByte(),n.missionGroupID=t.readByte(),n.npcType=t.readByte(),n.icon1=t.readShort(),n.businessIcon=t.readShort(),n.name=t.readUTF(),n.playerName=n.name,n.welcome=t.readUTF(),n.talkDetail=t.readUTF(),n.status=t.readUnsignedByte(),n.setDir(t.readByte());var i=t.readByte(),o=t.readByte();switch(n.setPosition(i,o),n.rangeX=t.readByte(),n.rangeY=t.readByte(),n.isUseMissionData()&&(n.missionData=[],n.missionData[0]=t.readShort(),n.missionData[1]=t.readByte(),n.missionData[2]=t.readShort(),n.missionData[3]=t.readByte()),n.npcType){case 1:n.battleID=[],n.battleID[0]=t.readShort(),n.comeOutTime=t.readUnsignedByte();break;case 3:case 8:n.topic=t.readUTF(),n.jumpMapID=[],n.jumpMapID[0]=t.readShort(),n.jumpMapGx=[],n.jumpMapGx[0]=t.readByte(),n.jumpMapGy=[],n.jumpMapGy[0]=t.readByte();break;case 2:n.topic=t.readUTF(),n.shopID=[],n.shopID[0]=t.readShort();break;case 7:n.topic=t.readUTF(),n.teacherId=[],n.teacherId[0]=t.readShort();break;case 9:n.topic=t.readUTF();break;case 0:e.readMissionNPCData(n,t);break;case 5:e.readPowerNPCData(n,t)}return n.sourceGx=i,n.sourceGy=o,n},e.readMissionNPCData=function(t,e){},e.readPowerNPCData=function(t,n){if(null!=t){e.readMissionNPCData(t,n);var i=n.readByte();if(i>0){t.menuJumpMap=new Array(i),t.jumpMapID=new Array(i),t.jumpMapGx=new Array(i),t.jumpMapGy=new Array(i),t.jumpMapReqMissionID=new Array(i),t.jumpMapReqMissionState=new Array(i);for(var o=0;i>o;o++)t.menuJumpMap[o]=n.readUTF(),t.jumpMapID[o]=n.readShort(),t.jumpMapGx[o]=n.readByte(),t.jumpMapGy[o]=n.readByte(),t.jumpMapReqMissionID[o]=n.readShort(),t.jumpMapReqMissionState[o]=n.readByte()}if((i=n.readByte())>0){t.menuBattle=new Array(i),t.battleID=new Array(i),t.battleReqMissionID=new Array(i),t.battleReqMissionState=new Array(i);for(o=0;i>o;o++)t.menuBattle[o]=n.readUTF(),t.battleID[o]=n.readShort(),t.battleReqMissionID[o]=n.readShort(),t.battleReqMissionState[o]=n.readByte()}if((i=n.readByte())>0){t.menuShop=new Array(i),t.shopID=new Array(i),t.shopReqMissionID=new Array(i),t.shopReqMissionState=new Array(i);for(o=0;i>o;o++)t.menuShop[o]=n.readUTF(),t.shopID[o]=n.readShort(),t.shopReqMissionID[o]=n.readShort(),t.shopReqMissionState[o]=n.readByte()}if((i=n.readByte())>0){t.menuTeacher=new Array(i),t.teacherId=new Array(i),t.teacherReqMissionID=new Array(i),t.teacherReqMissionState=new Array(i);for(o=0;i>o;o++)t.menuTeacher[o]=n.readUTF(),t.teacherId[o]=n.readShort(),t.teacherReqMissionID[o]=n.readShort(),t.teacherReqMissionState[o]=n.readByte();t.checkisShowAllTeacher()}}},e.initNPCListData=function(t){if(null!=t){GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_MAP);for(var e,n={},i=t.length,o=0;i>o;o++){var a=t[o];if(null==a)return;e=!0,a.isMonster&&(null!=n[a.getName()]&&(e=!1),n[a.getName()]=a),a.initSprite(e),1!=a.npcType&&a.isGuide()&&3==a.getSign()&&1==GameWorld.useGuide&&(GameWorld.setGuide(GameWorld.GUIDE_START_NPC),GameWorld.setLoginSetting(!0,GameWorld.IS_GUIDE_MAP))}}},e.loadNPC=function(t){for(var n=t.readUnsignedByte(),i=new Array(n),o=0;n>o;o++){var a=e.fromNPCBytes(t);a.init(),i[o]=a}return i},e.parseNPCData=function(t){return null==t||t.length<=0?null:e.loadNPC(t)},e.prototype.isInJumpMapArea=function(t,e){return t>=this.sourceGx-this.rangeX&&t<=this.sourceGx+this.rangeX&&e>=this.sourceGy-this.rangeY&&e<=this.sourceGy+this.rangeY},e.prototype.getMissonById=function(t){if(null==this.missions)return null;for(var e=null,n=0;n<this.missions.length;n++)if(null!=(e=this.missions[n])&&e.getId()==t)return e;return null},e.prototype.checkRelaMissionVisible=function(){if(null!=this.missionData){if(0==this.isTabStatus(Model.NPC_MISSION_DISPLAY)&&this.missionData[0]>0)1==Mission.checkPlayerMissionStatus(xself,this.missionData[0],this.missionData[1])&&(this.setTabStatus(!0,Model.NPC_MISSION_DISPLAY),this.setVisible(!0),this.setEnable(!0));if(0==this.isTabStatus(Model.NPC_MISSION_HIDE)&&this.missionData[2]>0)1==Mission.checkPlayerMissionStatus(xself,this.missionData[2],this.missionData[3])&&(this.setTabStatus(!0,Model.NPC_MISSION_HIDE),this.setVisible(!1),this.setEnable(!1),this.comeOutCounter=-1);this.updateMissionIcon()}},e.prototype.isNeedLoadFromServer=function(t){if(null!=this.sprite)return!1;if(null!=this.missionData&&0==this.isVisible()){if(1!=this.npcType)return!1;if(1!=this.isTabStatus(Model.NPC_MISSION_DISPLAY)||0!=this.isTabStatus(Model.NPC_MISSION_HIDE))return!1}return this.setTabStatus(!0,Model.SPRITE_LOADING_NPC),!0},e.prototype.doNPC=function(){if(0==this.isEnable())return!1;if(0==this.isVisible())return!1;var t=xself;return null!=t&&null!=xworld.gameMap&&(t.setAnimationByDir(!1),!e.doGetCountryBuildingNPC(this)&&(0!=this.npcType&&5!=this.npcType||!this.isMissionLoadEveryTime()&&0!=this.isTabStatus(Model.NPC_MISSION_LOAD)?1==Mission.isHaveSubmitMission(t,this)?(this.doMissionNpc(t),!0):1==this.doSpecialNpc(t)||(!(null!=this.talkDetail||null!=this.missions&&this.missions.length>0)||(this.doMissionNpc(t),!0)):(this.doGetMissionData(),!1)))},e.prototype.doGetMissionData=function(t,e){this.getMissionDataCallback=t,this.getMissionDataObject=e;var n=MsgHandler.createGetMissionDataMsg(this.id);nato.Network.sendCmd(n,this.doGetMissionDataCallback,this),PanelManager.openWaitForServer(),this.setTabStatus(!0,Model.NPC_MISSION_LOAD)},e.prototype.doGetMissionDataCallback=function(t){PanelManager.closeWaitForServer();var e=t.getByte();if(!(0>e)){for(var n=new Array,i=0;e>i;i++){var o=Mission.fromBytes(t.getBytes());n.push(o)}return this.missions=n,MsgHandler.processDataMonsterGroupMsg(t),MsgHandler.processDataMonsterMsg(t)&&MsgHandler.processDataMonsterAIMsg(t),this.getMissionDataCallback&&this.getMissionDataObject?(this.getMissionDataCallback.call(this.getMissionDataObject,this),this.getMissionDataCallback=null,void(this.getMissionDataObject=null)):void this.doNPC()}AlertPanel.alertNotify(GameText.getText(GameText.TI_ERROR),t.getString())},e.prototype.doMissionNpc=function(t){if(null!=t){var n=this;if(1!=n.npcType&&4!=n.npcType){var i=xworld.getCurMapID(),o=[],a=[],r=null,s=t.missionList;if(null!=s&&s.length>0)for(var l=0;l<s.length;l++)if(null!=(r=s[l])&&0!=r.isVisibleAndSubmit(n,i)){var _=new NPCActionData(r.name,1,r,NPCActionData.Type_mission);o.push(_),r.getMissionStatus(t)==MissionConst.CAN_SUBMIT&&a.push(r)}var h=n.missions;if(null!=h&&h.length>0)for(l=0;l<h.length;l++)if(null!=(r=h[l])&&null==t.getMissionById(r.getId())&&1!=Mission.isMissionFinish(t,r.getId())&&(r.getMissionStatus(t)!=MissionConst.NOT_CAN_ACCEPT||0!=r.isShowNotAcceptMission(t))){_=new NPCActionData(r.name,1,r);o.push(_),r.getMissionStatus(t)==MissionConst.CAN_SUBMIT&&a.push(r)}if(5==n.npcType&&n.addPowerNPCChoice(t,o),1==o.length){var u=o[0];if(null!=u)if(1==u.action)return void e.handlerMissionNPCAction(n,u)}else if(1==a.length&&0==n.npcType){r=a[0],_=new NPCActionData(r.name,1,r);return void e.handlerMissionNPCAction(n,_)}_=new NPCActionData(GameText.getText(GameText.TI_QUIT),7,null);o.push(_);var c=n.talkDetail;Tool.isNullText(c)&&(c="您好！"),PanelManager.openNPCDialogue(n.name,c,o,null,null,n)}}},e.prototype.addPowerNPCChoice=function(t,e){if(null!=e){if(null!=this.menuJumpMap&&this.menuJumpMap.length>0)for(var n=0;n<this.menuJumpMap.length;n++)if(0!=Mission.checkPlayerMissionStatus(t,this.jumpMapReqMissionID[n],this.jumpMapReqMissionState[n])){var i=new NPCActionData(this.menuJumpMap[n],2,{powerType:0,index:n});e.push(i)}if(null!=this.menuBattle&&this.menuBattle.length>0)for(n=0;n<this.menuBattle.length;n++)if(0!=Mission.checkPlayerMissionStatus(t,this.battleReqMissionID[n],this.battleReqMissionState[n])){i=new NPCActionData(this.menuBattle[n],2,{powerType:1,index:n});e.push(i)}if(null!=this.menuShop&&this.menuShop.length>0)for(n=0;n<this.menuShop.length;n++)if(0!=Mission.checkPlayerMissionStatus(t,this.shopReqMissionID[n],this.shopReqMissionState[n])&&this.shopID[n]!=MenuEventHandler.EVENT_ALL_MENU_MONSTER_LIST){i=new NPCActionData(this.menuShop[n],2,{powerType:2,index:n});e.push(i)}if(null!=this.menuTeacher&&this.menuTeacher.length>0)if(this._isShowAllTeacher){i=new NPCActionData("技能学习",2,{powerType:4,index:0});if(e.push(i),this.menuTeacher.length>3)for(n=3;n<this.menuTeacher.length;n++)if(0!=Mission.checkPlayerMissionStatus(t,this.teacherReqMissionID[n],this.teacherReqMissionState[n])){i=new NPCActionData(this.menuTeacher[n],2,{powerType:3,index:n});e.push(i)}}else{var o=Define.getJobString(xself.getJob());for(n=0;n<this.menuTeacher.length;n++)if(0!=Mission.checkPlayerMissionStatus(t,this.teacherReqMissionID[n],this.teacherReqMissionState[n])){var a=this.menuTeacher[n],r=this.teacherId[n];Define.getTypeBySkillShopID(r)==Define.SKILL_TYPE_PLAYER&&(a+=-1!=a.indexOf(o)?"(本职)":"(跨职)");i=new NPCActionData(a,2,{powerType:3,index:n});e.push(i)}}}},e.prototype.doSpecialNpc=function(t){var e=this,n=-1,i=[];if(3==e.npcType||8==e.npcType?n=3:7==e.npcType?n=5:2==e.npcType?n=4:9==e.npcType&&(n=6),0>n)return!1;7==e.id&&"雇佣兵"==e.playerName&&(e.topic="佣兵所");var o=new NPCActionData(e.topic,n,e);i.push(o),o=new NPCActionData(GameText.getText(GameText.TI_QUIT),7,null),i.push(o);var a=e.talkDetail;return Tool.isNullText(a)&&3!=n&&(a="您好！"),PanelManager.openNPCDialogue(e.name,a,i,null,null,e),!0},e.handlerMissionNPCAction=function(t,n){if(null!=t&&null!=n)switch(n.action){case 7:case 0:break;case 1:var i=n.data;e.handleChoiceMissionAction(i,t);break;case 2:var o=n.data.powerType,a=n.data.index;switch(o){case 0:xworld.doJumpMap(t.jumpMapID[a],t.jumpMapGx[a],t.jumpMapGy[a]);break;case 1:xworld.toBattle(t.battleID[a],!1);break;case 2:xworld.doBrowseShop(t.shopID[a],t);break;case 3:xworld.openShopSkill(t.teacherId[a]);break;case 4:t._isShowAllTeacher&&PanelManager.openSkillShopPanel_showAll(t._showAllTeacherID)}break;case 3:xworld.doJumpMap(t.jumpMapID[0],t.jumpMapGx[0],t.jumpMapGy[0]);break;case 4:xworld.doBrowseShop(t.shopID[0],t);break;case 5:xworld.openShopSkill(t.teacherId[0]);break;case 6:case 8:if(null==(r=xself)||r.isShopMode())return;PanelManager.openTradeScene();break;case 10:var r=xself;i=n.data;e.doMissionInfoView(r,i,t,NPCConst.SUB_MISSION_OFFLINE_INFO)}},e.handleChoiceMissionAction=function(t,n){var i=xself;if(null!=i&&null!=t&&null!=n)if(null!=i.getMissionById(t.getId()))t.isComplete()&&t.isVisibleAndSubmit(n,xworld.getCurMapID())?e.doMissionInfoView(i,t,n,NPCConst.SUB_MISSION_SUBMIT_NORMAL):e.doMissionInfoView(i,t,n,NPCConst.SUB_MISSION_DOING);else if(t.isCanAccept()){var o=NPCConst.SUB_MISSION_ACCEPT;1==t.isEscort()?o=NPCConst.SUB_MISSION_ESCORT_INFO:1==t.isDirectSubmit()&&(o=NPCConst.SUB_MISSION_DIRECT_STEP1),e.doMissionInfoView(i,t,n,o)}else{var a=Tool.manageString(GameText.STR_NPC_MISSION_NOT_READY,PowerString.makeColorString(t.name,16776960))+"\n"+t.dialogNotStartNotReady;AlertPanel.alertCommon(a)}},e.doMissionInfoView=function(t,e,n,i){var o,a="",r=[],s=null,l=null;switch(i){case NPCConst.SUB_MISSION_SUBMIT_NORMAL:a=e.getSubmitDetails(),o=new NPCActionData(GameText.getText(GameText.TI_SUBMIT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_SUBMIT,mission:e}),r.push(o),s=e.rewardItems,l=e.selectItems;break;case NPCConst.SUB_MISSION_DIRECT_STEP1:a=e.desc,0==Tool.isNullText(e.dialogStartFinish)?(o=new NPCActionData(GameText.STR_NPC_MISSION_ASK,8,{subType:NPCConst.EVENT_ALL_TASK_DIRECT_STEP2,mission:e}),r.push(o)):(o=new NPCActionData(GameText.STR_NPC_MISSION_SURE,8,{subType:NPCConst.EVENT_ALL_TASK_SUBMIT,mission:e}),r.push(o));break;case NPCConst.SUB_MISSION_DIRECT_STEP2:a=e.dialogStartFinish,o=new NPCActionData(GameText.STR_NPC_MISSION_SURE,8,{subType:NPCConst.EVENT_ALL_TASK_SUBMIT,mission:e}),r.push(o);break;case NPCConst.SUB_MISSION_ACCEPT:a=e.getDetails(!1),e.isRandomMission()&&(a=RandomMission.getRandomMissionDoingDesc(e),a+=e.getDetails(!1)),o=new NPCActionData(GameText.getText(GameText.TI_ACCEPT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_ACCEPT,mission:e}),r.push(o),s=e.rewardItems,l=e.selectItems;break;case NPCConst.SUB_MISSION_ESCORT_INFO:var _;a=e.getEscortDesc(),_=e.isEscortNeedCost()?GameText.STR_NPC_MISSION_ESCORT:"执行任务",o=new NPCActionData(_,8,{subType:NPCConst.EVENT_ALL_TASK_ACCEPT,mission:e}),r.push(o),s=e.rewardItems,l=e.selectItems;break;case NPCConst.SUB_MISSION_OFFLINE_INFO:a=e.getOffsetLineDesc(),o=new NPCActionData(GameText.getText(GameText.TI_ACCEPT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_OFF_ACTIVATE,mission:e}),r.push(o),s=e.rewardItems,l=e.selectItems;break;case NPCConst.SUB_MISSION_VIEW:if(a=e.getDetails(!0),e.isRandomMission()){a=RandomMission.getRandomMissionDoingDesc(e),a+=e.getDetails(!0),o=new NPCActionData(GameText.getText(GameText.TI_BACK),8,{subType:NPCConst.EVENT_ALL_BACK,mission:e}),r.push(o);var h=e.rmissionStatus,u="";u=GameText.getText(GameText.TI_MISSION_REFLASH),h==RandomMission.STATUS_START_2&&(u=GameText.getText(GameText.TI_MISSION_RESET),o=new NPCActionData(GameText.getText(GameText.TI_MISSION_SUBMIT),12,{subType:RandomMission.Action_sumbit,mission:e}),r.push(o)),o=new NPCActionData(GameText.getText(GameText.TI_DELECT_MISSION),12,{subType:RandomMission.Action_giveUp,mission:e}),r.push(o),o=new NPCActionData(u,12,{subType:RandomMission.Action_refresh,mission:e}),r.push(o)}else o=new NPCActionData(GameText.getText(GameText.TI_TASK_PATH),8,{subType:NPCConst.EVENT_ALL_TASK_PATH,mission:e}),r.push(o),o=new NPCActionData(GameText.getText(GameText.TI_DELECT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_DEL,mission:e}),r.push(o);break;case NPCConst.SUB_MISSION_DOING:a=e.getDoingDesc(!1),e.acceptBattleID>0&&(o=new NPCActionData(GameText.STR_NPC_MISSION_CONTINUE,8,{subType:NPCConst.EVENT_MISSION_FIGHT,mission:e}),r.push(o)),e.isCountryAssignTask()?(o=new NPCActionData(GameText.getText(GameText.TI_BACK),8,{subType:NPCConst.EVENT_ALL_BACK,mission:e}),r.push(o)):(o=new NPCActionData(GameText.getText(GameText.TI_TASK_PATH),8,{subType:NPCConst.EVENT_ALL_TASK_PATH,mission:e}),r.push(o)),o=new NPCActionData(GameText.getText(GameText.TI_DELECT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_DEL,mission:e}),r.push(o);break;case NPCConst.SUB_MISSION_ONE_ACCEPT:a=e.simpleDesc,1==Tool.isNullText(a)&&(a=Tool.manageString(GameText.STR_NPC_MISSION_ACCEPT,PowerString.makeColorString(e.name,ColorUtils.COLOR_YELLOW)));var c=e.getConditionDesc(e.submitCondition);0==Tool.isNullText(c)&&(a+="\n"+PowerString.makeColorString(GameText.STR_NPC_MISSION_DEST,16776960)+c),a+="\n"+GameText.STR_NPC_MISSION_AUTO_ASK,o=new NPCActionData(GameText.getText(GameText.TI_TASK_PATH),8,{subType:NPCConst.EVENT_ALL_TASK_PATH,mission:e}),r.push(o);break;case NPCConst.SUB_MISSION_ONE_SUBMIT:a=Tool.manageString(GameText.STR_NPC_MISSION_FINISH,PowerString.makeColorString(e.name,ColorUtils.COLOR_YELLOW)),a+="\n"+GameText.STR_NPC_MISSION_AUTO_ASK,o=new NPCActionData(GameText.getText(GameText.TI_TASK_PATH),8,{subType:NPCConst.EVENT_ALL_TASK_PATH,mission:e}),r.push(o);break;case NPCConst.SUB_RANDOM_MISSION_CHANGE:if(e.isRandomMission())a=e.getRandomMissionTime(),o=new NPCActionData(GameText.getText(GameText.TI_BACK),8,{subType:NPCConst.EVENT_ALL_BACK,mission:e}),r.push(o),o=new NPCActionData(GameText.getText(GameText.TI_MISSION_REFLASH),12,{subType:RandomMission.Action_refresh,mission:e}),r.push(o)}PanelManager.openNPCDialogue(e.name,a,r,s,l,n)},e.doGetCountryBuildingNPC=function(t){if(null==t)return!1;if(t.isTabStatus(Model.NPC_COUNTRY_BLOAD))return!1;if(0==Define.isAllocateCountryMap(xworld.getCurMapID()))return!1;var n=t.getId();return!(n<Define.BUILDING_PALACE||n>Define.BUILDING_SHOP_ARMOR)&&(t.setTabStatus(!0,Model.NPC_COUNTRY_BLOAD),e.doGetNPCData(t),!0)},e.doGetNPCData=function(t){var n=[t.id],i=MsgHandler.createGetNPCData(n);nato.Network.sendCmd(i,(function(n){PanelManager.closeWaitForServer();var i=n.getBytes(),o=e.parseNPCData(i);if(null!=o&&o.length>0){var a=o[0];t.copyCountryBuildingNPCData(a)}t.teacherId&&t.teacherId.length>0&&(t._isShowAllTeacher=!0,t.sortShowAllTeacher(t.menuTeacher,t.teacherId)),t.doNPC()}),this),PanelManager.openWaitForServer()},e.prototype.copyCountryBuildingNPCData=function(t){null!=t&&(this.missionData=t.missionData,this.comeOutTime=t.comeOutTime,this.menuJumpMap=t.menuJumpMap,this.jumpMapID=t.jumpMapID,this.jumpMapGx=t.jumpMapGx,this.jumpMapGy=t.jumpMapGy,this.jumpMapReqMissionID=t.jumpMapReqMissionID,this.jumpMapReqMissionState=t.jumpMapReqMissionState,this.menuBattle=t.menuBattle,this.battleID=t.battleID,this.battleReqMissionID=t.battleReqMissionID,this.battleReqMissionState=t.battleReqMissionState,this.menuShop=t.menuShop,this.shopID=t.shopID,this.shopReqMissionID=t.shopReqMissionID,this.shopReqMissionState=t.shopReqMissionState,this.menuTeacher=t.menuTeacher,this.teacherId=t.teacherId,this.teacherReqMissionID=t.teacherReqMissionID,this.teacherReqMissionState=t.teacherReqMissionState,this.missionGroupID=t.missionGroupID,this.npcType=t.npcType,this.talkDetail=t.talkDetail,this.topic=t.topic)},e.prototype.checkisShowAllTeacher=function(){this._isShowAllTeacher||!this.teacherId||-1==this.name.indexOf("贤者训练师")&&-1==this.name.indexOf("武圣训练师")&&-1==this.name.indexOf("枪王职业技能师")&&-1==this.name.indexOf("枪王技能训练所")||(this._isShowAllTeacher=!0,this.sortShowAllTeacher(this.menuTeacher,this.teacherId))},e.prototype.sortShowAllTeacher=function(t,e){this._showAllTeacherID=[];for(var n=0;n<t.length;n++){var i=t[n];-1!=i.indexOf("主动")?this._showAllTeacherID[0]=e[n]:-1!=i.indexOf("被动")?this._showAllTeacherID[1]=e[n]:-1!=i.indexOf("自动")&&(this._showAllTeacherID[2]=e[n])}},e.prototype.updateMissionIcon=function(){if(null!=this.sprite){if(0==this.getSign()||0==this.isVisible())return void this.hideMissionIcon();null==this.missionIcon&&(this.missionIcon=new eui.Image,this.missionIcon.source="task_finish"),this.updateMissionIconPos();var t=this.getSign(),e=xworld.gameMap.playerLayer;0==t?this.hideMissionIcon():1==t?(this.missionIcon.source="task_finish",this.missionIcon.parent||e.addNpcMissionIcon(this.missionIcon,this)):2==t?(this.missionIcon.source="task_unfinish",this.missionIcon.parent||e.addNpcMissionIcon(this.missionIcon,this)):3==t?(this.missionIcon.source="task_can_accept",this.missionIcon.parent||e.addNpcMissionIcon(this.missionIcon,this)):4==t&&(this.missionIcon.source="task_not_accept",this.missionIcon.parent||e.addNpcMissionIcon(this.missionIcon,this))}},e.prototype.hideMissionIcon=function(){this.missionIcon&&this.missionIcon.parent&&this.missionIcon.parent.removeChild(this.missionIcon)},e.DIR_START=0,e.DIR_END=7,e.DIR_NUM=e.DIR_START+e.DIR_END+1,e.hideCheckNPC1=null,e.hideCheckNPC2=null,e.hideCheckNPC3=null,e.MOVE_MAX_INTERVAL=5,e.MOVE_MIN_INTERVAL=2,e.NPC_HEIGHT=50,e.MissionIcon_width=20,e.MissionIcon_height=30,e}(Model);__reflect(NPC.prototype,"NPC");var RolePropItem=function(t){function e(){var e=t.call(this)||this;return e._attrID=0,e._color=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplainTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_explain)},e.prototype.onBtnExplainTouch=function(){this._attrDetail&&AlertPanel.alertTipsTextFlow(GameText.STR_ATTRIBUTE_INFO,this._attrDetail)},e.prototype.reset=function(){this._attrID=-1,this._attrName="",this._attrValue="",this._attrDetail=null},e.prototype.setData=function(t,e,n,i){this._attrID=t,this._attrName=e,this._attrValue=n,this._color=i;var o=PlayerInfoUIAction.getAttributeText(this._attrID);o=Tool.manageStringList(o,RolePropBasePanel.CHANGE_TEXT[t]),this._attrDetail=Tool.convertDescToTextFlow(o),this.update()},e.prototype.update=function(){this.init&&(this.label_prop.textColor=this._color,this.label_value.textColor=this._color,this.label_prop.text=this._attrName,this.label_value.text=this._attrValue,this.cacheAsBitmap=!0)},e}(ComponentBase);__reflect(RolePropItem.prototype,"RolePropItem");var RolePropPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(){if(this.init){this.reset();var t=PanelManager.getPanel(RoleScene).getPlayer();this.initAttributeText(t);var e=0,n=t.get(ModelConst.LEVEL)>10;this.addAttribute(PlayerInfoUIAction.ATTR_POWER,"战力",""+t.getPower(!1),this.color_green),3==t.getType()&&this.addAttribute(PlayerInfoUIAction.ATTR_LEVEL2,GameText.STR_ATTR_LEVEL2,Tool.manageStringU(GameText.getText(GameText.TI_LEVEL),""+t.get(ModelConst.LEVEL2)),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_STR,GameText.STR_CHANGE_ATT_DESC_ATK_STR,""+t.get(ModelConst.ATK_STR),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_AGI,GameText.STR_CHANGE_ATT_DESC_ATK_AGI,""+t.get(ModelConst.ATK_AGI),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_MAGIC,GameText.STR_CHANGE_ATT_DESC_ATK_MAGIC,""+t.get(ModelConst.ATK_MAGIC),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_DMG,GameText.STR_ATTR_EQUIP_ATK,t.get(ModelConst.ATK_MIN)+"~"+t.get(ModelConst.ATK_MAX),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_ATK_TIME,GameText.STR_ATTR_ATK_TIME,""+t.get(ModelConst.ATK_TIME),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_RATE,GameText.STR_ATTR_HIT_RATE,""+t.get(ModelConst.HIT_RATE),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_HIT_MAGIC,GameText.STR_ATTR_HIT_MAGIC,""+t.get(ModelConst.HIT_MAGIC),this.color_green),e=t.get(ModelConst.BRK_ARMOR),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BRK,GameText.STR_ATTR_BRK,e+"",this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_CRITICAL,GameText.STR_ATTR_CRITICAL,""+t.get(ModelConst.CRITICAL),this.color_green),e=t.get(ModelConst.MAGIC_PENETRATION),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_PEN,GameText.STR_ATTR_MAGIC_PEN,""+e,this.color_green),e=t.get(ModelConst.FORCE_HIT),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_FORCE_HIT,GameText.STR_ATTR_FORCE_HIT,e+"%",this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_WIL,"无视状态抵抗",""+t.get(ModelConst.IGNORE_WIL),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_TOUCH,"无视伤害减免",""+t.get(ModelConst.IGNORE_TOUCH),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_BLOCK,"无视格挡",""+t.get(ModelConst.IGNORE_BLOCK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_BACK,"无视反击",""+t.get(ModelConst.IGNORE_BACK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_INSIGHT,"无视洞察",""+t.get(ModelConst.IGNORE_INSIGHT),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_IGNORE_MAGIC_BACK,"无视魔法反馈",""+t.get(ModelConst.IGNORE_MAGIC_BACK),this.color_green),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_STR,GameText.STR_CHANGE_ATT_DESC_DEF_STR,""+t.get(ModelConst.DEF_STR),this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_AGI,GameText.STR_CHANGE_ATT_DESC_DEF_AGI,""+t.get(ModelConst.DEF_AGI),this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DEF_MAGIC,GameText.STR_CHANGE_ATT_DESC_DEF_MAGIC,""+t.get(ModelConst.DEF_MAGIC),this.color_blue),e=t.get(ModelConst.BLOCK),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BLOCK,GameText.STR_ATTR_BLOCK,e+"",this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_DODGE,GameText.STR_CHANGE_ATT_DESC_DODGE,""+t.get(ModelConst.DODGE),this.color_blue),e=t.get(ModelConst.INSIGHT),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_INSIGHT,GameText.STR_ATTR_INSIGHT,""+e,this.color_blue),e=t.get(ModelConst.BACK),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_BACK,GameText.STR_ATTR_BACK,""+e,this.color_blue),e=t.get(ModelConst.TOUGH),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_TOUGH,GameText.STR_ATTR_TOUGH,e+"",this.color_blue),e=t.get(ModelConst.DEF_FIELD),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_DEF_FIELD,GameText.STR_ATTR_DEF_FIELD,""+e,this.color_blue),e=t.get(ModelConst.MAGIC_BACK),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_MAGIC_BACK,GameText.STR_ATTR_MAGIC_BACK,""+e,this.color_blue),e=t.get(ModelConst.WIL),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_WIL,GameText.STR_ATTR_WIL,e+"",this.color_blue),this.addAttribute(PlayerInfoUIAction.ATTR_SPEED,GameText.STR_ATTR_SPEED,""+t.get(ModelConst.SPEED),this.color_yellow),e=t.get(ModelConst.KEEPOUT_ATK_TIME),this.addAttribute(PlayerInfoUIAction.ATTR_KEEPOUT_ATK_TIME,GameText.STR_ATTR_KEEPOUT_ATK_TIME,e+"",this.color_yellow),e=t.get(ModelConst.LIFE_ABSORPTION),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_GET_HP,GameText.STR_ATTR_GET_HP,""+e,this.color_yellow),e=t.get(ModelConst.MANA_ABSORPTION),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_GET_MP,GameText.STR_ATTR_GET_MP,""+e,this.color_yellow),e=t.get(ModelConst.HEAL_RECOVERY),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_HP,GameText.STR_ATTR_AUTO_HP,""+e,this.color_yellow),e=t.get(ModelConst.MANA_RECOVERY),(n||e>0)&&this.addAttribute(PlayerInfoUIAction.ATTR_AUTO_MP,GameText.STR_ATTR_AUTO_MP,""+e,this.color_yellow),this.container.update()}},e}(RolePropBasePanel);__reflect(RolePropPanel.prototype,"RolePropPanel");var RoleScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_base,this.tabBtn_prop,this.tabBtn_skill,this.tabBtn_society],this._player.getId()==xself.getId()&&this._tabBtnList.push(this.tabBtn_power);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this._tabIndex=0,this.updateTab(),this._player.getId()==xself.getId()&&this.updateRedPoint()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),this.basePanel&&(this.basePanel.canSetBaseAt||(this.basePanel.restoreAtt(),this.basePanel.canSetBaseAt=!0))},e.prototype.onClose=function(){return this.basePanel.canSetBaseAt=!0,this.basePanel.isCheckNewPlayer=!0,this.basePanel.isChangeAttValue()?(this.basePanel.isClosePanel=!0,void this.basePanel.onSureBtnTouch()):void PanelManager.closeScene()},e.prototype.setData=function(t){this._player=t},e.prototype.getPlayer=function(){return this._player},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.setTab=function(t){this._tabIndex=t,this.updateTab()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_BASE?(this.addChild(this.basePanel),this.basePanel.update()):this._tabIndex==e.TAB_INDEX_PROP?(this.addChild(this.propPanel),this.propPanel.update()):this._tabIndex==e.TAB_INDEX_SKILL?(this.addChild(this.skillPanel),this.skillPanel.update()):this._tabIndex==e.TAB_INDEX_SOCIETY?(this.addChild(this.societyPanel),this.societyPanel.update()):this._tabIndex==e.TAB_INDEX_POWER&&(this.addChild(this.powerPanel),this.powerPanel.update())},e.prototype.removeAllPanel=function(){this.basePanel&&this.basePanel.parent&&this.basePanel.parent.removeChild(this.basePanel),this.propPanel&&this.propPanel.parent&&this.propPanel.parent.removeChild(this.propPanel),this.skillPanel&&this.skillPanel.parent&&this.skillPanel.parent.removeChild(this.skillPanel),this.societyPanel&&this.societyPanel.parent&&this.societyPanel.parent.removeChild(this.societyPanel),this.powerPanel&&this.powerPanel.parent&&this.powerPanel.parent.removeChild(this.powerPanel)},e.prototype.updateRedPoint=function(){xself&&xself.cp>0?RedPoint.addRedPoint(this.tabBtn_base):RedPoint.removeRedPoint(this.tabBtn_base)},e.TAB_INDEX_BASE=0,e.TAB_INDEX_PROP=1,e.TAB_INDEX_SKILL=2,e.TAB_INDEX_SOCIETY=3,e.TAB_INDEX_POWER=4,e}(ComponentBase);__reflect(RoleScene.prototype,"RoleScene");var RoleSkillItem=function(t){function e(){var e=t.call(this)||this;return e._isRestPet=!1,e.isMe=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplainTouch,this),ButtonUtils.addTouchEvent(this.btn_giveup,this.onBtnGiveUpTouch,this),this.btn_select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSelect,this),xevent.addEventListener(WorldEvent.PLAYER_ACTIVE_SKILL_SELECTED,this.onActiveSkillSelected,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_explain),ButtonUtils.removeTouchEvent(this.btn_giveup),xevent.removeEventListener(WorldEvent.PLAYER_ACTIVE_SKILL_SELECTED,this.onActiveSkillSelected,this)},e.prototype.onBtnExplainTouch=function(){var t;this._skill&&(t=this._skill.type==Define.SKILL_TYPE_FORMATION?Tool.convertDescToTextFlow(this._skill.getFormationInfo()):Tool.convertDescToTextFlow(this._skill.getDesc()),AlertPanel.alertTipsTextFlow(GameText.STR_SKILL_INFO,t))},e.prototype.onBtnGiveUpTouch=function(){var t,e,n=this,i=function(){n.onBtnGiveUpTouch()},o=[];t=new MenuActionData(GameText.getText(GameText.TI_BACK),1),o.push(t),this._skill.level>1&&(t=new MenuActionData(GameText.STR_ONE_DROP,2),o.push(t)),t=new MenuActionData(GameText.STR_ALL_DROP,3),o.push(t),e=this._skill.type==Define.SKILL_TYPE_FORMATION?this._skill.getFormationInfo():this._skill.getDesc(!1),PanelManager.openSelectMenuPanel(e,o,(function(t){1==t?PanelManager.closeSelectMenuPanel():2==t?Skill.doDropSkillOneLevel(n._player,n._skill,i,this):3==t&&(n._skill.type==Define.SKILL_TYPE_FORMATION?Skill.doForGetFormation(n._skill):Skill.doDropSkill(n._player,n._skill))}),this)},e.prototype.onActiveSkillSelected=function(t){if(this._skill.type==Define.SKILL_TYPE_ACTIVE){var e=t.param;this._skill.id!=e&&(this.btn_select.selected=!1)}},e.prototype.onBtnSelect=function(t){this._skill.type==Define.SKILL_TYPE_FORMATION?(xevent.dispatchEvent(new WorldEvent(WorldEvent.PLAYER_ACTIVE_SKILL_SELECTED,this._skill.id)),Skill.doSetDefaultFormation(this._skill)):this._skill.type==Define.SKILL_TYPE_ACTIVE?(xevent.dispatchEvent(new WorldEvent(WorldEvent.PLAYER_ACTIVE_SKILL_SELECTED,this._skill.id)),this._player.autoSkillID_Initiative==this._skill.id?Skill.doPlayerCancelSkillInitiative(this._player,this._skill):Skill.doPlayerSetSkillInitiative(this._player,this._skill)):this._skill.type==Define.SKILL_TYPE_ROUND&&(this.btn_select.selected=!1,Skill.doSetAutoSkill(this._player,this._skill))},e.prototype.reset=function(){this._skill=null,this._player=null},e.prototype.setData=function(t,e,n){void 0===n&&(n=!1),this._skill=t,this._player=e,this._isRestPet=n,this._skill.type==Define.SKILL_TYPE_PASSIVE||this._isRestPet?this.btn_select.visible=!1:this.btn_select.visible=!0,this.btn_giveup.visible=!this._isRestPet;var i=e.isAutoSkill(t.id);i>=0&&this.btn_select.visible?this.sequence.text=i+1+"":this.sequence.text=""},e.prototype.update=function(){if(this.init)if(this._skill){var t=this._skill.name;this._skill.isLearnByBook&&(t="★"+t),this.label_prop.text=t+"("+this._skill.getRealLevelInfo()+")",this.btn_select.selected=!1,this._player.autoSkillID_Initiative==this._skill.id&&(this.btn_select.selected=!0),this._player.isAutoSkill(this._skill.id)>=0&&(this.btn_select.selected=!0),this._skill.type==Define.SKILL_TYPE_FORMATION&&this._skill.isDefault&&(this.btn_select.selected=!0),this.isMe?(this.showChild(this.btn_select),this.showChild(this.btn_giveup),this.showChild(this.sequence)):(this.hideChild(this.btn_select),this.hideChild(this.btn_giveup),this.hideChild(this.sequence))}else this.label_prop.text=""},e.prototype.showChild=function(t){this.addChild(t)},e.prototype.hideChild=function(t){this.contains(t)&&this.removeChild(t)},e}(ComponentBase);__reflect(RoleSkillItem.prototype,"RoleSkillItem");var RoleSkillPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,this.getPlayer().getId()!=xself.getId()?Tool.removeObjSafe(this.btn_gotoLearn):(this.btn_gotoLearn.stage||this.addChild(this.btn_gotoLearn),ButtonUtils.addTouchEvent(this.btn_gotoLearn,this.onBtnGotoLearn,this)),this.update(),0==PlayerDataManager.playerData.isSkiiOpened&&PlayerDataManager.playerData.isSpriteOpen&&(PlayerDataManager.playerData.isSkiiOpened=!0,PlayerDataManager.savePlayerData(PlayerDataManager.playerData),PanelManager.openSpriteGuidePanel(GameText.STR_SPRITE_GUIDE_5)),egret.setTimeout(this.checkGuide,this,33)},e.prototype.checkGuide=function(){1==GameWorld.useGuide&&1==GameWorld.isLoginSetting(GameWorld.IS_GUIDE_SEL_AUTO_SKILL3)&&(GameWorld.setLoginSetting(!1,GameWorld.IS_GUIDE_SEL_AUTO_SKILL3),GameWorld.setGuide(GameWorld.GUIDE_SEL_AUTO_SKILL3))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_gotoLearn)},e.prototype.onBtnGotoLearn=function(){TodayEvent.doSkill()},e.prototype.reset=function(){this._index=0,this.container.reset(),this.skill_passive&&this.skill_passive.parent&&this.skill_passive.parent.removeChild(this.skill_passive),this.skill_active&&this.skill_active.parent&&this.skill_active.parent.removeChild(this.skill_active),this.skill_round&&this.skill_round.parent&&this.skill_round.parent.removeChild(this.skill_round),this.skill_formation&&this.skill_formation.parent&&this.skill_formation.parent.removeChild(this.skill_formation)},e.prototype.update=function(){if(this.init){this.reset();var t=this.getPlayer(),e=t.get(ModelConst.SP);this.label_haveSkillPoint.text=e.toString(),this.btn_gotoLearn.visible=t.getLevel()>=15,this.updateSkillList(GameText.STR_PASSIVE_SKILL,Define.SKILL_TYPE_PASSIVE),this.updateSkillList(GameText.STR_ACTIVE_SKILL,Define.SKILL_TYPE_ACTIVE),this.updateSkillList(GameText.STR_ROUND_SKILL,Define.SKILL_TYPE_ROUND),this.updateSkillList(GameText2.STR_FORMATION,Define.SKILL_TYPE_FORMATION),this.container.update()}},e.prototype.getContainerBySkillType=function(t){switch(t){case Define.SKILL_TYPE_PASSIVE:return this.skill_passive;case Define.SKILL_TYPE_ACTIVE:return this.skill_active;case Define.SKILL_TYPE_ROUND:return this.skill_round;case Define.SKILL_TYPE_FORMATION:return this.skill_formation}},e.prototype.updateSkillList=function(t,e){this.player=this.getPlayer();var n=Player.getSkillListByType(this.player.skillList,e);if(Define.SKILL_TYPE_FORMATION==e&&(n=this.player.formationList),null!=n&&0!=n.length){var i=this.getContainerBySkillType(e),o=(this.container.width-256)/2;this.container.add(i,o);for(var a=0;a<n.length;a++){var r=this.addSkillItem(n[a]);i==this.skill_active&&0==a&&(this.firstActiveSkillItem=r)}}},e.prototype.addSkillItem=function(t){var e=this._itemList[this._index];return e||(e=new RoleSkillItem,nato.attachSkin(e),this._itemList[this._index]=e),e.setData(t,this.player),e.isMe=this.getPlayer().getId()==xself.getId(),this.container.add(e,0),this._index++,e},e.prototype.getPlayer=function(){return PanelManager.getPanel(RoleScene).getPlayer()},e}(ComponentBase);__reflect(RoleSkillPanel.prototype,"RoleSkillPanel");var RoleSocietyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplainTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_explain)},e.prototype.onBtnExplainTouch=function(){this._attrDetail&&AlertPanel.alertTipsTextFlow(GameText.STR_ATTRIBUTE_INFO,this._attrDetail)},e.prototype.reset=function(){this._attrID=-1,this._attrName="",this._attrValue="",this._attrDetail=null},e.prototype.setData=function(t,e,n,i){void 0===i&&(i=null),this._attrID=t,this._attrName=e,this._attrValue=n,this._iconSource=i;var o=PlayerInfoUIAction.getSocietyText(this._attrID);o=Tool.manageStringList(o,RoleSocietyPanel.CHANGE_TEXT[this._attrID]),this._attrDetail=Tool.convertDescToTextFlow(o),this.update()},e.prototype.update=function(){if(this.init){var t="";Tool.isNullText(this._iconSource)?this.img_icon.source=null:(this.img_icon.source=this._iconSource,t="    "),this.label_prop.text=t+this._attrName,TextFieldUtils.getTextWidth(this._attrValue,this.label_value.size,this.label_value.fontFamily)>this.label_value.width?this.label_value.size=TextFieldUtils.getSizeByMaxWidth(this._attrValue,this.label_value.width,this.label_value.fontFamily):this.label_value.size=15*xhdRatio,this.label_value.text=this._attrValue}},e}(ComponentBase);__reflect(RoleSocietyItem.prototype,"RoleSocietyItem");var RoleSocietyPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(this.init){this.reset();var t=PanelManager.getPanel(RoleScene).getPlayer();e.CHANGE_TEXT=PlayerInfoUIAction.initSocietyText(t),xhd?(this.addAttribute(PlayerInfoUIAction.Society_Money1,GameText.getMoneyText(ModelConst.MONEY1),t.get(ModelConst.MONEY1)+"","gold_square_hd"),this.addAttribute(PlayerInfoUIAction.Society_Money2,GameText.getMoneyText(ModelConst.MONEY2),t.get(ModelConst.MONEY2)+"","gold_leaf_hd"),this.addAttribute(PlayerInfoUIAction.Society_Money3,GameText.getMoneyText(ModelConst.MONEY3),t.get(ModelConst.MONEY3)+"","gold_coin_hd"),this.addAttribute(PlayerInfoUIAction.Society_INTEGRAL,GameText.STR_ATTR_INTEGRAL,t.get(ModelConst.INTEGRAL)+"","money_ji_hd"),this.addAttribute(PlayerInfoUIAction.Society_ARENA,GameText.STR_ATTR_ARENA,t.arenaPoint+"","money_jing_hd"),this.addAttribute(PlayerInfoUIAction.Society_SKY_ARENA,GameText.STR_SKY_ATTR_ARENA,t.skyarenaPoint+"","money_zhan_hd")):(this.addAttribute(PlayerInfoUIAction.Society_Money1,GameText.getMoneyText(ModelConst.MONEY1),t.get(ModelConst.MONEY1)+"","gold_square_sd"),this.addAttribute(PlayerInfoUIAction.Society_Money2,GameText.getMoneyText(ModelConst.MONEY2),t.get(ModelConst.MONEY2)+"","gold_leaf_sd"),this.addAttribute(PlayerInfoUIAction.Society_Money3,GameText.getMoneyText(ModelConst.MONEY3),t.get(ModelConst.MONEY3)+"","gold_coin_sd"),this.addAttribute(PlayerInfoUIAction.Society_INTEGRAL,GameText.STR_ATTR_INTEGRAL,t.get(ModelConst.INTEGRAL)+"","money_ji_sd"),this.addAttribute(PlayerInfoUIAction.Society_ARENA,GameText.STR_ATTR_ARENA,t.arenaPoint+"","money_jing_sd"),this.addAttribute(PlayerInfoUIAction.Society_SKY_ARENA,GameText.STR_SKY_ATTR_ARENA,t.skyarenaPoint+"","money_zhan_sd")),this.addAttribute(PlayerInfoUIAction.Society_ENCHANT,GameText2.STR_ENCHANT_VALUE,t.getEnchantValue()+"/10000"),this.addAttribute(PlayerInfoUIAction.Society_PLAYER_LEVEL2,GameText.STR_PLAYER_LEVEL2,"0/0");var n=GameText.STR_COMMON;this.addAttribute(PlayerInfoUIAction.Society_POSITION,GameText.STR_ATTR_POSITION,""+n),this.addAttribute(PlayerInfoUIAction.Society_STORE_NUM,GameText.STR_STORE_NUM,t.get(ModelConst.NUM_STROE)+"/"+ModelConst.MAX_STORE_NUM),this.addAttribute(PlayerInfoUIAction.Society_KILL_COUNT,GameText.STR_KILL_COUNT,""+t.get(ModelConst.KILL_COUNT)),this.addAttribute(PlayerInfoUIAction.Society_PK_WIN_COUNT,GameText.STR_PK_WIN_COUNT,""+t.get(ModelConst.PK_WIN_COUNT)),this.addAttribute(PlayerInfoUIAction.Society_PK_WIN_RATE,GameText.STR_PK_WIN_RATE,""+t.getPKWin()),this.addAttribute(PlayerInfoUIAction.Society_LIST_DESC_PARTNER,GameText.STR_LIST_DESC_PARTNER,Tool.isNullText(t.partnerName)?GameText.STR_LIST_NULL:t.partnerName),this.addAttribute(PlayerInfoUIAction.Society_MASTER_AND_APPRENTICE,GameText.STR_MASTER_AND_APPRENTICE,t.getMasterFlag()),this.addAttribute(PlayerInfoUIAction.Society_TITLE,GameText.STR_ATTR_TITLE,Tool.isNullText(t.getTitle())?GameText.STR_LIST_NULL:t.getTitle()),this.addAttribute(PlayerInfoUIAction.Society_REINFORCEMENTS,GameText.STR_ATTR_REINFORCEMENTS,Tool.isNullText(t.helpCountry)?GameText.STR_LIST_NULL:t.helpCountry),this.container.update()}},e.prototype.addAttribute=function(t,e,n,i){void 0===i&&(i=null);var o=this._itemList[this._index];o||(o=new RoleSocietyItem,nato.attachSkin(o),this._itemList[this._index]=o),o.setData(t,e,n,i),this.container.add(o,0),this._index++},e}(ComponentBase);__reflect(RoleSocietyPanel.prototype,"RoleSocietyPanel");var SafeLockPanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),ButtonUtils.addTouchEvent(this.btn_return,this.onBtnReturn,this),this.input_pwd1.maxChars=6,this.input_pwd1.restrict="0-9",this.input_pwd2.maxChars=6,this.input_pwd2.restrict="0-9",this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_return)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnOk=function(){if(null!=this._callbackFunc&&null!=this._thisObj){var t=this.input_pwd1.text;if(this._type==e.Type_modify){var n=this.input_pwd2.text;this._callbackFunc.call(this._thisObj,t,n)}else this._callbackFunc.call(this._thisObj,t)}},e.prototype.onBtnReturn=function(){this.onClose()},e.prototype.setData=function(t,e,n,i){void 0===i&&(i=null),this._type=t,this._callbackFunc=e,this._thisObj=n},e.prototype.reset=function(){this.init&&(this.input_pwd1.text="",this.input_pwd2.text="")},e.prototype.update=function(){if(this.init){this.reset();this._type==e.Type_doSafe?(this.label_title.text="安全锁",this.label_info1.text="请输入安全锁密码",this.group_newPassword.visible=!1,this.label_desc.text=GameText.STR_TYPE_SAFELOCK_VERIFY_INFO,this.label_desc.height=this.label_desc.textHeight,this.label_desc.y=this.group_newPassword.y,this.btn_ok.y=this.btn_return.y=this.label_desc.y+this.label_desc.height+50):this._type==e.Type_modify?(this.label_title.text="修改安全锁",this.label_info1.text="请输入旧的安全锁密码",this.group_newPassword.visible=!0,this.label_desc.text=GameText.STR_SAFELOCK_EXPLAIN,this.label_desc.height=this.label_desc.textHeight,this.label_desc.y=this.group_newPassword.y+this.group_newPassword.height+50,this.btn_ok.y=this.btn_return.y=this.label_desc.y+this.label_desc.height+50):this._type==e.Type_set?(this.label_title.text="设置安全锁",this.label_info1.text="请设置安全锁密码(4~6位数字)",this.group_newPassword.visible=!1,this.label_desc.text=GameText.STR_SAFELOCK_EXPLAIN,this.label_desc.height=this.label_desc.textHeight,this.label_desc.y=this.group_newPassword.y,this.btn_ok.y=this.btn_return.y=this.label_desc.y+this.label_desc.height+50):this._type==e.Type_answerQuestion?(this.label_title.text="回答问题",this.label_info1.text=this._questionStr,this.group_newPassword.visible=!1,this.label_desc.text=GameText2.STR_QQ_SAFE_LOCK_QUESTION_INFO,this.label_desc.height=this.label_desc.textHeight,this.label_desc.y=this.group_newPassword.y,this.btn_ok.y=this.btn_return.y=this.label_desc.y+this.label_desc.height+50):this._type==e.Type_remove&&(this.label_title.text="解除安全锁",this.label_info1.text="请输入安全锁密码",this.group_newPassword.visible=!1,this.label_desc.text=GameText.STR_TYPE_SAFELOCK_REMOVE_INFO,this.label_desc.height=this.label_desc.textHeight,this.label_desc.y=this.group_newPassword.y,this.btn_ok.y=this.btn_return.y=this.label_desc.y+this.label_desc.height+50)}},e.Type_doSafe=1,e.Type_modify=2,e.Type_set=3,e.Type_answerQuestion=4,e.Type_remove=5,e}(ComponentBase);__reflect(SafeLockPanel.prototype,"SafeLockPanel");var SafeLockQuestionPanel=function(t){function e(){var e=t.call(this)||this;return e._type=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_send,this.onBtnSend,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_send)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnSend=function(){},e.prototype.setData=function(t){this._type=t},e.prototype.reset=function(){this.init&&(this.input_answer1.text="",this.input_answer2.text="",this.input_answer3.text="")},e.prototype.update=function(){this.init&&this.reset()},e}(ComponentBase);__reflect(SafeLockQuestionPanel.prototype,"SafeLockQuestionPanel");var SaveToDesktopPanel=function(t){function e(){var e=t.call(this)||this;return e.reward_wanba=50,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_save)},e.prototype.initPanel=function(){ButtonUtils.addTouchEvent(this.btn_save,this.onSave,this),this.label_money.text=(xchannel==Define.CHANNEL_WANBA?this.reward_wanba:200)+GameText.STR_MONEY2},e.prototype.onSave=function(){Sdk.xsdk.sendToDesktop(this.saveSuccess),PanelManager.closeSavePanel()},e.prototype.saveSuccess=function(){var t=MsgHandler.saveToDesktop();nato.Network.sendCmd(t,(function(t){if(0>t.getInt());else{var e=t.getInt(),n=e-xself.money2;xself.money2=e,AlertPanel.alertCommon(GameText.SAVE_TO_DESKTOP+n+GameText.STR_MONEY2)}}),this)},e}(WindowPanelBase);__reflect(SaveToDesktopPanel.prototype,"SaveToDesktopPanel");var InviteItemData=function(){function t(t,e,n){this._id=parseInt(t),this._isDraw=e,this._iconUrl=n}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDraw",{get:function(){return this._isDraw},set:function(t){this._isDraw=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iconUrl",{get:function(){return this._iconUrl},enumerable:!0,configurable:!0}),t}();__reflect(InviteItemData.prototype,"InviteItemData");var InviteAwardItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.dataChanged=function(){var e=this;t.prototype.dataChanged.call(this),this.imgHead.mask=this.spMask;var n=this.data;if(n&&n.isDraw?(this.currentState="gained",this.touchEnabled=!1,this.touchChildren=!1):(this.currentState="default",this.touchEnabled=!!n,this.touchChildren=!!n,this.txtTips.visible=n&&!n.isDraw,this.txtCount.text=(this.itemIndex<5?50:80).toString()),this.imgHead.texture=null,n&&!Tool.isNullText(n.iconUrl)){this.imgHead.width=100,this.imgHead.height=100;var i=new egret.ImageLoader;i.addEventListener(egret.Event.COMPLETE,(function(t){var n=t.currentTarget,i=new egret.Texture;i._setBitmapData(n.data),e.imgHead.texture=i}),this),i.crossOrigin="anonymous",i.load(n.iconUrl)}},e}(eui.ItemRenderer);__reflect(InviteAwardItem.prototype,"InviteAwardItem");var InvitePanel=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.initComponent=function(){var e=this;t.prototype.initComponent.call(this),InteractUtil.sendMessage(ProtocolDefine.CG_GET_INVITATION_INFO,(function(t){e._inviteData=new Array(50),e._inviteCnt=t.getInt(),e._cdTime=t.getInt();for(var n=t.getByte(),i=0;n>i;i++){var o=t.getString(),a=t.getBoolean(),r=t.getString();e._inviteData[i]=new InviteItemData(o,a,r)}e.updatePanel()}),this)},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnInvite",this.onInvite,this),this.listAward.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickAward,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),egret.clearInterval(this._cdKey),this.listAward.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickAward,this)},e.prototype.updatePanel=function(){var t=this;this.formatCdTime(),this._cdTime>0&&this._inviteCnt<3&&(egret.clearInterval(this._cdKey),this._cdKey=egret.setInterval((function(){t._cdTime-=1,t._cdTime>=0?t.formatCdTime():egret.clearInterval(t._cdKey)}),this,1e3)),this.txtCount.text="【次数："+(3-this._inviteCnt)+"/3】",this.listAward.itemRenderer=InviteAwardItem,this.listAward.dataProvider=new eui.ArrayCollection(this._inviteData)},e.prototype.onInvite=function(){return this._inviteCnt>=3?void AlertPanel.alertCommon("今日分享次数已用完"):void Sdk.xsdk.share("","世界Online",xworld.share_desc,"","","",0,this.onShareSucc,this.onShareFail,this)},e.prototype.onShareSucc=function(){var t=this;this._cdTime>0||InteractUtil.sendMessage(ProtocolDefine.CG_SAHRE_INVITATION,(function(e){xself.setMoneyByType(ModelConst.MONEY2,e.getInt()),t._inviteCnt=e.getInt(),t._cdTime=e.getInt(),t.updatePanel()}),this)},e.prototype.onShareFail=function(){},e.prototype.formatCdTime=function(){var t=Math.floor(this._cdTime/60),e=Math.floor(this._cdTime%60);this.txtTime.text=(10>t?"0"+t:t)+":"+(10>e?"0"+e:e)},e.prototype.onClickAward=function(t){var e=this,n=t.item;if(n&&!n.isDraw){var i=new egret.ByteArray;i.writeInt(n.id),InteractUtil.sendMessage(ProtocolDefine.CG_DRAW_INVITATION_AWARD,(function(t){n.isDraw=!0,e.listAward.dataProvider.itemUpdated(n),xself.setMoneyByType(ModelConst.MONEY2,t.getInt())}),this,i)}},e}(PanelBase);__reflect(InvitePanel.prototype,"InvitePanel");var SinaSharePanel=function(t){function e(){var e=t.call(this)||this;return e.reward_1758=10,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_share)},e.prototype.initPanel=function(){ButtonUtils.addTouchEvent(this.btn_share,this.onShare,this),this.btn_share.label=GameText.SHARE_SHARE,this.label_share.multiline=!0,this.label_share.wordWrap=!1,this.label_share.maxChars=140,this.money_icon.source="gold_leaf"+(xhd?"_hd":"_sd"),this.label_share.text=xworld.share_desc,xchannel==Define.CHANNEL_1758?(this.label_share.text=GameText.SHARE_DESC_1758,this.label_money.text=this.reward_1758+GameText.STR_MONEY2,this.label_share.touchEnabled=!1):(this.label_money.text=200+GameText.STR_MONEY2,this.label_share.text="",this.label_share.prompt=GameText.SHARE_RPOMPT)},e.prototype.onShare=function(){var t=xworld.share_desc;xchannel==Define.CHANNEL_1758?Sdk.xsdk.share("",xworld.share_title,t,"","",GameText.STR_MONEY2+"X"+this.reward_1758,0):Sdk.xsdk.share("",xworld.share_title,t,"","","",0,this.onShareSucc,this.onShareFail,this)},e.prototype.onShareSucc=function(){MsgHandler.createChannelShareMsg("",""),PanelManager.closeSharePanel()},e.prototype.onShareFail=function(){PanelManager.closeSharePanel()},e}(WindowPanelBase);__reflect(SinaSharePanel.prototype,"SinaSharePanel");var WanBaSharePanel=function(t){function e(){var e=t.call(this,["ui/wbshare_"+(xhd?"hd":"sd")+".png"])||this;return e.reward_wanba=50,nato.attachSkin(e),e}return __extends(e,t),e.prototype.initComponent=function(){t.prototype.initComponent.call(this),this.money_icon.source="gold_leaf"+(xhd?"_hd":"_sd"),this.label_money.text=this.reward_wanba+GameText.STR_MONEY2},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),InteractUtil.setGroupTouch(this.btn_share),this._clickHelper.regClickFunc("btn_share",this.onShare,this)},e.prototype.afterShowFunc=function(){t.prototype.afterShowFunc.call(this),GameWorld.cleanGuide()},e.prototype.onShare=function(){var t=xworld.share_desc;Sdk.xsdk.share("","世界Online",t,"","","",0,this.onShareSucc,this.onShareFail,this)},e.prototype.onShareSucc=function(){this.close(),MsgHandler.createChannelShareMsg("","")},e.prototype.onShareFail=function(){this.close()},e}(PanelBase);__reflect(WanBaSharePanel.prototype,"WanBaSharePanel");var AutoSell=function(){function t(){}return t.openAutoSell=function(t){if(void 0===t&&(t=!1),0!=SafeLock.doSafeLockVerify()){var e=this.getAutoSellData();if(t){var n=!0;if(null!=e)for(var i=0;i<e.length;i++){var o=e[i];if(o&&o.length>0){n=!1;break}}if(n)return}PanelManager.openAutoSellPanel(e)}},t.getCheckBoxSetting=function(){var t=PlayerDataManager.playerData.sellSetting;return(null==t||0>=t)&&(t=0,t=Tool.setBit(!0,1,t),t=Tool.setBit(!0,2,t),t=Tool.setBit(!0,4,t),t=Tool.setBit(!1,8,t),t=Tool.setBit(!1,16,t)),t},t.isCheckboxSelect=function(t){var e=this.getCheckBoxSetting();return Tool.isBit(t,e)},t.saveSetting=function(t){var e=PlayerDataManager.playerData;t!=e.sellSetting&&(e.sellSetting=t,PlayerDataManager.savePlayerData(e))},t.getAutoSellData=function(){var t=[],e=[],n=[],i=[],o=[],a=xself.getLevel(),r=10*Math.floor(2*a/10)/2,s=xself.bag;if(null==s)return null;for(var l=PlayerBag.BAG_START;l<=s.bagEnd;l++){var _=s.store[l];if(null!=_)if(_.type==Define.ITEM_TYPE_BUILD_MATERIAL)(-1!=_.name.indexOf("碎木")||-1!=_.name.indexOf("碎石")||-1!=_.name.indexOf("碎矿"))&&o.push(_);else if(_.type==Define.ITEM_TYPE_TASK)0==_.grade&&t.push(_);else if(_.isEquipClass()&&_.reqLv<r){if(_.isTimeItem()){e.push(_);continue}if(_.type==Define.ITEM_TYPE_ARMOR_TRANSPORT)continue;if(_.type==Define.ITEM_TYPE_ARMOR_FASHION)continue;0==_.grade?t.push(_):1==_.grade?n.push(_):2==_.grade&&i.push(_)}}return[t,e,n,i,o]},t.getForgedItemList=function(t){if(null==t||0==t.length)return null;for(var e=[],n=0;n<t.length;n++){var i=t[n];if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=i[o];a&&a.isEquipClass()&&(a.star>0||a.attachDone>0)&&e.push(a)}}return e},t.doAutoSell=function(t,e,n){for(var i=[],o=0;o<e.length;o++){if(Tool.isBit(1<<o,t)){var a=e[o];if(a&&a.length>0)for(var r=0;r<a.length;r++){var s=a[r];s&&(null==n||-1==n.indexOf(s))&&i.push(s)}}}this.sendToSell(i),this.saveSetting(t)},t.sendToSell=function(t){if(null!=t&&0!=t.length){var e=new nato.Message(ProtocolDefine.CG_AUTO_SELL);e.putByte(t.length);for(var n=0;n<t.length;n++){var i=t[n];e.putInt(i.id),e.putShort(i.slotPos),e.putShort(i.quantity)}nato.Network.sendCmd(e,(function(t){PanelManager.closeWaitForServer();var e=t.getByte();if(0>e)AlertPanel.alertCommon(t.getString());else{for(var n="",i=0;e>i;i++){var o=(t.getInt(),t.getShort()),a=t.getShort(),r=xself.bag.getBagItemBySlotPos(a);null!=r&&(n+="\n"+r.getNameInfo()+"X"+o),xself.bag.removeBagItemByPos(a,o)}var s=t.getInt(),l=t.getInt(),_=t.getInt(),h=t.getInt();xself.setPlayerMoneyValue(s,l,_),AlertPanel.alertCommon(Tool.manageStringList(GameText2.STR_AUTO_SELL_ALERT_INFO,[n,h+""])),PanelManager.bagScene&&PanelManager.bagScene.stage&&PanelManager.bagScene.updatePanel(),PanelManager.isPanelShow(ShopScene)&&PanelManager.getPanel(ShopScene).update()}}),this),PanelManager.openWaitForServer()}},t.autoSell_onekeyDailyMission=function(){var t=[],e=xself.getLevel(),n=10*Math.floor(2*e/10)/2,i=xself.bag;if(null==i)return null;for(var o=PlayerBag.BAG_START;o<=i.bagEnd;o++){var a=i.store[o];if(null!=a&&a.isEquipClass()&&a.reqLv<n){if(a.isTimeItem())continue;if(a.type==Define.ITEM_TYPE_ARMOR_TRANSPORT)continue;if(a.type==Define.ITEM_TYPE_ARMOR_FASHION)continue;0==a.grade&&t.push(a)}}this.sendToSell(t)},t}();__reflect(AutoSell.prototype,"AutoSell");var AutoSellItem=function(){function t(){this.allpices=0}return t.doGetItemLists=function(){if(null!=xself){var e=xself.bag;if(null!=e){var n=new nato.Message(ProtocolDefine.CG_GET_AUTO_SELL_LIST);nato.Network.sendCmd(n,(function(n){PanelManager.closeWaitForServer();var i=n.getByte();if(!(1>i)){var o=new t;o.vItemLists=[],o.allpices=0;for(var a=0;i>a;a++){var r=(n.getString(),n.getShort()),s=(n.getByte(),n.getShort()),l=(n.getInt(),n.getInt()),_=e.getItem(s);null!=_&&(_.quantity=r,_.price=l,o.allpices+=l,o.vItemLists.push(_))}o.vItemLists.length}}),this),PanelManager.openWaitForServer()}}},t.prototype.doSellItem=function(){var t=xself;if(null!=t){var e=t.bag;if(null!=e&&0!=SafeLock.doSafeLockVerify()){var n=new nato.Message(ProtocolDefine.CG_AUTO_SELL);n.putByte(this.vItemLists.length);for(var i=0;i<this.vItemLists.length;i++){var o=this.vItemLists[i];null!=o&&(n.putInt(o.id),n.putShort(o.slotPos),n.putShort(o.quantity))}nato.Network.sendCmd(n,(function(n){var i=n.getByte();if(0>i)AlertPanel.alertCommon(n.getString());else{for(var o="",a=0;i>a;a++){var r=(n.getInt(),n.getShort()),s=n.getShort(),l=e.getBagItemBySlotPos(s);null!=l&&(o+="\n"+l.getNameInfo()+"X"+r),e.removeBagItemByPos(s,r)}var _=n.getInt(),h=n.getInt(),u=n.getInt(),c=n.getInt();t.setPlayerMoneyValue(_,h,u),AlertPanel.alertCommon(Tool.manageStringList(GameText2.STR_AUTO_SELL_ALERT_INFO,[o,c+""])),PanelManager.closeAutoSellPanel();var T=PanelManager.getPanel(ShopScene);T&&T.stage&&T.update()}}),this)}}},t.doAutoSellTest=function(){var t=xself.bag,e=new nato.Message(ProtocolDefine.CG_AUTO_SELL);e.putByte(3);for(var n=0;3>n;n++){var i=t.getItem(PlayerBag.BAG_START+n);null!=i&&(e.putInt(i.id),e.putShort(i.slotPos),e.putShort(i.quantity))}nato.Network.sendCmd(e,(function(e){var n=e.getByte();if(0>n)AlertPanel.alertCommon(e.getString());else{for(var i="",o=0;n>o;o++){var a=(e.getInt(),e.getShort()),r=e.getShort(),s=t.getBagItemBySlotPos(r);null!=s&&(i+="\n"+s.getNameInfo()+"X"+a),t.removeBagItemByPos(r,a)}var l=e.getInt(),_=e.getInt(),h=e.getInt(),u=e.getInt();if(xself.setPlayerMoneyValue(l,_,h),AlertPanel.alertCommon(Tool.manageStringList(GameText2.STR_AUTO_SELL_ALERT_INFO,[i,u+""])),PanelManager.isPanelShow(BagScene))PanelManager.getPanel(BagScene).updatePanel()}}),this)},t}();__reflect(AutoSellItem.prototype,"AutoSellItem");var AutoSellListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._itemData=t},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&this._itemData&&(this.itemIcon.setData(this._itemData.bagIcon,this._itemData.grade),this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo()+" x"+this._itemData.quantity))},e}(ComponentBase);__reflect(AutoSellListItem.prototype,"AutoSellListItem");var AutoSellPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._setting=0,e._step=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._checkboxList){this._checkboxList=[];for(var n=0;this["checkbox"+n];)this._checkboxList.push(this["checkbox"+n]),n++}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOk,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_ok)},e.prototype.onClose=function(){PanelManager.closeAutoSellPanel()},e.prototype.onBtnOk=function(){0==this._step&&this._forgedList&&this._forgedList.length>0?(this._step=1,this.update()):(this.onClose(),AutoSell.doAutoSell(this.getCurSetting(),this._sellList,this._ignoreList))},e.prototype.onItemTouch=function(t){var e=t.target.parent;if(e&&e.itemData)if(t.target==e.closeBtn){var n=this._forgedList.indexOf(e.itemData);-1!=n&&(this._forgedList.splice(n,1),this._ignoreList.push(e.itemData),this.update())}else{var i=e.itemData.getDesc(null,!1);AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),Tool.convertDescToTextFlow(i))}},e.prototype.setData=function(t){this._sellList=t,this.initData()},e.prototype.initData=function(){this._setting=AutoSell.getCheckBoxSetting(),this._forgedList=AutoSell.getForgedItemList(this._sellList),this._ignoreList=[],this._step=0},e.prototype.getCount=function(t){if(this._sellList&&this._sellList.length>0){var e=this._sellList[t];if(e&&e.length>0){if(4==t){for(var n=0,i=0;i<e.length;i++)n+=e[i].quantity;return n}return e.length}}return 0},e.prototype.getShowContent=function(t){var n=e.btnNameList[t],i=this.getCount(t);return Tool.manageString(n,i+"")},e.prototype.getCurSetting=function(){for(var t=this._setting,e=0;e<this._checkboxList.length;e++){var n=this._checkboxList[e].selected;t=Tool.setBit(n,1<<e,t)}return t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0,this.group_list&&this.group_list.parent&&(this.group_list.parent.removeChild(this.group_list),this.group_list.visible=!0),this.group_select.parent&&(this.group_select.parent.removeChild(this.group_select),this.group_select.visible=!0))},e.prototype.update=function(){if(this.init){if(this.reset(),0==this._step){this.container.add(this.group_select);for(var t=0;t<this._checkboxList.length;t++){var e=this._checkboxList[t],n=Tool.isBit(1<<t,this._setting);e.selected=n,e.labelDisplay.textFlow=Tool.convertDescToTextFlow(this.getShowContent(t))}}else if(1==this._step&&(this.container.add(this.group_list),this._forgedList&&this._forgedList.length>0))for(t=0;t<this._forgedList.length;t++){var i=this._forgedList[t],o=this.getItem();o.setData(i),this.container.add(o)}this.container.updateAutoSize(this.container.totalHeight,250*xhdRatio),this.height=this.container.y+this.container.height+50*xhdRatio}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new AutoSellListItem,nato.attachSkin(t),t.horizontalCenter=0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.btnNameList=["/cE5E5E5普通装备:%U/p","/cE5E5E5限时装备:%U/p","/c4BF842精致装备:%U/p","/c42ADF8稀有装备:%U/p","/cE5E5E5建筑材料:%U/p"],e}(ComponentBase);__reflect(AutoSellPanel.prototype,"AutoSellPanel");var HotShop=function(){function t(){}return t.getHotShopData=function(e,n){var i=MsgHandler.createHotShopList();nato.Network.sendCmd(i,(function(i){return PanelManager.closeWaitForServer(),0>i.getInt()?(AlertPanel.alertCommon(i.getString()),void(null!=e&&null!=n&&e.call(n))):(t.processHotShopList(i),void(null!=e&&null!=n&&e.call(n)))}),this),PanelManager.openWaitForServer()},t.processHotShopList=function(e){var n=e.getInt();t.refreshTime=Tool.currentTime+1e3*n,t.refreshCount=e.getInt();for(var i=[],o=e.getByte(),a=0;o>a;a++){var r=new HotShopItemData;r.id=e.getInt(),r.vipLevel=e.getInt(),r.isDiscount=e.getBoolean(),r.isCoin=e.getBoolean(),r.price=e.getInt(),r.item=new ItemData,ItemData.fromBytesAtts2(r.item,e),r.item.durMax>0&&(r.item.durability=r.item.durMax),i.push(r)}i=i.sort(t.sortList),t._itemList=i,0==i.length&&AlertPanel.alertCommon("商品列表已被买光啦，请刷新")},t.sortList=function(t,e){return t&&t.isDiscount?-1:e&&e.isDiscount?1:0},t.getItemList=function(){return this._itemList},t.checkIsRefreshTime=function(){return this.refreshTime<=0||Tool.currentTime>this.refreshTime},t.refreshHotShop=function(){if(0!=SafeLock.doSafeLockVerify()){var e=MsgHandler.createRefreshHotShop();nato.Network.sendCmd(e,(function(e){if(PanelManager.closeWaitForServer(),0>e.getInt())AlertPanel.alertCommon(e.getString());else{if(e.getBoolean()){var n=e.getInt(),i=e.getInt(),o=e.getInt();xself.setPlayerMoneyValue(n,i,o)}else{var a=e.getShort(),r=e.getByte();xself.bag.removeBagItemByPos(a,r)}t.processHotShopList(e),PanelManager.isPanelShow(ShopScene)&&PanelManager.getPanel(ShopScene).update()}}),this),PanelManager.openWaitForServer()}},t.buyAll=function(){!function e(){t._itemList.length>0&&t.buyHotShopItem(t._itemList[0],!1,e,this)}()},t.buyHotShopItem=function(e,n,i,o){function a(e){if(PanelManager.closeWaitForServer(),0>e.getInt())AlertPanel.alertCommon(e.getString());else{var n=e.getInt(),a=e.getInt(),r=e.getInt();xself.setPlayerMoneyValue(n,a,r),t.processHotShopList(e);var s=MsgHandler.processAddItemMsg(e);WorldMessage.addTips(s),PanelManager.updatePanel(ShopScene),null!=i&&null!=o&&i.call(o)}}function r(){var t=MsgHandler.createBuyHotShopItem(e.id);nato.Network.sendCmd(t,a,this),PanelManager.openWaitForServer()}if(void 0===n&&(n=!0),void 0===i&&(i=null),void 0===o&&(o=null),0!=SafeLock.doSafeLockVerify()&&null!=e)if(n){var s=e.price;e.isDiscount&&(s=Math.floor(.5*s));var l="黄金";if(e.isCoin&&(l="铜币"),e.isCoin){if(s>xself.money3)return void WorldMessage.addTips("/cff0000铜币不足，无法购买/p")}else if(s>xself.money1)return void WorldMessage.addTips("/cff0000黄金不足，无法购买/p");var _="是否花费/cffcc00"+s+l+"/p购买"+e.item.getNameInfo()+"?";AlertPanel.alert("温馨提示",_,r,this)}else r()},t.clean=function(){this.refreshTime=-1,this.refreshCount=0,this._itemList=null},t.refreshTime=-1,t.refreshCount=0,t}();__reflect(HotShop.prototype,"HotShop");var HotShopItemData=function(){this.id=0,this.isDiscount=!1,this.isCoin=!1,this.vipLevel=0,this.price=0};__reflect(HotShopItemData.prototype,"HotShopItemData");var ItemExchange=function(t){function e(){var e=t.call(this)||this;return e._needHonor=0,e._count=1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOK,this),this.numberEditView.addEventListener(egret.Event.CHANGE,this.onNumberChange,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_ok),this.numberEditView.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this)},e.prototype.onClose=function(){PanelManager.closeItemExchangePanel()},e.prototype.onBtnOK=function(){this._onConfirm&&this._onConfirm.call(this._thisObj,this._count)},e.prototype.onNumberChange=function(){this._count=this.numberEditView.value,this.update()},e.prototype.setData=function(t,e,n){this._needHonor=t,this._onConfirm=e,this._thisObj=n,this.update()},e.prototype.update=function(){if(this.init){var t=this._needHonor*this._count+"",e=xself.countryHonor+"",n=Tool.manageStringList(GameText.STR_COUNTRY_STORAGE_GET_ASK,[t,e]),i=Tool.convertDescToTextFlow(Tool.convertLastLinefeed(n));this.label_content.textFlow=i}},e}(ComponentBase);__reflect(ItemExchange.prototype,"ItemExchange");var OtherShopPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._shopType=0,e._shopID=0,e._isReset=!1,e._selectIndex=0,e._isInputSearchName=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_action,this.onBtnAction,this),this.btn_info.label=GameText.getText(GameText.TI_DETAIL),this._shopType==ShopType.SUB_SHOP_PETCOMPOSITE&&(this.currentState="pet_composite"),this.update(),this.updateMoney()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_action),ButtonUtils.removeTouchEvent(this.btn_info),this.reset(),this.clearSpr(),this.clearSimpleTips(),this._selectItem=null,this._shopType==ShopType.SUB_SHOP_PETCOMPOSITE&&(this.search_name.removeEventListener(egret.Event.FOCUS_IN,this.searchNameFocusIn,this),this.search_name.removeEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),ButtonUtils.removeTouchEvent(this.btn_search))},e.prototype.onClose=function(){PanelManager.closeScene(!0),this._selectIndex=0,this._currShopItemList=null,this._isInputSearchName=!1},e.prototype.onBtnAction=function(){if(null!=this._selectItem&&null!=this._selectItem.shopItem)if(this._shopType==ShopType.SUB_SHOP_COMBIN||this._shopType==ShopType.SUB_SHOP_ENCHANT||this._shopType==ShopType.SUB_SHOP_EQ_UPGRADE)ItemManager.doItemCombin_1(this._shopType,this._shopID,this._selectItem.shopItem);else if(this._shopType==ShopType.SUB_SHOP_PETCOMPOSITE)this._selectItem&&this._selectItem.shopItem&&this._selectItem.shopItem.petComsiteInfo&&PetComposite.doPetCompositeSelectMenu(this._shopID,this._selectItem.shopItem.petComsiteInfo);else if(this._shopType==ShopType.SUB_SHOP_INTEGRAL||this._shopType==ShopType.SUB_SHOP_ARENA||this._shopType==ShopType.SUB_SHOP_SKYARENA)if(this._selectItem.shopItem.isStackable()){PanelManager.openEditNameView("积分兑换","请输入购买的物品数量:","1",(function(t){var e=Number(t);GameWorld.doIntegralBuy(this._selectItem.shopItem,e)}),null,this)}else GameWorld.doIntegralBuy(this._selectItem.shopItem,1);else this._shopType==ShopType.SUB_SHOP_SELL?SellHandler.doStallBuy(this._selectItem.shopItem):this._shopType==ShopType.SUB_SHOP_ENCHAT_SELL?Enchant.doEnchantGetLists(this._selectItem.shopItem,!0):(this._shopType=ShopType.SUB_SHOP_ENCHAT_EQUIP)&&Enchant.doEnchantItemUse(Enchant.item,this._selectItem.shopItem)},e.prototype.onItemTouch=function(t){var e;if(t.target instanceof ShopListItem?e=t.target:t.target.parent instanceof ShopListItem&&(e=t.target.parent),e&&e.shopItem){this.clearSimpleTips(),this.onSelectItem(e);var n=this.container.list.indexOf(e);if(this._selectIndex=n,null==e.shopItem.petComsiteInfo);else if(null!=e.shopItem.petComsiteInfo){null==this._simpleTips&&(this._simpleTips=new TaskItemSimple);var i=e.shopItem.petComsiteInfo.petcompositepet.getPetCompositeDesc(),o=e.localToGlobal(0,0);o&&o.y>nato.standardHeight/2?(this._simpleTips.setData(i,!0),this._simpleTips.y=-this._simpleTips.height):(this._simpleTips.setData(i,!1),this._simpleTips.y=90),this._simpleTips.x=n%2==0?0:this.container.width-this._simpleTips.width-e.x,e.addChild(this._simpleTips),this.container.setItemToTop(e)}}},e.prototype.onPetInfo=function(){if(this._selectItem&&this._selectItem.shopItem){var t=this._selectItem.shopItem,e=new MyPet(null);e.petItem=t;MyPet.doPetInfoMsg(e,MsgHandler.PET_INFO_PLAYER_SHOP,[SellHandler.model.getId(),t.slotPos],(function(){PanelManager.openPetDetailScene(e,PetDetailScene.FromType_trade)}),this)}},e.prototype.onSelectItem=function(t){if(null==t||null==t.shopItem)return this.clearSpr(),this.item.itemData=null,this.label_itemName.text="",this.img_priceIcon.source="",void(this.label_price.text="");if(this._selectItem&&(this._selectItem.select=!1),this._selectItem=t,this._selectItem.select=!0,this._shopType!=ShopType.SUB_SHOP_PETCOMPOSITE&&(this._shopType==ShopType.SUB_SHOP_SELL?t.shopItem.isPetType()?(this.currentState="pet",ButtonUtils.addTouchEvent(this.btn_info,this.onPetInfo,this)):(this.currentState="other",ButtonUtils.removeTouchEvent(this.btn_info)):this.currentState="other"),this._selectIndex=this._itemList.indexOf(t),this.item.itemData=t.shopItem,this.label_itemName.textFlow=Tool.convertDescToTextFlow(t.shopItem.getNameInfo()),null!=this._selectItem.shopItem.petComsiteInfo)this.img_priceIcon.visible=!1,this.img_priceBg.visible=!1,this.label_price.text="",this.clearSpr(),this._playerSprite=SpriteHelper.createPetSpriteByIcon(this._selectItem.shopItem.petComsiteInfo.petcompositepet.getIcon1(),!1),this._playerSprite.setScale(xhd?1.5:1),this.groupSpr.addChild(this._playerSprite);else{if(this._shopType==ShopType.SUB_SHOP_ENCHAT_EQUIP)this.img_priceIcon.visible=!1,this.img_priceBg.visible=!1,this.label_price.text="";else{this.img_priceIcon.visible=!0,this.img_priceBg.visible=!0;var e="",n=0;this._shopType==ShopType.SUB_SHOP_INTEGRAL?(e="money_ji"+(xhd?"_hd":"_sd"),n=t.shopItem.integral):this._shopType==ShopType.SUB_SHOP_ARENA?(e="money_jing"+(xhd?"_hd":"_sd"),n=t.shopItem.arenaPoint):this._shopType==ShopType.SUB_SHOP_SKYARENA?(e="money_zhan"+(xhd?"_hd":"_sd"),n=t.shopItem.skyarenaPoint):t.shopItem.money1>0?(e=xitem.getMoneyIconSource(ModelConst.MONEY1),n=t.shopItem.money1):t.shopItem.money2>0?(e=xitem.getMoneyIconSource(ModelConst.MONEY2),n=t.shopItem.money2):t.shopItem.money3>0&&(e=xitem.getMoneyIconSource(ModelConst.MONEY3),n=t.shopItem.money3),this.img_priceIcon.source=e,this.label_price.text=n.toString()}this.clearSpr(),t.shopItem.isCanEquip()&&(this._playerSprite=Player.getCompareSprite(xself,t.shopItem),this._playerSprite.setScale(xhd?1.5:1),this.groupSpr.addChild(this._playerSprite))}},e.prototype.clearSpr=function(){this.groupSpr.removeChildren(),this._playerSprite=null},e.prototype.clearSimpleTips=function(){this._simpleTips&&this._simpleTips.parent&&this._simpleTips.parent.removeChild(this._simpleTips)},e.prototype.setData=function(t,e,n){this._shopID!=e?this._isReset=!0:this._isReset=!1,this._shopType=t,this._shopID=e,this._shopItemList=n,this._currShopItemList=n},e.prototype.reset=function(){this.container.reset(this._isReset);for(var t=0;t<this._index;t++){this._itemList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this._index=0},e.prototype.update=function(){if(this.init){var t=xself;this.reset();var e="商店",n=0,i="兑换";if(this._shopType==ShopType.SUB_SHOP_COMBIN?(e=GameText.STR_SHOP_COMBIN,i=GameText.STR_COMBIN):this._shopType==ShopType.SUB_SHOP_INTEGRAL?(e=GameText.STR_SHOP_INTEGRAL,n=MoneyViewOther.MoneyType_integray):this._shopType==ShopType.SUB_SHOP_ARENA?(e=GameText.STR_SHOP_ARENA,n=MoneyViewOther.MoneyType_arena):this._shopType==ShopType.SUB_SHOP_SKYARENA?(e=GameText.STR_SHOP_SKYARENA,n=MoneyViewOther.MoneyType_sky_arena):this._shopType==ShopType.SUB_SHOP_PETCOMPOSITE?(e=GameText.STR_SHOP_PETCOMPOSITE,i=GameText.STR_COMBIN):this._shopType==ShopType.SUB_SHOP_ENCHANT?(e=GameText2.STR_ENCHANT_SHOP,i=GameText.STR_COMBIN):this._shopType==ShopType.SUB_SHOP_EQ_UPGRADE?(e=GameText2.STR_EQ_UPGRADE_SHOP,i=GameText2.STR_EQ_UPGRADE):this._shopType==ShopType.SUB_SHOP_SELL?(e=SellHandler.shopName,i=GameText.STR_BUY):this._shopType==ShopType.SUB_SHOP_ENCHAT_SELL?(e=SellHandler.shopName,i=GameText2.STR_ENCHANT_SHOP_CHOICE):this._shopType==ShopType.SUB_SHOP_ENCHAT_EQUIP&&(e=GameText2.STR_ENCHANT_SELL_EQUIP,i=GameText2.STR_ENCHANT),this.label_title.text=e,this.btn_action.label=i,0==n?(this.moneyViewOther.visible=!1,this.moneyView.visible=!0,this.moneyView.setData(t)):(this.moneyView.visible=!1,this.moneyViewOther.visible=!0),this._itemList=[],this._currShopItemList&&this._currShopItemList.length>0)for(var o=0;o<this._currShopItemList.length;o++){var a=this._currShopItemList[o];if(a)this.getItem().setShopItem(a,!(this._shopType==ShopType.SUB_SHOP_ENCHAT_EQUIP))}this.setPosition(),this.onSelectItem(this._itemList[this._selectIndex]),this._shopType==ShopType.SUB_SHOP_PETCOMPOSITE&&(this._isInputSearchName||(this.search_name.text=GameText.getText(GameText.TI_SEARCH_NAME)),this.search_name.addEventListener(egret.Event.FOCUS_IN,this.searchNameFocusIn,this),ButtonUtils.addTouchEvent(this.btn_search,this.onBtnSearch,this))}},e.prototype.searchNameFocusIn=function(t){this.search_name.addEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),this._isInputSearchName||(this.search_name.text="")},e.prototype.searchNameFocusOut=function(t){this.search_name.removeEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),this.search_name.text=this.search_name.text.trim(),""==this.search_name.text?(this._isInputSearchName=!1,this.search_name.text=GameText.getText(GameText.TI_SEARCH_NAME)):this._isInputSearchName=!0},e.prototype.onBtnSearch=function(){var t=!0;if(this._isInputSearchName){this._currShopItemList=[];for(var e=this.search_name.text,n=0,i=this._shopItemList.length;i>n;n++)this._shopItemList[n].name.search(e)>=0&&this._currShopItemList.push(this._shopItemList[n])}else t=this._shopItemList.length!=this._currShopItemList.length,this._currShopItemList=this._shopItemList;t&&(this._selectIndex=0,this.update())},e.prototype.setPosition=function(){var t=0,e=0;this.container.reset();for(var n=0,i=this._itemList.length;i>n;n++)n%2==0?(t=0,e=(n/2*45+1)*xhdRatio):t=152*xhdRatio,this.container.add(this._itemList[n],t,e);this._selectItem&&(this._selectItem.select=!0),this.container.update()},e.prototype.updateByItem=function(t){if(t&&this._selectItem)if(t.quantity<=0){var e=this._currShopItemList.indexOf(this._selectItem.shopItem);e>=0&&this._currShopItemList.splice(e,1),(e=this._itemList.indexOf(this._selectItem))>=0&&(this._index--,this._itemList[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList.splice(e,1),this._itemList.length<=0?this.onClose():this.onSelectItem(this._itemList[e]?this._itemList[e]:this._itemList[e-1]),this.setPosition())}else this._selectItem&&(this._selectItem.item.itemData=t,this.item.itemData=t)},e.prototype.updateMoney=function(){if(this.moneyView&&this.moneyView.visible&&this.moneyView.stage)this.moneyView.update();else if(this.moneyViewOther&&this.moneyViewOther.visible&&this.moneyViewOther.stage){var t=xself,e=0,n=0;this._shopType==ShopType.SUB_SHOP_INTEGRAL?(e=MoneyViewOther.MoneyType_integray,n=t.get(ModelConst.INTEGRAL)):this._shopType==ShopType.SUB_SHOP_ARENA?(e=MoneyViewOther.MoneyType_arena,n=t.arenaPoint):this._shopType==ShopType.SUB_SHOP_SKYARENA&&(e=MoneyViewOther.MoneyType_sky_arena,n=t.skyarenaPoint),this.moneyViewOther.setData(e,n),this.moneyViewOther.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new ShopListItem,nato.attachSkin(t),this._itemList[this._index]=t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._index++,t},e}(ComponentBase);__reflect(OtherShopPanel.prototype,"OtherShopPanel");var ShopHotItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_buy,this.onBtnBuy,this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_buy),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)},e.prototype.onBtnBuy=function(){this._data&&HotShop.buyHotShopItem(this._data)},e.prototype.onItemTouch=function(t){this._data&&AlertPanel.alertItem(this._data.item)},e.prototype.setData=function(t){this._data=t,this.update()},e.prototype.reset=function(){this.init},e.prototype.update=function(){if(this.init){if(null==this._data)return void(this.visible=!1);this.visible=!0,this.item.itemData=this._data.item,this.img_discount.visible=this._data.isDiscount,this.label_level.text="LV"+this._data.item.reqLv,this._data.item.name.length>=8?this.label_name.size=12*xhdRatio:this.label_name.size=13*xhdRatio,this.label_name.textFlow=Tool.convertDescToTextFlow(this._data.item.getNameInfo()),this.label_part.textFlow=Tool.convertDescToTextFlow("部位：/cffffff"+Define.getItemTypeString(this._data.item.type)+"/p");var t=this._data.price;this._data.isDiscount&&(t=Math.floor(t/2));var e="价格：/cffffff"+t+"/p";this.label_price.textFlow=Tool.convertDescToTextFlow(e);var n=this._data.isCoin,i=n?this.moneyIcon3:this.moneyIcon1;this.moneyIcon1.visible=!n,this.moneyIcon3.visible=n,i.x=this.label_price.x+TextFieldUtils.getTextWidth(e,this.label_price.size,this.label_price.fontFamily)+3*xhdRatio}},e}(ComponentBase);__reflect(ShopHotItem.prototype,"ShopHotItem");var ShopHotPanel=function(t){function e(){var e=t.call(this)||this;return e._endTime=-1,e._isAddTicker=!1,e._count=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5]),ButtonUtils.addTouchEvent(this.btn_refresh,this.onBtnRefresh,this),ButtonUtils.addTouchEvent(this.btn_buyAll,this.onBtnBuyAll,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_refresh),ButtonUtils.removeTouchEvent(this.btn_buyAll),this.stopTicker(),this._endTime=0},e.prototype.onBtnRefresh=function(){var t="是否花费 /cffcc00刷新符*"+HotShop.refreshCount+"/p 刷新商品列表？";AlertPanel.alert("温馨提示",t,(function(){HotShop.refreshHotShop()}),this)},e.prototype.onBtnBuyAll=function(){AlertPanel.alert("温馨提示","是否购买当前所有物品？",(function(){HotShop.buyAll()}),this)},e.prototype.startTicker=function(){this._isAddTicker||(nato.WorldTicker.instance.register(this.logic,this),this._count=0,this._isAddTicker=!0)},e.prototype.stopTicker=function(){this._isAddTicker&&(nato.WorldTicker.instance.unregister(this.logic,this),this._count=0,this._isAddTicker=!1)},e.prototype.reset=function(){if(this.init){for(var t=0;t<this._itemList.length;t++){this._itemList[t].visible=!1}this.label_time.text="",this.label_refreshCost.text=""}},e.prototype.update=function(){if(this.init){this._endTime=HotShop.refreshTime,this.logic(1e3),this.label_refreshCost.text="刷新符*"+HotShop.refreshCount;for(var t=HotShop.getItemList(),e=0;e<this._itemList.length;e++){var n=this._itemList[e],i=null;t&&(i=t[e]),n.setData(i)}}},e.prototype.updateMoney=function(){this.init&&this.moneyView.update()},e.prototype.logic=function(t){if(!(this._endTime<=0||(this._count+=t,this._count<1e3))){this._count=0;var e=Tool.getTimeStrBySec(this._endTime);this.label_time.text="自动刷新："+e,Tool.isNullText(e)&&this.checkTime()}},e.prototype.checkTime=function(){HotShop.checkIsRefreshTime()&&(HotShop.getHotShopData(this.update,this),this._endTime=-1)},e}(ComponentBase);__reflect(ShopHotPanel.prototype,"ShopHotPanel");var ShopItemBuyPanel=function(t){function e(){var e=t.call(this)||this;return e._moneyType=0,e._price=0,e._count=1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOK,this),this.numberEditView.addEventListener(egret.Event.CHANGE,this.onNumberChange,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_ok),this.numberEditView.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this)},e.prototype.onClose=function(){PanelManager.closeShopItemBuyPanel()},e.prototype.onBtnOK=function(){ShopItem.doItemShopBuyMsg(xself,this._shopItem,this._count)},e.prototype.onNumberChange=function(){this._count=this.numberEditView.value,this.update()},e.prototype.setData=function(t,e){void 0===e&&(e=1),this._shopItem=t,this._count=e},e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&null!=this._shopItem&&(this.item.itemData=this._shopItem,this.label_itemName.textFlow=Tool.convertDescToTextFlow(this._shopItem.getNameInfo()),this._shopItem.money1>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY1),this._moneyType=ModelConst.MONEY1,this._price=this._shopItem.money1):this._shopItem.money2>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY2),this._moneyType=ModelConst.MONEY2,this._price=this._shopItem.money2):this._shopItem.money3>0&&(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY3),this._moneyType=ModelConst.MONEY3,this._price=this._shopItem.money3),this.numberEditView.value=this._count,this.updateCount())},e.prototype.updateCount=function(){if(this.init){var t=this._price*this._count,e=xself.get(this._moneyType);this.label_price.textColor=e>=t?16777215:16711680,this.label_price.text=t+""}},e}(ComponentBase);__reflect(ShopItemBuyPanel.prototype,"ShopItemBuyPanel");var ShopListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e._isShowMoney=!0,e.cacheAsBitmap=!0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.item.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this.select=!1},e.prototype.onItemTouch=function(t){this._itemData?AlertPanel.alertItem(this._itemData,"left"):this._shopItem&&null==this._shopItem.petComsiteInfo&&AlertPanel.alertItem(this._shopItem,"left")},e.prototype.setItemData=function(t){this.reset(),this._itemData=t,this.update()},e.prototype.setShopItem=function(t,e){void 0===e&&(e=!0),this.reset(),this._shopItem=t,this._isShowMoney=e,this.update()},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData?this._itemData:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shopItem",{get:function(){return this._shopItem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.source=this._select?"select_square"+(xhd?"_hd":"_sd"):null)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._itemData=null,this._shopItem=null,this.select=!1},e.prototype.update=function(){this.init&&(this._shopItem?(this.item.itemData=this._shopItem,this.label_name.textFlow=Tool.convertDescToTextFlow(this._shopItem.getNameInfo()),this.img_moneyIcon.visible=!0,this.img_moneyBg.visible=!0,this._isShowMoney&&null==this._shopItem.petComsiteInfo?this._shopItem.integral>0?(this.img_moneyIcon.source="money_ji"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.integral.toString()):this._shopItem.arenaPoint>0?(this.img_moneyIcon.source="money_jing"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.arenaPoint.toString()):this._shopItem.skyarenaPoint>0?(this.img_moneyIcon.source="money_zhan"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.skyarenaPoint.toString()):this._shopItem.money1>0?(this.img_moneyIcon.source="gold_square"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.money1.toString()):this._shopItem.money2>0?(this.img_moneyIcon.source="gold_leaf"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.money2.toString()):this._shopItem.money3>0?(this.img_moneyIcon.source="gold_coin"+(xhd?"_hd":"_sd"),this.label_price.text=this._shopItem.money3.toString()):(this.img_moneyIcon.source="gold_coin"+(xhd?"_hd":"_sd"),this.label_price.text="0"):(this.img_moneyIcon.visible=!1,this.img_moneyBg.visible=!1,this.label_price.text="")):this._itemData?(this.img_moneyIcon.visible=!0,this.img_moneyBg.visible=!0,this.item.itemData=this._itemData,this.img_moneyIcon.source="gold_coin"+(xhd?"_hd":"_sd"),this._itemData.price>0?this.label_price.text=this._itemData.price.toString():this.label_price.text="0",this.label_name.textFlow=Tool.convertDescToTextFlow(this._itemData.getNameInfo())):(this.item.itemData=null,this.item.id=0,this.label_name.text="",this.label_price.text=""))},e}(ComponentBase);__reflect(ShopListItem.prototype,"ShopListItem");var ShopListPanel=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=-1,e._shopID=-1,e._isClearAll=!1,e._defaultSelectItemID=-1,e._index=0,e._itemList=new Array,e._actionList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._actionBtnList&&(this._actionBtnList=[this.btn_do0,this.btn_do1,this.btn_do2]),ButtonUtils.addTouchEvent(this.btn_do0,this.onBtnDo0,this),ButtonUtils.addTouchEvent(this.btn_do1,this.onBtnDo1,this),ButtonUtils.addTouchEvent(this.btn_do2,this.onBtnDo2,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_do0),ButtonUtils.removeTouchEvent(this.btn_do1),ButtonUtils.removeTouchEvent(this.btn_do2)},e.prototype.onBtnDo0=function(){var t=this._actionList[0];this.onDoAction(t)},e.prototype.onBtnDo1=function(){var t=this._actionList[1];this.onDoAction(t)},e.prototype.onBtnDo2=function(){var t=this._actionList[2];this.onDoAction(t)},e.prototype.onDoAction=function(t){null!=this._selectItem&&(this._tabIndex==ShopScene.TAB_INDEX_BUY?t==e.Action_buy?ShopItem.doItemShopBuyMsg(xself,this._selectItem.shopItem,1):t==e.Action_buy_1&&PanelManager.openShopItemBuyPanel(this._selectItem.shopItem):this._tabIndex==ShopScene.TAB_INDEX_SELL&&(t==e.Action_sell||t==e.Action_sell_1?ShopItem.doItemshopSellMsg(xself,this._selectItem.itemData,1):t==e.Action_sell_all&&ShopItem.doItemshopSellMsg(xself,this._selectItem.itemData,this._selectItem.itemData.quantity,!0)))},e.prototype.onItemTouch=function(t){var e;t.target instanceof ShopListItem?e=t.target:t.target.parent instanceof ShopListItem&&(e=t.target.parent),e&&(e.itemData?this.onSelectSell(e):e.shopItem&&this.onSelectShop(e))},e.prototype.onSelectSell=function(t){null!=t&&null!=t.itemData&&(this._selectItem&&(this._selectItem.select=!1),this._selectItem=t,this._selectItem.select=!0,this.item.itemData=t.itemData,this.label_itemName.textFlow=Tool.convertDescToTextFlow(t.itemData.getNameInfo()),this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY3),this.label_price.text=t.itemData.price.toString(),this._actionList=[],this.hideActionBtns(),this.clearSpr(),t.itemData.stackNum>1?(this.btn_do0.visible=!0,this.btn_do0.label="卖1个",this._actionList.push(e.Action_sell_1),this.btn_do1.visible=!0,this.btn_do1.label="卖全部",this._actionList.push(e.Action_sell_all),this.group_selectItem.x=14*xhdRatio):(this.btn_do0.visible=!0,this.btn_do0.label="卖出",this._actionList.push(e.Action_sell),t.itemData.isCanEquip()?(this.group_selectItem.x=100*xhdRatio,this._playerSprite=Player.getCompareSprite(xself,t.itemData),this._playerSprite.setScale(xhd?1.5:1),this.groupRole.addChild(this._playerSprite)):this.group_selectItem.x=14*xhdRatio))},e.prototype.onSelectShop=function(t){null!=t&&null!=t.shopItem&&(this._selectItem&&(this._selectItem.select=!1),this._selectItem=t,this._selectItem.select=!0,this.item.itemData=t.shopItem,this.label_itemName.textFlow=Tool.convertDescToTextFlow(t.shopItem.getNameInfo()),t.shopItem.money1>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY1),this.label_price.text=t.shopItem.money1.toString()):t.shopItem.money2>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY2),this.label_price.text=t.shopItem.money2.toString()):t.shopItem.money3>0&&(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY3),this.label_price.text=t.shopItem.money3.toString()),this._actionList=[],this.hideActionBtns(),this.clearSpr(),t.shopItem.stackNum>1?(this.btn_do0.visible=!0,this.btn_do0.label="购买",this._actionList.push(e.Action_buy_1),this.group_selectItem.x=14*xhdRatio):(this.btn_do0.visible=!0,this.btn_do0.label="购买",this._actionList.push(e.Action_buy),t.shopItem.isCanEquip()?(this.group_selectItem.x=100*xhdRatio,this._playerSprite=Player.getCompareSprite(xself,t.shopItem),this._playerSprite.setScale(xhd?1.5:1),this.groupRole.addChild(this._playerSprite)):this.group_selectItem.x=14*xhdRatio))},e.prototype.clearSpr=function(){this.groupRole.removeChildren(),this._playerSprite=null},e.prototype.setData=function(t,e,n){void 0===n&&(n=-1),this._shopID=t,this._shopDataList=e,this._defaultSelectItemID=n,this._selectItem=null},e.prototype.setTabIndex=function(t){this._tabIndex=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.hideActionBtns=function(){this.btn_do0.visible=!1,this.btn_do1.visible=!1,this.btn_do2.visible=!1},e.prototype.update=function(){if(this.init)if(this.reset(),this.moneyView.setData(xself),this.moneyView.update(),this._tabIndex==ShopScene.TAB_INDEX_BUY){if(null==this._shopDataList||0==this._shopDataList.length)return;for(var t=0,e=0,n=0,i=0;i<this._shopDataList.length;i++){var o=this._shopDataList[i];if(o)n%2==0?(t=0,e=n/2*45*xhdRatio+1*xhdRatio):t=152*xhdRatio,(l=this.getItem()).setShopItem(o),this.container.add(l,t,e),n++}if(this.container.update(),null==this._selectItem){var a=this.container.list;if(a&&a.length>0)if(this._defaultSelectItemID>0)for(i=0;i<a.length;i++){if((l=a[i])&&l.shopItem&&l.shopItem.id==this._defaultSelectItemID){this.onSelectShop(l);break}}else{(l=a[0])&&l.shopItem&&this.onSelectShop(l)}}else this.onSelectShop(this._selectItem)}else if(this._tabIndex==ShopScene.TAB_INDEX_SELL){var r=xself;if(null==r||null==r.bag)return;var s=r.bag.store;for(t=0,e=0,n=0,i=PlayerBag.BAG_START;i<r.bag.bagEnd;i++){var l,_=s[i];if(_&&!(_.price<=0))n%2==0?(t=0,e=n/2*45*xhdRatio+1*xhdRatio):t=152*xhdRatio,(l=this.getItem()).setItemData(_),this.container.add(l,t,e),n++}if(this.container.update(),null==this._selectItem)(l=this._itemList[0])&&l.itemData&&this.onSelectSell(l);else this.onSelectSell(this._selectItem)}},e.prototype.updateMoney=function(){this.init&&this.moneyView.update()},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new ShopListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.Action_buy=1,e.Action_buy_1=2,e.Action_buy_30=3,e.Action_buy_99=4,e.Action_sell=5,e.Action_sell_1=6,e.Action_sell_all=7,e}(ComponentBase);__reflect(ShopListPanel.prototype,"ShopListPanel");var ShopScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._isAutoSell=!1,e._shopID=-1,e._defaultSelectItemID=-1,e._tabIndexList=[0,1,2],e}return __extends(e,t),e.prototype.onAddToStage=function(n){t.prototype.onAddToStage.call(this,n),null==this._tabBtnList&&(this._tabBtnList=[this.tabBtn_hot,this.tabBtn_buy,this.tabBtn_sell]);for(var i=0;i<this._tabBtnList.length;i++){this._tabBtnList[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.listPanel.setData(this._shopID,this._shopDataList,this._defaultSelectItemID),this._isAutoSell=!0,e.isOpenSell?(this._tabIndex=e.TAB_INDEX_SELL,e.isOpenSell=!1):-1!=this._tabIndexList.indexOf(e.TAB_INDEX_HOT)?this._tabIndex=e.TAB_INDEX_HOT:this._tabIndex=e.TAB_INDEX_BUY,this.initTabBtns(),this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.initTabBtns=function(){this.group_tabBtns.removeChildren();for(var t=0;t<this._tabIndexList.length;t++){var e=this._tabIndexList[t],n=this._tabBtnList[e];n.x=55*t*xhdRatio,this.group_tabBtns.addChild(n)}this.group_tabBtns.addChild(this.closeBtn)},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_HOT?(this.addChild(this.hotPanel),this.hotPanel.startTicker()):(this._tabIndex==e.TAB_INDEX_BUY||this._tabIndex==e.TAB_INDEX_SELL)&&(this.listPanel.setTabIndex(this._tabIndex),this.addChild(this.listPanel)),this._tabIndex==e.TAB_INDEX_SELL&&this._isAutoSell&&(AutoSell.openAutoSell(!0),this._isAutoSell=!1)},e.prototype.setData=function(t,n,i,o){void 0===i&&(i=-1),void 0===o&&(o=!1),this._shopID=t,this._shopDataList=n,this._defaultSelectItemID=i,o&&xself.getLevel()>=15?this._tabIndexList=[e.TAB_INDEX_HOT,e.TAB_INDEX_BUY,e.TAB_INDEX_SELL]:this._tabIndexList=[e.TAB_INDEX_BUY,e.TAB_INDEX_SELL]},e.prototype.reset=function(){this.init},e.prototype.removeAllPanel=function(){this.hotPanel.parent&&this.hotPanel.parent.removeChild(this.hotPanel),this.listPanel.parent&&this.listPanel.parent.removeChild(this.listPanel)},e.prototype.update=function(){this.init&&(this.hotPanel.stage?this.hotPanel.update():this.listPanel.stage&&this.listPanel.update())},e.prototype.updateMoney=function(){this.init&&(this.listPanel.updateMoney(),this.hotPanel.updateMoney())},e.TAB_INDEX_HOT=0,e.TAB_INDEX_BUY=1,e.TAB_INDEX_SELL=2,e.isOpenSell=!1,e}(ComponentBase);__reflect(ShopScene.prototype,"ShopScene");var ShopType=function(){function t(){}return t.SUB_SHOP_COMBIN=0,t.SUB_SHOP_INTEGRAL=1,t.SUB_SHOP_ARENA=2,t.SUB_SHOP_SKYARENA=3,t.SUB_SHOP_PETCOMPOSITE=4,t.SUB_SHOP_ENCHANT=5,t.SUB_SHOP_EQ_UPGRADE=6,t.SUB_SHOP_BATTLE=7,t.SUB_SHOP_SELL=8,t.SUB_SHOP_ENCHAT_SELL=9,t.SUB_SHOP_ENCHAT_EQUIP=10,t}();__reflect(ShopType.prototype,"ShopType");var SkillDescSimple=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e.touchThrough=!0,e._shp=new egret.Shape,e.addChild(e._shp),e._txt=new egret.TextField,e._txt.width=200*xhdRatio,e._txt.x=5*xhdRatio,e._txt.y=5*xhdRatio,e._txt.fontFamily="黑体",e._txt.size=15*xhdRatio,e.addChild(e._txt),e.x=55*xhdRatio,e}return __extends(e,t),e.prototype.update=function(t,e,n){this._txt.textFlow=t,this._txt.height=this._txt.textHeight+5*xhdRatio;var i=this._txt.width+10*xhdRatio,o=this._txt.height+10*xhdRatio;this._shp.graphics.clear(),this._shp.graphics.beginFill(0,.8),this._shp.graphics.drawRect(0,0,i,o);var a=!1;return e+this._txt.height>n?(this._shp.graphics.moveTo(i/2-10,o),this._shp.graphics.lineTo(i/2,o+10),this._shp.graphics.lineTo(i/2+10,o),a=!0):(this._shp.graphics.moveTo(i/2-10,0),this._shp.graphics.lineTo(i/2,-10),this._shp.graphics.lineTo(i/2+10,0),a=!1),this._shp.graphics.endFill(),this.height=this._shp.height,a},e}(eui.Group);__reflect(SkillDescSimple.prototype,"SkillDescSimple");var SkillLearnPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_learn,this.onBtnLearn,this),ButtonUtils.addTouchEvent(this.btn_return,this.onBtnReturn,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_learn),ButtonUtils.removeTouchEvent(this.btn_return)},e.prototype.onBtnLearn=function(){if(0==SafeLock.doSafeLockVerify())return null;if(null==xself||null==this._skill)return null;var t=this;Model.checkEnoughMoney(this._skill.money1,this._skill.money2,this._skill.money3,(function(){var e=MsgHandler.createLearnSkill(this._skillShopId,this._skill);nato.Network.sendCmd(e,t.onLearn_callback,t),PanelManager.openWaitForServer()}),this)},e.prototype.onLearn_callback=function(t){PanelManager.closeWaitForServer();var e=t.getByte();if(0>e)AlertPanel.errorMessage(t.getString());else{if(1==e)return xworld.openShopSkill(this._skillShopId),void AlertPanel.alertCommon(GameText.STR_COUNTRY_PRICE_ADUST);if(0==e){var n=(t.getInt(),t.getInt()),i=t.getInt(),o=t.getInt(),a=t.getInt(),r=null;t.getByte()>0&&(r=Skill.fromShopBytes(t));var s=Define.getTypeBySkillShopID(this._skillShopId),l=xself;s==Define.SKILL_TYPE_PET&&(l=l.getPet()),l.sp=n,xself.setPlayerMoney(i,o,a,null);var _=this._skill;if(1==t.getBoolean()&&((_=Skill.fromBytes(t)).addLevel=t.getByte()),null!=_){if(l.learnSkill(_),l.checkHPMP(),null!=r){if(r.id!=_.id)return;this.setData(this._skillShopId,r)}else(r=this._skill).level=this._skill.maxLearnLevel,PanelManager.closeSkillLearnPanel();var h=PanelManager.getPanel(SkillShopPanel);h&&h.stage&&(h.updateNextSkill(r),h.moneyView.update())}}}},e.prototype.onBtnReturn=function(){PanelManager.closeSkillLearnPanel()},e.prototype.setData=function(t,e){this._skillShopId=t,this._skill=e,this.update()},Object.defineProperty(e.prototype,"skill",{get:function(){return this._skill},enumerable:!0,configurable:!0}),e.prototype.reset=function(){},e.prototype.update=function(){if(this.init&&null!=this._skill){var t=xself;Define.getTypeBySkillShopID(this._skillShopId)==Define.SKILL_TYPE_PET&&(t=t.getPet());var e=Tool.convertDescToTextFlow(this._skill.getDesc(!0,t));this.label_desc.textFlow=e,this.label_desc.height=this.label_desc.textHeight,this.height=this.label_desc.y+this.label_desc.height+100*xhdRatio,this._skill.level>1?this.btn_learn.label="学习"+this._skill.level+"级":this.btn_learn.label="开始学习"}},e}(ComponentBase);__reflect(SkillLearnPanel.prototype,"SkillLearnPanel");var SkillRecommend=function(){function t(){}return t.initData=function(){null==this._data&&(this._data={},this._data[Define.ITEM_TYPE_WEAPON_ONEHAND_SWORD]="长空十字剑,基础剑法,逍遥剑法,九阳神功,三寸真元劲",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_STAFF]="流星爆,神秘学,魔法熟练,法术回路,魔力增幅",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_BOW]="扰乱射击,远程武器专精,攻守兼备,精确打击,先制攻击",this._data[Define.ITEM_TYPE_WEAPON_ONEHAND_CROSSBOW]="扰乱射击,远程武器专精,攻守兼备,精确打击,射击姿态",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_CROSSBOW]="扰乱射击,远程武器专精,攻守兼备,精确打击,射击姿态",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_HEAVY]="英勇打击,重型武器专精,攻守兼备,精确打击,战斗怒吼",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD]="万剑诀,基础剑法,逍遥剑法,九阳神功,三寸真元劲被动武器大师,攻守兼备,武器娴熟,英勇打击,战斗怒吼",this._data[Define.ITEM_TYPE_WEAPON_ONEHAND_HAND]="法力冲击,法器使用,神器专精,元素精通,生命陷落",this._data[Define.ITEM_TYPE_NULL]="火云掌,基础掌法,两仪八卦掌,九阳神功,三寸真元劲",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE]="天翔龙闪,基础刀法,飞天御剑流,九阳神功,虎伏绝刀势",this._data[Define.ITEM_TYPE_WEAPON_ONEHAND_BLADE]="绝情双刀,基础刀法,飞天御剑流,九阳神功,虎伏绝刀势",this._data[Define.ITEM_TYPE_ONE_BLADE]="血光刀气,基础刀法,飞天御剑流,九阳神功,虎伏绝刀势",this._data[Define.ITEM_TYPE_ONE_SWORD]="九阳神剑,基础剑法,逍遥剑法,九阳神功,三寸真元劲",this._data[Define.ITEM_TYPE_WEAPON_TWOHAND_LANCE]="冲锋,长柄武器专精,攻守兼备,精通重击,战斗怒吼")},t.getMyWeaponType=function(){if(null==xself||null==xself.bag)return-1;var t=xself.bag.getItem(PlayerBag.WEAPON_LEFT_POS),e=xself.bag.getItem(PlayerBag.WEAPON_RIGHT_POS);if(null!=t&&null!=e)return t.type;if(null!=t||null!=e){var n=t;return null==n&&(n=e),n.type==Define.ITEM_TYPE_WEAPON_TWOHAND_BLADE?Define.ITEM_TYPE_ONE_BLADE:n.type==Define.ITEM_TYPE_WEAPON_TWOHAND_SWORD?Define.ITEM_TYPE_ONE_SWORD:n.type}return-1},t.getSkillRecommendData=function(t){var e=t+"";return this._data&&this._data[e]?this._data[e]:null},t.checkIsRecommendSkill=function(t){if(null!=t&&null!=t.name){var e=this.getMyWeaponType(),n=this.getSkillRecommendData(e);return null!=n&&-1!=n.indexOf(t.name)}},t.checkIsRecommendByDetail=function(t,e){return!!(t&&t.name&&e&&-1!=e.indexOf(t.name))},t.getMyRecommendSkill=function(){var t=this.getMyWeaponType();return this.getSkillRecommendData(t)},t}();__reflect(SkillRecommend.prototype,"SkillRecommend");var SkillShopItem=function(t){function e(){var e=t.call(this)||this;return e._isPet=!1,e._isRecommend=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_action,this.onBtnAction,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_action)},e.prototype.onBtnAction=function(){this._skill&&PanelManager.openSkillLearnPanel(this._skillShopId,this._skill)},e.prototype.setData=function(t,e,n,i){this._skillShopId=t,this._skill=e,this._isPet=n,this._isRecommend=i,this.update()},Object.defineProperty(e.prototype,"skill",{get:function(){return this._skill},set:function(t){this._skill=t},enumerable:!0,configurable:!0}),e.prototype.reset=function(){},e.prototype.update=function(){if(this.init){var t=xself;if(Define.getTypeBySkillShopID(this._skillShopId)==Define.SKILL_TYPE_PET&&(t=t.getPet()),this._skill&&null!=t){var e=t.getSkillLevelByID(this._skill.id),n=!0;if((t.getLevel()<this._skill.reqLevel||this._skill.skillWeapon>0&&0==Skill.isValidSkillWeapon(xself.get(ModelConst.LEFT_WEAPON_TYPE),xself.get(ModelConst.RIGHT_WEAPON_TYPE),this._skill))&&(n=!1),this.label_name.textColor=n?16763904:16711680,this.label_name.text=this._skill.name,e>=this._skill.maxLearnLevel)this.label_maxLevel0.visible=!0,this.label_maxLevel1.visible=!0,this.label_maxLevel1.text=this._skill.level+"级",this.label_skillPointDesc.visible=!1,this.label_skillPoint.visible=!1,this.label_money.visible=!1,this.img_moneyIcon.visible=!1,this.btn_action.visible=!1;else{if(this.label_maxLevel0.visible=!1,this.label_maxLevel1.visible=!1,this.label_skillPointDesc.visible=!0,this.label_skillPoint.visible=!0,this.label_money.visible=!0,this.img_moneyIcon.visible=!0,this.btn_action.visible=!0,t.get(ModelConst.SP)>=this._skill.sp?this.label_skillPoint.textColor=16777215:this.label_skillPoint.textColor=16711680,this.label_skillPoint.text=this._skill.sp.toString(),this._skill.money1>0)xself.get(ModelConst.MONEY1)>=this._skill.money1?this.label_money.textColor=16777215:this.label_money.textColor=16711680,this.label_money.text=this._skill.money1.toString(),this.img_moneyIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY1);else if(this._skill.money2>0){xself.get(ModelConst.MONEY2)>=this._skill.money2?this.label_money.textColor=16777215:this.label_money.textColor=16711680,this.label_money.text=this._skill.money2.toString(),this.img_moneyIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY2)}else{xself.get(ModelConst.MONEY3)>=this._skill.money3?this.label_money.textColor=16777215:this.label_money.textColor=16711680,this.label_money.text=this._skill.money3.toString(),this.img_moneyIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY3)}this.btn_action.label=e+"/"+this._skill.maxLearnLevel}this.img_icon.source=this._skill.getSkillTypeIcon(),this.label_recommend.visible=this._isRecommend;var i="/cFFCC00范围:/p";i+=this._skill.type==Define.SKILL_TYPE_PASSIVE?PowerString.makeColorString("被动",Define.getSkillAreaColor(this._skill.area)):PowerString.makeColorString(Define.getSkillAreaString(this._skill.area),Define.getSkillAreaColor(this._skill.area)),this.label_area.textFlow=Tool.convertDescToTextFlow(i)}}},e}(ComponentBase);__reflect(SkillShopItem.prototype,"SkillShopItem");var SkillShopPanel=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._skillShopId=0,e._isShowAllShop=!1,e._index=0,e._isPet=!1,e._isTouchHide=!1,e._itemList=[],e._simpleDesc=new SkillDescSimple,e._simpleWeaponDesc=new SkillWeaponIconDesc,nato.attachSkin(e._simpleDesc),e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._tabBtnList&&(this._tabBtnList=[this.tabBtn_0,this.tabBtn_1,this.tabBtn_2]);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_info,this.onBtnInfo,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouchBegin,this),this._tabIndex=0,this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_info),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouchBegin,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnInfo=function(){var t=e.Explain_info+e.Explain_type[this._tabIndex];AlertPanel.alertTipsCommon(t)},e.prototype.onStageTouchBegin=function(t){this._simpleDesc&&this._simpleDesc.parent&&(this.hideSimpleDesc(),t.stopImmediatePropagation(),this._isTouchHide=!0),this._simpleWeaponDesc&&this._simpleWeaponDesc.parent&&(this._simpleWeaponDesc.parent.removeChild(this._simpleWeaponDesc),t.stopImmediatePropagation(),this._isTouchHide=!0)},e.prototype.onItemTouch=function(t){var e;if(this._isTouchHide)this._isTouchHide=!1;else if(t.target instanceof SkillShopItem?e=t.target:t.target.parent instanceof SkillShopItem&&(e=t.target.parent),null!=e)if(e&&e.skill)if(t.target==e.img_icon){var n;n=e.skill.skillWeapon>0?Define.getSkillWeaponString(e.skill.skillWeapon):"通用",this._simpleWeaponDesc.update(n);var i=e.localToGlobal(0,e.height/2).y;i-=this._simpleWeaponDesc.height/2,this._simpleWeaponDesc.y=i,this.addChild(this._simpleWeaponDesc)}else{if(t.target==e.btn_action)return;this._curSelectItem=e;var o=t.stageY,a=this._simpleDesc.update(Tool.convertDescToTextFlow(e.skill.getDesc(!0,this._player)),o,this.container.height+this.container.y);this.addChild(this._simpleDesc);i=e.localToGlobal(0,0).y;this._simpleDesc.y=a?-this._simpleDesc.height+10*xhdRatio+i:35*xhdRatio+i}else this.hideSimpleDesc()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.updateTab=function(){this._curSelectItem=null,this.hideSimpleDesc(),ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this._isShowAllShop?this.updateShowAll(!0):this.update(!0)},e.prototype.show=function(t,e){this._skillShopId=t,this._skillList=e,this._isShowAllShop=!1,this._showAllShopIDList=null,this._curShowData=null,this._curShowList=null,this.updateTab()},e.prototype.showAll=function(t){this._skillShopId=-1,this._skillList=null,this._isShowAllShop=!0,this._showAllShopIDList=t,this._curShowData={},this._curShowList=null,this.updateTab()},e.prototype.reset=function(t){void 0===t&&(t=!1),this.init&&(this.hideSimpleDesc(),this.container.reset(t),this._index=0)},e.prototype.hideSimpleDesc=function(){this._simpleDesc.parent&&this._simpleDesc.parent.removeChild(this._simpleDesc)},e.prototype.update=function(t){if(void 0===t&&(t=!1),this.init&&(this.reset(t),null!=this._skillList&&0!=this._skillList.length)){this.updateOther();var n,i,o=[],a=0,r=this._skillList.length;for(a=0;r>a;a++)(n=this._skillList[a])&&(this._tabIndex==e.TAB_INDEX_ZHUDONG&&n.type==Define.SKILL_TYPE_ACTIVE||this._tabIndex==e.TAB_INDEX_BEIDONG&&n.type==Define.SKILL_TYPE_PASSIVE||this._tabIndex==e.TAB_INDEX_ZIDONG&&n.type==Define.SKILL_TYPE_ROUND)&&o.push(n);for(o.sort(this.sortSkill),a=0;a<o.length;a++)n=o[a],(i=this.getItem()).setData(this._skillShopId,n,this._isPet,e.checkIsRecommend(n)),this.container.add(i);this.container.update();var s="";o.length>0&&(n=o[0],s=this._player.getJob()==n.reqJob?"(本职)":"(跨职)"),this.label_jobType.text=s}},e.prototype.updateOther=function(){var t=!1,n=xself;Define.getTypeBySkillShopID(this._skillShopId)==Define.SKILL_TYPE_PET&&(n=n.getPet(),t=!0),this._player=n,this._isPet=t,e._sortRecommend=SkillRecommend.getMyRecommendSkill(),this.updateLearnSkillInfo(),this.moneyView.update()},e.prototype.updateLearnSkillInfo=function(){var t=0;if(null!=this._player.skillList&&this._player.skillList.length>0)for(var e=0;e<this._player.skillList.length;e++){var n=this._player.skillList[e];null==n||n.isAddSkill()||Define.isPetTalentSkill(n.id)||t++}var i=this._player.get(ModelConst.SP),o=[];o.push(TextFieldUtils.getTextFlowElement("剩余技能点:",16763904)),o.push(TextFieldUtils.getTextFlowElement(i.toString()+"点",16777215)),o.push(TextFieldUtils.getTextFlowElement("    已学技能:",16763904)),o.push(TextFieldUtils.getTextFlowElement(t+"/"+Skill.gAction,16777215)),this.label_status.textFlow=o},e.prototype.updateShowAll=function(t){if(void 0===t&&(t=!1),this.init&&(this.reset(t),0!=this._isShowAllShop&&null!=this._showAllShopIDList&&null!=this._curShowData)){this.updateOther();var n=this._showAllShopIDList[this._tabIndex];if(!(0>=n)){if(null==this._curShowData[n+""])return void this.reqSkillShopData(n);if(this._curShowList=this._curShowData[n+""],null!=this._curShowList&&-1!=n){var i,o,a=0;for(this._curShowList.sort(this.sortSkill),a=0;a<this._curShowList.length;a++)i=this._curShowList[a],(o=this.getItem()).setData(n,i,this._isPet,e.checkIsRecommend(i)),this.container.add(o);this.container.update();var r="";this._curShowList.length>0&&(i=this._curShowList[0],r=this._player.getJob()==i.reqJob?"(本职)":"(跨职)"),this.label_jobType.text=r}}}},e.prototype.reqSkillShopData=function(t){xworld.openShopSkill(t,this.reqSkillShopData_serverBack,this)},e.prototype.reqSkillShopData_serverBack=function(t){var e=this._showAllShopIDList[this._tabIndex];this._curShowData[e+""]=t,this.updateShowAll()},e.prototype.sortSkill=function(t,n){if(null==t||null==n)return 0;if(e.checkIsRecommend(t))return-1;if(e.checkIsRecommend(n))return 1;if(t.level>n.level)return-1;if(t.level<n.level)return 1;var i=Skill.isValidSkillWeapon(xself.get(ModelConst.LEFT_WEAPON_TYPE),xself.get(ModelConst.RIGHT_WEAPON_TYPE),t),o=Skill.isValidSkillWeapon(xself.get(ModelConst.LEFT_WEAPON_TYPE),xself.get(ModelConst.RIGHT_WEAPON_TYPE),n);return i&&!o?-1:o&&!i?1:t.skillWeapon<n.skillWeapon?-1:t.skillWeapon>n.skillWeapon?1:0},e.checkIsRecommend=function(t){return!(xself&&xself.getLevel()>=35)&&!!SkillRecommend.checkIsRecommendByDetail(t,e._sortRecommend)},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new SkillShopItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.prototype.updateNextSkill=function(t){if(null!=t){if(this._isShowAllShop)for(var e=0;e<this._curShowList.length;e++){if((n=this._curShowList[e])&&n.id==t.id){t.maxLearnLevel=n.maxLearnLevel,this._curShowList[e]=t;break}}else if(this._skillList)for(e=0;e<this._skillList.length;e++){var n;if((n=this._skillList[e])&&n.id==t.id){t.maxLearnLevel=n.maxLearnLevel,this._skillList[e]=t;break}}if(null!=this.container&&null!=this.container.list&&this.container.list.length>0){var i=this.container.list;for(e=0;e<i.length;e++){var o=i[e];if(o&&o.skill&&o.skill.id==t.id){o.skill=t,o.update();break}}}this.updateLearnSkillInfo()}},e.TAB_INDEX_ZHUDONG=0,e.TAB_INDEX_BEIDONG=1,e.TAB_INDEX_ZIDONG=2,e.Explain_info="所有职业的技能均可学习，学习非本职技能时，技能点与货币消耗翻倍。\n技能商店仅提供学习10级技能，后续等级需前往开放技能商店的国家学习。只能学习20个技能，请合理搭配你的技能组合。\n技能类别：战斗中一回合分为自动与主动两个阶段。\n主动阶段释放可选择主动技能。\n自动阶段按以设定好的顺序释放自动技能。",e.Explain_type=["\n\n主动技能：\n战斗中可自由选择已学习符合当前使用武器的主动技能进行释放。","\n\n被动技能：\n战斗中被动技能全程有效","\n\n自动技能：\n战斗中优先释放技能列表中设定的自动技能。"],e}(ComponentBase);__reflect(SkillShopPanel.prototype,"SkillShopPanel");var SkillWeaponIconDesc=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e.touchThrough=!0,e._shp=new egret.Shape,e._shp.x=-5*xhdRatio,e.addChild(e._shp),e._txt=new egret.TextField,e._txt.width=200*xhdRatio,e._txt.x=5*xhdRatio,e._txt.y=5*xhdRatio,e._txt.fontFamily="黑体",e._txt.size=15*xhdRatio,e.addChild(e._txt),e.x=45*xhdRatio,e}return __extends(e,t),e.prototype.update=function(t){this._txt.width=640,t.length>10?this._txt.text="武器需求:\n"+t:this._txt.text="武器需求:"+t,this._txt.width=this._txt.textWidth,this._txt.height=this._txt.textHeight;var e=this._txt.width+10*xhdRatio,n=this._txt.height+10*xhdRatio;this._shp.graphics.clear(),this._shp.graphics.beginFill(0,.8),this._shp.graphics.drawRoundRect(0+10*xhdRatio,0,e-10*xhdRatio,n,10*xhdRatio,10*xhdRatio),this._shp.graphics.moveTo(0,n/2),this._shp.graphics.lineTo(10*xhdRatio,n/2-8*xhdRatio),this._shp.graphics.lineTo(10*xhdRatio,n/2+8*xhdRatio),this._shp.graphics.lineTo(0,n/2),this._shp.graphics.endFill(),this.height=this._shp.height},e}(eui.Group);__reflect(SkillWeaponIconDesc.prototype,"SkillWeaponIconDesc");var SkyArenaScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_challenge,this.onChallenge,this),ButtonUtils.addTouchEvent(this.btn_close,this.onExit,this),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_challenge),ButtonUtils.removeTouchEvent(this.btn_close),ButtonUtils.removeTouchEvent(this.btn_chat)},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.setData=function(t,e){this.skyArena=t,this.update(e)},e.prototype.update=function(t){if(null!=this.skyArena){if(t){var e=new Player;e.setIcon1(this.skyArena.icon1),e.setIcon2(this.skyArena.icon2),e.setIcon3(this.skyArena.icon3),this.guardianSprite=GameSprite.cloneSprite(e.createSprite(!1)),this.guardianSprite.setScale(nato.mapRatio),this.guardian_model.removeChildren(),this.guardian_model.addChild(this.guardianSprite)}this.layer.text=Tool.manageString(GameText.STR_SKYARENA_NOW_LAYER_INFO,this.skyArena.tier+"")}},e.prototype.updatePlanInfo=function(t){var e=t.split("\n"),n=e[0].split("：")[1],i=e[1].split("：")[1],o=e[2].split("：")[1];this.challenge_progress.text=n,this.challenge_total_point.text=i,this.challenge_point.text=o},e.prototype.updateCDTime=function(t){this.refresh_time.text=t},e.prototype.updateDefierInfo=function(t){var e=t.split("\n"),n=e[0].split("：")[1],i=e[1].split("：")[1],o=e[2].split(":")[0]+"：",a=e[2].split(":")[1],r=e[3].split("：")[1];this.guardian_name.text=n,this.guardian_job.text=i,this.ranking.text=o,this.guardian_pos.text=a,this.guardian_kill_count.text=r},e.prototype.onChallenge=function(t){SkyArena.doSkyArenaPK()},e.prototype.onExit=function(t){SkyArena.doSkyArenaExit()},e}(ComponentBase);__reflect(SkyArenaScene.prototype,"SkyArenaScene");var SocietyAddFriendView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_ok,this.onBtnOK,this),ButtonUtils.addTouchEvent(this.btn_return,this.onBtnReturn,this),this.friendViewGroup=new eui.RadioButtonGroup,this.radioButton_id.group=this.friendViewGroup,this.radioButton_name.group=this.friendViewGroup,this.radioButton_id.value=ProtocolDefine.MAIL_SEND_ID,this.radioButton_name.value=ProtocolDefine.MAIL_SEND_NAME,this.radioButton_id.selected=!0,this.radioButton_id.label="ID",this.radioButton_name.label=GameText.STR_NAME,this.input_name.text="",this.input_name.prompt=GameText.STR_CMD_TYPE_ADD_FRIEND_INPUT},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_ok),ButtonUtils.removeTouchEvent(this.btn_return)},e.prototype.onBtnOK=function(){var t=parseInt(this.friendViewGroup.selectedValue),e=this.input_name.text;Tool.isNullText(e)?t==ProtocolDefine.MAIL_SEND_ID?AlertPanel.alertCommon(GameText.STR_FRIEND_INPUT_ID):AlertPanel.alertCommon(GameText.STR_FRIEND_INPUT_NAME):SocietyHandler.addFriend(t,e)},e.prototype.onBtnReturn=function(){this.visible=!1,this.input_name.text=GameText.STR_CMD_TYPE_ADD_FRIEND_INPUT},e}(ComponentBase);__reflect(SocietyAddFriendView.prototype,"SocietyAddFriendView");var NPCActionData=function(){function t(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),this.action=0,this.type=0,this.menu=t,this.action=e,this.data=n,this.type=i}return t.Type_mission=1,t.Type_off_mission=2,t}();__reflect(NPCActionData.prototype,"NPCActionData");var SocietyBlackListPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,OtherPlayerPanel.menuType=Menu.UI_INTO_BLACK_LIST,this.currListData=SocietyHandler.blackList},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),SocietyHandler.firstGetBlackList=!0},e.prototype.getList=function(){SocietyHandler.doRelationBlackListMsg(this.getListCallbackFunc,this)},e.prototype.getListCallbackFunc=function(e){SocietyHandler.blackList=[],e&&e.length>0&&(Array.prototype.push.apply(SocietyHandler.blackList,e),this.currListData=SocietyHandler.blackList),t.prototype.getListCallbackFunc.call(this,e)},e.prototype.update=function(e){void 0===e&&(e=!0),t.prototype.update.call(this,e),!SocietyHandler.firstGetBlackList&&e?this.showItem():(SocietyHandler.firstGetBlackList=!1,this.getList())},e.prototype.blackUpdate=function(){this.updateList(),this.currSeeItem&&SocietyHandler.removeList(SocietyHandler.blackList,this.currSeeItem.player,SocietyHandler.friendList)},e}(SocietyBasePanel);__reflect(SocietyBlackListPanel.prototype,"SocietyBlackListPanel");var SocietyFriendItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.label_name.wordWrap=!1,this.btn_look.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLook,this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnChat,this),this.player&&(this.player.isStatusBit(ModelConst.STATUS_VIP)||this.player.vipLevel>0?this.icon_vip.source=xitem.getItemIcon(39):this.icon_vip.source=xitem.getItemIcon(50))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.btn_look.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLook,this),this.btn_chat.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnChat,this)},e.prototype.onBtnLook=function(t){SocietyScene.from!=SocietyScene.OPEN_FROM_MAIL&&(PanelManager.getPanel(SocietyScene).getCurrentPanel().currSeeItem=this,ListPlayer.doSeePlayerMsg(this.player),t.stopImmediatePropagation())},e.prototype.onBtnChat=function(){SocietyScene.from!=SocietyScene.OPEN_FROM_MAIL&&(ChatMsg.openPersonalChat(this.player),event.stopImmediatePropagation())},e.prototype.setData=function(t,e){this.player=t,this._panel=e,this.initInfo()},e.prototype.reset=function(){},e.prototype.update=function(){this.init&&this.reset()},e.prototype.initInfo=function(){if(this.player){var t=PanelManager.getPanel(SocietyScene);if(this._panel==t.tempPanel)this.label_name.text=this.player.getName();else{this.label_name.text=this.player.getListDesc(!0);var e=!1;0==Tool.isNullText(this.player.getRemark())&&(e=!0),this.player.isStatusBit(ModelConst.STATUS_ONLINE)?this.label_name.textColor=e?ColorUtils.COLOR_GOLD_YELLOW:ColorUtils.COLOR_TEXT_GOLD:this.label_name.textColor=ColorUtils.COLOR_GRAY}}},e}(ComponentBase);__reflect(SocietyFriendItem.prototype,"SocietyFriendItem");var SocietyFriendPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,ButtonUtils.addTouchEvent(this.btn_addFriend,this.onBtnAddFriend,this),this.addFriendView.visible=!1,OtherPlayerPanel.menuType=Menu.UI_INTO_FRIEND_LIST,this.currListData=SocietyHandler.friendList},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_addFriend),SocietyHandler.firstGetFriendList=!0},e.prototype.getList=function(){SocietyHandler.doRelationFriendListMsg(this.getListCallbackFunc,this)},e.prototype.getListCallbackFunc=function(e){SocietyHandler.friendList=[],e&&e.length>0&&(Array.prototype.push.apply(SocietyHandler.friendList,e),this.currListData=SocietyHandler.friendList),t.prototype.getListCallbackFunc.call(this,e)},e.prototype.onBtnAddFriend=function(){0!=SafeLock.doSafeLockVerify()&&(this.addFriendView.visible=!0)},e.prototype.reset=function(){t.prototype.reset.call(this),this.addFriendView.visible=!1},e.prototype.update=function(e){void 0===e&&(e=!0),t.prototype.update.call(this,e),!SocietyHandler.firstGetFriendList&&e?this.showItem():(SocietyHandler.firstGetFriendList=!1,this.getList())},e.prototype.deleteUpdate=function(){this.updateList(),this.currSeeItem&&SocietyHandler.removeList(SocietyHandler.friendList,this.currSeeItem.player)},e.prototype.blackUpdate=function(){this.updateList(),this.currSeeItem&&SocietyHandler.removeList(SocietyHandler.friendList,this.currSeeItem.player,SocietyHandler.blackList)},e}(SocietyBasePanel);__reflect(SocietyFriendPanel.prototype,"SocietyFriendPanel");var SocietyHandler=function(){function t(){}return t.removeList=function(t,e,n,i){void 0===i&&(i=!0);var o=0,a=0;if(t)for(o=0,a=t.length;a>o;o++)if(t[o].getId()==e.getId()){var r=t.splice(o,1)[0];return void(n&&i&&n.push(r))}if(n&&i){for(o=0,a=n.length;a>o;o++)if(n[o].getId()==e.getId())return;var s=new ListPlayer;s.setId(e.getId()),s.setName(e.getName()),s.setLevel(e.getLevel()),n.push(s)}},t.init=function(e,n){t.callback=e,t.pageNum=1,t.pageSize=50,t.type=n,t.resultList=[]},t.doRelationFriendListMsg=function(e,n){t.thisObj=n,t.init(e,Define.RELATION_FRIEND),t.doRelationListMsg(t.type,t.pageSize,t.pageNum)},t.doRelationBlackListMsg=function(e,n){return t.thisObj=n,t.init(e,Define.RELATION_BLACK),t.doRelationListMsg(t.type,t.pageSize,t.pageNum)},t.doRelationMasterListMsg=function(e,n){return t.thisObj=n,t.init(e,Define.RELATION_MASTER),t.doRelationListMsg(t.type,t.pageSize,t.pageNum)},t.doRelationListMsg=function(t,e,n){PanelManager.openWaitForServer();var i=MsgHandler.createRelationList(t,e,e);nato.Network.sendCmd(i,this.getListCallbackFunc,this)},t.getListCallbackFunc=function(e){PanelManager.closeWaitForServer();var n=e.getShort();if(null==e)return t.returnList(),null;if(n>0){var i=e.getByte(),o=0,a=PanelManager.getPanel(SocietyScene,!1);if(a){var r=a.getCurrentPanel();r&&r==a.masterPanel&&(o=e.getByte())}for(var s=0;i>s;s++){var l=new ListPlayer;l.setId(e.getInt()),l.setName(e.getString()),l.setLevel(e.getByte()),e.getBoolean()?(l.setStatusBit(ModelConst.STATUS_ONLINE),l.mapName=e.getString()):l.clearStatusBit(ModelConst.STATUS_ONLINE),l.flag=e.getByte(),(l.isFlag(ListPlayer.FRIEND_FLAG_IS_VIP)||l.isFlag(ListPlayer.FRIEND_FLAG_IS_VIP_CQ))&&l.setVipLevel(e.getByte()),l.setRemark(e.getString()),l.model=o,t.resultList.push(l)}}t.returnList()},t.returnList=function(){t.callback.call(t.thisObj,t.resultList)},t.addFriend=function(t,e){var n;switch(t){case ProtocolDefine.MAIL_SEND_ID:var i=Define.getIdByAreaID(e,GameWorld.getPlayerID());n=MsgHandler.createRelationAddById(Define.RELATION_FRIEND,i);break;case ProtocolDefine.MAIL_SEND_NAME:n=MsgHandler.createRelationAddByName(Define.RELATION_FRIEND,e)}nato.Network.sendCmd(n,this.addFriendCallbackFunc,this)},t.addFriendCallbackFunc=function(e){if(0>e.getByte())AlertPanel.errorMessage(e.getString());else{AlertPanel.alertCommon(GameText.STR_MAKE_FRIEND_SUCCEE);var n=PanelManager.getPanel(SocietyScene,!1);if(n&&n.stage){var i=n.getCurrentPanel();i==n.friendPanel?(t.firstGetFriendList=!0,n.friendPanel.update(!1)):i==n.blackListPanel?n.blackListPanel.blackUpdate():t.updateFriendList=!0}else t.updateFriendList=!0}},t.resultList=[],t.firstGetFriendList=!0,t.firstGetBlackList=!0,t.firstGetMasterList=!0,t.updateFriendList=!1,t}();__reflect(SocietyHandler.prototype,"SocietyHandler");var SocietyMasterPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,OtherPlayerPanel.menuType=Menu.UI_INTO_MASTER_LIST,this.currListData=SocietyHandler.masterList},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),SocietyHandler.firstGetMasterList=!0},e.prototype.getList=function(){SocietyHandler.doRelationMasterListMsg(this.getListCallbackFunc,this)},e.prototype.getListCallbackFunc=function(e){SocietyHandler.masterList=[],e&&e.length>0&&(Array.prototype.push.apply(SocietyHandler.masterList,e),this.currListData=SocietyHandler.masterList),t.prototype.getListCallbackFunc.call(this,e)},e.prototype.update=function(e){void 0===e&&(e=!0),t.prototype.update.call(this,e),!SocietyHandler.firstGetMasterList&&e?this.showItem():(SocietyHandler.firstGetMasterList=!1,this.getList())},e}(SocietyBasePanel);__reflect(SocietyMasterPanel.prototype,"SocietyMasterPanel");var SocietyScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._tabBtnList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this._tabBtnList=[this.tabBtn_friend,this.tabBtn_blackList,this.tabBtn_master,this.tabBtn_temp];for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}},e.prototype.closePanel=function(){this._tabIndex=0,PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel();var t=this.getCurrentPanel();this.addChild(t),t.update()},e.prototype.getCurrentPanel=function(){var t;return this._tabIndex==e.TAB_INDEX_FRIEND?t=this.friendPanel:this._tabIndex==e.TAB_INDEX_BLACKLIST?t=this.blackListPanel:this._tabIndex==e.TAB_INDEX_MASTER?t=this.masterPanel:this._tabIndex==e.TAB_INDEX_TEMP&&(t=this.tempPanel),t},e.prototype.removeAllPanel=function(){this.friendPanel&&this.friendPanel.parent&&this.friendPanel.parent.removeChild(this.friendPanel),this.blackListPanel&&this.blackListPanel.parent&&this.blackListPanel.parent.removeChild(this.blackListPanel),this.masterPanel&&this.masterPanel.parent&&this.masterPanel.parent.removeChild(this.masterPanel),this.tempPanel&&this.tempPanel.parent&&this.tempPanel.parent.removeChild(this.tempPanel)},e.TAB_INDEX_FRIEND=0,e.TAB_INDEX_BLACKLIST=1,e.TAB_INDEX_MASTER=2,e.TAB_INDEX_TEMP=3,e.OPEN_FROM_NORMAL=1,e.OPEN_FROM_MAIL=2,e.from=e.OPEN_FROM_NORMAL,e}(ScenePanelBase);__reflect(SocietyScene.prototype,"SocietyScene");var SocietyTempPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bg.touchEnabled=!1,OtherPlayerPanel.menuType=Menu.UI_INTO_TEMP_TALK,this.currListData=ChatMsg.tempTalkMsgList},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.update=function(e){void 0===e&&(e=!0),t.prototype.update.call(this,e),this.showItem()},e}(SocietyBasePanel);__reflect(SocietyTempPanel.prototype,"SocietyTempPanel");var GMPanel=function(t){function e(){var e=t.call(this)||this;return e._content="0.测试VIP充值黄金\n指令：firstcharge 黄金数\n示例：firstcharge 1000\n\n0.微端开关\n指令：micro 开启参数\n示例：micro true\n\n0.新手引导开关\n指令：useguide 开启参数\n示例：useguide false\n\n0.新手快速战斗\n指令：quickbattle 开启参数\n示例：quickbattle true\n\n1.添加经验\n指令：addexp 经验数\n示例：addexp 10000\n\n2.添加宠物经验\n指令：addpetexp 经验数\n示例：addpetexp 10000\n\n3.添加物品\n指令：additem 物品id 个数示例：additem 77 5\n备注：如果个数大于物品单格数，会自动分格\n\n4.修理所有装备\n指令：repairall\n备注：已装备的\n\n5.添加金钱\n指令：addmoney 金钱数\n示例：addmoney 10000\n备注：三种金钱同时添加，金钱可为负数，负数表示减金钱，减到0为之\n\n6.添加金币\n指令：addmoney1 金钱数\n示例：addmoney1 10000\n\n7.添加金叶\n指令：addmoney2 金钱数\n示例：addmoney2 10000\n\n8.添加铜币\n指令：addmoney3 金钱数\n示例：addmoney3 10000\n\n9.添加血\n指令：addhp 数量\n示例：addhp 1000\n\n10.添加魔\n指令：addmp 数量\n示例：addmp 1000\n\n11.清理任务完成标识\n指令：cleartask 任务id\n示例：cleartask 1\n备注：任务id = 0，表示清理所有已完成任务\n\n12.设置任务完成标识\n指令：finishtask 任务id\n示例：finishtask 1\n\n13.添加个人城市繁荣度\n指令：addcitydegree 数值\n示例：addcitydegree 1000\n\n14.添加个人城市军力值\n指令：addcityarmy 数值\n示例：addcityarmy 1000\n\n15.添加个人城市金钱\n指令：addcitymoney 金钱类型 数值\n示例：addcitymoney 1 10000\n备注：金钱类型定义 1金币 2金叶 3铜币\n\n16.添加国家资源\n指令：addc 资源类型 数值\n示例：addc m1 1000\n备注：\n资源类型定义: m1 = 金币 m3= 铜币 w= 木材 s= 石料 i= 铁矿 p= 繁荣度 l= 空余土地 b= 指令书 level= 国家等级\ngx = 个人贡献度（指个人在这个国家中的贡献度） a = 全部(包括金币、铜币、木材、石料、铁矿、繁荣度、空余土地)\n\n17.卡支付测试(程序用)\n指令：pay-money - cardType - cardAmount - cardNumber - cardPassword\n示例：\n\n18.添加技能点\n指令：addsp 数值\n示例：addsp 100\n\n19.国家任务生效\n指令：effmission\n备注：使用这个指令可以使得发布的国家任务马上生效，不需要等待到明天\n\n20.国家指令冷却时间重置\n指令：resetCommand\n备注：使用这个指令使得所有处于冷却时间的国家指令都恢复\n\n21.修改天空竞技场挑战层次\n指令：challenge\n备注：使用这个指令修改当前角色天空竞技场挑战楼层\n\n22.增加充值活动积分\n指令：addcharge 数值\n示例： addcharge 500\n\n23.清除充值活动积分\n指令：clearcharge\n\n24.增加登陆宝箱天数 +1\n指令： addloginday\n示例： addloginday\n",e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e,nato.attachSkin(e._instance)),e._instance},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.container.reset(),this.label_desc.width=570,this.label_desc.text=this._content,this.container.add(this.label_desc),this.container.update(),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_send,this.onBtnSend,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_send)},e.prototype.onClose=function(){e.close()},e.prototype.onBtnSend=function(){var t=this.inputTxt.text;if(!Tool.isNullText(t)){var n=t.split(" ");if(!(n.length<1))if("battle"==n[0])xworld.toBattle(Number(n[1]),!1);else if("micro"==n[0]){var i="true"==n[1];xmicro=i}else if("quickbattle"==n[0]){i="true"==n[1];xworld.noviceQuickBattle=i}else if("useguide"==n[0]){i="true"==n[1];GameWorld.useGuide=i}else{var o=e.createCheatCodeMessage(t);nato.Network.sendCmd(o,null,null),MsgHandler.createWorldDataReflashMsg()}}},e.createCheatCodeMessage=function(t){var e=new nato.Message(ProtocolDefine.CG_SYSTEM_TEST_OPER);return e.putString(t),e},e.test=function(t){var n=e.createCheatCodeMessage(t);nato.Network.sendCmd(n,null,null)},e.open=function(){PanelManager.openScene(e.instance)},e.close=function(){PanelManager.closeScene(!0)},e}(ComponentBase);__reflect(GMPanel.prototype,"GMPanel");var SettingHandler=function(){function t(){}return t.getSettingText=function(e,n){return t.SETTING_TEXT[e-t.EVENT_SETTING_SET_NAME_SIMPLE][n]},t.findSettingIndex=function(e){for(var n=0;n<t.SETTING_MENU.length;n++)for(var i=0;i<t.SETTING_MENU[n].length;i++)if(t.SETTING_MENU[n][i]==e)return n;return-1},t.isMultiple=function(e){return 2==t.SETTING_MENU[e].length&&(0==t.SETTING_MENU[e][1]||1==t.SETTING_MENU[e][1])},t.setSettingIndex=function(e,n){var i=t.findSettingIndex(n);if(0>i)return e;var o=t.EVENT_ALL_SETTING_INVITE_REJECT,a=1<<n-o;if(t.isMultiple(i))e=Tool.setBit(!Tool.isBit(a,e),a,e);else{for(var r=0;r<t.SETTING_MENU[i].length;r++)t.SETTING_MENU[i][r]>=o&&(e=Tool.setBit(!1,1<<t.SETTING_MENU[i][r]-o,e));n>=o&&(e=Tool.setBit(!0,a,e))}return e},t.getSettingIndex=function(e,n){var i=t.findSettingIndex(n);if(0>i)return!1;var o=t.EVENT_ALL_SETTING_INVITE_REJECT;if(t.isMultiple(i)){var a=Tool.isBit(1<<n-o,e);return 0==t.SETTING_MENU[i][1]?!a:a}if(!(o>n))return Tool.isBit(1<<n-o,e);for(var r=0;r<t.SETTING_MENU[i].length;r++)if(t.SETTING_MENU[i][r]>=o&&Tool.isBit(1<<t.SETTING_MENU[i][r]-o,e))return!1;return!0},t.initCheckbox=function(){for(var e=t.setting,n=0,i=t.SETTING_MENU.length;i>n;n++)for(var o=0,a=t.SETTING_MENU[n].length;a>o;o++){var r="",s=t.SETTING_MENU[n][o],l=t.getSettingIndex(e,s),_=t.isMultiple(n);if(_){if(o>0)continue;r=GameText.STR_ON}else r=t.getSettingText(s,1);t.btns[n][o].label=r,t.btns[n][o].addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),0!=l&&(t.btns[n][o].selected=!0,_||(t.btns[n][o].enabled=!1))}},t.onCheckBoxChange=function(e){for(var n,i,o,a=e.currentTarget,r=0,s=t.btns.length;s>r;r++){i=!1,n=-1,o=!1;for(var l=0,_=t.btns[r].length;_>l;l++){if(t.btns[r][l].selected&&t.btns[r][l]!=a&&(n=l),a==t.btns[r][l]){if(t.setting=t.setSettingIndex(t.setting,t.SETTING_MENU[r][l]),1==_)return;i=!0,a.enabled=!1,a.removeEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),n>=0&&(o=!0)}if(i&&n>=0&&(o=!0),o)return t.btns[r][n].enabled=!0,t.btns[r][n].selected=!1,void t.btns[r][n].addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this)}}},t.EVENT_SETTING_SET_NAME_SIMPLE=10030,t.EVENT_SETTING_SET_MAP_SIMPLE=10031,t.EVENT_SETTING_SET_PLAYER_SIMPLE=10032,t.EVENT_SETTING_SET_JOIN=10033,t.EVENT_SETTING_SET_INVITE=10034,t.EVENT_SETTING_SET_CHAT=10035,t.EVENT_SETTING_MASTER_ACCEPT=10036,t.EVENT_SETTING_MAP_IMG_DEFAULT=10037,t.EVENT_SETTING_SPRITE_DEFAULT=10038,t.EVENT_SETTING_PLAYER_DEFAULT=10039,t.EVENT_SETTING_PLAYER_NUM_ALL=10040,t.EVENT_ALL_SETTING_INVITE_REJECT=10050,t.EVENT_ALL_SETTING_JOIN_ACCEPT=10051,t.EVENT_ALL_SETTING_JOIN_REJECT=10052,t.EVENT_ALL_SETTING_CHAT_WORLD_OFF=10053,t.EVENT_ALL_SETTING_CHAT_MAP_OFF=10054,t.EVENT_ALL_SETTING_CHAT_COUNTRY_OFF=10055,t.EVENT_ALL_SETTING_CHAT_TEAM_OFF=10056,t.EVENT_ALL_SETTING_CHAT_PRIVATE_OFF=10057,t.EVENT_ALL_SETTING_SHOW_TRANSPORT_OFF=10058,t.EVENT_ALL_SETTING_SHOW_PET_OFF=10059,t.EVENT_ALL_SETTING_PET_PLAN_OFF=10060,t.EVENT_ALL_SETTING_SHOW_CHAT_ALL=10061,t.EVENT_ALL_SETTING_SHOW_CHAT_MORE=10062,t.EVENT_ALL_SETTING_SHOW_CHAT_OFF=10063,t.EVENT_ALL_SETTING_MASTER_REJECT=10064,t.EVENT_ALL_SETTING_SPRITE_GUIDE_OFF=10065,t.EVENT_ALL_SETTING_MINI_MAP_ALL=10068,t.EVENT_ALL_SETTING_MINI_MAP_OFF=10069,t.EVENT_ALL_SETTING_SHOW_NAME_ALL=10070,t.EVENT_ALL_SETTING_SHOW_NAME_OFF=10071,t.EVENT_ALL_SETTING_SHOW_PLAYER_ALL=10072,t.EVENT_ALL_SETTING_SHOW_PLAYER_FAR=10073,t.EVENT_ALL_SETTING_SHOW_PLAYER_OFF=10074,t.EVENT_ALL_SETTING_MAP_IMG_MINI=10075,t.EVENT_ALL_SETTING_MAP_IMG_OFF=10076,t.EVENT_ALL_SETTING_SPRITE_MINI=10077,t.EVENT_ALL_SETTING_PLAYER_MINI=10078,t.EVENT_ALL_SETTING_PLAYER_NUM_50=10079,t.EVENT_ALL_SETTING_PLAYER_NUM_20=10080,t.EVENT_ALL_SETTING_MUSIC_BACKGROUND_OFF=10081,t.EVENT_ALL_SETTING_MUSIC_EFFECT_OFF=10082,t.EVENT_ALL_SETTING_SHOW_CHAT_UNION=10066,t.SETTING_TEXT=[["显示名字","简单"],["小地图","简单"],["显示玩家","简单"],["对方申请入队","手动接受"],["对方邀请入队","手动接受"],["聊天显示行数","1行"],["对方拜师","手动接受"],["地图资源(跳图生效)","默认"],["动画资源(跳图生效)","默认"],["角色形象(跳图生效)","默认"],["玩家数量(跳图生效)","全部"],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["对方邀请入队","自动拒绝"],["对方申请入队","自动接受"],["对方申请入队","自动拒绝"],["世界聊天","关"],["区域聊天","关"],["国家聊天","关"],["队伍聊天","关"],["私聊","关"],["坐骑显示","关"],["宠物显示","关"],["宠物战斗指令","关"],["聊天显示行数","保留"],["聊天显示行数","3行"],["聊天显示行数","关"],["对方拜师","自动拒绝"],["精灵助手","关"],["盟国聊天","关"],["",""],["小地图","详细"],["小地图","关"],["显示名字","详细"],["显示名字","关"],["显示玩家","保留"],["显示玩家","详细"],["显示玩家","关"],["地图资源(跳图生效)","简单"],["地图资源(跳图生效)","关闭"],["动画资源(跳图生效)","简单"],["角色形象(跳图生效)","简单"],["玩家数量(跳图生效)","50人"],["玩家数量(跳图生效)","20人"]],t.SETTING_1=[[t.EVENT_ALL_SETTING_JOIN_ACCEPT,t.EVENT_SETTING_SET_JOIN,t.EVENT_ALL_SETTING_JOIN_REJECT],[t.EVENT_SETTING_SET_INVITE,t.EVENT_ALL_SETTING_INVITE_REJECT],[t.EVENT_SETTING_MASTER_ACCEPT,t.EVENT_ALL_SETTING_MASTER_REJECT],[t.EVENT_ALL_SETTING_PET_PLAN_OFF,0],[t.EVENT_SETTING_SET_CHAT,t.EVENT_ALL_SETTING_SHOW_CHAT_OFF]],t.EXPLAIN_1=["对方申请入队","对方邀请入队","对方拜师","开: 手动下达宠物指令\n关: 宠物自动攻击","聊天显示行数","世界聊天","区域聊天","国家聊天","队伍聊天","私聊","盟国聊天"],t.SETTING_2=[[t.EVENT_SETTING_SET_NAME_SIMPLE,t.EVENT_ALL_SETTING_SHOW_NAME_ALL,t.EVENT_ALL_SETTING_SHOW_NAME_OFF],[t.EVENT_SETTING_SET_MAP_SIMPLE,t.EVENT_ALL_SETTING_MINI_MAP_ALL,t.EVENT_ALL_SETTING_MINI_MAP_OFF],[t.EVENT_SETTING_SET_PLAYER_SIMPLE,t.EVENT_ALL_SETTING_SHOW_PLAYER_FAR,t.EVENT_ALL_SETTING_SHOW_PLAYER_OFF],[t.EVENT_SETTING_MAP_IMG_DEFAULT,t.EVENT_ALL_SETTING_MAP_IMG_MINI,t.EVENT_ALL_SETTING_MAP_IMG_OFF],[t.EVENT_SETTING_SPRITE_DEFAULT,t.EVENT_ALL_SETTING_SPRITE_MINI],[t.EVENT_SETTING_PLAYER_DEFAULT,t.EVENT_ALL_SETTING_PLAYER_MINI],[t.EVENT_SETTING_PLAYER_NUM_ALL,t.EVENT_ALL_SETTING_PLAYER_NUM_50,t.EVENT_ALL_SETTING_PLAYER_NUM_20]],t.SETTING_MENU=t.SETTING_1,t.SETTING_EXPLAIN=t.EXPLAIN_1,t}();__reflect(SettingHandler.prototype,"SettingHandler");var SystemGameSettingPanel=function(t){function e(){var e=t.call(this)||this;return e._initNotifyMoney1=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplain,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_explain),ButtonUtils.removeTouchEvent(this.closeBtn);for(var n=0,i=this._btnArr.length;i>n;n++)for(var o=0,a=this._btnArr[n].length;a>o;o++)this._btnArr[n][o].selected=!1,this._btnArr[n][o].enabled=!0,this._btnArr[n][o].removeEventListener(egret.Event.CHANGE,SettingHandler.onCheckBoxChange,this);this._btnArr=null},e.prototype.onClose=function(){xself&&SettingHandler.setting!=xself.getSetting()?AlertPanel.alert(GameText.STR_GAME_SETTING,GameText.STR_GAME_SETTING_ASK,this.settingConfirm,this,this.closeSceneConfirm):this._initNotifyMoney1!=this.btn_notifyMoney1.selected?AlertPanel.alert(GameText.STR_GAME_SETTING,GameText.STR_GAME_SETTING_ASK,this.savePlayerData,this,this.closeSceneConfirm):this.closeSceneConfirm()},e.prototype.savePlayerData=function(){var t=PlayerDataManager.playerData;t.isIngoreMoney2=this.btn_notifyMoney1.selected,PlayerDataManager.savePlayerData(t),this.closeSceneConfirm()},e.prototype.settingConfirm=function(){var t=MsgHandler.createChangeSettingMessgae(SettingHandler.setting);nato.Network.sendCmd(t,(function(t){var e=Tool.isBit(Define.SETTING_PLAYER_MINI,SettingHandler.setting),n=xself.isSettingBit(Define.SETTING_PLAYER_MINI);xself.setSetting(SettingHandler.setting),e!=n&&xself.refreshPlayerAllSprite(),PanelManager.mainMenu.checkGuideSprite()}),this),this.closeSceneConfirm()},e.prototype.closeSceneConfirm=function(){PanelManager.closeScene()},e.prototype.onBtnExplain=function(){AlertPanel.alertCommon(GameText.SETTING_TAB_EXPLAIN_1)},e.prototype.initPanel=function(){this._btnArr||(this._btnArr=[[this.btn_applyTeam0,this.btn_applyTeam1,this.btn_applyTeam2],[this.btn_inviteTeam0,this.btn_inviteTeam1],[this.btn_master0,this.btn_master1],[this.btn_petCommand],[this.btn_chat0,this.btn_chat1]]),SettingHandler.btns=this._btnArr,SettingHandler.SETTING_MENU=SettingHandler.SETTING_1,SettingHandler.initCheckbox(),this._initNotifyMoney1=PlayerDataManager.playerData.isIngoreMoney2,this.btn_notifyMoney1.selected=this._initNotifyMoney1},e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(SystemGameSettingPanel.prototype,"SystemGameSettingPanel");var SystemScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_pay,this.onBtnPay,this),ButtonUtils.addTouchEvent(this.btn_setting,this.onBtnSetting,this),ButtonUtils.addTouchEvent(this.btn_notify,this.onBtnNotify,this),ButtonUtils.addTouchEvent(this.btn_safe,this.onBtnSafe,this),ButtonUtils.addTouchEvent(this.btn_roleList,this.onBtnRoleList,this),ButtonUtils.addTouchEvent(this.btn_cdkey,this.onBtnCdkey,this),ButtonUtils.addTouchEvent(this.btn_mail,this.onBtnBindMail,this),ButtonUtils.addTouchEvent(this.btn_system_move,this.onSystemMove,this),ButtonUtils.addTouchEvent(this.btn_changeHD,this.onBtnChangeHD,this),ButtonUtils.addTouchEvent(this.btn_contantGM,this.onBtnContantGM,this),ButtonUtils.addTouchEvent(this.btn_openCicle,this.onOpenCicle,this),ButtonUtils.addTouchEvent(this.btn_gm,this.onBtnGM,this),this.group_btns.removeChildren();var n=[];n.push(this.btn_pay),n.push(this.btn_setting),n.push(this.btn_notify),n.push(this.btn_cdkey),n.push(this.btn_roleList),n.push(this.btn_system_move),n.push(this.btn_mail),n.push(this.btn_safe),this.btn_contantGM.visible=!1,0==Tool.isNullText(Sdk.getGMInfo())&&(this.btn_contantGM.visible=!0,n.push(this.btn_contantGM)),this.btn_openCicle.visible=!1,3100==xchannel&&(this.btn_openCicle.visible=!0,n.push(this.btn_openCicle));for(var i=0;i<n.length;i++){var o=n[i];o.x=i%2==0?0:145*xhdRatio,o.y=50*xhdRatio*Math.floor(i/2),this.group_btns.addChild(o)}this.btn_changeHD.label=xhd?"切至低清模式":"切至高清模式",this.btn_gm.visible=!!xworld.opengm},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_pay),ButtonUtils.removeTouchEvent(this.btn_setting),ButtonUtils.removeTouchEvent(this.btn_notify),ButtonUtils.removeTouchEvent(this.btn_safe),ButtonUtils.removeTouchEvent(this.btn_roleList),ButtonUtils.removeTouchEvent(this.btn_cdkey),ButtonUtils.removeTouchEvent(this.btn_mail),ButtonUtils.removeTouchEvent(this.btn_system_move),ButtonUtils.removeTouchEvent(this.btn_changeHD),ButtonUtils.removeTouchEvent(this.btn_contantGM),ButtonUtils.removeTouchEvent(this.btn_gm)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnPay=function(){PayInfo.getPayList()},e.prototype.onBtnSetting=function(){SettingHandler.setting=xself.getSetting(),PanelManager.openSystemSettingScene()},e.prototype.onBtnNotify=function(){GameNotice.showNotice()},e.prototype.onBtnPaper=function(){InfoData.doBrowseGameHelpList(0)},e.prototype.onBtnSafe=function(){SafeLock.createSafeLockChooiceMenu()},e.prototype.onBtnRoleList=function(){GameWorld.doOpenPlayerList()},e.prototype.onBtnLottery=function(){LoginLotteryDraw.doEnter()},e.prototype.onBtnCdkey=function(){PanelManager.openEditNameView("输入","兑换码","",(function(t){GameWorld.doSpecialCode(t)}),null,this),this.onClose()},e.prototype.onBtnBindMail=function(){GameWorld.doBindTelephone(!1)},e.prototype.onBtnGM=function(){GMPanel.open()},e.prototype.onSystemMove=function(){GameWorld.doJumpRebornMap(),PanelManager.closeScene()},e.prototype.onBtnChangeHD=function(){var t="是否切换成"+(xhd?"低":"高")+"清画面?（需要刷新游戏）";AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),t,(function(){GameWorld.doLogOutMsg(Define.ACTOR_LEAVE_TYPE_BACKTOLIST,!0),Main.instance.switchStage(),this.x=0,this.y=0,this.anchorOffsetX=0,this.anchorOffsetY=0,this.scaleX=xhd?2:.5,this.scaleY=xhd?2:.5}),this)},e.prototype.onBtnContantGM=function(){var t=Sdk.getGMInfo();0==Tool.isNullText(t)&&AlertPanel.alertCommon(t)},e.prototype.onOpenCicle=function(){Sdk.xsdk.openTopicCircle()},e}(ComponentBase);__reflect(SystemScene.prototype,"SystemScene");var SystemSceneSettingPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplain,this),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_explain);for(var n=0,i=this._btnArr.length;i>n;n++)for(var o=0,a=this._btnArr[n].length;a>o;o++)this._btnArr[n][o].selected=!1,this._btnArr[n][o].enabled=!0,this._btnArr[n][o].removeEventListener(egret.Event.CHANGE,SettingHandler.onCheckBoxChange,this);this._btnArr=null},e.prototype.onBtnExplain=function(){AlertPanel.alertCommon(GameText.SETTING_TAB_EXPLAIN_2)},e.prototype.initPanel=function(){this._btnArr||(this._btnArr=[[this.btn_playerName0,this.btn_playerName1,this.btn_playerName2],[this.btn_miniMap0,this.btn_miniMap1,this.btn_miniMap2],[this.btn_playerShow0,this.btn_playerShow1,this.btn_playerShow2],[this.btn_mapResource0,this.btn_mapResource1,this.btn_mapResource2],[this.btn_animation0,this.btn_animation1],[this.btn_roleIdle0,this.btn_roleIdle1],[this.btn_playerCount0,this.btn_playerCount1,this.btn_playerCount2]]),SettingHandler.btns=this._btnArr,SettingHandler.SETTING_MENU=SettingHandler.SETTING_2,SettingHandler.initCheckbox()},e.prototype.reset=function(){},e.prototype.update=function(){this.init},e}(ComponentBase);__reflect(SystemSceneSettingPanel.prototype,"SystemSceneSettingPanel");var SystemSettingScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.updateTab()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){xself&&SettingHandler.setting!=xself.getSetting()?AlertPanel.alert(GameText.STR_GAME_SETTING,GameText.STR_GAME_SETTING_ASK,this.settingConfirm,this,this.closeSceneConfirm):this.closeSceneConfirm()},e.prototype.settingConfirm=function(){var t=MsgHandler.createChangeSettingMessgae(SettingHandler.setting);nato.Network.sendCmd(t,(function(t){var e=Tool.isBit(Define.SETTING_PLAYER_MINI,SettingHandler.setting),n=xself.isSettingBit(Define.SETTING_PLAYER_MINI);xself.setSetting(SettingHandler.setting),e!=n&&xself.refreshPlayerAllSprite(),PanelManager.mainMenu.checkGuideSprite()}),this),this.closeSceneConfirm()},e.prototype.closeSceneConfirm=function(){PanelManager.closeScene()},e.prototype.updateTab=function(){this.addChild(this.gameSettingPanel),this.gameSettingPanel.update()},e}(ComponentBase);__reflect(SystemSettingScene.prototype,"SystemSettingScene");var TestAutoGame=function(){function t(){}return t.start=function(){0==this._isStarting&&(this._isStarting=!0,nato.WorldTicker.instance.register(this.logic,this))},t.stop=function(){this._isStarting&&(this._isStarting=!1,nato.WorldTicker.instance.unregister(this.logic,this))},t.logic=function(t){if(this._logicCount+=t,!(this._logicCount<1e3)){if(AlertPanel.instance&&AlertPanel.instance.stage)return void AlertPanel.instance.closePanel();if(this._logicCount=0,xworld.inBattle){var e=PanelManager.battleUI;e&&e.stage&&e.visible&&(e.btn_auto.stage&&e.btn_auto.visible&&e.btn_auto.parent.visible?(e.actionWidget=e.btn_auto,BattleInputHandler.instance.processOrderPopPanel()):e.btn_skip_anime.stage&&e.btn_skip_anime.visible&&(e.actionWidget=e.btn_skip_anime,BattleInputHandler.instance.processOrderPopPanel()));var n=PanelManager.battleResultPanel;return void(n&&n.stage&&n.visible&&BattleView.instance.doExit())}var i=PanelManager.npcDialogue;if(i&&i.stage&&i.visible){PanelManager.closeNPCDialogue();var o=i.getNpc(),a=i._actionList[0];if(8==a.action){var r=a.data.mission,s=a.data.subType;if(xworld.isInCityNow()&&!this.isCityTask(r))return;if(((l=r.getMissionStatus(xself))==MissionConst.NOT_CAN_SUBMIT||l==MissionConst.NOT_CAN_ACCEPT)&&s!=NPCConst.EVENT_MISSION_FIGHT&&s!=NPCConst.EVENT_ALL_TASK_PATH){if(null==(a=i._actionList[1])||a.type!=NPCActionData.Type_mission)return;r=a.data.mission,s=a.data.subType}Mission.doMenuButton(o,null,s,r)}else{if(1==a.action)if(r=a.data){if(xworld.isInCityNow()&&!this.isCityTask(r))return;var l;((l=r.getMissionStatus(xself))==MissionConst.NOT_CAN_SUBMIT||l==MissionConst.NOT_CAN_ACCEPT)&&(a=i._actionList[1])}NPC.handlerMissionNPCAction(o,a)}}else PanelManager.isOpeningFullScene?PanelManager.closeScene(!0):AutoGamer.autoGaming||(AutoGamer.autoGaming=!0)}},t.isCityTask=function(t){if(null!=t){var e=t.getId();return e>=3060&&3075>=e}},t._isStarting=!1,t._logicCount=0,t}();__reflect(TestAutoGame.prototype,"TestAutoGame");var ActiveListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._vitality=t},Object.defineProperty(e.prototype,"vitality",{get:function(){return this._vitality},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.label_name.text="",this.label_count.text="",this.label_value.text="",this.select=!1)},e.prototype.update=function(){if(this.init){if(null==this._vitality)return void this.reset();var t=this._vitality.progress>=this._vitality.activeCount;this.label_name.textColor=t?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_WHITE,this.label_count.textColor=t?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_WHITE,this.label_value.textColor=t?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_WHITE,this.label_name.text=this._vitality.content,this.label_count.text=this._vitality.progress+"/"+this._vitality.activeCount,this.label_value.text=this._vitality.activeValue+(t?"   √":""),this.img_select.visible=this._select}},e}(ComponentBase);__reflect(ActiveListItem.prototype,"ActiveListItem");var ActivePanel=function(t){function e(){var e=t.call(this)||this;return e._activeIndex=0,e._activeItemList=[],e._itemIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._showItemData&&(this._showItemData=new ItemData,this._showItemData.bagIcon=28,this._showItemData.quantity=0,this._showItemData.grade=-1),null==this._labelList&&(this._labelList=[this.label_value1,this.label_value2,this.label_value3,this.label_value4]),null==this._itemList&&(this._itemList=[this.item1,this.item2,this.item3,this.item4]);for(var n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.addTouchEvent(this.btn_explain,this.onBtnExplain,this),this.updateItem(),Vitality.doEnter()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}ButtonUtils.removeTouchEvent(this.btn_explain)},e.prototype.onBtnExplain=function(){Vitality.doSeeInfoMenu()},e.prototype.onActiveItemTouch=function(t){var e=t.target;e&&e.vitality&&(this.onActiveItemSelect(e),Vitality.doSeeCon(e.vitality))},e.prototype.onActiveItemSelect=function(t){this._curSelectActiveItem&&(this._curSelectActiveItem.select=!1),this._curSelectActiveItem=t,this._curSelectActiveItem&&(this._curSelectActiveItem.select=!0)},e.prototype.onItemTouch=function(t){var e=t.target;if(e&&e.itemData&&(this.onSelectItem(e),this._vitality&&this._vitality.vItemVitality&&this._vitality.vItemVitality.length>0)){var n=this._itemList.indexOf(e),i=this._vitality.vItemVitality[n];Vitality.doSeeReward(i)}},e.prototype.onSelectItem=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.setData=function(t){this._vitality=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._activeIndex=0)},e.prototype.updateItem=function(){for(var t=0;t<this._itemList.length;t++)this._itemList[t].itemData=this._showItemData},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._vitality)){for(var t=0;t<this._itemList.length;t++){var e=this._vitality.vItemVitality[t],n=this._itemList[t],i=this._labelList[t];e?(n.isMask=!(e.status==Vitality.VITALITY_REWARD_ITEM_TYPE0||e.status==Vitality.VITALITY_REWARD_ITEM_TYPE2),e.status==Vitality.VITALITY_REWARD_ITEM_TYPE0?(i.textColor=ColorUtils.COLOR_RED,i.text=100*(t+1)+""):e.status==Vitality.VITALITY_REWARD_ITEM_TYPE1?(i.textColor=ColorUtils.COLOR_GREEN,i.text="可领取"):e.status==Vitality.VITALITY_REWARD_ITEM_TYPE2&&(i.textColor=ColorUtils.COLOR_GOLD_YELLOW,i.text="已领取")):(n.isMask=!0,i.textColor=ColorUtils.COLOR_RED,i.text=100*(t+1)+"")}if(this.label_active.text="活跃度："+this._vitality.allvalue,this._vitality.vConVitality&&this._vitality.vConVitality.length>0)for(t=0;t<this._vitality.vConVitality.length;t++){e=this._vitality.vConVitality[t];var o=this.getItem();o.setData(e),this.container.add(o)}this.container.update()}},e.prototype.getItem=function(){var t=this._activeItemList[this._activeIndex];return null==t&&((t=new ActiveListItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onActiveItemTouch,this),nato.attachSkin(t),this._activeItemList[this._activeIndex]=t),this._activeIndex++,t},e}(ComponentBase);__reflect(ActivePanel.prototype,"ActivePanel");var ActivityListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.select=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_action)},e.prototype.setData=function(t){this._activity=t},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activityData",{get:function(){return this._activity},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&(this._activity?(this.label_name.text=this._activity.title,this._activity.isHasMap()||this._activity.isHasShop()?(this.btn_action.visible=!0,this.label_time.visible=!1):(this.btn_action.visible=!1,this.label_time.visible=!0,this.label_time.text=this._activity.dateInfo)):(this.label_name.text="",this.label_time.text="",this.btn_action.visible=!1))},e}(ComponentBase);__reflect(ActivityListItem.prototype,"ActivityListItem");var ActivityPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e._activityList=null,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update(),null==this._activityList&&ActivityData.doBrowseActivityList()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onItemTouch=function(t){var e=t.target;if(e&&e.activityData)if(this.onSelectItem(e),e.activityData.pollIDList&&e.activityData.pollIDList.length>0)ActivityData.doPollList(e.activityData);else{var n,i=[];e.activityData.isHasMap()?(n=new MenuActionData(GameText.getText(GameText.TI_INTO_ACTIVITY_MAP),2),i.push(n)):e.activityData.isHasShop()&&(n=new MenuActionData(GameText.getText(GameText.TI_ENTER),3),i.push(n)),n=new MenuActionData(GameText.getText(GameText.TI_BACK),1),i.push(n),PanelManager.openSelectMenuPanel(e.activityData.detailInfo,i,(function(t){PanelManager.closeSelectMenuPanel(),(2==t||3==t)&&e.activityData.doJumpMap()}),this)}},e.prototype.onSelectItem=function(t){null!=t&&null!=t.activityData&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.setData=function(t){this._activityList=t,this.update()},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),this._activityList&&this._activityList.length>0)){for(var t=0;t<this._activityList.length;t++){var e=this._activityList[t];if(null!=e){var n=this.getItem();n.setData(e),this.container.add(n)}}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new ActivityListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(ActivityPanel.prototype,"ActivityPanel");var GameUpGrade=function(){function t(){this.id=0,this.type=0,this.iconindex=0,this.level=0,this.title="",this.desc="",this.typenum=0,this.stonenum=0,this.status=0,this.mapid=0}return t.doGameUpgradeGetData=function(e){var n=new nato.Message(ProtocolDefine.CG_SYSTEM_UPGRADE);n.putByte(e),nato.Network.sendCmd(n,(function(e){t.gameUpGradeList=[];for(var n=e.getByte(),i=0;n>i;i++){var o=new t,a=e.getInt(),r=e.getByte(),s=e.getInt(),l=e.getByte(),_=e.getString(),h=e.getString(),u=e.getInt(),c=e.getByte(),T=e.getByte(),p=e.getInt();o.id=a,o.type=r,o.iconindex=s,o.level=l,o.title=_,o.desc=h,o.typenum=u,o.stonenum=c,o.status=T,o.mapid=p,t.gameUpGradeList.push(o)}var d=PanelManager.getPanel(TaskScene,!1);d&&d.stage&&d.promotePanel.setData(t.gameUpGradeList)}),this)},t.doGameUpgradeJumpMap=function(t,e){var n=xself;if(null!=n){var i=!0;Tool.isVip(n)&&(i=!1);var o=function(t){if(0==t.getByte()){if(t.getByte()>0){var n=t.getShort(),i=t.getInt(),o=xself;if(null==o||null==o.bag)return;var a=o.bag.getItem(n);(null==a||a.id!=i)&&ChatMsg.addChatSystemMsg("传送石删除不同步,soltPos = "+n);var r=o.bag.removeBagItemByPos(n,e);r!=Define.SUCCESS&&ChatMsg.addChatSystemMsg("副本、晋升传送石删除出错="+n+" 结果="+r)}MsgHandler.instance.processDataBlockFlagMsg(t)}else AlertPanel.alertCommon(t.getString())},a=function(){var e=new nato.Message(ProtocolDefine.CG_SCENE_GO_MAP_UPGRADE);e.putInt(t),e.putInt(Define.JUMP_MAP_DATA_FLAG),nato.Network.sendCmd(e,o,this)};e>0&&i?AlertPanel.alert(GameText.getText(GameText.TI_WARM_SHOW),Tool.manageString(GameText.STR_GAMEUPGRADE_JUMPMAP_ASK,e+""),a,this):a()}},t.prototype.doGetIconIndex=function(){return this.status==t.UPGRADE_STATUS_LUCK||this.iconindex>t.IDX_LUCK?t.IDX_LUCK:this.iconindex},t.UPGRADE_TYPE_ECTYPE=1,t.UPGRADE_TYPE_TASK=2,t.UPGRADE_TYPE_PET=3,t.UPGRADE_TYPE_ATTACH=4,t.UPGRADE_TYPE_COUNTRY=5,t.UPGRADE_TYPE_VIP=6,t.UPGRADE_TYPE_KILL_MONSTER=7,t.UPGRADE_TYPE_USE_POTENTIAL=8,t.IDX_UP_FINISH=0,t.IDX_UP_LV=1,t.IDX_PET=2,t.IDX_TASK=3,t.IDX_ATTACH=4,t.IDX_COUNTRY=5,t.IDX_VIP=6,t.IDX_KILL_MONSTER=7,t.IDX_MONSTER=8,t.IDX_POTENTIAL=9,t.IDX_CITY=10,t.IDX_LUCK=11,t.UPGRADE_STATUS_NO=0,t.UPGRADE_STATUS_LUCK=1,t.UPGRADE_STATUS_OK=2,t.UPGRADE_ECTYPE=1,t.UPGRADE_EXALT=2,t}();__reflect(GameUpGrade.prototype,"GameUpGrade");var PromoteListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._data=t,this.update()},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.init&&null!=this._data&&(this.img_select.visible=this._select,this.img_icon.source="gameupgrade_"+this._data.doGetIconIndex(),this._data.status==GameUpGrade.UPGRADE_STATUS_OK?this.img_complete.visible=!0:this.img_complete.visible=!1,this.label_name.text=this._data.title)},e}(ComponentBase);__reflect(PromoteListItem.prototype,"PromoteListItem");var PromotePanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=[],e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==GameUpGrade.gameUpGradeList?GameUpGrade.doGameUpgradeGetData(GameUpGrade.UPGRADE_EXALT):this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.data&&this.onSelectItem(e)},e.prototype.onSelectItem=function(t){null!=t&&null!=t.data&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0,this.showData(t.data))},e.prototype.showData=function(t){null!=t&&(this.label_name.text="【"+t.title+"】",t.status==GameUpGrade.UPGRADE_STATUS_LUCK?(this.label_condition.visible=!0,this.label_condition.text=Tool.manageString(GameText.STR_GAMEUPGRADE_LOCK_EXP,t.level+"")):this.label_condition.visible=!1,this.label_desc.textFlow=Tool.convertDescToTextFlow(t.desc),this.label_container.add(this.label_desc,8,8),this.label_container.update())},e.prototype.setData=function(t){this._dataList=t,this.update()},e.prototype.reset=function(){this.itemContainer.reset(),this.label_container.reset(),this._index=0},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._dataList&&0!=this._dataList.length)){for(var t=0,e=0,n=0;n<this._dataList.length;n++){var i=this._dataList[n],o=this.getItem();o.setData(i),t=o.width*(n%4),e=o.height*Math.floor(n/4),this.itemContainer.add(o,t,e)}this.itemContainer.update(),this.onSelectItem(this._itemList[0])}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new PromoteListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(PromotePanel.prototype,"PromotePanel");var RecordListItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e){this._chapMilestone=t,this._milestone=e},Object.defineProperty(e.prototype,"milestone",{get:function(){return this._milestone},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.label_name.text="",this.select=!1)},e.prototype.update=function(){if(this.init){if(null==this._milestone)return void this.reset();var t=Tool.manageString(GameText2.STR_MILESTONE_PART,Tool.getChangeChnChar(this._milestone.partId)),e="";switch(this._milestone.misState){case Milestone.MILESTONE_MISSION_STATE_NOTOPEN:e=PowerString.makeColorString("("+GameText2.STR_MILESTONE_MISSION_NOTOPEN+")",ColorUtils.COLOR_GRAY);break;case Milestone.MILESTONE_MISSION_STATE_OPEN:break;case Milestone.MILESTONE_MISSION_STATE_FINISH:e=PowerString.makeColorString("("+GameText2.STR_MILESTONE_MISSION_FINISH+")",ColorUtils.COLOR_GREEN)}var n=!1;this._chapMilestone.chapterOpen?(this._chapMilestone.rTime>0&&0==this._chapMilestone.hasgetreward?(t=GameText2.STR_MILESTONE_HAS_OPEN_CANGET,n=!0):t+=" "+this._milestone.partName+e,this._milestone.isCanGetdate=!0):(t=Tool.manageStringList(GameText2.STR_MILESTONE_NOT_OPEN_TITLE,[this._chapMilestone.level+"",Tool.getChangeChnChar(this._chapMilestone.chapterId)]),n=!0,this._milestone.isCanGetdate=!1),this.label_name.textFlow=Tool.convertDescToTextFlow(t);var i=!1;n&&this._chapMilestone.rTime>0&&(i=!0),i&&(this.btn_detail.label=i?"奖励":"详细"),this.img_select.visible=this._select}},e}(ComponentBase);__reflect(RecordListItem.prototype,"RecordListItem");var RecordPanel=function(t){function e(){var e=t.call(this)||this;return e._titleIndex=0,e._titleList=[],e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.reset(),Milestone.doMilestoneEnter()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onTitleItemTouch=function(t){var e=t.target;e&&e.milestone&&Milestone.doSeeChapter(e.milestone.chapterId,this._milestone)},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.milestone&&(this.onSelectItem(e),Milestone.doSeePartDetailsMenu(e.milestone))},e.prototype.onSelectItem=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e.prototype.setData=function(t){this._milestone=t},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0,this._titleIndex=0)},e.prototype.update=function(){if(this.init&&(this.reset(),null!=this._milestone&&null!=this._milestone.vChapterMilestone)){for(var t=0;t<this._milestone.vChapterMilestone.length;t++){var e=this._milestone.vChapterMilestone[t],n=this.getTitleItem();n.setData(e),this.container.add(n),e.chapterId==this._milestone.defaultchapterId&&this.addPart(e)}this.container.update()}},e.prototype.addPart=function(t){if(t&&t.vPart&&t.vPart.length>0)for(var e=0;e<t.vPart.length;e++){var n=this.getItem(),i=t.vPart[e];n.setData(t,i),this.container.add(n)}},e.prototype.getTitleItem=function(){var t=this._titleList[this._titleIndex];return null==t&&((t=new RecordTitleItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTitleItemTouch,this),nato.attachSkin(t),this._titleList[this._titleIndex]=t),this._titleIndex++,t},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&((t=new RecordListItem).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(RecordPanel.prototype,"RecordPanel");var RecordTitleItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t){this._milestone=t},Object.defineProperty(e.prototype,"milestone",{get:function(){return this._milestone},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init&&(this.label_name.text="")},e.prototype.update=function(){if(this.init&&this._milestone){var t=Tool.manageString(GameText2.STR_MILESTONE_CHAPTER,Tool.getChangeChnChar(this._milestone.chapterId));this.label_name.text=t+" "+this._milestone.chapterCon}},e}(ComponentBase);__reflect(RecordTitleItem.prototype,"RecordTitleItem");var TaskItem=function(t){function e(){var e=t.call(this)||this;return e._mission=null,e._randomMission=null,e._select=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.detail_label.touchEnabled=!1,this.detail_btn.touchChildren=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.onDetailBtnTouch=function(){this._mission},Object.defineProperty(e.prototype,"mission",{get:function(){return this._mission},set:function(t){this._mission=t,this._randomMission=null,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"randomMission",{get:function(){return this._randomMission},set:function(t){this._randomMission=t,this._mission=null,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.init&&this.visible&&this.stage){if(this._mission){var t=[];t.push(TextFieldUtils.getTextFlowElement(this._mission.name));var e=this._mission.isComplete()?"["+GameText.STR_MISSION_FINISH+"]":"["+GameText.STR_MISSION_UNFINISH+"]",n=this._mission.isComplete()?ColorUtils.COLOR_GREEN:ColorUtils.COLOR_GRAY;t.push(TextFieldUtils.getTextFlowElement(e,n)),this.detail_label.textFlow=t,this.detail_btn.visible=!0}else if(this._randomMission){var i,o,a=!0;switch(this._randomMission.rmissionStatus){case RandomMission.STATUS_START_1:i=this._randomMission.name,o=GameText.getText(GameText.TI_DETAIL);break;case RandomMission.STATUS_START_2:i=Tool.manageString(GameText.STR_CHALLENGE_MISSION_FINISH,this._randomMission.name),o=GameText.getText(GameText.TI_SUBMIT);break;case RandomMission.STATUS_WAIT:i=GameText.STR_CHALLENGE_MISSION_COOL,o=GameText.getText(GameText.TI_SEE_INFO);break;case RandomMission.STATUS_END_1:i=GameText.STR_CHALLENGE_MISSION_CAN_ACCEPT,o=GameText.getText(GameText.TI_ACCEPT);break;case RandomMission.STATUS_END_2:i=GameText.STR_FINISH_ALL,o=GameText.getText(GameText.TI_SEE_INFO),a=!1}this.detail_label.text=i,this.detail_btn.label=o,this.detail_btn.visible=a}else this.detail_label.text="",this.detail_btn.visible=!1;this.img_select.visible=this._select}},e}(ComponentBase);__reflect(TaskItem.prototype,"TaskItem");var TaskItemSimple=function(t){function e(){var e=t.call(this)||this;return e._isFaceDown=!1,e.touchChildren=e.touchEnabled=!1,e.text=new egret.TextField,e.text.fontFamily="黑体",e.text.size=15*xhdRatio,e.text.y=10*xhdRatio,e.addChild(e.text),e}return __extends(e,t),e.prototype.setData=function(t,e){void 0===e&&(e=!1);var n=Tool.convertDescToTextFlow(t);this.text.multiline=!1,this.text.textFlow=n,this.text.textWidth>200*xhdRatio&&(this.text.multiline=!0,this.text.width=200*xhdRatio),this.width=this.text.width+5*xhdRatio,this.height=this.text.height+10*xhdRatio,this._isFaceDown=e,this.update()},e.prototype.update=function(){this.graphics.clear(),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,10,this.width,this.height);var t=this.width/2,e=0;this._isFaceDown?(this.graphics.drawRect(0,10,this.width,this.height-10),e=this.height,this.graphics.moveTo(t-10,e),this.graphics.lineTo(t,e+10),this.graphics.lineTo(t+10,e),this.graphics.endFill()):(this.graphics.drawRect(0,10,this.width,this.height),this.graphics.moveTo(t-10,e+10),this.graphics.lineTo(t,e),this.graphics.lineTo(t+10,e+10),this.graphics.endFill())},e}(egret.Sprite);__reflect(TaskItemSimple.prototype,"TaskItemSimple");var TaskPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._isShowRandomMission=!1,e._fromType=0,e._itemList=new Array,e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.group_main&&this.group_main.parent&&this.group_main.parent.removeChild(this.group_main),this.group_random&&this.group_random.parent&&this.group_random.parent.removeChild(this.group_random),this.bg.touchEnabled=!1},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setFromType=function(t){this._fromType=t},e.prototype.setSelectCallback=function(t,e){this._selectTaskCallbackFunc=t,this._selectTaskThisObj=e},e.prototype.setRandomMission=function(t){this._randomMission=t,this.updateView(t)},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){this.reset();var t=xself;null!=t&&(this._isShowRandomMission=!0,(t.getLevel()<30||this._fromType==TaskScene.FromType_chat)&&(this._isShowRandomMission=!1),1==this._isShowRandomMission?RandomMission.doRandomMissionInfo():this.updateView(null))}},e.prototype.updateView=function(t){if(this.init){this.reset();var e,n,i=xself;if(this._isShowRandomMission){var o="挑战任务";t&&(o+=t.getRandomMissionCount()),this.label_randomTitle.text=o,this.container.add(this.group_random),null!=t&&((n=this.getItem()).randomMission=t,this.container.add(n))}if(this.container.add(this.group_main),null!=i.missionList)for(var a=0;a<i.missionList.length;a++)null!=(e=i.missionList[a])&&((n=this.getItem()).mission=e,this.container.add(n));this.container.update(),this._index>0?(this._itemList[0]&&this.selectItem(this._itemList[0]),this.label_getTask.visible=!1):this.label_getTask.visible=!0}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new TaskItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTaskItemTouch,this),this._itemList[this._index]=t),this._index++,t},e.prototype.onTaskItemTouch=function(t){var e=t.target.parent;if(e&&e.mission)if(this.selectItem(e),t.target==e.detail_btn){ButtonUtils.buttonTweenEffect(e.detail_btn);var n,i=[];n=new NPCActionData(GameText.getText(GameText.TI_TASK_PATH),8,{subType:NPCConst.EVENT_ALL_TASK_PATH,mission:e.mission}),i.push(n),n=new NPCActionData(GameText.getText(GameText.TI_DELECT_MISSION),8,{subType:NPCConst.EVENT_ALL_TASK_DEL,mission:e.mission}),i.push(n),PanelManager.openNPCDialogue(e.mission.name,e.mission.desc,i,null,null,null)}else null!=this._selectTaskCallbackFunc&&null!=this._selectTaskThisObj&&(this._selectTaskCallbackFunc.call(this._selectTaskThisObj,e.mission),PanelManager.closeScene());else e&&e.randomMission&&(this.selectItem(e),t.target==e.detail_btn&&(ButtonUtils.buttonTweenEffect(e.detail_btn),e.randomMission.rmissionStatus==RandomMission.STATUS_END_1?RandomMission.doNPCDialogueAction(RandomMission.Action_accept,e.randomMission):e.randomMission.rmissionStatus==RandomMission.STATUS_WAIT?NPC.doMissionInfoView(xself,e.randomMission,null,NPCConst.SUB_RANDOM_MISSION_CHANGE):NPC.doMissionInfoView(xself,e.randomMission,null,NPCConst.SUB_MISSION_VIEW)))},e.prototype.selectItem=function(t){this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem&&(this._curSelectItem.select=!0)},e}(ComponentBase);__reflect(TaskPanel.prototype,"TaskPanel");var TaskScene=function(t){function e(){var e=t.call(this)||this;return e._tabIndex=0,e._fromType=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._tabBtnList&&(this._tabBtnList=[this.tab_btn0],this.tab_btn1.visible=!1,this.tab_btn2.visible=!1,this.tab_btn3.visible=!1,this.tab_btn4.visible=!1);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.addTouchEvent(this.return_btn,this.onClose,this),this.updateTab(),GameWorld.useGuide&&guide.isStatusFlag(guide.IS_GUIDE_TASK_CLOSE_UI)&&(guide.setStatusFlag(!1,guide.IS_GUIDE_TASK_CLOSE_UI),GameWorld.setGuide(GameWorld.GUIDE_TASK_CLOSE))},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._tabBtnList.length;n++){this._tabBtnList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabBtnTouch,this)}ButtonUtils.removeTouchEvent(this.return_btn),GameUpGrade.gameUpGradeList=null,this.taskPanel.setSelectCallback(null,null)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onTabBtnTouch=function(t){var e=t.target,n=this._tabBtnList.indexOf(e);n>=0&&n!=this._tabIndex&&(this._tabIndex=n,this.updateTab())},e.prototype.openTab=function(t,e){void 0===e&&(e=0),this._tabIndex=0,this._fromType=e,this.updateTab()},e.prototype.updateTab=function(){ButtonUtils.selectTabBtnList(this._tabBtnList,this._tabIndex),this.removeAllPanel(),this._tabIndex==e.TAB_INDEX_TASK?(this.taskPanel.setFromType(this._fromType),this.addChild(this.taskPanel),this.taskPanel.update()):this._tabIndex==e.TAB_INDEX_ACTIVITY?(this.addChild(this.activityPanel),this.activityPanel.update()):this._tabIndex==e.TAB_INDEX_PROMOTE?(this.addChild(this.promotePanel),this.promotePanel.update()):this._tabIndex==e.TAB_INDEX_ACTIVE?this.addChild(this.activePanel):this._tabIndex==e.TAB_INDEX_RECORD&&this.addChild(this.recordPanel)},e.prototype.removeAllPanel=function(){this.taskPanel&&this.taskPanel.parent&&this.taskPanel.parent.removeChild(this.taskPanel),this.activityPanel&&this.activityPanel.parent&&this.activityPanel.parent.removeChild(this.activityPanel),this.promotePanel&&this.promotePanel.parent&&this.promotePanel.parent.removeChild(this.promotePanel),this.activePanel&&this.activePanel.parent&&this.activePanel.parent.removeChild(this.activePanel),this.recordPanel&&this.recordPanel.parent&&this.recordPanel.parent.removeChild(this.recordPanel)},e.prototype.updateRandomMission=function(t){this.taskPanel&&this.taskPanel.setRandomMission(t)},e.prototype.updateVitalityData=function(t){this.activePanel&&(this.activePanel.setData(t),this.activePanel.update())},e.prototype.updateMilestone=function(t){this.recordPanel&&(this.recordPanel.setData(t),this.recordPanel.update())},e.TAB_INDEX_TASK=0,e.TAB_INDEX_ACTIVITY=1,e.TAB_INDEX_PROMOTE=2,e.TAB_INDEX_ACTIVE=3,e.TAB_INDEX_RECORD=4,e.FromType_normal=0,e.FromType_chat=1,e}(ComponentBase);__reflect(TaskScene.prototype,"TaskScene");var TeamBossItem=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.img_select&&(this.img_select.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._boss=t},Object.defineProperty(e.prototype,"boss",{get:function(){return this._boss},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.init){if(this._boss){var t=TeamBoss.getImgByBoss(this._boss);this.img_type.source=this.getBossResource(t)}else this.img_type.source=null;this.img_select.visible=this._select}},e.prototype.getBossResource=function(t){return"teamboss_type_"+t},e}(ComponentBase);__reflect(TeamBossItem.prototype,"TeamBossItem");var TeamBossScene=function(t){function e(){var e=t.call(this)||this;return e._logicCount=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.headInfoView.setData(xself),ButtonUtils.addTouchEvent(this.btn_chat,this.onBtnChat,this),ButtonUtils.addTouchEvent(this.btn_item,this.onBtnItem,this),ButtonUtils.addTouchEvent(this.btn_pet,this.onBtnPet,this),ButtonUtils.addTouchEvent(this.btn_role,this.onBtnRole,this),ButtonUtils.addTouchEvent(this.btn_mail,this.onBtnMail,this),ButtonUtils.addTouchEvent(this.btn_scoreShop,this.onBtnScoreShop,this),ButtonUtils.addTouchEvent(this.closeBtn,this.onBtnClose,this),null==this._itemList){this._itemList=[];for(var n=0;12>n;n++){var i=this["item"+n];this._itemList.push(i)}}for(n=0;n<this._itemList.length;n++){(i=this._itemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}nato.WorldTicker.instance.register(this.logic,this),this.update(),this._curSelectItem&&this.onSelectItem(this._curSelectItem)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_chat),ButtonUtils.removeTouchEvent(this.btn_item),ButtonUtils.removeTouchEvent(this.btn_pet),ButtonUtils.removeTouchEvent(this.btn_role),ButtonUtils.removeTouchEvent(this.btn_mail),ButtonUtils.removeTouchEvent(this.btn_scoreShop),ButtonUtils.removeTouchEvent(this.closeBtn);for(var n=0;n<this._itemList.length;n++){var i=this._itemList[n];i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),i.select=!1}this.group_spr.removeChildren(),nato.WorldTicker.instance.unregister(this.logic,this)},e.prototype.onClose=function(){PanelManager.closeScene(!0)},e.prototype.onBtnChat=function(){PanelManager.openChatScene()},e.prototype.onBtnItem=function(){PanelManager.openBag()},e.prototype.onBtnRole=function(){PanelManager.openRoleScene()},e.prototype.onBtnPet=function(){PanelManager.openPetScene()},e.prototype.onBtnMail=function(){PanelManager.openMailScene()},e.prototype.onBtnScoreShop=function(){this._teamBoss&&AlertPanel.alertCommon(this._teamBoss.getIntegralInfo())},e.prototype.onBtnClose=function(){TeamBoss.doTeamBossQuit()},e.prototype.onItemTouch=function(t){var e=t.target,n=this._itemList.indexOf(e);e&&n>=0&&(this.onSelectItem(e),e&&e.boss&&TeamBoss.doFight_1(e.boss))},e.prototype.onSelectItem=function(t){null!=t&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=t,this._curSelectItem.select=!0)},e.prototype.setData=function(t){this._teamBoss=t,this.update()},e.prototype.reset=function(){this.init&&(this.label_time.text="",this.label_bossCount.text="",this.label_score.text="")},e.prototype.update=function(){if(this.init){if(null==this._teamBoss)return void this.reset();if(this.group_spr.removeChildren(),null!=this._teamBoss.spriteModel){var t=this._teamBoss.spriteModel.sprite;if(-1!=this._teamBoss.myPos){var e=this._itemList[this._teamBoss.myPos-1];t.x=e.x+e.width/2,t.y=e.y+e.height,this.group_spr.addChild(t)}}for(var n=0;n<this._itemList.length;n++){e=this._itemList[n];var i=this._teamBoss.getBossByIndex(n);i.uiPos=n+1,e.setData(i),e.update()}this.label_bossCount.text=this._teamBoss.getAllBossNum()+"",this.label_score.text=this._teamBoss.scoreSum+"",this.label_tips.visible=-1==this._teamBoss.myPos}},e.prototype.logic=function(t){if(this._teamBoss&&this._teamBoss.logic(t),this._logicCount+=t,!(this._logicCount<500))if(this._logicCount=0,this._teamBoss)if(this._teamBoss.isTimeOut())this.label_time.textFlow=Tool.convertDescToTextFlow(PowerString.makeColorString(GameText.STR_OVER,ColorUtils.COLOR_WHITE));else{var e="剩余时间：",n=Tool.getPlanTimeStr(this._teamBoss.endTime);e+=PowerString.makeColorString(n,ColorUtils.COLOR_GREEN),this.label_time.textFlow=Tool.convertDescToTextFlow(e)}else this.label_time.text=""},e}(ComponentBase);__reflect(TeamBossScene.prototype,"TeamBossScene");var GuoQingExchange=function(){function t(){}return t.getResByItemId=function(t){var e=this.ID_list.indexOf(t);return e>=0?(xhd?this.res_list_hd:this.res_list_sd)[e]:""},t.getResByShopId=function(t){switch(t){case 40021:return"gddh_icon_2_hd";case 40001:return"gddh_icon_0_hd";case 40051:return"gddh_icon_1_hd";case 1200:return"gddh_icon_7_hd";case 31080:return"gddh_icon_qing_hd";case 40053:return"gddh_icon_kuai_hd";case 375:return"gddh_icon_le_hd";case 40044:return"gqdh_2017_hd";case 883:return"gddh_icon_kl_hd";case 42006:return"gqdh_guoqing_hd"}return""},t.ID_list=[40021,40001,40051,1200,31080,40053,375,40044,883,42006],t.res_list_hd=["gddh_icon_2_hd","gddh_icon_0_hd","gddh_icon_1_hd","gddh_icon_7_hd","gddh_icon_qing_hd","gddh_icon_kuai_hd","gddh_icon_le_hd","gqdh_2017_hd","gddh_icon_kl_hd","gqdh_guoqing_hd"],t.res_list_sd=["gddh_icon_2_sd","gddh_icon_0_sd","gddh_icon_1_sd","gddh_icon_7_sd","gddh_icon_qing_sd","gddh_icon_kuai_sd","gddh_icon_le_sd","gqdh_2017_sd","gddh_icon_kl_sd","gqdh_guoqing_sd"],t}();__reflect(GuoQingExchange.prototype,"GuoQingExchange");var LaodongjieExchange=function(){function t(){}return t.getResByShopId=function(t){switch(t){case 40021:return"ld_icon_2_hd";case 1054:return"ld_icon_0_hd";case 40051:return"ld_icon_1_hd";case 40001:return"ld_icon_3_hd";case 1045:return"ld_icon_6_hd";case 42024:return"ld_icon_4_hd";case 127:case 375:return"ld_icon_5_hd";case 40044:return"ld_icon_8_hd";case 42006:case 35025:return"ld_icon_7_hd"}return""},t.getZNQResByShopId=function(t){switch(t){case 40021:return"zn_icon_6_hd";case 40001:return"zn_icon_5_hd";case 40051:return"zn_icon_7_hd";case 42024:return"zn_icon_4_hd";case 31017:return"zn_icon_3_hd";case 1045:return"zn_icon_1_hd";case 40023:return"zn_icon_0_hd";case 40044:case 1462:return"zn_icon_13_hd";case 1537:return"zn_icon_11_hd";case 42006:case 35025:return"zn_icon_12_hd";case 1113:case 1114:return"zn_icon_8_hd";case 1115:return"zn_icon_10_hd"}return""},t.ID_list=[170,171,172,173,174,175,176,177],t.ID_ZNQ_list=[183,185,182,184,178,179,180,181],t}();__reflect(LaodongjieExchange.prototype,"LaodongjieExchange");var NewYearExchange=function(){function t(){}return t.getResByItemId=function(t){var e=this.ID_list.indexOf(t);return e>=0?this.res_list_hd[e]:""},t.ID_list=[161,162,163,164,165,166,167,168],t.res_list_hd=["newyear_icon_2_hd","newyear_icon_0_hd","newyear_icon_1_hd","newyear_icon_7_hd","newyear_icon_ji_t_hd","newyear_icon_nian_hd","newyear_icon_da_hd","newyear_icon_ji_hd"],t}();__reflect(NewYearExchange.prototype,"NewYearExchange");var ThanksGivingDayExchangeListItem=function(t){function e(){var e=t.call(this)||this;return e._shopType=0,e._shopID=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.exchangeItem,this.onExchangeItemTouch,this),ButtonUtils.addTouchEvent(this.btn_exchange,this.onBtnExchange,this),this._countNum=ImageNum.create(2006),this._countNum.scaleX=this._countNum.scaleY=.6*xhdRatio,this._countNum.numSpace=-2*xhdRatio,this.group_num.addChild(this._countNum),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.exchangeItem),ButtonUtils.removeTouchEvent(this.btn_exchange),this.group_num.removeChildren(),this._countNum=null},e.prototype.onExchangeItemTouch=function(){this._shopItem&&AlertPanel.alertItem(this._shopItem)},e.prototype.onBtnExchange=function(){ItemManager.doItemCombin_1(this._shopType,this._shopID,this._shopItem)},e.prototype.setData=function(t,e,n){this._shopType=t,this._shopID=e,this._shopItem=n},e.prototype.reset=function(){this.init&&(this.exchangeItem.itemData=null)},e.prototype.update=function(){if(this.init){if(null==this._shopItem)return void this.reset();if(this._shopItem.extraList){var t=this._shopItem.extraList[0];this._countNum.num=t.quantity}this._shopItem.money1>0?(this.img_gold.visible=!0,this.label_money.visible=!0,this.label_money.text=this._shopItem.money1.toString()):(this.img_gold.visible=!1,this.label_money.visible=!1),this.exchangeItem.itemData=this._shopItem,this.exchangeItem.update()}},e}(ComponentBase);__reflect(ThanksGivingDayExchangeListItem.prototype,"ThanksGivingDayExchangeListItem");var ThanksGivingDayExchangePanel=function(t){function e(){var e=t.call(this)||this;return e._shopType=0,e._shopID=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),this.returnAllItem()},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e,n){this._shopType=t,this._shopID=e,this._shopItemList=n},e.prototype.reset=function(){this.init&&this.container.reset()},e.prototype.update=function(){if(this.init){if(null==this._shopItemList||0==this._shopItemList.length)return void this.reset();this.returnAllItem();for(var t=0;t<this._shopItemList.length;t++){var e=this._shopItemList[t],n=this.getItem();n.setData(this._shopType,this._shopID,e),this.container.add(n)}this.container.update();var i=ActivityList.getDataByID(ActivityList.ID_ganenjie_exchange);this.label_time.text=ActivityList.getTimeStr(i)}},e.prototype.getItem=function(){var t=ObjectPool.getPool("ThanksGivingDayExchangeListItem").createObject();return nato.attachSkin(t),t},e.prototype.returnAllItem=function(){if(this.container&&this.container.list&&this.container.list.length>0){for(var t=ObjectPool.getPool("ThanksGivingDayExchangeListItem"),e=this.container.list,n=0;n<e.length;n++){var i=e[n];t.returnObject(i)}this.container.reset()}},e}(ComponentBase);__reflect(ThanksGivingDayExchangePanel.prototype,"ThanksGivingDayExchangePanel");var TimeLimitExchangeItem=function(t){function e(){var e=t.call(this)||this;return e._itemID=0,e._bagIcon=0,e._grade=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setData=function(t,e,n){this._itemID=t,this._bagIcon=e,this._grade=n,this.initPanel()},e.prototype.initPanel=function(){this.init&&(this._itemID>0?(this.itemColor_bg.source=xitem.getItemColorTexture(this._grade),this.itemIcon.source=xitem.getItemIcon(this._bagIcon)):(this.itemColor_bg.source=null,this.itemIcon.source=null,this.label_count.text=""))},e.prototype.updateCountInMyBag=function(){var t=0;this._itemID>0&&(t=xself.bag.getItemNumByID(this._itemID)),this.label_count&&(this.label_count.text="x "+t)},e}(ComponentBase);__reflect(TimeLimitExchangeItem.prototype,"TimeLimitExchangeItem");var TimeLimitExchangeListItem=function(t){function e(){var e=t.call(this)||this;return e._shopType=0,e._shopID=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.exchangeItem,this.onExchangeItemTouch,this),ButtonUtils.addTouchEvent(this.btn_exchange,this.onBtnExchange,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.exchangeItem),ButtonUtils.removeTouchEvent(this.btn_exchange)},e.prototype.onExchangeItemTouch=function(){this._shopItem&&AlertPanel.alertItem(this._shopItem)},e.prototype.onBtnExchange=function(){ItemManager.doItemCombin_1(this._shopType,this._shopID,this._shopItem)},e.prototype.setData=function(t,e,n){this._shopType=t,this._shopID=e,this._shopItem=n},e.prototype.reset=function(){this.init&&(this.exchangeItem.itemData=null)},e.prototype.update=function(){if(this.init){if(null==this._shopItem)return void this.reset();this.img_icon.source=GuoQingExchange.getResByShopId(this._shopItem.id),this.exchangeItem.itemData=this._shopItem,this.exchangeItem.update()}},e}(ComponentBase);__reflect(TimeLimitExchangeListItem.prototype,"TimeLimitExchangeListItem");var TimeLimitExchangePanel=function(t){function e(){var e=t.call(this)||this;return e._shopType=0,e._shopID=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),null==this._myItemList&&(this._myItemList=[this.label_count_0,this.label_count_1,this.label_count_2,this.label_count_3,this.label_count_4,this.label_count_5,this.label_count_6,this.label_count_7]),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_close),this.returnAllItem()},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e,n){this._shopType=t,this._shopID=e,this._shopItemList=n},e.prototype.reset=function(){this.init&&(this.updateMyItem(),this.container.reset())},e.prototype.update=function(){if(this.init){if(null==this._shopItemList||0==this._shopItemList.length)return void this.reset();this.updateMyItem(),this.returnAllItem();for(var t=0;t<this._shopItemList.length;t++){var e=this._shopItemList[t],n=this.getItem();n.setData(this._shopType,this._shopID,e),this.container.add(n)}this.container.update();var i=ActivityList.getDataByID(ActivityList.ID_znq_exchange);this.label_time.text=ActivityList.getTimeStr(i)}},e.prototype.getItem=function(){var t=ObjectPool.getPool("TimeLimitExchangeListItem").createObject();return nato.attachSkin(t),t},e.prototype.returnAllItem=function(){if(this.container&&this.container.list&&this.container.list.length>0){for(var t=ObjectPool.getPool("TimeLimitExchangeListItem"),e=this.container.list,n=0;n<e.length;n++){var i=e[n];t.returnObject(i)}this.container.reset()}},e.prototype.updateMyItem=function(){for(var t=0;t<this._myItemList.length;t++){var e=this._myItemList[t],n=GuoQingExchange.ID_list[t],i=xself.bag.getItemNumByID(n);e.text="X"+i}},e}(ComponentBase);__reflect(TimeLimitExchangePanel.prototype,"TimeLimitExchangePanel");var TimeLimitShopPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._shopID=0,e._activityId=0,e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_buy,this.onBtnBuy,this),ButtonUtils.addTouchEvent(this.btn_close,this.onClose,this),this.group_role.touchEnabled=!1,this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_buy),ButtonUtils.removeTouchEvent(this.btn_close)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onBtnBuy=function(){var t=!0,e=ActivityList.getDataByID(this._activityId);if(e){var n=Tool.currentTime/1e3;n>=e.startTime&&n<=e.endTime&&(t=!1)}return t?void AlertPanel.alertCommon("活动时间已过，不能购买"):void(this._selectItem&&this._selectItem.shopItem&&(this._selectItem.shopItem.stackNum>1?PanelManager.openShopItemBuyPanel(this._selectItem.shopItem):ShopItem.doItemShopBuyMsg(xself,this._selectItem.shopItem,1)))},e.prototype.onItemTouch=function(t){var e;t.target instanceof ShopListItem?e=t.target:t.target.parent instanceof ShopListItem&&(e=t.target.parent),e&&e.shopItem&&this.onSelectShop(e)},e.prototype.setData=function(t,e,n){this._shopID=t,this._shopDataList=e,this._selectItem=null,this._activityId=n},e.prototype.initActivity=function(){},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init&&(this.reset(),this.moneyView.setData(xself),this.moneyView.update(),null!=this._shopDataList&&0!=this._shopDataList.length)){for(var t=0,e=0,n=0,i=0;i<this._shopDataList.length;i++){var o=this._shopDataList[i];if(o)n%2==0?(t=0,e=n/2*45*xhdRatio+1*xhdRatio):t=152*xhdRatio,(a=this.getItem()).setShopItem(o),this.container.add(a,t,e),n++}if(this.container.update(),null==this._selectItem){var a,r=this.container.list;if(r&&r.length>0)(a=r[0])&&a.shopItem&&this.onSelectShop(a)}else this.onSelectShop(this._selectItem);var s=ActivityList.getDataByID(this._activityId);this.label_time.text=ActivityList.getTimeStr(s)}},e.prototype.onSelectShop=function(t){return this.clearSpr(),null==t||null==t.shopItem?(this.group_selectItem.visible=!1,void(this.btn_buy.visible=!1)):(this.group_selectItem.visible=!0,this.btn_buy.visible=!0,this._selectItem&&(this._selectItem.select=!1),this._selectItem=t,this._selectItem.select=!0,this.item.itemData=t.shopItem,this.label_itemName.textFlow=Tool.convertDescToTextFlow(t.shopItem.getNameInfo()),t.shopItem.money1>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY1),this.label_price.text=t.shopItem.money1.toString()):t.shopItem.money2>0?(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY2),this.label_price.text=t.shopItem.money2.toString()):t.shopItem.money3>0&&(this.img_priceIcon.source=xitem.getMoneyIconSource(ModelConst.MONEY3),this.label_price.text=t.shopItem.money3.toString()),void(t.shopItem.isCanEquip()&&(this._playerSprite=Player.getCompareSprite(xself,t.shopItem),this._playerSprite.setScale(xhd?1.5:1),this.group_role.addChild(this._playerSprite))))},e.prototype.clearSpr=function(){this.group_role.removeChildren(),this._playerSprite=null},e.prototype.updateMoney=function(){this.init&&this.moneyView.update()},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new ShopListItem,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(TimeLimitShopPanel.prototype,"TimeLimitShopPanel");var TodayEvent=function(){function t(t){this.isFinish=!1,this.isShow=!1,this.finishCount=0,this.maxCount=0,this.sortIndex=0,this.id=0,this.id=t}return t.initData=function(){this._dataList=[];for(var e=1;16>=e;e++){var n=new t(e);n.checkEvent(),this._dataList[e]=n}PlayerDataManager.getPlayerData(this.getPlayerDataBack,this),City.getCityData(xself.getId(),(function(e){if(null!=e&&0==Tool.isNullText(e.cityScaleName)){var n=e.cityScaleName.indexOf("级"),i=Number(e.cityScaleName.substring(0,n));t.myCityLevel=i,t.updateTodayEvent(t.ID_city_task)}}),this)},t.getPlayerDataBack=function(e){if(e){var n=this.getDate();0!=e.msDate&&e.msDate!=n&&(e.msDate=0,e.msList=[],PlayerDataManager.savePlayerData(e)),t.updateTodayEvent(t.ID_taiyangshendian),e.curMsID>0&&(t.curMissionID=e.curMsID)}},t.clean=function(){this._dataList=null,this.myCityLevel=0},Object.defineProperty(t,"dataList",{get:function(){return this._dataList},enumerable:!0,configurable:!0}),t.reqData=function(e,n){function i(){PanelManager.closeWaitForServer(),null!=e&&null!=n&&e.call(n)}PanelManager.openWaitForServer(),Achieve.doAchieveManageMsg((function(e){null!=e&&(e.getNowCount(),t.myAchieve=e,i())}),this)},t.sortList=function(){var e=xself.getLevel();34>e?(this.getTodayEvent(t.ID_city_task).sortIndex=10,this.getTodayEvent(t.ID_xingyueguzhen).sortIndex=9,this.getTodayEvent(t.ID_xingyueguangchang).sortIndex=8,this.getTodayEvent(t.ID_shengyuyiji).sortIndex=7,this.getTodayEvent(t.ID_zijingcheng).sortIndex=6,this.getTodayEvent(t.ID_taiyangshendian).sortIndex=5,this.XingyueguzhenNPC=this.XingyueguzhenNPC_1):49>e?(this.getTodayEvent(t.ID_shengyuyiji).sortIndex=10,this.getTodayEvent(t.ID_taiyangshendian).sortIndex=9,this.getTodayEvent(t.ID_city_task).sortIndex=8,this.getTodayEvent(t.ID_xingyueguzhen).sortIndex=6,this.getTodayEvent(t.ID_xingyueguangchang).sortIndex=5,this.getTodayEvent(t.ID_zijingcheng).sortIndex=4,this.XingyueguzhenNPC=this.XingyueguzhenNPC_2):(this.getTodayEvent(t.ID_zijingcheng).sortIndex=10,this.getTodayEvent(t.ID_taiyangshendian).sortIndex=9,this.getTodayEvent(t.ID_shengyuyiji).sortIndex=8,this.getTodayEvent(t.ID_xingyueguzhen).sortIndex=7,this.getTodayEvent(t.ID_xingyueguangchang).sortIndex=6,this.getTodayEvent(t.ID_city_task).sortIndex=4,this.XingyueguzhenNPC=this.XingyueguzhenNPC_1)},t.sortTodayEvent=function(t,e){if(null!=t&&null!=e){if(t.sortIndex>e.sortIndex)return-1;if(e.sortIndex>t.sortIndex)return 1;if(t.id<e.id)return-1;if(t.id>e.id)return 1}return 0},t.getShowList=function(){var e=[];this.sortList();for(var n=t.dataList,i=0;i<n.length;i++){var o=n[i];null!=o&&(o.checkEvent(),o.isShow&&e.push(o))}return e.sort(this.sortTodayEvent)},t.updateTodayEvent=function(t){if(null!=this._dataList&&0!=this._dataList.length){var e=this._dataList[t];null!=e&&e.checkEvent()}},t.getTodayEvent=function(t){return null!=this._dataList[t]?this._dataList[t]:null},t.prototype.checkEvent=function(){this.id==t.ID_city_task?this.checkCityTask():this.id==t.ID_xingyueguzhen?this.checkXingyueguzhen():this.id==t.ID_xingyueguangchang?this.checkXingyueguangchang():this.id==t.ID_shengyuyiji?this.checkShengyuyiji():this.id==t.ID_taiyangcheng?this.checkTaiyangcheng():this.id==t.ID_zijingcheng?this.checkZijingcheng():this.id==t.ID_taiyangshendian?this.checkTaiyangshendian():this.id==t.ID_skill?this.checkSkill():this.id==t.ID_pet_skill?this.checkPetSkill():this.id==t.ID_task?this.checkTask():this.id==t.ID_repair?this.checkRepair():this.id==t.ID_equip?this.checkEquip():this.id==t.ID_title?this.checkTitle():this.id==t.ID_achieve?this.checkAchieve():this.id==t.ID_randomMission?this.checkRandomMission():this.id==t.ID_joinCountry&&this.checkJoinCountry()},t.prototype.checkCityTask=function(){if(xself&&xself.cityId>0?this.isShow=!0:this.isShow=!1,this.isShow){var e;t.myCityLevel>=3?(e=t.Task_cityList2,t.CityNPC=t.CityNPC_2):(e=t.Task_cityList1,t.CityNPC=t.CityNPC_1);for(var n=0,i=0;i<e.length;i++)t.isTaskListFinish(e[i])&&n++;this.finishCount=n,this.maxCount=e.length,this.isFinish=this.finishCount>=this.maxCount,this.desc="城市日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.isCityTaskFinish=function(t){for(var e=null,n=0;n<t.length;n++){var i=t[n];xself.getLevel()>=Number(i.lv)&&(e=i)}return!(null==e||!Mission.isMissionFinish(xself,e.id))},t.prototype.checkXingyueguzhen=function(){if(xself.getLevel()>=WorldMap.instance.getOpenLevel(WorldMap.ID_xinyueguzhen)?this.isShow=!0:this.isShow=!1,this.isShow){var e=this.getTaskCount(t.Task_xingyueguzhen);if(this.finishCount=e[0],this.maxCount=e[1],0==this.maxCount)return void(this.isShow=!1);this.isFinish=this.finishCount>=this.maxCount,this.desc="新月古镇日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.checkXingyueguangchang=function(){if(xself.getLevel()>=WorldMap.instance.getOpenLevel(WorldMap.ID_xinyueguzhen)?this.isShow=!0:this.isShow=!1,this.isShow){var e=this.getTaskCount(t.Task_xingyueguangchang);if(this.finishCount=e[0],this.maxCount=e[1],0==this.maxCount)return void(this.isShow=!1);this.isFinish=this.finishCount>=this.maxCount,this.desc="新月古镇广场日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.checkShengyuyiji=function(){if(xself.getLevel()>=WorldMap.instance.getOpenLevel(WorldMap.ID_shengyuyiji)?this.isShow=!0:this.isShow=!1,this.isShow){var e=this.getTaskCount(t.Task_shengyuyiji);if(this.finishCount=e[0],this.maxCount=e[1],0==this.maxCount)return void(this.isShow=!1);this.isFinish=this.finishCount>=this.maxCount,this.desc="圣域遗迹日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.checkTaiyangcheng=function(){this.isShow=!1},t.prototype.checkZijingcheng=function(){if(xself.getLevel()>=WorldMap.instance.getOpenLevel(WorldMap.ID_zijingcheng)?this.isShow=!0:this.isShow=!1,this.isShow){var e=this.getTaskCount(t.Task_zijingcheng);if(this.finishCount=e[0],this.maxCount=e[1],0==this.maxCount)return void(this.isShow=!1);this.isFinish=this.finishCount>=this.maxCount,this.desc="紫荆城日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.checkTaiyangshendian=function(){if(xself.cityId>0?this.isShow=!0:this.isShow=!1,this.isShow){var e=PlayerDataManager.playerData.msList,n=t.Task_taiyangshendian;this.finishCount=0,this.maxCount=0;for(var i=xself.getLevel(),o=0;o<n.length;o++){var a=n[o];i>a.lv&&(this.maxCount++,-1!=e.indexOf(a.id)&&this.finishCount++)}if(0==this.maxCount)return void(this.isShow=!1);this.isFinish=this.finishCount>=this.maxCount,this.desc="太阳神殿日常任务 "+PowerString.makeColorString(this.finishCount+"/"+this.maxCount,this.isFinish?ColorUtils.COLOR_YELLOW:ColorUtils.COLOR_GREEN),this.btnDesc="前往查看"}},t.prototype.getTaskCount=function(t){for(var e=0,n=0,i=xself.getLevel(),o=0;o<t.length;o++){var a=t[o];i>=a.lv&&(e++,(Mission.isMissionFinish(xself,a.id)||null!=a.id2&&Mission.isMissionFinish(xself,a.id2))&&n++)}return[n,e]},t.prototype.checkSkill=function(){var t=xself.get(ModelConst.SP);this.isShow=t>=500,this.desc="有技能点学习技能 "+PowerString.makeColorString(t+"点",ColorUtils.COLOR_GREEN),this.btnDesc="学习技能"},t.prototype.checkPetSkill=function(){var t=xself.getPet();if(null!=t){t&&t.get(ModelConst.SP)>=500?this.isShow=!0:this.isShow=!1;var e=t.get(ModelConst.SP);this.desc="宠物有技能点学习技能 "+PowerString.makeColorString(e+"点",ColorUtils.COLOR_GREEN),this.btnDesc="学习技能"}},t.prototype.checkTask=function(){var t=xself.missionList;t&&t.length>0?this.isShow=!0:this.isShow=!1,this.desc="当前有未完成的任务 "+PowerString.makeColorString(t.length+"",ColorUtils.COLOR_GREEN),this.btnDesc="任务面板"},t.prototype.checkRepair=function(){var t=xself.bag.getRepairEquipCount();this.isShow=t>0,this.desc="当前需要修理的装备 "+PowerString.makeColorString(t+"",ColorUtils.COLOR_GREEN),this.btnDesc="修理装备"},t.prototype.checkEquip=function(){if(xself.getLevel()>=45)this.isShow=!1;else{var t=xself.bag.getStrongerEquipCount();this.isShow=t>0,this.desc="背包中有更强力的装备 "+PowerString.makeColorString(t+"",ColorUtils.COLOR_GREEN),this.btnDesc="打开背包"}},t.prototype.checkTitle=function(){var e=xself.getTitle();1==Tool.isNullText(e)&&null!=t.myAchieve&&t.myAchieve.getNowCount()>0?this.isShow=!0:this.isShow=!1,this.desc="您还未设置称号哦",this.btnDesc="前往查看"},t.prototype.checkAchieve=function(){var e=0;t.myAchieve&&(e=t.myAchieve.getAllNewAchieveNum()),this.isShow=e>0,this.isShow&&(this.desc="获得新成就 "+PowerString.makeColorString(e+"",ColorUtils.COLOR_GREEN),this.btnDesc="前往查看")},t.prototype.checkRandomMission=function(){this.isShow=!1},t.prototype.checkJoinCountry=function(){xself&&xself.getCountryId()>0?this.isShow=!1:this.isShow=!0,this.isShow&&(this.desc="尚未加入国家",this.btnDesc="前往查看")},t.prototype.doTodayEvent=function(){this.id==t.ID_city_task?this.doCityTask():this.id==t.ID_xingyueguzhen?this.doXingyueguzhen():this.id==t.ID_xingyueguangchang?this.doXingyueguangchang():this.id==t.ID_shengyuyiji?this.doShengyuyiji():this.id==t.ID_taiyangcheng?this.doTaiyangcheng():this.id==t.ID_zijingcheng?this.doZijingcheng():this.id==t.ID_taiyangshendian?this.doTaiyangshendian():this.id==t.ID_skill?t.doSkill():this.id==t.ID_pet_skill?t.doPetSkill():this.id==t.ID_task?this.doTask():this.id==t.ID_repair?t.doRepair():this.id==t.ID_equip?this.doEquip():this.id==t.ID_achieve||this.id==t.ID_title?this.doAchieveOrTitle():this.id==t.ID_randomMission?this.doRandomMission():this.id==t.ID_joinCountry&&this.doJoinCountry()},t.prototype.doCityTask=function(){t.doAutoFind(t.CityNPC)},t.prototype.doXingyueguzhen=function(){t.doAutoFind(t.XingyueguzhenNPC)},t.prototype.doXingyueguangchang=function(){t.doAutoFind(t.XingyueguangchangNPC)},t.prototype.doShengyuyiji=function(){t.doAutoFind(t.ShengyuyijiNPC)},t.prototype.doTaiyangcheng=function(){},t.prototype.doZijingcheng=function(){t.doAutoFind(t.ZijingchengNPC)},t.prototype.doTaiyangshendian=function(){for(var e=xself.getLevel(),n=PlayerDataManager.playerData,i=t.Task_taiyangshendian,o=0;o<i.length;o++){var a=i[o];if(e>=a.lv&&-1==n.msList.indexOf(a.id))return void t.doAutoFindPath(t.Taiyangshendian[0],a.npc,!1)}t.doAutoFindPath(t.Taiyangshendian[0],t.Taiyangshendian[1],!1)},t.doSkill=function(){var e=t.findSkillNPC(),n=xworld.getCurMapID();-1!=e&&Define.isCommonMap(n)?t.doAutoFindPath(n,e,!1):t.doAutoFind(t.SkillNPC)},t.doPetSkill=function(){t.doAutoFindPath(t.PetSkillNPC[0],t.PetSkillNPC[1],!1)},t.prototype.doTask=function(){PanelManager.openTaskScene(0)},t.doRepair=function(){if(xself.isMember())AlertPanel.alertCommon("正在队伍中，无法前往！");else{var e=t.findRepairNPC();if(-1!=e){var n=xworld.orgMapID;t.doAutoFindPath(n,e,!1)}else t.doAutoFind(t.RepairNPC)}},t.prototype.doEquip=function(){PanelManager.openBag()},t.prototype.doAchieveOrTitle=function(){t.doAutoFind(t.CityAchieveNPC)},t.prototype.doRandomMission=function(){PanelManager.openTaskScene()},t.prototype.doJoinCountry=function(){PanelManager.openManorScene(ManorScene.TAB_INDEX_LIST)},t.doAutoFind=function(e){if(xself.isMember())AlertPanel.alertCommon("正在队伍中，无法前往！");else{t.targetAutoPathData=e;var n=e[0],i=e[1],o=xworld.orgMapID;-1==n?Define.isCityMap(o)?t.doAutoFindNPC():(City.doEnterCity(xself.getId()),t.isWaitForCheckNPC=!0):o==n?t.doAutoFindNPC():t.doAutoFindPath(n,i,!0)}},t.doAutoFindNPC=function(){var e=t.targetAutoPathData,n=e[0],i=xworld.orgMapID;if(-1==n){if(0==Define.isCityMap(i))return}else if(i!=n)return;if(t.isWaitForCheckNPC=!1,Define.isCityMap(i)&&(n=i),-1==e[1]){if(a=xworld.getAchieveNPC())return void this.doAutoFindPath(n,a.getId(),!1)}else for(var o=1;o<e.length;o++){var a,r=e[o];if(a=xworld.getNpcByID(r,!0)){var s=a.getSign();if(0!=s&&4!=s)return void this.doAutoFindPath(n,r,!1)}}e&&n>0&&((r=e[1])>=0&&this.doAutoFindPath(n,r,!1))},t.doAutoFindPath=function(e,n,i){if(xself.isMember())AlertPanel.alertCommon("正在队伍中，无法前往！");else{PanelManager.closeScene(!0);var o=MsgHandler.createAutoMoveMsg(e,n);nato.Network.sendCmd(o,(function(e){PanelManager.closeWaitForServer();var n=e.getByte();if(0>n){var o=e.getString();n!=Mission.AUTO_MOVE_ERROR26&&n!=Mission.AUTO_MOVE_ERROR27&&AlertPanel.alertCommon(o)}else xself.fromBytesByAutoMove(e),xworld.setAutoMissionFindPath(!0),t.isWaitForCheckNPC=i}),this),PanelManager.openWaitForServer()}},t.doAutoFindTaskNPC=function(e,n){if(null!=e&&0!=e.length)for(var i=0;i<e.length;i++){var o=e[i],a=o.id;if(!Mission.isMissionFinish(xself,a))return void t.doAutoFindPath(n,o.npc,!1)}},t.findRepairNPC=function(){var t=xworld.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n&&n.isVisible()&&n.isRepairNPC())return n.getId()}return-1},t.findSkillNPC=function(){var t=xworld.npcList;if(t&&t.length>0)for(var e=0;e<t.length;e++){var n=t[e];if(n&&n.isVisible()&&n.isPlayerSkillTeacher())return n.getId()}return-1},t.isTaskListFinish=function(t){if(t&&t.length>0)for(var e=0;e<t.length;e++)if(Mission.isMissionFinish(xself,t[e]))return!0;return!1},t.getNextTalkTime=function(){for(var e=t.timeList,n=0,i=0;i<t.timeList.length;i++)n+=t.timeList[i].power;var o,a=n*Math.random(),r=0,s=0;for(i=0;i<e.length;i++)if((s+=(o=e[i]).power)>a){r=i;break}return null==(o=e[r])?-1:1e3*(Math.round(60*(o.max-o.min)*Math.random())+60*o.min)},t.getRandomTalk=function(){var e=t.getShowList();if(null==e||0==e.length)return null;for(var n=[],i=0,o=0,a=0;a<e.length;a++){var r=e[a];if(r.id==t.ID_city_task)n.push(t.Talk_1);else if(r.id==t.ID_skill){3e3>(d=xself.get(ModelConst.SP))?n.push(t.Talk_4):n.push(t.Talk_5)}else r.id==t.ID_task?n.push(t.Talk_6):r.id==t.ID_repair?n.push(t.Talk_7):r.id==t.ID_equip?n.push(t.Talk_8):r.maxCount>0&&(i+=r.finishCount,o+=r.maxCount)}if(o>0&&(i/o>=.6?n.push(t.Talk_2):n.push(t.Talk_3)),null!=t.lastTalk){var s=n.indexOf(t.lastTalk);-1!=s&&n.splice(s,1)}var l=0,_=0;for(a=0;a<n.length;a++){l+=(T=n[a]).power,T.rate>_&&(_=T.rate)}var h=l*Math.random(),u=0,c=null;for(a=0;a<n.length;a++){var T;if((u+=(T=n[a]).power)>h){c=T;break}}if(null!=c&&(t.lastTalk=c,100*Math.random()<_)){var p=c.desc;if(null!=c.isSkill&&1==c.isSkill){var d=xself.get(ModelConst.SP);p=Tool.manageString(p,""+d)}return p}return null},t.logic=function(e){if(t.isOpenTodayEvent){if(this._nextShowTime<=0)return void(this._nextShowTime=this.getNextTalkTime());this._nextShowTime-=e,this._nextShowTime<=0&&this.doTalk()}},t.doTalk=function(){this._nextShowTime=this.getNextTalkTime();var t=this.getRandomTalk();0==Tool.isNullText(t)&&PanelManager.mainMenu&&PanelManager.mainMenu.stage&&PanelManager.mainMenu.guideSpriteTalk(t)},t.checkSaveMissionID=function(e){for(var n=!1,i=t.Task_taiyangshendian,o=0;o<i.length;o++){if(i[o].id==e){n=!0;break}}var a=PlayerDataManager.playerData;n?(t.curMissionID=e,a.curMsID=e,PlayerDataManager.savePlayerData(a)):(t.curMissionID=0,0!=a.curMsID&&(a.curMsID=0,PlayerDataManager.savePlayerData(a)))},t.saveMissionIDInPlayerData=function(){var e=t.curMissionID,n=PlayerDataManager.playerData;n.msDate=t.getDate(),n.msList.push(e),n.curMsID=0,PlayerDataManager.savePlayerData(n),t.curMissionID=0,t.updateTodayEvent(t.ID_taiyangshendian)},t.getDate=function(){return(new Date).getDate()},t.checkTask=function(){var e=t.getTodayEvent(t.ID_city_task);e.checkEvent(),e.isShow&&0==e.isFinish?e.doTodayEvent():((e=t.getTodayEvent(t.ID_xingyueguzhen)).checkEvent(),e.isShow&&0==e.isFinish?e.doTodayEvent():PanelManager.openTodayEventPanel())},t.ID_city_task=1,t.ID_xingyueguzhen=2,t.ID_xingyueguangchang=3,t.ID_shengyuyiji=4,t.ID_taiyangcheng=5,t.ID_zijingcheng=6,t.ID_taiyangshendian=7,t.ID_skill=8,t.ID_pet_skill=9,t.ID_task=10,t.ID_randomMission=11,t.ID_repair=12,t.ID_equip=13,t.ID_title=14,t.ID_achieve=15,t.ID_joinCountry=16,t.Task_cityList1=[[3060,3064,3068],[3061,3065,3069],[3062,3066,3070],[3063,3067,3071]],t.Task_cityList2=[[3060,3064,3068],[3061,3065,3069],[3062,3066,3070],[3063,3067,3071],[3072,3074],[3073,3075]],t.Task_xingyueguzhen=[{name:"山洞中的秘宝",id:2709,lv:40},{name:"清明节活动开始啦",id:2811,lv:0}],t.Task_xingyueguangchang=[{name:"BOSS挑战赛-多拉斯",id:2451,lv:50},{name:"BOSS挑战赛-巨石神兵",id:2452,lv:50},{name:"name = BOSS挑战赛-千年魔牛",id:2453,lv:50},{name:"每日赠送凭证",id:2454,lv:50}],t.Task_shengyuyiji=[{name:"绝望冰原的商路保护 ",id:2556,id2:3074,lv:30},{name:"[精英]夜语森林任务",id:2575,lv:35},{name:"远古森林的调查任务",id:2584,lv:40},{name:" 美女节活动任务",id:2599,lv:45}],t.Task_taiyangcheng=[],t.Task_zijingcheng=[{name:"[精英]围歼血烟佣兵团",id:2750,lv:45},{name:"[精英]讨伐月牙山妖魔",id:2774,lv:45},{name:"植树节活动",id:2799,lv:40},{name:"[精英]迎击葬送佣兵团",id:2805,lv:40},{name:"[精英]失魂沙漠讨伐战",id:2765,lv:50},{name:"西城城主的邀请",id:1703,lv:40}],t.Task_taiyangshendian=[{name:"初级组英雄挑战常规赛",id:2592,lv:25,npc:2},{name:"团队混战英雄挑战常规赛",id:2594,lv:50,npc:3},{name:"团队混战挑战赛(高难度)",id:2597,lv:50,npc:3},{name:"团队小组挑战赛(高难度)",id:2606,lv:50,npc:3},{name:"高级组英雄挑战常规赛",id:2593,lv:35,npc:0},{name:"高级组英雄挑战赛(高难度)",id:2596,lv:35,npc:0},{name:"高级组英雄挑战赛(单人小组)",id:2605,lv:35,npc:0}],t.SkillNPC=[906,6],t.PetSkillNPC=[906,16],t.RepairNPC=[906,1],t.CityAchieveNPC=[-1,-1],t.CityNPC=[-1,6,8],t.CityNPC_1=[-1,6,8],t.CityNPC_2=[-1,8,6],t.XingyueguzhenNPC=[5,51,60],t.XingyueguzhenNPC_1=[5,51,60],t.XingyueguzhenNPC_2=[5,60,51],t.XingyueguangchangNPC=[14,103],t.ShengyuyijiNPC=[263,15],t.ZijingchengNPC=[824,22,15],t.Taiyangcheng=[906,5],t.Taiyangshendian=[262,2],t.myCityLevel=0,t.isWaitForCheckNPC=!1,t.Talk_1={rate:50,power:50,desc:"您的城市今天还有/c00ff00日常任务/p还没完成哦"},t.Talk_2={rate:70,power:50,desc:"您今天还有/c00ff00很多日常任务/p没有完成哦"},t.Talk_3={rate:30,power:20,desc:"您今天还有/c00ff00日常任务/p没有完成哦"},t.Talk_4={rate:30,power:10,desc:"您还有技能点/c00ff00%U点/p可以学习技能",isSkill:!0},t.Talk_5={rate:70,power:100,desc:"您有大量的技能点/c00ff00%U点/p可以学习技能",isSkill:!0},t.Talk_6={rate:30,power:10,desc:"您身上还有些任务没有完成"},t.Talk_7={rate:90,power:200,desc:"您身上有装备需要/c00ff00修理/p"},t.Talk_8={rate:80,power:100,desc:"您的背包中有更强力的/c00ff00新装备/p哦"},t.Time_1={min:3,max:5,power:5},t.Time_2={min:6,max:10,power:40},t.Time_3={min:11,max:15,power:10},t.timeList=[t.Time_1,t.Time_2,t.Time_3],t.lastTalk=null,t.isOpenTodayEvent=!1,t._nextShowTime=0,t.curMissionID=0,t}();__reflect(TodayEvent.prototype,"TodayEvent");var TodayEventListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_go,this.onBtnGo,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_go)},e.prototype.onBtnGo=function(){this._data&&this._data.doTodayEvent()},e.prototype.setData=function(t){this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init},e.prototype.update=function(){this.init&&null!=this._data&&(this.label_name.textFlow=Tool.convertDescToTextFlow(this._data.desc),this.btn_go.label=this._data.btnDesc,this.btn_go.visible=!this._data.isFinish)},e}(ComponentBase);__reflect(TodayEventListItem.prototype,"TodayEventListItem");var TodayEventPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._itemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),TodayEvent.reqData(this.update,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.reset=function(){this.init&&(this.container.reset(),this._index=0)},e.prototype.update=function(){if(this.init){this.reset();var t=TodayEvent.getShowList();if(t&&t.length>0){for(var e=0;e<t.length;e++){var n=t[e],i=this.getItem();i.setData(n),this.container.add(i)}this.container.update()}}},e.prototype.getItem=function(){var t=this._itemList[this._index];return null==t&&(t=new TodayEventListItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(TodayEventPanel.prototype,"TodayEventPanel");var TradeBuyItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.initPanel=function(){this.label_name.text=this._data.name,this.icon.itemData=this._data,this._data.money1>0?(this.gold_square_label.text=this._data.money1+"",this.addChild(this.gold_square_group)):Tool.removeObjSafe(this.gold_square_group),this._data.money3>0?(this.gold_coin_label.text=this._data.money3+"",this.addChild(this.gold_coin_group)):Tool.removeObjSafe(this.gold_coin_group)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(TradeBuyItem.prototype,"TradeBuyItem");var TradeBuyPanel=function(t){function e(){var e=t.call(this)||this;return e._isInputSearchName=!1,e._pageCount=7,e._currComboBoxType=0,e._currComboBoxLevel=0,e._currComboBoxGrade=0,e._currSelectItem=0,e._currPage=1,e._currTotalPage=1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.touchEnabled=!1;for(var n=[],i=0,o=Define.goodsTypeText.length;o>i;i++)n.push({value:i,label:Define.goodsTypeText[i]});for(this.type_comboBox.data=n,this.type_comboBox.select=this._currComboBoxType,n=[],i=0,o=Define.goodsLevelText.length;o>i;i++)n.push({value:i,label:Define.goodsLevelText[i]});for(this.level_comboBox.data=n,this.level_comboBox.select=this._currComboBoxLevel,n=[],i=-1,o=Define.gradeText.length;o>i;i++)n.push({value:i,label:Define.getGradeString(i)});this.grade_comboBox.data=n,this.grade_comboBox.select=this._currComboBoxGrade,this.setGradeCBColor(),this.type_comboBox.addEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),this.level_comboBox.addEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),this.grade_comboBox.addEventListener(egret.Event.CHANGE,this.onGradeComboBoxSearch,this),this.turnPage.addEventListener(egret.Event.CHANGE,this.onTurnPage,this),this._isInputSearchName||(this.search_name.text=GameText.getText(GameText.TI_SEARCH_NAME)),this.search_name.addEventListener(egret.Event.FOCUS_IN,this.searchNameFocusIn,this),this.btn_buy.label=GameText.getText(GameText.TI_SHOP_BUY),this.btn_info.label=GameText.getText(GameText.TI_DETAIL),Tool.removeObjSafe(this.btn_info),ButtonUtils.addTouchEvent(this.btn_buy,this.onBuyGoods,this),ButtonUtils.addTouchEvent(this.btn_search,this.onBtnSearch,this),ButtonUtils.addTouchEvent(this.btn_info,this.onPetInfo,this),xevent.addEventListener(WorldEvent.HANG_SELL_BUY_SUCCESS,this.buyItemSuccess,this),this.turnPage.setPage(this._currPage,this._currTotalPage),this.onSearch()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.search_name.removeEventListener(egret.Event.FOCUS_IN,this.searchNameFocusIn,this),this.search_name.removeEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),this.type_comboBox.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),this.level_comboBox.removeEventListener(egret.Event.CHANGE,this.onComboBoxSearch,this),this.grade_comboBox.removeEventListener(egret.Event.CHANGE,this.onGradeComboBoxSearch,this),this.turnPage.removeEventListener(egret.Event.CHANGE,this.onTurnPage,this),ButtonUtils.removeTouchEvent(this.btn_buy),ButtonUtils.removeTouchEvent(this.btn_search),ButtonUtils.removeTouchEvent(this.btn_info),xevent.removeEventListener(WorldEvent.HANG_SELL_BUY_SUCCESS,this.buyItemSuccess,this),this.clearBuyItem(),this._buyItemList=null,this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this.removePlayerSprite(),this._con=null},e.prototype.clearData=function(){this._currComboBoxType=0,this._currComboBoxLevel=0,this._currComboBoxGrade=0,this._currSelectItem=0,this._isInputSearchName=!1,this._currPage=1,this._currTotalPage=1},e.prototype.removePlayerSprite=function(){this._playerSprite&&(Tool.removeObjSafe(this._playerSprite.cloakSprite),Tool.removeObjSafe(this._playerSprite),this._playerSprite=null),Tool.removeObjSafe(this._con)},e.prototype.clearBuyItem=function(){if(this._buyItemList){for(var t=0,e=this._buyItemList.length;e>t;t++)Tool.removeObjSafe(this._buyItemList[t]),ObjectPool.getPool("TradeBuyItem").returnObject(this._buyItemList[t]);this._buyItemList.length=0}},e.prototype.getGoodsFindDataByUI=function(){var t=this.type_comboBox.selectData.value,e=this.grade_comboBox.selectData.value,n=this.level_comboBox.selectData.value,i=this._isInputSearchName?this.search_name.text:"";return[t,e,n,Define.SEARCH_SORT_OBJ_PRICE,Define.SEARCH_SORT_TYPE_ASC,i]},e.prototype.getGoodsSellList=function(){ShopItem.doGoodsSellFindMsg(this.getGoodsFindDataByUI(),this._pageCount,this.turnPage.currentPage,this.returnList,this)},e.prototype.returnList=function(t,e){if(this.stage){for(var n=0,i=t.length;i>n;n++){var o;this._buyItemList||(this._buyItemList=[]),n<this._buyItemList.length?o=this._buyItemList[n]:(o=ObjectPool.getPool("TradeBuyItem").createObject(),nato.attachSkin(o),this._buyItemList.push(o)),o.x=9*xhdRatio,o.y=82*xhdRatio+n*o.height,o.data=t[n],o.parent||this.addChild(o)}if(this.addChild(this.bg),this._buyItemList)for(i=this._buyItemList.length;i>n;n++)this.removeItem(this._buyItemList[n],n),n--,i--;t.length>0?(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._currSelectItem>t.length-1&&(this._currSelectItem=0),this._radioBtns.add(this._buyItemList,this._currSelectItem,!0,!0),this.showPlayerSprite(t[this._currSelectItem])):(this.removePlayerSprite(),Tool.removeObjSafe(this.btn_info)),this.turnPage.totalPage=Math.ceil(e/this._pageCount),this._currTotalPage=this.turnPage.totalPage}},e.prototype.removeItem=function(t,e){Tool.removeObjSafe(this._buyItemList[e]),ObjectPool.getPool("TradeBuyItem").returnObject(this._buyItemList[e]),this._buyItemList.splice(e,1)},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurentSelectItem().data;this.showPlayerSprite(e);var n=Tool.convertDescToTextFlow(e.getDesc(xself,!1,!1));AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),n,"left"),this._currSelectItem=this._radioBtns.getCurrentIndex()},e.prototype.onTurnPage=function(){this._currPage=this.turnPage.currentPage,this.onSearch()},e.prototype.onBtnSearch=function(){this.turnPage.setPage(),this._currPage=1,this.onSearch()},e.prototype.onSearch=function(){this.getGoodsSellList()},e.prototype.setGradeCBColor=function(){this.grade_comboBox.setColor(ColorUtils.getGradeColor(this.grade_comboBox.selectData.value))},e.prototype.onGradeComboBoxSearch=function(){this._currComboBoxGrade=this.grade_comboBox.select,this.setGradeCBColor(),this.onComboBoxSearch(null)},e.prototype.onComboBoxSearch=function(t){t&&(t.currentTarget==this.type_comboBox?this._currComboBoxType=this.type_comboBox.select:t.currentTarget==this.level_comboBox&&(this._currComboBoxLevel=this.level_comboBox.select)),this.turnPage.setPage(),this._currPage=1,this.onSearch()},e.prototype.onBuyGoods=function(t){if(this._radioBtns&&this._radioBtns.getCurentSelectItem()){var e=this._radioBtns.getCurentSelectItem().data;ShopItem.doGoodsSellBuyMsg(e)}},e.prototype.buyItemSuccess=function(t){var e=this._radioBtns.getCurentSelectItem(),n=this._buyItemList.indexOf(e);n>=0&&(this._radioBtns.removeItem(e,!1),this.removeItem(e,n))},e.prototype.searchNameFocusIn=function(t){this.search_name.addEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),this._isInputSearchName||(this.search_name.text="")},e.prototype.searchNameFocusOut=function(t){this.search_name.removeEventListener(egret.Event.FOCUS_OUT,this.searchNameFocusOut,this),""==this.search_name.text?(this._isInputSearchName=!1,this.search_name.text=GameText.getText(GameText.TI_SEARCH_NAME)):this._isInputSearchName=!0},e.prototype.showPlayerSprite=function(t){this.removePlayerSprite(),t.isPetType()?this.addChild(this.btn_info):Tool.removeObjSafe(this.btn_info),t.isCanEquip()&&(null==this._playerSprite&&(this._playerSprite=Player.getCompareSprite(xself,t),this._playerSprite.setScale(nato.mapRatio)),this._con||(this._con=new egret.DisplayObjectContainer,this._con.x=40*xhdRatio,this._con.y=60*xhdRatio,this._con.scaleX=-1,this._con.touchChildren=this._con.touchEnabled=!1),this.addChild(this._con),this._con.addChild(this._playerSprite))},e.prototype.update=function(){},e.prototype.onPetInfo=function(){var t=this._radioBtns.getCurentSelectItem();if(t){var e=t.data,n=new MyPet(null);n.petItem=e;MyPet.doPetInfoMsg(n,MsgHandler.PET_INFO_GOODS,[e.goodId],(function(){PanelManager.openPetDetailScene(n,PetDetailScene.FromType_trade)}),this)}},e}(ComponentBase);__reflect(TradeBuyPanel.prototype,"TradeBuyPanel");var TradeEntryPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_entry_actor,this.onEntryActor,this),ButtonUtils.addTouchEvent(this.btn_entry_goods,this.onEntryGoods,this),this.btn_entry_actor.label=GameText.getText(GameText.TI_ENTER),this.btn_entry_goods.label=GameText.getText(GameText.TI_ENTER),this.headIcon()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_entry_actor),ButtonUtils.removeTouchEvent(this.btn_entry_goods),Tool.removeObjSafe(this.headSpr),this.headSpr=null},e.prototype.closePanel=function(){PanelManager.closeScene()},e.prototype.onEntryActor=function(){0!=SafeLock.doSafeLockVerify(this.onEntryActor,this)&&(this.closePanel(),PanelManager.openActorBuyPanel())},e.prototype.onEntryGoods=function(){0!=SafeLock.doSafeLockVerify(this.onEntryGoods,this)&&(this.closePanel(),PanelManager.openTradeScene())},e.prototype.headIcon=function(){if(xself&&0!=xself.getIcon1()&&null==this.headSpr){var t=xself.getIcon1()>>Model.OFFSET_SEX&Model.LEN_SEX,e=t==Define.SEX_MALE?GameSprite.SPRITE_MAN_HEAD:GameSprite.SPRITE_WOMAN_HEAD;this.headSpr=SpriteHelper.createSprite(e),this.headSpr.x=43*xhdRatio,this.headSpr.y=319*xhdRatio,this.headSpr.setScale(xhd?2.7:1.25),this.addChild(this.headSpr);var n=new ChangeSpriteInfo(xself.getIcon1(),0,0,t,0,0,0,0,!1,!1);this.headSpr.doChangeSpriteIcon(n)}},e}(WindowPanelBase);__reflect(TradeEntryPanel.prototype,"TradeEntryPanel");var TradeHangSellPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bagView.setData(xself),this.bagView.setAction(GameText.getText(GameText.TI_HANG_SELL),this.onBtnSell,this.onItemSelect,this),this.btn_cancelSell.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelSellItem,this),xevent.addEventListener(WorldEvent.HANG_SELL_SUCCESS,this.hangSellSuccess,this),xevent.addEventListener(WorldEvent.CANCEL_HANG_SELL_SUCCESS,this.cancelHangSellSuccess,this),xevent.addEventListener(WorldEvent.HANG_SELL_READY,this.onBtnSell,this),this.showSellItem()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;this["item"+n]&&this["item"+n].itemData;)this["item"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sellItemOnTouch,this),n++;xevent.removeEventListener(WorldEvent.HANG_SELL_SUCCESS,this.hangSellSuccess,this),xevent.removeEventListener(WorldEvent.CANCEL_HANG_SELL_SUCCESS,this.cancelHangSellSuccess,this),xevent.removeEventListener(WorldEvent.HANG_SELL_READY,this.onBtnSell,this),this.btn_cancelSell.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelSellItem,this),this._curSelectItem&&(this._curSelectItem.select=!1,this._curSelectItem=null)},e.prototype.onBtnSell=function(){if(0!=SafeLock.doSafeLockVerify()){var t=this.bagView.selectItem;if(t&&t.itemData)this["item"+ShopItem.shopList.length]?CommonFormPanel.handSell(t.itemData,this,this.confirmHangSell,t.itemData):AlertPanel.alertCommon(GameText.STR_GOODS_SELL_FULL);else AlertPanel.alertCommon(GameText.STR_GOODS_SELL_NO_SELECT)}},e.prototype.confirmHangSell=function(t,e){var n=t.length>2?parseInt(t[2]):1;n>e.quantity&&(n=e.quantity),(""!=t[0]||""!=t[1])&&ShopItem.doGoodsSellSubmitMsg(xself,e,n,parseInt(""==t[0]?"0":t[0]),parseInt(""==t[1]?"0":t[1]))},e.prototype.cancelSellItem=function(t){this._curSelectItem&&this._curSelectItem.itemData?ShopItem.doGoodsSellRetrieveMsg(this._curSelectItem.itemData):AlertPanel.alertCommon(GameText.STR_GOODS_CANCEL_SELL_NO_SELECT)},e.prototype.onItemSelect=function(){var t=this.bagView.selectItem;t&&t.itemData&&PanelManager.openItemView(t.itemData,12,xself)},e.prototype.showSellItem=function(){ShopItem.doGoodsSellListMsg(this.getSellList,this)},e.prototype.getSellList=function(t){ShopItem.shopList=t,this.updateSellUI()},e.prototype.updateSellUI=function(){for(var t=ShopItem.shopList,e=0;this["item"+e];)t&&t[e]?(this["item"+e].itemData=t[e],this["item"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.sellItemOnTouch,this)):this["item"+e].itemData=null,e++},e.prototype.sellItemOnTouch=function(t){var e=t.currentTarget;e&&e.itemData&&(this._curSelectItem&&(this._curSelectItem.select=!1),this._curSelectItem=e,this._curSelectItem.select=!0,PanelManager.openItemView(e.itemData,13,xself))},e.prototype.hangSellSuccess=function(t){this.bagView.update()},e.prototype.cancelHangSellSuccess=function(t){this.updateSellUI(),this.bagView.update()},e}(ComponentBase);__reflect(TradeHangSellPanel.prototype,"TradeHangSellPanel");var TradeOrderItemBtn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);__reflect(TradeOrderItemBtn.prototype,"TradeOrderItemBtn");var TradeOrderPanel=function(t){function e(){var e=t.call(this)||this;return e.currentSelectIndex=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ShopItem.doGoodsPurchaseMyListMsg(this.getMyList,this),this.title_0.text=GameText.STR_ORDER_RELEASING,this.title_1.text=GameText.STR_MY_ORDER,this.onItemSelect(null),this.btn_extraction_order.label=GameText.STR_EXTRACTION_ORDER,this.btn_cancel_order.label=GameText.STR_CANCEL_ORDER,ButtonUtils.addTouchEvent(this.btn_extraction_order,this.onExtractionOrder,this),ButtonUtils.addTouchEvent(this.btn_cancel_order,this.onCancelOrder,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;this["btn_type_"+n];)this["btn_item_"+n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemSelect,this),n++;this.itemBtns=null,this.myOrderItemArr=null,ButtonUtils.removeTouchEvent(this.btn_extraction_order),ButtonUtils.removeTouchEvent(this.btn_cancel_order)},e.prototype.getMyList=function(t){if(this.stage){this.myOrderItemArr=t,this.itemBtns=[];for(var e=0;this["btn_item_"+e];)this["item_group_"+e].touchChildren=!1,this["item_group_"+e].touchEnabled=!1,this["btn_item_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemSelect,this),this.itemBtns.push(this["btn_item_"+e]),e++;this.updateItemIcon(),ButtonUtils.selectTabBtnList(this.itemBtns,this.currentSelectIndex)}},e.prototype.updateItemIcon=function(){for(var t=0;this["btn_item_"+t];)this["item_group_"+t].touchChildren=!1,this["item_group_"+t].touchEnabled=!1,t<this.myOrderItemArr.length?(this["item_group_"+t].addChild(this["btn_item_icon_"+t]),this["item_group_"+t].addChild(this["btn_item_border_"+t]),this["btn_item_icon_"+t].setData(this.myOrderItemArr[t].bagIcon,this.myOrderItemArr[t].grade),this["btn_item_"+t].label=this.myOrderItemArr[t].name,Tool.removeObjSafe(this["btn_item_bg_"+t])):(this["item_group_"+t].addChild(this["btn_item_bg_"+t]),Tool.removeObjSafe(this["btn_item_icon_"+t]),Tool.removeObjSafe(this["btn_item_border_"+t]),this["btn_item_"+t].label=GameText.STR_NO_ITEM),t++;this.onItemSelect(null)},e.prototype.onTypeSelect=function(t){PanelManager.closeTradeOrderPanel(this.typeBtns.indexOf(t.currentTarget))},e.prototype.onItemSelect=function(t){if(t&&(this.currentSelectIndex=this.itemBtns.indexOf(t.currentTarget)),ButtonUtils.selectTabBtnList(this.itemBtns,this.currentSelectIndex),this.myOrderItemArr&&this.currentSelectIndex<this.myOrderItemArr.length){var e=this.myOrderItemArr[this.currentSelectIndex];this.order_count.text=e.goodPurchaseCount+"/"+e.quantity,this.order_time.text=Tool.getTimeStrByMin(e.expireTime,!0),this.label_money3.text=e.money3+"",this.label_money1.text=e.money1+""}else this.order_count.text="",this.order_time.text="",this.label_money3.text="",this.label_money1.text=""},e.prototype.onExtractionOrder=function(){ShopItem.doGoodsPurchaseGetMsg(this.myOrderItemArr[this.currentSelectIndex])},e.prototype.onCancelOrder=function(){ShopItem.doGoodsPurchaseCancelMsg(this.myOrderItemArr[this.currentSelectIndex],this.cancelOrderCallBack,this)},e.prototype.cancelOrderCallBack=function(){this.stage&&(this.myOrderItemArr[this.currentSelectIndex]&&this.myOrderItemArr.splice(this.myOrderItemArr.indexOf(this.myOrderItemArr[this.currentSelectIndex]),1),this.updateItemIcon())},e}(TradeTypeSelectPanel);__reflect(TradeOrderPanel.prototype,"TradeOrderPanel");var TradePurchaseItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.public_order_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPublicOrder,this),this.initPanel()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.public_order_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPublicOrder,this)},e.prototype.onPublicOrder=function(t){0!=SafeLock.doSafeLockVerify()&&(t.stopImmediatePropagation(),xevent.dispatchEvent(new WorldEvent(WorldEvent.PUBLIC_ORDER)),CommonFormPanel.publicOrder(this,this.publicOrderOK))},e.prototype.publicOrderOK=function(t){var e=""==t[0]?0:parseInt(t[0]),n=""==t[1]?0:parseInt(t[1]),i=""==t[2]?0:parseInt(t[2]);ShopItem.doGoodsPurchaseSubmitMsg(this._data,e,n,i)},e.prototype.initPanel=function(){this.item_name_label.text=this._data.name,this.icon.itemData=this._data,this.public_order_btn.label=GameText.STR_ORDER_RELEASING},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.stage&&this.initPanel()},enumerable:!0,configurable:!0}),e}(ComponentBase);__reflect(TradePurchaseItem.prototype,"TradePurchaseItem");var TradePurchasePanel=function(t){function e(){var e=t.call(this)||this;return e._pageCount=7,e._typeComboBoxDefault=0,e._currPage=1,e._radioDefault=0,e._isClear=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"typeComboBoxDefault",{set:function(t){this._typeComboBoxDefault=t},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.btn_order.label=GameText.GAME_TEXT[GameText.TI_ORDER],ButtonUtils.addTouchEvent(this.btn_order,this.onBtnOrder,this);for(var n=[],i=1,o=Define.purchaseType.length;o>i;i++)n.push({value:i,label:Define.getPurchaseTypeText(i)+""});this.type_comboBox.data=n,this.type_comboBox.select=this._typeComboBoxDefault,this.type_comboBox.addEventListener(egret.Event.CHANGE,this.onChangeType,this),this.getPurchaseList(this._typeComboBoxDefault+1),this.turnPage.pageCount=this._pageCount,this.turnPage.addEventListener(egret.Event.CHANGE,this.turnPageChange,this),xevent.addEventListener(WorldEvent.PUBLIC_ORDER,this.onPublicOrder,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.PUBLIC_ORDER,this.onPublicOrder,this),this.type_comboBox.removeEventListener(egret.Event.CHANGE,this.onChangeType,this),this.clearBuyItem(),this._purchaseItemList=null,ButtonUtils.removeTouchEvent(this.btn_order),this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this.turnPage.removeEventListener(egret.Event.CHANGE,this.turnPageChange,this),this._isClear&&(this._currPage=1,this._typeComboBoxDefault=0,this._radioDefault=0),this._isClear=!0},e.prototype.clearBuyItem=function(){if(this._purchaseItemList){for(var t=0,e=this._purchaseItemList.length;e>t;t++)Tool.removeObjSafe(this._purchaseItemList[t]),ObjectPool.getPool("TradePurchaseItem").returnObject(this._purchaseItemList[t]);this._purchaseItemList.length=0}},e.prototype.onChangeType=function(t){this._currPage=1,this.turnPage.setPage(),this.getPurchaseList(this.type_comboBox.selectData.value),this._typeComboBoxDefault=this.type_comboBox.selectData.value-1},e.prototype.getPurchaseList=function(t){ShopItem.doGoodsPurchaseTypeListMsg(t,this.returnPurchaseList,this)},e.prototype.returnPurchaseList=function(t){this.turnPage.data(t,this._currPage)},e.prototype.turnPageChange=function(t){var e=this.turnPage.currentPageData;if(e)for(var n=0,i=e.length;i>n;n++){var o;this._purchaseItemList||(this._purchaseItemList=[]),n<this._purchaseItemList.length?o=this._purchaseItemList[n]:(o=ObjectPool.getPool("TradePurchaseItem").createObject(),nato.attachSkin(o),this._purchaseItemList.push(o)),o.x=9*xhdRatio,o.y=50*xhdRatio+(o.height+1)*n,o.data=e[n],o.parent||this.addChild(o)}if(this.addChild(this.bg),e&&e.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._radioBtns.add(this._purchaseItemList,this._radioDefault,!0,!0)),this._purchaseItemList)for(i=this._purchaseItemList.length;i>n;n++)ObjectPool.getPool("TradePurchaseItem").returnObject(this._purchaseItemList[n]),Tool.removeObjSafe(this._purchaseItemList[n]),this._purchaseItemList.splice(n,1),n--,i--;this._currPage=this.turnPage.currentPage},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurentSelectItem().data,n=Tool.convertDescToTextFlow(e.getDesc(xself,!1,!1));AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),n,"left"),this._radioDefault=this._radioBtns.getCurrentIndex()},e.prototype.onBtnOrder=function(){PanelManager.openTradeOrderPanel()},e.prototype.onPublicOrder=function(){this._isClear=!1},e}(ComponentBase);__reflect(TradePurchasePanel.prototype,"TradePurchasePanel");var TradeScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){this.tabPanelList=[this.buy_panel,this.hang_sell_panel,this.supply_panel,this.purchase_panel],t.prototype.onAddToStage.call(this,e)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),xevent.removeEventListener(WorldEvent.SUPPLY_IN_BAG,this.onSupplyInBag,this),xevent.removeEventListener(WorldEvent.RETURN_SEE_ORDER,this.returnSeeOrder,this)},e.prototype.closePanel=function(){ShopItem.shopList=null,this.hang_sell_panel&&this.hang_sell_panel.bagView.clearSelected(),this.buy_panel&&this.buy_panel.clearData(),t.prototype.closePanel.call(this)},e.prototype.updateTab=function(){t.prototype.updateTab.call(this);var e=this.getCurrentPanel();e instanceof TradeSupplyPanel?(xevent.addEventListener(WorldEvent.SUPPLY_IN_BAG,this.onSupplyInBag,this),xevent.addEventListener(WorldEvent.RETURN_SEE_ORDER,this.returnSeeOrder,this)):(xevent.removeEventListener(WorldEvent.SUPPLY_IN_BAG,this.onSupplyInBag,this),xevent.removeEventListener(WorldEvent.RETURN_SEE_ORDER,this.returnSeeOrder,this)),this.buy_panel&&e!=this.buy_panel&&this.buy_panel.clearData()},e.prototype.onSupplyInBag=function(t){this.supply_panel.isOpenBag=!0},e.prototype.showSubPanel=function(t){this.removeAllPanel(),this.addChild(t)},e.prototype.closeOrderPanel=function(t,e){t instanceof TradeOrderPanel?this.purchase_panel.typeComboBoxDefault=e:this.supply_panel.typeComboBoxDefault=e,this.updateTab()},e.prototype.returnSeeOrder=function(t){this.supply_panel&&(this.supply_panel.currPageList=t.param),PanelManager.closeTradeSupplyBagPanel(Define.goodsTypeToPurchaseType(t.param[0].type)-1)},e.prototype.removeAllPanel=function(){t.prototype.removeAllPanel.call(this);var e=PanelManager.getPanel(TradeOrderPanel,!1),n=PanelManager.getPanel(TradeSupplyBagPanel,!1);e&&e.parent&&e.parent.removeChild(e),n&&n.parent&&n.parent.removeChild(n)},e}(TabPanelBase);__reflect(TradeScene.prototype,"TradeScene");var TradeSupplyBagPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.bagView.setData(xself),this.bagView.setAction(GameText.getText(GameText.TI_SUPPLY),this.onBtnSupply,this.onItemSelect,this),this.title_0.text=GameText.STR_SEE_ORDER},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),this.bagView.clearSelected()},e.prototype.onTypeSelect=function(t){PanelManager.closeTradeSupplyBagPanel(this.typeBtns.indexOf(t.currentTarget))},e.prototype.onBtnSupply=function(){var t=this.bagView.selectItem;t&&t.itemData?t.itemData.quantity>1?(xevent.dispatchEvent(new WorldEvent(WorldEvent.SUPPLY_IN_BAG)),CommonFormPanel.supply(t.itemData.quantity,this,this.supplyConfirm,t.itemData)):ShopItem.getGoodsProvideInfo(t.itemData,1,[0,0]):AlertPanel.alertCommon(GameText.STR_GOODS_SUPPLY_NO_SELECT)},e.prototype.supplyConfirm=function(t,e){parseInt(t[0])>0&&ShopItem.getGoodsProvideInfo(e,parseInt(t[0]),[0,0])},e.prototype.onItemSelect=function(){var t=this.bagView.selectItem;t&&t.itemData&&PanelManager.openItemView(t.itemData,5,xself)},e}(TradeTypeSelectPanel);__reflect(TradeSupplyBagPanel.prototype,"TradeSupplyBagPanel");var NPCConst,ButtonUtils,TradeSupplyPanel=function(t){function e(){var e=t.call(this)||this;return e._pageCount=7,e._radioDefault=0,e._typeComboBoxDefault=0,e._isClearPageList=!0,e._currPageNum=1,e._currPageSize=1,e._currItemSelect=0,e.isOpenBag=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"typeComboBoxDefault",{set:function(t){this._typeComboBoxDefault=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currPageList",{set:function(t){this._currPageList=t},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),this.isOpenBag)this.onBtnBag();else{this.btn_supply.label=GameText.GAME_TEXT[GameText.TI_SUPPLY],this.btn_bag.label=GameText.GAME_TEXT[GameText.TI_BAG],ButtonUtils.addTouchEvent(this.btn_supply,this.onBtnSupply,this),ButtonUtils.addTouchEvent(this.btn_bag,this.onBtnBag,this),xevent.addEventListener(WorldEvent.SUPPLY_SUCCESS,this.supplySuccess,this);for(var n=[],i=1,o=Define.purchaseType.length;o>i;i++)n.push({value:i,label:Define.getPurchaseTypeText(i)+""});this.type_comboBox.data=n,this.type_comboBox.select=this._typeComboBoxDefault,this.type_comboBox.addEventListener(egret.Event.CHANGE,this.onChangeType,this),this._currPageList?(this.setPageData(this._currPageList),this.turnPage.setPage(this._currPageNum,this._currPageSize)):this.getSupplyList(this._typeComboBoxDefault+1),this.turnPage.pageCount=this._pageCount,this.turnPage.addEventListener(egret.Event.CHANGE,this.turnPageChange,this),this._isClearPageList=!0}},e.prototype.onRemoveFromStage=function(e){if(t.prototype.onRemoveFromStage.call(this,e),this.isOpenBag=!1,ButtonUtils.removeTouchEvent(this.btn_supply),ButtonUtils.removeTouchEvent(this.btn_bag),xevent.removeEventListener(WorldEvent.SUPPLY_SUCCESS,this.supplySuccess,this),this._supplyItemList){for(var n=0,i=this._supplyItemList.length;i>n;n++)this.removeItem(this._supplyItemList[n],n),n--,i--;this._supplyItemList=null}this._radioBtns&&(this._radioBtns.removeEventListener(egret.Event.CHANGE,this.selectItem,this),ObjectPool.getPool("RadioButtonComponent").returnObject(this._radioBtns),this._radioBtns=null),this._isClearPageList&&(this._currPageList=null,this._currItemSelect=0)},e.prototype.getSupplyList=function(t){ShopItem.doGoodsPurchaseListMsg(t,null,this._pageCount,this.turnPage.currentPage,this.returnSupplyList,this)},e.prototype.returnSupplyList=function(t,e){if(this.stage){this._currPageList=t,this._currPageSize=Math.ceil(e/this._pageCount),this.turnPage.totalPage=this._currPageSize;for(var n=0,i=t.length;i>n;n++)t[n].quantity<=0&&(t.splice(n,1),n--,i--);this.setPageData(t)}},e.prototype.setPageData=function(t){for(var e=0,n=t.length;n>e;e++){var i;this._supplyItemList||(this._supplyItemList=[]),t[e].isStatusBit(512)||t[e].quantity<=0?this._supplyItemList[e]&&this.removeItem(this._supplyItemList[e],e):(e<this._supplyItemList.length?i=this._supplyItemList[e]:(i=ObjectPool.getPool("TradeBuyItem").createObject(),nato.attachSkin(i),this._supplyItemList.push(i)),i.x=9*xhdRatio,i.y=50*xhdRatio+e*(i.height+1),i.data=t[e],i.parent||this.addChild(i))}if(this.addChild(this.bg),t.length>0&&(this._radioBtns||(this._radioBtns=ObjectPool.getPool("RadioButtonComponent").createObject(),this._radioBtns.addEventListener(egret.Event.CHANGE,this.selectItem,this)),this._radioBtns.add(this._supplyItemList,this._currItemSelect,!0,!0)),this._supplyItemList)for(n=this._supplyItemList.length;n>e;e++)this.removeItem(this._supplyItemList[e],e),e--,n--},e.prototype.removeItem=function(t,e){Tool.removeObjSafe(this._supplyItemList[e]),ObjectPool.getPool("TradeBuyItem").returnObject(this._supplyItemList[e]),this._supplyItemList.splice(e,1)},e.prototype.selectItem=function(t){var e=this._radioBtns.getCurentSelectItem().data,n=Tool.convertDescToTextFlow(e.getDesc(xself,!1,!1));AlertPanel.alertTipsTextFlow(GameText.getText(GameText.TI_WARM_SHOW),n,"left")},e.prototype.onBtnSupply=function(){if(0!=SafeLock.doSafeLockVerify()&&this._radioBtns){var t=this._radioBtns.getCurentSelectItem();t&&(t.data.quantity>1?(this._isClearPageList=!1,this._currItemSelect=this._radioBtns.getCurrentIndex(),CommonFormPanel.supply(t.data.quantity,this,this.supplyConfirm,t.data)):ShopItem.doGoodsProvideMsg(t.data,0))}},e.prototype.onBtnBag=function(){PanelManager.openTradeSupplyBagPanel()},e.prototype.supplyConfirm=function(t,e){parseInt(t[0])>0&&ShopItem.doGoodsProvideMsg(e,parseInt(t[0]))},e.prototype.supplySuccess=function(t){this.setPageData(this._currPageList)},e.prototype.onChangeType=function(t){this.turnPage.setPage(),this.getSupplyList(this.type_comboBox.selectData.value),this._typeComboBoxDefault=this.type_comboBox.selectData.value-1},e.prototype.turnPageChange=function(t){this._currPageNum=this.turnPage.currentPage,this.getSupplyList(this.type_comboBox.selectData.value)},e}(ComponentBase);__reflect(TradeSupplyPanel.prototype,"TradeSupplyPanel"),function(t){t.SHOW_WELCOME_RANGE=48,t.EVENT_ALL_BACK=-1,t.EVENT_MISSION_FIGHT=1e3,t.SUB_MISSION_NPC_MENU=1,t.SUB_MISSION_OFFLINE_LIST=2,t.SUB_MISSION_OFFLINE_INFO=3,t.SUB_MISSION_ESCORT_INFO=4,t.SUB_MISSION_DIRECT_STEP1=5,t.SUB_MISSION_DIRECT_STEP2=6,t.SUB_MISSION_ACCEPT=7,t.SUB_MISSION_DOING=8,t.SUB_MISSION_VIEW=9,t.SUB_MISSION_SUBMIT_NORMAL=10,t.SUB_MISSION_MAIL=11,t.SUB_MISSION_ONE_ACCEPT=12,t.SUB_MISSION_ONE_SUBMIT=13,t.SUB_RANDOM_MISSION_CHANGE=14,t.SUB_SPRITE_GUIDE=15,t.EVENT_ALL_TASK_ACCEPT=11023,t.EVENT_ALL_TASK_PATH=11024,t.EVENT_ALL_TASK_DEL=11025,t.EVENT_ALL_TASK_SUBMIT=11026,t.EVENT_ALL_TASK_ITEM_SEE=11027,t.EVENT_ALL_RANDOM_MISSION_MENU=11029,t.EVENT_ALL_RANDOM_MISSION_REFLASH=11030,t.EVENT_ALL_TASK_OFF_ACTIVATE=11094,t.EVENT_ALL_TASK_DIRECT_STEP2=11095}(NPCConst||(NPCConst={})),function(t){var e,n;t.buttonTweenEffect=function(t,e,n,i){var o=t.x,a=t.y,r=Math.ceil(o+(1-.8)*t.width/2),s=Math.ceil(a+(1-.8)*t.height/2);t instanceof eui.Label&&(s+=1);var l=t.scaleX,_=t.scaleY,h=l-.2,u=_-.2;if(e){t.touchEnabled=!1;egret.Tween.get(t).to({scaleX:h,scaleY:u,x:r,y:s},40).to({scaleX:l,scaleY:_,x:o,y:a},40).call((function(){t.touchEnabled=!0})).call(e,n,i)}else egret.Tween.get(t).to({scaleX:h,scaleY:u,x:r,y:s},40).to({scaleX:l,scaleY:_,x:o,y:a},40)},t.addTouchEvent=function(t,n,i,o){if(t){var a=function(){egret.callLater((function(){n.apply(i,o)}),this)};if(null==e&&(e={}),e[t.hashCode]){var r=e[t.hashCode];t.removeEventListener(egret.TouchEvent.TOUCH_TAP,r,this)}e[t.hashCode]=a,t.addEventListener(egret.TouchEvent.TOUCH_TAP,a,this)}},t.removeTouchEvent=function(t){if(t&&e&&null!=e[t.hashCode]){var n=e[t.hashCode];t.removeEventListener(egret.TouchEvent.TOUCH_TAP,n,this),delete e[t.hashCode]}},t.selectTabBtnList=function(t,e){if(t&&!(t.length<=0))for(var n=0;n<t.length;n++){var i=t[n];i&&(i.currentState=n==e?"up":"down")}},t.addMenuBtnTouchEvent=function(t,e,i,o){function a(){e&&(e.visible=!0),egret.setTimeout((function(){e&&(e.visible=!1),i.call(o)}),this,50)}if(null!=t){if(null==n&&(n={}),n[t.hashCode]){var r=n[t.hashCode];t.removeEventListener(egret.TouchEvent.TOUCH_TAP,r,this)}n[t.hashCode]=a,t.addEventListener(egret.TouchEvent.TOUCH_TAP,a,this)}},t.removeMenuBtnTouchEvent=function(t){if(t&&n&&null!=n[t.hashCode]){var e=n[t.hashCode];t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this),delete n[t.hashCode]}}}(ButtonUtils||(ButtonUtils={}));var ColorUtils=function(){function t(){}return t.getGradeColor=function(t){switch(t){case Define.GRADE_0:return 15066597;case Define.GRADE_1:return 4978754;case Define.GRADE_2:return 4369912;case Define.GRADE_3:return 16753920;case Define.GRADE_4:return 16535036}return 16777215},t.changeColorNumberToString=function(t,e){void 0===e&&(e="");for(var n=t.toString(16);n.length<6;)n="0"+n;return null==e&&(e=""),e+n},t.COLOR_WHITE=16777215,t.COLOR_GREEN=65280,t.COLOR_BLUE=2658248,t.COLOR_PURPLE=16535036,t.COLOR_ORANGE=16753920,t.COLOR_YELLOW=16776960,t.COLOR_BLACK=0,t.COLOR_RED=16711680,t.COLOR_BROWN=6710886,t.COLOR_GOLD_YELLOW=16439945,t.COLOR_GRAY=11576954,t.COLOR_MONEY2=10144511,t.COLOR_MONEY3=12867346,t.COLOR_BACKGROUND=t.COLOR_BLACK,t.COLOR_TEXT_GOLD=16765054,t.COLOR_YELLOW_GOLD=16763904,t}();__reflect(ColorUtils.prototype,"ColorUtils");var ObjectPool=function(){function t(t){this.className=t,this.list={}}return t.prototype.createObject=function(){for(var t in this.list){var e=this.list[t];return delete this.list[t],e[0]}return new(egret.getDefinitionByName(this.className))},t.prototype.returnObject=function(t){this.list[t.hashCode]||(this.list[t.hashCode]=[t,Define.default_clear_time])},t.getPool=function(e){return t.pool[e]||(t.pool[e]=new t(e)),t.pool[e]},t.chcek=function(e){for(var n in t.pool){var i=t.pool[n].list,o=!0;for(var a in i){var r=i[a];r[1]-=e,r[1]<=0?delete i[a]:o=!1}o&&delete t.pool[n]}},t.clean=function(){t.pool={}},t.pool={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var PowerString=function(){function t(t){void 0===t&&(t=null)}return t.makeRewardIconString=function(t,e){for(var n=t.toString();n.length<2;)n="0"+n;return"/j"+n+e.toString()},t.makeIconString=function(t,e){return""},t.makeFaceString=function(t){return""},t.makeMissionString=function(t){return""},t.makeColorString=function(e,n){for(var i=n.toString(16);i.length<6;)i="0"+i;return t.CHAR_SPLIT+t.CHAR_COLOR_STRING+i+e+t.CHAR_SPLIT+t.CHAR_END},t.makeIndexValue=function(t,e,n,i){var o=new StringBuffer;return o.append(this.CHAR_SPLIT),o.append(t),10>e&&o.append("0"),o.append(e.toString()),n>=0&&(10>n&&o.append("0"),o.append(n.toString())),i>=0&&o.append(i.toString()),o.toString()},t.converColorStrToStr=function(t){for(var e=t,n=e.indexOf("/c");n>=0;)n=(e=e.substring(0,n)+e.substring(n+8)).indexOf("/c");for(n=e.indexOf("/p");n>=0;)n=(e=e.substring(0,n)+e.substring(n+2)).indexOf("/p");return e},t.calculateEndCharPosition=function(e,n,i,o,a,r){void 0===a&&(a=-1),void 0===r&&(r=null),e=t.converColorStrToStr(e);var s=0,l=0,_=t.assistTextfield;_.fontFamily=o,_.size=i,_.multiline=!1,_.wordWrap=!1;for(var h="",u=0;u<e.length;u++){var c=e.charAt(u);if("\\"==c||"/"==c){if("n"==e.charAt(u+1)){l+=i,s=0,u+=1,h="";continue}}else if("\n"==c){l+=i,s=0,h="";continue}_.text=h+c,_.width>n?(l+=i,h=c,_.text=h,s=_.width):(s=_.width,h+=c)}var T="";return a>0&&_.width+a>n?(l+=i,s=0,h="",_.text=h,T="\n"):T="",r&&r.append(T),new egret.Point(s,l)},t.getFaceIconPosition=function(e,n,i,o){void 0===o&&(o=null);for(var a,r=e.indexOf("/f"),s=[];-1!=r;){a=e.substring(0,r);var l,_=e.substring(r+2,r+4),h=t.calculateEndCharPosition(a,n.width,n.size,n.fontFamily),u=!1;h.x+n.size/2>=n.width?(l=new FaceIconData(0,h.y+n.size,_),u=!0):l=new FaceIconData(h.x,h.y,_),s.push(l),u&&(a+="\n"),a+=i,a+=e.substring(r+4),r=(e=a).indexOf("/f")}return null!=o&&o.append(e),s},t.getNextPowerSign=function(t){if(Tool.isNullText(t))return-1;var e=t.indexOf("/");if(-1!=e)switch(t.substring(e+1,e+2)){case"i":case"j":case"f":case"c":case"b":case"m":case"p":return e}return-1},t.CHAR_SPLIT="/",t.CHAR_ICON="i",t.CHAR_ICON_REWARD="j",t.CHAR_FACE_ICON="f",t.CHAR_COLOR_STRING="c",t.CHAR_BAG="b",t.CHAR_MISSION="m",t.CHAR_END="p",t.LENGTH_ICON=7,t.LENGTH_FACE_ICON=4,t.LENGTH_STRING=8,t.LENGTH_BAG=4,t.LENGTH_MISSION=6,t.UNDERLINE_CHAR="{}",t.assistTextfield=new egret.TextField,t}();__reflect(PowerString.prototype,"PowerString");var TextFieldUtils=function(){function t(){}return t.getNameLabel=function(t,e){var n=new egret.TextField;return n.size=13,n.fontFamily="黑体",n.stroke=1,1==e?(n.textColor=16716288,n.strokeColor=1380111):(n.textColor=1900540,n.strokeColor=0),n.text=t,n},t.getTextFlowElement=function(t,e,n,i,o,a,r){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=""),void 0===o&&(o=-1),void 0===a&&(a=0),void 0===r&&(r=null);var s={};return n>0&&(s.size=n),e>=0&&(s.textColor=e),i&&""!=i&&(s.fontFamily=i),o>0&&(s.stroke=o,s.strokeColor=a),null!=r&&""!=r&&(s.href="event:"+r,t="["+t+"]"),{text:t,style:s}},t.getTextWidth=function(t,e,n){void 0===e&&(e=30),void 0===n&&(n=null),null==this.tempTxt&&(this.tempTxt=new egret.TextField),this.tempTxt.multiline=!1,this.tempTxt.fontFamily=n,this.tempTxt.size=e;var i=Tool.convertDescToTextFlow(t,-1,!1);return this.tempTxt.textFlow=i,this.tempTxt.textWidth},t.getTextHeight=function(t,e,n,i){void 0===n&&(n=30),void 0===i&&(i=null),null==this.tempTxt&&(this.tempTxt=new egret.TextField),this.tempTxt.multiline=!0,this.tempTxt.wordWrap=!0,this.tempTxt.width=e,this.tempTxt.fontFamily=i,this.tempTxt.size=n;var o=Tool.convertDescToTextFlow(t,-1,!1);return this.tempTxt.textFlow=o,this.tempTxt.textHeight},t.getTextHeightByTextFlow=function(t,e,n,i){return void 0===n&&(n=30),void 0===i&&(i=null),null==this.tempTxt&&(this.tempTxt=new egret.TextField),this.tempTxt.multiline=!0,this.tempTxt.wordWrap=!0,this.tempTxt.width=e,this.tempTxt.fontFamily=i,this.tempTxt.size=n,this.tempTxt.textFlow=t,this.tempTxt.textHeight},t.getTextWidthByTextFlow=function(t,e,n){return void 0===e&&(e=30),void 0===n&&(n=null),null==this.tempTxt&&(this.tempTxt=new egret.TextField),this.tempTxt.multiline=!0,this.tempTxt.wordWrap=!0,this.tempTxt.fontFamily=n,this.tempTxt.size=e,this.tempTxt.textFlow=t,this.tempTxt.textWidth},t.getSpaceByWidth=function(t,e,n){null==this.tempTxt&&(this.tempTxt=new egret.TextField),this.tempTxt.multiline=!1,this.tempTxt.wordWrap=!1,this.tempTxt.fontFamily=n,this.tempTxt.size=e,this.tempTxt.text="";for(var i="",o=this.tempTxt.textWidth;t>o;)i+=" ",this.tempTxt.text=i,o=this.tempTxt.textWidth;return i},t.getSizeByMaxWidth=function(t,e,n){var i=15*xhdRatio,o=this.getTextWidth(t,i,n);return o>e&&(i=Math.floor(e/o*i)),i},t}();__reflect(TextFieldUtils.prototype,"TextFieldUtils");var ClickHelper=function(){function t(t){this._clickMap={},this._regexMap={},this._targetObj=t,this._targetObj.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTarget,this),this._targetObj.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveStage,this)}return t.prototype.regClickFunc=function(t,e,n,i){null!=this._targetObj[t]&&(this._clickMap[t]={thisObj:n,argvArr:i,clickFunc:e})},t.prototype.removeClickFunc=function(t){null!=this._clickMap[t]&&delete this._clickMap[t]},t.prototype.regRegexFunc=function(t,e,n,i){this._regexMap[t]={thisObj:n,argvArr:i,clickFunc:e}},t.prototype.onClickTarget=function(t){var e=t.target;for(var n in this._clickMap)if(this._targetObj[n]==e){var i=this._clickMap[n];return void this.applyFunc(i.clickFunc,i.thisObj,i.argvArr)}for(var n in this._regexMap)if(e.name.match(n)){null==(i=this._regexMap[n]).argvArr?i.argvArr=[e.name]:i.argvArr=[e.name].concat(i.argvArr),this.applyFunc(i.clickFunc,i.thisObj,i.argvArr);break}},t.prototype.applyFunc=function(t,e,n){null!=t&&t.apply(e,n)},t.prototype.onRemoveStage=function(t){this._clickMap=null,this._regexMap=null,this._targetObj.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTarget,this),this._targetObj.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveStage,this)},t}();__reflect(ClickHelper.prototype,"ClickHelper");var DisplayUtil=function(){function t(){}return t.lockScreen=function(){t._lockRect=new eui.Rect(nato.stageWidth,nato.stageHeight),t._lockRect.x=0,t._lockRect.y=0,t._lockRect.alpha=0,Main.instance.stage.addChild(t._lockRect)},t.unlockScreen=function(){t._lockRect&&t._lockRect.parent&&t._lockRect.parent.removeChild(t._lockRect)},t.clearFilter=function(t){null!=t&&(t.filters=null)},t.applyGlow=function(t,e){void 0===e&&(e=16776960);var n=new egret.GlowFilter(e,.8,35,35,2,3,!1,!1);t.filters=[n]},t.applyGray=function(e){var n=[];n=(n=(n=(n=n.concat([.3086,.6094,.082,0,0])).concat([.3086,.6094,.082,0,0])).concat([.3086,.6094,.082,0,0])).concat([0,0,0,1,0]),t.applyFilter(e,n)},t.setBrightHalf=function(e){var n=[];n=(n=(n=(n=n.concat([1,0,0,0,-100])).concat([0,1,0,0,-100])).concat([0,0,1,0,-100])).concat([0,0,0,1,0]),t.applyFilter(e,n)},t.showBeatObject=function(e,n){t.applyGlow(e,n),egret.Tween.get(e,{loop:!0}).to({scaleX:1.1,scaleY:1.1},500).to({scaleX:.9,scaleY:.9},500)},t.scaleDisplay=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i,o=e/t.width*t.scaleX,a=n/t.height*t.scaleY;i=e>0&&n>0?o>a?a:o:e>0?o:a,t.scaleX=i,t.scaleY=i},t.applyFilter=function(t,e){null!=t&&(t.filters=[new egret.ColorMatrixFilter(e)])},t}();__reflect(DisplayUtil.prototype,"DisplayUtil");var GlobalVariable=function(){function t(){this._obj={}}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.getVar=function(t){return this._obj[t]},t.prototype.remove=function(t){delete this._obj[t]},t.prototype.setVar=function(t,e){this._obj[t]=e},t}();__reflect(GlobalVariable.prototype,"GlobalVariable");var InteractUtil=function(){function t(){}return t.setGroupTouch=function(t){t.touchEnabled=!0,t.touchChildren=!1},t.toMoneyType=function(t){switch(t){case-1:return ItemData.ITEM_MONEY_TYPE_1;case-2:return ItemData.ITEM_MONEY_TYPE_2;case-3:return ItemData.ITEM_MONEY_TYPE_3}},t.toMoneyName=function(t){switch(t){case ItemData.ITEM_MONEY_TYPE_1:return GameText.STR_MONEY1;case ItemData.ITEM_MONEY_TYPE_2:return GameText.STR_MONEY2;case ItemData.ITEM_MONEY_TYPE_3:return GameText.STR_MONEY3}},t.second2DHMS=function(t){var e=new Date(t),n=e.getMonth()+1,i=e.getDate(),o=e.getHours(),a=e.getMinutes();return""+(10>n?0:"")+n+"月"+(10>i?0:"")+i+"日"+(10>o?0:"")+o+":"+(10>a?0:"")+a},t.formatDate=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=!1);var i="";if(n){var o=Math.floor(t/3600);i+=(10>o?"0"+o:""+o)+":",t=Math.ceil(t%3600)}var a=Math.floor(t/60),r=Math.floor(t%60);return e+i+(10>a?"0"+a:""+a)+":"+(10>r?"0"+r:""+r)},t.sortObjectOn=function(t,e,n){void 0===n&&(n=!0);var i=n?1:-1;t.sort((function(t,n){return t[e]>n[e]?i:t[e]<n[e]?-i:0}))},t.applyFunc=function(t,e,n){null!=t&&t.apply(e,n)},t.sendMessage=function(e,n,i,o,a){var r=this,s=new nato.Message(e,o,a);PanelManager.openWaitForServer(),nato.Network.sendCmd(s,(function(e){PanelManager.closeWaitForServer(),MsgHandler.isMessageHaveError(e)||t.applyFunc(n,r,[e])}),this)},t}();__reflect(InteractUtil.prototype,"InteractUtil");var native,LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){nato.fitBG(this)},e.prototype.onRemoveFromStage=function(t){},e.prototype.showLoginRegion=function(){7500==xchannel?PanelManager.openTouristPanel():PanelManager.openLoginPanel()},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI"),function(t){t.loginParams="",t.setNativeInterface=function(){egret.ExternalInterface.addCallback("loginToJS",(function(e){console.log("shane call loginToJS from app: "+e),t.loginParams=e,Sdk.xsdk.openLogin()})),egret.ExternalInterface.addCallback("payToJS",(function(t){var e=parseInt(t);console.log("shane call payToJS from app: "+e),0==e?WorldMessage.addTips("购买成功"):WorldMessage.addTips("购买失败")}))}}(native||(native={}));var VipPowerListItem=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.setdata=function(t,e){this._index=t,this._desc=e,this.height=TextFieldUtils.getTextHeight(this._desc,175*xhdRatio,13*xhdRatio,"黑体")+10*xhdRatio},e.prototype.update=function(){this.init&&(this.label_power.text="特权"+(this._index+1),this.label_desc.textFlow=Tool.convertDescToTextFlow(this._desc),this.label_desc.height=this.label_desc.textHeight)},e}(ComponentBase);__reflect(VipPowerListItem.prototype,"VipPowerListItem");var VipScene=function(t){function e(){var e=t.call(this)||this;return e._getNowRewardIndex=0,e._powerIndex=0,e._curShowVIPLevel=0,e._isBackDirect=!1,e._getNowRewardItemList=[],e._powerItemList=[],e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),ButtonUtils.addTouchEvent(this.btn_left,this.onBtnLeftTouch,this),ButtonUtils.addTouchEvent(this.btn_right,this.onBtnRightTouch,this),ButtonUtils.addTouchEvent(this.group_pay_btn,this.onBtnPay,this),ButtonUtils.addTouchEvent(this.group_dayGift_btn,this.onBtnDayGift,this),ButtonUtils.addTouchEvent(this.btn_dayRewardClose,this.onBtnDayRewardClose,this),this.group_vip.removeChildren(),this.vipNum=ImageNum.create(2006),this.vipNum.scaleX=this.vipNum.scaleY=.6*xhdRatio,this.group_vip.addChild(this.vipNum),this.group_infoVipNum.removeChildren(),this.infoVipNum=ImageNum.create(2006),this.infoVipNum.scaleX=this.infoVipNum.scaleY=.6*xhdRatio,this.group_infoVipNum.addChild(this.infoVipNum),null==this._itemList&&(this._itemList=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5,this.item6,this.item7,this.item8,this.item9,this.item10,this.item11]);for(var n=0;n<this._itemList.length;n++){this._itemList[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this.reset(),VipInfo.doGetVipInfo(this.getDataBack,this)},e.prototype.getDataBack=function(){this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn),ButtonUtils.removeTouchEvent(this.btn_left),ButtonUtils.removeTouchEvent(this.btn_right),ButtonUtils.removeTouchEvent(this.group_pay_btn),ButtonUtils.removeTouchEvent(this.group_dayGift_btn),ButtonUtils.removeTouchEvent(this.btn_dayRewardClose);for(var n=0;n<this._itemList.length;n++){this._itemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItemTouch,this)}this._isBackDirect=!1,this.vipNum=null,this.infoVipNum=null},e.prototype.onClose=function(){PanelManager.closeScene(this._isBackDirect)},Object.defineProperty(e.prototype,"isBackDirect",{get:function(){return this._isBackDirect},set:function(t){this._isBackDirect=t},enumerable:!0,configurable:!0}),e.prototype.onBtnLeftTouch=function(){var t=this._curShowVIPLevel-1;1>t&&(t=1);var e=VipInfo.getVipInfo(t);this.updateVipInfo(e)},e.prototype.onBtnRightTouch=function(){var t=this._curShowVIPLevel+1,e=VipInfo.getMaxVipLevel();t>e&&(t=e);var n=VipInfo.getVipInfo(t);this.updateVipInfo(n)},e.prototype.onBtnPay=function(){PayInfo.getPayList(!0)},e.prototype.onBtnDayGift=function(){this.showDayReward()},e.prototype.onBtnDayRewardClose=function(){this.group_dayReward.visible=!1},e.prototype.onItemTouch=function(t){var e=t.target;e&&e.itemData&&AlertPanel.alertTipsCommon(e.itemData.getDesc(xself,!0))},e.prototype.onGetNowRewardItemTouch=function(t){var e=t.target;e&&e.itemData&&AlertPanel.alertTipsCommon(e.itemData.getDesc(xself,!0))},e.prototype.reset=function(){this.init&&(this.lab_money.text="",this.lab_next_vip.text="",this.label_curMoney.text="",this.container.reset(),this.hContainer_getNow.reset(),this._getNowRewardIndex=0,this._powerIndex=0)},e.prototype.update=function(){if(this.init){var t=VipInfo.getDataList();if(null!=t&&0!=t.length&&null!=xself){var e=xself.getVipLevel();this.vipNum.num=e;var n=VipInfo.getVipInfo(e),i=VipInfo.getVipInfo(e+1);if(null!=i){this.group_vipInfo.visible=!0;var o=i.money-VipInfo.curGainMoney;this.lab_money.text=o+"黄金",this.lab_next_vip.text="VIP"+(e+1),this.bar_exp.maximum=i.money,this.bar_exp.value=VipInfo.curGainMoney}else this.group_vip.visible=!1,i=n,this.bar_exp.maximum=n.money,this.bar_exp.value=n.money;this.updateVipInfo(i)}}},e.prototype.updateVipInfo=function(t){if(null!=t){var e=VipInfo.getMaxVipLevel();this._curShowVIPLevel=t.level,this._curShowVIPLevel<=1?this.btn_left.visible=!1:this.btn_left.visible=!0,this._curShowVIPLevel>=e?this.btn_right.visible=!1:this.btn_right.visible=!0,this.infoVipNum.num=t.level,this.label_curMoney.text="充值"+t.money+"黄金",this._powerIndex=0,this.container.reset();var n=t.desc.split("\n"),i=0;if(n&&n.length>0)for(var o=0;o<n.length;o++){var a=n[o];if(0==Tool.isNullText(a)){var r=this.getPowerListItem();r.setdata(i,a),this.container.add(r),i++}}this.container.update();var s=0;this._getNowRewardIndex=0,this.hContainer_getNow.reset();for(o=0;o<t.ownRewardList.length;o++){var l=t.ownRewardList[o],_=this.getGetNowRewardItem();_.itemData=l,s=(_.width-15*xhdRatio)*o,this.hContainer_getNow.add(_,s)}this.hContainer_getNow.update()}},e.prototype.getGetNowRewardItem=function(){var t=this._getNowRewardItemList[this._getNowRewardIndex];return null==t&&(t=new Item4,nato.attachSkin(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetNowRewardItemTouch,this),this._getNowRewardItemList[this._getNowRewardIndex]=t),this._getNowRewardIndex++,t},e.prototype.getPowerListItem=function(){var t=this._powerItemList[this._powerIndex];return null==t&&(t=new VipPowerListItem,nato.attachSkin(t),this._powerItemList[this._powerIndex]=t),this._powerIndex++,t},e.prototype.showDayReward=function(){var t=VipInfo.getVipInfo(this._curShowVIPLevel);if(null!=t){this._showDayRewardGroupList=[],this.updateDayRewardList(0,t.loginRewardList),this.updateDayRewardList(1,t.loginRewardList),this.updateDayRewardList(2,t.loginRewardList);var e=this.group_dayRewardList0.height+7*xhdRatio,n=Math.floor((this.group_dayReward.height-e*this._showDayRewardGroupList.length)/2);n>80*xhdRatio&&(n=80*xhdRatio);for(var i=0;i<this._showDayRewardGroupList.length;i++){this._showDayRewardGroupList[i].y=n+e*i}this.btn_dayRewardClose.y=n+e*this._showDayRewardGroupList.length+10*xhdRatio,this.group_dayReward.visible=!0}else this.group_dayReward.visible=!1},e.prototype.updateDayRewardList=function(t,e){for(var n,i,o=this["group_dayRewardList"+t],a=[this["item"+(4*t+0)],this["item"+(4*t+1)],this["item"+(4*t+2)],this["item"+(4*t+3)]],r=[],s=0;s<a.length;s++)n=a[s],e&&null!=e[4*t+s]?(i=e[4*t+s],n.itemData=i,n.update(),n.visible=!0,r.push(n)):n.visible=!1;if(r.length>0){o.visible=!0,this._showDayRewardGroupList.push(o);var l=60*xhdRatio,_=Math.floor((o.width-l*r.length)/r.length);for(s=0;s<r.length;s++)(n=r[s]).x=_+l*s}else o.visible=!1},e}(ComponentBase);__reflect(VipScene.prototype,"VipScene");var WelfarePanel=function(t){function e(e){void 0===e&&(e=0);var n=t.call(this)||this;return n._defaultPage=0,n._defaultPage=e,nato.attachSkin(n),n}return __extends(e,t),e.prototype.initComponent=function(){var e=this;if(t.prototype.initComponent.call(this),!isWanyiWan){PanelManager.openWaitForServer();var n=new nato.Message(ProtocolDefine.CG_WANBA_VIP_GIFT);nato.Network.sendCmd(n,(function(t){e._msg=t,e.initVipInfo(),PanelManager.closeWaitForServer()}),this)}var i=new ItemData;i.isMoney=!0,i.moneyType=ItemData.ITEM_MONEY_TYPE_2,i.quantity=50,this.sendAward.itemData=i,this.shareAward.itemData=i,this.updatePanel(),this.welfareTab.selectedIndex=this._defaultPage,this.welfareView.selectedIndex=this._defaultPage},e.prototype.initListeners=function(){t.prototype.initListeners.call(this),this._clickHelper.regClickFunc("btnCharge",this.onCharge,this),this._clickHelper.regClickFunc("btnGetAward",this.onGetAward,this),this._clickHelper.regClickFunc("btnSendDesk",this.onSendDesk,this),this._clickHelper.regClickFunc("btnDailyShare",this.onDailyShare,this),this._clickHelper.regClickFunc("btnGoInterest",this.onGoInterest,this),this.welfareTab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickTab,this)},e.prototype.removeListeners=function(){t.prototype.removeListeners.call(this),this.welfareTab.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickTab,this)},e.prototype.initVipInfo=function(){var t=this._msg.getInt(),e=this._msg.getBoolean();this.txtVipLevel.text=t.toString(),e?(this.btnGetAward.label="已领取",this.btnGetAward.touchEnabled=!1,DisplayUtil.applyGray(this.btnGetAward)):(this.btnGetAward.label="领取",this.btnGetAward.touchEnabled=!0,DisplayUtil.clearFilter(this.btnGetAward));for(var n=[],i=this._msg.getByte(),o=0;i>o;o++){var a=(this._msg.getInt(),this._msg.getByte());n[o]=[];for(var r=0;a>r;r++){var s=new ItemData;this._msg.getBoolean()?(s.isMoney=!0,s.moneyType=InteractUtil.toMoneyType(this._msg.getInt()),s.quantity=this._msg.getInt()):(s.isMoney=!1,ItemData.fromBytesAtts2(s,this._msg),s.quantity=this._msg.getInt(),s.durMax>0&&(s.durability=s.durMax)),n[o][r]=s}}0>=t?(this.spCurVip.visible=!1,this.spCurVip.includeInLayout=!1,this.listNextAward.itemRenderer=WelfareVipItem,this.listNextAward.dataProvider=new eui.ArrayCollection(n[0])):(this.spCurVip.visible=!0,this.spCurVip.includeInLayout=!0,this.listCurAward.itemRenderer=WelfareVipItem,this.listCurAward.dataProvider=new eui.ArrayCollection(n[0]),this.listNextAward.itemRenderer=WelfareVipItem,this.listNextAward.dataProvider=new eui.ArrayCollection(n[1]))},e.prototype.updatePanel=function(){var t=[];t.push({id:0,hasWard:!1}),t.push({id:1,hasWard:!1}),isWanyiWan||t.push({id:2,hasWard:!1}),t.push({id:3,hasWard:!1}),this.welfareTab.itemRenderer=WelfareTabItem,this.welfareTab.dataProvider=new eui.ArrayCollection(t)},e.prototype.onClickTab=function(t){var e=t.item;this.welfareView.selectedIndex=e.id},e.prototype.onCharge=function(){xworld.inBattle||(xshowdemo?PayInfo.getTestPayInfo():PayInfo.getPayList())},e.prototype.onGetAward=function(){var t=this;InteractUtil.sendMessage(ProtocolDefine.CG_DRAW_WANBA_GIFT,(function(e){var n=new StringBuffer,i=e.getInt(),o=e.getInt(),a=e.getInt();xself.setMoneyByType(ModelConst.MONEY1,i,n),xself.setMoneyByType(ModelConst.MONEY2,o,n),xself.setMoneyByType(ModelConst.MONEY3,a,n),t.btnGetAward.label="已领取",t.btnGetAward.touchEnabled=!1,DisplayUtil.applyGray(t.btnGetAward);var r=MsgHandler.processAddItemMsg(e,ProtocolDefine.CG_DRAW_WANBA_GIFT);n.append(r),WorldMessage.addTips(n.toString())}),this)},e.prototype.onSendDesk=function(){Sdk.xsdk.sendToDesktop(this.afterSendDesk)},e.prototype.afterSendDesk=function(){nato.Network.sendCmd(MsgHandler.saveToDesktop(),(function(t){if(0>t.getInt());else{var e=t.getInt(),n=e-xself.money2;xself.money2=e,AlertPanel.alertCommon(GameText.SAVE_TO_DESKTOP+n+GameText.STR_MONEY2)}}),this)},e.prototype.onDailyShare=function(){var t=xworld.share_desc;Sdk.xsdk.share("","世界Online",t,"","","",0,(function(){MsgHandler.createChannelShareMsg("","")}),(function(){}),this)},e.prototype.onGoInterest=function(){Sdk.xsdk.openUrl("https://buluo.qq.com/p/barindex.html?bid=402636",1,0)},e}(SceneBase);__reflect(WelfarePanel.prototype,"WelfarePanel");var WelfareTabItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;e.hasWard?RedPoint.addRedPoint(this):RedPoint.removeRedPoint(this),this.imgTab.source=["fuli_tab_dailyshare_","fuli_tab_interest_","fuli_tab_zoneaward_","fuli_tab_collect_"][e.id]+["hd","sd"][xhd?0:1]},e}(eui.ItemRenderer);__reflect(WelfareTabItem.prototype,"WelfareTabItem");var WelfareVipItem=function(t){function e(){var e=t.call(this)||this;return nato.attachSkin(e),e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.once(egret.Event.REMOVED_FROM_STAGE,(function(){e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e)}),this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.spItem.itemData=this.data},e.prototype.onClick=function(){var t=this.data;t.isMoney?AlertPanel.alertTipsCommon(this.getMoneyDesc(t)):AlertPanel.alertTipsCommon(t.getDesc(xself,!0))},e.prototype.getMoneyDesc=function(t){return t.getNameInfo()+"x"+t.quantity+"\n"},e}(eui.ItemRenderer);__reflect(WelfareVipItem.prototype,"WelfareVipItem");var WorldMap=function(){function t(){this.mapList=null,this.initOpenLevel()}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.initOpenLevel=function(){var e=[];e[1]=30,e[2]=40,e[3]=25,e[4]=15,e[5]=1,e[6]=14,e[7]=16,e[8]=1,e[9]=15,e[10]=35,e[11]=40,e[12]=34,t.MapOpenLevel=e},t.prototype.getOpenLevel=function(e){return t.MapOpenLevel[e]},t.prototype.doEnterWorldMap=function(){this.mapList=null;var t=MsgHandler.createWorldMapMsg();nato.Network.sendCmd(t,this.doEnterWorld_callback,this)},t.prototype.doEnterWorld_callback=function(t){this.fromBytes(t),PanelManager.isPanelShow(WorldMapScene)&&PanelManager.getPanel(WorldMapScene).update()},t.prototype.fromBytes=function(t){this.mapList=[];for(var e=t.getByte(),n=0;e>n;n++){var i=t.getUnsignedByte(),o=t.getString(),a=t.getShort(),r=t.getShort(),s=t.getByte(),l=new WorldMapItemData;l.id=i,l.name=o,l.px=a,l.py=r,l.status=s,this.mapList[i]=l}},t.prototype.fromListBytes=function(t){for(var e=[],n=t.getByte(),i=0;n>i;i++){var o=t.getShort(),a=t.getString(),r=t.getString(),s=t.getByte(),l=t.getByte(),_=new WorldMapListItemData;_.childID=o,_.name=a,_.info=r,_.status=s,_.isNeedItem=l,e.push(_)}return e},t.prototype.doGetMapList=function(t){if(null!=t){var e=t.id,n=t.name,i=this,o=MsgHandler.createWorldMapListMsg(e);nato.Network.sendCmd(o,(function(t){var e=t.getByte();if(PanelManager.closeWaitForServer(),0==e){var o=i.fromListBytes(t);PanelManager.openWorldMapListPanel(n,o)}}),this),PanelManager.openWaitForServer()}},t.prototype.doJumpMap=function(t){if(0!=SafeLock.doSafeLockVerify(this.doJumpMap,this,[t])&&null!=t){var e=t.childID,n=MsgHandler.createWorldMapEnterMsg(e);nato.Network.sendCmd(n,(function(t){if(0>t.getByte())AlertPanel.errorMessage(t.getString());else{if(1==(1==t.getByte())){var e=t.getShort(),n=(t.getInt(),xself);if(null==n||null==n.bag)return;var i=n.bag.getItem(e);null==i||i.id;n.bag.removeBagItemByPos(e,1);Define.SUCCESS}MsgHandler.instance.processDataBlockFlagMsg(t),PanelManager.closeScene(!0),xself.clearAutoMoveList()}}),this)}},t.prototype.getMapItemData=function(t){return null==this.mapList||null==this.mapList[t]?null:this.mapList[t]},t.STATE_NONE=0,t.STATE_HAVE_EVENT=1,t.STATE_FINISH=2,t.ID_juewangbingyuan=1,t.ID_yuangusenlin=2,t.ID_shengyuyiji=3,t.ID_taiyangcheng=4,t.ID_shijiezhimen=5,t.ID_jinglingzhisen=6,t.ID_yueyashan=7,t.ID_shushan=8,t.ID_xinyueguzhen=9,t.ID_zijingcheng=10,t.ID_ziyunshan=11,t.ID_shihunshamo=12,t}();__reflect(WorldMap.prototype,"WorldMap");var WorldMapItem=function(t){function e(){var e=t.call(this)||this;return e._initMapID=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e)},e.prototype.initMapID=function(t){this._initMapID=t},Object.defineProperty(e.prototype,"mapID",{get:function(){return this._initMapID},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._data=t,this.update()},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.mapName_label&&(this.mapName_label.visible=this._select)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){},e.prototype.update=function(){this.init&&(this._data?(this.mapName_label.visible=this._select,this.mapName_label.text=this._data.name,this._data.status==WorldMap.STATE_HAVE_EVENT?(this.taskSign_img.visible=!0,this.taskSign_img.source="task_can_accept"):this.taskSign_img.visible=!1):(this.taskSign_img.visible=!1,this.mapName_label.visible=!1))},e}(ComponentBase);__reflect(WorldMapItem.prototype,"WorldMapItem");var WorldMapItemData=function(){};__reflect(WorldMapItemData.prototype,"WorldMapItemData");var WorldMapListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.btn_detail,this.onBtnDetail,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.btn_detail)},e.prototype.onBtnDetail=function(){if(null!=this._data){var t,e=[];t=new MenuActionData(GameText.getText(GameText.TI_BACK),1),e.push(t),t=new MenuActionData(GameText.getText(GameText.TI_ENTER),2),e.push(t);var n=this._data.info;1==this._data.isNeedItem&&(n+="\n"+GameText.STR_VIEW_MAP_NEED_PORTAL_STONE),PanelManager.openSelectMenuPanel(n,e,this.onMenuSelect,this)}},e.prototype.onMenuSelect=function(t){PanelManager.closeSelectMenuPanel(),2==t&&WorldMap.instance.doJumpMap(this._data)},e.prototype.setData=function(t){this._data=t},e.prototype.reset=function(){this.icon_task.visible=!1,this.label_name.text="",this._data=null},e.prototype.update=function(){if(this.init&&this._data){var t=this;this._data.status==WorldMap.STATE_HAVE_EVENT?(this.icon_task.visible=!0,nato.getTextureFromUICache("task_can_accept",(function(e){t.icon_task.texture=e}),this)):this.icon_task.visible=!1,this.label_name.text=this._data.name}},e}(ComponentBase);__reflect(WorldMapListItem.prototype,"WorldMapListItem");var WorldMapListItemData=function(){};__reflect(WorldMapListItemData.prototype,"WorldMapListItemData");var WorldMapListPanel=function(t){function e(){var e=t.call(this)||this;return e._itemList=new Array,e}return __extends(e,t),e.prototype.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e),ButtonUtils.addTouchEvent(this.closeBtn,this.onClose,this),this.update()},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e),ButtonUtils.removeTouchEvent(this.closeBtn)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.setData=function(t,e){this._mapName=t,this._list=e},e.prototype.reset=function(){this.container.reset(),this._index=0},e.prototype.update=function(){if(this.init){if(this.reset(),this.label_title.text=this._mapName,this._list&&this._list.length>0)for(var t=0;t<this._list.length;t++){var e=this._list[t],n=this.getItem();n.setData(e),this.container.add(n)}this.container.update()}},e.prototype.getItem=function(){var t=this._itemList[this._index];return t||(t=new WorldMapListItem,nato.attachSkin(t),this._itemList[this._index]=t),this._index++,t},e}(ComponentBase);__reflect(WorldMapListPanel.prototype,"WorldMapListPanel");var WorldMapScene=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.onAddToStage=function(e){if(t.prototype.onAddToStage.call(this,e),null==this._mapItemList){this._mapItemList=new Array;for(var n=0;12>n;n++){(o=this["map"+n]).initMapID(n+1),o.select=!1,this._mapItemList[n]=o}}if(null==this._mapMaskList){this._mapMaskList=[];for(n=0;12>n;n++){var i=this["mask"+n];this._mapMaskList[n]=i}}for(n=0;n<this._mapItemList.length;n++){var o;(o=this._mapItemList[n]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMapItemTouch,this)}this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onRemoveFromStage=function(e){t.prototype.onRemoveFromStage.call(this,e);for(var n=0;n<this._mapItemList.length;n++){this._mapItemList[n].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMapItemTouch,this)}this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},e.prototype.onClose=function(){PanelManager.closeScene()},e.prototype.onMapItemTouch=function(t){var e=t.target;if(e){this._curSelectMapItem&&(this._curSelectMapItem.select=!1),this._curSelectMapItem=e,this._curSelectMapItem.select=!0;var n=xself.getLevel(),i=WorldMap.instance.getOpenLevel(e.mapID);n>=i?WorldMap.instance.doGetMapList(e.data):AlertPanel.alertCommon(i+"级开放")}},e.prototype.update=function(){if(this.init)for(var t=xself.getLevel(),e=0;e<this._mapItemList.length;e++){var n=this._mapItemList[e],i=WorldMap.instance.getMapItemData(n.mapID);n.setData(i),this._mapMaskList[e].visible=t<WorldMap.instance.getOpenLevel(n.mapID)}},e}(ComponentBase);__reflect(WorldMapScene.prototype,"WorldMapScene");